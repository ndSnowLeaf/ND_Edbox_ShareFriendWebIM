define(["jquery","espEnvironment","espService/../esp-service-exceptions"],function($,espEnvironment,EspExceptions){function getNodeService(){return require("../service/core/coursewareobject.js")}function promise(q){var deferred=$.Deferred();return q.then(function(result){deferred.resolve(result)},function(result){deferred.reject(result)}),deferred.promise()}var service={};return service.coursewareobject={create:function(coursewareObject){return promise(getNodeService().create(coursewareObject))},createByTemplate:function(templateCode,data){return promise(getNodeService().createFromTemplate(templateCode,data))},get:function(coursewareObjectId){return promise(getNodeService().get(coursewareObjectId))},list:function(params){return promise(getNodeService().search(params.type,params.title).then(function(results){return{items:results||[],total_count:(results||[]).length}}))},getMainXml:function(coursewareObjectId){return promise(getNodeService().getMain(coursewareObjectId))},updateMainXml:function(coursewareObjectId,mainXml){return promise(getNodeService().updateMain(coursewareObjectId,mainXml))},getPageXml:function(coursewareObjectId,pageId){return promise(getNodeService().getPage(coursewareObjectId,pageId))},createPageXml:function(coursewareObjectId,pageXml){return promise(getNodeService().createPage(coursewareObjectId,pageXml))},updatePageXml:function(coursewareObjectId,pageId,pageXml){return promise(getNodeService().updatePage(coursewareObjectId,pageId,pageXml))},updateTextResource:function(coursewareObjectId,path,text){return promise(getNodeService().updateTextResource(coursewareObjectId,path,text))},copyAs:function(coursewareObjectId,newCoursewareObjectId){return promise(getNodeService().copy(coursewareObjectId,newCoursewareObjectId))},getAssetFileWriter:function(coursewareObjectId){return function(file){return promise(getNodeService().uploadResourceFile(coursewareObjectId,file.path))}},listAssets:function(coursewareObjectId,params){return promise(getNodeService().searchResourceFiles(coursewareObjectId,params&&params.type))}},service.coursewareobjectTemplate={list:function(type){var result=[];return $.each(espEnvironment.coursewareobjectTemplateDefines,function(i,define){define.categoryCode==category&&result.push(define)}),$.when(result)}},service.question={list:function(params){return promise(getNodeService().search("basic_question",params.title).then(function(results){return{items:results||[],total_count:(results||[]).length}}))},create:function(metadata){return post(url())}},service});