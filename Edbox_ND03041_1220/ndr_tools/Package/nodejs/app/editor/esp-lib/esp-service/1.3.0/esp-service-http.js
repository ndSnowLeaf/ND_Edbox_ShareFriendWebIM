define(["jquery","espEnvironment","espEnvironment/../UrlHelper","espService/../esp-service-exceptions"],function($,espEnvironment,UrlHelper,EspExceptions){function get(url,settings){return $.ajax(url,$.extend({type:"GET"},settings))}function post(url,data,settings){return settings=$.extend({type:"POST",data:data,contentType:"application/json"},settings),"application/json"==settings.contentType&&settings.data&&(settings.data=JSON.stringify(settings.data)),$.ajax(url,settings)}function put(url,data,settings){return settings=$.extend({type:"PUT",data:data,contentType:"application/json"},settings),"application/json"==settings.contentType&&settings.data&&(settings.data=JSON.stringify(settings.data)),$.ajax(url,settings)}function httpService(serviceConfig){var url=UrlHelper.root(UrlHelper.build(serviceConfig.server,{file_path:espEnvironment.location.params.file_path})),assetUrl=UrlHelper.root(UrlHelper.build(serviceConfig.assetServer||serviceConfig.server,{file_path:espEnvironment.location.params.file_path})),service={};service.coursewareobject={create:function(coursewareObject){return post(url("/v2.0/courseware_objects"),coursewareObject).then(null,EspExceptions.CREATE_COURSEWAREOBJECT.asFail())},createByTemplate:function(templateCode,params){return post(url("/v2.0/courseware_objects/actions/from_template?template_code={0}",templateCode,params)).then(null,EspExceptions.CREATE_COURSEWAREOBJECT.asFail())},get:function(coursewareObjectId){return get(url("/v2.0/courseware_objects/{0}",coursewareObjectId)).then(null,EspExceptions.GET_COURSEWAREOBJECT.asFail(coursewareObjectId))},list:function(params){return get(url("/v2.0/courseware_objects",params)).then(null,EspExceptions.LIST_COURSEWAREOBJECT.asFail())},getMainXml:function(coursewareObjectId){return get(url("/v2.0/courseware_objects/{0}/main",coursewareObjectId),{dataType:"text"}).then(null,EspExceptions.GET_COURSEWAREOBJECT_MAIN_XML.asFail(coursewareObjectId))},updateMainXml:function(coursewareObjectId,mainXml){return put(url("/v2.0/courseware_objects/{0}/main",coursewareObjectId),mainXml,{contentType:"text/plain"}).then(null,EspExceptions.UPDATE_COURSEWAREOBJECT_MAIN_XML.asFail(coursewareObjectId))},getPageXml:function(coursewareObjectId,pageId){return get(url("/v2.0/courseware_objects/{0}/pages/{1}",[coursewareObjectId,pageId])).then(null,EspExceptions.GET_COURSEWAREOBJECT_PAGE_XML.asFail(pageId))},createPageXml:function(coursewareObjectId,pageXml){return post(url("/v2.0/courseware_objects/{0}/pages",coursewareObjectId),pageXml,{contentType:"text/plain"}).then(null,EspExceptions.CREATE_COURSEWAREOBJECT_PAGE_XML.asFail(coursewareObjectId))},updatePageXml:function(coursewareObjectId,pageId,pageXml){return put(url("/v2.0/courseware_objects/{0}/pages/{1}",[coursewareObjectId,pageId]),pageXml,{contentType:"text/plain"}).then(null,EspExceptions.UPDATE_COURSEWAREOBJECT_PAGE_XML.asFail(pageId))},updateTextResource:function(coursewareObjectId,path,text){return put(url("/v2.0/courseware_objects/{0}/file_content",coursewareObjectId,{path:path}),text,{contentType:"text/plain"}).then(null,EspExceptions.UPDATE_COURSEWAREOBJECT_TEXT_RESOURCE.asFail(path))},copyAs:function(coursewareObjectId,newCoursewareObjectId){return post(url("/v2.0/courseware_objects/{0}/actions/copy?to={1}",[coursewareObjectId,newCoursewareObjectId])).then(null,EspExceptions.COPY_COURSEWAREOBJECT.asFail([coursewareObjectId,newCoursewareObjectId]))},getAssetUploadUrl:function(coursewareObjectId){return url("/v2.0/courseware_objects/{0}/resource_files/actions/upload",coursewareObjectId)},listAssets:function(coursewareObjectId,params){return get(url("/v2.0/courseware_objects/{0}/resource_files",coursewareObjectId,params)).then(null,EspExceptions.LIST_COURSEWAREOBJECT_ASSETS.asFail(coursewareObjectId))},getFileWriter:function(coursewareObjectId){return function(file,path){var formData=new FormData,params=serviceConfig.resourceUploadParams||{};for(var key in params)formData.append(key,params[key]);return formData.append("file",file),post(url("/v2.0/courseware_objects/{0}/resource_files/actions/upload",coursewareObjectId),formData,{contentType:!1,processData:!1})}}};return service.coursewareobjectTemplate={list:function(category){var result=[];return $.each(espEnvironment.coursewareobjectTemplateDefines,function(i,define){define.categoryCode==category&&result.push(define)}),$.when(result)}},service.question={list:function(params){return get(url("/v2.0/courseware_objects",$.extend({type:"basic_question"},params))).then(null,EspExceptions.LIST_QUESTIONS.asFail())},create:function(metadata){return post(url())}},service.asset={list:function(params){return get(assetUrl("/v2.0/assets",params)).then(null,EspExceptions.LIST_ASSET)},getUploadUrl:function(){return assetUrl("/v2.0/assets/actions/upload")}},service}return httpService});