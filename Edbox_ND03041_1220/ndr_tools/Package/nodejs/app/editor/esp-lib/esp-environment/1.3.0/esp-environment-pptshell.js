define(["espEnvironment/../UrlHelper","cryptojs","jquery","i18n!","require"],function(UrlHelper,CryptoJS,$,i18n,requirejs){var params=UrlHelper.deserialize(window.location.search),filePath=params.file_path&&params.file_path.replace(/\\/g,"/"),wordArray=CryptoJS.enc.Utf8.parse(filePath),encodedUrl=CryptoJS.enc.Base64.stringify(wordArray);encodedUrl=encodedUrl.replace(/\+/gi,"-"),encodedUrl=encodedUrl.replace(/\//gi,"_");var coursewareobjectRoot="/v2.0/assets/proxy3/"+encodedUrl;return{service:"http",serviceConfig:{server:"/",assetServer:"http://esp-coursewareobject.edu.web.sdp.101.com",NDRServer:"http://esp-lifecycle.web.sdp.101.com",QuestionEditorServer:window.location.origin||window.location.protocol+"//"+window.location.host,fetchTemplateVersion:!1,resourceUploadParams:{}},coursewareobjectPreview:"/prepare/player.html?file_path="+encodeURIComponent(filePath)+"&iframeBridge=true&hidePage=toolbar,footer",coursewareobjectPreviewByMain:"/player/index.html?player-version=&state=&hidePage=toolbar&_lang_="+i18n.lang+"&iframeBridge=true&hidePage=footer&main-url={mainUrl}&domain=&sys=pptshell&ref-path="+encodeURIComponent("http://cdncs.101.com/v0.1/static"),coursewareobjectRoot:coursewareobjectRoot,coursewareobjectRootUseMetadata:!1,moduleEditorRoot:"/editors/{id}",jsLibraryRefPathSymbol:"${ref-path-addon}",jsLibraryRefPath:"",jsLibraryRoot:"/player/ref/js-library/{name}",questionEditor:"/editor/basic-question/question.html?time"+(new Date).getTime()+"#/{id}/edit/{question_type}?&",referencePath:"http://cs.101.com/v0.1/static",coursewareobjectReferencePath:coursewareobjectRoot+"/_ref",referenceIconPath:"http://cs.101.com/v0.1/static/edu/questions",supports:{asset:!0,"baidu-asset":!0},external:{coursewareobjectEditorForXm:"/interaction/#/{entry}",coursewareobjectEditorForXmApi:"/v0.1/interaction/{entry}",coursewareobjectEditorForOld:"/interaction/#/{entry}",coursewareobjectEditorForOldApi:"/v0.1/interaction/{entry}",slidesServer:"http://esp-slides.edu.web.sdp.101.com/"},ready:function(espEnvironment){var deferred=$.Deferred();return requirejs(["json!/configuration/config.json","json!templateMapping.json","json!/player/configuration/config.json"],function(developerEditorConfig,templateResourceTypeMapping,developerPlayerConfig){function findResourceType(template){var types=[];return $.each(templateResourceTypeMapping,function(resourceType,templateCode){templateCode==template.templateCode&&types.push(resourceType)}),types}var coursewareobjectTemplateDefines=[],moduleEditorDefines=[],jsLibraryDefines=[];$.each(developerEditorConfig.templates||[],function(templateCode,template){coursewareobjectTemplateDefines.push($.extend({},template,{href:template.href.replace("${ref-path-addon}",""),resourceType:findResourceType(template)[0],resourceTypes:findResourceType(template)}))}),$.each(developerEditorConfig.editors||[],function(editorCode,editor){moduleEditorDefines.push($.extend({},editor,{href:editor.href.replace("${ref-path-addon}","")}))}),$.each(developerEditorConfig.script||[],function(i,script){script._isEditorLib_=!0,jsLibraryDefines.push(script)}),$.each(developerPlayerConfig.script||[],function(i,script){jsLibraryDefines.push(script)}),espEnvironment.declareCoursewareobjectTemplate(coursewareobjectTemplateDefines),espEnvironment.declareModuleEditor(moduleEditorDefines),espEnvironment.declareJsLibrary(jsLibraryDefines),deferred.resolve()}),deferred.promise()}}});