define(["jquery"],function($){function UrlRoot(baseUrl){return function(path,v1,v2,v3){return UrlHelper.build([baseUrl,path],v1,v2,v3)}}var reg={protocol:/([^\/]+):\/\/(.*)/i,host:/(^[^\:\/]+)((?:\/|:|$)?.*)/,port:/\:?([^\/]*)(\/?.*)/,path:/([^\?#]+)(\??[^#]*)(#?.*)/},dotPathReg=/\/[^\/]*\/\.\./g,UrlHelper={cleanPathLimit:function(path,start,end){if(!path)return"";if(!0===start)for(;"/"===path.charAt(0);)path=path.substring(1);if(!0===end)for(;"/"===path.charAt(path.length-1);)path=path.substring(0,path.length-1);return path},cleanSearch:function(path){if(!path)return"";var idx=path.indexOf("?");return-1!=idx&&(path=path.substring(0,idx)),path},fixLimit:function(path){return path&&0!=path.indexOf("/")?"/"+path:path},fixPath:function(path){if(!path)return path;for(;dotPathReg.test(path);)path=path.replace(dotPathReg,"");return path},root:function(baseUrl){return UrlRoot(baseUrl)},merge:function(url){if(!$.isArray(url))return url;var sIndex,paths=[],parts=[];$.each(url,function(i,path){$.isArray(path)&&(path=UrlHelper.merge(path)),path&&-1!==(sIndex=path.indexOf("?"))&&(parts.push(path.substring(sIndex+1)),path=path.substring(0,sIndex)),paths.push(path)});var result=paths.join("/").replace(/(:)?(\/{2,})/g,function(match,$1,$2){return $1?$1+"//":"/"});return parts.length&&(result+="?"+parts.join("&")),result},build:function(url,v1,v2,v3){if(!url)return url;url=UrlHelper.merge(url);var variables,params,encode;!0===v1||!1===v1?(variables=[],params={},encode=v1):"string"==typeof v1||$.isArray(v1)||!$.isPlainObject(v1)?(variables=$.isArray(v1)?v1:[v1],$.isPlainObject(v2)?(params=v2,encode=!1!==v3):(params={},encode=!1!==v2)):(variables=[],params=v1,encode=!1!==v2);var noParams={};url=url.replace(/(\{.+?\})/g,function($1){var value,key=$1.substring(1,$1.length-1),index=parseInt(key);return value=isNaN(index)?params[key]:variables[index],encode&&value&&(value=encodeURIComponent(value)),noParams[key]=!0,value||""});var parts=[];if(!1!==params.$$autoParams)for(var key in params)if(!noParams[key]){var value=params[key];null!==value&&void 0!==value||(value=""),$.isArray(value)||(value=[value]);for(var i=0;i<value.length;i++){var v=value[i];$.isPlainObject(v)&&(v=$.toJSON(v)),parts.push((encode?encodeURIComponent(key):key)+"="+(encode?encodeURIComponent(v):v))}}return parts.length>0&&(url+=(-1==url.indexOf("?")?"?":"&")+parts.join("&")),url},analyse:function(url){url&&"/"!=url?0==url.indexOf("/")&&(url=window.location.protocol+"://"+window.location.host+url):url=window.location.href;try{var tmp,res={};res.href=url;for(var p in reg)tmp=reg[p].exec(url),res[p]=tmp[1],url=tmp[2],""===url&&(url="/"),"path"===p&&(res.uri=tmp[1]+tmp[2],res.path=tmp[1],res.search=tmp[2],res.hash=tmp[3]);return res.params=this.deserialize(res.search),res}catch(e){return null}},populate:function(res){return res.protocol+"://"+host+(res.port?":"+res.port:"")+(res.path?"/"+res.path:"")+(res.hash?"#"+res.hash:"")+(res.search?"?"+res.search:"")},serialize:function(params,encode){if(!params)return"";var parts=[],encode=!1!==encode;for(var key in params){var value=params[key];null!==value&&void 0!==value||(value=""),$.isArray(value)||(value=[value]);for(var i=0;i<value.length;i++){var v=value[i];$.isPlainObject(v)&&(v=$.toJSON(v)),parts.push((encode?encodeURIComponent(key):key)+"="+(encode?encodeURIComponent(v):v))}}return parts.join("&")},deserialize:function(search,decode){if("string"!=typeof search)return{};0==search.indexOf("?")&&(search=search.substring(1));for(var result={},decode=!1!==decode,arr=search.split("&"),i=0;i<arr.length;i++){var s=arr[i];if(s){var part=s.split("="),name=part[0],value=part[1]||"";decode&&(name=decodeURIComponent(name),value=decodeURIComponent(value)),result[name]?$.isArray(result[name])?result[name].push(value):result[name]=[result[name],value]:result[name]=value}}return result}};return UrlHelper});