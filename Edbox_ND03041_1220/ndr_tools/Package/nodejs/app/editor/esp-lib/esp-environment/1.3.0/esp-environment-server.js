define(["jquery","espEnvironment/../UrlHelper","json!espEnvironment/../system-properties.json","json!templateMapping.json"],function($,UrlHelper,systemProperties,templateResourceTypeMapping){var esp_developer=systemProperties["developer.cs.path"];return{service:"http",serviceConfig:{server:"/"},security:"uc",securityConfig:{server:systemProperties["uc.server"],org:"org_esp_integration",realm:"portal.services.sdp.nd"},coursewareobjectPreview:systemProperties["editor.server"]+"/ndplayer/{id}/show?type=coursewareobject&rnd=1452855109479&startPageIndex=0&player-code={playerCode}&_lang_=zh_CN&userId=2107212393&userName=liaolixia&domain=web.nd",coursewareobjectPreviewByMain:systemProperties["editor.server"]+"/ndplayer/temp/show?player-version=&state=&hidePage=toolbar&_lang_=zh_CN&player-code=teacher_test&hidePage=footer&main-url={mainUrl}&domain=",coursewareobjectRoot:systemProperties["cs.server"]+"/v0.1/static/prepub_content_edu_product/esp/coursewareobjects/{id}.pkg",jsLibraryRoot:systemProperties["developer.cs.server"]+"/v0.1/static/"+esp_developer+"/js-library/{name}/{version}",questionEditor:systemProperties["slides.server"]+"/questions/{id}/edit",referencePath:systemProperties["cs.server"]+"/v0.1/static",referenceIconPath:systemProperties["cs.server"]+"/v0.1/static/"+systemProperties["cs.icon_folder"],supports:{asset:!0},external:{coursewareobjectEditorForXm:systemProperties["ceditor-xm.server"]+"/#/{entry}",coursewareobjectEditorForOld:systemProperties["ceditor.server"]+"/#/{entry}",slidesServer:systemProperties["slides.server"]},ready:function(espEnvironment){function findResourceType(template){var types=[];return $.each(templateResourceTypeMapping,function(resourceType,templateCode){templateCode==template.templateCode&&types.push(resourceType)}),types}var editorCode=UrlHelper.analyse().params.editorCode;if(editorCode){var developerServer=systemProperties["developer.server"];return $.get(UrlHelper.root(developerServer)("/v0.1/custom_editors/{0}/latest_config",editorCode)).then(function(result){return $.get(result.config).then(function(config){var coursewareobjectTemplateDefines=[],moduleEditorDefines=[];$.each(config.templates,function(templateCode,template){coursewareobjectTemplateDefines.push($.extend({},template,{href:template.href.replace("${ref-path-addon}",systemProperties["developer.cs.server"]+"/v0.1/static/"+esp_developer),resourceType:findResourceType(template)[0],resourceTypes:findResourceType(template)}))}),$.each(config.editors,function(editorCode,editor){moduleEditorDefines.push($.extend({},editor,{href:editor.href.replace("${ref-path-addon}",systemProperties["developer.cs.server"]+"/v0.1/static/"+esp_developer)}))}),espEnvironment.declareCoursewareobjectTemplate(coursewareobjectTemplateDefines),espEnvironment.declareModuleEditor(moduleEditorDefines)},function(){return $.Deferred().reject("load editorConfig is fail: "+editorCode)})},function(e){return $.Deferred().reject("load editorCode is fail: "+editorCode)})}}}});