define(function(e){return e("jquery"),e("ckeditor-common"),e("ckeditor"),e("lib/messenger/messenger"),["$document","$i18n","$timeout",function(e,t,n){return{restrict:"A",require:"?ngModel",scope:{type:"@lcCkeditor",onCreated:"&",onDataChange:"&"},link:function(e,n,a,i){if("false"!==a.lcCkeditor){var r;if(void 0==e.type||"inline"==e.type?(n&&n.attr("contenteditable",!0),r=CKEDITOR.inline(n[0],{language:t.getLanguage()})):r=CKEDITOR.replace(n[0],{language:t.getLanguage()}),"true"===a.autoFocus&&(CKEDITOR.last_editor=r),!i)return;r.on("instanceReady",function(){var e=i.$viewValue||i.$modelValue||"";"null"==e&&(e=""),r.setData(e)});var o=function(){try{return r.getData()}catch(e){return r.getData()}},s=function(e){try{r.setData(e)}catch(t){r.setData(e)}};r.on("pasteState",function(){if("$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase)e.$apply(function(){var t=o();i.$setViewValue(t),e.onDataChange({data:t,element:n,attrs:a})});else{var t=o();i.$setViewValue(t),e.onDataChange({data:t,element:n,attrs:a})}}),r.on("activeEnterModeChange",function(e){}),i.$render=function(e){s(i.$viewValue)},e.onCreated({name:r.name,ckeditor:r});var u=function(){for(var e=r.element.getText().replace(/(^\s*)|(\s*$)/g,""),t=0,n=0;n<e.length;n++)8203!=e.charCodeAt(n)&&t++;return t};if(a.ndMaxlength){var l=parseInt(a.ndMaxlength),c=function(e){return!isNaN(l)&&!i.$isEmpty(e)&&u()>l?void i.$setValidity("maxlength",!1):(i.$setValidity("maxlength",!0),e)};i.$parsers.push(c),i.$formatters.push(c)}}else a.editorDisable="$all";var d=function(){var e=(a.editorDisable||"").split(",");angular.isFunction(window.disableButtons)&&window.disableButtons(e)};n.on("focus",function(){d()}),a.$observe("editorDisable",function(){document.activeElement==n[0]&&d()}),i.$isEmpty=function(e){return!(!angular.isUndefined(e)&&""!==e&&null!==e&&e===e)||("<p></p>"==(e=e.replace(/(&nbsp;)|\s|(<div class=\"background_image\"[^>]*>)/g,""))||"<p></p></div>"==e||"</div>"==e)}}}}]});