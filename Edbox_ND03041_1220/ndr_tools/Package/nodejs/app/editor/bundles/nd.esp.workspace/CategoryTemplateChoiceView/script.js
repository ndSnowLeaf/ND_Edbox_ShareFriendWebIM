define(["jquery","angular","espEnvironment","i18n!","angular-prompter","angular-slides","css!./style.css"],function($,angular,espEnvironment,i18n){return function(){return{name:"nd.esp.workspace.CategoryTemplateChoiceView",title:i18n.translate("courseware.template.select"),render:function(view,viewConfig){angular.quickstart(view.element,{templateUrl:"bundles/nd.esp.workspace/CategoryTemplateChoiceView/template.html",controller:["$scope","$prompter","$q","$timeout",function($scope,$prompter,$q,$timeout){$scope.categories=[];var categories=viewConfig.categories?angular.isArray(viewConfig.categories)?viewConfig.categories:[viewConfig.categories]:[];angular.forEach(categories,function(c){var category=angular.extend({title:i18n.translate("resource.type.unknown"),order:1,getTemplateList:function(){return[]},createByTemplate:function(template){}},c);$scope.categories.push(category)}),$scope.categories.sort(function(a,b){var a=parseFloat(a.order),b=parseFloat(b.order);return(isNaN(a)?1:a)-(isNaN(b)?1:b)}),angular.forEach($scope.categories,function(category){$q.proxy(category.getTemplateList()).then(angular.bind(category,function(templates){this.templates=templates||[]}))}),$scope.choice=function(category,template){$q.proxy(category.createByTemplate(template)).then(function(result){var categoryExplorerView=view.workbench.getView("nd.esp.workspace.CategoryExplorerView");"string"==typeof result?categoryExplorerView?$prompter.error(i18n.translate("courseware.edit.unkowntype")):window.location.href=result:result?categoryExplorerView?categoryExplorerView.ctrl.addData(category.name,result,!0):window.location.href="/?id="+result.id+"&editorCode="+(espEnvironment.location.params.editorCode||""):$prompter.error($i19n("courseware.create.emptyresponse")+template.templateCode)},$prompter.errorIf()).finally($prompter.wait(i18n.translate("courseware.creating")))}}]},["slides","prompter"])}}}});