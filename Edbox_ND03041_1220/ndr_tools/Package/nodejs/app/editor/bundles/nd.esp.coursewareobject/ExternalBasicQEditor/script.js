define(["jquery","i18n!","espEnvironment","prompter","css!./style.css"],function($,i18n,espEnvironment,prompter){var templates={preview:'<div class="slides-coursewareobject-external-basic-q-preview"></div>',editor:'<div class="slides-coursewareobject-external-basic-q-editor">'},embedUrl=espEnvironment.url.questionEditor();return window.addEventListener("message",function(event){0==embedUrl.indexOf(event.origin)&&(console.debug("proxy message send for basic question editor: ",event.data),window.parent!=window&&window.parent.postMessage(event.data,"*"))}),function(){this.name="nd.esp.coursewareobject.ExternalBasicQEditor",this.supportTypes=["coursewareobject"],this.render=function(editor,resource,config){function renderPreview(){previewRendered||(previewRendered=!0,$("<iframe></iframe>").appendTo(previewEl));var mainUrl=resource.data.tech_info&&resource.data.tech_info.nd_href&&resource.data.tech_info.nd_href.location;previewEl.children("iframe").attr("src",espEnvironment.url.coursewareobjectPreviewByMain(mainUrl,config&&config.playerCode))}function renderEditor(){function resetSize(){var width=editorEl.width(),height=editorEl.height(),scale=Math.min(width/1600,height/1e3);editorEl.children("._body").css("transform","scale("+scale+")")}if(!editorRendered){editorRendered=!0,setTimeout(function(){resetSize()},0),$(window).resize(resetSize);resource.data;editorEl.html('<iframe src="'+espEnvironment.url.questionEditor(resource.key)+'"></iframe>')}}this.title=resource.data.title;var previewEl=$(templates.preview).appendTo(editor.element).hide(),editorEl=$(templates.editor).appendTo(editor.element).hide(),previewRendered=!1,editorRendered=!1;editor.toolbar.add([{name:"edit",label:i18n.translate("view.toolbar.edit"),visible:config&&!0===config.defaultPreview,handle:function(tb){tb.toggle("preview",!0),tb.toggle("edit",!1),editorEl.show(),previewEl.hide(),renderEditor()}},{name:"preview",label:i18n.translate("view.toolbar.preview"),visible:!config||!0!==config.defaultPreview,handle:function(tb){tb.toggle("edit",!0),tb.toggle("preview",!1),editorEl.hide(),previewEl.show(),renderPreview()}}]),config&&!0===config.defaultPreview?(previewEl.show(),renderPreview()):(editorEl.show(),renderEditor())}}});