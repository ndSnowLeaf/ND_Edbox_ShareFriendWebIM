define(["require","jquery","espEnvironment","espService","espModel","prompter","i18n!"],function(require,$,espEnvironment,espService,espModel,prompter,i18n){function getCreatorConfig(templateIdentifier){var deferred=$.Deferred(),coursewareobjectTemplateRepository=espModel.repository.coursewareobjectTemplate(templateIdentifier);return null==coursewareobjectTemplateRepository?deferred.reject(i18n.translate("server.error.template.missing")+templateIdentifier):requirejs([coursewareobjectTemplateRepository.getResourceUrl("creator-config.js")],function(creatorConfig){deferred.resolve(creatorConfig)},function(){deferred.resolve(null)}),deferred.promise()}var defaultCreatorConfig={creatorType:"general"};return{doCreate:function(templateIdentifier,config){var deferred=new $.Deferred;return getCreatorConfig(templateIdentifier).then(function(creatorConfig){creatorConfig||(creatorConfig=defaultCreatorConfig),"string"==typeof creatorConfig&&(creatorConfig={creatorType:creatorConfig}),creatorConfig.creatorType||(creatorConfig.creatorType=defaultCreatorConfig.creatorType),require(["./implements/"+creatorConfig.creatorType+".js"],function(customization){var result=customization($.extend({$template:templateIdentifier},creatorConfig,config));$.when(result).then(function(r){deferred.resolve(r)},function(e){deferred.reject(e)})},function(e){deferred.reject(i18n.translate("courseware.error.creator.notfound",creatorConfig.creatorType))})},function(e){deferred.reject(e)}),deferred.promise()}}});