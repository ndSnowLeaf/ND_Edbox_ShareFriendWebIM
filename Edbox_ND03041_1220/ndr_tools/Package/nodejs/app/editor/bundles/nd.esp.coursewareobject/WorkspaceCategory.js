define(["jquery","espEnvironment","espService","./CreatorCustomization/dispatcher","./EditorCustomization/dispatcher"],function($,espEnvironment,espService,CreatorCustomization,EditorCustomization){function adjustData(metadata,type){var item={id:metadata.identifier,title:metadata.title,description:metadata.description,metadata:metadata};if(metadata.preview)for(var key in metadata.preview)if(item.thumbHref=urlResolver.parse(metadata.preview[key]),"120"===key||"240"===key)break;return item.thumbHref,item}var urlResolver=espEnvironment.createReferenceUrlResolver();return function(name,type,category,title,icon){return{name:name||"coursewareobject-"+type,title:title,icon:icon,order:1,paging:15,getDataList:function(params){return espService.coursewareobject.list($.extend({type:type},params)).then(function(result){for(var items=[],i=0;i<result.items.length;i++)items.push(adjustData(result.items[i],type));return{total_count:result.total_count,items:items}})},getTemplateList:function(){return espService.coursewareobjectTemplate.list(category)},createByTemplate:function(template){return CreatorCustomization.doCreate(template.templateCode).then(function(result){return result&&"string"!=typeof result?adjustData(result,type):result})},openEditor:function(workbench,data,isNewly){EditorCustomization.doEdit(workbench,data.metadata,{defaultPreview:!isNewly})}}}});