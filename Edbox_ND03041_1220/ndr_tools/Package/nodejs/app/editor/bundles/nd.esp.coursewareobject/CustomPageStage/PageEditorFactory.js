define(["jquery","espEnvironment","require","i18n!"],function($,espEnvironment,requirejs,i18n){function PageEditor(editorDef){this.init=function(page,config){},this.render=function(contentEl){},this.clean=function(contentEl){},this.save=function(){},this.destroy=function(){},$.extend(this,editorDef)}function ErrorPageEditorDef(editorId,message,cause){this.render=function(contentEl){var backgroundEl=$('<div class="slides-page-error-content"></div>').appendTo(contentEl);$('<div class="_image"></div>').appendTo(backgroundEl);$("<p></p>").appendTo(backgroundEl).text(message+"--\x3e"+cause)}}function PageEditorConfig(config){config||(config={}),this._i18n=config.i18n}function ErrorPageEditorConfig(lang){return new PageEditorConfig}function getEditorDef(editorId){var deferred=$.Deferred();return requirejs(["./implements/"+editorId+"/script.js"],function(editorDef){deferred.resolve(editorDef)},function(error){deferred.reject(i18n.translate("courseware.error.editor.notfound",editorId)+error)}),deferred.promise()}function getEditorConfig(editorId){var deferred=$.Deferred();return requirejs(["i18n!./implements/"+editorId+"/i18n"],function(i18n){deferred.resolve(new PageEditorConfig({i18n:i18n}))}),deferred.promise()}return Object.defineProperties(PageEditorConfig.prototype,{i18n:{get:function(){return this._i18n}}}),{create:function(editorId){return $.when(getEditorDef(editorId),getEditorConfig(editorId)).then(function(editorDef,editorConfig){try{$.isFunction(editorDef)&&(editorDef=new editorDef);var editor=new PageEditor(editorDef);return[editor,editorConfig]}catch(e){var errorMessage=i18n.translate("courseware.error.editor.create",editorId);console.error(errorMessage,e);var editor=new PageEditor(new ErrorPageEditorDef(editorId,errorMessage,e));return[editor,new ErrorPageEditorConfig]}},function(error){var errorMessage=i18n.translate("courseware.error.editor.loading");console.error(errorMessage,error);var editor=new PageEditor(new ErrorPageEditorDef(editorId,errorMessage,error));return $.when([editor,new ErrorPageEditorConfig])})}}});