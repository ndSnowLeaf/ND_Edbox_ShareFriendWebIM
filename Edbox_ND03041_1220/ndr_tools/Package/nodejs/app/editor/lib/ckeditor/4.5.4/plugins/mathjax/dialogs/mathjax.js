CKEDITOR.dialog.add("mathjax",function(editor){function getIFrame(){return this.getElement().getFirst().$}function getIFrameSrc(){return CKEDITOR.basePath+"plugins/kityformula/dialogs/kityformula-mathjax.html?lang="+language+"&f="+(new Date).valueOf()}function existPlaceholder(latex){return latex.trim().indexOf("\\placeholder")>-1}var lang=editor.lang.mathjax,language=editor.config.language;return{title:lang.title,minWidth:1100,minHeight:400,resizable:CKEDITOR.DIALOG_RESIZE_NONE,contents:[{id:"editor-tab",elements:[{id:"editor-element",type:"html",html:'<div><iframe style="width:1100px;height:400px;" frameborder="no" scrolling="no" src="'+getIFrameSrc()+'"></iframe></div>',setup:function(widget){var iframeWindow=(CKEDITOR.dialog.okButton,getIFrame.call(this).contentWindow);iframeWindow.parent.currentLatex=CKEDITOR.plugins.mathjax.trim(widget.data.math),iframeWindow.location.replace(getIFrameSrc())},validate:function(){return!existPlaceholder(getIFrame.call(this).contentWindow.getLatexData())||(alert(lang.alert),!1)},commit:function(widget){var latex=getIFrame.call(this).contentWindow.getLatexData();widget.setData("math","\\("+latex+"\\)")}}]}],onOk:function(){var dialog=this;return!existPlaceholder(getIFrame.call(dialog.getContentElement("editor-tab","editor-element")).contentWindow.getLatexData())}}});