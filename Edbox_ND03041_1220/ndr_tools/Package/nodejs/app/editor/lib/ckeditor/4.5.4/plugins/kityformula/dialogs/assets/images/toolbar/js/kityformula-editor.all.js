!function(){function use(name){_p.r([moduleMapping[name]])}var _p={r:function(index){if(_p[index].inited)return _p[index].value;if("function"!=typeof _p[index].value)return _p[index].inited=!0,_p[index].value;var module={exports:{}},returnValue=_p[index].value(null,module.exports,module);if(_p[index].inited=!0,_p[index].value=returnValue,void 0!==returnValue)return returnValue;for(var key in module.exports)if(module.exports.hasOwnProperty(key))return _p[index].inited=!0,_p[index].value=module.exports,module.exports}};_p[0]={value:function(require){function copy(isDeep,target,source,count){return(count|=0)>MAX_COPY_DEEP?source:(count++,commonUtils.each(source,function(value,index,origin){isDeep?!value||"object"!=typeof value&&"function"!=typeof value?target[index]=value:(target[index]=target[index]||(commonUtils.isArray(value)?[]:{}),target[index]=copy(isDeep,target[index],value,count)):target[index]=value}),target)}var MAX_COPY_DEEP=10,commonUtils={extend:function(target,source){var isDeep=!1;if("boolean"==typeof target?(isDeep=target,target=source,source=[].splice.call(arguments,2)):source=[].splice.call(arguments,1),!target)throw new Error("Utils: extend, target can not be empty");return commonUtils.each(source,function(src){(src&&"object"==typeof src||"function"==typeof src)&&copy(isDeep,target,src)}),target},contains:function(parent,target){return parent.contains?parent.contains(target):parent.compareDocumentPosition?!!(16&parent.compareDocumentPosition(target)):void 0},getRect:function(node){return node.getBoundingClientRect()},isArray:function(obj){return obj&&"[object Array]"==={}.toString.call(obj)},isString:function(obj){return"string"==typeof obj},proxy:function(fn,context){return function(){return fn.apply(context,arguments)}},each:function(obj,fn){if(obj)if("length"in obj&&"number"==typeof obj.length)for(var i=0,len=obj.length;i<len&&!1!==fn.call(null,obj[i],i,obj);i++);else for(var key in obj)if(obj.hasOwnProperty(key)&&!1===fn.call(null,obj[key],key,obj))break}};return commonUtils}},_p[1]={value:function(require){return _p.r(21).createClass("Component",{constructor:function(){}})}},_p[2]={value:function(require,exports,modules){function generateId(){return++eid}var EVENT_LISTENER={},eid=0,BEFORE_RESULT=!0,KFEvent=_p.r(3),commonUtils=_p.r(0),EVENT_HANDLER=function(e){var type=e.type,target=e.target,eid=this.__kfe_eid,hasAutoTrigger=/^(?:before|after)/.test(type),HANDLER_LIST=EVENT_LISTENER[eid][type];if(!hasAutoTrigger&&(EventListener.trigger(target,"before"+type),!1===BEFORE_RESULT))return BEFORE_RESULT=!0,!1;commonUtils.each(HANDLER_LIST,function(handler,index){if(handler)return!1===handler.call(target,e)?BEFORE_RESULT=!1:void 0}),hasAutoTrigger||EventListener.trigger(target,"after"+type)},EventListener={addEvent:function(target,type,handler){var hasHandler=!0,eventCache=null;target.__kfe_eid||(hasHandler=!1,target.__kfe_eid=generateId(),EVENT_LISTENER[target.__kfe_eid]={}),eventCache=EVENT_LISTENER[target.__kfe_eid],eventCache[type]||(hasHandler=!1,eventCache[type]=[]),eventCache[type].push(handler),hasHandler||target.addEventListener(type,EVENT_HANDLER,!1)},trigger:function(target,type,e){e=e||KFEvent.createEvent(type,e),target.dispatchEvent(e)}};return EventListener}},_p[3]={value:function(require){return{createEvent:function(type,e){var evt=document.createEvent("Event");return evt.initEvent(type,!0,!0),evt}}}},_p[4]={value:function(require){function clearLatex(latex){return latex.replace(/\\placeholder/gi,"").replace(Sysconf.cursorCharacter,"")}var jQuery=_p.r(15),Sysconf=_p.r(30);return{triggerPreview:function(latex){jQuery.event.trigger("preview.latex",latex)},bindPreview:function(handler){jQuery(document).bind("preview.latex",function(event,latex){handler&&handler(clearLatex(latex))})}}}},_p[5]={value:function(require){var Utils={},commonUtils=_p.r(0);return commonUtils.extend(Utils,commonUtils,_p.r(2)),Utils}},_p[6]={value:function(require){var kity=_p.r(21),ListenerComponent=_p.r(9);return kity.createClass("ControllerComponent",{constructor:function(kfEditor){this.kfEditor=kfEditor,this.components={},this.initComponents()},initComponents:function(){this.components.listener=new ListenerComponent(this,this.kfEditor)}})}},_p[7]={value:function(require){var LIST={32:"\\,","s+219":"\\{","s+221":"\\}",220:"\\backslash","s+51":"\\#","s+52":"\\$","s+53":"\\%","s+54":"\\^","s+55":"\\&","s+189":"\\_","s+192":"\\~"};return{getReplaceString:function(key){return LIST[key]||null}}}},_p[8]={value:function(require,exports,module){var kity=_p.r(21),kfUtils=_p.r(5),InputFilter=_p.r(7),PreviewUtils=_p.r(4),KEY_CODE={LEFT:37,RIGHT:39,DELETE:8,INPUT:229};return kity.createClass("InputComponent",{constructor:function(parentComponent,kfEditor){this.parentComponent=parentComponent,this.kfEditor=kfEditor,this.inputBox=this.createInputBox(),this.initServices(),this.initCommands(),this.initEvent()},initServices:function(){this.kfEditor.registerService("control.update.input",this,{updateInput:this.updateInput}),this.kfEditor.registerService("control.insert.string",this,{insertStr:this.insertStr})},initCommands:function(){this.kfEditor.registerCommand("focus",this,this.focus)},createInputBox:function(){var editorContainer=this.kfEditor.getContainer(),box=this.kfEditor.getDocument().createElement("input");return box.className="kf-editor-input-box",box.type="text",box.isTrusted=!1,editorContainer.appendChild(box),box},focus:function(){var rootInfo=null;this.inputBox.focus(),this.kfEditor.requestService("syntax.has.cursor.info")||(rootInfo=this.kfEditor.requestService("syntax.get.root.group.info"),this.kfEditor.requestService("syntax.update.record.cursor",{groupId:rootInfo.id,startOffset:0,endOffset:rootInfo.content.length}),this.kfEditor.requestService("control.update.input")),this.kfEditor.requestService("control.reselect")},setUntrusted:function(){this.inputBox.isTrusted=!1},setTrusted:function(){this.inputBox.isTrusted=!0},updateInput:function(){var latexInfo=this.kfEditor.requestService("syntax.serialization");this.setUntrusted(),this.inputBox.value=latexInfo.str,this.inputBox.selectionStart=latexInfo.startOffset,this.inputBox.selectionEnd=latexInfo.endOffset,this.inputBox.focus(),this.setTrusted()},insertStr:function(str){var latexInfo=this.kfEditor.requestService("syntax.serialization"),originString=latexInfo.str;originString=originString.substring(0,latexInfo.startOffset)+" "+str+" "+originString.substring(latexInfo.endOffset),this.restruct(originString),this.updateInput(),this.kfEditor.requestService("ui.update.canvas.view"),this.preview(originString)},initEvent:function(){var _self=this;kfUtils.addEvent(this.inputBox,"keydown",function(e){var isControl=!1;if(e.ctrlKey)return void _self.processUserCtrl(e);switch(e.keyCode){case KEY_CODE.INPUT:return;case KEY_CODE.LEFT:e.preventDefault(),_self.leftMove(),isControl=!0;break;case KEY_CODE.RIGHT:e.preventDefault(),_self.rightMove(),isControl=!0;break;case KEY_CODE.DELETE:e.preventDefault(),_self.delete(),isControl=!0}isControl&&_self.kfEditor.requestService("ui.update.canvas.view"),_self.pretreatmentInput(e)||e.preventDefault()}),kfUtils.addEvent(this.inputBox,"input",function(e){_self.processingInput()}),kfUtils.addEvent(this.inputBox,"blur",function(e){_self.kfEditor.requestService("ui.toolbar.disable"),_self.kfEditor.requestService("ui.toolbar.close"),_self.kfEditor.requestService("control.cursor.hide"),_self.kfEditor.requestService("render.clear.select")}),kfUtils.addEvent(this.inputBox,"focus",function(e){_self.kfEditor.requestService("ui.toolbar.enable"),this.isTrusted&&_self.kfEditor.requestService("control.reselect")}),kfUtils.addEvent(this.inputBox,"paste",function(e){e.preventDefault()})},hasRootplaceholder:function(){return this.kfEditor.requestService("syntax.has.root.placeholder")},leftMove:function(){this.hasRootplaceholder()||(this.kfEditor.requestService("syntax.cursor.move.left"),this.update())},rightMove:function(){this.hasRootplaceholder()||(this.kfEditor.requestService("syntax.cursor.move.right"),this.update())},delete:function(){var isNeedRedraw=null;this.hasRootplaceholder()||(isNeedRedraw=this.kfEditor.requestService("syntax.delete.group"),isNeedRedraw?(this.updateInput(),this.processingInput()):(this.updateInput(),this.kfEditor.requestService("control.reselect")))},processUserCtrl:function(e){switch(e.preventDefault(),e.keyCode){case 65:this.kfEditor.requestService("control.select.all");break;case 83:this.kfEditor.requestService("print.image")}},pretreatmentInput:function(evt){var keyCode=this.getKeyCode(evt),replaceStr=InputFilter.getReplaceString(keyCode);return null===replaceStr||(this.insertStr(replaceStr),!1)},getKeyCode:function(e){return(e.shiftKey?"s+":"")+e.keyCode},processingInput:function(){this.restruct(this.inputBox.value),this.kfEditor.requestService("ui.update.canvas.view"),this.preview(this.inputBox.value)},restruct:function(latexStr){this.kfEditor.requestService("render.draw",latexStr),this.kfEditor.requestService("control.reselect")},update:function(){this.updateInput(),this.kfEditor.requestService("control.reselect")},preview:function(latex){PreviewUtils.triggerPreview(latex)}})}},_p[9]={value:function(require,exports,module){var kity=_p.r(21),LocationComponent=_p.r(10),InputComponent=_p.r(8),SelectionComponent=_p.r(11);return kity.createClass("MoveComponent",{constructor:function(parentComponent,kfEditor){this.parentComponent=parentComponent,this.kfEditor=kfEditor,this.components={},this.initComponents()},initComponents:function(){this.components.location=new LocationComponent(this,this.kfEditor),this.components.selection=new SelectionComponent(this,this.kfEditor),this.components.input=new InputComponent(this,this.kfEditor)}})}},_p[10]={value:function(require,exports,module){function getRect(node){return node.getBoundingClientRect()}var kity=_p.r(21);return kity.createClass("LocationComponent",{constructor:function(parentComponent,kfEditor){this.parentComponent=parentComponent,this.kfEditor=kfEditor,this.paper=this.getPaper(),this.cursorShape=this.createCursor(),this.initServices(),this.initEvent()},getPaper:function(){return this.kfEditor.requestService("render.get.paper")},initServices:function(){this.kfEditor.registerService("control.cursor.relocation",this,{relocationCursor:this.updateCursor}),this.kfEditor.registerService("control.cursor.hide",this,{hideCursor:this.hideCursor}),this.kfEditor.registerService("control.reselect",this,{reselect:this.reselect}),this.kfEditor.registerService("control.get.cursor.location",this,{getCursorLocation:this.getCursorLocation})},createCursor:function(){var cursorShape=new kity.Rect(1,0,0,0).fill("black");return cursorShape.setAttr("style","display: none"),this.paper.addShape(cursorShape),cursorShape},initEvent:function(){var eventServiceObject=this.kfEditor.request("ui.canvas.container.event"),_self=this;eventServiceObject.on("mousedown",function(e){e.preventDefault(),_self.updateCursorInfo(e),_self.kfEditor.requestService("control.update.input"),_self.reselect()})},updateCursorInfo:function(evt){var wrapNode=null,groupInfo=null,index=-1;return this.kfEditor.requestService("syntax.has.root.placeholder")?(this.kfEditor.requestService("syntax.update.record.cursor",{groupId:this.kfEditor.requestService("syntax.get.root.group.info").id,startOffset:0,endOffset:1}),!1):(wrapNode=this.kfEditor.requestService("position.get.wrap",evt.target))&&this.kfEditor.requestService("syntax.is.placeholder.node",wrapNode.id)?(groupInfo=this.kfEditor.requestService("position.get.group.info",wrapNode),void this.kfEditor.requestService("syntax.update.record.cursor",groupInfo.group.id,groupInfo.index,groupInfo.index+1)):(groupInfo=this.kfEditor.requestService("position.get.group",evt.target),null===groupInfo&&(groupInfo=this.kfEditor.requestService("syntax.get.root.group.info")),index=this.getIndex(evt.clientX,groupInfo),void this.kfEditor.requestService("syntax.update.record.cursor",groupInfo.id,index))},hideCursor:function(){this.cursorShape.setAttr("style","display: none")},reselect:function(){var cursorInfo=this.kfEditor.requestService("syntax.get.record.cursor"),groupInfo=null;if(this.hideCursor(),this.kfEditor.requestService("syntax.is.select.placeholder"))return groupInfo=this.kfEditor.requestService("syntax.get.group.content",cursorInfo.groupId),void this.kfEditor.requestService("render.select.group",groupInfo.content[cursorInfo.startOffset].id);cursorInfo.startOffset===cursorInfo.endOffset?(this.updateCursor(),this.kfEditor.requestService("render.tint.current.cursor")):this.kfEditor.requestService("render.select.current.cursor")},updateCursor:function(){var cursorInfo=this.kfEditor.requestService("syntax.get.record.cursor");if(cursorInfo.startOffset!==cursorInfo.endOffset)return void this.hideCursor();var groupInfo=this.kfEditor.requestService("syntax.get.group.content",cursorInfo.groupId),isBefore=0===cursorInfo.endOffset,index=isBefore?0:cursorInfo.endOffset-1,focusChild=groupInfo.content[index],paperContainerRect=getRect(this.paper.container.node),cursorOffset=0,focusChildRect=getRect(focusChild),cursorTransform=this.cursorShape.getTransform(this.cursorShape),canvasZoom=this.kfEditor.requestService("render.get.canvas.zoom"),formulaZoom=this.paper.getZoom();this.cursorShape.setHeight(focusChildRect.height/canvasZoom/formulaZoom),cursorOffset=isBefore?focusChildRect.left-2:focusChildRect.left+focusChildRect.width-2,cursorOffset-=paperContainerRect.left,cursorTransform.m.e=Math.floor(cursorOffset/canvasZoom/formulaZoom)+.5,cursorTransform.m.f=(focusChildRect.top-paperContainerRect.top)/canvasZoom/formulaZoom,this.cursorShape.setMatrix(cursorTransform),this.cursorShape.setAttr("style","display: block")},getCursorLocation:function(){var rect=this.cursorShape.getRenderBox("paper");return{x:rect.x,y:rect.y}},getIndex:function(distance,groupInfo){for(var index=-1,children=groupInfo.content,boundingRect=null,i=children.length-1,child=null;i>=0;i--)if(index=i,child=children[i],boundingRect=getRect(child),boundingRect.left<distance){boundingRect.left+boundingRect.width/2<distance&&(index+=1);break}return index}})}},_p[11]={value:function(require,exports,module){var kity=_p.r(21),kfUtils=_p.r(5);return kity.createClass("SelectionComponent",{constructor:function(parentComponent,kfEditor){this.parentComponent=parentComponent,this.kfEditor=kfEditor,this.isDrag=!1,this.isMousedown=!1,this.startPoint={x:-1,y:-1},this.startGroupIsPlaceholder=!1,this.startGroup={},this.initServices(),this.initEvent()},initServices:function(){this.kfEditor.registerService("control.select.all",this,{selectAll:this.selectAll})},initEvent:function(){var eventServiceObject=this.kfEditor.request("ui.canvas.container.event"),_self=this;eventServiceObject.on("mousedown",function(e){if(e.preventDefault(),_self.kfEditor.requestService("syntax.has.root.placeholder"))return!1;_self.isMousedown=!0,_self.updateStartPoint(e.clientX,e.clientY),_self.updateStartGroup()}),eventServiceObject.on("mouseup",function(e){e.preventDefault(),_self.stopUpdateSelection()}),eventServiceObject.on("mousemove",function(e){if(e.preventDefault(),_self.isDrag){if(1!==e.which)return void _self.stopUpdateSelection();_self.updateSelection(e.target,e.clientX,e.clientY)}else _self.isMousedown&&10<_self.getDistance(e.clientX,e.clientY)&&(_self.kfEditor.requestService("control.cursor.hide"),_self.startUpdateSelection())}),eventServiceObject.on("dblclick",function(e){_self.updateSelectionByTarget(e.target)})},getDistance:function(x,y){var distanceX=Math.abs(x-this.startPoint.x),distanceY=Math.abs(y-this.startPoint.y);return Math.max(distanceX,distanceY)},updateStartPoint:function(x,y){this.startPoint.x=x,this.startPoint.y=y},updateStartGroup:function(){var cursorInfo=this.kfEditor.requestService("syntax.get.record.cursor");this.startGroupIsPlaceholder=this.kfEditor.requestService("syntax.is.select.placeholder"),this.startGroup={groupInfo:this.kfEditor.requestService("syntax.get.group.content",cursorInfo.groupId),offset:cursorInfo.startOffset}},startUpdateSelection:function(){this.isDrag=!0,this.isMousedown=!1,this.clearSelection()},stopUpdateSelection:function(){this.isDrag=!1,this.isMousedown=!1,this.kfEditor.requestService("control.update.input")},clearSelection:function(){this.kfEditor.requestService("render.clear.select")},updateSelection:function(target,x,y){var dir=x>this.startPoint.x,cursorInfo={},communityGroupInfo=null,inRightArea=!1,startGroupInfo=this.startGroup,currentGroupNode=null,currentGroupInfo=this.getGroupInof(x,target);currentGroupInfo.groupInfo.id===startGroupInfo.groupInfo.id?(cursorInfo={groupId:currentGroupInfo.groupInfo.id,startOffset:startGroupInfo.offset,endOffset:currentGroupInfo.offset},this.startGroupIsPlaceholder&&(dir?cursorInfo.startOffset===cursorInfo.endOffset&&(cursorInfo.endOffset+=1):cursorInfo.startOffset+=1)):kfUtils.contains(startGroupInfo.groupInfo.groupObj,currentGroupInfo.groupInfo.groupObj)?cursorInfo={groupId:startGroupInfo.groupInfo.id,startOffset:startGroupInfo.offset,endOffset:this.getIndex(startGroupInfo.groupInfo.groupObj,target,x)}:kfUtils.contains(currentGroupInfo.groupInfo.groupObj,startGroupInfo.groupInfo.groupObj)?(cursorInfo={groupId:currentGroupInfo.groupInfo.id,startOffset:this.kfEditor.requestService("position.get.index",currentGroupInfo.groupInfo.groupObj,startGroupInfo.groupInfo.groupObj),endOffset:currentGroupInfo.offset},dir||(cursorInfo.startOffset+=1)):(communityGroupInfo=this.getCommunityGroup(startGroupInfo.groupInfo,currentGroupInfo.groupInfo),communityGroupInfo.startOffset===communityGroupInfo.endOffset?communityGroupInfo.endOffset+=1:(currentGroupNode=communityGroupInfo.group.content[communityGroupInfo.endOffset],inRightArea=this.kfEditor.requestService("position.get.area",currentGroupNode,x),inRightArea&&(communityGroupInfo.endOffset+=1),dir||(communityGroupInfo.startOffset+=1)),cursorInfo={groupId:communityGroupInfo.group.id,startOffset:communityGroupInfo.startOffset,endOffset:communityGroupInfo.endOffset}),this.kfEditor.requestService("syntax.update.record.cursor",cursorInfo.groupId,cursorInfo.startOffset,cursorInfo.endOffset),this.kfEditor.requestService("control.reselect")},updateSelectionByTarget:function(target){var parentGroupInfo=this.kfEditor.requestService("position.get.parent.group",target),containerInfo=null,cursorInfo={};if(null!==parentGroupInfo){if(this.kfEditor.requestService("syntax.is.root.node",parentGroupInfo.id))return void this.selectAll();this.kfEditor.requestService("syntax.is.virtual.node",parentGroupInfo.id)?(containerInfo=this.kfEditor.requestService("position.get.group.info",parentGroupInfo.groupObj),cursorInfo={groupId:containerInfo.group.id,startOffset:containerInfo.index,endOffset:containerInfo.index+1}):cursorInfo={groupId:parentGroupInfo.id,startOffset:0,endOffset:parentGroupInfo.content.length},this.kfEditor.requestService("syntax.update.record.cursor",cursorInfo),this.kfEditor.requestService("control.reselect"),this.kfEditor.requestService("control.update.input")}},selectAll:function(){var rootGroupInfo=this.kfEditor.requestService("syntax.get.root.group.info"),cursorInfo={groupId:rootGroupInfo.id,startOffset:0,endOffset:rootGroupInfo.content.length};this.kfEditor.requestService("syntax.update.record.cursor",cursorInfo),this.kfEditor.requestService("control.reselect"),this.kfEditor.requestService("control.update.input")},getGroupInof:function(offset,target){var groupInfo=this.kfEditor.requestService("position.get.group",target);return null===groupInfo&&(groupInfo=this.kfEditor.requestService("syntax.get.root.group.info")),{groupInfo:groupInfo,offset:this.kfEditor.requestService("position.get.location.info",offset,groupInfo)}},getIndex:function(groupNode,targetNode,offset){var index=this.kfEditor.requestService("position.get.index",groupNode,targetNode),groupInfo=this.kfEditor.requestService("syntax.get.group.content",groupNode.id),targetWrapNode=groupInfo.content[index],targetRect=kfUtils.getRect(targetWrapNode);return targetRect.left+targetRect.width/2<offset&&(index+=1),index},getCommunityGroup:function(startGroupInfo,endGroupInfo){for(var bigBoundingGroup=null,targetGroup=startGroupInfo.groupObj,groupNode=null;(bigBoundingGroup=this.kfEditor.requestService("position.get.group.info",targetGroup))&&(targetGroup=bigBoundingGroup.group.groupObj,!kfUtils.contains(bigBoundingGroup.group.groupObj,endGroupInfo.groupObj)););return groupNode=bigBoundingGroup.group.groupObj,{group:bigBoundingGroup.group,startOffset:bigBoundingGroup.index,endOffset:this.kfEditor.requestService("position.get.index",groupNode,endGroupInfo.groupObj)}}})}},_p[12]={value:function(){return{GROUP:"kf-editor-group",VIRTUAL:"kf-editor-virtual-group"}}},_p[13]={value:function(require){function getService(serviceName){var serviceObject=this.services[serviceName];if(!serviceObject)throw new Error("KFEditor: not found service, "+serviceName);return serviceObject}var kity=_p.r(21),Utils=_p.r(5),defaultOpt={formula:{fontsize:50,autoresize:!1},ui:{zoom:!0,maxzoom:2,minzoom:1}},COMPONENTS={},ResourceManager=_p.r(20).ResourceManager,KFEditor=kity.createClass("KFEditor",{constructor:function(container,opt){this.options=Utils.extend(!0,{},defaultOpt,opt),this.FormulaClass=null,this._readyState=!1,this._callbacks=[],this.container=container,this.services={},this.commands={},this.initResource()},isReady:function(){return!!this._readyState},triggerReady:function(){for(var cb=null,_self=this;cb=this._callbacks.shift();)cb.call(_self,_self)},ready:function(cb){this._readyState?cb.call(this,this):this._callbacks.push(cb)},getContainer:function(){return this.container},getDocument:function(){return this.container.ownerDocument},getFormulaClass:function(){return this.FormulaClass},getOptions:function(){return this.options},initResource:function(){var _self=this;ResourceManager.ready(function(Formula){_self.FormulaClass=Formula,_self.initComponents(),_self._readyState=!0,_self.triggerReady()},this.options.resource)},initComponents:function(){var _self=this;Utils.each(COMPONENTS,function(Component,name){new Component(_self,_self.options[name])})},requestService:function(serviceName,args){var serviceObject=getService.call(this,serviceName);return serviceObject.service[serviceObject.key].apply(serviceObject.provider,[].slice.call(arguments,1))},request:function(serviceName){return getService.call(this,serviceName).service},registerService:function(serviceName,provider,serviceObject){var key=null;for(key in serviceObject)serviceObject[key]&&serviceObject.hasOwnProperty(key)&&(serviceObject[key]=Utils.proxy(serviceObject[key],provider));this.services[serviceName]={provider:provider,key:key,service:serviceObject}},registerCommand:function(commandName,executor,execFn){this.commands[commandName]={executor:executor,execFn:execFn}},execCommand:function(commandName,args){var commandObject=this.commands[commandName];if(!commandObject)throw new Error("KFEditor: not found command, "+commandName);return commandObject.execFn.apply(commandObject.executor,[].slice.call(arguments,1))}});return Utils.extend(KFEditor,{registerComponents:function(name,component){COMPONENTS[name]=component}}),KFEditor}},_p[14]={value:function(require){function EditorWrapper(container,options){var _self=this;this._callbacks=[],this.editor=new KFEditor(container,options),this.editor.ready(function(){_self._trigger()})}var kity=_p.r(21),KFEditor=_p.r(13),PreviewUtils=_p.r(4);return EditorWrapper.prototype._trigger=function(){var editor=this.editor;kity.Utils.each(this._callbacks,function(cb){cb.call(editor,editor)})},EditorWrapper.prototype.ready=function(cb){this.editor.isReady()?cb.call(this.editor,this.editor):this._callbacks.push(cb)},EditorWrapper.prototype.preview=function(callback){PreviewUtils.bindPreview(callback)},{create:function(container,options){return new EditorWrapper(container,options)}}}},_p[15]={value:function(){return window.jQuery}},_p[16]={value:function(){return{selectColor:"rgba(42, 106, 189, 0.2)",allSelectColor:"rgba(42, 106, 189, 0.6)"}}},_p[17]={value:function(require,exports,module){var kity=_p.r(21),kf=_p.r(20),PlaceholderOperator=_p.r(19);return kity.createClass("PlaceholderExpression",{base:kf.CompoundExpression,constructor:function(){this.callBase(),this.setFlag("Placeholder"),this.label=null,this.box.setAttr("data-type",null),this.setOperator(new PlaceholderOperator)},setLabel:function(label){this.label=label},getLabel:function(){return this.label},setAttr:function(key,val){"label"===key?this.setLabel(val):(key.label&&(this.setLabel(key.label),delete key.label),this.callBase(key,val))},select:function(){this.getOperator().select()},selectAll:function(){this.getOperator().selectAll()},unselect:function(){this.getOperator().unselect()}})}},_p[18]={value:function(require){function ext(parser){kf.PlaceholderExpression=_p.r(17),kf.Expression.prototype.select=function(){this.box.fill(SELECT_COLOR)},kf.Expression.prototype.selectAll=function(){this.box.fill(ALL_SELECT_COLOR)},kf.Expression.prototype.unselect=function(){this.box.fill("transparent")},parser.getKFParser().expand({parse:{placeholder:{name:"placeholder",handler:function(info){return delete info.handler,info.operand=[],info},sign:!1}},reverse:{placeholder:function(){return"\\placeholder "}}})}var kf=_p.r(20),SELECT_COLOR=_p.r(16).selectColor,ALL_SELECT_COLOR=_p.r(16).allSelectColor;return{ext:ext}}},_p[19]={value:function(require,exports,modules){function generateOpShape(operator,label){return null!==label?createRootPlaceholder(operator,label):createCommonShape(operator)}function createCommonShape(operator){var shape=null;return shape=new kity.Rect(35,50,0,0).stroke("black").fill("transparent"),shape.setAttr("stroke-dasharray","5, 5"),operator.addOperatorShape(shape),shape}function createRootPlaceholder(operator,label){var textShape=new kity.Text(label).fill(FILL_COLOR),shapeGroup=new kity.Group,borderBoxShape=new kity.Rect(0,0,0,0,7).stroke(FILL_COLOR).fill("transparent"),textBox=null;return textShape.setFontSize(40),shapeGroup.addShape(borderBoxShape),shapeGroup.addShape(textShape),operator.addOperatorShape(shapeGroup),textBox=textShape.getFixRenderBox(),borderBoxShape.stroke(FILL_COLOR).fill("transparent"),borderBoxShape.setSize(textBox.width+40,textBox.height+40),borderBoxShape.setRadius(7),borderBoxShape.setAttr("stroke-dasharray","5, 5"),textShape.setAttr({dx:0-textBox.x,dy:0-textBox.y}),textShape.translate(20,20),borderBoxShape}var kity=_p.r(21),FILL_COLOR=_p.r(30).rootPlaceholder.color,SELECT_COLOR=_p.r(16).selectColor,ALL_SELECT_COLOR=_p.r(16).allSelectColor;return kity.createClass("PlaceholderOperator",{base:_p.r(20).Operator,constructor:function(){this.opShape=null,this.callBase("Placeholder")},applyOperand:function(){this.opShape=generateOpShape(this,this.parentExpression.getLabel()),this.parentExpression.expand(20,20),this.parentExpression.translateElement(10,10)},select:function(){this.opShape.fill(SELECT_COLOR)},selectAll:function(){this.opShape.fill(ALL_SELECT_COLOR)},unselect:function(){this.opShape.fill("transparent")}})}},_p[20]={value:function(){return window.kf}},_p[21]={value:function(){return window.kity}},_p[22]={value:function(require){function supplementTree(parser,tree,parentTree){var currentOperand=null,isRoot=!parentTree;tree.attr=tree.attr||{},tree.attr.id=parser.getGroupId(),isRoot?processRootGroup(parser,tree):parentTree.attr["data-root"]&&"placeholder"===tree.name&&onlyPlaceholder(parentTree.operand)&&(tree.attr.label=ROOT_P_TEXT);for(var i=0,len=tree.operand.length;i<len;i++)currentOperand=tree.operand[i],isVirtualGroup(tree)?processVirtualGroup(parser,i,tree,currentOperand):processGroup(parser,i,tree,currentOperand);return tree}function generateId(){return PID_PREFIX+ ++PID}function processRootGroup(parser,tree){parser.isResetId?tree.attr["data-root"]="true":tree.attr["data-type"]=GROUP_TYPE.VIRTUAL}function processVirtualGroup(parser,index,tree,subtree){"brackets"===tree.name&&index<2||"function"===tree.name&&0===index||(tree.attr["data-type"]=GROUP_TYPE.VIRTUAL,subtree?"string"==typeof subtree?(tree.operand[index]=createGroup(parser),tree.operand[index].operand[0]=subtree):isPlaceholder(subtree)?(tree.operand[index]=createGroup(parser),tree.operand[index].operand[0]=supplementTree(parser,subtree,tree.operand[index])):tree.operand[index]=supplementTree(parser,subtree,tree):tree.operand[index]=subtree)}function processGroup(parser,index,tree,subtree){tree.attr["data-type"]=GROUP_TYPE.GROUP,subtree&&"string"!=typeof subtree?"text"===subtree.name?tree.operand[index]=subtree:"argument"===subtree.operandType?tree.operand[index]=subtree:tree.operand[index]=supplementTree(parser,subtree,tree):tree.operand[index]=subtree}function onlyPlaceholder(operands){var result=1;if(operands.length>3)return!1;for(var i=0,len=operands.length;i<len;i++)operands[i]!==CURSOR_CHAR&&operands[i]&&"placeholder"===operands[i].name&&result--;return!result}function isVirtualGroup(tree){return!!VGROUP_LIST[tree.name]}function isPlaceholder(tree){return"placeholder"===tree.name}function createGroup(parser){return{name:COMBINATION_NAME,attr:{"data-type":GROUP_TYPE.GROUP,id:parser.getGroupId()},operand:[]}}var KFParser=_p.r(20).Parser,kity=_p.r(21),CURSOR_CHAR=_p.r(30).cursorCharacter,VGROUP_LIST=_p.r(23),ROOT_P_TEXT=_p.r(30).rootPlaceholder.content,COMBINATION_NAME="combination",PID_PREFIX="_kf_editor_",GROUP_TYPE=_p.r(12),PID=0;return kity.createClass("Parser",{constructor:function(kfEditor){this.kfEditor=kfEditor,this.callBase(),this.kfParser=KFParser.use("latex"),this.initKFormulExtension(),this.pid=generateId(),this.groupRecord=0,this.tree=null,this.isResetId=!0,this.initServices()},parse:function(str,isResetId){var parsedResult=null;return this.isResetId=!!isResetId,this.isResetId&&this.resetGroupId(),parsedResult=this.kfParser.parse(str),supplementTree(this,parsedResult.tree),parsedResult},serialization:function(tree){return this.kfParser.serialization(tree)},initServices:function(){this.kfEditor.registerService("parser.parse",this,{parse:this.parse}),this.kfEditor.registerService("parser.latex.serialization",this,{serialization:this.serialization})},getKFParser:function(){return this.kfParser},initKFormulExtension:function(){_p.r(18).ext(this)},resetGroupId:function(){this.groupRecord=0},getGroupId:function(){return this.pid+"_"+ ++this.groupRecord}})}},_p[23]={value:function(){return{radical:!0,fraction:!0,summation:!0,integration:!0,placeholder:!0,script:!0,superscript:!0,subscript:!0,brackets:!0,function:!0}}},_p[24]={value:function(require){function getGroup(node,isAllowVirtual,isAllowWrap){var tagName=null;return node.ownerSVGElement?(node=node.parentNode,tagName=node.tagName.toLowerCase(),node&&"body"!==tagName&&"svg"!==tagName?"kf-editor-group"===node.getAttribute("data-type")?node:isAllowVirtual&&"kf-editor-virtual-group"===node.getAttribute("data-type")?node:isAllowWrap&&null!==node.getAttribute("data-flag")?node:getGroup(node,isAllowVirtual,isAllowWrap):null):null}var kity=_p.r(21),kfUtils=_p.r(5);return kity.createClass("PositionComponenet",{constructor:function(kfEditor){this.kfEditor=kfEditor,this.initServices()},initServices:function(){this.kfEditor.registerService("position.get.group",this,{getGroupByTarget:this.getGroupByTarget}),this.kfEditor.registerService("position.get.index",this,{getIndexByTargetInGroup:this.getIndexByTargetInGroup}),this.kfEditor.registerService("position.get.location.info",this,{getLocationInfo:this.getLocationInfo}),this.kfEditor.registerService("position.get.parent.group",this,{getParentGroupByTarget:this.getParentGroupByTarget}),this.kfEditor.registerService("position.get.wrap",this,{getWrap:this.getWrap}),this.kfEditor.registerService("position.get.area",this,{getAreaByCursorInGroup:this.getAreaByCursorInGroup}),this.kfEditor.registerService("position.get.group.info",this,{getGroupInfoByNode:this.getGroupInfoByNode}),this.kfEditor.registerService("position.get.parent.info",this,{getParentInfoByNode:this.getParentInfoByNode})},getGroupByTarget:function(target){
var groupDom=getGroup(target,!1,!1);return groupDom?this.kfEditor.requestService("syntax.get.group.content",groupDom.id):null},getIndexByTargetInGroup:function(groupNode,targetNode){var groupInfo=this.kfEditor.requestService("syntax.get.group.content",groupNode.id),index=-1;return kity.Utils.each(groupInfo.content,function(child,i){if(index=i,kfUtils.contains(child,targetNode))return!1}),index},getAreaByCursorInGroup:function(groupNode,offset){var groupRect=kfUtils.getRect(groupNode);return groupRect.left+groupRect.width/2<offset},getLocationInfo:function(distance,groupInfo){for(var index=-1,children=groupInfo.content,boundingRect=null,i=children.length-1,child=null;i>=0;i--)if(index=i,child=children[i],boundingRect=kfUtils.getRect(child),boundingRect.left<distance){boundingRect.left+boundingRect.width/2<distance&&(index+=1);break}return index},getParentGroupByTarget:function(target){var groupDom=getGroup(target,!0,!1);return groupDom?this.kfEditor.requestService("syntax.get.group.content",groupDom.id):null},getWrap:function(node){return getGroup(node,!0,!0)},getGroupInfoByNode:function(target){var result={},containerNode=getGroup(target,!1,!1),containerInfo=null;if(!containerNode)return null;containerInfo=this.kfEditor.requestService("syntax.get.group.content",containerNode.id);for(var i=0,len=containerInfo.content.length;i<len&&(result.index=i,!kfUtils.contains(containerInfo.content[i],target));i++);return result.group=containerInfo,result},getParentInfoByNode:function(target){var group=getGroup(target,!0,!1);return group=this.kfEditor.requestService("syntax.get.group.content",group.id),{group:group,index:group.content.indexOf(target)}}})}},_p[25]={value:function(require){return _p.r(21).createClass("Printer",{constructor:function(kfEditor){this.kfEditor=kfEditor,this.initServices(),this.initCommands()},initServices:function(){this.kfEditor.registerService("print.image",this,{printImage:this.printImage})},initCommands:function(){this.kfEditor.registerCommand("get.image.data",this,this.getImageData)},printImage:function(type){var formula=this.kfEditor.requestService("render.get.paper");this._formatCanvas(),formula.toPNG(function(dataUrl){document.body.innerHTML='<img style="background: red;" src="'+dataUrl+'">'}),this._restoreCanvas()},getImageData:function(cb){var canvas=this.kfEditor.requestService("render.get.canvas"),formula=this.kfEditor.requestService("render.get.paper");this._formatCanvas(),formula.toPNG(function(dataUrl){cb({width:canvas.width,height:canvas.height,img:dataUrl})}),this._restoreCanvas()},_formatCanvas:function(){var canvas=this.kfEditor.requestService("render.get.canvas"),rect=canvas.container.getRenderBox();canvas.node.setAttribute("width",rect.width),canvas.node.setAttribute("height",rect.height),this.kfEditor.requestService("render.clear.canvas.transform"),this.kfEditor.requestService("control.cursor.hide"),this.kfEditor.requestService("render.clear.select")},_restoreCanvas:function(){var canvas=this.kfEditor.requestService("render.get.canvas");canvas.node.setAttribute("width","100%"),canvas.node.setAttribute("height","100%"),this.kfEditor.requestService("render.revert.canvas.transform"),this.kfEditor.requestService("control.cursor.relocation"),this.kfEditor.requestService("render.reselect")}})}},_p[26]={value:function(require){var kity=_p.r(21),Assembly=_p.r(20).Assembly,DEFAULT_OPTIONS={autoresize:!1,fontsize:50,padding:[20,50]};return kity.createClass("RenderComponent",{base:_p.r(1),constructor:function(kfEditor,options){this.callBase(),this.options=kity.Utils.extend({},DEFAULT_OPTIONS,options),this.kfEditor=kfEditor,this.assembly=null,this.formula=null,this.relDisabled=!1,this.canvasZoom=1,this.record={select:{},cursor:{},canvas:{}},this.initCanvas(),this.initServices(),this.initCommands()},initCanvas:function(){var canvasContainer=this.kfEditor.requestService("ui.get.canvas.container"),Formula=this.kfEditor.getFormulaClass();this.assembly=new Assembly(new Formula(canvasContainer,this.options)),this.formula=this.assembly.formula,this.setCanvasToCenter()},setCanvasOffset:function(offsetX,offsetY){var viewBox=this.formula.getViewBox();offsetY=void 0!==offsetY?offsetY:-viewBox.height/2,this.formula.setViewBox(offsetX,offsetY,viewBox.width,viewBox.height)},setCanvasToCenter:function(){var viewBox=this.formula.getViewBox();this.formula.setViewBox(-viewBox.width/2,-viewBox.height/2,viewBox.width,viewBox.height)},initServices:function(){this.kfEditor.registerService("render.get.canvas",this,{getCanvas:this.getCanvas}),this.kfEditor.registerService("render.get.content.size",this,{getContentSize:this.getContentSize}),this.kfEditor.registerService("render.clear.canvas.transform",this,{clearCanvasOffset:this.clearCanvasTransform}),this.kfEditor.registerService("render.set.canvas.offset",this,{setCanvasOffset:this.setCanvasOffset}),this.kfEditor.registerService("render.set.canvas.to.center",this,{setCanvasToCenter:this.setCanvasToCenter}),this.kfEditor.registerService("render.revert.canvas.transform",this,{revertCanvasTransform:this.revertCanvasTransform}),this.kfEditor.registerService("render.relocation",this,{relocation:this.relocation}),this.kfEditor.registerService("render.disable.relocation",this,{disableRelocation:this.disableRelocation}),this.kfEditor.registerService("render.enable.relocation",this,{enableRelocation:this.enableRelocation}),this.kfEditor.registerService("render.select.group.content",this,{selectGroupContent:this.selectGroupContent}),this.kfEditor.registerService("render.select.group",this,{selectGroup:this.selectGroup}),this.kfEditor.registerService("render.select.group.all",this,{selectAllGroup:this.selectAllGroup}),this.kfEditor.registerService("render.tint.current.cursor",this,{tintCurrentGroup:this.tintCurrentGroup}),this.kfEditor.registerService("render.select.current.cursor",this,{selectCurrentCursor:this.selectCurrentCursor}),this.kfEditor.registerService("render.reselect",this,{reselect:this.reselect}),this.kfEditor.registerService("render.clear.select",this,{clearSelect:this.clearSelect}),this.kfEditor.registerService("render.set.canvas.zoom",this,{setCanvasZoom:this.setCanvasZoom}),this.kfEditor.registerService("render.get.canvas.zoom",this,{getCanvasZoom:this.getCanvasZoom}),this.kfEditor.registerService("render.get.paper.offset",this,{getPaperOffset:this.getPaperOffset}),this.kfEditor.registerService("render.draw",this,{render:this.render}),this.kfEditor.registerService("render.insert.string",this,{insertString:this.insertString}),this.kfEditor.registerService("render.insert.group",this,{insertGroup:this.insertGroup}),this.kfEditor.registerService("render.get.paper",this,{getPaper:this.getPaper})},initCommands:function(){this.kfEditor.registerCommand("render",this,function(str){this.render(str),this.kfEditor.requestService("ui.update.canvas.view")}),this.kfEditor.registerCommand("getPaper",this,this.getPaper)},relocation:function(){this.relDisabled?this.relocationToLeft():this.relocationToCenter()},relocationToCenter:function(){var formulaSpace=this.formula.container.getRenderBox();this.formula.container.setTranslate(-formulaSpace.width/2,-formulaSpace.height/2),this.setCanvasToCenter()},relocationToLeft:function(){var formulaSpace=this.formula.container.getRenderBox();this.formula.container.setTranslate(0,-formulaSpace.height/2),this.setCanvasOffset(0)},selectGroup:function(groupId){var groupObject=this.kfEditor.requestService("syntax.get.group.object",groupId);this.clearSelect(),groupObject.node.getAttribute("data-root")||(this.record.select.lastSelect=groupObject,groupObject.select())},selectGroupContent:function(group){null!==group.groupObj.getAttribute("data-placeholder")&&(group={id:group.content[0].id});var groupObject=this.kfEditor.requestService("syntax.get.group.object",group.id);this.clearSelect(),this.record.select.lastSelect=groupObject,groupObject.node.getAttribute("data-root")||groupObject.select()},selectAllGroup:function(group){null!==group.groupObj.getAttribute("data-placeholder")&&(group={id:group.content[0].id});var groupObject=this.kfEditor.requestService("syntax.get.group.object",group.id);this.clearSelect(),this.record.select.lastSelect=groupObject,groupObject.selectAll()},selectCurrentCursor:function(){var cursorInfo=this.kfEditor.requestService("syntax.get.record.cursor"),group=this.kfEditor.requestService("syntax.get.group.object",cursorInfo.groupId),box=null,offset=-1,width=0,startIndex=Math.min(cursorInfo.startOffset,cursorInfo.endOffset),endIndex=Math.max(cursorInfo.startOffset,cursorInfo.endOffset);this.clearSelect(),this.record.select.lastSelect=group;for(var i=startIndex,len=endIndex;i<len;i++)box=group.getOperand(i).getRenderBox(group),-1==offset&&(offset=box.x),width+=box.width;group.setBoxWidth(width),group.selectAll(),group.getBox().setTranslate(offset,0)},tintCurrentGroup:function(){var groupId=this.kfEditor.requestService("syntax.get.record.cursor").groupId,groupObject=this.kfEditor.requestService("syntax.get.group.object",groupId),isPlaceholder=this.kfEditor.requestService("syntax.is.placeholder.node",groupId);this.clearSelect(),groupObject.node.getAttribute("data-root")||(isPlaceholder&&(groupObject=this.kfEditor.requestService("syntax.get.group.object",groupObject.operands[0].node.id)),this.record.select.lastSelect=groupObject,groupObject.select())},reselect:function(){var cursorInfo=this.kfEditor.requestService("syntax.get.record.cursor"),groupObject=null;groupObject=this.kfEditor.requestService("syntax.get.group.object",cursorInfo.groupId),this.clearSelect(),this.record.select.lastSelect=groupObject,groupObject.node.getAttribute("data-root")||groupObject.select()},clearSelect:function(){var box=null,currentSelect=this.record.select.lastSelect;currentSelect&&currentSelect.node.ownerSVGElement&&(currentSelect.unselect(),box=currentSelect.getRenderBox(currentSelect),currentSelect.setBoxWidth(box.width),currentSelect.getBox().setTranslate(0,0))},getPaper:function(){return this.formula},render:function(latexStr){var parsedTree=this.kfEditor.requestService("parser.parse",latexStr,!0),objTree=this.assembly.regenerateBy(parsedTree);this.kfEditor.requestService("syntax.update.objtree",objTree)},enableRelocation:function(){this.relDisabled=!1},disableRelocation:function(){this.relDisabled=!0},setCanvasZoom:function(zoom){var viewPort=this.formula.getViewPort();this.canvasZoom=zoom,viewPort.zoom=zoom,this.formula.setViewPort(viewPort)},getCanvas:function(){return this.formula},getContentSize:function(){return this.formula.container.getRenderBox()},clearCanvasTransform:function(){var canvasInfo=this.record.canvas;canvasInfo.viewBox=this.formula.getViewBox(),canvasInfo.contentOffset=this.formula.container.getTranslate(),this.setCanvasToCenter(),this.formula.node.removeAttribute("viewBox"),this.formula.container.setTranslate(0,0)},revertCanvasTransform:function(){var canvasInfo=this.record.canvas,viewBox=canvasInfo.viewBox;if(!viewBox)return!1;this.formula.setViewBox(viewBox.x,viewBox.y,viewBox.width,viewBox.height),this.formula.container.setTranslate(canvasInfo.contentOffset),canvasInfo.viewBox=null,canvasInfo.contentOffset=null},getCanvasZoom:function(){return this.canvasZoom}})}},_p[27]={value:function(require,exports,module){return _p.r(21).createClass("DeleteComponent",{constructor:function(parentComponent,kfEditor){this.parentComponent=parentComponent,this.kfEditor=kfEditor},deleteGroup:function(){var cursorInfo=this.parentComponent.getCursorRecord(),objTree=this.parentComponent.getObjectTree(),currentTree=objTree.mapping[cursorInfo.groupId].strGroup;return cursorInfo.startOffset!==cursorInfo.endOffset?this.parentComponent.isSelectPlaceholder()?!this.parentComponent.isRootTree(currentTree)&&(cursorInfo=this.selectParentContainer(cursorInfo.groupId),this.parentComponent.updateCursor(cursorInfo),!1):this.deleteSelection(currentTree,cursorInfo):0===cursorInfo.startOffset?!this.parentComponent.isRootTree(currentTree)&&(cursorInfo=this.selectParentContainer(cursorInfo.groupId),this.parentComponent.updateCursor(cursorInfo),!1):currentTree.operand.length>1?(cursorInfo=this.deletePrevGroup(currentTree,cursorInfo),this.parentComponent.updateCursor(cursorInfo),cursorInfo.startOffset===cursorInfo.endOffset):(cursorInfo.startOffset=0,cursorInfo.endOffset=1,currentTree.operand[0].attr&&this.parentComponent.isGroupNode(currentTree.operand[0].attr.id)?(this.parentComponent.updateCursor(cursorInfo),!1):(currentTree.operand[0]={name:"placeholder",operand:[]},this.parentComponent.updateCursor(cursorInfo),!0))},deletePrevGroup:function(tree,cursorInfo){var index=cursorInfo.startOffset-1,group=tree.operand[index];return this.parentComponent.isLeafTree(group)?(tree.operand.splice(index,1),cursorInfo.startOffset-=1,cursorInfo.endOffset-=1):cursorInfo.startOffset-=1,cursorInfo},deleteSelection:function(tree,cursorInfo){return 0===cursorInfo.startOffset&&cursorInfo.endOffset===tree.operand.length?(tree.operand.length=1,tree.operand[0]={name:"placeholder",operand:[]},cursorInfo.endOffset=1):(tree.operand.splice(cursorInfo.startOffset,cursorInfo.endOffset-cursorInfo.startOffset),cursorInfo.endOffset=cursorInfo.startOffset),this.parentComponent.updateCursor(cursorInfo),!0},selectParentContainer:function(groupId){var currentGroupNode=this.parentComponent.getGroupObject(groupId).node,parentContainerInfo=this.kfEditor.requestService("position.get.group",currentGroupNode),index=this.kfEditor.requestService("position.get.index",parentContainerInfo.groupObj,currentGroupNode);return{groupId:parentContainerInfo.id,startOffset:index,endOffset:index+1}}})}},_p[28]={value:function(require,exports,module){function updateCursorGoLeft(cursorInfo){var prevGroupNode=null,syntaxComponent=this.parentComponent,containerInfo=null;return containerInfo=syntaxComponent.getGroupContent(cursorInfo.groupId),syntaxComponent.isSelectPlaceholder()?locateOuterIndex(this,containerInfo.content[cursorInfo.startOffset],DIRECTION.LEFT):(cursorInfo.startOffset===cursorInfo.endOffset?cursorInfo.startOffset>0?(prevGroupNode=containerInfo.content[cursorInfo.startOffset-1],isGroupNode(prevGroupNode)?cursorInfo=locateIndex(this,prevGroupNode,DIRECTION.LEFT):(cursorInfo.startOffset-=1,isPlaceholderNode(prevGroupNode)||(cursorInfo.endOffset=cursorInfo.startOffset))):cursorInfo=locateOuterIndex(this,containerInfo.groupObj,DIRECTION.LEFT):(cursorInfo.startOffset=Math.min(cursorInfo.startOffset,cursorInfo.endOffset),cursorInfo.endOffset=cursorInfo.startOffset),cursorInfo)}function updateCursorGoRight(cursorInfo){var nextGroupNode=null,syntaxComponent=this.parentComponent,containerInfo=null;return containerInfo=syntaxComponent.getGroupContent(cursorInfo.groupId),syntaxComponent.isSelectPlaceholder()?locateOuterIndex(this,containerInfo.content[cursorInfo.startOffset],DIRECTION.RIGHT):(cursorInfo.startOffset===cursorInfo.endOffset?cursorInfo.startOffset<containerInfo.content.length?(nextGroupNode=containerInfo.content[cursorInfo.startOffset],isGroupNode(nextGroupNode)?cursorInfo=locateIndex(this,nextGroupNode,DIRECTION.RIGHT):(cursorInfo.startOffset+=1,isPlaceholderNode(nextGroupNode)||(cursorInfo.endOffset=cursorInfo.startOffset))):cursorInfo=locateOuterIndex(this,containerInfo.groupObj,DIRECTION.RIGHT):(cursorInfo.endOffset=Math.max(cursorInfo.startOffset,cursorInfo.endOffset),cursorInfo.startOffset=cursorInfo.endOffset),cursorInfo)}function locateIndex(moveComponent,groupNode,dir){switch(dir){case DIRECTION.LEFT:return locateLeftIndex(moveComponent,groupNode);case DIRECTION.RIGHT:return locateRightIndex(moveComponent,groupNode)}throw new Error("undefined move direction!")}function locateOuterIndex(moveComponent,groupNode,dir){switch(dir){case DIRECTION.LEFT:return locateOuterLeftIndex(moveComponent,groupNode);case DIRECTION.RIGHT:return locateOuterRightIndex(moveComponent,groupNode)}throw new Error("undefined move direction!")}function locateLeftIndex(moveComponent,groupNode){var syntaxComponent=moveComponent.parentComponent,groupInfo=null,groupElement=null;if(isPlaceholderNode(groupNode)||isEmptyNode(groupNode))return locateOuterLeftIndex(moveComponent,groupNode);if(isGroupNode(groupNode)){if(groupInfo=syntaxComponent.getGroupContent(groupNode.id),groupElement=groupInfo.content[groupInfo.content.length-1],isEmptyNode(groupElement))return locateOuterLeftIndex(moveComponent,groupElement);if(isContainerNode(groupNode))return isPlaceholderNode(groupElement)?{groupId:groupNode.id,startOffset:groupInfo.content.length-1,endOffset:groupInfo.content.length}:isContainerNode(groupElement)&&1===groupInfo.content.length?locateLeftIndex(moveComponent,groupElement):{groupId:groupNode.id,startOffset:groupInfo.content.length,endOffset:groupInfo.content.length};for(;!isContainerNode(groupElement)&&!isEmptyNode(groupElement)&&!isPlaceholderNode(groupElement);)groupInfo=syntaxComponent.getGroupContent(groupElement.id),groupElement=groupInfo.content[groupInfo.content.length-1];return isEmptyNode(groupElement)?locateOuterLeftIndex(moveComponent,groupElement):isPlaceholderNode(groupElement)?{groupId:groupElement.id,startOffset:groupInfo.content.length,endOffset:groupInfo.content.length}:locateLeftIndex(moveComponent,groupElement)}return null}function locateOuterLeftIndex(moveComponent,groupNode){var kfEditor=moveComponent.kfEditor,outerGroupInfo=null;if(isRootNode(groupNode))return null;for(outerGroupInfo=kfEditor.requestService("position.get.parent.info",groupNode);0===outerGroupInfo.index;){if(isRootNode(outerGroupInfo.group.groupObj))return{groupId:outerGroupInfo.group.id,startOffset:0,endOffset:0};if(isContainerNode(outerGroupInfo.group.groupObj)&&outerGroupInfo.group.content.length>1)return{groupId:outerGroupInfo.group.id,startOffset:0,endOffset:0};outerGroupInfo=kfEditor.requestService("position.get.parent.info",outerGroupInfo.group.groupObj)}return isContainerNode(outerGroupInfo.group.groupObj)?{groupId:outerGroupInfo.group.id,startOffset:outerGroupInfo.index,endOffset:outerGroupInfo.index}:(groupNode=outerGroupInfo.group.content[outerGroupInfo.index-1],isGroupNode(groupNode)?(isContainerNode(groupNode),locateLeftIndex(moveComponent,groupNode)):isEmptyNode(groupNode)?locateOuterLeftIndex(moveComponent,groupNode):{groupId:outerGroupInfo.group.id,startOffset:outerGroupInfo.index,endOffset:outerGroupInfo.index})}function locateRightIndex(moveComponent,groupNode){var syntaxComponent=moveComponent.parentComponent,groupInfo=null,groupElement=null;if(isGroupNode(groupNode)){if(groupInfo=syntaxComponent.getGroupContent(groupNode.id),groupElement=groupInfo.content[0],isContainerNode(groupNode))return isContainerNode(groupElement)?locateRightIndex(moveComponent,groupElement):isPlaceholderNode(groupElement)?{groupId:groupNode.id,startOffset:0,endOffset:1}:{groupId:groupNode.id,startOffset:0,endOffset:0};for(;!isContainerNode(groupElement)&&!isPlaceholderNode(groupElement)&&!isEmptyNode(groupElement);)groupInfo=syntaxComponent.getGroupContent(groupElement.id),groupElement=groupInfo.content[0];return isPlaceholderNode(groupElement)?{groupId:groupElement.id,startOffset:0,endOffset:0}:isEmptyNode(groupElement)?locateOuterRightIndex(moveComponent,groupElement):locateRightIndex(moveComponent,groupElement)}return null}function locateOuterRightIndex(moveComponent,groupNode){var kfEditor=moveComponent.kfEditor,syntaxComponent=moveComponent.parentComponent,outerGroupInfo=null,groupInfo=null;if(isRootNode(groupNode))return null;for(outerGroupInfo=kfEditor.requestService("position.get.parent.info",groupNode);outerGroupInfo.index===outerGroupInfo.group.content.length-1;){if(isRootNode(outerGroupInfo.group.groupObj))return{groupId:outerGroupInfo.group.id,startOffset:outerGroupInfo.group.content.length,endOffset:outerGroupInfo.group.content.length};if(isContainerNode(outerGroupInfo.group.groupObj)&&outerGroupInfo.group.content.length>1)return{groupId:outerGroupInfo.group.id,startOffset:outerGroupInfo.group.content.length,endOffset:outerGroupInfo.group.content.length};outerGroupInfo=kfEditor.requestService("position.get.parent.info",outerGroupInfo.group.groupObj)}return groupNode=outerGroupInfo.group.content[outerGroupInfo.index+1],isEmptyNode(groupNode)?locateOuterRightIndex(moveComponent,groupNode):isContainerNode(groupNode)?(groupInfo=syntaxComponent.getGroupContent(groupNode.id),syntaxComponent.isPlaceholder(groupInfo.content[0].id)?{groupId:groupNode.id,startOffset:0,endOffset:1}:{groupId:groupNode.id,startOffset:0,endOffset:0}):{groupId:outerGroupInfo.group.id,startOffset:outerGroupInfo.index+1,endOffset:outerGroupInfo.index+1}}function isRootNode(node){return!!node.getAttribute("data-root")}function isContainerNode(node){return"kf-editor-group"===node.getAttribute("data-type")}function isGroupNode(node){var dataType=node.getAttribute("data-type");return"kf-editor-group"===dataType||"kf-editor-virtual-group"===dataType}function isPlaceholderNode(node){return"Placeholder"===node.getAttribute("data-flag")}function isEmptyNode(node){return"Empty"===node.getAttribute("data-flag")}var kity=_p.r(21),DIRECTION={LEFT:"left",RIGHT:"right"};return kity.createClass("MoveComponent",{constructor:function(parentComponent,kfEditor){this.parentComponent=parentComponent,this.kfEditor=kfEditor},leftMove:function(){var cursorInfo=this.parentComponent.getCursorRecord();(cursorInfo=updateCursorGoLeft.call(this,cursorInfo))&&this.parentComponent.updateCursor(cursorInfo)},rightMove:function(){var cursorInfo=this.parentComponent.getCursorRecord();(cursorInfo=updateCursorGoRight.call(this,cursorInfo))&&this.parentComponent.updateCursor(cursorInfo)}})}},_p[29]={value:function(require){var kity=_p.r(21),MoveComponent=_p.r(28),DeleteComponent=_p.r(27),CURSOR_CHAR=_p.r(30).cursorCharacter,GROUP_TYPE=_p.r(12);return kity.createClass("SyntaxComponenet",{constructor:function(kfEditor){this.kfEditor=kfEditor,this.record={cursor:{group:null,startOffset:-1,endOffset:-1}},this.components={},this.objTree=null,this.initComponents(),this.initServices(),this.initCommands()},initComponents:function(){this.components.move=new MoveComponent(this,this.kfEditor),this.components.delete=new DeleteComponent(this,this.kfEditor)},initServices:function(){this.kfEditor.registerService("syntax.update.objtree",this,{updateObjTree:this.updateObjTree}),this.kfEditor.registerService("syntax.get.objtree",this,{getObjectTree:this.getObjectTree}),this.kfEditor.registerService("syntax.get.group.object",this,{getGroupObject:this.getGroupObject}),this.kfEditor.registerService("syntax.is.root.node",this,{isRootNode:this.isRootNode}),this.kfEditor.registerService("syntax.is.group.node",this,{isGroupNode:this.isGroupNode}),this.kfEditor.registerService("syntax.is.virtual.node",this,{isVirtualNode:this.isVirtualNode}),this.kfEditor.registerService("syntax.is.placeholder.node",this,{isPlaceholder:this.isPlaceholder}),this.kfEditor.registerService("syntax.is.select.placeholder",this,{isSelectPlaceholder:this.isSelectPlaceholder}),this.kfEditor.registerService("syntax.has.root.placeholder",this,{hasRootplaceholder:this.hasRootplaceholder}),this.kfEditor.registerService("syntax.valid.brackets",this,{isBrackets:this.isBrackets}),this.kfEditor.registerService("syntax.get.group.content",this,{getGroupContent:this.getGroupContent}),this.kfEditor.registerService("syntax.get.root.group.info",this,{getRootGroupInfo:this.getRootGroupInfo}),this.kfEditor.registerService("syntax.get.root",this,{getRootObject:this.getRootObject}),this.kfEditor.registerService("syntax.update.record.cursor",this,{updateCursor:this.updateCursor}),this.kfEditor.registerService("syntax.update.selection",this,{updateSelection:this.updateSelection}),this.kfEditor.registerService("syntax.get.record.cursor",this,{getCursorRecord:this.getCursorRecord}),this.kfEditor.registerService("syntax.has.cursor.info",this,{hasCursorInfo:this.hasCursorInfo}),this.kfEditor.registerService("syntax.serialization",this,{serialization:this.serialization}),this.kfEditor.registerService("syntax.cursor.move.left",this,{leftMove:this.leftMove}),this.kfEditor.registerService("syntax.cursor.move.right",this,{rightMove:this.rightMove}),this.kfEditor.registerService("syntax.delete.group",this,{deleteGroup:this.deleteGroup})},initCommands:function(){this.kfEditor.registerCommand("get.source",this,this.getSource),this.kfEditor.registerCommand("content.is.empty",this,this.isEmpty)},updateObjTree:function(objTree){var selectInfo=objTree.select;selectInfo&&selectInfo.groupId&&this.updateCursor(selectInfo.groupId,selectInfo.startOffset,selectInfo.endOffset),this.objTree=objTree},hasCursorInfo:function(){return null!==this.record.cursor.group},isRootNode:function(groupId){return this.objTree.mapping.root.strGroup.attr.id===groupId},isGroupNode:function(groupId){var type=this.objTree.mapping[groupId].strGroup.attr["data-type"];return type===GROUP_TYPE.GROUP||type===GROUP_TYPE.VIRTUAL},isVirtualNode:function(groupId){return this.objTree.mapping[groupId].strGroup.attr["data-type"]===GROUP_TYPE.VIRTUAL},isPlaceholder:function(groupId){var currentNode=this.objTree.mapping[groupId];return!!currentNode&&(currentNode=currentNode.objGroup.node,"Placeholder"===currentNode.getAttribute("data-flag"))},isBrackets:function(groupId){return!!this.objTree.mapping[groupId].objGroup.node.getAttribute("data-brackets")},hasRootplaceholder:function(){return"placeholder"===this.objTree.mapping.root.strGroup.operand[0].name},isSelectPlaceholder:function(){var cursorInfo=this.record.cursor,groupInfo=null;return cursorInfo.endOffset-cursorInfo.startOffset==1&&(groupInfo=this.getGroupContent(cursorInfo.groupId),!!this.isPlaceholder(groupInfo.content[cursorInfo.startOffset].id))},isLeafTree:function(tree){return"string"==typeof tree},isRootTree:function(tree){return tree.attr&&tree.attr["data-root"]},getObjectTree:function(){return this.objTree},getGroupObject:function(id){return this.objTree.mapping[id].objGroup||null},getCursorRecord:function(){return kity.Utils.extend({},this.record.cursor)||null},getGroupContent:function(groupId){var groupInfo=this.objTree.mapping[groupId],content=[],operands=groupInfo.objGroup.operands,offset=operands.length-1,isLtr="rtl"!==groupInfo.strGroup.traversal;return kity.Utils.each(operands,function(operand,i){isLtr?content.push(operand.node):content[offset-i]=operand.node}),{id:groupId,traversal:groupInfo.strGroup.traversal||"ltr",groupObj:groupInfo.objGroup.node,content:content}},getRootObject:function(){return this.objTree.mapping.root.objGroup},getRootGroupInfo:function(){var rootGroupId=this.objTree.mapping.root.strGroup.attr.id;return this.getGroupContent(rootGroupId)},updateSelection:function(group){var groupObj=this.objTree.mapping[group.id],curStrGroup=groupObj.strGroup,parentGroup=null,parentGroupObj=null,resultStr=null,startOffset=-1,endOffset=-1;if(parentGroup=group,parentGroupObj=groupObj,"combination"===curStrGroup.name)this.record.cursor={groupId:parentGroup.id,startOffset:0,endOffset:curStrGroup.operand.length},curStrGroup.operand.unshift(CURSOR_CHAR),curStrGroup.operand.push(CURSOR_CHAR);else{for(;"combination"!==parentGroupObj.strGroup.name||1===parentGroup.content;)group=parentGroup,groupObj=parentGroupObj,parentGroup=this.kfEditor.requestService("position.get.parent.group",groupObj.objGroup.node),parentGroupObj=this.objTree.mapping[parentGroup.id];var parentIndex=[].indexOf.call(parentGroup.content,group.groupObj);this.record.cursor={groupId:parentGroup.id,startOffset:parentIndex,endOffset:parentIndex+1},parentGroupObj.strGroup.operand.splice(parentIndex+1,0,CURSOR_CHAR),parentGroupObj.strGroup.operand.splice(parentIndex,0,CURSOR_CHAR)}return resultStr=this.kfEditor.requestService("parser.latex.serialization",this.objTree.parsedTree),startOffset=resultStr.indexOf(CURSOR_CHAR),resultStr=resultStr.replace(CURSOR_CHAR,""),endOffset=resultStr.indexOf(CURSOR_CHAR),parentGroupObj.strGroup.operand.splice(this.record.cursor.startOffset,1),parentGroupObj.strGroup.operand.splice(this.record.cursor.endOffset,1),{str:resultStr,startOffset:startOffset,endOffset:endOffset}},getSource:function(){return this.serialization().str.replace(CURSOR_CHAR,"").replace(CURSOR_CHAR,"")},isEmpty:function(){return this.hasRootplaceholder()},serialization:function(){var cursor=this.record.cursor,objGroup=this.objTree.mapping[cursor.groupId],curStrGroup=objGroup.strGroup,resultStr=null,strStartIndex=-1,strEndIndex=-1;return strStartIndex=Math.min(cursor.endOffset,cursor.startOffset),strEndIndex=Math.max(cursor.endOffset,cursor.startOffset),curStrGroup.operand.splice(strEndIndex,0,CURSOR_CHAR),curStrGroup.operand.splice(strStartIndex,0,CURSOR_CHAR),strEndIndex+=1,resultStr=this.kfEditor.requestService("parser.latex.serialization",this.objTree.parsedTree),curStrGroup.operand.splice(strEndIndex,1),curStrGroup.operand.splice(strStartIndex,1),strStartIndex=resultStr.indexOf(CURSOR_CHAR),cursor.startOffset===cursor.endOffset&&(resultStr=resultStr.replace(CURSOR_CHAR,"")),strEndIndex=resultStr.lastIndexOf(CURSOR_CHAR),{str:resultStr,startOffset:strStartIndex,endOffset:strEndIndex}},updateCursor:function(groupId,startOffset,endOffset){var tmp=null;1===arguments.length&&(endOffset=groupId.endOffset,startOffset=groupId.startOffset,groupId=groupId.groupId),void 0===endOffset&&(endOffset=startOffset),startOffset>endOffset&&(tmp=endOffset,endOffset=startOffset,startOffset=tmp),this.record.cursor={groupId:groupId,startOffset:startOffset,endOffset:endOffset}},leftMove:function(){this.components.move.leftMove()},rightMove:function(){this.components.move.rightMove()},deleteGroup:function(){return this.components.delete.deleteGroup()},insertSubtree:function(subtree){var cursorInfo=this.record.cursor,startOffset=0,endOffset=0,currentTree=null,diff=0;this.isPlaceholder(cursorInfo.groupId)?this.replaceTree(subtree):(startOffset=Math.min(cursorInfo.startOffset,cursorInfo.endOffset),endOffset=Math.max(cursorInfo.startOffset,cursorInfo.endOffset),diff=endOffset-startOffset,currentTree=this.objTree.mapping[cursorInfo.groupId].strGroup,currentTree.operand.splice(startOffset,diff,subtree),cursorInfo.startOffset+=1,cursorInfo.endOffset=cursorInfo.startOffset)},replaceTree:function(subtree){var cursorInfo=this.record.cursor,groupNode=this.objTree.mapping[cursorInfo.groupId].objGroup.node,parentInfo=this.kfEditor.requestService("position.get.parent.info",groupNode);this.objTree.mapping[parentInfo.group.id].strGroup.operand[parentInfo.index]=subtree,cursorInfo.groupId=parentInfo.group.id,cursorInfo.startOffset=parentInfo.index+1,cursorInfo.endOffset=parentInfo.index+1}})}},_p[30]={value:function(){return{cursorCharacter:"",rootPlaceholder:{color:"#666",content:"在此处键入公式",fontsize:16},scrollbar:{padding:5,step:150}}}},_p[31]={value:function(){return{"\\pm":{x:5,y:0},"\\infty":{x:42,y:0},"=":{x:79,y:0},"\\sim":{x:116,y:0},"\\times":{x:153,y:0},"\\div":{x:190,y:0},"!":{x:227,y:0},"<":{x:264,y:0},"\\ll":{x:301,y:0},">":{x:338,y:0},"\\gg":{x:375,y:0},"\\leq":{x:412,y:0},"\\geq":{x:449,y:0},"\\mp":{x:486,y:0},"\\cong":{x:523,y:0},"\\equiv":{x:560,y:0},"\\propto":{x:597,y:0},"\\approx":{x:634,y:0},"\\forall":{x:671,y:0},"\\partial":{x:708,y:0},"\\surd":{x:745,y:0},"\\cup":{x:782,y:0},"\\cap":{x:819,y:0},"\\subseteq":{x:140,y:671},"\\supseteq":{x:183,y:671},"\\subset":{x:52,y:671},"\\supset":{x:95,y:671},"\\subsetneqq":{x:143,y:472},"\\supsetneqq":{x:186,y:472},"\\bot":{x:715,y:718},"\\varnothing":{x:856,y:0},"%":{x:893,y:0},"\\circ":{x:930,y:0},"\\exists":{x:967,y:0},"\\nexists":{x:1004,y:0},"\\in":{x:1041,y:0},"\\ni":{x:1078,y:0},"\\gets":{x:5,y:37},"\\uparrow":{x:42,y:37},"\\to":{x:79,y:37},"\\downarrow":{x:116,y:37},"\\leftrightarrow":{x:153,y:37},"\\therefore":{x:190,y:37},"\\because":{x:227,y:37},"+":{x:264,y:37},"-":{x:301,y:37},"\\neg":{x:338,y:37},"\\ast":{x:375,y:37},"\\cdot":{x:412,y:37},"\\vdots":{x:449,y:37},"\\ddots":{x:486,y:37},"\\aleph":{x:523,y:37},"\\beth":{x:560,y:37},"\\blacksquare":{x:597,y:37},"\\alpha":{x:634,y:37},"\\beta":{x:671,y:37},"\\gamma":{x:708,y:37},"\\delta":{x:745,y:37},"\\epsilon":{x:782,y:37},"\\zeta":{x:819,y:37},"\\eta":{x:856,y:37},
"\\theta":{x:893,y:37},"\\iota":{x:930,y:37},"\\kappa":{x:967,y:37},"\\lambda":{x:1004,y:37},"\\mu":{x:1041,y:37},"\\nu":{x:1078,y:37},"\\xi":{x:5,y:74},"\\omicron":{x:42,y:74},"\\pi":{x:79,y:74},"\\rho":{x:116,y:74},"\\sigma":{x:153,y:74},"\\tau":{x:190,y:74},"\\upsilon":{x:227,y:74},"\\phi":{x:264,y:74},"\\chi":{x:301,y:74},"\\psi":{x:338,y:74},"\\omega":{x:375,y:74},"\\Alpha":{x:412,y:74},"\\Beta":{x:449,y:74},"\\Gamma":{x:486,y:74},"\\Delta":{x:523,y:74},"\\Epsilon":{x:560,y:74},"\\Zeta":{x:597,y:74},"\\Eta":{x:634,y:74},"\\Theta":{x:671,y:74},"\\Iota":{x:708,y:74},"\\Kappa":{x:745,y:74},"\\Lambda":{x:782,y:74},"\\Mu":{x:819,y:74},"\\Nu":{x:856,y:74},"\\Xi":{x:893,y:74},"\\Omicron":{x:930,y:74},"\\Pi":{x:967,y:74},"\\Rho":{x:1004,y:74},"\\Sigma":{x:1041,y:74},"\\Tau":{x:1078,y:74},"\\Upsilon":{x:5,y:111},"\\Phi":{x:42,y:111},"\\Chi":{x:79,y:111},"\\Psi":{x:116,y:111},"\\Omega":{x:153,y:111},"\\digamma":{x:190,y:111},"\\varepsilon":{x:227,y:111},"\\varkappa":{x:264,y:111},"\\varphi":{x:301,y:111},"\\varpi":{x:338,y:111},"\\varrho":{x:375,y:111},"\\varsigma":{x:412,y:111},"\\vartheta":{x:449,y:111},"\\neq":{x:486,y:111},"\\nless":{x:523,y:111},"\\ngtr":{x:560,y:111},"\\nleq":{x:597,y:111},"\\ngeq":{x:634,y:111},"\\nsim":{x:671,y:111},"\\lneqq":{x:708,y:111},"\\gneqq":{x:745,y:111},"\\nprec":{x:782,y:111},"\\nsucc":{x:819,y:111},"\\notin":{x:856,y:111},"\\nsubseteq":{x:893,y:111},"\\nsupseteq":{x:930,y:111},"\\subsetneq":{x:967,y:111},"\\supsetneq":{x:1004,y:111},"\\lnsim":{x:1041,y:111},"\\gnsim":{x:1078,y:111},"\\precnsim":{x:5,y:148},"\\succnsim":{x:42,y:148},"\\ntriangleleft":{x:79,y:148},"\\ntriangleright":{x:116,y:148},"\\ntrianglelefteq":{x:153,y:148},"\\ntrianglerighteq":{x:190,y:148},"\\nmid":{x:227,y:148},"\\nparallel":{x:264,y:148},"\\nvdash":{x:301,y:148},"\\nVdash":{x:338,y:148},"\\nvDash":{x:375,y:148},"\\nVDash":{x:412,y:148},"\\daleth":{x:449,y:148},"\\gimel":{x:486,y:148},"\\complement":{x:523,y:148},"\\ell":{x:560,y:148},"\\eth":{x:597,y:148},"\\hbar":{x:634,y:148},"\\hslash":{x:671,y:148},"\\mho":{x:708,y:148},"\\wp":{x:745,y:148},"\\circledS":{x:782,y:148},"\\Bbbk":{x:819,y:148},"\\Finv":{x:856,y:148},"\\Game":{x:893,y:148},"\\Im":{x:930,y:148},"\\Re":{x:967,y:148},"\\updownarrow":{x:1004,y:148},"\\Leftarrow":{x:1041,y:148},"\\Rightarrow":{x:1078,y:148},"\\Uparrow":{x:5,y:185},"\\Downarrow":{x:42,y:185},"\\Leftrightarrow":{x:79,y:185},"\\Updownarrow":{x:116,y:185},"\\longleftarrow":{x:153,y:185},"\\longrightarrow":{x:190,y:185},"\\longleftrightarrow":{x:227,y:185},"\\Longleftarrow":{x:264,y:185},"\\Longrightarrow":{x:301,y:185},"\\Longleftrightarrow":{x:338,y:185},"\\nearrow":{x:375,y:185},"\\nwarrow":{x:412,y:185},"\\searrow":{x:449,y:185},"\\swarrow":{x:486,y:185},"\\nleftarrow":{x:523,y:185},"\\nrightarrow":{x:560,y:185},"\\nLeftarrow":{x:597,y:185},"\\nRightarrow":{x:634,y:185},"\\nLeftrightarrow":{x:671,y:185},"\\leftharpoonup":{x:708,y:185},"\\leftharpoondown":{x:745,y:185},"\\rightharpoonup":{x:782,y:185},"\\rightharpoondown":{x:819,y:185},"\\upharpoonleft":{x:856,y:185},"\\upharpoonright":{x:893,y:185},"\\downharpoonleft":{x:930,y:185},"\\downharpoonright":{x:967,y:185},"\\leftrightharpoons":{x:1004,y:185},"\\rightleftharpoons":{x:1041,y:185},"\\leftleftarrows":{x:1078,y:185},"\\rightrightarrows":{x:5,y:222},"\\upuparrows":{x:42,y:222},"\\downdownarrows":{x:79,y:222},"\\leftrightarrows":{x:116,y:222},"\\rightleftarrows":{x:153,y:222},"\\looparrowleft":{x:190,y:222},"\\looparrowright":{x:227,y:222},"\\leftarrowtail":{x:264,y:222},"\\rightarrowtail":{x:301,y:222},"\\Lsh":{x:338,y:222},"\\Rsh":{x:375,y:222},"\\Lleftarrow":{x:412,y:222},"\\Rrightarrow":{x:449,y:222},"\\curvearrowleft":{x:486,y:222},"\\curvearrowright":{x:523,y:222},"\\circlearrowleft":{x:560,y:222},"\\circlearrowright":{x:597,y:222},"\\multimap":{x:634,y:222},"\\leftrightsquigarrow":{x:671,y:222},"\\twoheadleftarrow":{x:708,y:222},"\\twoheadrightarrow":{x:745,y:222},"\\rightsquigarrow":{x:782,y:222},"\\mathcal{A}":{x:819,y:222},"\\mathcal{B}":{x:856,y:222},"\\mathcal{C}":{x:893,y:222},"\\mathcal{D}":{x:930,y:222},"\\mathcal{E}":{x:967,y:222},"\\mathcal{F}":{x:1004,y:222},"\\mathcal{G}":{x:1041,y:222},"\\mathcal{H}":{x:1078,y:222},"\\mathcal{I}":{x:5,y:259},"\\mathcal{J}":{x:42,y:259},"\\mathcal{K}":{x:79,y:259},"\\mathcal{L}":{x:116,y:259},"\\mathcal{M}":{x:153,y:259},"\\mathcal{N}":{x:190,y:259},"\\mathcal{O}":{x:227,y:259},"\\mathcal{P}":{x:264,y:259},"\\mathcal{Q}":{x:301,y:259},"\\mathcal{R}":{x:338,y:259},"\\mathcal{S}":{x:375,y:259},"\\mathcal{T}":{x:412,y:259},"\\mathcal{U}":{x:449,y:259},"\\mathcal{V}":{x:486,y:259},"\\mathcal{W}":{x:523,y:259},"\\mathcal{X}":{x:560,y:259},"\\mathcal{Y}":{x:597,y:259},"\\mathcal{Z}":{x:634,y:259},"\\mathfrak{A}":{x:671,y:259},"\\mathfrak{B}":{x:708,y:259},"\\mathfrak{C}":{x:745,y:259},"\\mathfrak{D}":{x:782,y:259},"\\mathfrak{E}":{x:819,y:259},"\\mathfrak{F}":{x:856,y:259},"\\mathfrak{G}":{x:893,y:259},"\\mathfrak{H}":{x:930,y:259},"\\mathfrak{I}":{x:967,y:259},"\\mathfrak{J}":{x:1004,y:259},"\\mathfrak{K}":{x:1041,y:259},"\\mathfrak{L}":{x:1078,y:259},"\\mathfrak{M}":{x:5,y:296},"\\mathfrak{N}":{x:42,y:296},"\\mathfrak{O}":{x:79,y:296},"\\mathfrak{P}":{x:116,y:296},"\\mathfrak{Q}":{x:153,y:296},"\\mathfrak{R}":{x:190,y:296},"\\mathfrak{S}":{x:227,y:296},"\\mathfrak{T}":{x:264,y:296},"\\mathfrak{U}":{x:301,y:296},"\\mathfrak{V}":{x:338,y:296},"\\mathfrak{W}":{x:375,y:296},"\\mathfrak{X}":{x:412,y:296},"\\mathfrak{Y}":{x:449,y:296},"\\mathfrak{Z}":{x:486,y:296},"\\mathfrak{a}":{x:523,y:296},"\\mathfrak{b}":{x:560,y:296},"\\mathfrak{c}":{x:597,y:296},"\\mathfrak{d}":{x:634,y:296},"\\mathfrak{e}":{x:671,y:296},"\\mathfrak{f}":{x:708,y:296},"\\mathfrak{g}":{x:745,y:296},"\\mathfrak{h}":{x:782,y:296},"\\mathfrak{i}":{x:819,y:296},"\\mathfrak{j}":{x:856,y:296},"\\mathfrak{k}":{x:893,y:296},"\\mathfrak{l}":{x:930,y:296},"\\mathfrak{m}":{x:967,y:296},"\\mathfrak{n}":{x:1004,y:296},"\\mathfrak{o}":{x:1041,y:296},"\\mathfrak{p}":{x:1078,y:296},"\\mathfrak{q}":{x:5,y:333},"\\mathfrak{r}":{x:42,y:333},"\\mathfrak{s}":{x:79,y:333},"\\mathfrak{t}":{x:116,y:333},"\\mathfrak{u}":{x:153,y:333},"\\mathfrak{v}":{x:190,y:333},"\\mathfrak{w}":{x:227,y:333},"\\mathfrak{x}":{x:264,y:333},"\\mathfrak{y}":{x:301,y:333},"\\mathfrak{z}":{x:338,y:333},"\\mathbb{A}":{x:375,y:333},"\\mathbb{B}":{x:412,y:333},"\\mathbb{C}":{x:449,y:333},"\\mathbb{D}":{x:486,y:333},"\\mathbb{E}":{x:523,y:333},"\\mathbb{F}":{x:560,y:333},"\\mathbb{G}":{x:597,y:333},"\\mathbb{H}":{x:634,y:333},"\\mathbb{I}":{x:671,y:333},"\\mathbb{J}":{x:708,y:333},"\\mathbb{K}":{x:745,y:333},"\\mathbb{L}":{x:782,y:333},"\\mathbb{M}":{x:819,y:333},"\\mathbb{N}":{x:856,y:333},"\\mathbb{O}":{x:893,y:333},"\\mathbb{P}":{x:930,y:333},"\\mathbb{Q}":{x:967,y:333},"\\mathbb{R}":{x:1004,y:333},"\\mathbb{S}":{x:1041,y:333},"\\mathbb{T}":{x:1078,y:333},"\\mathbb{U}":{x:5,y:370},"\\mathbb{V}":{x:42,y:370},"\\mathbb{W}":{x:79,y:370},"\\mathbb{X}":{x:116,y:370},"\\mathbb{Y}":{x:153,y:370},"\\mathbb{Z}":{x:190,y:370},"\\mathrm{A}":{x:227,y:370},"\\mathrm{B}":{x:264,y:370},"\\mathrm{C}":{x:301,y:370},"\\mathrm{D}":{x:338,y:370},"\\mathrm{E}":{x:375,y:370},"\\mathrm{F}":{x:412,y:370},"\\mathrm{G}":{x:449,y:370},"\\mathrm{H}":{x:486,y:370},"\\mathrm{I}":{x:523,y:370},"\\mathrm{J}":{x:560,y:370},"\\mathrm{K}":{x:597,y:370},"\\mathrm{L}":{x:634,y:370},"\\mathrm{M}":{x:671,y:370},"\\mathrm{N}":{x:708,y:370},"\\mathrm{O}":{x:745,y:370},"\\mathrm{P}":{x:782,y:370},"\\mathrm{Q}":{x:819,y:370},"\\mathrm{R}":{x:856,y:370},"\\mathrm{S}":{x:893,y:370},"\\mathrm{T}":{x:930,y:370},"\\mathrm{U}":{x:967,y:370},"\\mathrm{V}":{x:1004,y:370},"\\mathrm{W}":{x:1041,y:370},"\\mathrm{X}":{x:1078,y:370},"\\mathrm{Y}":{x:5,y:407},"\\mathrm{Z}":{x:42,y:407},"\\mathrm{a}":{x:79,y:407},"\\mathrm{b}":{x:116,y:407},"\\mathrm{c}":{x:153,y:407},"\\mathrm{d}":{x:190,y:407},"\\mathrm{e}":{x:227,y:407},"\\mathrm{f}":{x:264,y:407},"\\mathrm{g}":{x:301,y:407},"\\mathrm{h}":{x:338,y:407},"\\mathrm{i}":{x:375,y:407},"\\mathrm{j}":{x:412,y:407},"\\mathrm{k}":{x:449,y:407},"\\mathrm{l}":{x:486,y:407},"\\mathrm{m}":{x:523,y:407},"\\mathrm{n}":{x:560,y:407},"\\mathrm{o}":{x:597,y:407},"\\mathrm{p}":{x:634,y:407},"\\mathrm{q}":{x:671,y:407},"\\mathrm{r}":{x:708,y:407},"\\mathrm{s}":{x:745,y:407},"\\mathrm{t}":{x:782,y:407},"\\mathrm{u}":{x:819,y:407},"\\mathrm{v}":{x:856,y:407},"\\mathrm{w}":{x:893,y:407},"\\mathrm{x}":{x:930,y:407},"\\mathrm{y}":{x:967,y:407},"\\mathrm{z}":{x:1004,y:407}}}},_p[32]={value:function(require){var Utils=_p.r(5),DEFAULT_OPTIONS={min:1,max:2};return _p.r(21).createClass("ScrollZoomController",{constructor:function(parentComponent,kfEditor,target,options){this.kfEditor=kfEditor,this.target=target,this.zoom=1,this.step=.05,this.options=Utils.extend({},DEFAULT_OPTIONS,options),this.initEvent()},initEvent:function(){var kfEditor=this.kfEditor,_self=this,min=this.options.min,max=this.options.max,step=this.step;Utils.addEvent(this.target,"mousewheel",function(e){e.preventDefault(),e.wheelDelta<0?_self.zoom-=_self.zoom*step:_self.zoom+=_self.zoom*step,_self.zoom=Math.max(_self.zoom,min),_self.zoom=Math.min(_self.zoom,max),kfEditor.requestService("render.set.canvas.zoom",_self.zoom)})}})}},_p[33]={value:function(require){return{VIEW_STATE:{NO_OVERFLOW:0,OVERFLOW:1},scrollbar:{step:50,thumbMinSize:50}}}},_p[34]={value:function(){return{"\\overrightarrow{\\placeholder}":{img:"assets/images/toolbar/other/overrightarrow.png",pos:{x:-10,y:-5},size:{width:56,height:60}},"\\underrightarrow{\\placeholder}":{img:"assets/images/toolbar/other/underrightarrow.png",pos:{x:-10,y:-5},size:{width:56,height:60}},"\\left.\\begin{gathered} \\placeholder \\\\ \\placeholder \\end{gathered}\\right\\}":{img:"assets/images/toolbar/other/equations2.png",pos:{x:-10,y:-5},size:{width:56,height:60}},"\\left.\\begin{gathered} \\placeholder \\\\ \\placeholder \\\\ \\placeholder \\end{gathered}\\right\\}":{img:"assets/images/toolbar/other/equations3.png",pos:{x:-10,y:-5},size:{width:56,height:60}},"\\lim\\limits_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/lim.png",pos:{x:0,y:0},size:{width:112,height:100}},"\\overset{\\placeholder}{\\underset{\\placeholder}{\\placeholder}}":{img:"assets/images/toolbar/other/over-under-set.png",pos:{x:0,y:0},size:{width:55,height:125}},"\\underset{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/underset.png",pos:{x:0,y:0},size:{width:55,height:125}},"\\overset{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/overset.png",pos:{x:0,y:0},size:{width:59,height:125}},"\\xrightarrow[\\placeholder]{\\placeholder}":{img:"assets/images/toolbar/arrow/xrightarrow.png",pos:{x:0,y:0},size:{width:51,height:57}},"\\left\\{\\begin{gathered} \\placeholder \\\\ \\placeholder \\end{gathered}\\right.":{pos:{x:3700,y:10},size:{width:56,height:60}},"\\left\\{\\begin{gathered} \\placeholder \\\\ \\placeholder \\\\ \\placeholder \\end{gathered}\\right.":{pos:{x:3765,y:10},size:{width:56,height:60}},"x=\\frac {-b\\pm\\sqrt {b^2-4ac}}{2a}":{pos:{x:0,y:0},size:{width:310,height:73}},"{\\placeholder/\\placeholder}":{pos:{x:315,y:0},size:{width:56,height:75}},"\\frac \\placeholder\\placeholder":{pos:{x:376,y:0},size:{width:56,height:75}},"a^2+b^2=c^2":{pos:{x:437,y:0},size:{width:310,height:73}},"{\\left(x+a\\right)}^2=\\sum^n_{k=0}{\\left(^n_k\\right)x^ka^{n-k}}":{pos:{x:752,y:0},size:{width:310,height:73}},"\\frac {dy}{dx}":{pos:{x:1067,y:0},size:{width:56,height:75}},"\\frac {\\Delta y}{\\Delta x}":{pos:{x:1128,y:0},size:{width:56,height:75}},"\\frac {\\delta y}{\\delta x}":{pos:{x:1189,y:0},size:{width:56,height:75}},"\\frac \\pi 2":{pos:{x:1250,y:0},size:{width:56,height:75}},"\\placeholder^\\placeholder":{pos:{x:1311,y:0},size:{width:56,height:75}},"\\placeholder^\\placeholder_\\placeholder":{pos:{x:1372,y:0},size:{width:56,height:75}},"\\placeholder_\\placeholder":{pos:{x:1433,y:0},size:{width:56,height:75}},"{^\\placeholder_\\placeholder\\placeholder}":{pos:{x:1494,y:0},size:{width:56,height:75}},"e^{-i\\omega t}":{pos:{x:1555,y:0},size:{width:56,height:75}},"x^2":{pos:{x:1616,y:0},size:{width:56,height:75}},"{}^n_1Y":{pos:{x:1677,y:0},size:{width:56,height:75}},"\\sqrt \\placeholder":{pos:{x:1738,y:0},size:{width:56,height:75}},"\\sqrt [\\placeholder] \\placeholder":{pos:{x:1799,y:0},size:{width:56,height:75}},"\\sqrt [2] \\placeholder":{pos:{x:1860,y:0},size:{width:56,height:75}},"\\sqrt [3] \\placeholder":{pos:{x:1921,y:0},size:{width:56,height:75}},"\\frac {-b\\pm\\sqrt{b^2-4ac}}{2a}":{pos:{x:1982,y:0},size:{width:137,height:75}},"\\sqrt {a^2+b^2}":{pos:{x:2124,y:0},size:{width:137,height:75}},"\\int \\placeholder":{pos:{x:2266,y:0},size:{width:56,height:75}},"\\int^\\placeholder_\\placeholder\\placeholder":{pos:{x:2327,y:0},size:{width:56,height:75}},"\\iint\\placeholder":{pos:{x:2388,y:0},size:{width:56,height:75}},"\\iint^\\placeholder_\\placeholder\\placeholder":{pos:{x:2449,y:0},size:{width:56,height:75}},"\\iiint\\placeholder":{pos:{x:2510,y:0},size:{width:56,height:75}},"\\iiint^\\placeholder_\\placeholder\\placeholder":{pos:{x:2571,y:0},size:{width:56,height:75}},"\\sum\\placeholder":{pos:{x:2632,y:0},size:{width:56,height:75}},"\\sum^\\placeholder_\\placeholder\\placeholder":{pos:{x:2693,y:0},size:{width:56,height:75}},"\\sum_\\placeholder\\placeholder":{pos:{x:2754,y:0},size:{width:56,height:75}},"\\left(\\placeholder\\right)":{pos:{x:2815,y:0},size:{width:56,height:75}},"\\left[\\placeholder\\right]":{pos:{x:2876,y:0},size:{width:56,height:75}},"\\left\\{\\placeholder\\right\\}":{pos:{x:2937,y:0},size:{width:56,height:75}},"\\left|\\placeholder\\right|":{pos:{x:2998,y:0},size:{width:56,height:75}},"\\sin\\placeholder":{pos:{x:3059,y:0},size:{width:56,height:75}},"\\cos\\placeholder":{pos:{x:3120,y:0},size:{width:56,height:75}},"\\tan\\placeholder":{pos:{x:3181,y:0},size:{width:56,height:75}},"\\csc\\placeholder":{pos:{x:3242,y:0},size:{width:56,height:75}},"\\sec\\placeholder":{pos:{x:3303,y:0},size:{width:56,height:75}},"\\cot\\placeholder":{pos:{x:3364,y:0},size:{width:56,height:75}},"\\arcsin\\placeholder":{img:"assets/images/toolbar/other/arcsin.png",pos:{x:719,y:5},size:{width:59,height:59}},"\\arccos\\placeholder":{img:"assets/images/toolbar/other/arcsin.png",pos:{x:774,y:5},size:{width:59,height:59}},"\\arctan\\placeholder":{img:"assets/images/toolbar/other/arcsin.png",pos:{x:833,y:5},size:{width:59,height:59}},"\\arccot\\placeholder":{image:"assets/images/toolbar/other/arcsin.png",pos:{x:10,y:64},size:{width:59,height:59}},"\\sin\\theta":{pos:{x:3425,y:0},size:{width:56,height:75}},"\\cos{2x}":{pos:{x:3486,y:0},size:{width:56,height:75}},"\\tan\\theta=\\frac {\\sin\\theta}{\\cos\\theta}":{pos:{x:3547,y:0},size:{width:137,height:75}},"\\bar{\\placeholder}":{img:"assets/images/toolbar/other/mean.png",pos:{x:0,y:0},size:{width:56,height:57}},"\\hat{\\placeholder}":{img:"assets/images/toolbar/other/hat.png",pos:{x:0,y:0},size:{width:56,height:57}},"\\widehat{\\placeholder}":{img:"assets/images/toolbar/other/widehat.png",pos:{x:0,y:0},size:{width:56,height:57}},"\\vec{\\placeholder}":{img:"assets/images/toolbar/other/vector.png",pos:{x:0,y:0},size:{width:56,height:57}},"\\prod{\\placeholder}":{img:"assets/images/toolbar/other/products.png",pos:{x:156,y:5},size:{width:59,height:59}},"\\prod^{\\placeholder}_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/products.png",pos:{x:215,y:5},size:{width:59,height:59}},"\\coprod^{\\placeholder}_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/products.png",pos:{x:332,y:5},size:{width:59,height:59}},"\\bigcup^{\\placeholder}_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/products.png",pos:{x:450,y:5},size:{width:59,height:59}},"\\bigcap^{\\placeholder}_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/products.png",pos:{x:509,y:5},size:{width:59,height:59}},"\\bigvee^{\\placeholder}_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/products.png",pos:{x:685,y:5},size:{width:59,height:59}},"\\bigwedge^{\\placeholder}_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/products.png",pos:{x:805,y:5},size:{width:59,height:59}},"\\lg{\\placeholder}":{img:"assets/images/toolbar/other/log.png",pos:{x:4,y:3},size:{width:59,height:59}},"\\log_{\\placeholder}{\\placeholder}":{img:"assets/images/toolbar/other/log.png",pos:{x:63,y:3},size:{width:59,height:59}},"\\ln{\\placeholder}":{img:"assets/images/toolbar/other/log.png",pos:{x:122,y:3},size:{width:59,height:59}},"\\xrightleftharpoons[\\placeholder]{\\placeholder}":{img:"assets/images/toolbar/other/doublearrow.png",pos:{x:0,y:0},size:{width:55,height:59}},"\\cancel{\\placeholder}":{img:"assets/images/toolbar/other/cancel.png",pos:{x:0,y:0},size:{width:55,height:59}}}}},_p[35]={value:function(require){function getIconContents(keySet,imgSrc){var result=[];return kity.Utils.each(keySet,function(key){key.length>1&&(key="\\"+key),result.push({key:key,img:imgSrc,pos:CHAR_POSITION[key]})}),result}var UI_ELE_TYPE=_p.r(41),BOX_TYPE=_p.r(40),CHAR_POSITION=_p.r(31),OTHER_POSITION=_p.r(34),kity=_p.r(21),config=[{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"预设<br/>",className:"yushe-btn",icon:{src:"assets/images/toolbar/btn.png",x:0,y:0},iconSize:{w:40}},box:{width:367,group:[{title:"预设公式",items:[{title:"预设公式",content:[{label:"二次公式",item:{val:"x=\\frac {-b\\pm\\sqrt {b^2-4ac}}{2a}"}},{label:"二项式定理",item:{val:"{\\left(x+a\\right)}^2=\\sum^n_{k=0}{\\left(^n_k\\right)x^ka^{n-k}}"}},{label:"勾股定理",item:{val:"a^2+b^2=c^2"}}]}]}]}}},{type:UI_ELE_TYPE.DELIMITER},{type:UI_ELE_TYPE.AREA,options:{box:{fixOffset:!0,width:527,type:BOX_TYPE.OVERLAP,group:[{title:"基础数学",items:[]},{title:"希腊字母",items:[]},{title:"求反关系运算符",items:[]},{title:"字母类符号",items:[]},{title:"箭头",items:[]},{title:"手写体",items:[]}]}}},{type:UI_ELE_TYPE.DELIMITER},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"分数<br/>",icon:{src:"assets/images/toolbar/btn.png",x:45,y:0}},box:{width:332,group:[{title:"分数",items:[{title:"分数",content:[{item:{val:"\\frac \\placeholder\\placeholder"}},{item:{val:"{\\placeholder/\\placeholder}"}}]},{title:"常用分数",content:[{item:{val:"\\frac {dy}{dx}"}},{item:{val:"\\frac {\\Delta y}{\\Delta x}"}},{item:{val:"\\frac {\\delta y}{\\delta x}"}},{item:{val:"\\frac \\pi 2"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"上下标<br/>",icon:{src:"assets/images/toolbar/btn.png",x:82,y:0}},box:{width:332,group:[{title:"上标和下标",items:[{title:"上标和下标",content:[{item:{val:"\\placeholder^\\placeholder"}},{item:{val:"\\placeholder_\\placeholder"}},{item:{val:"\\placeholder^\\placeholder_\\placeholder"}},{item:{val:"{^\\placeholder_\\placeholder\\placeholder}"}},{item:{val:"\\overset{\\placeholder}{\\placeholder}"}},{item:{val:"\\underset{\\placeholder}{\\placeholder}"}},{item:{val:"\\overset{\\placeholder}{\\underset{\\placeholder}{\\placeholder}}"}}]},{title:"常用的上标和下标",content:[{item:{val:"e^{-i\\omega t}"}},{item:{val:"x^2"}},{item:{val:"{}^n_1Y"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"根式<br/>",icon:{src:"assets/images/toolbar/btn.png",x:119,y:0}},box:{width:342,group:[{title:"根式",items:[{title:"根式",content:[{item:{val:"\\sqrt \\placeholder"}},{item:{val:"\\sqrt [\\placeholder] \\placeholder"}},{item:{val:"\\sqrt [2] \\placeholder"}},{item:{val:"\\sqrt [3] \\placeholder"}}]},{title:"常用根式",content:[{item:{val:"\\frac {-b\\pm\\sqrt{b^2-4ac}}{2a}"}},{item:{val:"\\sqrt {a^2+b^2}"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"积分<br/>",icon:{src:"assets/images/toolbar/btn.png",x:156,y:0}},box:{width:332,group:[{title:"积分",items:[{title:"积分",content:[{item:{val:"\\int \\placeholder"}},{item:{val:"\\int^\\placeholder_\\placeholder\\placeholder"}},{item:{val:"\\iint\\placeholder"}},{item:{val:"\\iint^\\placeholder_\\placeholder\\placeholder"}},{item:{val:"\\iiint\\placeholder"}},{item:{val:"\\iiint^\\placeholder_\\placeholder\\placeholder"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"大型<br/>运算符",icon:{src:"assets/images/toolbar/btn.png",x:193,y:0}},box:{width:332,group:[{title:"求和积/集合运算",items:[{title:"求和",content:[{item:{val:"\\sum\\placeholder"}},{item:{val:"\\sum^\\placeholder_\\placeholder\\placeholder"}},{item:{val:"\\sum_\\placeholder\\placeholder"}}]},{title:"求积",content:[{item:{val:"\\prod{\\placeholder}"}},{item:{val:"\\prod^{\\placeholder}_{\\placeholder}{\\placeholder}"}},{item:{val:"\\coprod^{\\placeholder}_{\\placeholder}{\\placeholder}"}}]},{title:"集合",content:[{item:{val:"\\bigcup^{\\placeholder}_{\\placeholder}{\\placeholder}"}},{item:{val:"\\bigcap^{\\placeholder}_{\\placeholder}{\\placeholder}"}},{item:{val:"\\bigvee^{\\placeholder}_{\\placeholder}{\\placeholder}"}},{item:{val:"\\bigwedge^{\\placeholder}_{\\placeholder}{\\placeholder}"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"括号<br/>",icon:{src:"assets/images/toolbar/btn.png",x:230,y:0}},box:{width:332,group:[{title:"方括号",items:[{title:"方括号",content:[{item:{val:"\\left(\\placeholder\\right)"}},{item:{val:"\\left[\\placeholder\\right]"}},{item:{val:"\\left\\{\\placeholder\\right\\}"}},{item:{val:"\\left|\\placeholder\\right|"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"函数<br/>",icon:{src:"assets/images/toolbar/btn.png",x:267,y:0}},box:{width:340,group:[{title:"函数",items:[{title:"三角函数",content:[{item:{val:"\\sin\\placeholder"}},{item:{val:"\\cos\\placeholder"}},{item:{val:"\\tan\\placeholder"}},{item:{val:"\\csc\\placeholder"}},{item:{val:"\\sec\\placeholder"}},{item:{val:"\\cot\\placeholder"}},{item:{val:"\\lim\\limits_{\\placeholder}{\\placeholder}"}}]},{title:"反三角函数",content:[{item:{val:"\\arcsin\\placeholder"}},{item:{val:"\\arccos\\placeholder"}},{item:{val:"\\arctan\\placeholder"}}]},{title:"对数函数",content:[{item:{val:"\\lg{\\placeholder}"}},{item:{val:"\\log_{\\placeholder}{\\placeholder}"}},{item:{val:"\\ln{\\placeholder}"}}]},{title:"常用函数",content:[{item:{val:"\\sin\\theta"}},{item:{val:"\\cos{2x}"}},{item:{val:"\\tan\\theta=\\frac {\\sin\\theta}{\\cos\\theta}"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"方程组<br/>",icon:{src:"assets/images/toolbar/btn.png",x:390,y:0}},box:{width:332,group:[{title:"方程组",items:[{title:"方程组",content:[{item:{val:"\\left\\{\\begin{gathered} \\placeholder \\\\ \\placeholder \\end{gathered}\\right."}},{item:{val:"\\left\\{\\begin{gathered} \\placeholder \\\\ \\placeholder \\\\ \\placeholder \\end{gathered}\\right."}},{item:{val:"\\left.\\begin{gathered} \\placeholder \\\\ \\placeholder \\end{gathered}\\right\\}"}},{item:{val:"\\left.\\begin{gathered} \\placeholder \\\\ \\placeholder \\\\ \\placeholder \\end{gathered}\\right\\}"}}]}]}]}}},{type:UI_ELE_TYPE.DRAPDOWN_BOX,options:{button:{label:"其它<br/>",icon:{src:"assets/images/toolbar/other-group.png",x:4,y:0}},box:{width:332,group:[{title:"箭头",items:[{title:"可伸缩的箭头",content:[{item:{val:"\\xrightarrow[\\placeholder]{\\placeholder}"}},{item:{val:"\\underrightarrow{\\placeholder}"}},{item:{val:"\\overrightarrow{\\placeholder}"}},{item:{val:"\\bar{\\placeholder}"}},{item:{val:"\\hat{\\placeholder}"}},{item:{val:"\\widehat{\\placeholder}"}},{item:{val:"\\vec{\\placeholder}"}},{item:{val:"\\cancel{\\placeholder}"}},{item:{val:"\\xrightleftharpoons[\\placeholder]{\\placeholder}"}}]}]}]}}}];return function(){var tmp=[],currentConf=[];kity.Utils.each(config,function(conf){conf.type!==UI_ELE_TYPE.DELIMITER&&(conf=conf.options.box.group,tmp=tmp.concat(conf))}),kity.Utils.each(tmp,function(conf){conf=conf.items;for(var i=0,len=conf.length;i<len;i++)currentConf=currentConf.concat(conf[i].content)}),kity.Utils.each(currentConf,function(conf){var data=OTHER_POSITION[conf.item.val];data&&(conf.item.img=data.img||"assets/images/toolbar/other.png",conf.item.pos=data.pos,conf.item.size=data.size)})}(),function(){var list=["pm","infty","=","sim","times","div","!","<","ll",">","gg","leq","geq","mp","cong","equiv","propto","approx","forall","partial","surd","cup","cap","subseteq","supseteq","subset","supset","subsetneqq","supsetneqq","varnothing","%","circ","exists","nexists","in","ni","gets","uparrow","to","downarrow","leftrightarrow","therefore","because","+","-","neg","ast","cdot","vdots","aleph","beth","blacksquare","bot"];config[2].options.box.group[0].items.push({title:"基础数学",content:getIconContents(list,"assets/images/toolbar/char.png")})}(),function(){var greekList=[{title:"小写",values:["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]},{title:"大写",values:["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"]},{title:"变体",values:["digamma","varepsilon","varkappa","varphi","varpi","varrho","varsigma","vartheta"]}],greekConfigList=config[2].options.box.group[1].items;greekConfigList.push({title:greekList[0].title,content:getIconContents(greekList[0].values,"assets/images/toolbar/char.png")}),greekConfigList.push({title:greekList[1].title,content:getIconContents(greekList[1].values,"assets/images/toolbar/char.png")}),greekConfigList.push({title:greekList[2].title,content:getIconContents(greekList[2].values,"assets/images/toolbar/char.png")})}(),function(){var greekList=[{title:"求反关系运算符",values:["neq","nless","ngtr","nleq","ngeq","nsim","lneqq","gneqq","nprec","nsucc","notin","nsubseteq","nsupseteq","subsetneq","supsetneq","lnsim","gnsim","precnsim","succnsim","ntriangleleft","ntriangleright","ntrianglelefteq","ntrianglerighteq","nmid","nparallel","nvdash","nVdash","nvDash","nVDash","nexists"]}];config[2].options.box.group[2].items.push({title:greekList[0].title,content:getIconContents(greekList[0].values,"assets/images/toolbar/char.png")})}(),function(){var list=["aleph","beth","daleth","gimel","complement","ell","eth","hbar","hslash","mho","partial","wp","circledS","Bbbk","Finv","Game","Im","Re"];config[2].options.box.group[3].items.push({title:"字母类符号",content:getIconContents(list,"assets/images/toolbar/char.png")})}(),function(){var list=["gets","to","uparrow","downarrow","leftrightarrow","updownarrow","Leftarrow","Rightarrow","Uparrow","Downarrow","Leftrightarrow","Updownarrow","longleftarrow","longrightarrow","longleftrightarrow","Longleftarrow","Longrightarrow","Longleftrightarrow","nearrow","nwarrow","searrow","swarrow","nleftarrow","nrightarrow","nLeftarrow","nRightarrow","nLeftrightarrow","leftharpoonup","leftharpoondown","rightharpoonup","rightharpoondown","upharpoonleft","upharpoonright","downharpoonleft","downharpoonright","leftrightharpoons","rightleftharpoons","leftleftarrows","rightrightarrows","upuparrows","downdownarrows","leftrightarrows","rightleftarrows","looparrowleft","looparrowright","leftarrowtail","rightarrowtail","Lsh","Rsh","Lleftarrow","Rrightarrow","curvearrowleft","curvearrowright","circlearrowleft","circlearrowright","multimap","leftrightsquigarrow","twoheadleftarrow","twoheadrightarrow","rightsquigarrow"];config[2].options.box.group[4].items.push({title:"箭头",content:getIconContents(list,"assets/images/toolbar/char.png")})}(),function(){var list=[{title:"手写体",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{title:"花体",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]},{title:"双线",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{title:"罗马",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]}],configList=config[2].options.box.group[5].items;kity.Utils.each(list[0].values,function(item,index){list[0].values[index]="mathcal{"+item+"}"}),kity.Utils.each(list[1].values,function(item,index){list[1].values[index]="mathfrak{"+item+"}"}),kity.Utils.each(list[2].values,function(item,index){list[2].values[index]="mathbb{"+item+"}"}),kity.Utils.each(list[3].values,function(item,index){list[3].values[index]="mathrm{"+item+"}"}),configList.push({title:list[0].title,content:getIconContents(list[0].values,"assets/images/toolbar/char.png")}),configList.push({title:list[1].title,content:getIconContents(list[1].values,"assets/images/toolbar/char.png")}),configList.push({title:list[2].title,content:getIconContents(list[2].values,"assets/images/toolbar/char.png")}),configList.push({title:list[3].title,content:getIconContents(list[3].values,"assets/images/toolbar/char.png")})}(),config}},_p[36]={value:function(require){function createElement(type,doc,options){switch(type){case UI_ELE_TYPE.DRAPDOWN_BOX:return createDrapdownBox(doc,options);case UI_ELE_TYPE.DELIMITER:return createDelimiter(doc);case UI_ELE_TYPE.AREA:return createArea(doc,options)}}function createDrapdownBox(doc,options){return new UiImpl.DrapdownBox(doc,options)}function createDelimiter(doc){return new UiImpl.Delimiter(doc)}function createArea(doc,options){return new UiImpl.Area(doc,options)}var kity=_p.r(21),UiImpl=_p.r(48),$$=_p.r(47),UI_ELE_TYPE=_p.r(41);return kity.createClass("Tollbar",{constructor:function(uiComponent,kfEditor,elementList){this.kfEditor=kfEditor,this.uiComponent=uiComponent,this.elementList=elementList,this.elements=[],this.initToolbarElements(),this.initServices(),this.initEvent()},initServices:function(){this.kfEditor.registerService("ui.toolbar.disable",this,{disableToolbar:this.disableToolbar}),this.kfEditor.registerService("ui.toolbar.enable",this,{enableToolbar:this.enableToolbar}),this.kfEditor.registerService("ui.toolbar.close",this,{closeToolbar:this.closeToolbar})},initEvent:function(){var _self=this;$$.on(this.uiComponent.toolbarContainer,"mousedown",function(e){e.preventDefault()}),$$.on(this.uiComponent.toolbarContainer,"mousewheel",function(e){e.preventDefault()}),$$.on(this.kfEditor.getContainer(),"mousedown",function(){_self.notify("closeAll")}),$$.subscribe("data.select",function(data){_self.insertSource(data)})},insertSource:function(val){this.kfEditor.requestService("control.insert.string",val)},disableToolbar:function(){kity.Utils.each(this.elements,function(ele){ele.disable&&ele.disable()})},enableToolbar:function(){kity.Utils.each(this.elements,function(ele){ele.enable&&ele.enable()})},getContainer:function(){return this.kfEditor.requestService("ui.get.canvas.container")},closeToolbar:function(){this.closeElement()},notify:function(type){switch(type){case"closeAll":case"closeOther":return void this.closeElement(arguments[1])}},closeElement:function(exception){kity.Utils.each(this.elements,function(ele){ele!=exception&&ele.hide&&ele.hide()})},initToolbarElements:function(){var elements=this.elements,doc=this.uiComponent.toolbarContainer.ownerDocument,_self=this;kity.Utils.each(this.elementList,function(eleInfo,i){var ele=createElement(eleInfo.type,doc,eleInfo.options);elements.push(ele),_self.appendElement(ele)})},appendElement:function(uiElement){uiElement.setToolbar(this),uiElement.attachTo(this.uiComponent.toolbarContainer)}})}},_p[37]={value:function(require){var kity=_p.r(21),PREFIX="kf-editor-ui-",$$=_p.r(47),Box=_p.r(38);return kity.createClass("Area",{constructor:function(doc,options){this.options=options,this.doc=doc,this.toolbar=null,this.disabled=!0,this.panelIndex=0,this.maxPanelIndex=0,this.currentItemCount=0,this.lineMaxCount=9,this.element=this.createArea(),this.container=this.createContainer(),this.panel=this.createPanel(),this.buttonContainer=this.createButtonContainer(),this.button=this.createButton(),this.mountPoint=this.createMountPoint(),this.moveDownButton=this.createMoveDownButton(),this.moveUpButton=this.createMoveUpButton(),this.boxObject=this.createBox(),this.mergeElement(),this.mount(),this.setListener(),this.initEvent()},initEvent:function(){var _self=this
;$$.on(this.button,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1!==e.which||_self.disabled||(_self.showMount(),_self.toolbar.notify("closeOther",_self))}),$$.on(this.moveDownButton,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1!==e.which||_self.disabled||(_self.nextPanel(),_self.toolbar.notify("closeOther",_self))}),$$.on(this.moveUpButton,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1!==e.which||_self.disabled||(_self.prevPanel(),_self.toolbar.notify("closeOther",_self))}),$$.delegate(this.container,".kf-editor-ui-area-item","mousedown",function(e){e.preventDefault(),1!==e.which||_self.disabled||$$.publish("data.select",this.getAttribute("data-value"))}),this.boxObject.initEvent()},disable:function(){this.disabled=!0,this.boxObject.disable(),$$.getClassList(this.element).remove(PREFIX+"enabled")},enable:function(){this.disabled=!1,this.boxObject.enable(),$$.getClassList(this.element).add(PREFIX+"enabled")},setListener:function(){var _self=this;this.boxObject.setSelectHandler(function(val){$$.publish("data.select",val),_self.hide()}),this.boxObject.setChangeHandler(function(index){_self.updateContent()})},createArea:function(){var areaNode=$$.ele(this.doc,"div",{className:PREFIX+"area"});return"width"in this.options&&(areaNode.style.width=this.options.width+"px"),areaNode},checkMaxPanelIndex:function(){this.maxPanelIndex=Math.ceil(this.currentItemCount/this.lineMaxCount/2)},updateContent:function(){var items=this.boxObject.getOverlapContent(),count=0,style=null,lineno=0,colno=0,lineMaxCount=this.lineMaxCount,newContent=[];this.panel.innerHTML="",kity.Utils.each(items,function(item){var contents=item.content;kity.Utils.each(contents,function(currentContent,index){lineno=Math.floor(count/lineMaxCount),colno=count%lineMaxCount,count++,style="top: "+(33*lineno+5)+"px; left: "+(32*colno+5)+"px;",newContent.push('<div class="'+PREFIX+'area-item" data-value="'+currentContent.key+'" style="'+style+'"><div class="'+PREFIX+'area-item-inner"><div class="'+PREFIX+'area-item-img" style="background: url('+currentContent.img+") no-repeat "+-currentContent.pos.x+"px "+-currentContent.pos.y+'px;"></div></div></div>')})}),this.currentItemCount=count,this.panelIndex=0,this.panel.style.top=0,this.panel.innerHTML=newContent.join(""),this.checkMaxPanelIndex(),this.updatePanelButtonState()},mount:function(){this.boxObject.mountTo(this.mountPoint)},showMount:function(){this.mountPoint.style.display="block",this.boxObject.updateSize()},hideMount:function(){this.mountPoint.style.display="none"},hide:function(){this.hideMount(),this.boxObject.hide()},createButton:function(){return $$.ele(this.doc,"div",{className:PREFIX+"area-button"})},createMoveDownButton:function(){return $$.ele(this.doc,"div",{className:PREFIX+"movedown-button",content:""})},createMoveUpButton:function(){return $$.ele(this.doc,"div",{className:PREFIX+"moveup-button",content:""})},createMountPoint:function(){return $$.ele(this.doc,"div",{className:PREFIX+"area-mount"})},createBox:function(){return new Box(this.doc,this.options.box)},createContainer:function(){return $$.ele(this.doc,"div",{className:PREFIX+"area-container"})},createPanel:function(){return $$.ele(this.doc,"div",{className:PREFIX+"area-panel"})},createButtonContainer:function(){return $$.ele(this.doc,"div",{className:PREFIX+"area-button-container"})},mergeElement:function(){this.buttonContainer.appendChild(this.moveUpButton),this.buttonContainer.appendChild(this.moveDownButton),this.buttonContainer.appendChild(this.button),this.container.appendChild(this.panel),this.element.appendChild(this.container),this.element.appendChild(this.buttonContainer),this.element.appendChild(this.mountPoint)},disablePanelUp:function(){this.disabledUp=!0,$$.getClassList(this.moveUpButton).add("kf-editor-ui-disabled")},enablePanelUp:function(){this.disabledUp=!1,$$.getClassList(this.moveUpButton).remove("kf-editor-ui-disabled")},disablePanelDown:function(){this.disabledDown=!0,$$.getClassList(this.moveDownButton).add("kf-editor-ui-disabled")},enablePanelDown:function(){this.disabledDown=!1,$$.getClassList(this.moveDownButton).remove("kf-editor-ui-disabled")},updatePanelButtonState:function(){0===this.panelIndex?this.disablePanelUp():this.enablePanelUp(),this.panelIndex+1>=this.maxPanelIndex?this.disablePanelDown():this.enablePanelDown()},nextPanel:function(){this.disabledDown||this.panelIndex+1>=this.maxPanelIndex||(this.panelIndex++,this.panel.style.top=66*-this.panelIndex+"px",this.updatePanelButtonState())},prevPanel:function(){this.disabledUp||0!==this.panelIndex&&(this.panelIndex--,this.panel.style.top=66*-this.panelIndex+"px",this.updatePanelButtonState())},setToolbar:function(toolbar){this.toolbar=toolbar,this.boxObject.setToolbar(toolbar)},attachTo:function(container){container.appendChild(this.element),this.updateContent(),this.updatePanelButtonState()}})}},_p[38]={value:function(require){function createItems(doc,group,type){var items=[];return kity.Utils.each(group,function(itemVal,i){items.push(new BoxItem(type,doc,itemVal))}),items}function createOverlapContainer(doc){return $$.ele(doc,"div",{className:PREFIX+"overlap-container"})}function createOverlapButton(doc,options){return new Button(doc,{className:"overlap-button",label:"",fixOffset:options.fixOffset})}function createOverlapList(doc,list){return new List(doc,list)}function getRectBox(node){return node.getBoundingClientRect()}function getStyleByData(data){var style="background: url( "+data.img+" ) no-repeat ";return style+=-data.pos.x+"px ",style+=-data.pos.y+"px;",style+=" width: "+data.size.width+"px;",style+=" height: "+data.size.height+"px;"}var kity=_p.r(21),PREFIX="kf-editor-ui-",$$=_p.r(47),BOX_TYPE=_p.r(40),ITEM_TYPE=_p.r(42),Button=_p.r(39),List=_p.r(45),Box=kity.createClass("Box",{constructor:function(doc,options){this.options=options,this.toolbar=null,this.options.type=this.options.type||BOX_TYPE.DETACHED,this.doc=doc,this.itemPanels=null,this.overlapButtonObject=null,this.overlapIndex=-1,this.element=this.createBox(),this.groupContainer=this.createGroupContainer(),this.itemGroups=this.createItemGroup(),this.mergeElement()},createBox:function(){var boxNode=$$.ele(this.doc,"div",{className:PREFIX+"box"});return"width"in this.options&&(boxNode.style.width=this.options.width+"px"),boxNode},setToolbar:function(toolbar){this.toolbar=toolbar,this.overlapButtonObject&&this.overlapButtonObject.setToolbar(toolbar)},updateSize:function(){var containerBox=$$.getRectBox(this.toolbar.getContainer()),curBox=$$.getRectBox(this.element);if(this.options.type===BOX_TYPE.DETACHED){if(curBox.bottom<=containerBox.bottom)return void(this.element.scrollTop=0);this.element.style.height=curBox.height-(curBox.bottom-containerBox.bottom+30)+"px"}else{var panel=this.getCurrentItemPanel(),panelRect=null;if(panel.scrollTop=0,curBox.bottom<=containerBox.bottom)return;panelRect=getRectBox(panel),panel.style.height=containerBox.bottom-panelRect.top-30+"px"}},initEvent:function(){var className="."+PREFIX+"box-item",_self=this;$$.delegate(this.groupContainer,className,"mousedown",function(e){e.preventDefault(),1===e.which&&_self.onselectHandler&&_self.onselectHandler(this.getAttribute("data-value"))}),$$.on(this.element,"mousedown",function(e){e.stopPropagation(),e.preventDefault()}),$$.on(this.element,"mousewheel",function(e){e.preventDefault(),e.stopPropagation(),_self.scroll(e.originalEvent.wheelDelta)})},getNode:function(){return this.element},setSelectHandler:function(onselectHandler){this.onselectHandler=onselectHandler},scroll:function(delta){delta<0?this.scrollDown():(this.scrollUp(),this.element.scrollTop-=20)},scrollDown:function(){this.options.type===BOX_TYPE.DETACHED?this.element.scrollTop+=20:this.getCurrentItemPanel().scrollTop+=20},scrollUp:function(){this.options.type===BOX_TYPE.DETACHED?this.element.scrollTop-=20:this.getCurrentItemPanel().scrollTop-=20},setChangeHandler:function(changeHandler){this.onchangeHandler=changeHandler},onchangeHandler:function(index){},createGroupContainer:function(){return $$.ele(this.doc,"div",{className:PREFIX+"box-container"})},getPositionInfo:function(){return $$.getRectBox(this.element)},createItemGroup:function(){var itemGroup=this.createGroup();switch(this.options.type){case BOX_TYPE.DETACHED:return itemGroup.items[0];case BOX_TYPE.OVERLAP:return this.createOverlapGroup(itemGroup)}return null},enable:function(){this.overlapButtonObject&&this.overlapButtonObject.enable()},disable:function(){this.overlapButtonObject&&this.overlapButtonObject.disable()},hide:function(){this.overlapButtonObject&&this.overlapButtonObject.hideMount()},getOverlapContent:function(){return this.options.type!==BOX_TYPE.OVERLAP?null:this.options.group[this.overlapIndex].items},createOverlapGroup:function(itemGroup){var classifyList=itemGroup.title,_self=this,overlapContainer=createOverlapContainer(this.doc),overlapButtonObject=createOverlapButton(this.doc,{fixOffset:this.options.fixOffset}),overlapListObject=createOverlapList(this.doc,{width:150,items:classifyList}),wrapNode=$$.ele(this.doc,"div",{className:PREFIX+"wrap-group"});return this.overlapButtonObject=overlapButtonObject,overlapButtonObject.mount(overlapListObject),overlapButtonObject.initEvent(),overlapListObject.initEvent(),kity.Utils.each(itemGroup.items,function(itemArr,index){var itemWrapNode=wrapNode.cloneNode(!1);kity.Utils.each(itemArr,function(item){itemWrapNode.appendChild(item)}),itemGroup.items[index]=itemWrapNode}),this.itemPanels=itemGroup.items,overlapListObject.setSelectHandler(function(index,oldIndex){_self.overlapIndex=index,overlapButtonObject.setLabel(classifyList[index]),overlapButtonObject.hideMount(),itemGroup.items[oldIndex].style.display="none",itemGroup.items[index].style.display="block",index!==oldIndex&&_self.updateSize(),_self.onchangeHandler(index)}),overlapContainer.appendChild(overlapButtonObject.getNode()),kity.Utils.each(itemGroup.items,function(group,index){index>0&&(group.style.display="none"),overlapContainer.appendChild(group)}),overlapListObject.select(0),[overlapContainer]},getCurrentItemPanel:function(){return this.itemPanels[this.overlapIndex]},getGroupList:function(){var lists=[];return kity.Utils.each(this.options.group,function(group,index){lists.push(group.title)}),{width:150,items:lists}},createGroup:function(){var doc=this.doc,itemGroup=[],result={title:[],items:[]},groupNode=null,groupTitle=null,itemType=BOX_TYPE.DETACHED===this.options.type?ITEM_TYPE.BIG:ITEM_TYPE.SMALL,itemContainer=null;return groupNode=$$.ele(this.doc,"div",{className:PREFIX+"box-group"}),itemContainer=groupNode.cloneNode(!1),itemContainer.className=PREFIX+"box-group-item-container",kity.Utils.each(this.options.group,function(group,i){result.title.push(group.title||""),itemGroup=[],kity.Utils.each(group.items,function(item){groupNode=groupNode.cloneNode(!1),itemContainer=itemContainer.cloneNode(!1),groupTitle=$$.ele(doc,"div",{className:PREFIX+"box-group-title",content:item.title}),groupNode.appendChild(groupTitle),groupNode.appendChild(itemContainer),kity.Utils.each(createItems(doc,item.content,itemType),function(boxItem){boxItem.appendTo(itemContainer)}),itemGroup.push(groupNode)}),result.items.push(itemGroup)}),result},mergeElement:function(){var groupContainer=this.groupContainer;this.element.appendChild(groupContainer),kity.Utils.each(this.itemGroups,function(group){groupContainer.appendChild(group)})},mountTo:function(container){container.appendChild(this.element)},appendTo:function(container){container.appendChild(this.element)}}),BoxItem=kity.createClass("BoxItem",{constructor:function(type,doc,options){this.type=type,this.doc=doc,this.options=options,this.element=this.createItem(),this.labelNode=this.createLabel(),this.contentNode=this.createContent(),this.mergeElement()},getNode:function(){return this.element},createItem:function(){return $$.ele(this.doc,"div",{className:PREFIX+"box-item"})},createLabel:function(){if("label"in this.options)return $$.ele(this.doc,"div",{className:PREFIX+"box-item-label",content:this.options.label})},getContent:function(){},createContent:function(){switch(this.type){case ITEM_TYPE.BIG:return this.createBigContent();case ITEM_TYPE.SMALL:return this.createSmallContent()}},createBigContent:function(){var doc=this.doc,contentNode=$$.ele(doc,"div",{className:PREFIX+"box-item-content"}),cls=PREFIX+"box-item-val",tmpContent=this.options.item,tmpNode=null,styleStr=getStyleByData(tmpContent);return tmpNode=$$.ele(doc,"div",{className:cls}),tmpNode.innerHTML='<div class="'+PREFIX+'item-image" style="'+styleStr+'"></div>',this.element.setAttribute("data-value",tmpContent.val),contentNode.appendChild(tmpNode),contentNode},createSmallContent:function(){var doc=this.doc,contentNode=$$.ele(doc,"div",{className:PREFIX+"box-item-content"}),cls=PREFIX+"box-item-val",tmpContent=this.options,tmpNode=null;return tmpNode=$$.ele(doc,"div",{className:cls}),tmpNode.style.background="url( "+tmpContent.img+" )",tmpNode.style.backgroundPosition=-tmpContent.pos.x+"px "+-tmpContent.pos.y+"px",this.element.setAttribute("data-value",tmpContent.key),contentNode.appendChild(tmpNode),contentNode},mergeElement:function(){this.labelNode&&this.element.appendChild(this.labelNode),this.element.appendChild(this.contentNode)},appendTo:function(container){container.appendChild(this.element)}});return Box}},_p[39]={value:function(require){function getBackgroundStyle(data){var style="url( "+data.src+" ) no-repeat ";return style+=-data.x+"px ",style+=-data.y+"px"}var kity=_p.r(21),PREFIX="kf-editor-ui-",DEFAULT_OPTIONS={iconSize:{w:32,h:32}},$$=_p.r(47);return kity.createClass("Button",{constructor:function(doc,options){this.options=kity.Utils.extend({},DEFAULT_OPTIONS,options),this.eventState=!1,this.toolbar=null,this.displayState=!1,this.fixOffset=options.fixOffset||!1,this.doc=doc,this.element=this.createButton(),this.disabled=!0,this.mountElement=null,this.icon=this.createIcon(),this.label=this.createLabel(),this.sign=this.createSign(),this.mountPoint=this.createMountPoint(),this.mergeElement()},initEvent:function(){var _self=this;this.eventState||(this.eventState=!0,$$.on(this.element,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1===e.which&&(_self.disabled||(_self.toggleSelect(),_self.toggleMountElement()))}))},setToolbar:function(toolbar){this.toolbar=toolbar},toggleMountElement:function(){this.displayState?this.hideMount():this.showMount()},setLabel:function(labelText){var signText="";this.sign&&(signText='<div class="'+PREFIX+'button-sign"></div>'),this.label.innerHTML=labelText+signText},toggleSelect:function(){$$.getClassList(this.element).toggle(PREFIX+"button-in")},unselect:function(){$$.getClassList(this.element).remove(PREFIX+"button-in")},select:function(){$$.getClassList(this.element).add(PREFIX+"button-in")},show:function(){this.select(),this.showMount()},hide:function(){this.unselect(),this.hideMount()},showMount:function(){if(this.displayState=!0,this.mountPoint.style.display="block",this.fixOffset){var elementRect=this.element.getBoundingClientRect();this.mountElement.setOffset(elementRect.left+7,elementRect.bottom)}var editorContainer=this.toolbar.getContainer(),currentBox=null,containerBox=$$.getRectBox(editorContainer),mountEleBox=this.mountElement.getPositionInfo();mountEleBox.right>containerBox.right&&(currentBox=$$.getRectBox(this.element),this.mountPoint.style.left=currentBox.right-mountEleBox.right-1+"px"),this.mountElement.updateSize&&this.mountElement.updateSize()},hideMount:function(){this.displayState=!1,this.mountPoint.style.display="none"},getNode:function(){return this.element},mount:function(element){this.mountElement=element,element.mountTo(this.mountPoint)},createButton:function(){var buttonNode=$$.ele(this.doc,"div",{className:PREFIX+"button"});return this.options.className&&(buttonNode.className+=" "+PREFIX+this.options.className),buttonNode},createIcon:function(){if(!this.options.icon)return null;var iconNode=$$.ele(this.doc,"div",{className:PREFIX+"button-icon"});return"string"==typeof this.options.icon?iconNode.style.backgroundImage="url("+this.options.icon+") no-repeat":iconNode.style.background=getBackgroundStyle(this.options.icon),this.options.iconSize.w&&(iconNode.style.width=this.options.iconSize.w+"px"),this.options.iconSize.h&&(iconNode.style.height=this.options.iconSize.h+"px"),iconNode},createLabel:function(){return $$.ele(this.doc,"div",{className:PREFIX+"button-label",content:this.options.label})},createSign:function(){return!1===this.options.sign?null:$$.ele(this.doc,"div",{className:PREFIX+"button-sign"})},createMountPoint:function(){return $$.ele(this.doc,"div",{className:PREFIX+"button-mount-point"})},disable:function(){this.disabled=!0,$$.getClassList(this.element).remove(PREFIX+"enabled")},enable:function(){this.disabled=!1,$$.getClassList(this.element).add(PREFIX+"enabled")},mergeElement:function(){this.icon&&this.element.appendChild(this.icon),this.element.appendChild(this.label),this.sign&&this.label.appendChild(this.sign),this.element.appendChild(this.mountPoint)}})}},_p[40]={value:function(require){return{DETACHED:1,OVERLAP:2}}},_p[41]={value:function(require){return{DRAPDOWN_BOX:1,AREA:2,DELIMITER:3}}},_p[42]={value:function(require){return{BIG:1,SMALL:2}}},_p[43]={value:function(require){var kity=_p.r(21),$$=_p.r(47);return kity.createClass("Delimiter",{constructor:function(doc){this.doc=doc,this.element=this.createDilimiter()},setToolbar:function(toolbar){},createDilimiter:function(){var dilimiterNode=$$.ele(this.doc,"div",{className:"kf-editor-ui-delimiter"});return dilimiterNode.appendChild($$.ele(this.doc,"div",{className:"kf-editor-ui-delimiter-line"})),dilimiterNode},attachTo:function(container){container.appendChild(this.element)}})}},_p[44]={value:function(require){var kity=_p.r(21),$$=_p.r(47),Button=_p.r(39),Box=_p.r(38);return kity.createClass("DrapdownBox",{constructor:function(doc,options){this.options=options,this.toolbar=null,this.doc=doc,this.buttonElement=this.createButton(),this.element=this.buttonElement.getNode(),this.boxElement=this.createBox(),this.buttonElement.mount(this.boxElement),this.initEvent()},initEvent:function(){var _self=this;$$.on(this.element,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),_self.toolbar.notify("closeOther",_self)}),this.buttonElement.initEvent(),this.boxElement.initEvent(),this.boxElement.setSelectHandler(function(val){$$.publish("data.select",val),_self.buttonElement.hide()})},disable:function(){this.buttonElement.disable()},enable:function(){this.buttonElement.enable()},setToolbar:function(toolbar){this.toolbar=toolbar,this.buttonElement.setToolbar(toolbar),this.boxElement.setToolbar(toolbar)},createButton:function(){return new Button(this.doc,this.options.button)},show:function(){this.buttonElement.show()},hide:function(){this.buttonElement.hide()},createBox:function(){return new Box(this.doc,this.options.box)},attachTo:function(container){container.appendChild(this.element)}})}},_p[45]={value:function(require){var kity=_p.r(21),PREFIX="kf-editor-ui-",$$=_p.r(47);return kity.createClass("List",{constructor:function(doc,options){this.options=options,this.doc=doc,this.onselectHandler=null,this.currentSelect=-1,this.element=this.createBox(),this.itemGroups=this.createItems(),this.mergeElement()},onselectHandler:function(index,oldIndex){},setSelectHandler:function(selectHandler){this.onselectHandler=selectHandler},createBox:function(){var boxNode=$$.ele(this.doc,"div",{className:PREFIX+"list"}),bgNode=$$.ele(this.doc,"div",{className:PREFIX+"list-bg"});return"width"in this.options&&(boxNode.style.width=this.options.width+"px"),boxNode.appendChild(bgNode),boxNode},select:function(index){var oldSelect=this.currentSelect;-1===oldSelect&&(oldSelect=index),this.unselect(oldSelect),this.currentSelect=index,$$.getClassList(this.itemGroups.items[index]).add(PREFIX+"list-item-select"),this.onselectHandler(index,oldSelect)},unselect:function(index){$$.getClassList(this.itemGroups.items[index]).remove(PREFIX+"list-item-select")},setOffset:function(x,y){this.element.style.left=x+"px",this.element.style.top=y+"px"},initEvent:function(){var _self=this;$$.delegate(this.itemGroups.container,"."+PREFIX+"list-item","mousedown",function(e){e.preventDefault(),1===e.which&&_self.select(this.getAttribute("data-index"))}),$$.on(this.element,"mousedown",function(e){e.stopPropagation(),e.preventDefault()})},getPositionInfo:function(){return $$.getRectBox(this.element)},createItems:function(){var doc=this.doc,groupNode=null,itemNode=null,iconNode=null,items=[],itemContainer=null;return groupNode=$$.ele(this.doc,"div",{className:PREFIX+"list-item"}),itemContainer=groupNode.cloneNode(!1),itemContainer.className=PREFIX+"list-item-container",kity.Utils.each(this.options.items,function(itemText,i){itemNode=groupNode.cloneNode(!1),iconNode=groupNode.cloneNode(!1),iconNode.className=PREFIX+"list-item-icon",itemNode.appendChild(iconNode),itemNode.appendChild($$.ele(doc,"text",itemText)),itemNode.setAttribute("data-index",i),items.push(itemNode),itemContainer.appendChild(itemNode)}),{container:itemContainer,items:items}},mergeElement:function(){this.element.appendChild(this.itemGroups.container)},mountTo:function(container){container.appendChild(this.element)}})}},_p[46]={value:function(require){function createElement(doc,eleName,className){var node=doc.createElement(eleName);return node.className=CLASS_PREFIX+className,"thumb"===className&&(className=CLASS_PREFIX+className,node.innerHTML='<div class="$1"></div><div class="$2"></div>'.replace("$1",className+"-left").replace("$2",className+"-right")),node}function getRect(node){return node.getBoundingClientRect()}function preventDefault(container){Utils.addEvent(container,"mousedown",function(e){e.preventDefault()})}function preventDefault(comp){Utils.addEvent(comp.container,"mousedown",function(e){e.preventDefault()})}function trackClick(comp){Utils.addEvent(comp.widgets.track,"mousedown",function(e){trackClickHandler(this,comp,e)})}function btnClick(comp){Utils.addEvent(comp.widgets.leftButton,"mousedown",function(){setThumbOffsetByStep(comp,-SCROLLBAR_CONF.step)}),Utils.addEvent(comp.widgets.rightButton,"mousedown",function(){setThumbOffsetByStep(comp,SCROLLBAR_CONF.step)})}function thumbHandler(comp){var isMoving=!1,startPoint=0,startOffset=0,trackWidth=comp.values.trackWidth;Utils.addEvent(comp.widgets.thumb,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),isMoving=!0,startPoint=e.clientX,startOffset=comp.thumbLocationX}),Utils.addEvent(comp.container.ownerDocument,"mouseup",function(){isMoving=!1,startPoint=0,startOffset=0}),Utils.addEvent(comp.container.ownerDocument,"mousemove",function(e){if(isMoving){var distance=e.clientX-startPoint,offset=startOffset+distance,thumbWidth=comp.values.thumbWidth;offset<0?offset=0:offset+thumbWidth>trackWidth&&(offset=trackWidth-thumbWidth),setThumbLocation(comp,offset)}})}function trackClickHandler(track,comp,evt){var trackRect=getRect(track),values=comp.values,unitOffset=values.viewWidth/(values.contentWidth-values.viewWidth)*values.trackWidth;evt.clientX-trackRect.left>values.offset?values.offset+unitOffset>values.trackWidth?setThumbOffset(comp,values.trackWidth):setThumbOffset(comp,values.offset+unitOffset):values.offset-unitOffset<0?setThumbOffset(comp,0):setThumbOffset(comp,values.offset-unitOffset)}function setThumbLocation(comp,locationX){var values=comp.values,trackPieceWidth=values.trackWidth-values.thumbWidth,offset=Math.floor(locationX/trackPieceWidth*values.trackWidth);comp.updateOffset(offset),comp.thumbLocationX=locationX,comp.widgets.thumb.style.left=locationX+"px"}function setThumbOffsetByStep(comp,step){var leftOverflow=comp.leftOverflow+step;leftOverflow<0?leftOverflow=0:leftOverflow>comp.values.scrollWidth&&(leftOverflow=comp.values.scrollWidth),setThumbByLeftOverflow(comp,leftOverflow)}function setThumbOffset(comp,offset){var values=comp.values,offsetProportion=offset/values.trackWidth,trackPieceWidth=values.trackWidth-values.thumbWidth,thumbLocationX=0;thumbLocationX=Math.floor(offsetProportion*trackPieceWidth),offset<0&&(offset=0,thumbLocationX=0),comp.updateOffset(offset),comp.widgets.thumb.style.left=thumbLocationX+"px",comp.thumbLocationX=thumbLocationX}function setThumbOffsetByViewOffset(comp,viewOffset){var values=comp.values,offsetProportion=0,offset=0;offsetProportion=viewOffset/(values.contentWidth-values.viewWidth),offset=Math.floor(offsetProportion*values.trackWidth),setThumbOffset(comp,offset)}function setThumbByLeftOverflow(comp,leftViewOverflow){var values=comp.values;setThumbOffset(comp,leftViewOverflow/(values.contentWidth-values.viewWidth)*values.trackWidth)}var kity=_p.r(21),SCROLLBAR_DEF=_p.r(33).scrollbar,SCROLLBAR_CONF=_p.r(30).scrollbar,Utils=_p.r(5),CLASS_PREFIX="kf-editor-ui-";return kity.createClass("Scrollbar",{constructor:function(uiComponent,kfEditor){this.uiComponent=uiComponent,this.kfEditor=kfEditor,this.widgets=null,this.container=this.uiComponent.scrollbarContainer,this.state=!1,this.values={offset:0,left:0,viewWidth:0,contentWidth:0,trackWidth:0,thumbWidth:0,scrollWidth:0},this.thumbLocationX=0,this.leftOverflow=0,this.rightOverflow=0,this.isExpand=!0,this.initWidget(),this.mountWidget(),this.initSize(),this.hide(),this.initServices(),this.initEvent(),this.updateHandler=function(){}},initWidget:function(){var doc=this.container.ownerDocument;this.widgets={leftButton:createElement(doc,"div","left-button"),rightButton:createElement(doc,"div","right-button"),track:createElement(doc,"div","track"),thumb:createElement(doc,"div","thumb"),thumbBody:createElement(doc,"div","thumb-body")}},initSize:function(){var leftBtnWidth=getRect(this.widgets.leftButton).width,rightBtnWidth=getRect(this.widgets.rightButton).width;this.values.viewWidth=getRect(this.container).width,this.values.trackWidth=this.values.viewWidth-leftBtnWidth-rightBtnWidth,this.widgets.track.style.width=this.values.trackWidth+"px"},initServices:function(){this.kfEditor.registerService("ui.show.scrollbar",this,{showScrollbar:this.show}),this.kfEditor.registerService("ui.hide.scrollbar",this,{hideScrollbar:this.hide}),this.kfEditor.registerService("ui.update.scrollbar",this,{updateScrollbar:this.update}),this.kfEditor.registerService("ui.set.scrollbar.update.handler",this,{setUpdateHandler:this.setUpdateHandler}),this.kfEditor.registerService("ui.relocation.scrollbar",this,{relocation:this.relocation})},initEvent:function(){preventDefault(this),trackClick(this),thumbHandler(this),btnClick(this)},mountWidget:function(){var widgets=this.widgets,container=this.container;for(var wgtName in widgets)widgets.hasOwnProperty(wgtName)&&container.appendChild(widgets[wgtName]);widgets.thumb.appendChild(widgets.thumbBody),widgets.track.appendChild(widgets.thumb)},show:function(){this.state=!0,this.container.style.display="block"},hide:function(){this.state=!1,this.container.style.display="none"},update:function(contentWidth){var trackWidth=this.values.trackWidth,thumbWidth=0;if(this.isExpand=contentWidth>this.values.contentWidth,this.values.contentWidth=contentWidth,this.values.scrollWidth=contentWidth-this.values.viewWidth,trackWidth>=contentWidth)return void this.hide();thumbWidth=Math.max(Math.ceil(trackWidth*trackWidth/contentWidth),SCROLLBAR_DEF.thumbMinSize),this.values.thumbWidth=thumbWidth,this.widgets.thumb.style.width=thumbWidth+"px",this.widgets.thumbBody.style.width=thumbWidth-10+"px"},setUpdateHandler:function(updateHandler){this.updateHandler=updateHandler},updateOffset:function(offset){var values=this.values;values.offset=offset,values.left=offset/values.trackWidth,this.leftOverflow=values.left*(values.contentWidth-values.viewWidth),this.rightOverflow=values.contentWidth-values.viewWidth-this.leftOverflow,this.updateHandler(values.left,values.offset,values)},relocation:function(){var cursorLocation=this.kfEditor.requestService("control.get.cursor.location"),padding=SCROLLBAR_CONF.padding,contentWidth=this.values.contentWidth,viewWidth=this.values.viewWidth,viewLeftOverflow=this.values.left*(contentWidth-viewWidth),diff=0;cursorLocation.x<viewLeftOverflow?(cursorLocation.x<0&&(cursorLocation.x=0),setThumbOffsetByViewOffset(this,cursorLocation.x)):cursorLocation.x+padding>viewLeftOverflow+viewWidth?(cursorLocation.x+=padding,cursorLocation.x>contentWidth&&(cursorLocation.x=contentWidth),diff=cursorLocation.x-viewWidth,setThumbOffsetByViewOffset(this,diff)):this.isExpand?setThumbByLeftOverflow(this,this.leftOverflow):setThumbByLeftOverflow(this,contentWidth-viewWidth-this.rightOverflow)}})}},_p[47]={value:function(require){function ClassList(node){this.node=node,this.classes=node.className.replace(/^\s+|\s+$/g,"").split(/\s+/)}var $=_p.r(15),kity=_p.r(21),TOPIC_POOL={},Utils={ele:function(doc,name,options){var node=null;return"text"===name?doc.createTextNode(options):(node=doc.createElement(name),options.className&&(node.className=options.className),options.content&&(node.innerHTML=options.content),node)},getRectBox:function(node){return node.getBoundingClientRect()},on:function(target,type,fn){return $(target).on(type,fn),this},delegate:function(target,selector,type,fn){return $(target).delegate(selector,type,fn),this},publish:function(topic,args){var callbackList=TOPIC_POOL[topic];callbackList&&(args=[].slice.call(arguments,1),kity.Utils.each(callbackList,function(callback){callback.apply(null,args)}))},subscribe:function(topic,callback){TOPIC_POOL[topic]||(TOPIC_POOL[topic]=[]),TOPIC_POOL[topic].push(callback)},getClassList:function(node){return node.classList||new ClassList(node)}};return ClassList.prototype={constructor:ClassList,contains:function(className){return-1!==this.classes.indexOf(className)},add:function(className){return-1==this.classes.indexOf(className)&&this.classes.push(className),this._update(),this},remove:function(className){var index=this.classes.indexOf(className);return-1!==index&&(this.classes.splice(index,1),this._update()),this},toggle:function(className){return this[this.contains(className)?"remove":"add"](className)},_update:function(){this.node.className=this.classes.join(" ")}},Utils}},_p[48]={value:function(require){return{DrapdownBox:_p.r(44),Delimiter:_p.r(43),Area:_p.r(37)}}},_p[49]={value:function(require){function createToolbarWrap(doc){return $$.ele(doc,"div",{className:"kf-editor-toolbar"})}function createToolbarContainer(doc){return $$.ele(doc,"div",{className:"kf-editor-inner-toolbar"})}function createEditArea(doc){var container=doc.createElement("div");return container.className="kf-editor-edit-area",container.style.width="80%",container.style.height="800px",container}function createCanvasContainer(doc){var container=doc.createElement("div");return container.className="kf-editor-canvas-container",container}function createScrollbarContainer(doc){var container=doc.createElement("div");return container.className="kf-editor-edit-scrollbar",container}var kity=_p.r(21),$$=_p.r(47),Utils=_p.r(5),VIEW_STATE=_p.r(33).VIEW_STATE,Scrollbar=_p.r(46),Toolbar=_p.r(36),ELEMENT_LIST=(_p.r(32),_p.r(35));return kity.createClass("UIComponent",{constructor:function(kfEditor,options){var currentDocument=null;this.options=options,this.container=kfEditor.getContainer(),currentDocument=this.container.ownerDocument,this.components={},this.canvasRect=null,this.viewState=VIEW_STATE.NO_OVERFLOW,this.kfEditor=kfEditor,this.toolbarWrap=createToolbarWrap(currentDocument),this.toolbarContainer=createToolbarContainer(currentDocument),this.editArea=createEditArea(currentDocument),this.canvasContainer=createCanvasContainer(currentDocument),this.scrollbarContainer=createScrollbarContainer(currentDocument),this.toolbarWrap.appendChild(this.toolbarContainer),this.container.appendChild(this.toolbarWrap),this.editArea.appendChild(this.canvasContainer),this.container.appendChild(this.editArea),this.container.appendChild(this.scrollbarContainer),this.initComponents(),this.initServices(),this.initEvent(),
this.updateContainerSize(this.container,this.toolbarWrap,this.editArea,this.canvasContainer),this.initScrollEvent()},initComponents:function(){this.components.toolbar=new Toolbar(this,this.kfEditor,ELEMENT_LIST),this.components.scrollbar=new Scrollbar(this,this.kfEditor)},updateContainerSize:function(container,toolbar,editArea){var containerBox=container.getBoundingClientRect(),toolbarBox=toolbar.getBoundingClientRect();editArea.style.width=containerBox.width+"px",editArea.style.height=containerBox.bottom-toolbarBox.bottom+"px"},initServices:function(){this.kfEditor.registerService("ui.get.canvas.container",this,{getCanvasContainer:this.getCanvasContainer}),this.kfEditor.registerService("ui.update.canvas.view",this,{updateCanvasView:this.updateCanvasView}),this.kfEditor.registerService("ui.canvas.container.event",this,{on:this.addEvent,off:this.removeEvent,trigger:this.trigger,fire:this.trigger})},initEvent:function(){},initScrollEvent:function(){var _self=this;this.kfEditor.requestService("ui.set.scrollbar.update.handler",function(proportion,offset,values){offset=Math.floor(proportion*(values.contentWidth-values.viewWidth)),_self.kfEditor.requestService("render.set.canvas.offset",offset)})},getCanvasContainer:function(){return this.canvasContainer},addEvent:function(type,handler){Utils.addEvent(this.canvasContainer,type,handler)},removeEvent:function(){},trigger:function(type){Utils.trigger(this.canvasContainer,type)},updateCanvasView:function(){var canvas=this.kfEditor.requestService("render.get.canvas"),contentContainer=canvas.getContentContainer(),contentRect=null;null===this.canvasRect&&(this.canvasRect=this.canvasContainer.getBoundingClientRect()),contentRect=contentContainer.getRenderBox("paper"),contentRect.width>this.canvasRect.width?(this.viewState===VIEW_STATE.NO_OVERFLOW&&(this.toggleViewState(),this.kfEditor.requestService("ui.show.scrollbar"),this.kfEditor.requestService("render.disable.relocation")),this.kfEditor.requestService("render.relocation"),this.kfEditor.requestService("ui.update.scrollbar",contentRect.width),this.kfEditor.requestService("ui.relocation.scrollbar")):(this.viewState===VIEW_STATE.OVERFLOW&&(this.toggleViewState(),this.kfEditor.requestService("ui.hide.scrollbar"),this.kfEditor.requestService("render.enable.relocation")),this.kfEditor.requestService("render.relocation"))},toggleViewState:function(){this.viewState=this.viewState===VIEW_STATE.NO_OVERFLOW?VIEW_STATE.OVERFLOW:VIEW_STATE.NO_OVERFLOW}})}},_p[50]={value:function(require){var KFEditor=_p.r(13),Factory=_p.r(14);KFEditor.registerComponents("ui",_p.r(49)),KFEditor.registerComponents("parser",_p.r(22)),KFEditor.registerComponents("render",_p.r(26)),KFEditor.registerComponents("position",_p.r(24)),KFEditor.registerComponents("syntax",_p.r(29)),KFEditor.registerComponents("control",_p.r(6)),KFEditor.registerComponents("print",_p.r(25)),kf.EditorFactory=Factory}};var moduleMapping={"kf.start":50};!function(global){try{use("kf.start")}catch(e){}}()}();