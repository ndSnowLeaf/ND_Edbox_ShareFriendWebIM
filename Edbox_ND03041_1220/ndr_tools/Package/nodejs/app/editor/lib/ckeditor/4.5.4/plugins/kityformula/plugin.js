CKEDITOR.plugins.add("kityformula",{icons:"kityformula",init:function(editor){var lang=editor.lang.kityformula;editor.addCommand("kityformula",new CKEDITOR.dialogCommand("kityformulaDialog",{allowedContent:"img[data-latex]"})),editor.ui.addButton("kityformula",{label:lang.toolbar,command:"kityformula",toolbar:"insert"}),CKEDITOR.dialog.add("kityformulaDialog",this.path+"dialogs/kityformula.js"),editor.contextMenu&&(editor.addMenuGroup("kityformulaGroup"),editor.addMenuItem("kityformulaItem",{label:lang.contextMenu,icon:this.path+"icons/kityformula.png",command:"kityformula",group:"kityformulaGroup"}),editor.contextMenu.addListener(function(element){if(element.getAscendant("img",!0)&&element.hasClass("kfformula"))return{kityformulaItem:CKEDITOR.TRISTATE_OFF}})),editor.on("doubleclick",function(evt){var element=evt.data.element;element.is("img")&&element.hasClass("kfformula")&&(evt.data.dialog="kityformulaDialog")})}});