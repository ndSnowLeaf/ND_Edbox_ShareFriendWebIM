CKEDITOR.plugins.add("background",{icons:"background",init:function(editor){editor.ui.addButton("Background",{label:"set background image",command:"background",toolbar:"insert,100"}),editor.addCommand("background",new CKEDITOR.dialogCommand("backgroundDialog")),CKEDITOR.dialog.add("backgroundDialog",this.path+"dialogs/dialog.js"),CKEDITOR.dialog.add("selectBackGroundImage",this.path+"dialogs/dialog2.js"),editor.on("setData",function(evt){var text=evt.data.dataValue;try{var div=CKEDITOR.dom.element.createFromHtml("<div>"+text+"</div>"),backgroundDiv=div.find("div.background_image");if(backgroundDiv&&backgroundDiv.count()>0){var wrapper=backgroundDiv.getItem(0),background=wrapper.getStyle("background"),root=editor.container;$(root.$).css("background",background),evt.data.dataValue=backgroundDiv.getItem(0).$.innerHTML}}catch(ex){console.log(ex)}}),editor.on("getData",function(evt){var data=evt.data.dataValue,editor=evt.editor,root=editor.container,image=$(root.$).css("background-image");if(""!=image&&"none"!=image){var repeat=$(root.$).css("background-repeat"),position=$(root.$).css("background-position");data='<div class="background_image" style="background:'+function(image,repeat,position){var background="";return background=background+" "+image,""!=position&&(background=background+" "+position),""!=repeat&&(background=background+" "+repeat),background}(image,repeat,position)+';">'+data+"</div>",evt.data.dataValue=data}})}});var zh={title:"设置背景图像",position_label:"对齐方式",top_left:"左 上",top_center:"中 上",top_right:"右 上",center_left:"左 中",center_center:"中 中",center_right:"右 中",bottom_left:"左 下",bottom_center:"中 下",bottom_right:"右 下",repeat_label:"重复方式",image_label:"选择图像文件",repeat:"平铺",repeat_x:"水平方向平铺",repeat_y:"垂直方向平铺",no_repeat:"不平铺",inherit:"继承父元素",not_tempty:"请选择背景图片",cancel_background:"取消背景图"};CKEDITOR.plugins.setLang("background","zh",zh);