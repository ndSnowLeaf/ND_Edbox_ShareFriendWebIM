"use strict";!function(){var cdn="/player/ref/js-library/mathjax/MathJax.js?config=TeX-AMS-MML_SVG-full,local/local";CKEDITOR.plugins.add("mathjax",{lang:"af,ar,ca,cs,cy,da,de,el,en,en-gb,eo,es,fa,fi,fr,gl,he,hr,hu,it,ja,km,ku,lt,nb,nl,no,pl,pt,pt-br,ro,ru,sk,sl,sq,sv,tr,tt,uk,vi,zh,zh-cn",requires:"widget,dialog",icons:"mathjax",hidpi:!0,init:function(editor){var cls=editor.config.mathJaxClass||"math-tex";editor.widgets.add("mathjax",{inline:!0,dialog:"mathjax",button:editor.lang.mathjax.button,mask:!0,allowedContent:"latex(*);span(*)",pathName:editor.lang.mathjax.pathName,template:'<latex class="'+cls+'" style="display:inline-block" data-cke-survive=1></latex>',parts:{span:"latex"},defaults:{math:""},init:function(){var iframe=this.parts.span.getChild(0);iframe&&iframe.type==CKEDITOR.NODE_ELEMENT&&iframe.is("iframe")||(iframe=new CKEDITOR.dom.element("iframe"),iframe.setAttributes({style:"border:0;width:0;height:0",scrolling:"no",frameborder:0,allowTransparency:!0,src:CKEDITOR.plugins.mathjax.fixSrc}),this.parts.span.append(iframe)),this.once("ready",function(){CKEDITOR.env.ie&&iframe.setAttribute("src",CKEDITOR.plugins.mathjax.fixSrc),this.frameWrapper=new CKEDITOR.plugins.mathjax.frameWrapper(iframe,editor),this.frameWrapper.setValue(this.data.math)})},data:function(){this.frameWrapper&&this.frameWrapper.setValue(this.data.math)},hasData:function(){return this.data.math||!1},upcast:function(el,data){var isLatex="latex"==el.name,isSpan="span"==el.name&&el.hasClass(cls);if((isLatex||isSpan)&&(isSpan&&(el.name="latex"),1==el.children.length&&el.children[0].type==CKEDITOR.NODE_TEXT)){data.math=CKEDITOR.tools.htmlDecode(el.children[0].value);var attrs=el.attributes;return attrs.style?attrs.style+=";display:inline-block":attrs.style="display:inline-block",attrs["data-cke-survive"]=1,el.children[0].remove(),el}},downcast:function(el){el.children[0].replaceWith(new CKEDITOR.htmlParser.text(CKEDITOR.tools.htmlEncode(this.data.math)));var attrs=el.attributes;return attrs.style=attrs.style.replace(/display:\s?inline-block;?\s?/,""),""===attrs.style&&delete attrs.style,el}}),CKEDITOR.dialog.add("mathjax",this.path+"dialogs/mathjax.js"),editor.on("contentPreview",function(evt){evt.data.dataValue=evt.data.dataValue.replace(/<\/head>/,'<script src="'+(editor.config.mathJaxLib?CKEDITOR.getUrl(editor.config.mathJaxLib):cdn)+'"><\/script></head>')}),editor.on("paste",function(evt){var regex=new RegExp("<latex[^>]*?"+cls+".*?</latex>","ig");evt.data.dataValue=evt.data.dataValue.replace(regex,function(match){return match.replace(/(<iframe.*?\/iframe>)/i,"")}),regex=new RegExp("<span[^>]*?"+cls+".*?</span>","ig"),evt.data.dataValue=evt.data.dataValue.replace(regex,function(match){return match.replace(/(<iframe.*?\/iframe>)/i,"")})})}}),CKEDITOR.plugins.mathjax={},CKEDITOR.plugins.mathjax.fixSrc=CKEDITOR.env.gecko?"javascript:true":CKEDITOR.env.ie?"javascript:void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})())":"javascript:void(0)",CKEDITOR.plugins.mathjax.loadingIcon=CKEDITOR.plugins.get("mathjax").path+"images/loader.gif",CKEDITOR.plugins.mathjax.copyStyles=function(from,to){for(var stylesToCopy=["color","font-family","font-style","font-weight","font-variant","font-size"],i=0;i<stylesToCopy.length;i++){var key=stylesToCopy[i],val=from.getComputedStyle(key);val&&to.setStyle(key,val)}},CKEDITOR.plugins.mathjax.trim=function(value){var begin=value.indexOf("\\(")+2,end=value.lastIndexOf("\\)");return value.substring(begin,end)},CKEDITOR.env.ie&&8==CKEDITOR.env.version?CKEDITOR.plugins.mathjax.frameWrapper=function(iFrame,editor){return iFrame.getFrameDocument().write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body style="padding:0;margin:0;background:transparent;overflow:hidden"><span style="white-space:nowrap;" id="tex"></span></body></html>'),{setValue:function(value){var doc=iFrame.getFrameDocument(),tex=doc.getById("tex");tex.setHtml(CKEDITOR.plugins.mathjax.trim(CKEDITOR.tools.htmlEncode(value))),CKEDITOR.plugins.mathjax.copyStyles(iFrame,tex),editor.fire("lockSnapshot"),iFrame.setStyles({width:Math.min(250,tex.$.offsetWidth)+"px",height:doc.$.body.offsetHeight+"px",display:"inline","vertical-align":"middle"}),editor.fire("unlockSnapshot")}}}:CKEDITOR.plugins.mathjax.frameWrapper=function(iFrame,editor){function load(){doc=iFrame.getFrameDocument(),doc.getById("preview")||(CKEDITOR.env.ie&&iFrame.removeAttribute("src"),doc.write('<!DOCTYPE html><html><head><meta charset="utf-8"><script type="text/x-mathjax-config">MathJax.Hub.Config( {showMathMenu: false,messageStyle: "none"} );function getCKE() {if ( typeof window.parent.CKEDITOR == \'object\' ) {return window.parent.CKEDITOR;} else {return window.parent.parent.CKEDITOR;}}function update() {MathJax.Hub.Queue([ \'Typeset\', MathJax.Hub, this.buffer ],function() {getCKE().tools.callFunction( '+updateDoneHandler+" );});}MathJax.Hub.Queue( function() {getCKE().tools.callFunction("+loadedHandler+');} );<\/script><script src="'+(editor.config.mathJaxLib||cdn)+'"><\/script></head><body style="padding:0;margin:0;background:transparent;overflow:hidden"><span id="preview"></span><span id="buffer" style="display:none"></span></body></html>'))}function update(){isRunning=!0,value=newValue,editor.fire("lockSnapshot"),buffer.setHtml(value),preview.setHtml("<img src="+CKEDITOR.plugins.mathjax.loadingIcon+" alt="+editor.lang.mathjax.loading+">"),iFrame.setStyles({height:"16px",width:"16px",display:"inline","vertical-align":"middle"}),editor.fire("unlockSnapshot"),doc.getWindow().$.update(value)}var buffer,preview,value,newValue,doc=iFrame.getFrameDocument(),isInit=!1,isRunning=!1,loadedHandler=CKEDITOR.tools.addFunction(function(){preview=doc.getById("preview"),buffer=doc.getById("buffer"),isInit=!0,newValue&&update(),CKEDITOR.fire("mathJaxLoaded",iFrame)}),updateDoneHandler=CKEDITOR.tools.addFunction(function(){CKEDITOR.plugins.mathjax.copyStyles(iFrame,preview),preview.setHtml(buffer.getHtml()),editor.fire("lockSnapshot"),iFrame.setStyles({height:0,width:0});var height=Math.max(doc.$.body.offsetHeight,doc.$.documentElement.offsetHeight)+5,width=Math.min(preview.$.offsetWidth,doc.$.body.scrollWidth);iFrame.setStyles({height:height+"px",width:width+"px"}),editor.fire("unlockSnapshot"),CKEDITOR.fire("mathJaxUpdateDone",iFrame),value!=newValue?update():isRunning=!1});return iFrame.on("load",load),load(),{setValue:function(value){newValue=CKEDITOR.tools.htmlEncode(value),isInit&&!isRunning&&update()}}}}();