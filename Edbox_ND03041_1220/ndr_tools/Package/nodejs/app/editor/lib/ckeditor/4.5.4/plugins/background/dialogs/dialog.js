CKEDITOR.dialog.add("backgroundDialog",function(editor){var lang=editor.lang.background,calculateBackgroudProperty=function(showDefault){var background="",dialog=this,position=dialog.getValueOf("tab-basic","position"),repeat=dialog.getValueOf("tab-basic","repeat"),url=dialog.getValueOf("tab-basic","url");return""!=url&&"none"!=url||!showDefault||(url="/app/modules/qti/edit/images/icon_addlinebox.png",position="50% 50%",repeat="no-repeat"),""==url||"none"==url?"":(background=background+" url('"+url+"')",""!=position&&(background=background+" "+position),""!=repeat&&(background=background+" "+repeat),background)},valueChanged=function(dialog){var input=dialog.getContentElement("tab-basic","image").getElement();$(input.$).find("a.add-box").css("background",calculateBackgroudProperty.call(dialog,!0))};return{title:lang.title,minWidth:400,minHeight:426,resizable:CKEDITOR.DIALOG_RESIZE_NONE,contents:[{id:"tab-basic",elements:[{type:"select",id:"position",label:lang.position_label,items:[[lang.top_left,"0% 0%"],[lang.top_center,"50% 0%"],[lang.top_right,"100% 0%"],[lang.center_left,"0% 50%"],[lang.center_center,"50% 50%"],[lang.center_right,"100% 50%"],[lang.bottom_left,"0% 100%"],[lang.bottom_center,"50% 100%"],[lang.bottom_right,"100% 100%"]],onChange:function(){var dialog=this.getDialog();valueChanged(dialog)}},{type:"select",id:"repeat",label:lang.repeat_label,items:[[lang.inherit,"inherit"],[lang.no_repeat,"no-repeat"],[lang.repeat,"repeat"],[lang.repeat_x,"repeat-x"],[lang.repeat_y,"repeat-y"]],onChange:function(){var dialog=this.getDialog();valueChanged(dialog)}},{type:"text",id:"url",onLoad:function(){this.getDialog().getContentElement("tab-basic","url").getElement().hide()},validate:CKEDITOR.dialog.validate.notEmpty(lang.not_tempty)},{type:"html",id:"image",label:lang.image_label,html:'<div class="qti-ed-match-box"><p class="match-image"><a href="javascript:void(0);" class="add-box"></a></p><p><a href="javascript:void(0);" class="del">'+lang.cancel_background+"</a></p></div>",onLoad:function(){var dialog=this.getDialog(),input=dialog.getContentElement("tab-basic","image").getElement();$(input.$).find("a.add-box").click(function(){editor.openDialog("selectBackGroundImage",function(openDialog){openDialog.changeUrl=function(url){dialog.setValueOf("tab-basic","url",url),valueChanged(dialog)}})}),$(input.$).find("a.del").click(function(){dialog.setValueOf("tab-basic","url","none"),valueChanged(dialog)})}}]}],onShow:function(){var dialog=this,root=editor.container,image=$(root.$).css("background-image");image&&0==image.indexOf("url(")&&(image=image.substring("url(".length)),image&&image.indexOf(")")==image.length-1&&(image=image.substring(0,image.length-1));var repeat=$(root.$).css("background-repeat"),position=$(root.$).css("background-position");dialog.setValueOf("tab-basic","url",image),dialog.setValueOf("tab-basic","position",position),dialog.setValueOf("tab-basic","repeat",repeat),valueChanged(dialog)},onOk:function(){var background=calculateBackgroudProperty.call(this),root=editor.container;return $(root.$).css("background",background),!0},onCancel:function(){return!0}}});