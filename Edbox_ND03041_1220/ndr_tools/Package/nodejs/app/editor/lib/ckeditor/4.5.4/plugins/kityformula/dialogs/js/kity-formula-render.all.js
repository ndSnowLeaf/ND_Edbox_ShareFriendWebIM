!function(){function use(name){_p.r([moduleMapping[name]])}var _p={r:function(index){if(_p[index].inited)return _p[index].value;if("function"!=typeof _p[index].value)return _p[index].inited=!0,_p[index].value;var module={exports:{}},returnValue=_p[index].value(null,module.exports,module);if(_p[index].inited=!0,_p[index].value=returnValue,void 0!==returnValue)return returnValue;for(var key in module.exports)if(module.exports.hasOwnProperty(key))return _p[index].inited=!0,_p[index].value=module.exports,module.exports}};_p[0]={value:function(require){function RGBColor(color_string){this.ok=!1,"#"==color_string.charAt(0)&&(color_string=color_string.substr(1,6)),color_string=color_string.replace(/ /g,""),color_string=color_string.toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors)color_string==key&&(color_string=simple_colors[key]);for(var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}],i=0;i<color_defs.length;i++){var re=color_defs[i].re,processor=color_defs[i].process,bits=re.exec(color_string);bits&&(channels=processor(bits),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return 1==r.length&&(r="0"+r),1==g.length&&(g="0"+g),1==b.length&&(b="0"+b),"#"+r+g+b},this.getHelpXML=function(){for(var examples=new Array,i=0;i<color_defs.length;i++)for(var example=color_defs[i].example,j=0;j<example.length;j++)examples[examples.length]=example[j];for(var sc in simple_colors)examples[examples.length]=sc;var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++)try{var list_item=document.createElement("li"),list_color=new RGBColor(examples[i]),example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; color:"+list_color.toHex(),example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div),list_item.appendChild(list_item_value),xml.appendChild(list_item)}catch(e){}return xml}}function stackBlurCanvasRGBA(id,top_x,top_y,width,height,radius){if(!(isNaN(radius)||radius<1)){radius|=0;var imageData,canvas=document.getElementById(id),context=canvas.getContext("2d");try{try{imageData=context.getImageData(top_x,top_y,width,height)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),imageData=context.getImageData(top_x,top_y,width,height)}catch(e){throw alert("Cannot access local image"),new Error("unable to access local image data: "+e)}}}catch(e){throw alert("Cannot access image"),new Error("unable to access image data: "+e)}var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,a_sum,r_out_sum,g_out_sum,b_out_sum,a_out_sum,r_in_sum,g_in_sum,b_in_sum,a_in_sum,pr,pg,pb,pa,rbs,pixels=imageData.data,div=radius+radius+1,widthMinus1=width-1,heightMinus1=height-1,radiusPlus1=radius+1,sumFactor=radiusPlus1*(radiusPlus1+1)/2,stackStart=new BlurStack,stack=stackStart;for(i=1;i<div;i++)if(stack=stack.next=new BlurStack,i==radiusPlus1)var stackEnd=stack;stack.next=stackStart;var stackIn=null,stackOut=null;yw=yi=0;var mul_sum=mul_table[radius],shg_sum=shg_table[radius];for(y=0;y<height;y++){for(r_in_sum=g_in_sum=b_in_sum=a_in_sum=r_sum=g_sum=b_sum=a_sum=0,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;i<radiusPlus1;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(i=1;i<radiusPlus1;i++)p=yi+((widthMinus1<i?widthMinus1:i)<<2),r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[p+1])*rbs,b_sum+=(stack.b=pb=pixels[p+2])*rbs,a_sum+=(stack.a=pa=pixels[p+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next;for(stackIn=stackStart,stackOut=stackEnd,x=0;x<width;x++)pixels[yi+3]=pa=a_sum*mul_sum>>shg_sum,0!=pa?(pa=255/pa,pixels[yi]=(r_sum*mul_sum>>shg_sum)*pa,pixels[yi+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[yi+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[yi]=pixels[yi+1]=pixels[yi+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=yw+((p=x+radius+1)<widthMinus1?p:widthMinus1)<<2,r_in_sum+=stackIn.r=pixels[p],g_in_sum+=stackIn.g=pixels[p+1],b_in_sum+=stackIn.b=pixels[p+2],a_in_sum+=stackIn.a=pixels[p+3],r_sum+=r_in_sum,g_sum+=g_in_sum,b_sum+=b_in_sum,a_sum+=a_in_sum,stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=4;yw+=width}for(x=0;x<width;x++){for(g_in_sum=b_in_sum=a_in_sum=r_in_sum=g_sum=b_sum=a_sum=r_sum=0,yi=x<<2,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;i<radiusPlus1;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(yp=width,i=1;i<=radius;i++)yi=yp+x<<2,r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[yi+1])*rbs,b_sum+=(stack.b=pb=pixels[yi+2])*rbs,a_sum+=(stack.a=pa=pixels[yi+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next,i<heightMinus1&&(yp+=width);for(yi=x,stackIn=stackStart,stackOut=stackEnd,y=0;y<height;y++)p=yi<<2,pixels[p+3]=pa=a_sum*mul_sum>>shg_sum,pa>0?(pa=255/pa,pixels[p]=(r_sum*mul_sum>>shg_sum)*pa,pixels[p+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[p+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[p]=pixels[p+1]=pixels[p+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2,r_sum+=r_in_sum+=stackIn.r=pixels[p],g_sum+=g_in_sum+=stackIn.g=pixels[p+1],b_sum+=b_in_sum+=stackIn.b=pixels[p+2],a_sum+=a_in_sum+=stackIn.a=pixels[p+3],stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=width}context.putImageData(imageData,top_x,top_y)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return function(){function build(){var svg={};return svg.FRAMERATE=30,svg.MAX_VIRTUAL_PIXELS=3e4,svg.init=function(ctx){var uniqueId=0;svg.UniqueId=function(){return"canvg"+ ++uniqueId},svg.Definitions={},svg.Styles={},svg.Animations=[],svg.Images=[],svg.ctx=ctx,svg.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(d){return null!=d&&"number"==typeof d?d:"x"==d?this.width():"y"==d?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},svg.init(),svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++)if(!svg.Images[i].loaded)return!1;return!0},svg.trim=function(s){return s.replace(/^\s+|\s+$/g,"")},svg.compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ")},svg.ajax=function(url){var AJAX;return AJAX=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),AJAX?(AJAX.open("GET",url,!1),AJAX.send(null),AJAX.responseText):null},svg.parseXml=function(xml){if(window.DOMParser){return(new DOMParser).parseFromString(xml,"text/xml")}xml=xml.replace(/<!DOCTYPE svg[^>]*>/,"");var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");return xmlDoc.async="false",xmlDoc.loadXML(xml),xmlDoc},svg.Property=function(name,value){this.name=name,this.value=value},svg.Property.prototype.getValue=function(){return this.value},svg.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},svg.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var n=parseFloat(this.value);return(this.value+"").match(/%$/)&&(n/=100),n},svg.Property.prototype.valueOrDefault=function(def){return this.hasValue()?this.value:def},svg.Property.prototype.numValueOrDefault=function(def){return this.hasValue()?this.numValue():def},svg.Property.prototype.addOpacity=function(opacity){var newValue=this.value;if(null!=opacity&&""!=opacity&&"string"==typeof this.value){var color=new RGBColor(this.value);color.ok&&(newValue="rgba("+color.r+", "+color.g+", "+color.b+", "+opacity+")")}return new svg.Property(this.name,newValue)},svg.Property.prototype.getDefinition=function(){var name=this.value.match(/#([^\)'"]+)/);return name&&(name=name[1]),name||(name=this.value),svg.Definitions[name]},svg.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},svg.Property.prototype.getFillStyleDefinition=function(e,opacityProp){var def=this.getDefinition();if(null!=def&&def.createGradient)return def.createGradient(svg.ctx,e,opacityProp);if(null!=def&&def.createPattern){if(def.getHrefAttribute().hasValue()){var pt=def.attribute("patternTransform");def=def.getHrefAttribute().getDefinition(),pt.hasValue()&&(def.attribute("patternTransform",!0).value=pt.value)}return def.createPattern(svg.ctx,e)}return null},svg.Property.prototype.getDPI=function(viewPort){return 96},svg.Property.prototype.getEM=function(viewPort){var em=12,fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);return fontSize.hasValue()&&(em=fontSize.toPixels(viewPort)),em},svg.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},svg.Property.prototype.toPixels=function(viewPort,processPercent){if(!this.hasValue())return 0;var s=this.value+"";if(s.match(/em$/))return this.numValue()*this.getEM(viewPort);if(s.match(/ex$/))return this.numValue()*this.getEM(viewPort)/2;if(s.match(/px$/))return this.numValue();if(s.match(/pt$/))return this.numValue()*this.getDPI(viewPort)*(1/72);if(s.match(/pc$/))return 15*this.numValue();if(s.match(/cm$/))return this.numValue()*this.getDPI(viewPort)/2.54;if(s.match(/mm$/))return this.numValue()*this.getDPI(viewPort)/25.4;if(s.match(/in$/))return this.numValue()*this.getDPI(viewPort);if(s.match(/%$/))return this.numValue()*svg.ViewPort.ComputeSize(viewPort);var n=this.numValue();return processPercent&&n<1?n*svg.ViewPort.ComputeSize(viewPort):n},svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/s$/)?1e3*this.numValue():(s.match(/ms$/),this.numValue())},svg.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/deg$/)?this.numValue()*(Math.PI/180):s.match(/grad$/)?this.numValue()*(Math.PI/200):s.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},svg.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=null!=inherit?this.Parse(inherit):this.CreateFont("","","","","",svg.ctx.font);return{fontFamily:fontFamily||f.fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var that=this;this.Parse=function(s){for(var f={},d=svg.trim(svg.compressSpaces(s||"")).split(" "),set={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},ff="",i=0;i<d.length;i++)set.fontStyle||-1==that.Styles.indexOf(d[i])?set.fontVariant||-1==that.Variants.indexOf(d[i])?set.fontWeight||-1==that.Weights.indexOf(d[i])?set.fontSize?"inherit"!=d[i]&&(ff+=d[i]):("inherit"!=d[i]&&(f.fontSize=d[i].split("/")[0]),set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=!0):("inherit"!=d[i]&&(f.fontWeight=d[i]),set.fontStyle=set.fontVariant=set.fontWeight=!0):("inherit"!=d[i]&&(f.fontVariant=d[i]),set.fontStyle=set.fontVariant=!0):("inherit"!=d[i]&&(f.fontStyle=d[i]),set.fontStyle=!0);return""!=ff&&(f.fontFamily=ff),f}},svg.ToNumberArray=function(s){for(var a=svg.trim(svg.compressSpaces((s||"").replace(/,/g," "))).split(" "),i=0;i<a.length;i++)a[i]=parseFloat(a[i]);return a},svg.Point=function(x,y){this.x=x,this.y=y},svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)},svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4],yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp,this.y=yp},svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1])},svg.CreatePath=function(s){for(var a=svg.ToNumberArray(s),path=[],i=0;i<a.length;i+=2)path.push(new svg.Point(a[i],a[i+1]));return path},svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(x,y){null!=x&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=x,this.x2=x),x<this.x1&&(this.x1=x),x>this.x2&&(this.x2=x)),null!=y&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=y,this.y2=y),y<this.y1&&(this.y1=y),y>this.y2&&(this.y2=y))},this.addX=function(x){this.addPoint(x,null)},this.addY=function(y){this.addPoint(null,y)},this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1),this.addPoint(bb.x2,bb.y2)},this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x),cp1y=p0y+2/3*(p1y-p0y),cp2x=cp1x+1/3*(p2x-p0x),cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y)},this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];for(this.addPoint(p0[0],p0[1]),this.addPoint(p3[0],p3[1]),i=0;i<=1;i++){var f=function(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i]},b=6*p0[i]-12*p1[i]+6*p2[i],a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i],c=3*p1[i]-3*p0[i];if(0!=a){var b2ac=Math.pow(b,2)-4*c*a;if(!(b2ac<0)){var t1=(-b+Math.sqrt(b2ac))/(2*a);0<t1&&t1<1&&(0==i&&this.addX(f(t1)),1==i&&this.addY(f(t1)));var t2=(-b-Math.sqrt(b2ac))/(2*a);0<t2&&t2<1&&(0==i&&this.addX(f(t2)),1==i&&this.addY(f(t2)))}}else{if(0==b)continue;var t=-c/b;0<t&&t<1&&(0==i&&this.addX(f(t)),1==i&&this.addY(f(t)))}}},this.isPointInBox=function(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2},this.addPoint(x1,y1),this.addPoint(x2,y2)},svg.Transform=function(v){var that=this;this.Type={},this.Type.translate=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.translate(this.p.x||0,this.p.y||0)},this.unapply=function(ctx){ctx.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property("angle",a[0]),this.cx=a[1]||0,this.cy=a[2]||0,this.apply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.unapply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(-1*this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]),p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(ctx){ctx.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(p){p.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(s){this.m=svg.ToNumberArray(s),this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(p){p.applyTransform(this.m)}},this.Type.SkewBase=function(s){this.base=that.Type.matrix,this.base(s),this.angle=new svg.Property("angle",s)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++)this.transforms[i].apply(ctx)},this.unapply=function(ctx){for(var i=this.transforms.length-1;i>=0;i--)this.transforms[i].unapply(ctx)},this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++)this.transforms[i].applyToPoint(p)};for(var data=svg.trim(svg.compressSpaces(v)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<data.length;i++){var type=svg.trim(data[i].split("(")[0]),s=data[i].split("(")[1].replace(")",""),transform=new this.Type[type](s);transform.type=type,this.transforms.push(transform)}},svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){aspectRatio=svg.compressSpaces(aspectRatio),aspectRatio=aspectRatio.replace(/^defer\s/,"");var align=aspectRatio.split(" ")[0]||"xMidYMid",meetOrSlice=aspectRatio.split(" ")[1]||"meet",scaleX=width/desiredWidth,scaleY=height/desiredHeight,scaleMin=Math.min(scaleX,scaleY),scaleMax=Math.max(scaleX,scaleY);"meet"==meetOrSlice&&(desiredWidth*=scaleMin,desiredHeight*=scaleMin),"slice"==meetOrSlice&&(desiredWidth*=scaleMax,desiredHeight*=scaleMax),refX=new svg.Property("refX",refX),refY=new svg.Property("refY",refY),refX.hasValue()&&refY.hasValue()?ctx.translate(-scaleMin*refX.toPixels("x"),-scaleMin*refY.toPixels("y")):(align.match(/^xMid/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width/2-desiredWidth/2,0),align.match(/YMid$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height/2-desiredHeight/2),align.match(/^xMax/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width-desiredWidth,0),align.match(/YMax$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height-desiredHeight)),"none"==align?ctx.scale(scaleX,scaleY):"meet"==meetOrSlice?ctx.scale(scaleMin,scaleMin):"slice"==meetOrSlice&&ctx.scale(scaleMax,scaleMax),ctx.translate(null==minX?0:-minX,null==minY?0:-minY)},svg.Element={},svg.EmptyProperty=new svg.Property("EMPTY",""),svg.Element.ElementBase=function(node){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(name,createIfNotExists){var a=this.attributes[name];return null!=a?a:(1==createIfNotExists&&(a=new svg.Property(name,""),this.attributes[name]=a),a||svg.EmptyProperty)},this.getHrefAttribute=function(){for(var a in this.attributes)if(a.match(/:href$/))return this.attributes[a];return svg.EmptyProperty},this.style=function(name,createIfNotExists){var s=this.styles[name];if(null!=s)return s;var a=this.attribute(name);if(null!=a&&a.hasValue())return this.styles[name]=a,a;var p=this.parent;if(null!=p){var ps=p.style(name);if(null!=ps&&ps.hasValue())return ps}return 1==createIfNotExists&&(s=new svg.Property(name,""),this.styles[name]=s),s||svg.EmptyProperty},this.render=function(ctx){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(ctx.save(),this.attribute("mask").hasValue()){var mask=this.attribute("mask").getDefinition();null!=mask&&mask.apply(ctx,this)}else if(this.style("filter").hasValue()){var filter=this.style("filter").getDefinition();null!=filter&&filter.apply(ctx,this)}else this.setContext(ctx),this.renderChildren(ctx),this.clearContext(ctx);ctx.restore()}},this.setContext=function(ctx){},this.clearContext=function(ctx){},this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++)this.children[i].render(ctx)},this.addChild=function(childNode,create){var child=childNode;create&&(child=svg.CreateElement(childNode)),child.parent=this,this.children.push(child)},null!=node&&1==node.nodeType){for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];if(1==childNode.nodeType&&this.addChild(childNode,!0),this.captureTextNodes&&3==childNode.nodeType){var text=childNode.nodeValue||childNode.text||"";""!=svg.trim(svg.compressSpaces(text))&&this.addChild(new svg.Element.tspan(childNode),!1)}}for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];this.attributes[attribute.nodeName]=new svg.Property(attribute.nodeName,attribute.nodeValue)}var styles=svg.Styles[node.nodeName];if(null!=styles)for(var name in styles)this.styles[name]=styles[name];if(this.attribute("class").hasValue())for(var classes=svg.compressSpaces(this.attribute("class").value).split(" "),j=0;j<classes.length;j++){if(null!=(styles=svg.Styles["."+classes[j]]))for(var name in styles)this.styles[name]=styles[name];if(null!=(styles=svg.Styles[node.nodeName+"."+classes[j]]))for(var name in styles)this.styles[name]=styles[name]}if(this.attribute("id").hasValue()){var styles=svg.Styles["#"+this.attribute("id").value];if(null!=styles)for(var name in styles)this.styles[name]=styles[name]}if(this.attribute("style").hasValue())for(var styles=this.attribute("style").value.split(";"),i=0;i<styles.length;i++)if(""!=svg.trim(styles[i])){var style=styles[i].split(":"),name=svg.trim(style[0]),value=svg.trim(style[1]);this.styles[name]=new svg.Property(name,value)}this.attribute("id").hasValue()&&null==svg.Definitions[this.attribute("id").value]&&(svg.Definitions[this.attribute("id").value]=this)}},svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.setContext=function(ctx){if(this.style("fill").isUrlDefinition()){var fs=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=fs&&(ctx.fillStyle=fs)}else if(this.style("fill").hasValue()){var fillStyle=this.style("fill");"currentColor"==fillStyle.value&&(fillStyle.value=this.style("color").value),ctx.fillStyle="none"==fillStyle.value?"rgba(0,0,0,0)":fillStyle.value}if(this.style("fill-opacity").hasValue()){var fillStyle=new svg.Property("fill",ctx.fillStyle);fillStyle=fillStyle.addOpacity(this.style("fill-opacity").value),ctx.fillStyle=fillStyle.value}if(this.style("stroke").isUrlDefinition()){var fs=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=fs&&(ctx.strokeStyle=fs)}else if(this.style("stroke").hasValue()){var strokeStyle=this.style("stroke");"currentColor"==strokeStyle.value&&(strokeStyle.value=this.style("color").value),ctx.strokeStyle="none"==strokeStyle.value?"rgba(0,0,0,0)":strokeStyle.value}if(this.style("stroke-opacity").hasValue()){var strokeStyle=new svg.Property("stroke",ctx.strokeStyle);strokeStyle=strokeStyle.addOpacity(this.style("stroke-opacity").value),ctx.strokeStyle=strokeStyle.value}if(this.style("stroke-width").hasValue()){var newLineWidth=this.style("stroke-width").toPixels();ctx.lineWidth=0==newLineWidth?.001:newLineWidth}if(this.style("stroke-linecap").hasValue()&&(ctx.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(ctx.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(ctx.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var gaps=svg.ToNumberArray(this.style("stroke-dasharray").value);void 0!==ctx.setLineDash?ctx.setLineDash(gaps):void 0!==ctx.webkitLineDash?ctx.webkitLineDash=gaps:void 0!==ctx.mozDash&&(ctx.mozDash=gaps);var offset=this.style("stroke-dashoffset").numValueOrDefault(1);void 0!==ctx.lineDashOffset?ctx.lineDashOffset=offset:void 0!==ctx.webkitLineDashOffset?ctx.webkitLineDashOffset=offset:void 0!==ctx.mozDashOffset&&(ctx.mozDashOffset=offset)}if(void 0!==ctx.font&&(ctx.font=svg.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){new svg.Transform(this.attribute("transform").value).apply(ctx)}if(this.style("clip-path").hasValue()){var clip=this.style("clip-path").getDefinition();null!=clip&&clip.apply(ctx)}this.style("opacity").hasValue()&&(ctx.globalAlpha=this.style("opacity").numValue())}},svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase,svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.path=function(ctx){return null!=ctx&&ctx.beginPath(),new svg.BoundingBox},this.renderChildren=function(ctx){this.path(ctx),svg.Mouse.checkPath(this,ctx),""!=ctx.fillStyle&&(this.attribute("fill-rule").hasValue()?ctx.fill(this.attribute("fill-rule").value):ctx.fill()),""!=ctx.strokeStyle&&ctx.stroke();var markers=this.getMarkers();if(null!=markers){if(this.style("marker-start").isUrlDefinition()){var marker=this.style("marker-start").getDefinition();marker.render(ctx,markers[0][0],markers[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var marker=this.style("marker-mid").getDefinition(),i=1;i<markers.length-1;i++)marker.render(ctx,markers[i][0],markers[i][1]);if(this.style("marker-end").isUrlDefinition()){var marker=this.style("marker-end").getDefinition();marker.render(ctx,markers[markers.length-1][0],markers[markers.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseClearContext=this.clearContext,this.clearContext=function(ctx){this.baseClearContext(ctx),svg.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(ctx){ctx.strokeStyle="rgba(0,0,0,0)",ctx.lineCap="butt",ctx.lineJoin="miter",ctx.miterLimit=4,this.baseSetContext(ctx),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),
this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),ctx.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var width=svg.ViewPort.width(),height=svg.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");var x=0,y=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(x=-this.attribute("refX").toPixels("x"),y=-this.attribute("refY").toPixels("y")),ctx.beginPath(),ctx.moveTo(x,y),ctx.lineTo(width,y),ctx.lineTo(width,height),ctx.lineTo(x,height),ctx.closePath(),ctx.clip()}if(svg.ViewPort.SetCurrent(width,height),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute("refX").value,this.attribute("refY").value),svg.ViewPort.RemoveCurrent(),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.svg.prototype=new svg.Element.RenderedElementBase,svg.Element.rect=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y"),rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(ry=rx),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(rx=ry),rx=Math.min(rx,width/2),ry=Math.min(ry,height/2),null!=ctx&&(ctx.beginPath(),ctx.moveTo(x+rx,y),ctx.lineTo(x+width-rx,y),ctx.quadraticCurveTo(x+width,y,x+width,y+ry),ctx.lineTo(x+width,y+height-ry),ctx.quadraticCurveTo(x+width,y+height,x+width-rx,y+height),ctx.lineTo(x+rx,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-ry),ctx.lineTo(x,y+ry),ctx.quadraticCurveTo(x,y,x+rx,y),ctx.closePath()),new svg.BoundingBox(x,y,x+width,y+height)}},svg.Element.rect.prototype=new svg.Element.PathElementBase,svg.Element.circle=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=ctx&&(ctx.beginPath(),ctx.arc(cx,cy,r,0,2*Math.PI,!0),ctx.closePath()),new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r)}},svg.Element.circle.prototype=new svg.Element.PathElementBase,svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var KAPPA=(Math.sqrt(2)-1)/3*4,rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y"),cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y");return null!=ctx&&(ctx.beginPath(),ctx.moveTo(cx,cy-ry),ctx.bezierCurveTo(cx+KAPPA*rx,cy-ry,cx+rx,cy-KAPPA*ry,cx+rx,cy),ctx.bezierCurveTo(cx+rx,cy+KAPPA*ry,cx+KAPPA*rx,cy+ry,cx,cy+ry),ctx.bezierCurveTo(cx-KAPPA*rx,cy+ry,cx-rx,cy+KAPPA*ry,cx-rx,cy),ctx.bezierCurveTo(cx-rx,cy-KAPPA*ry,cx-KAPPA*rx,cy-ry,cx,cy-ry),ctx.closePath()),new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry)}},svg.Element.ellipse.prototype=new svg.Element.PathElementBase,svg.Element.line=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.getPoints=function(){return[new svg.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new svg.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(ctx){var points=this.getPoints();return null!=ctx&&(ctx.beginPath(),ctx.moveTo(points[0].x,points[0].y),ctx.lineTo(points[1].x,points[1].y)),new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y)},this.getMarkers=function(){var points=this.getPoints(),a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]]}},svg.Element.line.prototype=new svg.Element.PathElementBase,svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.points=svg.CreatePath(this.attribute("points").value),this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);null!=ctx&&(ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)bb.addPoint(this.points[i].x,this.points[i].y),null!=ctx&&ctx.lineTo(this.points[i].x,this.points[i].y);return bb},this.getMarkers=function(){for(var markers=[],i=0;i<this.points.length-1;i++)markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])]);return markers.push([this.points[this.points.length-1],markers[markers.length-1][1]]),markers}},svg.Element.polyline.prototype=new svg.Element.PathElementBase,svg.Element.polygon=function(node){this.base=svg.Element.polyline,this.base(node),this.basePath=this.path,this.path=function(ctx){var bb=this.basePath(ctx);return null!=ctx&&(ctx.lineTo(this.points[0].x,this.points[0].y),ctx.closePath()),bb}},svg.Element.polygon.prototype=new svg.Element.polyline,svg.Element.path=function(node){this.base=svg.Element.PathElementBase,this.base(node);var d=this.attribute("d").value;d=d.replace(/,/gm," "),d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),d=d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),d=d.replace(/([0-9])([+\-])/gm,"$1 $2"),d=d.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),d=d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),d=svg.compressSpaces(d),d=svg.trim(d),this.PathParser=new function(d){this.tokens=d.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new svg.Point(0,0),this.control=new svg.Point(0,0),this.current=new svg.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)},this.getAsControlPoint=function(){var p=this.getPoint();return this.control=p,p},this.getAsCurrentPoint=function(){var p=this.getPoint();return this.current=p,p},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(p){return this.isRelativeCommand()&&(p.x+=this.current.x,p.y+=this.current.y),p},this.addMarker=function(p,from,priorTo){null!=priorTo&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo)),this.addMarkerAngle(p,null==from?null:from.angleTo(p))},this.addMarkerAngle=function(p,a){this.points.push(p),this.angles.push(a)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++)if(null==this.angles[i])for(var j=i+1;j<this.angles.length;j++)if(null!=this.angles[j]){this.angles[i]=this.angles[j];break}return this.angles}}(d),this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox;for(null!=ctx&&ctx.beginPath();!pp.isEnd();)switch(pp.nextCommand(),pp.command){case"M":case"m":var p=pp.getAsCurrentPoint();for(pp.addMarker(p),bb.addPoint(p.x,p.y),null!=ctx&&ctx.moveTo(p.x,p.y),pp.start=pp.current;!pp.isCommandOrEnd();){var p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"L":case"l":for(;!pp.isCommandOrEnd();){var c=pp.current,p=pp.getAsCurrentPoint();pp.addMarker(p,c),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"H":case"h":for(;!pp.isCommandOrEnd();){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"V":case"v":for(;!pp.isCommandOrEnd();){var newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"C":case"c":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"S":case"s":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getReflectedControlPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"Q":case"q":for(;!pp.isCommandOrEnd();){var curr=pp.current,cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"T":case"t":for(;!pp.isCommandOrEnd();){var curr=pp.current,cntrl=pp.getReflectedControlPoint();pp.control=cntrl;var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"A":case"a":for(;!pp.isCommandOrEnd();){var curr=pp.current,rx=pp.getScalar(),ry=pp.getScalar(),xAxisRotation=pp.getScalar()*(Math.PI/180),largeArcFlag=pp.getScalar(),sweepFlag=pp.getScalar(),cp=pp.getAsCurrentPoint(),currp=new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2),l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);l>1&&(rx*=Math.sqrt(l),ry*=Math.sqrt(l));var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt((Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(currp.y,2)-Math.pow(ry,2)*Math.pow(currp.x,2))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));isNaN(s)&&(s=0);var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx),centp=new svg.Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y),m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))},r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))},a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))},a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]),u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry],v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry],ad=a(u,v);r(u,v)<=-1&&(ad=Math.PI),r(u,v)>=1&&(ad=0);var dir=1-sweepFlag?1:-1,ah=a1+dir*(ad/2),halfWay=new svg.Point(centp.x+rx*Math.cos(ah),centp.y+ry*Math.sin(ah));if(pp.addMarkerAngle(halfWay,ah-dir*Math.PI/2),pp.addMarkerAngle(cp,ah-dir*Math.PI),bb.addPoint(cp.x,cp.y),null!=ctx){var r=rx>ry?rx:ry,sx=rx>ry?1:rx/ry,sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y),ctx.rotate(xAxisRotation),ctx.scale(sx,sy),ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag),ctx.scale(1/sx,1/sy),ctx.rotate(-xAxisRotation),ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":null!=ctx&&ctx.closePath(),pp.current=pp.start}return bb},this.getMarkers=function(){for(var points=this.PathParser.getMarkerPoints(),angles=this.PathParser.getMarkerAngles(),markers=[],i=0;i<points.length;i++)markers.push([points[i],angles[i]]);return markers}},svg.Element.path.prototype=new svg.Element.PathElementBase,svg.Element.pattern=function(node){this.base=svg.Element.ElementBase,this.base(node),this.createPattern=function(ctx,element){var width=this.attribute("width").toPixels("x",!0),height=this.attribute("height").toPixels("y",!0),tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.width=new svg.Property("width",width+"px"),tempSvg.attributes.height=new svg.Property("height",height+"px"),tempSvg.attributes.transform=new svg.Property("transform",this.attribute("patternTransform").value),tempSvg.children=this.children;var c=document.createElement("canvas");c.width=width,c.height=height;var cctx=c.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&cctx.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var x=-1;x<=1;x++)for(var y=-1;y<=1;y++)cctx.save(),cctx.translate(x*c.width,y*c.height),tempSvg.render(cctx),cctx.restore();return ctx.createPattern(c,"repeat")}},svg.Element.pattern.prototype=new svg.Element.ElementBase,svg.Element.marker=function(node){this.base=svg.Element.ElementBase,this.base(node),this.baseRender=this.render,this.render=function(ctx,point,angle){ctx.translate(point.x,point.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(angle),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(ctx.lineWidth,ctx.lineWidth),ctx.save();var tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.refX=new svg.Property("refX",this.attribute("refX").value),tempSvg.attributes.refY=new svg.Property("refY",this.attribute("refY").value),tempSvg.attributes.width=new svg.Property("width",this.attribute("markerWidth").value),tempSvg.attributes.height=new svg.Property("height",this.attribute("markerHeight").value),tempSvg.attributes.fill=new svg.Property("fill",this.attribute("fill").valueOrDefault("black")),tempSvg.attributes.stroke=new svg.Property("stroke",this.attribute("stroke").valueOrDefault("none")),tempSvg.children=this.children,tempSvg.render(ctx),ctx.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(-angle),ctx.translate(-point.x,-point.y)}},svg.Element.marker.prototype=new svg.Element.ElementBase,svg.Element.defs=function(node){this.base=svg.Element.ElementBase,this.base(node),this.render=function(ctx){}},svg.Element.defs.prototype=new svg.Element.ElementBase,svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"stop"==child.type&&this.stops.push(child)}this.getGradient=function(){},this.createGradient=function(ctx,element,parentOpacityProp){var stopsContainer=this;this.getHrefAttribute().hasValue()&&(stopsContainer=this.getHrefAttribute().getDefinition());var addParentOpacity=function(color){if(parentOpacityProp.hasValue()){return new svg.Property("color",color).addOpacity(parentOpacityProp.value).value}return color},g=this.getGradient(ctx,element);if(null==g)return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length-1].color);for(var i=0;i<stopsContainer.stops.length;i++)g.addColorStop(stopsContainer.stops[i].offset,addParentOpacity(stopsContainer.stops[i].color));if(this.attribute("gradientTransform").hasValue()){var rootView=svg.ViewPort.viewPorts[0],rect=new svg.Element.rect;rect.attributes.x=new svg.Property("x",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.y=new svg.Property("y",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.width=new svg.Property("width",svg.MAX_VIRTUAL_PIXELS),rect.attributes.height=new svg.Property("height",svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g;group.attributes.transform=new svg.Property("transform",this.attribute("gradientTransform").value),group.children=[rect];var tempSvg=new svg.Element.svg;tempSvg.attributes.x=new svg.Property("x",0),tempSvg.attributes.y=new svg.Property("y",0),tempSvg.attributes.width=new svg.Property("width",rootView.width),tempSvg.attributes.height=new svg.Property("height",rootView.height),tempSvg.children=[group];var c=document.createElement("canvas");c.width=rootView.width,c.height=rootView.height;var tempCtx=c.getContext("2d");return tempCtx.fillStyle=g,tempSvg.render(tempCtx),tempCtx.createPattern(c,"no-repeat")}return g}},svg.Element.GradientBase.prototype=new svg.Element.ElementBase,svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.getGradient=function(ctx,element){var bb=element.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var x1="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),y1="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),x2="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),y2="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return x1==x2&&y1==y2?null:ctx.createLinearGradient(x1,y1,x2,y2)}},svg.Element.linearGradient.prototype=new svg.Element.GradientBase,svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.getGradient=function(ctx,element){var bb=element.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var cx="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),cy="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),fx=cx,fy=cy;this.attribute("fx").hasValue()&&(fx="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(fy="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var r="objectBoundingBox"==this.gradientUnits?(bb.width()+bb.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return ctx.createRadialGradient(fx,fy,0,cx,cy,r)}},svg.Element.radialGradient.prototype=new svg.Element.GradientBase,svg.Element.stop=function(node){this.base=svg.Element.ElementBase,this.base(node),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var stopColor=this.style("stop-color");this.style("stop-opacity").hasValue()&&(stopColor=stopColor.addOpacity(this.style("stop-opacity").value)),this.color=stopColor.value},svg.Element.stop.prototype=new svg.Element.ElementBase,svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase,this.base(node),svg.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var attributeType=this.attribute("attributeType").value,attributeName=this.attribute("attributeName").value;return"CSS"==attributeType?this.parent.style(attributeName,!0):this.parent.attribute(attributeName,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(delta){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed&&(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+delta;var updated=!1;if(this.begin<this.duration){var newValue=this.calcValue();if(this.attribute("type").hasValue()){newValue=this.attribute("type").value+"("+newValue+")"}this.getProperty().value=newValue,updated=!0}return updated},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1),lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property("from",parseFloat(this.values.value[lb])),ret.to=new svg.Property("to",parseFloat(this.values.value[ub])),ret.progress=(p-lb)/(ub-lb)}else ret.from=this.from,ret.to=this.to;return ret}},svg.Element.AnimateBase.prototype=new svg.Element.ElementBase,svg.Element.animate=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress();return p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress+this.initialUnits}},svg.Element.animate.prototype=new svg.Element.AnimateBase,svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress(),from=new RGBColor(p.from.value),to=new RGBColor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress,g=from.g+(to.g-from.g)*p.progress,b=from.b+(to.b-from.b)*p.progress;return"rgb("+parseInt(r,10)+","+parseInt(g,10)+","+parseInt(b,10)+")"}return this.attribute("from").value}},svg.Element.animateColor.prototype=new svg.Element.AnimateBase,svg.Element.animateTransform=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){for(var p=this.progress(),from=svg.ToNumberArray(p.from.value),to=svg.ToNumberArray(p.to.value),newValue="",i=0;i<from.length;i++)newValue+=from[i]+(to[i]-from[i])*p.progress+" ";return newValue}},svg.Element.animateTransform.prototype=new svg.Element.animate,svg.Element.font=function(node){this.base=svg.Element.ElementBase,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"font-face"==child.type?(this.fontFace=child,child.style("font-family").hasValue()&&(svg.Definitions[child.style("font-family").value]=this)):"missing-glyph"==child.type?this.missingGlyph=child:"glyph"==child.type&&(""!=child.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[child.unicode]&&(this.glyphs[child.unicode]=[]),this.glyphs[child.unicode][child.arabicForm]=child):this.glyphs[child.unicode]=child)}},svg.Element.font.prototype=new svg.Element.ElementBase,svg.Element.fontface=function(node){this.base=svg.Element.ElementBase,this.base(node),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},svg.Element.fontface.prototype=new svg.Element.ElementBase,svg.Element.missingglyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=0},svg.Element.missingglyph.prototype=new svg.Element.path,svg.Element.glyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},svg.Element.glyph.prototype=new svg.Element.path,svg.Element.text=function(node){this.captureTextNodes=!0,this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.style("dominant-baseline").hasValue()&&(ctx.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(ctx.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new svg.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(ctx){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(ctx,this,0);for(var i=0;i<this.children.length;i++)this.renderChild(ctx,this,i)},this.getAnchorDelta=function(ctx,parent,startI){var textAnchor=this.style("text-anchor").valueOrDefault("start");if("start"!=textAnchor){for(var width=0,i=startI;i<parent.children.length;i++){var child=parent.children[i];if(i>startI&&child.attribute("x").hasValue())break;width+=child.measureTextRecursive(ctx)}return-1*("end"==textAnchor?width:width/2)}return 0},this.renderChild=function(ctx,parent,i){var child=parent.children[i];child.attribute("x").hasValue()?child.x=child.attribute("x").toPixels("x")+this.getAnchorDelta(ctx,parent,i):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),child.attribute("dx").hasValue()&&(this.x+=child.attribute("dx").toPixels("x")),child.x=this.x),this.x=child.x+child.measureText(ctx),child.attribute("y").hasValue()?child.y=child.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),child.attribute("dy").hasValue()&&(this.y+=child.attribute("dy").toPixels("y")),child.y=this.y),this.y=child.y,child.render(ctx);for(var i=0;i<child.children.length;i++)this.renderChild(ctx,child,i)}},svg.Element.text.prototype=new svg.Element.RenderedElementBase,svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getGlyph=function(font,text,i){var c=text[i],glyph=null;if(font.isArabic){var arabicForm="isolated";(0==i||" "==text[i-1])&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="terminal"),i>0&&" "!=text[i-1]&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="medial"),i>0&&" "!=text[i-1]&&(i==text.length-1||" "==text[i+1])&&(arabicForm="initial"),void 0!==font.glyphs[c]&&null==(glyph=font.glyphs[c][arabicForm])&&"glyph"==font.glyphs[c].type&&(glyph=font.glyphs[c])}else glyph=font.glyphs[c];return null==glyph&&(glyph=font.missingGlyph),glyph},this.renderChildren=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null==customFont)""!=ctx.fillStyle&&ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y),""!=ctx.strokeStyle&&ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);else{var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),fontStyle=this.parent.style("font-style").valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle),text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i),scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y),ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize,"italic"==fontStyle&&ctx.transform(1,0,.4,1,0,0),glyph.render(ctx),"italic"==fontStyle&&ctx.transform(1,0,-.4,1,0,0),ctx.lineWidth=lw,ctx.scale(1/scale,-1/scale),ctx.translate(-this.x,-this.y),this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm,void 0===dx[i]||isNaN(dx[i])||(this.x+=dx[i])}}},this.getText=function(){},this.measureTextRecursive=function(ctx){for(var width=this.measureText(ctx),i=0;i<this.children.length;i++)width+=this.children[i].measureTextRecursive(ctx);return width},this.measureText=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null!=customFont){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),measure=0,text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){measure+=(this.getGlyph(customFont,text,i).horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm,void 0===dx[i]||isNaN(dx[i])||(measure+=dx[i])}return measure}var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText)return 10*textToMeasure.length;ctx.save(),this.setContext(ctx);var width=ctx.measureText(textToMeasure).width;return ctx.restore(),width}},svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.tspan=function(node){this.captureTextNodes=!0,this.base=svg.Element.TextElementBase,this.base(node),this.text=node.nodeValue||node.text||"",this.getText=function(){return this.text}},svg.Element.tspan.prototype=new svg.Element.TextElementBase,svg.Element.tref=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.getText=function(){var element=this.getHrefAttribute().getDefinition();if(null!=element)return element.children[0].getText()}},svg.Element.tref.prototype=new svg.Element.TextElementBase,svg.Element.a=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.hasText=!0;for(var i=0;i<node.childNodes.length;i++)3!=node.childNodes[i].nodeType&&(this.hasText=!1);this.text=this.hasText?node.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels("y"),this.x+this.measureText(ctx),this.y))}else{var g=new svg.Element.g;g.children=this.children,g.parent=this,g.render(ctx)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){svg.ctx.canvas.style.cursor="pointer"}},svg.Element.a.prototype=new svg.Element.TextElementBase,svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase,this.base(node);var href=this.getHrefAttribute().value,isSvg=href.match(/\.svg$/);if(svg.Images.push(this),this.loaded=!1,isSvg)this.img=svg.ajax(href),this.loaded=!0;else{this.img=document.createElement("img");var self=this;this.img.onload=function(){self.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+href+'" not found'),self.loaded=!0)},this.img.src=href}this.renderChildren=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");0!=width&&0!=height&&(ctx.save(),isSvg?ctx.drawSvg(this.img,x,y,width,height):(ctx.translate(x,y),svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,width,this.img.width,height,this.img.height,0,0),ctx.drawImage(this.img,0,0)),ctx.restore())},this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");return new svg.BoundingBox(x,y,x+width,y+height)}},svg.Element.image.prototype=new svg.Element.RenderedElementBase,svg.Element.g=function(node){
this.base=svg.Element.RenderedElementBase,this.base(node),this.getBoundingBox=function(){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());return bb}},svg.Element.g.prototype=new svg.Element.RenderedElementBase,svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){if(this.baseSetContext(ctx),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,minX,minY),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.symbol.prototype=new svg.Element.RenderedElementBase,svg.Element.style=function(node){this.base=svg.Element.ElementBase,this.base(node);for(var css="",i=0;i<node.childNodes.length;i++)css+=node.childNodes[i].nodeValue;css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),css=svg.compressSpaces(css);for(var cssDefs=css.split("}"),i=0;i<cssDefs.length;i++)if(""!=svg.trim(cssDefs[i]))for(var cssDef=cssDefs[i].split("{"),cssClasses=cssDef[0].split(","),cssProps=cssDef[1].split(";"),j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(""!=cssClass){for(var props={},k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(":"),name=cssProps[k].substr(0,prop),value=cssProps[k].substr(prop+1,cssProps[k].length-prop);null!=name&&null!=value&&(props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value)))}if(svg.Styles[cssClass]=props,"@font-face"==cssClass)for(var fontFamily=props["font-family"].value.replace(/"/g,""),srcs=props.src.value.split(","),s=0;s<srcs.length;s++)if(srcs[s].indexOf('format("svg")')>0)for(var urlStart=srcs[s].indexOf("url"),urlEnd=srcs[s].indexOf(")",urlStart),url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6),doc=svg.parseXml(svg.ajax(url)),fonts=doc.getElementsByTagName("font"),f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font}}}},svg.Element.style.prototype=new svg.Element.ElementBase,svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.attribute("x").hasValue()&&ctx.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&ctx.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var element=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(element.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(element.attribute("height",!0).value=this.attribute("height").value),element},this.path=function(ctx){var element=this.getDefinition();null!=element&&element.path(ctx)},this.getBoundingBox=function(){var element=this.getDefinition();if(null!=element)return element.getBoundingBox()},this.renderChildren=function(ctx){var element=this.getDefinition();if(null!=element){var oldParent=element.parent;element.parent=null,element.render(ctx),element.parent=oldParent}}},svg.Element.use.prototype=new svg.Element.RenderedElementBase,svg.Element.mask=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");if(0==width&&0==height){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());var x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height())}var mask=element.attribute("mask").value;element.attribute("mask").value="";var cMask=document.createElement("canvas");cMask.width=x+width,cMask.height=y+height;var maskCtx=cMask.getContext("2d");this.renderChildren(maskCtx);var c=document.createElement("canvas");c.width=x+width,c.height=y+height;var tempCtx=c.getContext("2d");element.render(tempCtx),tempCtx.globalCompositeOperation="destination-in",tempCtx.fillStyle=maskCtx.createPattern(cMask,"no-repeat"),tempCtx.fillRect(0,0,x+width,y+height),ctx.fillStyle=tempCtx.createPattern(c,"no-repeat"),ctx.fillRect(0,0,x+width,y+height),element.attribute("mask").value=mask},this.render=function(ctx){}},svg.Element.mask.prototype=new svg.Element.ElementBase,svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx){for(var i=0;i<this.children.length;i++){var child=this.children[i];if(void 0!==child.path){var transform=null;child.attribute("transform").hasValue()&&(transform=new svg.Transform(child.attribute("transform").value),transform.apply(ctx)),child.path(ctx),ctx.clip(),transform&&transform.unapply(ctx)}}},this.render=function(ctx){}},svg.Element.clipPath.prototype=new svg.Element.ElementBase,svg.Element.filter=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var bb=element.getBoundingBox(),x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height()),filter=element.style("filter").value;element.style("filter").value="";for(var px=0,py=0,i=0;i<this.children.length;i++){var efd=this.children[i].extraFilterDistance||0;px=Math.max(px,efd),py=Math.max(py,efd)}var c=document.createElement("canvas");c.width=width+2*px,c.height=height+2*py;var tempCtx=c.getContext("2d");tempCtx.translate(-x+px,-y+py),element.render(tempCtx);for(var i=0;i<this.children.length;i++)this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py);ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py),element.style("filter",!0).value=filter},this.render=function(ctx){}},svg.Element.filter.prototype=new svg.Element.ElementBase,svg.Element.feMorphology=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,x,y,width,height){}},svg.Element.feMorphology.prototype=new svg.Element.ElementBase,svg.Element.feColorMatrix=function(node){function imGet(img,x,y,width,height,rgba){return img[y*width*4+4*x+rgba]}function imSet(img,x,y,width,height,rgba,val){img[y*width*4+4*x+rgba]=val}this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,x,y,width,height){for(var srcData=ctx.getImageData(0,0,width,height),y=0;y<height;y++)for(var x=0;x<width;x++){var r=imGet(srcData.data,x,y,width,height,0),g=imGet(srcData.data,x,y,width,height,1),b=imGet(srcData.data,x,y,width,height,2),gray=(r+g+b)/3;imSet(srcData.data,x,y,width,height,0,gray),imSet(srcData.data,x,y,width,height,1,gray),imSet(srcData.data,x,y,width,height,2,gray)}ctx.clearRect(0,0,width,height),ctx.putImageData(srcData,0,0)}},svg.Element.feColorMatrix.prototype=new svg.Element.ElementBase,svg.Element.feGaussianBlur=function(node){this.base=svg.Element.ElementBase,this.base(node),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(ctx,x,y,width,height){if(void 0===stackBlurCanvasRGBA)return void("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work"));ctx.canvas.id=svg.UniqueId(),ctx.canvas.style.display="none",document.body.appendChild(ctx.canvas),stackBlurCanvasRGBA(ctx.canvas.id,x,y,width,height,this.blurRadius),document.body.removeChild(ctx.canvas)}},svg.Element.feGaussianBlur.prototype=new svg.Element.ElementBase,svg.Element.title=function(node){},svg.Element.title.prototype=new svg.Element.ElementBase,svg.Element.desc=function(node){},svg.Element.desc.prototype=new svg.Element.ElementBase,svg.Element.MISSING=function(node){"undefined"!=typeof console&&console.log("ERROR: Element '"+node.nodeName+"' not yet implemented.")},svg.Element.MISSING.prototype=new svg.Element.ElementBase,svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,"");className=className.replace(/\-/g,"");var e=null;return e=void 0!==svg.Element[className]?new svg.Element[className](node):new svg.Element.MISSING(node),e.type=node.nodeName,e},svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url))},svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml))},svg.loadXmlDoc=function(ctx,dom){svg.init(ctx);var mapXY=function(p){for(var e=ctx.canvas;e;)p.x-=e.offsetLeft,p.y-=e.offsetTop,e=e.offsetParent;return window.scrollX&&(p.x+=window.scrollX),window.scrollY&&(p.y+=window.scrollY),p};1!=svg.opts.ignoreMouse&&(ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y)},ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y)});var e=svg.CreateElement(dom.documentElement);e.root=!0;var isFirstRender=!0,draw=function(){svg.ViewPort.Clear(),ctx.canvas.parentNode&&svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight),1!=svg.opts.ignoreDimensions&&(e.style("width").hasValue()&&(ctx.canvas.width=e.style("width").toPixels("x"),ctx.canvas.style.width=ctx.canvas.width+"px"),e.style("height").hasValue()&&(ctx.canvas.height=e.style("height").toPixels("y"),ctx.canvas.style.height=ctx.canvas.height+"px"));var cWidth=ctx.canvas.clientWidth||ctx.canvas.width,cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(1==svg.opts.ignoreDimensions&&e.style("width").hasValue()&&e.style("height").hasValue()&&(cWidth=e.style("width").toPixels("x"),cHeight=e.style("height").toPixels("y")),svg.ViewPort.SetCurrent(cWidth,cHeight),null!=svg.opts.offsetX&&(e.attribute("x",!0).value=svg.opts.offsetX),null!=svg.opts.offsetY&&(e.attribute("y",!0).value=svg.opts.offsetY),null!=svg.opts.scaleWidth&&null!=svg.opts.scaleHeight){var xRatio=1,yRatio=1,viewBox=svg.ToNumberArray(e.attribute("viewBox").value);e.attribute("width").hasValue()?xRatio=e.attribute("width").toPixels("x")/svg.opts.scaleWidth:isNaN(viewBox[2])||(xRatio=viewBox[2]/svg.opts.scaleWidth),e.attribute("height").hasValue()?yRatio=e.attribute("height").toPixels("y")/svg.opts.scaleHeight:isNaN(viewBox[3])||(yRatio=viewBox[3]/svg.opts.scaleHeight),e.attribute("width",!0).value=svg.opts.scaleWidth,e.attribute("height",!0).value=svg.opts.scaleHeight,e.attribute("viewBox",!0).value="0 0 "+cWidth*xRatio+" "+cHeight*yRatio,e.attribute("preserveAspectRatio",!0).value="none"}1!=svg.opts.ignoreClear&&ctx.clearRect(0,0,cWidth,cHeight),e.render(ctx),isFirstRender&&(isFirstRender=!1,"function"==typeof svg.opts.renderCallback&&svg.opts.renderCallback(dom))},waitingForImages=!0;svg.ImagesLoaded()&&(waitingForImages=!1,draw()),svg.intervalID=setInterval(function(){var needUpdate=!1;if(waitingForImages&&svg.ImagesLoaded()&&(waitingForImages=!1,needUpdate=!0),1!=svg.opts.ignoreMouse&&(needUpdate|=svg.Mouse.hasEvents()),1!=svg.opts.ignoreAnimation)for(var i=0;i<svg.Animations.length;i++)needUpdate|=svg.Animations[i].update(1e3/svg.FRAMERATE);"function"==typeof svg.opts.forceRedraw&&1==svg.opts.forceRedraw()&&(needUpdate=!0),needUpdate&&(draw(),svg.Mouse.runEvents())},1e3/svg.FRAMERATE)},svg.stop=function(){svg.intervalID&&clearInterval(svg.intervalID)},svg.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(x,y){this.events.push({type:"onclick",x:x,y:y,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(x,y){this.events.push({type:"onmousemove",x:x,y:y,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y)&&(this.eventElements[i]=element)}},this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];bb.isPointInBox(e.x,e.y)&&(this.eventElements[i]=element)}},this.runEvents=function(){svg.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++)for(var e=this.events[i],element=this.eventElements[i];element;)e.run(element),element=element.parent;this.events=[],this.eventElements=[]}},svg}this.canvg=function(target,s,opts){if(null!=target||null!=s||null!=opts){opts=opts||{},"string"==typeof target&&(target=document.getElementById(target)),null!=target.svg&&target.svg.stop();var svg=build();1==target.childNodes.length&&"OBJECT"==target.childNodes[0].nodeName||(target.svg=svg),svg.opts=opts;var ctx=target.getContext("2d");void 0!==s.documentElement?svg.loadXmlDoc(ctx,s):"<"==s.substr(0,1)?svg.loadXml(ctx,s):svg.load(ctx,s)}else for(var svgTags=document.getElementsByTagName("svg"),i=0;i<svgTags.length;i++){var svgTag=svgTags[i],c=document.createElement("canvas");c.width=svgTag.clientWidth,c.height=svgTag.clientHeight,svgTag.parentNode.insertBefore(c,svgTag),svgTag.parentNode.removeChild(svgTag);var div=document.createElement("div");div.appendChild(svgTag),canvg(c,div.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh){canvg(this.canvas,s,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh})}),canvg}},_p[1]={value:function(require){function toImage(formula,type,cb){var rectSpace=formula.container.getRenderBox();return getBase64DataURL(formula.node.ownerDocument,{width:rectSpace.width,height:rectSpace.height,content:getSVGContent(formula.node)},type,cb)}function getBase64DataURL(doc,data,type,cb){var canvas=null,args=arguments,ctx=null;if(isChromeCore()){canvas=getImageCanvas(doc,data.width,data.height,type),ctx=canvas.getContext("2d");var image=new Image;image.onload=function(){try{ctx.drawImage(image,0,0),cb(canvas.toDataURL(type))}catch(e){drawToCanvas.apply(null,args)}},image.src=getSVGDataURL(data.content)}else drawToCanvas.apply(null,args)}function getSVGContent(svgNode){var tmp=svgNode.ownerDocument.createElement("div"),start=['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="',svgNode.getAttribute("width"),'" height="',svgNode.getAttribute("height"),'">'];return tmp.appendChild(svgNode.cloneNode(!0)),tmp.innerHTML.replace(/<svg[^>]+?>/i,start.join("")).replace(/&nbsp;/g,"")}function getSVGDataURL(data){return"data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(data)))}function getImageCanvas(doc,width,height,type){var canvas=doc.createElement("canvas"),ctx=canvas.getContext("2d");return canvas.width=width,canvas.height=height,"image/png"!==type&&(ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height)),canvas}function drawToCanvas(doc,data,type,cb){var canvas=getImageCanvas(doc,data.width,data.height,type);canvas.style.cssText="position: absolute; top: 0; left: 100000px; z-index: -1;",doc.body.appendChild(canvas),canvg(canvas,data.content),doc.body.removeChild(canvas),window.setTimeout(function(){cb(canvas.toDataURL(type))},50)}function isChromeCore(){return-1!==window.navigator.userAgent.indexOf("Chrome")}var kity=_p.r(51),canvg=_p.r(0);return kity.createClass("Output",{constructor:function(formula){this.formula=formula},toJPG:function(cb){toImage(this.formula,"image/jpeg",cb)},toPNG:function(cb){toImage(this.formula,"image/png",cb)}})}},_p[2]={value:function(){return["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","&#x237;","&#x131;","&#x3b1;","&#x3b2;","&#x3b3;","&#x3b4;","&#x3b5;","&#x3b6;","&#x3b7;","&#x3b8;","&#x3b9;","&#x3ba;","&#x3bb;","&#x3bc;","&#x3bd;","&#x3be;","&#x3bf;","&#x3c0;","&#x3c1;","&#x3c2;","&#x3c3;","&#x3c4;","&#x3c5;","&#x3c6;","&#x3c7;","&#x3c8;","&#x3c9;","&#x3d1;","&#x3d5;","&#x3d6;","&#x3de;","&#x3dc;","&#x3f5;","&#x3f1;","&#x3f9;","&#x211c;","&#x2135;","&#x2111;","&#x2127;","&#x2136;","&#x2137;","&#x2138;","&#xf0;","&#x210f;","&#x2141;","&#x210e;","&#x2202;","&#x2118;","&#x214c;","&#x2132;","&#x2201;","&#x2113;","&#x24c8;","(",")","&#x393;","&#x394;","&#x395;","&#x396;","&#x397;","&#x398;","&#x399;","&#x39a;","&#x39b;","&#x39c;","&#x39d;","&#x39e;","&#x39f;","&#x3a0;","&#x3a1;","&#x3a3;","&#x3a4;","&#x3a5;","&#x3a6;","&#x3a7;","&#x3a8;","&#x3a9;","&#x391;","&#x392;","#","!","$","%","&#x26;","&#x2220;","&#x2032;","&#x2035;","&#x2605;","&#x25c6;","&#x25a0;","&#x25b2;","&#x25bc;","&#x22a4;","&#x22a5;","&#x2663;","&#x2660;","&#x2662;","&#x2661;","&#x2203;","&#x2204;","&#x266d;","&#x266e;","&#x266f;","&#x2200;","&#x221e;","&#x2221;","&#x2207;","&#xac;","&#x2222;","&#x221a;","&#x25b3;","&#x25bd;","&#x2205;","&#xf8;","&#x25c7;","&#x25c0;","&#x25b8;","[","]","{","}","&#x3008;","&#x3009;","&#x3f0;",",",".","/",":",";","?","\\","&#x22ee;","&#x22ef;","&#x22f0;","&#x2026;","@","&#x22;","'","|","^","`","&#x201c;","_","*","+","-","&#x2210;","&#x22bc;","&#x22bb;","&#x25ef;","&#x22a1;","&#x229f;","&#x229e;","&#x22a0;","&#x2022;","&#x2229;","&#x222a;","&#x22d2;","&#x22d3;","&#x22d0;","&#x22d1;","&#xb7;","&#x25aa;","&#x25e6;","&#x229b;","&#x229a;","&#x2296;","&#x2299;","&#x229d;","&#x2295;","&#x2297;","&#x2298;","&#xb1;","&#x2213;","&#x22cf;","&#x22ce;","&#x2020;","&#x2021;","&#x22c4;","&#xf7;","&#x22c7;","&#x2214;","&#x232d;","&#x22d7;","&#x22d6;","&#x22c9;","&#x22ca;","&#x22cb;","&#x22cc;","&#x2293;","&#x2294;","&#x2291;","&#x2292;","&#x228f;","&#x2290;","&#x22c6;","&#xd7;","&#x22b3;","&#x22b2;","&#x22b5;","&#x22b4;","&#x228e;","&#x2228;","&#x2227;","&#x2240;","&#x3c;","=","&#x3e;","&#x2248;","&#x2247;","&#x224d;","&#x2252;","&#x2253;","&#x224a;","&#x223d;","&#x2241;","&#x2242;","&#x2243;","&#x22cd;","&#x224f;","&#x224e;","&#x2257;","&#x2245;","&#x22de;","&#x22df;","&#x2250;","&#x2251;","&#x2256;","&#x2a96;","&#x2a95;","&#x2261;","&#x2265;","&#x2264;","&#x2266;","&#x2267;","&#x2a7e;","&#x2a7d;","&#x226b;","&#x226a;","&#x2268;","&#x2269;","&#x22d8;","&#x22d9;","&#x2a87;","&#x2a88;","&#x2a89;","&#x2a8a;","&#x22e7;","&#x22e6;","&#x2a86;","&#x2a85;","&#x22db;","&#x22da;","&#x2a8b;","&#x2a8c;","&#x2277;","&#x2276;","&#x2273;","&#x2272;","&#x232e;","&#x232f;","&#x226f;","&#x2271;","&#x2270;","&#x226e;","&#x2331;","&#x2330;","&#x2332;","&#x2333;","&#x226c;","&#x2280;","&#x2281;","&#x22e0;","&#x22e1;","&#x227a;","&#x227b;","&#x227c;","&#x227d;","&#x227e;","&#x227f;","&#x2282;","&#x2283;","&#x2288;","&#x2289;","&#x2286;","&#x2287;","&#x228a;","&#x228b;","&#x2ab7;","&#x2ab8;","&#x2aaf;","&#x2ab0;","&#x2ab9;","&#x2aba;","&#x2ab5;","&#x2ab6;","&#x22e8;","&#x22e9;","&#x223c;","&#x225c;","&#x21b6;","&#x21b7;","&#x21ba;","&#x21bb;","&#x21be;","&#x21bf;","&#x21c2;","&#x21c3;","&#x21c4;","&#x21c6;","&#x21c8;","&#x21ca;","&#x21cb;","&#x21cc;","&#x21cd;","&#x21ce;","&#x21cf;","&#x21d0;","&#x21d1;","&#x21d2;","&#x21d3;","&#x21d4;","&#x21d5;","&#x21da;","&#x21db;","&#x21dd;","&#x21ab;","&#x21ac;","&#x21ad;","&#x21ae;","&#x2190;","&#x2191;","&#x2192;","&#x2193;","&#x2194;","&#x2195;","&#x2196;","&#x2197;","&#x2198;","&#x2199;","&#x219e;","&#x21a0;","&#x21a2;","&#x21a3;","&#x21b0;","&#x21b1;","&#x22a2;","&#x22a3;","&#x22a8;","&#x22a9;","&#x22aa;","&#x22ad;","&#x22af;","&#x22b8;","&#x22ba;","&#x22d4;","&#x22ea;","&#x22eb;","&#x22ec;","&#x22ed;","&#x2308;","&#x2309;","&#x230a;","&#x230b;","&#x2acb;","&#x2acc;","&#x2ac5;","&#x2ac6;","&#x2208;","&#x220b;","&#x221d;","&#x2224;","&#x2226;","&#x2234;","&#x2235;","&#x220d;","&#x22c8;","&#x2322;","&#x2323;","&#x2223;","&#x2225;","&#x23d0;","&#x23d1;","&#x23d2;","&#x23d3;","&#x2ac7;","&#x2ac8;","&#x22ae;","&#x22ac;","&#x2ac9;","&#x23d4;","&#x23d5;","&#x23d6;","&#x23d7;","&#x21c7;","&#x21c9;","&#x21bc;","&#x21bd;","&#x21c0;","&#x21c1;","&#x219a;","&#x219b;","&#x27f5;","&#x27f6;","&#x27f7;","&#x27f9;","&#x27f8;","&#x27fa;","&#x2262;","&#x2260;","&#x2209;"]}},_p[3]={value:function(){return{defaultFont:"KF AMS MAIN"}}},_p[4]={value:function(require){function createText(content){var text=new kity.Text;return"innerHTML"in text.node?text.node.setAttributeNS(NAMESPACE,"xml:space","preserve"):-1!=content.indexOf(" ")&&(content=convertContent(content)),text.setContent(content),text}function convertContent(content){return divNode.innerHTML='<svg><text gg="asfdas">'+content.replace(/\s/gi,"&nbsp;")+"</text></svg>",divNode.firstChild.firstChild.textContent}var kity=_p.r(51),divNode=document.createElement("div"),NAMESPACE="http://www.w3.org/XML/1998/namespace";return{create:function(content){return createText(content)}}}},_p[5]={value:function(require){var kity=_p.r(51),FONT_CONF=_p.r(78).font,FontManager=_p.r(42),TextFactory=_p.r(4);return kity.createClass("Text",{base:_p.r(77),constructor:function(content,fontFamily){this.callBase(),this.fontFamily=fontFamily,this.fontSize=50,this.content=content||"",this.box.remove(),this.translationContent=this.translation(this.content),this.contentShape=new kity.Group,this.contentNode=this.createContent(),this.contentShape.addShape(this.contentNode),this.addShape(this.contentShape)},createContent:function(){var contentNode=TextFactory.create(this.translationContent);return contentNode.setAttr({"font-family":this.fontFamily,"font-size":50,x:0,y:FONT_CONF.offset}),contentNode},setFamily:function(fontFamily){this.fontFamily=fontFamily,this.contentNode.setAttr("font-family",fontFamily)},setFontSize:function(fontSize){this.fontSize=fontSize,this.contentNode.setAttr("font-size",fontSize+"px"),this.contentNode.setAttr("y",fontSize/50*FONT_CONF.offset)},getBaseHeight:function(){for(var chars=this.contentShape.getItems(),currentChar=null,index=0,height=0;currentChar=chars[index];)height=Math.max(height,currentChar.getHeight()),index++;return height},translation:function(content){var fontFamily=this.fontFamily;return content.replace(/``/g,"“").replace(/\\([a-zA-Z,]+)\\/g,function(match,input){if(","===input)return" ";var data=FontManager.getCharacterValue(input,fontFamily);return data||(console.error("missing code: "+input),"")})}})}},_p[6]={value:function(){return{UNKNOWN:-1,EXP:0,COMPOUND_EXP:1,OP:2}}},_p[7]={value:function(){return{SIDE:"side",FOLLOW:"follow"}}},_p[8]={value:function(require){return _p.r(51).createClass("SubscriptExpression",{base:_p.r(17),constructor:function(operand,subscript){this.callBase(operand,null,subscript),this.setFlag("Subscript")}})}},_p[9]={value:function(require){return _p.r(51).createClass("SuperscriptExpression",{base:_p.r(17),constructor:function(operand,superscript){this.callBase(operand,superscript,null),this.setFlag("Superscript")}})}},_p[10]={value:function(require){return _p.r(51).createClass("BinaryExpression",{base:_p.r(19),constructor:function(firstOperand,lastOperand){this.callBase(),this.setFirstOperand(firstOperand),this.setLastOperand(lastOperand)},setFirstOperand:function(operand){return this.setOperand(operand,0)},getFirstOperand:function(){return this.getOperand(0)},setLastOperand:function(operand){return this.setOperand(operand,1)},getLastOperand:function(){return this.getOperand(1)}})}},_p[11]={value:function(require){var kity=_p.r(51),NDBracketsOperator=_p.r(59);return kity.createClass("BracketsExpression",{base:_p.r(19),constructor:function(left,right,exp){this.callBase(),this.setFlag("Brackets"),2===arguments.length&&(exp=right,right=left),this.leftSymbol=left,this.rightSymbol=right,this.setOperator(new NDBracketsOperator),this.setOperand(exp,0)},getLeftSymbol:function(){return this.leftSymbol},getRightSymbol:function(){return this.rightSymbol}})}},_p[12]={value:function(require){var kity=_p.r(51),FONT_CONF=_p.r(78).font,CombinationOperator=_p.r(53);return kity.createClass("CombinationExpression",{base:_p.r(19),constructor:function(){this.callBase(),this.setFlag("Combination"),this.setOperator(new CombinationOperator),kity.Utils.each(arguments,function(operand,index){this.setOperand(operand,index)},this)},getRenderBox:function(refer){var rectBox=this.callBase(refer);return 0===this.getOperands().length&&(rectBox.height=FONT_CONF.spaceHeight),rectBox},getBaseline:function(refer){var maxBaseline=0,operands=this.getOperands();return 0===operands.length?this.callBase(refer):(kity.Utils.each(operands,function(operand){maxBaseline=Math.max(operand.getBaseline(refer),maxBaseline)}),maxBaseline)},getMeanline:function(refer){var minMeanline=1e7,operands=this.getOperands();return 0===operands.length?this.callBase(refer):(kity.Utils.each(operands,function(operand){minMeanline=Math.min(operand.getMeanline(refer),minMeanline)}),minMeanline)}})}},_p[13]={value:function(require){var kity=_p.r(51),CombinationExpression=_p.r(12),FractionOperator=_p.r(69);return kity.createClass("FractionExpression",{base:_p.r(10),constructor:function(upOperand,downOperand){downOperand instanceof CombinationExpression&&0===downOperand.operands.length&&(downOperand=""),this.callBase(upOperand,downOperand),this.setFlag("Fraction"),this.setOperator(new FractionOperator)},getBaseline:function(refer){var downOperand=this.getOperand(1),rectBox=downOperand.getRenderBox(refer);return rectBox.y+downOperand.getBaselineProportion()*rectBox.height},getMeanline:function(refer){var upOperand=this.getOperand(0),rectBox=upOperand.getRenderBox(refer);return upOperand.getMeanlineProportion()*rectBox.height}})}},_p[14]={value:function(require){var kity=_p.r(51),FUNC_CONF=_p.r(78).func,FunctionOperator=_p.r(70);return kity.createClass("FunctionExpression",{base:_p.r(19),constructor:function(funcName,expr,sup,sub){this.callBase(),this.setFlag("Func"),this.funcName=funcName,this.setOperator(new FunctionOperator(funcName)),this.setExpr(expr),this.setSuperscript(sup),this.setSubscript(sub)},isSideScript:function(){return!FUNC_CONF["ud-script"][this.funcName]},setExpr:function(expr){return this.setOperand(expr,0)},setSuperscript:function(sub){return this.setOperand(sub,1)},setSubscript:function(sub){return this.setOperand(sub,2)}})}},_p[15]={value:function(require){var kity=_p.r(51),IntegrationOperator=_p.r(71);return kity.createClass("IntegrationExpression",{base:_p.r(19),constructor:function(integrand,superscript,subscript){this.callBase(),this.setFlag("Integration"),this.setOperator(new IntegrationOperator),this.setIntegrand(integrand),this.setSuperscript(superscript),this.setSubscript(subscript)},setType:function(type){return this.getOperator().setType(type),this},resetType:function(){return this.getOperator().resetType(),this},setIntegrand:function(integrand){this.setOperand(integrand,0)},setSuperscript:function(sup){this.setOperand(sup,1)},setSubscript:function(sub){this.setOperand(sub,2)}})}},_p[16]={value:function(require){var kity=_p.r(51),RadicalOperator=_p.r(73);return kity.createClass("RadicalExpression",{base:_p.r(10),constructor:function(radicand,exponent){this.callBase(radicand,exponent),this.setFlag("Radicand"),this.setOperator(new RadicalOperator)},setRadicand:function(operand){return this.setFirstOperand(operand)},getRadicand:function(){return this.getFirstOperand()},setExponent:function(operand){return this.setLastOperand(operand)},getExponent:function(){return this.getLastOperand()}})}},_p[17]={value:function(require){var kity=_p.r(51),ScriptOperator=_p.r(74),CompoundExpression=_p.r(19),MathopExpression=_p.r(38);return kity.createClass("ScriptExpression",{base:_p.r(19),SCRIPT_MODE_UP_DOWN:"UP_DOWN",SCRIPT_MODE_SIDE:"SIDE",constructor:function(operand,superscript,subscript){this.callBase(),this.setFlag("Script"),this.setOperator(new ScriptOperator),this.setOpd(operand),this.setSuperscript(superscript),this.setSubscript(subscript)},getOpd:function(){return this.getOperand(0)},setOpd:function(operand){this.setOperand(operand,0)},setSuperscript:function(sup){this.setOperand(this.fixScript(sup),1)},setSubscript:function(sub){this.setOperand(this.fixScript(sub),2)},fixScript:function(script){return script instanceof CompoundExpression&&0===script.getOperands().length&&script.setOperand(" ",0),script},isScriptMode:function(mode){return this.getAttr("data-script-mode")===mode||mode===this.SCRIPT_MODE_UP_DOWN&&MathopExpression.wrappedByMathop(this.getOpd())},notContainsAdditionalSpace:function(){return this.getAttr("data-not-contains-additional-space")}})}},_p[18]={value:function(require){var kity=_p.r(51),SummationOperator=_p.r(75);return kity.createClass("SummationExpression",{base:_p.r(19),constructor:function(expr,superscript,subscript){this.callBase(),this.setFlag("Summation"),this.setOperator(new SummationOperator),this.setExpr(expr),this.setSuperscript(superscript),this.setSubscript(subscript)},setExpr:function(expr){this.setOperand(expr,0)},setSuperscript:function(sup){this.setOperand(sup,1)},setSubscript:function(sub){this.setOperand(sub,2)}})}},_p[19]={value:function(require){var kity=_p.r(51),GTYPE=_p.r(6),Expression=_p.r(21);return kity.createClass("CompoundExpression",{base:_p.r(21),constructor:function(){this.callBase(),this.type=GTYPE.COMPOUND_EXP,this.operands=[],this.operator=null,this.operatorBox=new kity.Group,this.operatorBox.setAttr("data-type","kf-editor-exp-op-box"),this.operandBox=new kity.Group,this.operandBox.setAttr("data-type","kf-editor-exp-operand-box"),this.setChildren(0,this.operatorBox),this.setChildren(1,this.operandBox)},setOperator:function(operator){return void 0===operator?this:(this.operator&&this.operator.remove(),this.operatorBox.addShape(operator),this.operator=operator,this.operator.setParentExpression(this),operator.expression=this,this)},getOperator:function(){return this.operator},setOperand:function(operand,index,isWrap){return!1===isWrap?(this.operands[index]=operand,this):(operand=Expression.wrap(operand),this.operands[index]&&this.operands[index].remove(),this.operands[index]=operand,this.operandBox.addShape(operand),this)},getOperand:function(index){return this.operands[index]},getOperands:function(){return this.operands},addedCall:function(){return this.operator.applyOperand.apply(this.operator,this.operands),this}})}},_p[20]={value:function(require){var kity=_p.r(51),FONT_CONF=_p.r(78).font,Expression=_p.r(21),EmptyExpression=kity.createClass("EmptyExpression",{base:Expression,constructor:function(){this.callBase(),this.setFlag("Empty")},getRenderBox:function(){return{width:0,height:FONT_CONF.spaceHeight,x:0,y:0}}});return EmptyExpression.isEmpty=function(target){return target instanceof EmptyExpression},Expression.registerWrap("empty",function(operand){if(null===operand||void 0===operand)return new EmptyExpression}),EmptyExpression}},_p[21]={value:function(require){var kity=_p.r(51),GTYPE=_p.r(6),FONT_CONF=_p.r(78).font,WRAP_FN=[],WRAP_FN_INDEX={},Expression=kity.createClass("Expression",{base:_p.r(77),constructor:function(){this.callBase(),this.type=GTYPE.EXP,this._offset={top:0,bottom:0},this.children=[],this.box.fill("transparent").setAttr("data-type","kf-editor-exp-box"),this.box.setAttr("data-type","kf-editor-exp-bg-box"),this.expContent=new kity.Group,this.expContent.setAttr("data-type","kf-editor-exp-content-box"),this.addShape(this.expContent)},getChildren:function(){return this.children},getChild:function(index){return this.children[index]||null},getTopOffset:function(){return this._offset.top},getBottomOffset:function(){return this._offset.bottom},getOffset:function(){return this._offset},setTopOffset:function(val){this._offset.top=val},setBottomOffset:function(val){this._offset.bottom=val},setOffset:function(top,bottom){this._offset.top=top,this._offset.bottom=bottom},setFlag:function(flag){this.setAttr("data-flag",flag||"Expression")},setChildren:function(index,exp){this.children[index]&&this.children[index].remove(),this.children[index]=exp,this.expContent.addShape(exp)},getBaselineProportion:function(){return FONT_CONF.baselinePosition},getMeanlineProportion:function(){return FONT_CONF.meanlinePosition},getBaseline:function(refer){return this.getRenderBox(refer).height*FONT_CONF.baselinePosition-3},
getMeanline:function(refer){return this.getRenderBox(refer).height*FONT_CONF.meanlinePosition-1},getAscenderline:function(){return this.getFixRenderBox().height*FONT_CONF.ascenderPosition},getDescenderline:function(){return this.getFixRenderBox().height*FONT_CONF.descenderPosition},translateElement:function(x,y){this.expContent.translate(x,y)},expand:function(width,height){var renderBox=this.getFixRenderBox();this.setBoxSize(renderBox.width+width,renderBox.height+height)},getBaseWidth:function(){return this.getWidth()},getBaseHeight:function(){return this.getHeight()},updateBoxSize:function(){var renderBox=this.expContent.getFixRenderBox();this.setBoxSize(renderBox.width,renderBox.height)},getBox:function(){return this.box}});return kity.Utils.extend(Expression,{registerWrap:function(name,fn){WRAP_FN_INDEX[name]=WRAP_FN.length,WRAP_FN.push(fn)},revokeWrap:function(name){var fn=null;return name in WRAP_FN_INDEX&&(fn=WRAP_FN[WRAP_FN_INDEX[name]],WRAP_FN[WRAP_FN_INDEX[name]]=null,delete WRAP_FN_INDEX[name]),fn},wrap:function(operand){var result;return kity.Utils.each(WRAP_FN,function(fn){if(fn)return!(result=fn(operand))&&void 0}),result}}),Expression}},_p[22]={value:function(require,exports,modules){var kity=_p.r(51),ArrayOperator=_p.r(55);return kity.createClass("ArrayExpression",{base:_p.r(19),constructor:function(){this.callBase(),this.buildOperands(arguments),this.setOperator(new ArrayOperator)},buildOperands:function(operands){kity.Utils.each(operands,function(operand,index){this.setOperand(operand,index)},this)},getTableLocation:function(){return this.getAttr("data-table-location")},getColClass:function(){return this.getAttr("data-col-class")}})}},_p[23]={value:function(require){var kity=_p.r(51),OneArgumentOperator=_p.r(61);return kity.createClass("BarExpression",{base:_p.r(10),constructor:function(exponent){this.callBase(exponent),this.setOperator(new OneArgumentOperator("bar"))}})}},_p[24]={value:function(require){var kity=_p.r(51),CancelOperator=_p.r(56);return kity.createClass("CancelExpression",{base:_p.r(10),constructor:function(exponent){this.callBase(exponent),this.setOperator(new CancelOperator)}})}},_p[25]={value:function(require,exports,modules){var kity=_p.r(51),EquationsOperator=_p.r(57);return kity.createClass("EquationsExpression",{base:_p.r(19),constructor:function(){this.callBase(),this.buildOperands(arguments),this.setOperator(new EquationsOperator)},buildOperands:function(operands){kity.Utils.each(operands,function(operand,index){this.setOperand(operand,index)},this)},getEquationsType:function(){return this.getAttr("data-equations-type")}})}},_p[26]={value:function(require){var kity=_p.r(51),OneArgumentOperator=_p.r(61);return kity.createClass("HatExpression",{base:_p.r(10),constructor:function(exponent){this.callBase(exponent),this.setOperator(new OneArgumentOperator("hat"))}})}},_p[27]={value:function(require){var kity=_p.r(51),MatrixOperator=_p.r(58);return kity.createClass("MatrixExpression",{base:_p.r(19),constructor:function(){this.callBase(),this.buildOperands(arguments),this.setOperator(new MatrixOperator)},buildOperands:function(operands){kity.Utils.each(operands,function(operand,index){this.setOperand(operand,index)},this)},getMatrixType:function(){return this.getAttr("data-matrix-type")}})}},_p[28]={value:function(require){var kity=_p.r(51),OverUnderLineOperator=_p.r(62);return kity.createClass("OverUnderLineExpression",{base:_p.r(19),constructor:function(operand){this.callBase(),this.setFlag("OverUnderLine"),this.setOperator(new OverUnderLineOperator),this.setOperand(operand,0)},isOver:function(){return"over"===this.getAttr("data-line-type")}})}},_p[29]={value:function(require){var kity=_p.r(51),XArrowOperator=_p.r(63);return kity.createClass("OverrightarrowExpression",{base:_p.r(10),constructor:function(expr){this.callBase(expr),this.setOperator(new XArrowOperator)}})}},_p[30]={value:function(require){return function(name){var kity=_p.r(51),ProductOperator=_p.r(64),className=name+"Expression";return kity.createClass(className,{base:_p.r(19),constructor:function(expr,superscript,subscript){this.callBase(),this.setFlag(name),this.setOperator(new ProductOperator(name)),this.setExpr(expr),this.setSuperscript(superscript),this.setSubscript(subscript)},setExpr:function(expr){this.setOperand(expr,0)},setSuperscript:function(sup){this.setOperand(sup,1)},setSubscript:function(sub){this.setOperand(sub,2)}})}}},_p[31]={value:function(require){var kity=_p.r(51),XArrowOperator=_p.r(65);return kity.createClass("UnderrightarrowExpression",{base:_p.r(10),constructor:function(expr){this.callBase(expr),this.setOperator(new XArrowOperator)}})}},_p[32]={value:function(require){var kity=_p.r(51),OneArgumentOperator=_p.r(61);return kity.createClass("VecExpression",{base:_p.r(10),constructor:function(exponent){this.callBase(exponent),this.setOperator(new OneArgumentOperator("vector"))}})}},_p[33]={value:function(require){var kity=_p.r(51),OneArgumentOperator=_p.r(61);return kity.createClass("WidehatExpression",{base:_p.r(10),constructor:function(exponent){this.callBase(exponent),this.setOperator(new OneArgumentOperator("widehat"))}})}},_p[34]={value:function(require){var kity=_p.r(51),XArrowOperator=_p.r(66);return kity.createClass("XArrowExpression",{base:_p.r(19),constructor:function(upOperand,downOperand){this.callBase(),this.setFlag("XArrow"),this.setOperator(new XArrowOperator),this.setOperand(upOperand,0),this.setOperand(downOperand,1)},getArrowType:function(){return this.getAttr("data-arrow-type")}})}},_p[35]={value:function(require){var kity=_p.r(51),XLongEqualOperator=_p.r(67);return kity.createClass("XLongEqualExpression",{base:_p.r(19),constructor:function(upOperand,downOperand){this.callBase(),this.setFlag("XLongEqual"),this.setOperator(new XLongEqualOperator),this.setOperand(upOperand,0),this.setOperand(downOperand,1)}})}},_p[36]={value:function(require){var kity=_p.r(51),XArrowOperator=_p.r(66);return kity.createClass("XRightarrowExpression",{base:_p.r(19),constructor:function(upOperand,downOperand){this.callBase(),this.setFlag("XArrow"),this.setOperator(new XArrowOperator("xrightarrow")),this.setOperand(upOperand,0),this.setOperand(downOperand,1)},getArrowType:function(){return this.getAttr("data-arrow-type")}})}},_p[37]={value:function(require){var kity=_p.r(51),XrightleftharpoonsOperator=_p.r(68);return kity.createClass("XrightleftharpoonsEqualExpression",{base:_p.r(19),constructor:function(upOperand,downOperand){this.callBase(),this.setFlag("XrightleftharpoonsOperator"),this.setOperator(new XrightleftharpoonsOperator),this.setOperand(upOperand,0),this.setOperand(downOperand,1)}})}},_p[38]={value:function(require){var kity=_p.r(51),Expression=_p.r(21),MathopExpression=kity.createClass("MathopExpression",{base:_p.r(21),constructor:function(content){this.callBase(),this.setFlag("Mathop"),this.setChildren(0,Expression.wrap(content))},getContent:function(){return this.getChild(0)}});return MathopExpression.wrappedByMathop=function(target){return target instanceof MathopExpression},MathopExpression}},_p[39]={value:function(require){var Text=_p.r(5),kity=_p.r(51),FONT_CONF=_p.r(3),Expression=_p.r(21),TextExpression=kity.createClass("TextExpression",{base:_p.r(21),constructor:function(content,fontFamily){this.callBase(),this.fontFamily=fontFamily||FONT_CONF.defaultFont,this.setFlag("Text"),this.content=content+"",this.textContent=new Text(this.content,this.fontFamily),this.setChildren(0,this.textContent),this.setChildren(1,new kity.Rect(0,0,0,0).fill("transparent"))},setFamily:function(fontFamily){this.textContent.setFamily(fontFamily)},setFontSize:function(fontSize){this.textContent.setFontSize(fontSize)},addedCall:function(){var box=this.textContent.getFixRenderBox();return this.getChild(1).setSize(box.width,box.height),this.updateBoxSize(),this}});return Expression.registerWrap("text",function(operand){var operandType=typeof operand;return"number"!==operandType&&"string"!==operandType||(operand=new TextExpression(operand)),operand}),TextExpression}},_p[40]={value:function(){return['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<text id="abcd" font-family="KF AMS MAIN" font-size="50" x="0" y="0">x</text>',"</svg>"]}},_p[41]={value:function(require){function preload(doc,fontInfo,callback){$.get(fontInfo.meta.src,function(data,state){"success"===state&&applyFonts(doc,fontInfo),callback()})}function complete(doc,callback){window.setTimeout(function(){initFontSystemInfo(doc),removeTmpNode(),callback()},100)}function applyFonts(doc,fontInfo){var node=document.createElement("div"),fontFamily=fontInfo.meta.fontFamily;node.style.cssText="position: absolute; top: -10000px; left: -100000px;",node.style.fontFamily=fontFamily,node.innerHTML=CHAR_LIST.join(""),doc.body.appendChild(node),NODE_LIST.push(node)}function initFontSystemInfo(doc){var tmpNode=doc.createElement("div");tmpNode.style.cssText="position: absolute; top: 0; left: -100000px;",tmpNode.innerHTML=_p.r(40).join(""),doc.body.appendChild(tmpNode);var rectBox=tmpNode.getElementsByTagName("text")[0].getBBox();FONT_CONF.spaceHeight=rectBox.height,FONT_CONF.topSpace=-rectBox.y-FONT_CONF.baseline,FONT_CONF.bottomSpace=FONT_CONF.spaceHeight-FONT_CONF.topSpace-FONT_CONF.baseHeight,FONT_CONF.offset=FONT_CONF.baseline+FONT_CONF.topSpace,FONT_CONF.baselinePosition=(FONT_CONF.topSpace+FONT_CONF.baseline)/FONT_CONF.spaceHeight,FONT_CONF.meanlinePosition=(FONT_CONF.topSpace+FONT_CONF.meanline)/FONT_CONF.spaceHeight,FONT_CONF.ascenderPosition=FONT_CONF.topSpace/FONT_CONF.spaceHeight,FONT_CONF.descenderPosition=(FONT_CONF.topSpace+FONT_CONF.baseHeight)/FONT_CONF.spaceHeight,doc.body.removeChild(tmpNode)}function removeTmpNode(){kity.Utils.each(NODE_LIST,function(node){node.parentNode.removeChild(node)}),NODE_LIST=[]}var kity=_p.r(51),FontManager=_p.r(42),$=_p.r(50),FONT_CONF=_p.r(78).font,CHAR_LIST=_p.r(2),NODE_LIST=[];return kity.createClass("FontInstaller",{constructor:function(doc,resource){this.callBase(),this.resource=resource||"../src/resource/",this.doc=doc},mount:function(callback){var fontList=FontManager.getFontList(),count=0,_self=this;kity.Utils.each(fontList,function(fontInfo){count++,fontInfo.meta.src=_self.resource+fontInfo.meta.src,_self.createFontStyle(fontInfo),preload(_self.doc,fontInfo,function(){0===--count&&complete(_self.doc,callback)})})},createFontStyle:function(fontInfo){var stylesheet=this.doc.createElement("style");stylesheet.setAttribute("type","text/css"),stylesheet.innerHTML='@font-face{\nfont-family: "${fontFamily}";\nsrc: url("${src}");\n}'.replace("${fontFamily}",fontInfo.meta.fontFamily).replace("${src}",fontInfo.meta.src),this.doc.head.appendChild(stylesheet)}})}},_p[42]={value:function(require){var FONT_LIST={},kity=_p.r(51),CONF=_p.r(78).font.list;return function(){kity.Utils.each(CONF,function(fontData){FONT_LIST[fontData.meta.fontFamily]=fontData})}(),{getFontList:function(){return FONT_LIST},getCharacterValue:function(key,fontFamily){return FONT_LIST[fontFamily]?FONT_LIST[fontFamily].map[key]||null:null}}}},_p[43]={value:function(){return{meta:{fontFamily:"KF AMS BB",src:"KF_AMS_BB.woff"}}}},_p[44]={value:function(){return{meta:{fontFamily:"KF AMS CAL",src:"KF_AMS_CAL.woff"}}}},_p[45]={value:function(){return{meta:{fontFamily:"KF AMS FRAK",src:"KF_AMS_FRAK.woff"}}}},_p[46]={value:function(){return{meta:{fontFamily:"KF AMS MAIN",src:"KF_AMS_MAIN.woff"},map:{Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",varkappa:"ϰ",chi:"χ",psi:"ψ",omega:"ω",digamma:"Ϝ",varepsilon:"ϵ",varrho:"ϱ",varphi:"ϕ",vartheta:"ϑ",varpi:"ϖ",varsigma:"Ϲ",aleph:"ℵ",beth:"ℶ",daleth:"ℸ",gimel:"ℷ",eth:"ð",hbar:"ℎ",hslash:"ℏ",mho:"℧",partial:"∂",wp:"℘",Game:"⅁",Bbbk:"⅌",Finv:"Ⅎ",Im:"ℑ",Re:"ℜ",complement:"∁",ell:"ℓ",circledS:"Ⓢ",imath:"ı",jmath:"ȷ",doublecap:"⋒",Cap:"⋒",doublecup:"⋓",Cup:"⋓",ast:"*",divideontimes:"⋇",rightthreetimes:"⋌",leftthreetimes:"⋋",cdot:"·",odot:"⊙",dotplus:"∔",rtimes:"⋊",ltimes:"⋉",centerdot:"▪",doublebarwedge:"⌭",setminus:"⒁",amalg:"∐",circ:"◦",bigcirc:"◯",gtrdot:"⋗",lessdot:"⋖",smallsetminus:"⒅",circledast:"⊛",circledcirc:"⊚",sqcap:"⊓",sqcup:"⊔",barwedge:"⊼",circleddash:"⊝",star:"⋆",bigtriangledown:"▽",bigtriangleup:"△",cup:"∪",cap:"∩",times:"×",mp:"∓",pm:"±",triangleleft:"⊲",triangleright:"⊳",boxdot:"⊡",curlyvee:"⋏",curlywedge:"⋎",boxminus:"⊟",boxtimes:"⊠",ominus:"⊖",oplus:"⊕",oslash:"⊘",otimes:"⊗",uplus:"⊎",boxplus:"⊞",dagger:"†",ddagger:"‡",vee:"∨",lor:"∨",veebar:"⊻",bullet:"•",diamond:"⋄",wedge:"∧",land:"∧",div:"÷",wr:"≀",geqq:"≧",lll:"⋘",llless:"⋘",ggg:"⋙",gggtr:"⋙",preccurlyeq:"≼",geqslant:"⩾",lnapprox:"⪉",preceq:"⪯",gg:"≫",lneq:"⪇",precnapprox:"⪹",approx:"≈",lneqq:"≨",precneqq:"⪵",approxeq:"≊",gnapprox:"⪊",lnsim:"⋦",precnsim:"⋨",asymp:"≍",gneq:"⪈",lvertneqq:"⌮",precsim:"≾",backsim:"∽",gneqq:"≩",ncong:"≇",risingdotseq:"≓",backsimeq:"⋍",gnsim:"⋧",sim:"∼",simeq:"≃",bumpeq:"≏",gtrapprox:"⪆",ngeq:"≱",Bumpeq:"≎",gtreqless:"⋛",ngeqq:"⌱",succ:"≻",circeq:"≗",gtreqqless:"⪌",ngeqslant:"⌳",succapprox:"⪸",cong:"≅",gtrless:"≷",ngtr:"≯",succcurlyeq:"≽",curlyeqprec:"⋞",gtrsim:"≳",nleq:"≰",succeq:"⪰",curlyeqsucc:"⋟",gvertneqq:"⌯",neq:"≠",ne:"≠",nequiv:"≢",nleqq:"⌰",succnapprox:"⪺",doteq:"≐",leq:"≤",le:"≤",nleqslant:"⌲",succneqq:"⪶",doteqdot:"≑",Doteq:"≑",leqq:"≦",nless:"≮",succnsim:"⋩",leqslant:"⩽",nprec:"⊀",succsim:"≿",eqsim:"≂",lessapprox:"⪅",npreceq:"⋠",eqslantgtr:"⪖",lesseqgtr:"⋚",nsim:"≁",eqslantless:"⪕",lesseqqgtr:"⪋",nsucc:"⊁",triangleq:"≜",eqcirc:"≖",equiv:"≡",lessgtr:"≶",nsucceq:"⋡",fallingdotseq:"≒",lesssim:"≲",prec:"≺",geq:"≥",ge:"≥",ll:"≪",precapprox:"⪷",uparrow:"↑",downarrow:"↓",updownarrow:"↕",Uparrow:"⇑",Downarrow:"⇓",Updownarrow:"⇕",circlearrowleft:"↺",circlearrowright:"↻",curvearrowleft:"↶",curvearrowright:"↷",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",leftarrow:"←",gets:"←",Leftarrow:"⇐",leftarrowtail:"↢",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇄",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",Lleftarrow:"⇚",looparrowleft:"↫",looparrowright:"↬",multimap:"⊸",nLeftarrow:"⇍",nRightarrow:"⇏",nLeftrightarrow:"⇎",nearrow:"↗",nleftarrow:"↚",nleftrightarrow:"↮",nrightarrow:"↛",nwarrow:"↖",rightarrow:"→",to:"→",Rightarrow:"⇒",rightarrowtail:"↣",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇆",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"⇝",Rrightarrow:"⇛",searrow:"↘",swarrow:"↙",twoheadleftarrow:"↞",twoheadrightarrow:"↠",upharpoonleft:"↿",upharpoonright:"↾",restriction:"↾",upuparrows:"⇈",Lsh:"↰",Rsh:"↱",longleftarrow:"⟵",longrightarrow:"⟶",Longleftarrow:"⟸",Longrightarrow:"⟹",implies:"⟹",longleftrightarrow:"⟷",Longleftrightarrow:"⟺",backepsilon:"∍",because:"∵",therefore:"∴",between:"≬",blacktriangleleft:"◀",blacktriangleright:"▸",dashv:"⊣",bowtie:"⋈",frown:"⌢",in:"∈",notin:"∉",mid:"∣",parallel:"∥",models:"⊨",ni:"∋",owns:"∋",nmid:"∤",nparallel:"∦",nshortmid:"⏒",nshortparallel:"⏓",nsubseteq:"⊈",nsubseteqq:"⫇",nsupseteq:"⊉",nsupseteqq:"⫈",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",nvdash:"⊬",nVdash:"⊮",nvDash:"⊭",nVDash:"⊯",perp:"⊥",pitchfork:"⋔",propto:"∝",shortmid:"⏐",shortparallel:"⏑",smile:"⌣",sqsubset:"⊏",sqsubseteq:"⊑",sqsupset:"⊐",sqsupseteq:"⊒",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",subsetneq:"⊊",subsetneqq:"⫋",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",trianglelefteq:"⊴",trianglerighteq:"⊵",varpropto:"⫉",varsubsetneq:"⏔",varsubsetneqq:"⏖",varsupsetneq:"⏕",varsupsetneqq:"⏗",vdash:"⊢",Vdash:"⊩",vDash:"⊨",Vvdash:"⊪",vert:"|",Vert:"ǁ","|":"ǁ","{":"{","}":"}",backslash:"\\",langle:"〈",rangle:"〉",lceil:"⌈",rceil:"⌉",lbrace:"{",rbrace:"}",lfloor:"⌊",rfloor:"⌋",cdots:"⋯",ddots:"⋰",vdots:"⋮",dots:"…",ldots:"…","#":"#",bot:"⊥",angle:"∠",backprime:"‵",bigstar:"★",blacklozenge:"◆",blacksquare:"■",blacktriangle:"▲",blacktriangledown:"▼",clubsuit:"♣",diagdown:"⒁",diagup:"⒂",diamondsuit:"♢",emptyset:"ø",exists:"∃",flat:"♭",forall:"∀",heartsuit:"♡",infty:"∞",lozenge:"◇",measuredangle:"∡",nabla:"∇",natural:"♮",neg:"¬",lnot:"¬",nexists:"∄",prime:"′",sharp:"♯",spadesuit:"♠",sphericalangle:"∢",surd:"√",top:"⊤",varnothing:"∅",triangle:"△",triangledown:"▽",square:"▫",vartriangle:"▵"}}}},_p[47]={value:function(){return{meta:{fontFamily:"KF AMS ROMAN",src:"KF_AMS_ROMAN.woff"}}}},_p[48]={value:function(require){function correctOffset(){var exprOffset=0;return kity.Utils.each(this.expressions,function(expr){var box=null;expr&&(expr.setMatrix(new kity.Matrix(1,0,0,1,0,0)),box=expr.getFixRenderBox(),expr.translate(0-box.x,exprOffset),exprOffset+=box.height+EXPRESSION_INTERVAL)}),this}function notifyExpression(expression){var len=0;if(expression){if(expression.getType()===GTYPE.EXP)for(var i=0,len=expression.getChildren().length;i<len;i++)notifyExpression(expression.getChild(i));else if(expression.getType()===GTYPE.COMPOUND_EXP){for(var i=0,len=expression.getOperands().length;i<len;i++)notifyExpression(expression.getOperand(i));notifyExpression(expression.getOperator())}expression.addedCall&&expression.addedCall()}}var kity=_p.r(51),GTYPE=_p.r(6),FontManager=_p.r(42),FontInstaller=_p.r(41),DEFAULT_OPTIONS={fontsize:50,autoresize:!0,padding:[0]},Output=_p.r(1),EXPRESSION_INTERVAL=10,ExpressionWrap=kity.createClass("ExpressionWrap",{constructor:function(exp,config){this.wrap=new kity.Group,this.bg=new kity.Rect(0,0,0,0).fill("transparent"),this.exp=exp,this.config=config,this.wrap.setAttr("data-type","kf-exp-wrap"),this.bg.setAttr("data-type","kf-exp-wrap-bg"),this.wrap.addShape(this.bg),this.wrap.addShape(this.exp)},getWrapShape:function(){return this.wrap},getExpression:function(){return this.exp},getBackground:function(){return this.bg},resize:function(){var padding=this.config.padding,expBox=this.exp.getFixRenderBox();1===padding.length&&(padding[1]=padding[0]),this.bg.setSize(2*padding[1]+expBox.width,2*padding[0]+expBox.height),this.exp.translate(padding[1],padding[0])}}),Formula=kity.createClass("Formula",{base:_p.r(49),constructor:function(container,config){this.callBase(container),this.expressions=[],this.fontInstaller=new FontInstaller(this),this.config=kity.Utils.extend({},DEFAULT_OPTIONS,config),this.initEnvironment(),this.initInnerFont()},getContentContainer:function(){return this.container},initEnvironment:function(){this.zoom=this.config.fontsize/50,"width"in this.config&&this.setWidth(this.config.width),"height"in this.config&&this.setHeight(this.config.height),this.node.setAttribute("font-size",DEFAULT_OPTIONS.fontsize)},initInnerFont:function(){function createFontStyle(fontInfo){var stylesheet=_self.doc.createElement("style");stylesheet.setAttribute("type","text/css"),stylesheet.innerHTML='@font-face{font-family: "${fontFamily}";font-style: normal;src: url("${src}") format("woff");}'.replace("${fontFamily}",fontInfo.meta.fontFamily).replace("${src}",fontInfo.meta.src),_self.resourceNode.appendChild(stylesheet)}var fontList=FontManager.getFontList(),_self=this;kity.Utils.each(fontList,function(fontInfo){createFontStyle(fontInfo)})},insertExpression:function(expression,index){var expWrap=this.wrap(expression);return this.container.clearTransform(),this.expressions.splice(index,0,expWrap.getWrapShape()),this.addShape(expWrap.getWrapShape()),notifyExpression.call(this,expWrap.getExpression()),expWrap.resize(),correctOffset.call(this),this.resetZoom(),this.config.autoresize&&this.resize()},appendExpression:function(expression){this.insertExpression(expression,this.expressions.length)},resize:function(){var renderBox=this.container.getFixRenderBox();this.node.setAttribute("width",renderBox.width),this.node.setAttribute("height",renderBox.height)},resetZoom:function(){var zoomLevel=this.zoom/this.getBaseZoom();0!==zoomLevel&&this.container.scale(zoomLevel)},wrap:function(exp){return new ExpressionWrap(exp,this.config)},clear:function(){this.callBase(),this.expressions=[]},clearExpressions:function(){kity.Utils.each(this.expressions,function(exp){exp.remove()}),this.expressions=[]},toJPG:function(cb){new Output(this).toJPG(cb)},toPNG:function(cb){new Output(this).toPNG(cb)}});return kity.Utils.extend(Formula,{registerFont:function(fontData){FontManager.registerFont(fontData)}}),Formula}},_p[49]={value:function(require){var kity=_p.r(51);return kity.createClass("FPaper",{base:kity.Paper,constructor:function(container){this.callBase(container),this.doc=container.ownerDocument,this.container=new kity.Group,this.container.setAttr("data-type","kf-container"),this.background=new kity.Group,this.background.setAttr("data-type","kf-bg"),this.baseZoom=1,this.zoom=1,this.base("addShape",this.background),this.base("addShape",this.container)},getZoom:function(){return this.zoom},getBaseZoom:function(){return this.baseZoom},addShape:function(shape,pos){return this.container.addShape(shape,pos)},getBackground:function(){return this.background},removeShape:function(pos){return this.container.removeShape(pos)},clear:function(){return this.container.clear()}})}},_p[50]={value:function(){if(!window.jQuery)throw new Error("Missing jQuery");return window.jQuery}},_p[51]={value:function(){if(!window.kity)throw new Error("Missing Kity Graphic Lib");return window.kity}},_p[52]={value:function(require){function generate(exp){var left=this.getParentExpression().getLeftSymbol(),right=this.getParentExpression().getRightSymbol(),fontSize=exp.getFixRenderBox().height,group=new kity.Group,offset=0,leftOp=new Text(left,"KF AMS MAIN").fill("black"),rightOp=new Text(right,"KF AMS MAIN").fill("black");leftOp.setFontSize(fontSize),rightOp.setFontSize(fontSize),this.addOperatorShape(group.addShape(leftOp).addShape(rightOp)),offset+=leftOp.getFixRenderBox().width,exp.translate(offset,0),offset+=exp.getFixRenderBox().width,rightOp.translate(offset,0)}var kity=_p.r(51),Text=_p.r(5);return kity.createClass("BracketsOperator",{base:_p.r(72),constructor:function(){this.callBase("Brackets")},applyOperand:function(exp){generate.call(this,exp)}})}},_p[53]={value:function(require){var kity=_p.r(51);return kity.createClass("CombinationOperator",{base:_p.r(72),constructor:function(){this.callBase("Combination")},applyOperand:function(){var offsetX=0,operands=arguments,maxHeight=0,maxOffsetTop=0,maxOffsetBottom=0,cached=[],offsets=[];kity.Utils.each(operands,function(operand){var box=operand.getFixRenderBox(),offsetY=operand.getOffset();box.height-=offsetY.top+offsetY.bottom,cached.push(box),offsets.push(offsetY),maxOffsetTop=Math.max(offsetY.top,maxOffsetTop),maxOffsetBottom=Math.max(offsetY.bottom,maxOffsetBottom),maxHeight=Math.max(box.height,maxHeight)}),kity.Utils.each(operands,function(operand,index){var box=cached[index];operand.translate(offsetX-box.x,(maxHeight-(box.y+box.height))/2+maxOffsetBottom-offsets[index].bottom),offsetX+=box.width}),this.parentExpression.setOffset(maxOffsetTop,maxOffsetBottom),this.parentExpression.updateBoxSize()}})}},_p[54]={value:function(require){var kity=_p.r(51),EmptyExpression=_p.r(20),defaultOptions={subOffset:0,supOffset:0,zoom:.66};return kity.createClass("ScriptController",{constructor:function(opObj,target,sup,sub,options){this.observer=opObj.getParentExpression(),this.target=target,this.sup=sup,this.sub=sub,this.options=kity.Utils.extend({},defaultOptions,options)},applyUpDown:function(){var target=this.target,sup=this.sup,sub=this.sub,options=this.options;sup.scale(options.zoom),sub.scale(options.zoom);var targetBox=target.getFixRenderBox();return EmptyExpression.isEmpty(sup)&&EmptyExpression.isEmpty(sub)?{width:targetBox.width,height:targetBox.height,top:0,bottom:0}:!EmptyExpression.isEmpty(sup)&&EmptyExpression.isEmpty(sub)?this.applyUp(target,sup):EmptyExpression.isEmpty(sup)&&!EmptyExpression.isEmpty(sub)?this.applyDown(target,sub):this.applyUpDownScript(target,sup,sub)},applySide:function(){var target=this.target,sup=this.sup,sub=this.sub;if(EmptyExpression.isEmpty(sup)&&EmptyExpression.isEmpty(sub)){var targetRectBox=target.getRenderBox(this.observer);return{width:targetRectBox.width,height:targetRectBox.height,top:0,bottom:0}}return EmptyExpression.isEmpty(sup)&&!EmptyExpression.isEmpty(sub)?this.applySideSub(target,sub):!EmptyExpression.isEmpty(sup)&&EmptyExpression.isEmpty(sub)?this.applySideSuper(target,sup):this.applySideScript(target,sup,sub)},applySideSuper:function(target,sup){sup.scale(this.options.zoom);var targetRectBox=target.getRenderBox(this.observer),supRectBox=sup.getRenderBox(this.observer),targetMeanline=target.getMeanline(this.observer),supBaseline=sup.getBaseline(this.observer),positionline=targetMeanline,diff=supBaseline-positionline,space={top:0,bottom:0,width:targetRectBox.width+supRectBox.width,height:targetRectBox.height};return sup.translate(targetRectBox.width,0),this.options.supOffset&&sup.translate(this.options.supOffset,0),diff>0?(target.translate(0,diff),space.bottom=diff,space.height+=diff):sup.translate(0,-diff),space},applySideSub:function(target,sub){sub.scale(this.options.zoom);var targetRectBox=target.getRenderBox(this.observer),subRectBox=sub.getRenderBox(this.observer),subOffset=sub.getOffset(),targetBaseline=target.getBaseline(this.observer),subPosition=(subRectBox.height+subOffset.top+subOffset.bottom)/2,diff=targetRectBox.height-targetBaseline-subPosition,space={top:0,bottom:0,width:targetRectBox.width+subRectBox.width,height:targetRectBox.height};return sub.translate(targetRectBox.width,subOffset.top+targetBaseline-subPosition),this.options.subOffset&&sub.translate(this.options.subOffset,0),diff<0&&(space.top=-diff,space.height-=diff),space},applySideScript:function(target,sup,sub){sup.scale(this.options.zoom),sub.scale(this.options.zoom);var targetRectBox=target.getRenderBox(this.observer),subRectBox=sub.getRenderBox(this.observer),supRectBox=sup.getRenderBox(this.observer),targetMeanline=target.getMeanline(this.observer),targetBaseline=target.getBaseline(this.observer),supBaseline=sup.getBaseline(this.observer),subAscenderline=sub.getAscenderline(this.observer),supPosition=targetMeanline,subPosition=targetMeanline+2*(targetBaseline-targetMeanline)/3,topDiff=supPosition-supBaseline,bottomDiff=targetRectBox.height-subPosition-(subRectBox.height-subAscenderline),space={top:0,bottom:0,width:targetRectBox.width+Math.max(subRectBox.width,supRectBox.width),height:targetRectBox.height};return sup.translate(targetRectBox.width,topDiff),sub.translate(targetRectBox.width,subPosition-subAscenderline),this.options.supOffset&&sup.translate(this.options.supOffset,0),this.options.subOffset&&sub.translate(this.options.subOffset,0),topDiff>0?bottomDiff<0&&(targetRectBox.height-=bottomDiff,space.top=-bottomDiff):(target.translate(0,-topDiff),sup.translate(0,-topDiff),sub.translate(0,-topDiff),space.height-=topDiff,bottomDiff>0?space.bottom=-topDiff:(space.height-=bottomDiff,topDiff=-topDiff,bottomDiff=-bottomDiff,topDiff>bottomDiff?space.bottom=topDiff-bottomDiff:space.top=bottomDiff-topDiff)),space},applyUp:function(target,sup){var supBox=sup.getFixRenderBox(),targetBox=target.getFixRenderBox(),space={width:Math.max(targetBox.width,supBox.width),height:supBox.height+targetBox.height,top:0,bottom:supBox.height};return sup.translate((space.width-supBox.width)/2,0),target.translate((space.width-targetBox.width)/2,supBox.height),space},applyDown:function(target,sub){var subBox=sub.getFixRenderBox(),targetBox=target.getFixRenderBox(),space={width:Math.max(targetBox.width,subBox.width),height:subBox.height+targetBox.height,top:subBox.height,bottom:0};return sub.translate((space.width-subBox.width)/2,targetBox.height),target.translate((space.width-targetBox.width)/2,0),space},applyUpDownScript:function(target,sup,sub){var supBox=sup.getFixRenderBox(),subBox=sub.getFixRenderBox(),targetBox=target.getFixRenderBox(),space={width:Math.max(targetBox.width,supBox.width,subBox.width),height:supBox.height+subBox.height+targetBox.height,top:0,bottom:0};return sup.translate((space.width-supBox.width)/2,0),target.translate((space.width-targetBox.width)/2,supBox.height),sub.translate((space.width-subBox.width)/2,supBox.height+targetBox.height),space}})}},_p[55]={value:function(require,exports,modules){return _p.r(51).createClass("ArrayOperator",{base:_p.r(60),constructor:function(){this.callBase("Array")},applyOperand:function(){this.log("tableLocation",this.getParentExpression().getTableLocation()),this.log("colClass",this.getParentExpression().getColClass());for(var array=this.preOperands(arguments),yOffset=0,i=0,rowLen=array.length;i<rowLen;i++){for(var row=array[i],xOffset=0,j=0,colLen=row.length;j<colLen;j++){var col=row[j];col&&(col.operand.translate(xOffset,yOffset),xOffset+=array.colWidths[j]+40)}yOffset+=row.height+5}},isRowSeparator:function(clazz){return _p.r(20).isEmpty(clazz)},preOperands:function(operands){var matrix=[];matrix.colWidths=[];var row=[];row.height=0;for(var colIndex=0,i=0,len=operands.length;i<len;i++){var operand=operands[i];if(this.isRowSeparator(operand))matrix.push(row),row=[],row.height=0,colIndex=0;else{var col={};col.operand=operand,row.height=Math.max(row.height,Math.ceil(col.operand.getBoundaryBox().height));var operandWidth=Math.ceil(col.operand.getBoundaryBox().width);matrix.colWidths[colIndex]?matrix.colWidths[colIndex]=Math.max(matrix.colWidths[colIndex],operandWidth):matrix.colWidths[colIndex]=operandWidth,colIndex++,row.push(col),i==len-1&&matrix.push(row)}}return matrix}})}},_p[56]={value:function(require){function generateOperator(exponent){var hLine=generateOperatorGraph.call(this,exponent);this.addOperatorShape(hLine),adjustmentPosition.call(this,hLine,this.operatorShape,exponent),this.parentExpression.expand(0,10),this.parentExpression.translateElement(0,5)}function generateOperatorGraph(operand){var width=operand.getWidth(),height=operand.getHeight(),rate=width/height>3?.8:1;return(new kity.Polyline).pipe(function(){this.addPoint([0,height*rate],0),this.addPoint([width,.3*height],1),this.stroke((new kity.Pen).pipe(function(pen){pen.setWidth(1),pen.setColor("black")}))})}function adjustmentPosition(position,operator,radicand){var opOffset={x:0,y:0},height=.1*radicand.getHeight();operator.translate(opOffset.x,-.1*height),radicand.scale(scaleRate),radicand.translate(0,height)}var kity=_p.r(51),scaleRate=1;return kity.createClass("CancelOperator",{base:_p.r(72),constructor:function(operatorName){this.callBase(operatorName)},applyOperand:function(exponent){generateOperator.call(this,exponent)}})}},_p[57]={value:function(require,exports,modules){return _p.r(51).createClass("EquationsOperator",{base:_p.r(60),constructor:function(){this.callBase("Equations")},applyOperand:function(){this.log("equationType",this.getParentExpression().getEquationsType());for(var xOffset=0,yOffset=0,equationsHeight=0,maxWidth=this.getMaxWidth(arguments),i=0;i<arguments.length;i++){var equation=arguments[i];this.log(i+" equation before:",equation.getRenderBox()),xOffset=(maxWidth-equation.getRenderBox().width)/2,equation.translate(xOffset,yOffset),equationsHeight+=equation.getRenderBox().height,yOffset=equationsHeight+5}},getMaxWidth:function(equations){for(var maxWidth=0,i=0;i<equations.length;i++)maxWidth=Math.max(maxWidth,equations[i].getRenderBox().width);return maxWidth}})}},_p[58]={value:function(require){var kity=_p.r(51),EmptyExpression=_p.r(20),Text=_p.r(5),OPERATORS_METADATAS={matrix:null,pmatrix:{left:"(",right:")"},bmatrix:{left:"[",right:"]"},Bmatrix:{left:"{",right:"}"},vmatrix:{left:"|",right:"|"},Vmatrix:{left:"||",right:"||"}};return kity.createClass("MatrixOperator",{base:_p.r(60),constructor:function(){this.callBase("Matrix")},applyOperand:function(){
for(var matrixType=this.getParentExpression().getMatrixType(),matrix=this.preOperands(arguments),leftOperator=this.generateOperator(matrixType,matrix.height,!0),rightOperator=this.generateOperator(matrixType,matrix.height,!1),xInitOffset=leftOperator?leftOperator.getFixRenderBox().width:0,yOffset=0,xOffset=xInitOffset,xOffsetRightOperator=0,i=0,rowLen=matrix.length;i<rowLen;i++){var row=matrix[i];xOffset=xInitOffset;for(var j=0,colLen=row.length;j<colLen;j++){var col=row[j];if(col){var xOffsetInCol=(matrix.colWidths[j]-col.operand.getBoundaryBox().width)/2,yOffsetInRow=(row.height-col.operand.getBoundaryBox().height)/2;col.operand.translate(xOffset+xOffsetInCol,yOffset+yOffsetInRow),xOffset+=matrix.colWidths[j]+40}}xOffsetRightOperator=Math.max(xOffsetRightOperator,xOffset),yOffset+=row.height+5}rightOperator&&rightOperator.translate(xOffsetRightOperator-40,0)},generateOperator:function(matrixType,height,isLeft){if(!OPERATORS_METADATAS.hasOwnProperty(matrixType))throw new Error("illegal matrix type - "+matrixType);var operatorMetadata=OPERATORS_METADATAS[matrixType],operator=null;return operatorMetadata&&(operator=new Text(isLeft?operatorMetadata.left:operatorMetadata.right,"KF AMS MAIN").fill("black"),operator.setFontSize(height),this.addOperatorShape(operator)),operator},preOperands:function(operands){var matrix=[];matrix.colWidths=[];var row=[];row.height=0;for(var colIndex=0,i=0,len=operands.length;i<len;i++){var operand=operands[i];if(this.isRowSeparator(operand))matrix.push(row),row=[],row.height=0,colIndex=0;else{var col={};col.operand=operand,row.height=Math.max(row.height,Math.ceil(col.operand.getBoundaryBox().height));var operandWidth=Math.ceil(col.operand.getBoundaryBox().width);matrix.colWidths[colIndex]?matrix.colWidths[colIndex]=Math.max(matrix.colWidths[colIndex],operandWidth):matrix.colWidths[colIndex]=operandWidth,colIndex++,row.push(col),i==len-1&&matrix.push(row)}}matrix.width=0;for(var i=0,len=matrix.colWidths.length;i<len;i++)matrix.width+=matrix.colWidths[i];matrix.height=0;for(var i=0,len=matrix.length;i<len;i++)matrix.height+=matrix[i].height;return matrix},isRowSeparator:function(clazz){return EmptyExpression.isEmpty(clazz)}})}},_p[59]={value:function(require){var kity=_p.r(51),Text=_p.r(5);return kity.createClass("NDBracketsOperator",{base:_p.r(60),constructor:function(){this.callBase("NDBrackets")},applyOperand:function(exp){var left=this.getParentExpression().getLeftSymbol(),right=this.getParentExpression().getRightSymbol();this.generatePairBrackets(left,right,exp)},generatePairBrackets:function(left,right,exp){var fontSize=exp.getFixRenderBox().height,group=new kity.Group,offset=0,hasLeftOp=!this.isDot(left),hasRightOp=!this.isDot(right),leftOp=null;hasLeftOp&&(leftOp=new Text(left,"KF AMS MAIN").fill("black"),leftOp.setFontSize(fontSize),group.addShape(leftOp));var rightOp=null;hasRightOp&&(rightOp=new Text(right,"KF AMS MAIN").fill("black"),rightOp.setFontSize(fontSize),group.addShape(rightOp)),this.addOperatorShape(group),hasLeftOp&&(offset+=leftOp.getFixRenderBox().width),exp.translate(offset,0),hasRightOp&&(offset+=exp.getFixRenderBox().width,rightOp.translate(offset,0))},generateLeftBrace:function(exp){var expHeight=exp.getFixRenderBox().height,offset=0,leftOp=new kity.Path("M10 0 Q5 1,5 10 V 50 Q6 56,0 60 Q7 63,5 70 V 110 Q7 123,10 120").stroke("black");this.addOperatorShape(leftOp);var bracketsHeightScale=expHeight/leftOp.getRenderBox().height;leftOp.scale(1,bracketsHeightScale),offset+=leftOp.getFixRenderBox().width+5,exp.translate(offset,0)},isDot:function(input){return"."===input}})}},_p[60]={value:function(require,exports,modules){var kity=_p.r(51),EmptyExpression=_p.r(20);return kity.createClass("NDOperator",{base:_p.r(72),constructor:function(operatorName){this.callBase(operatorName)},log:function(prefix,message){if(message){var outMessage=message;"object"==typeof message&&(outMessage=JSON.stringify(message)),console.log(prefix+" - "+outMessage)}else console.log(prefix)},drawReferenceLine:function(shape){if(!EmptyExpression.isEmpty(shape)){var verticalReferenceLine=new kity.Rect(1,shape.getRenderBox().height,shape.getRenderBox().x+shape.getRenderBox().width+2,shape.getRenderBox().y).fill("red");this.addOperatorShape(verticalReferenceLine);var horizontalReferenceLine=new kity.Rect(shape.getRenderBox().width,1,shape.getRenderBox().x,shape.getRenderBox().y+shape.getRenderBox().height+2).fill("blue");this.addOperatorShape(horizontalReferenceLine)}},drawBaseLine:function(refer,shape){if(!EmptyExpression.isEmpty(shape)&&shape.getBaseline){var baseline=new kity.Rect(shape.getRenderBox().width,1,shape.getRenderBox().x,shape.getRenderBox().y+shape.getBaseline(refer)).fill("red");this.addOperatorShape(baseline)}},drawMeanLine:function(refer,shape){if(!EmptyExpression.isEmpty(shape)&&shape.getMeanline){var meanline=new kity.Rect(shape.getRenderBox().width,1,shape.getRenderBox().x,shape.getRenderBox().y+shape.getMeanline(refer)).fill("black");this.addOperatorShape(meanline)}}})}},_p[61]={value:function(require){function generateOperator(exponent){var hLine=generateOperatorGraph.call(this,exponent);this.addOperatorShape(hLine),adjustmentPosition.call(this,hLine,this.operatorShape,exponent),this.parentExpression.expand(0,10),this.parentExpression.translateElement(0,5)}function generateOperatorGraph(operand){var width=operand.getWidth()*scaleRate,height=.1*operand.getHeight();if("bar"==this.operatorName)return new kity.Rect(width,2).fill("black");if("hat"==this.operatorName){var w=width/2,polyline=(new kity.Polyline).pipe(function(){this.addPoint([w-height,height],0),this.addPoint([w,0],1),this.addPoint([w+height,height],2),this.stroke((new kity.Pen).pipe(function(pen){pen.setWidth(1),pen.setColor("black")}))});return polyline}if("widehat"==this.operatorName){var w=width/2,polyline=(new kity.Polyline).pipe(function(){this.addPoint([0,height],0),this.addPoint([w,0],1),this.addPoint([2*w,height],2),this.stroke((new kity.Pen).pipe(function(pen){pen.setWidth(1),pen.setColor("black")}))});return polyline}if("vector"==this.operatorName){var w=width,polyline=(new kity.Polyline).pipe(function(){this.addPoint([0,height],0),this.addPoint([w,height],1),this.addPoint([w-2*height,0],2),this.addPoint([w,height],3),this.addPoint([w-2*height,2*height],4),this.stroke((new kity.Pen).pipe(function(pen){pen.setWidth(1),pen.setColor("black")}))});return polyline}}function adjustmentPosition(position,operator,radicand){var opOffset={x:0,y:0},height=.1*radicand.getHeight();operator.translate(opOffset.x,-.1*height),radicand.scale(scaleRate),radicand.translate(0,height)}var kity=_p.r(51),scaleRate=1;return kity.createClass("OneArgumentOperator",{base:_p.r(72),constructor:function(operatorName){this.callBase(operatorName)},applyOperand:function(exponent){generateOperator.call(this,exponent)}})}},_p[62]={value:function(require){var kity=_p.r(51);return kity.createClass("OverUnderLineOperator",{base:_p.r(60),constructor:function(operatorName){this.callBase(operatorName||"OverUnderLine")},applyOperand:function(operand){var lineWidth=operand.getRenderBox().width,operator=this.generateOperator(lineWidth),offsetY=2;this.parentExpression.isOver()?(offsetY+=operator.getRenderBox().height,operand.translate(0,offsetY)):(offsetY+=operand.getRenderBox().height,operator.translate(0,offsetY))},generateOperator:function(lineWidth){var line=(new kity.Rect).pipe(function(){this.setPositionX(0),this.setPositionY(0),this.setWidth(lineWidth),this.setHeight(2),this.fill("black")});return this.addOperatorShape(line),line}})}},_p[63]={value:function(require){var kity=_p.r(51);return kity.createClass("XArrowOperator",{base:_p.r(60),constructor:function(operatorName){this.callBase(operatorName||"XArrow")},applyOperand:function(upOperand){this.applyOverArrow(upOperand)},applyOverArrow:function(operand){var operandWidth=operand.getRenderBox().width,operator=this.generateOperator(operandWidth);operator.translate(0,.5*operator.getRenderBox().height),operand.translate(0,.7*operator.getRenderBox().height)},generateOperator:function(lineWidth){var rate=lineWidth>100?1-10/lineWidth:.85,startwidth=lineWidth*rate,startHeight=lineWidth*(1-rate),operatorShape=new kity.Path("M0 0 H"+lineWidth+" L"+startwidth+" "+-1*startHeight+" M"+lineWidth+" 0 L"+startwidth+" "+startHeight);return operatorShape.stroke("black",2),this.addOperatorShape(operatorShape),operatorShape}})}},_p[64]={value:function(require){var kity=_p.r(51),ScriptController=_p.r(54);return kity.createClass("ProductOperator",{base:_p.r(72),constructor:function(operatorName){this.callBase(operatorName),this.displayType="equation"},applyOperand:function(expr,sup,sub){var opShape=this.getOperatorShape(),expBox=expr.getFixRenderBox(),space=new ScriptController(this,opShape,sup,sub).applyUpDown(),diff=(space.height-space.top-space.bottom-expBox.height)/2;diff>=0?expr.translate(space.width+0,diff+space.bottom):(diff=-diff,opShape.translate(0,diff),sup.translate(0,diff),sub.translate(0,diff),expr.translate(space.width+0,space.bottom)),this.parentExpression.setOffset(space.top,space.bottom),this.parentExpression.expand(0,0),this.parentExpression.translateElement(0,0)},createProductShape:function(){var operatorShape=new kity.Path("M158 656Q147 684 131 694Q110 707 69 710H55V750H888V710H874Q840 708 820 698T795 678T786 656V-155Q798 -206 874 -210H888V-250H570V-210H584Q618 -208 638 -197T663 -178T673 -155V710H270V277L271 -155Q283 -206 359 -210H373V-250H55V-210H69Q103 -208 123 -197T148 -178T158 -155V656Z").fill("black");return operatorShape.scale(.0365),operatorShape.rotate(180),operatorShape.translate(33,28),operatorShape},createCoproductShape:function(){var operatorShape=new kity.Path("M158 656Q147 684 131 694Q110 707 69 710H55V750H888V710H874Q840 708 820 698T795 678T786 656V-155Q798 -206 874 -210H888V-250H570V-210H584Q618 -208 638 -197T663 -178T673 -155V710H270V277L271 -155Q283 -206 359 -210H373V-250H55V-210H69Q103 -208 123 -197T148 -178T158 -155V656Z").fill("black");return operatorShape.scale(.0365),operatorShape.translate(0,10),operatorShape},createBigcupShape:function(){var operatorShape=new kity.Path("M96 750Q103 750 109 748T120 744T127 737T133 730T137 723T139 718V395L140 73L142 60Q159 -43 237 -104T416 -166Q521 -166 597 -103T690 60L692 73L694 718Q708 749 735 749Q765 749 775 720Q777 714 777 398Q777 78 776 71Q766 -51 680 -140Q571 -249 416 -249H411Q261 -249 152 -140Q66 -51 56 71Q55 78 55 398Q55 714 57 720Q60 734 70 740Q80 750 96 750Z").fill("black");return operatorShape.scale(.0365),operatorShape.rotate(180),operatorShape.translate(28,28),operatorShape},createBigcapShape:function(){var operatorShape=new kity.Path("M96 750Q103 750 109 748T120 744T127 737T133 730T137 723T139 718V395L140 73L142 60Q159 -43 237 -104T416 -166Q521 -166 597 -103T690 60L692 73L694 718Q708 749 735 749Q765 749 775 720Q777 714 777 398Q777 78 776 71Q766 -51 680 -140Q571 -249 416 -249H411Q261 -249 152 -140Q66 -51 56 71Q55 78 55 398Q55 714 57 720Q60 734 70 740Q80 750 96 750Z").fill("black");return operatorShape.scale(.0365),operatorShape.translate(-2,8),operatorShape},createBigveeShape:function(){var operatorShape=new kity.Path("M55 708Q55 729 68 739T96 750Q119 750 132 731Q136 726 276 323L416 -79L557 323Q696 725 700 731Q713 749 735 749Q756 749 766 736T777 708Q777 700 696 466T533 1T451 -232Q436 -249 416 -249Q402 -249 391 -241Q384 -236 380 -226Q368 -198 219 230Q55 697 55 708Z").fill("black");return operatorShape.scale(.0365),operatorShape.rotate(180),operatorShape.translate(30,28),operatorShape},createBigwedgeShape:function(){var operatorShape=new kity.Path("M55 708Q55 729 68 739T96 750Q119 750 132 731Q136 726 276 323L416 -79L557 323Q696 725 700 731Q713 749 735 749Q756 749 766 736T777 708Q777 700 696 466T533 1T451 -232Q436 -249 416 -249Q402 -249 391 -241Q384 -236 380 -226Q368 -198 219 230Q55 697 55 708Z").fill("black");return operatorShape.scale(.0365),operatorShape.translate(-2,8),operatorShape},getOperatorShape:function(){var operatorShape=null;if("prod"==this.operatorName)operatorShape=this.createProductShape();else if("coprod"==this.operatorName)operatorShape=this.createCoproductShape();else if("bigcup"==this.operatorName)operatorShape=this.createBigcupShape();else if("bigcap"==this.operatorName)operatorShape=this.createBigcapShape();else if("bigvee"==this.operatorName)operatorShape=this.createBigveeShape();else{if("bigwedge"!=this.operatorName)throw"不支持的操作符'"+this.operatorName+"'";operatorShape=this.createBigwedgeShape()}var opBgShape=new kity.Rect(0,0,0,0).fill("transparent"),group=new kity.Group,opRenderBox=null;return group.addShape(opBgShape),group.addShape(operatorShape),operatorShape.scale(1.6),this.addOperatorShape(group),opRenderBox=operatorShape.getFixRenderBox(),"inline"===this.displayType?(operatorShape.translate(5,15),opBgShape.setSize(opRenderBox.width+10,opRenderBox.height+25)):(operatorShape.translate(2,5),opBgShape.setSize(opRenderBox.width+4,opRenderBox.height+8)),group}})}},_p[65]={value:function(require){var kity=_p.r(51);return kity.createClass("UnderrightarrowOperator",{base:_p.r(60),constructor:function(operatorName){this.callBase(operatorName||"XArrow")},applyOperand:function(upOperand){this.applyUnderArrow(upOperand)},applyUnderArrow:function(operand){var operandWidth=operand.getRenderBox().width,operator=this.generateOperator(operandWidth);operand.translate((operator.getRenderBox().width-operandWidth)/2,.2*operator.getRenderBox().height),operator.translate(0,operand.getRenderBox().height+.5*operator.getRenderBox().height)},generateOperator:function(lineWidth){var rate=lineWidth>100?1-10/lineWidth:.85,startwidth=lineWidth*rate,startHeight=lineWidth*(1-rate),operatorShape=new kity.Path("M0 0 H"+lineWidth+" L"+startwidth+" "+-1*startHeight+" M"+lineWidth+" 0 L"+startwidth+" "+startHeight);return operatorShape.stroke("black",2),this.addOperatorShape(operatorShape),operatorShape}})}},_p[66]={value:function(require){var kity=_p.r(51),EmptyExpression=_p.r(20);return kity.createClass("XArrowOperator",{base:_p.r(60),constructor:function(operatorName){this.callBase(operatorName||"XArrow")},applyOperand:function(upOperand,downOperand){upOperand.scale(.5),downOperand.scale(.5);var arrowType="XArrow"==this.operatorName?this.parentExpression.getArrowType():this.operatorName;/^x/i.test(arrowType)?this.applyXArrow(arrowType,upOperand,downOperand):/^under/i.test(arrowType)?this.applyUnderArrow(arrowType,upOperand):/^over/i.test(arrowType)&&this.applyOverArrow(arrowType,upOperand)},applyOverArrow:function(arrowType,operand){var operandWidth=operand.getRenderBox().width,operator=this.generateOperator(arrowType,operandWidth);operand.translate((operator.getRenderBox().width-operandWidth)/2,operator.getRenderBox().height)},applyUnderArrow:function(arrowType,operand){var operandWidth=operand.getRenderBox().width,operator=this.generateOperator(arrowType,operandWidth);operand.translate((operator.getRenderBox().width-operandWidth)/2,0),operator.translate(0,operand.getRenderBox().height+operator.getRenderBox().height/2)},applyXArrow:function(arrowType,upOperand,downOperand){var upWidth=upOperand.getRenderBox().width,downWidth=downOperand.getRenderBox().width,maxWidth=Math.max(upWidth,downWidth),upHeight=Math.ceil(upOperand.getRenderBox().height),operator=this.generateOperator(arrowType,maxWidth+60),operatorWidth=operator.getRenderBox().width;upOperand.translate((operatorWidth-upWidth)/2,0),operator.translate(0,upHeight+operator.getRenderBox().height/2+1),downOperand.translate((operatorWidth-downWidth)/2,upHeight+operator.getRenderBox().height+1),EmptyExpression.isEmpty(downOperand)&&this.parentExpression.expand(0,upOperand.getRenderBox().height)},generateOperator:function(arrowType,lineWidth){var operatorShape=null;if(!(arrowType&&arrowType.indexOf("right")>-1))throw new Error("invalid arrowType - "+arrowType);return operatorShape=new kity.Path("M0 0 H"+lineWidth+" L"+(lineWidth-10)+" -10 M"+lineWidth+" 0 L"+(lineWidth-10)+" 10").stroke("black",2),this.addOperatorShape(operatorShape),operatorShape}})}},_p[67]={value:function(require){var kity=_p.r(51),EmptyExpression=_p.r(20);return kity.createClass("XLongEqualOperator",{base:_p.r(60),constructor:function(){this.callBase("XLongEqual")},applyOperand:function(up,down){up.scale(.5),down.scale(.5);var lineWidth=Math.max(Math.max(up.getRenderBox().width,down.getRenderBox().width)+30,30),offset=5;up.translate((lineWidth-up.getRenderBox().width)/2,0);var operator=this.generateOperator(lineWidth);offset+=up.getRenderBox().height,operator.translate(0,offset),EmptyExpression.isEmpty(down)?this.parentExpression.expand(0,up.getRenderBox().height):(offset+=operator.getRenderBox().height+5,down.translate((lineWidth-down.getRenderBox().width)/2,offset))},generateOperator:function(lineWidth){var up=(new kity.Rect).pipe(function(){this.setPositionX(0),this.setPositionY(0),this.setWidth(lineWidth),this.setHeight(2),this.fill("black")}),down=(new kity.Rect).pipe(function(){this.setPositionX(0),this.setPositionY(10),this.setWidth(lineWidth),this.setHeight(2),this.fill("black")}),group=new kity.Group;return group.handleAdd(up,0),group.handleAdd(down,1),this.addOperatorShape(group),group}})}},_p[68]={value:function(require){var kity=_p.r(51),EmptyExpression=_p.r(20);return kity.createClass("XrightleftharpoonsOperator",{base:_p.r(60),constructor:function(){this.callBase("Xrightleftharpoons"),this.displayType="equation"},applyOperand:function(up,down){up.scale(.5),down.scale(.5);var lineWidth=Math.max(Math.max(up.getRenderBox().width,down.getRenderBox().width)+20,30),optWidth=lineWidth+10,offset=5;up.translate((optWidth-up.getRenderBox().width)/2,0);var operator=this.generateOperator(lineWidth,10);offset+=up.getRenderBox().height,operator.translate(0,offset),EmptyExpression.isEmpty(down)?this.parentExpression.expand(0,up.getRenderBox().height):(offset+=operator.getRenderBox().height+5,down.translate((optWidth-down.getRenderBox().width)/2,offset))},generateOperator:function(lineWidth,arrowWidth){var up=(new kity.Polyline).pipe(function(){this.addPoint([0,10],0),this.addPoint([lineWidth+arrowWidth,10],1),this.addPoint([lineWidth,0],2),this.stroke((new kity.Pen).pipe(function(pen){pen.setWidth(1.5),pen.setColor("black")}))}),down=(new kity.Polyline).pipe(function(){this.addPoint([arrowWidth,30],0),this.addPoint([0,20],1),this.addPoint([lineWidth+arrowWidth,20],2),this.stroke((new kity.Pen).pipe(function(pen){pen.setWidth(1.5),pen.setColor("black")}))}),group=new kity.Group;return group.handleAdd(up,0),group.handleAdd(down,1),this.addOperatorShape(group),group}})}},_p[69]={value:function(require){function generateOperator(width,overflow){return new kity.Rect(width+2*overflow,1).fill("black")}var kity=_p.r(51),ZOOM=_p.r(78).zoom;return kity.createClass("FractionOperator",{base:_p.r(72),constructor:function(){this.callBase("Fraction")},applyOperand:function(upOperand,downOperand){upOperand.scale(ZOOM),downOperand.scale(ZOOM);var upWidth=Math.ceil(upOperand.getWidth()),downWidth=Math.ceil(downOperand.getWidth()),upHeight=Math.ceil(upOperand.getHeight()),downHeight=Math.ceil(downOperand.getHeight()),maxWidth=Math.max(upWidth,downWidth),maxHeight=Math.max(upHeight,downHeight),operatorShape=generateOperator(maxWidth,3);this.addOperatorShape(operatorShape),upOperand.translate((maxWidth-upWidth)/2+3,0),operatorShape.translate(0,upHeight+1),downOperand.translate((maxWidth-downWidth)/2+3,upHeight+operatorShape.getHeight()+2),this.parentExpression.setOffset(maxHeight-upHeight,maxHeight-downHeight),this.parentExpression.expand(2,2),this.parentExpression.translateElement(1,1)}})}},_p[70]={value:function(require){function generateOperator(){var opShape=new Text(this.funcName,getFont(this.funcName));return this.addOperatorShape(opShape),opShape.getBaseline=function(){return opShape.getFixRenderBox().height},opShape.getMeanline=function(){return 0},opShape}function getFont(funcName){return-1!=[].indexOf(funcName)?"KF AMS MAIN":"KF AMS ROMAN"}var kity=_p.r(51),Text=_p.r(5),ScriptController=_p.r(54);return kity.createClass("FunctionOperator",{base:_p.r(72),constructor:function(funcName){this.callBase("Function: "+funcName),this.funcName=funcName},applyOperand:function(expr,sup,sub){var opShape=generateOperator.call(this),expBox=expr.getFixRenderBox(),scriptHanlder=this.parentExpression.isSideScript()?"applySide":"applyUpDown",space=new ScriptController(this,opShape,sup,sub,{zoom:.5})[scriptHanlder](),diff=(space.height+space.top+space.bottom-expBox.height)/2;opShape.translate(0,space.top),sup.translate(0,space.top),sub.translate(0,space.top),diff>=0?expr.translate(space.width+5,diff):(diff=-diff,opShape.translate(0,diff),sup.translate(0,diff),sub.translate(0,diff),expr.translate(space.width+5,0)),this.parentExpression.expand(5,10),this.parentExpression.translateElement(5,5)}})}},_p[71]={value:function(require){var kity=_p.r(51),ScriptController=_p.r(54);return kity.createClass("IntegrationOperator",{base:_p.r(72),constructor:function(type){this.callBase("Integration"),this.opType=type||1},setType:function(type){this.opType=0|type},resetType:function(){this.opType=1},applyOperand:function(exp,sup,sub){var opShape=this.getOperatorShape(),expBox=exp.getFixRenderBox(),space=new ScriptController(this,opShape,sup,sub,{supOffset:3,subOffset:-15}).applySide(),diff=(space.height+space.top-expBox.height)/2;opShape.translate(0,space.top),sup.translate(0,space.top),sub.translate(0,space.top),diff>=0?exp.translate(space.width+3,diff):(diff=-diff,opShape.translate(0,diff),sup.translate(0,diff),sub.translate(0,diff),exp.translate(space.width+3,0)),this.parentExpression.expand(3,6),this.parentExpression.translateElement(3,3)},getOperatorShape:function(){var group=new kity.Group,opGroup=new kity.Group,opShape=new kity.Path("M1.318,48.226c0,0,0.044,0.066,0.134,0.134c0.292,0.313,0.626,0.447,1.006,0.447c0.246,0.022,0.358-0.044,0.604-0.268   c0.782-0.782,1.497-2.838,2.324-6.727c0.514-2.369,0.938-4.693,1.586-8.448C8.559,24.068,9.9,17.878,11.978,9.52   c0.917-3.553,1.922-7.576,3.866-8.983C16.247,0.246,16.739,0,17.274,0c1.564,0,2.503,1.162,2.592,2.57   c0,0.827-0.424,1.386-1.273,1.386c-0.671,0-1.229-0.514-1.229-1.251c0-0.805,0.514-1.095,1.185-1.274   c0.022,0-0.291-0.29-0.425-0.379c-0.201-0.134-0.514-0.224-0.737-0.224c-0.067,0-0.112,0-0.157,0.022   c-0.469,0.134-0.983,0.939-1.453,2.234c-0.537,1.475-0.961,3.174-1.631,6.548c-0.424,2.101-0.693,3.464-1.229,6.727   c-1.608,9.185-2.949,15.487-5.006,23.756c-0.514,2.034-0.849,3.24-1.207,4.335c-0.559,1.698-1.162,2.95-1.811,3.799   c-0.514,0.715-1.385,1.408-2.436,1.408c-1.363,0-2.391-1.185-2.458-2.592c0-0.804,0.447-1.363,1.273-1.363   c0.671,0,1.229,0.514,1.229,1.251C2.503,47.757,1.989,48.047,1.318,48.226z").fill("black"),opBox=new kity.Rect(0,0,0,0).fill("transparent"),tmpShape=null;opGroup.addShape(opShape),group.addShape(opBox),group.addShape(opGroup),this.addOperatorShape(group);for(var i=1;i<this.opType;i++)tmpShape=new kity.Use(opShape).translate(opShape.getWidth()/2*i,0),opGroup.addShape(tmpShape);return opGroup.scale(1.6),tmpShape=null,group.getBaseline=function(){return opGroup.getFixRenderBox().height},group.getMeanline=function(){return 10},group}})}},_p[72]={value:function(require){var kity=_p.r(51),GTYPE=_p.r(6);return kity.createClass("Operator",{base:_p.r(77),constructor:function(operatorName){this.callBase(),this.type=GTYPE.OP,this.parentExpression=null,this.operatorName=operatorName,this.operatorShape=new kity.Group,this.addShape(this.operatorShape)},applyOperand:function(){throw new Error("applyOperand is abstract")},setParentExpression:function(exp){this.parentExpression=exp},getParentExpression:function(){return this.parentExpression},clearParentExpression:function(){this.parentExpression=null},addOperatorShape:function(shpae){return this.operatorShape.addShape(shpae)},getOperatorShape:function(){return this.operatorShape}})}},_p[73]={value:function(require){function generateOperator(radicand,exponent){var decoration=generateDecoration(radicand),vLine=generateVLine(radicand),hLine=generateHLine(radicand);radicand.getWidth()>0&&(this.addOperatorShape(decoration),this.addOperatorShape(vLine),this.addOperatorShape(hLine),adjustmentPosition.call(this,mergeShape(decoration,vLine,hLine),this.operatorShape,radicand,exponent),this.parentExpression.expand(0,10),this.parentExpression.translateElement(0,5))}function generateDecoration(radicand){var shape=new kity.Path,a=SHAPE_DATA_WIDTH,h=radicand.getHeight()/3,drawer=shape.getDrawer();return drawer.moveTo(0,cos15*a*6),drawer.lineBy(sin15*a,cos15*a),drawer.lineBy(cos15*a*3,-sin15*a*3),drawer.lineBy(tan15*h,h),drawer.lineBy(sin15*a*3,-cos15*a*3),drawer.lineBy(-sin15*h,-h),drawer.close(),shape.fill("black")}function generateVLine(operand){var shape=new kity.Path,h=.9*operand.getHeight(),drawer=shape.getDrawer();return drawer.moveTo(tan15*h,0),drawer.lineTo(0,h),drawer.lineBy(sin15*SHAPE_DATA_WIDTH*3,cos15*SHAPE_DATA_WIDTH*3),drawer.lineBy(tan15*h+sin15*SHAPE_DATA_WIDTH*3,-(h+3*SHAPE_DATA_WIDTH*cos15)),drawer.close(),shape.fill("black")}function generateHLine(operand){var w=operand.getWidth()+2*SHAPE_DATA_WIDTH;return new kity.Rect(w,2*SHAPE_DATA_WIDTH).fill("black")}function mergeShape(decoration,vLine,hLine){var decoBox=decoration.getFixRenderBox(),vLineBox=vLine.getFixRenderBox();return vLine.translate(decoBox.width-sin15*SHAPE_DATA_WIDTH*3,0),decoration.translate(0,vLineBox.height-decoBox.height),vLineBox=vLine.getFixRenderBox(),hLine.translate(vLineBox.x+vLineBox.width-SHAPE_DATA_WIDTH/cos15,0),{x:vLineBox.x+vLineBox.width-SHAPE_DATA_WIDTH/cos15,y:0}}function adjustmentPosition(position,operator,radicand,exponent){var exponentBox=null,opOffset={x:0,y:0},opBox=operator.getFixRenderBox();exponent.scale(.66),exponentBox=exponent.getFixRenderBox(),exponentBox.width>0&&exponentBox.height>0&&(opOffset.y=exponentBox.height-opBox.height/2,opOffset.y<0&&(exponent.translate(0,-opOffset.y),opOffset.y=0),opOffset.x=exponentBox.width+opBox.height/2*tan15-position.x),operator.translate(opOffset.x,opOffset.y),radicand.translate(opOffset.x+position.x+SHAPE_DATA_WIDTH,opOffset.y+2*SHAPE_DATA_WIDTH)}var kity=_p.r(51),SHAPE_DATA_WIDTH=1,radians=2*Math.PI/360,sin15=Math.sin(15*radians),cos15=Math.cos(15*radians),tan15=Math.tan(15*radians);return kity.createClass("RadicalOperator",{base:_p.r(72),constructor:function(){this.callBase("Radical")},applyOperand:function(radicand,exponent){generateOperator.call(this,radicand,exponent)}})}},_p[74]={value:function(require){var kity=_p.r(51),ScriptController=_p.r(54);return kity.createClass("ScriptOperator",{base:_p.r(72),constructor:function(operatorName){this.callBase(operatorName||"Script")},applyOperand:function(operand,sup,sub){var parent=this.parentExpression,space={};space=parent.isScriptMode(parent.SCRIPT_MODE_UP_DOWN)?new ScriptController(this,operand,sup,sub).applyUpDown():new ScriptController(this,operand,sup,sub).applySide(),parent.notContainsAdditionalSpace()||(space&&parent.setOffset(space.top,space.bottom),parent.expand(4,2),parent.translateElement(2,1))}})}},_p[75]={value:function(require){var kity=_p.r(51),ScriptController=_p.r(54);return kity.createClass("SummationOperator",{base:_p.r(72),constructor:function(){this.callBase("Summation"),this.displayType="equation"},applyOperand:function(expr,sup,sub){var opShape=this.getOperatorShape(),expBox=expr.getFixRenderBox(),space=new ScriptController(this,opShape,sup,sub).applyUpDown(),diff=(space.height-space.top-space.bottom-expBox.height)/2;diff>=0?expr.translate(space.width+0,diff+space.bottom):(diff=-diff,opShape.translate(0,diff),sup.translate(0,diff),sub.translate(0,diff),expr.translate(space.width+0,space.bottom)),this.parentExpression.setOffset(space.top,space.bottom),this.parentExpression.expand(0,0),this.parentExpression.translateElement(0,0)},getOperatorShape:function(){var operatorShape=new kity.Path("M0.672,33.603c-0.432,0-0.648,0-0.648-0.264c0-0.024,0-0.144,0.24-0.432l12.433-14.569L0,0.96c0-0.264,0-0.72,0.024-0.792   C0.096,0.024,0.12,0,0.672,0h28.371l2.904,6.745h-0.6C30.531,4.8,28.898,3.72,28.298,3.336c-1.896-1.2-3.984-1.608-5.28-1.8   c-0.216-0.048-2.4-0.384-5.617-0.384H4.248l11.185,15.289c0.168,0.24,0.168,0.312,0.168,0.36c0,0.12-0.048,0.192-0.216,0.384   L3.168,31.515h14.474c4.608,0,6.96-0.624,7.464-0.744c2.76-0.72,5.305-2.352,6.241-4.848h0.6l-2.904,7.681H0.672z").fill("black"),opBgShape=new kity.Rect(0,0,0,0).fill("transparent"),group=new kity.Group,opRenderBox=null;return group.addShape(opBgShape),group.addShape(operatorShape),operatorShape.scale(1.6),this.addOperatorShape(group),opRenderBox=operatorShape.getFixRenderBox(),"inline"===this.displayType?(operatorShape.translate(5,15),opBgShape.setSize(opRenderBox.width+10,opRenderBox.height+25)):(operatorShape.translate(2,5),opBgShape.setSize(opRenderBox.width+4,opRenderBox.height+8)),group}})}},_p[76]={value:function(require){function init(options){options=kity.Utils.extend({},RES_CONF,options),/^(https?:)?\/\//.test(options.path)||(options.path=getFullPath(options.path)),new FontInstall(document,options.path).mount(complete)}function complete(){kity.Utils.each(cbList,function(cb){cb(Formula)})}function getFullPath(path){var pathPart,pathname=location.pathname.split("/");return pathname.length-=1,pathname=pathname.join("/")+"/",pathPart=[location.protocol,"//",location.host,pathname,path.replace(/^\//,"")],pathPart.join("")}var kity=_p.r(51),cbList=[],RES_CONF=_p.r(78).resource,FontInstall=_p.r(41),Formula=_p.r(48),inited=!1;return{ready:function(cb,options){inited?window.setTimeout(function(){cb(Formula)},0):(inited=!0,init(options)),cbList.push(cb)}}}},_p[77]={value:function(require){var kity=_p.r(51),GTYPE=_p.r(6);return kity.createClass("SignGroup",{base:kity.Group,constructor:function(){this.callBase(),this.box=new kity.Rect(0,0,0,0),this.type=GTYPE.UNKNOWN,this.addShape(this.box),this.zoom=1},setZoom:function(zoom){this.zoom=zoom},getZoom:function(){return this.zoom},setBoxSize:function(w,h){return this.box.setSize(w,h)},setBoxWidth:function(w){return this.box.setWidth(w)},setBoxHeight:function(h){return this.box.setHeight(h)},getType:function(){return this.type},getBaseHeight:function(){return this.getHeight()},getBaseWidth:function(){return this.getWidth()},addedCall:function(){}})}},_p[78]={value:function(require){return{zoom:.66,font:{meanline:Math.round(19),baseline:Math.round(40),baseHeight:50,list:[_p.r(46),_p.r(44),_p.r(45),_p.r(43),_p.r(47)]},resource:{path:"src/resource/"},func:{"ud-script":{lim:!0}}}}},_p[79]={value:function(require){window.kf={ResourceManager:_p.r(76),Operator:_p.r(72),Expression:_p.r(21),CompoundExpression:_p.r(19),TextExpression:_p.r(39),EmptyExpression:_p.r(20),CombinationExpression:_p.r(12),FunctionExpression:_p.r(14),FractionExpression:_p.r(13),IntegrationExpression:_p.r(15),VecExpression:_p.r(32),BarExpression:_p.r(23),WidehatExpression:_p.r(33),HatExpression:_p.r(26),ProdExpression:_p.r(30)("prod"),CoprodExpression:_p.r(30)("coprod"),BigcupExpression:_p.r(30)("bigcup"),BigcapExpression:_p.r(30)("bigcap"),BigveeExpression:_p.r(30)("bigvee"),BigwedgeExpression:_p.r(30)("bigwedge"),CancelExpression:_p.r(24),XrightleftharpoonsExpression:_p.r(37),XrightarrowExpression:_p.r(36),RadicalExpression:_p.r(16),ScriptExpression:_p.r(17),SuperscriptExpression:_p.r(9),SubscriptExpression:_p.r(8),SummationExpression:_p.r(18),BracketsExpression:_p.r(11),base:"",EquationsExpression:_p.r(25),ArrayExpression:_p.r(22),XarrowExpression:_p.r(34),UnderrightarrowExpression:_p.r(31),OverrightarrowExpression:_p.r(29),MathopExpression:_p.r(38),MatrixExpression:_p.r(27),XlongequalExpression:_p.r(35),OverUnderLineExpression:_p.r(28)}}};var moduleMapping={"kf.start":79};!function(global){kity.Shape.getRenderBox;kity.extendClass(kity.Shape,{getFixRenderBox:function(){return this.getRenderBox(this.container.container)},getTranslate:function(){return this.transform.translate}});try{use("kf.start")}catch(e){}}()}();