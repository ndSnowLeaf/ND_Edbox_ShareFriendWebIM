CKEDITOR.plugins.add("removeformat",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"removeformat",hidpi:!0,init:function(editor){editor.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat),editor.ui.addButton&&editor.ui.addButton("RemoveFormat",{label:editor.lang.removeformat.toolbar,command:"removeFormat",toolbar:"cleanup,10"})}}),CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(editor){for(var range,tagsRegex=editor._.removeFormatRegex||(editor._.removeFormatRegex=new RegExp("^(?:"+editor.config.removeFormatTags.replace(/,/g,"|")+")$","i")),removeAttributes=editor._.removeAttributes||(editor._.removeAttributes=editor.config.removeFormatAttributes.split(",")),filter=CKEDITOR.plugins.removeformat.filter,ranges=editor.getSelection().getRanges(),iterator=ranges.createIterator(),isElement=function(element){return element.type==CKEDITOR.NODE_ELEMENT};range=iterator.getNextRange();){range.collapsed||range.enlarge(CKEDITOR.ENLARGE_ELEMENT);var currentNode,bookmark=range.createBookmark(),startNode=bookmark.startNode,endNode=bookmark.endNode,breakParent=function(node){for(var pathElement,path=editor.elementPath(node),pathElements=path.elements,i=1;(pathElement=pathElements[i])&&(!pathElement.equals(path.block)&&!pathElement.equals(path.blockLimit));i++)tagsRegex.test(pathElement.getName())&&filter(editor,pathElement)&&node.breakParent(pathElement)};if(breakParent(startNode),endNode)for(breakParent(endNode),currentNode=startNode.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);currentNode&&!currentNode.equals(endNode);)if(currentNode.isReadOnly()){if(currentNode.getPosition(endNode)&CKEDITOR.POSITION_CONTAINS)break;currentNode=currentNode.getNext(isElement)}else{var nextNode=currentNode.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),isFakeElement="img"==currentNode.getName()&&currentNode.data("cke-realelement");!isFakeElement&&filter(editor,currentNode)&&(tagsRegex.test(currentNode.getName())?currentNode.remove(1):(currentNode.removeAttributes(removeAttributes),editor.fire("removeFormatCleanup",currentNode))),currentNode=nextNode}range.moveToBookmark(bookmark)}editor.forceNextSelectionCheck(),editor.getSelection().selectRanges(ranges)}}},filter:function(editor,element){for(var filters=editor._.removeFormatFilters||[],i=0;i<filters.length;i++)if(!1===filters[i](element))return!1;return!0}},CKEDITOR.editor.prototype.addRemoveFormatFilter=function(func){this._.removeFormatFilters||(this._.removeFormatFilters=[]),this._.removeFormatFilters.push(func)},CKEDITOR.config.removeFormatTags="b,big,cite,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var",CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign";