define(["text"],function(text){function cacheBust(url){return url=url.replace(CACHE_BUST_FLAG,""),(url+=url.indexOf("?")<0?"?":"&")+CACHE_BUST_QUERY_PARAM+"="+Math.round(2147483647*Math.random())}var CACHE_BUST_QUERY_PARAM="bust",CACHE_BUST_FLAG="!bust",jsonParse="undefined"!=typeof JSON&&"function"==typeof JSON.parse?JSON.parse:function(val){return eval("("+val+")")},buildMap={};return{load:function(name,req,onLoad,config){config.isBuild&&(!1===config.inlineJSON||-1!==name.indexOf(CACHE_BUST_QUERY_PARAM+"="))||0===req.toUrl(name).indexOf("empty:")?onLoad(null):text.get(req.toUrl(name),function(data){var parsed;if(config.isBuild)buildMap[name]=data,onLoad(data);else{try{parsed=jsonParse(data)}catch(e){onLoad.error(e)}onLoad(parsed)}},onLoad.error,{accept:"application/json"})},normalize:function(name,normalize){return-1!==name.indexOf(CACHE_BUST_FLAG)&&(name=cacheBust(name)),normalize(name)},write:function(pluginName,moduleName,write){if(moduleName in buildMap){write('define("'+pluginName+"!"+moduleName+'", function(){ return '+buildMap[moduleName]+";});\n")}}}});