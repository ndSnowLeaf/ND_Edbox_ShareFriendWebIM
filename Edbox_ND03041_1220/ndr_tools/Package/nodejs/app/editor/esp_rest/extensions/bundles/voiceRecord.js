var voiceRecordEngine=require("./voiceRecord/voicerecordeginebridge"),path=require("path"),dllPath=path.resolve(__dirname,"./voiceRecord/VoiceRecordEngine.dll"),isRecording=!1,currentVoiceVolumn=null,startRecordCallback=null,stopRecordCallback=null,EventChannel=function(e,o){if(console.log("EventChannel",arguments),"VoiceMessage"===e){if(o){var c=JSON.parse(o);switch(c.msg){case"hasdevice":isRecording=!0,startRecordCallback&&startRecordCallback(0),startRecordCallback=null;break;case"nodevice":isRecording=!1,startRecordCallback&&startRecordCallback(-1),startRecordCallback=null;break;case"finish":isRecording=!1,stopRecordCallback&&stopRecordCallback(c.path),stopRecordCallback=null}}}else if("VoiceRecordState"===e&&o){var c=JSON.parse(o);switch(console.log(c),c.state){case"voicedb":currentVoiceVolumn=c.value}}},startVoiceRecord=function(e){voiceRecordEngine.init(dllPath,EventChannel),(startVoiceRecord=function(e){isRecording?e(-2):(startRecordCallback=e,currentVoiceVolumn=null,voiceRecordEngine.start(1e8))})(e)},getVoiceVolumn=function(e){isRecording?e(currentVoiceVolumn):e()},stopVoiceRecord=function(e){isRecording?(stopRecordCallback=e,voiceRecordEngine.stop()):e(-1)};process.on("exit",function(e,o,c){!!voiceRecordEngine&&!!voiceRecordEngine.exit&&voiceRecordEngine.exit()}),exports.startVoiceRecord=startVoiceRecord,exports.stopVoiceRecord=stopVoiceRecord,exports.getVoiceVolumn=getVoiceVolumn;