var FileSys=require("fs"),PathSys=require("path"),itemXMLParser;!function(e){function t(e,t,i){if(null===e||void 0===e)return e;for(var r=e,s=arguments,o=arguments.length,a=1;a<o;a+=2)r=r.replace(s[a],function(){return s[a+1]});return r}var i=function(){function e(){}function i(e,t){return"G"+(e+1)+"_"+parseInt(t+1)}function r(e){var t="";if(e)for(var i in e)t+=i+"='"+e[i]+"' ";return t}function s(e){var t=FileSys.readFileSync(PathSys.join(__dirname,"./tmpls/qti-item/"+e+".xml"));return t?t.toString():null}return e.prototype.generateOrder=function(e){for(var i=s("order"),o=s("order-item"),a="",n="",c=0;c<e.items.length;c++){var p="p"+(c+1);a+=t("<value>%s</value>","%s",p),n+=t(o,"${identifier}",p,"${text}",e.items[c].text)}var l="";switch(e.description.asset_type){case"image":l="<img src='"+e.description.asset+"' "+r(e.description.other)+"/>";break;case"audio":l="<audio src='"+e.description.asset+"' controls='controls'></audio>";break;case"video":l="<video src='"+e.description.asset+"' controls='controls'></video>"}return i=t(i,"${promptText}",e.description.text,"${promptMedia}",l,"${correctResponseValues}",a,"${simpleChoices}",n)},e.prototype.generateTable=function(e){for(var o,a=s("table"),n=s("table-text-item"),c=s("table-image-item"),p=s("table-content"),l=s("table-row"),m=s("table-row-col"),u="",d="",f="",h="",g=0;g<e.items.length;g++){var v=e.items[g],$="p"+(g+1),x=i(parseInt(v.vertical_index),parseInt(v.horizontal_index));u+=t("<value>%s</value>","%s",$+" "+x),"text"===v.content_type?d+=t(n,"${identifier}",$,"${text}",v.content):d+=t(c,"${identifier}",$,"${imageSrc}",v.content)}for(var w=e.horizontal_items.length,g=0;g<w;g++)f+="<td>"+e.horizontal_items[g]+"</td>";for(var S=e.vertical_items.length,y=0;y<S;y++){for(var _="",b="",M=0;M<w;M++){var x=i(y,M);b+=t(m,"${identifier}",x)}_=t(l,"${rowHeader}",e.vertical_items[y],"${columns}",b),h+=_}o=t(p,"${columnHeader}",f,"${rows}",h);var k="";switch(e.description.asset_type){case"image":k="<img src='"+e.description.asset+"' "+r(e.description.other)+"/>";break;case"audio":k="<audio src='"+e.description.asset+"' controls='controls'></audio>";break;case"video":k="<video src='"+e.description.asset+"' controls='controls'></video>"}return a=t(a,"${promptText}",e.description.text,"${promptMedia}",k,"${correctResponseValues}",u,"${gapTexts}",d,"${tableContent}",o)},e.prototype.generateLinkup=function(e){var i,r,o=s("linkup");"image2text"==e.module_subtype&&(i=s("linkup-image-item"),r=s("linkup-text-item")),"image2image"==e.module_subtype&&(i=s("linkup-image-item")),"text2text"==e.module_subtype&&(r=s("linkup-text-item"));for(var a="",n="",c="",p=0,l=0;l<e.items.length;l++){var m=e.items[l];"image"==m.source.item_type?a+=t(i,"${identifier}","p"+p,"${imageSrc}",m.source.href):(m.source.item_type="text")&&(a+=t(r,"${identifier}","p"+p,"${content}",m.source.text)),"image"==m.target.item_type?n+=t(i,"${identifier}","p"+(p+1),"${imageSrc}",m.target.href):(m.target.item_type="text")&&(n+=t(r,"${identifier}","p"+(p+1),"${content}",m.target.text)),c+="<value>p"+p+" p"+(p+1)+"</value>",p+=2}return t(o,"${correctResponse}",c,"${prompt}",e.title,"${leftSimpleMatchSet}",a,"${rightSimpleMatchSet}",n)},e.prototype.generateMemorycard=function(e){for(var i='<?xml version="1.0" encoding="utf-8"?><assessmentItem xmlns="http://www.imsglobal.org/xsd/imsqti_v2p1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" identifier="" title="记忆卡片" adaptive="false" timeDependent="false"     xsi:schemaLocation="http://www.imsglobal.org/xsd/imsqti_v2p1 http://www.imsglobal.org/xsd/imsqti_v2p1.xsd">     <responseDeclaration identifier="RESPONSE_1-1" cardinality="multiple" baseType="pair" sequence="1-1">         <correctResponse>             ${correctResponseValues}         </correctResponse>     </responseDeclaration>     <outcomeDeclaration identifier="SCORE" cardinality="single" baseType="float">         <defaultValue>             <value>0.0</value>         </defaultValue>     </outcomeDeclaration>     <itemBody>         <matchInteraction responseIdentifier="RESPONSE_1-1" questionType="match" shuffle="true" maxAssociations="3">             <prompt>                 <p>${promptText}</p>             </prompt>             <simpleMatchSet>                 ${simpleMatchSetSource}             </simpleMatchSet>             <simpleMatchSet>                 ${simpleMatchSetTarget}             </simpleMatchSet>         </matchInteraction>     </itemBody>     <responseProcessing template="http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct"/>     <modalFeedback showHide="show" outcomeIdentifier="FEEDBACK" identifier="showHint" sequence="1"/>     <modalFeedback showHide="show" outcomeIdentifier="FEEDBACK" identifier="showAnswer" sequence="1"/></assessmentItem>',r='<simpleAssociableChoice identifier="${identifier}" fixed="false" matchMax="1"><p>${text}</p></simpleAssociableChoice>',s="",o="",a="",n=0,c=0;c<e.items.length;c++){var p=e.items[c],l="p"+n;n++;var m="P"+n;n++,s+=t("<value>%s</value>","%s",l+" "+m),o+=t(r,"${identifier}",l,"${text}",p.source.text),a+=t(r,"${identifier}",m,"${text}",p.target.text)}return i=t(i,"${promptText}",e.title,"${correctResponseValues}",s,"${simpleMatchSetSource}",o,"${simpleMatchSetTarget}",a)},e}();e.Parser=i}(itemXMLParser=exports.itemXMLParser||(exports.itemXMLParser={}));