function decipher(e){var n=crypto.createDecipher("aes-256-cbc","c1*h2-i0+v6&o7!x8"),a=n.update(e,"hex","utf8");return a+=n.final("utf8")}var nodeUuid=require("node-uuid"),path=require("path"),crypto=require("crypto"),config={appKey:"ed0e0aefe155246afc40c4afece9302043988ab3320d0e6a4591f217e7985dad",secretKey:"add3c95e96b331925522c1ac75bfa86035503f481c97c71e4d87017b6cb270e7283f53c2149e52c5932185ade1b460d1",provisionFile:path.resolve(__dirname,"aiengine/aiengine.provision").replace(/\\/g,"/"),dllFile:path.resolve(__dirname,"aiengine/aiengine.dll")},aiEngineBridge=null;try{aiEngineBridge=require("./aiengine/aienginebridge")}catch(e){}process.on("exit",function(e,n,a){!!aiEngineBridge&&!!aiEngineBridge.close&&aiEngineBridge.close()});var SynthesisQueueManager={queue:{},push:function(e,n){var a=nodeUuid.v4();this.queue[a]={params:e,callback:n}},pop:function(){var e=this.queue;for(var n in e)if(e.hasOwnProperty(n)){var a=e[n];delete e[n],doSynthesis(a.params,a.callback);break}}},getTone=function(e,n){var a;if("en"===e)switch(n){case"M1":a="syn.ensnt.liuyim";break;case"M2":a="syn.ensnt.acawbm";break;case"W1":a="syn.ensnt.shirlf";break;case"W2":a="syn.ensnt.wysbrf";break;default:a="syn.ensnt.liuyim"}else switch(n){case"M1":case"M2":a="voices_anonym_male.0.2.8";break;case"W1":a="voices_anonyf_female.0.2.7";break;case"W2":a="voices_bcgirl_female.0.2.7";break;case"W3":a="voices_xyshenf_female.0.2.7";break;case"W4":a="voices_zhilingf_female.0.2.8";break;default:a="voices_anonyf_female.0.2.7"}return a},doSynthesis=function(e,n){var a=aiEngineBridge.open(config.dllFile),i=JSON.parse(a).result;if(0!=i&&-100!=i)throw"Synthesis Error::Open";aiEngineBridge.setting(decipher(config.appKey),decipher(config.secretKey),config.provisionFile),(exports.doSynthesis=doSynthesis=function(e,n){var a={coreProvideType:"cloud",app:{userId:"chivox_demo"},audio:{audioType:"mp3",sampleRate:16e3,channel:1,sampleBytes:2},request:{coreType:"cn.syn.sent",res:"voices_anonyf_female.0.2.7",refText:e.text,speechRate:"1.0"}};"en"===e.lang&&(a.request.coreType="en.syn.sent",a.request.res=getTone(e.lang,e.tone));var i=aiEngineBridge.task(JSON.stringify(a),e.audioPath,function(e){n&&n(e),SynthesisQueueManager.pop()});switch(JSON.parse(i).result){case 0:break;case-1001:SynthesisQueueManager.push.apply(SynthesisQueueManager,arguments);break;case-1002:case-1003:n&&n()}})(e,n)};exports.synthesis=function(e,n,a){doSynthesis({text:e,audioPath:n},a)},exports.synthesisV2=function(e,n){doSynthesis(e,n)};