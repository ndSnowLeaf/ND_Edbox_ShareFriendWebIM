"use strict";var TOKEN=/([!#\$%&'\*\+\-\.\^_`\|~0-9a-z]+)/,NOTOKEN=/([^!#\$%&'\*\+\-\.\^_`\|~0-9a-z])/g,QUOTED=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"])*)"/,PARAM=new RegExp(TOKEN.source+"(?:=(?:"+TOKEN.source+"|"+QUOTED.source+"))?"),EXT=new RegExp(TOKEN.source+"(?: *; *"+PARAM.source+")*","g"),EXT_LIST=new RegExp("^"+EXT.source+"(?: *, *"+EXT.source+")*$"),NUMBER=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,Parser={parseHeader:function(e){var r=new Offers;if(""===e||void 0===e)return r;if(!EXT_LIST.test(e))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(EXT).forEach(function(e){var t=e.match(new RegExp(PARAM.source,"g")),s=t.shift(),n={};t.forEach(function(e){var r,t=e.match(PARAM),s=t[1];r=void 0!==t[2]?t[2]:void 0===t[3]||t[3].replace(/\\/g,""),NUMBER.test(r)&&(r=parseFloat(r)),n.hasOwnProperty(s)?(n[s]=[].concat(n[s]),n[s].push(r)):n[s]=r},this),r.push(s,n)},this),r},serializeParams:function(e,r){var t=[],s=function(e,r){r instanceof Array?r.forEach(function(r){s(e,r)}):!0===r?t.push(e):"number"==typeof r?t.push(e+"="+r):NOTOKEN.test(r)?t.push(e+'="'+r.replace(/"/g,'\\"')+'"'):t.push(e+"="+r)};for(var n in r)s(n,r[n]);return[e].concat(t).join("; ")}},Offers=function(){this._byName={},this._inOrder=[]};Offers.prototype.push=function(e,r){this._byName[e]=this._byName[e]||[],this._byName[e].push(r),this._inOrder.push({name:e,params:r})},Offers.prototype.eachOffer=function(e,r){for(var t=this._inOrder,s=0,n=t.length;s<n;s++)e.call(r,t[s].name,t[s].params)},Offers.prototype.byName=function(e){return this._byName[e]||[]},Offers.prototype.toArray=function(){return this._inOrder.slice()},module.exports=Parser;