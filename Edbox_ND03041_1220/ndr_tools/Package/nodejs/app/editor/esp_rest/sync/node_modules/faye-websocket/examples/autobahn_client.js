var WebSocket=require("..").Client,deflate=require("permessage-deflate"),pace=require("pace"),host="ws://localhost:9001",agent=encodeURIComponent("node-"+process.version),cases=0,options={extensions:[deflate]},socket=new WebSocket(host+"/getCaseCount"),url,progress;socket.onmessage=function(e){console.log("Total cases to run: "+e.data),cases=parseInt(e.data),progress=pace(cases)};var runCase=function(e){if(e>cases)return url=host+"/updateReports?agent="+agent,socket=new WebSocket(url),void(socket.onclose=process.exit);url=host+"/runCase?case="+e+"&agent="+agent,socket=new WebSocket(url,[],options),socket.pipe(socket),socket.on("close",function(){progress.op(),runCase(e+1)})};socket.onclose=function(){runCase(1)};