var REF_BASE="${ref-base}",REF_PATH="${ref-path}",Path=require("path"),uuid=require("node-uuid"),CoursewareObjectContextCreator=require("./../../support/CoursewareObjectContext"),root=CoursewareObjectContextCreator.root,BaseQuestionDefaultPath=Path.join(root,"questions"),InteractQuestionDefaultPath=Path.join(root,"interaction"),PathManager=function(t,e,a){this.type=a,this.id=t,this.basepath=e||(this.isBasicQuestion()?BaseQuestionDefaultPath:InteractQuestionDefaultPath),this.default=!e};PathManager.prototype.toUrl=function(){},PathManager.prototype.isBasicQuestion=function(){return"interaction"!=this.type},PathManager.prototype.isDefault=function(){return this.default},PathManager.prototype.getFilePath=function(t){return t?Path.join(this.basepath,this.id+".pkg",t):Path.join(this.basepath,this.id+".pkg")},PathManager.prototype.getRefPath=function(t){var e=t?Path.join(REF_BASE,t):Path.join(REF_BASE);return e=e.replace(/\\/g,"/")},PathManager.prototype.getRefFullPath=function(t){var e=this.isBasicQuestion()?"questions":"interaction",a=t?Path.join(REF_PATH,"edu/esp/",e,this.id+".pkg",t):Path.join(REF_PATH,"edu/esp/",e,this.id+".pkg");return a=a.replace(/\\/g,"/")},PathManager.prototype.extraInfoUrl=function(){var t="";return this.isDefault()||(t=t+"&question_base="+encodeURIComponent(this.basepath)),t=t+"&main_type="+(this.type||"")},PathManager.prototype.toProxy=function(t,e,a){return"/v1.3/assets/proxy?"+this.extraInfoUrl()+"&question_id="+this.id+"&filepath="+encodeURIComponent(t)+"&url="+encodeURIComponent(e)+"&assetType="+a+"&end=true"},PathManager.prototype.toGetUrl=function(t,e,a){var r=this.extraInfoUrl();return"/v1.3/assets/get?question_id="+this.id+r+"&filepath="},PathManager.prototype.urlJoin=function(t,e){return Path.join(t,e).replace(/\\/g,"/")},exports.create=function(t,e,a){var r=a;r||(r=t.param("identifier")),r||(r=t.params.id),r||(r=uuid.v4()),e||(e=t.param("main_type"))||(e="basic");var n=t.param("question_base");if(!n){var i=t.param("file_path");i&&(n=Path.dirname(i))}return n&&n.lastIndexOf("/")!=n.length-1&&(n+="/"),new PathManager(r,n,e)},exports.PathManager=PathManager;