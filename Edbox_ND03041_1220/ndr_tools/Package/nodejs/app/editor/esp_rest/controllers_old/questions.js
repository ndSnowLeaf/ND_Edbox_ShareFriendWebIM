function getParamValue(e){return void 0!=e&&null!=e?e:""}function loadTemplate(e){if(templateFiles[e])return templateFiles[e];var r=fs.readFileSync("app/questions/template/"+e,"utf-8");return templateFiles[e]=r,r}function replaceByParams(e,r){for(var t in r)for(var i=r[t],a=e.replace("{{"+t+"}}",i);a!=e;)e=a,a=e.replace("{{"+t+"}}",i);return e}function saveToFile(e,r){var t=Q.defer(),i=path.dirname(e);return checkDir(i,function(i){fs.writeFile(e,r,function(e){e?t.reject(e):t.resolve()})}),t.promise}function formatDate(e){return 1900+e.getYear()+""+(1+e.getMonth())+e.getDate()+e.getHours()+e.getMinutes()+e.getSeconds()}function isHandwrite(e){if(e.items)for(var r=0;r<e.items.length;r++){var t=e.items[r];if("handwrite"===t.type)return!0}return!1}var path=require("path"),asset=require("./assets"),refpathreplacer=require("./question_tools/refpath_replacer"),templates=require("./questions.template"),uuid=require("node-uuid"),openapi=require("./../common/openapi"),imageSplitter=require("./../common/ImageSplitter"),fs=require("fs"),Q=require("q"),ncp=require("ncp").ncp,pathHelper=require("./question_tools/question_path_helper"),PathManagerCreator=require("./question_tools/PathManager"),QuestionUtils=require("./question_tools/QuestionUtils"),checkDir=function(e,r){return QuestionUtils.checkDir(e,r)},mkdir=function(e,r){return QuestionUtils.mkdir(e,r)},createParam={question_type:{type:String,required:!0},id:{type:String,required:!1}},templateFiles={};exports.qtiplayer=function(e,r,t){var i="&hidePage=toolbar&hidePage=footer",a=e.params.id,n=PathManagerCreator.create(e,null,a);if(!n.default){var u=n.getFilePath(),o=new Buffer(u).toString("base64"),s=encodeURIComponent("/v1.3/assets/proxy3/"+o+"/main.xml");return r.send({url:"/player/index.html?main="+s+i})}return r.send({url:"/player/index.html?main="+n.getRefFullPath("main.xml").replace("${ref-path}","/userdatas")+i})};var checkFile=function(e,r,t,i){var a=Q.defer();return asset.check_proxy(e,r,t,i,function(){a.resolve()}),a.promise};