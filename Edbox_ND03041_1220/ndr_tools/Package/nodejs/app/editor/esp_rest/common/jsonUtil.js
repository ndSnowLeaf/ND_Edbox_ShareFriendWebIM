var _=require("lodash"),util=require("./util"),LogicError=require("./errors").LogicError,$i18n=require("../support/i18n").i18n,nodetypes=require("./nodetypes"),SubItemSchemaSample={param_string:{type:String},param_number:{type:Number,sourceName:"i"}},ParamSchemaSample={param_string:{type:String,sourceName:"ParamString"},param_number:{type:Number},param_float:{type:nodetypes.Float},param_date:{type:Date},param_boolean:{type:Boolean},param_array:{type:Array,itemType:SubItemSchemaSample}},JsonUtil=function(){};JsonUtil.prototype.isBaseType=function(e){switch(e){case String:case Number:case nodetypes.Float:case Date:case Boolean:return!0;default:return!1}},JsonUtil.prototype.getBaseTypeDefaultValue=function(e){switch(e){case String:return"";case Number:case nodetypes.Float:return 0;case Date:return new Date(0);case Boolean:return!1;default:throw new LogicError("getBaseTypeDefaultValue - type [{0}] was not supported.".format(e),5e5)}},JsonUtil.prototype.getBaseTypeValue=function(e,r,t,a,o){if(a&&util.isNullOrEmpty(r))throw new LogicError($i18n("server.error.json.format").format(e),400023);if(util.isNullOrEmpty(r))return o||this.getBaseTypeDefaultValue(t);switch(t){case Number:r=parseInt(r),r=isNaN(r)?o||this.getBaseTypeDefaultValue(t):r;break;case nodetypes.Float:r=parseFloat(r),r=isNaN(r)?o||this.getBaseTypeDefaultValue(t):r;break;case Boolean:r="1"==r.toString()||"true"==r.toString().toLowerCase()}return r},JsonUtil.prototype.getItemValue=function(e,r,t,a){var o;if(t)return t(e,a);if(this.isBaseType(r))o=this.getBaseTypeValue(null,e,r);else{o={};for(var n in r){var s=r[n],u=s.sourceName||n;this.isBaseType(s.type)?o[n]=this.getBaseTypeValue(u,e[u],s.type,s.required,s.defaultValue):s.type==Array&&(o[n]=this.getArray(e[u],s.itemType,s.convertor))}}return o},JsonUtil.prototype.getArray=function(e,r,t){var a=[],o=0;for(var n in e)a.push(this.getItemValue(e[n],r,t,o++));return a};var copy=function(e,r){var t=new JsonUtil,a={};if(!e)return e;for(var o in r){var n=r[o],s=n.sourceName||o;t.isBaseType(n.type)?a[o]=t.getBaseTypeValue(s,e[s],n.type,n.required,n.defaultValue):n.type==Array?a[o]=t.getArray(e[s],n.itemType,n.convertor):a[o]=t.getItemValue(e[s],n.itemType)}return a},copyArray=function(e,r){var t=[];if(!e)return e;for(var a=0;a<e.length;a++)t.push(copy(e[a],r));return t},clone=function(e){return e?_.clone(e,!0):e};exports.copy=copy,exports.copyArray=copyArray,exports.clone=clone;