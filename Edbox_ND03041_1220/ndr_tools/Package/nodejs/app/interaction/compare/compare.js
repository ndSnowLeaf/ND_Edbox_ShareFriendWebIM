define("compare/directive/compare.directive",["components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","components/site-directive/select-skin/select-skin","components/site-directive/error-tip/error-tip"],function(){}),define(["app","compare/directive/compare.directive"],function(app){"use strict";app.controller("compare_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","$rootScope","$filter",function($scope,skin_service,$stateParams,CustomEditorService,$rootScope,$filter){$scope.errorModel={},$scope.optionItems=[],$scope.model={id:"",title:"",skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/compare/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/compare/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},items:[{key:(new Date).valueOf(),first:"",second:"",correct:"",map:"",isAdd:!0,isShow:!1,addText:$filter("translate")("compare.addItem.true"),delText:$filter("translate")("compare.addItem.false")}],symbolMap:[{symbol:"＜",map:"lt"},{symbol:"＞",map:"gt"},{symbol:"≤",map:"lteq"},{symbol:"≥",map:"gteq"},{symbol:"＝",map:"eq"},{symbol:"≈",map:"abeq"}]},$rootScope.moduleScope=$scope,$scope.defaultTitleSetting={isCleared:!1,title:$filter("translate")("compare.default.title")},$scope.model.title=$scope.defaultTitleSetting.title;var loadingData=function(id){CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?(angular.extend($scope.model,$scope.decodeCompare(rtnData)),$scope.model.interaction_hints=rtnData.interaction_hints):$scope.model.id=rtnData.id,$scope.errorModel.errorText="",skin_service.set_skin_by_code($scope.model.skin.code,"v1")):$scope.errorModel.errorText=$filter("translate")("linkup.unvalidno")},function(){$scope.errorModel.errorText=$filter("translate")("linkup.get_title_error")})},getCorrect=function(map){var correct="";switch(map){case"lt":correct="＜";break;case"gt":correct="＞";break;case"lteq":correct="≤";break;case"gteq":correct="≥";break;case"eq":correct="＝";break;case"abeq":correct="≈"}return correct};$stateParams.id?loadingData($stateParams.id):skin_service.set_skin_by_code($scope.model.skin.code,"v1"),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.validPostData=function(){var modelData=$scope.model,items=modelData.items;if(""!=$.trim(modelData.title)){if(0==items.length)return $scope.errorModel.errorText=$filter("translate")("compare.unvalid.count"),!1;if(items.length>5)return $scope.errorModel.errorText=$filter("translate")("compare.unvalid.count"),!1;for(var i=0,len=items.length;i<len;i++){if(!items[i].first||!items[i].second)return $scope.errorModel.errorText=$filter("translate")("compare.unvalid.content"),!1;if(!items[i].correct)return $scope.errorModel.errorText=$filter("translate")("compare.unvalid.correct"),!1}return!0}$scope.errorModel.errorText=$filter("translate")("compare.notnull.desc")};var lastItem={};$scope.userInput=function(item,key,word){for(var len=0,temp="",i=0;i<word.length&&(len+=1,!(len>10));i++)temp+=word[i];item[key]=temp},$scope.selectThis=function(item,ct){item.correct=ct.symbol,item.map=ct.map},$scope.showChooseBox=function(item){item.isShow=!0},$scope.hideChooseBox=function(item){item.isShow=!1},$scope.addOrDel=function(item){var currentIsAdd=!0;if(item.isAdd){if($scope.model.items.length>=5)return $scope.errorModel.errorText=$filter("translate")("compare.unvalid.count"),!1;4===$scope.model.items.length&&(currentIsAdd=!1),item.isAdd=!1,$scope.model.items.push({key:(new Date).valueOf(),first:lastItem.first,second:lastItem.second,correct:lastItem.correct,map:lastItem.map,isAdd:currentIsAdd,isShow:!1,addText:$filter("translate")("compare.addItem.true"),delText:$filter("translate")("compare.addItem.false")}),lastItem={}}else{lastItem=item;for(var len=$scope.model.items.length,i=0;i<len;i++)if($scope.model.items[i].key===item.key){$scope.model.items.splice(i,1);break}len>1&&($scope.model.items[len-2].isAdd=!0)}},$scope.encodeCompare=function(model){var newModel={},newItems=[];return angular.forEach(model.items,function(v,k){var item={};item.left=window.customHtmlEncode(v.first),item.right=window.customHtmlEncode(v.second),item.symbol=v.map,newItems.push(item)}),newModel.id=model.id,newModel.skin=model.skin,newModel.title=window.customHtmlEncode(model.title),newModel.items=newItems,newModel.interaction_hints=model.interaction_hints,newModel},$scope.decodeCompare=function(model){var newModel={},items=[];newModel.id=model.id,newModel.title=window.customHtmlDecode(model.title),newModel.skin=model.skin,newModel.symbolMap=[{symbol:"＜",map:"lt"},{symbol:"＞",map:"gt"},{symbol:"≤",map:"lteq"},{symbol:"≥",map:"gteq"},{symbol:"＝",map:"eq"},{symbol:"≈",map:"abeq"}];var timestamp=(new Date).valueOf();angular.forEach(model.items,function(v,k){var item={};item.key=timestamp+"_"+k,item.first=window.customHtmlDecode(v.left),item.second=window.customHtmlDecode(v.right),item.map=v.symbol,item.correct=getCorrect(v.symbol),item.isAdd=!1,item.isShow=!1,item.addText=$filter("translate")("compare.addItem.true"),item.delText=$filter("translate")("compare.addItem.false"),items.push(item)});var len=items.length;return len&&len<5&&(items[len-1].isAdd=!0),newModel.timer={timer_type:"sequence",time_minute:"0",time_second:"0"},newModel.items=items,newModel}}])});