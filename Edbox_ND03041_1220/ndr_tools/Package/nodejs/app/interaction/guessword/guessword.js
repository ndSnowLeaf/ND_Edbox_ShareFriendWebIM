define("guessword/directive/multimedia-selection/multimedia-selection",["angularAMD"],function(angularAMD){angularAMD.directive("multimediaSelection",["$stateParams","$filter",function($stateParams,$filter){return{restrict:"EA",templateUrl:"interaction/guessword/directive/multimedia-selection/multimedia-selection.html",scope:{multimediaItem:"=multimediaItem",editable:"=isEditable"},controller:function($scope){$scope.multimediaItem&&$scope.multimediaItem.item_path&&($scope.ngItemHref=$filter("filterRefPath")($scope.multimediaItem.item_path)),$scope.deleteMultimediaItem=function(){$scope.multimediaItem.item_type="",$scope.multimediaItem.item_path="",$scope.multimediaItem.item_url="",$scope.multimediaItem.other={}},$scope.addAssets=function(asset_type){$scope.multimediaItem.asset_type=asset_type,$scope.multimediaItem.asset=$scope.multimediaItem.item_path,$scope.multimediaItem.item_type="image"==asset_type?"picture":asset_type,$scope.multimediaItem.item_url=$scope.multimediaItem.item_path,$scope.ngItemHref=$filter("filterRefPath")($scope.multimediaItem.item_path),"video"!=asset_type&&"audio"!=asset_type||($scope.multimediaItem.other={controls:"controls",preload:"false",style:"height:100%; width:100%;"})},$scope.resourceValidParam={imageType:["image/jpg","image/jpeg","image/webp","image/gif","image/png","image/bmp"],imageSize:1048576,videoType:"video/mp4",videoSize:5242880,audioType:["audio/mp3","audio/mpeg"],audioSize:1048576}}}}])}),define("guessword/directive/guessword.directive",["components/site-directive/assets-select/assets-select","components/site-directive/error-tip/error-tip","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","components/site-directive/image-transform/image-transform","guessword/directive/multimedia-selection/multimedia-selection","components/site-services/charset.service","components/site-services/utils.service"],function(){}),define(["app","guessword/directive/guessword.directive"],function(app){"use strict";app.controller("guessword_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","CharsetService","UtilsService","UserDataService","$rootScope","$filter","$timeout",function($scope,skin_service,$stateParams,CustomEditorService,CharsetService,UtilsService,UserDataService,$rootScope,$filter,$timeout){function stopMedia(){angular.forEach($(".guess_edite_box audio"),function(media){media.currentTime=0,media.pause()}),angular.forEach($(".guess_edite_box video"),function(media){media.currentTime=0,media.pause()})}function checkCurrentItemText(){var answerString=$scope.currentItem.answer_string;answerString=$scope.language==$scope.LANGUAGE.CHINESE?CharsetService.getChineses(answerString):CharsetService.getAlphabets(answerString).toLowerCase(),answerString.length>15&&(answerString=answerString.substring(0,15)),$scope.currentItem.answer_string=answerString}$scope.LANGUAGE={CHINESE:"chinese",ENGLISH:"english"},$scope.ITEM_TYPE={PICTURE:"picture",VIDEO:"video",AUDIO:"audio"},$scope.errorModel={},$scope.model={title:"",skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/guessword/wood/css/wood.css",name:$filter("translate")("guessword.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/guessword/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},items:[]},$rootScope.moduleScope=$scope,$scope.defaultTitleSetting={isCleared:!1,title:$filter("translate")("guessword.default.title")},$scope.model.title=$scope.defaultTitleSetting.title,$scope.MAX_SIZE=5,$scope.currentItem=null,$scope.currentItemIndex=0,$scope.language=$scope.LANGUAGE.CHINESE;var loadingData=function(id){$scope.isloadingData=!0,CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?($scope.model=$scope.decodeData(rtnData),skin_service.set_skin_by_code($scope.model.skin.code,"v1")):($scope.model.id=rtnData.id,skin_service.set_skin_by_code($scope.model.skin.code,"v1")),$scope.errorModel.errorText="",$scope.isloadingData=!1,setValues()):$scope.errorModel.errorText=$filter("translate")("guessword.unvalidno")},function(error){$scope.errorModel.errorText=$filter("translate")("guessword.get_title_error")})},setValues=function(){$.isArray($scope.model.items)&&$scope.model.items.length>0&&($scope.currentItem=$scope.model.items[0],$scope.language=$scope.currentItem.language)};$stateParams.id?loadingData($stateParams.id):(skin_service.set_skin_by_code($scope.model.skin.code,"v1"),setValues()),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.validPostData=function(){var modelData=$scope.model;if(""!=$.trim(modelData.title)){var isValid=!0;return 0==$scope.model.items.length?($scope.errorModel.errorText=$filter("translate")("guessword.no_words"),isValid=!1):angular.forEach($scope.model.items,function(item){return item.item_path?item.answer_string?void 0:($scope.errorModel.errorText=$filter("translate")("guessword.no_answer"),isValid=!1,!1):($scope.errorModel.errorText=$filter("translate")("guessword.no_sucai"),isValid=!1,!1)}),isValid}$scope.errorModel.errorText=$filter("translate")("guessword.no_title")};var CHAR_AMOUNT=32;$scope.encodeData=function(model){stopMedia();var newModel=angular.copy(model);newModel.title=window.customHtmlEncode(newModel.title),angular.forEach(newModel.items,function(item){item.correct_answer=[],item.word_sequence=[];for(var char,i=0;i<item.answer_string.length;i++)char=item.answer_string.charAt(i),item.correct_answer.push(char),item.word_sequence.push(char);if(item.language==$scope.LANGUAGE.CHINESE)for(var i=0;i<CHAR_AMOUNT-item.answer_string.length;i++)item.word_sequence.push(CharsetService.getRandomChineseChar());else for(var i=0;i<CHAR_AMOUNT-item.answer_string.length;i++)item.word_sequence.push(CharsetService.getRandomAlphabet().toLowerCase());UtilsService.shuffleArray(item.word_sequence,item.answer_string.length)});for(var other,option="",i=0;i<newModel.items.length;i++)if(option="",newModel.items[i]&&"picture"==newModel.items[i].item_type){if(other=newModel.items[i].other,newModel.items[i].other)for(var o in other)option=option+" "+o+"='"+other[o]+"'";newModel.items[i].item_url="<img src='"+newModel.items[i].item_path+"' "+option+"/>"}return newModel},$scope.decodeData=function(model){if($scope.model.id)return $scope.model;angular.forEach(model.items,function(item){$.isArray(item.correct_answer)&&(item.answer_string=item.correct_answer.join("")),item.asset_type="picture"==item.item_type?"image":item.item_type});var newModel=angular.copy(model);return newModel.title=window.customHtmlDecode(newModel.title),newModel.items.length>0&&($scope.currentItem=newModel.items[$scope.currentItemIndex]),newModel},$scope.addItem=function(){$scope.currentItem={item_path:"",item_type:"",language:$scope.language,image_extend:{rotate:"",resize:""}},$scope.model.items.push($scope.currentItem),$scope.currentItemIndex=$scope.model.items.length-1},$scope.removeItem=function(){if(null!=$scope.currentItem){var itemIndex=$.inArray($scope.currentItem,$scope.model.items);itemIndex>-1&&$scope.model.items.splice(itemIndex,1),$scope.model.items.length>itemIndex?$scope.currentItem=$scope.model.items[itemIndex]:$scope.model.items.length>0?($scope.currentItemIndex=$scope.model.items.length-1,$scope.currentItem=$scope.model.items[$scope.currentItemIndex]):($scope.currentItem=null,$scope.currentItemIndex=0)}},$scope.selectItem=function(item,itemIndex){stopMedia(),$scope.currentItem=item,$scope.currentItemIndex=itemIndex,$scope.language=item.language},$scope.changeOnTip=function(){$scope.currentItem.hint.length>30&&($scope.currentItem.hint=$scope.currentItem.hint.substring(0,30))},$scope.setLanguage=function(language,event){$scope.language=language,$scope.currentItem&&($scope.currentItem.language!=language&&($scope.currentItem.answer_string=""),$scope.currentItem.language=language)},$scope.changeOnAnswer=function(){$timeout(checkCurrentItemText,50)}}])});