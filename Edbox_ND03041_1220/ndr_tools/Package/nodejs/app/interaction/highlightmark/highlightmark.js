define("highlightmark/directive/highlightmark.directive",["components/site-directive/assets-select/assets-select","components/site-directive/edit-box/edit-box","components/site-directive/time-setting-box/time-setting-box","components/site-directive/time-box/time-box","components/site-directive/select-skin/select-skin","components/site-directive/save-buttons/save-buttons","components/site-directive/error-tip/error-tip"],function(){}),define(["app","highlightmark/directive/highlightmark.directive","css!highlightmark/assets/css/highlightmark"],function(app){"use strict";app.controller("highlightmark_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","UserDataService","$rootScope","$filter","$timeout",function($scope,skin_service,$stateParams,CustomEditorService,UserDataService,$rootScope,$filter,$timeout){function updateColors(modelIn){var selectedColor=[],comColor=[{name:COLOR_ENUM.RED,cValue:"#FF0000"},{name:COLOR_ENUM.BLUE,cValue:"#0099FF"},{name:COLOR_ENUM.GREEN,cValue:"#00CC66"},{name:COLOR_ENUM.ORANGE,cValue:"#FF8040"}];for(var i in modelIn.content.markers){var curMark=modelIn.content.markers[i];selectedColor.push(curMark.marker_color.cValue)}for(var j=0;j<comColor.length;j++)for(var k=0;k<selectedColor.length;k++)if(comColor[j].cValue==selectedColor[k]){comColor.splice(j,1),j-=1;break}$scope.colors=comColor}function getText(){return document.getElementById("highlightmark_text").value}function setText(textIn){document.getElementById("highlightmark_text").value=textIn}function HexToName(hex){var colorName;switch(hex){case"#FF0000":colorName=COLOR_ENUM.RED;break;case"#0099FF":colorName=COLOR_ENUM.BLUE;break;case"#00CC66":colorName=COLOR_ENUM.GREEN;break;default:colorName=COLOR_ENUM.ORANGE}return colorName}var curNum=1,MAX=2,oUl=document.querySelector("#highlightmark_ul"),COLOR_ENUM={RED:$filter("translate")("highlightmark.color.red"),BLUE:$filter("translate")("highlightmark.color.blue"),GREEN:$filter("translate")("highlightmark.color.green"),ORANGE:$filter("translate")("highlightmark.color.orange")};$scope.colors=[{name:COLOR_ENUM.RED,cValue:"#FF0000"},{name:COLOR_ENUM.BLUE,cValue:"#0099FF"},{name:COLOR_ENUM.GREEN,cValue:"#00CC66"},{name:COLOR_ENUM.ORANGE,cValue:"#FF8040"}],$scope.errorModel={},$scope.view={showAddBtn:!0,showDelBtn:!1},$scope.handle={},$scope.model={id:"",title:"",module_code:"nd_highlightmark",skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/compare/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/compare/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},content:{content:{title:"",author:"",text:[]},markers:[{marker_number:curNum,marker_title:"",marker_color:{},showOptions:!1,showHolder:!1}]},properties:[{name:"question_id",display_name:"题目ID",type:"string",value:"",is_localized:!1},{name:"question_url",display_name:"题目内容",type:"jsonFile",value:"",is_localized:!1}]};var loadingData=function(id){CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?$scope.model=$scope.decodeData(rtnData):$scope.model.id=rtnData.id,$scope.errorModel.errorText="",skin_service.set_skin_by_code($scope.model.skin.code)):$scope.errorModel.errorText=$filter("translate")("linkup.unvalidno")},function(){$scope.errorModel.errorText=$filter("translate")("linkup.get_title_error")})};$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.encodeData=function(model1){var model=angular.copy(model1),oText=getText(),aText=oText.split("\n");model.content.content.text=aText;for(var marker in model.content.markers)model.content.markers[marker].marker_color=model.content.markers[marker].marker_color.cValue,delete model.content.markers[marker].showOptions,delete model.content.markers[marker].showHolder;return model},$scope.decodeData=function(data){var model=angular.copy(data);angular.isArray(model.content.content.text)&&(model.content.content.text=model.content.content.text.join("\n")),setText(model.content.content.text);for(var i in model.content.markers){var color,marker=model.content.markers[i];marker.showOptions=!1,marker.marker_color&&(color=marker.marker_color,marker.marker_color={},marker.showHolder=!0,marker.marker_color.name=HexToName(color),marker.marker_color.cValue=color)}return curNum=model.content.markers.length,curNum<MAX?$scope.view.showAddBtn=!0:$scope.view.showAddBtn=!1,curNum>1&&($scope.view.showDelBtn=!0),updateColors(model),model},$scope.validPostData=function(){var modelData=$scope.model,descFlag=!0,colorFlag=!0;if(""==$.trim(modelData.title))return $scope.errorModel.errorText=$filter("translate")("highlightmark.no_title"),!1;for(var x in modelData.content.markers)""==$.trim(modelData.content.markers[x].marker_title)&&(descFlag=!1),""!=modelData.content.markers[x].marker_color&&"undefined"!=typeof modelData.content.markers[x].marker_color.cValue||(colorFlag=!1);return 0==colorFlag?($scope.errorModel.errorText=$filter("translate")("highlightmark.no_color"),!1):0==descFlag?($scope.errorModel.errorText=$filter("translate")("highlightmark.no_desc"),!1):""==modelData.content.content.title?($scope.errorModel.errorText=$filter("translate")("highlightmark.no_content_title"),!1):""==modelData.content.content.author?($scope.errorModel.errorText=$filter("translate")("highlightmark.no_content_author"),!1):""!=getText()||($scope.errorModel.errorText=$filter("translate")("highlightmark.no_content_text"),!1)},$stateParams.id?loadingData($stateParams.id):skin_service.set_skin_by_code($scope.model.skin.code),$scope.handle.checkLength=function(value){value.length>=50&&($scope.errorModel.errorText=$filter("translate")("highlightmark.title_max_length"))},$scope.change=function(test,colorc){colorc.marker_color.name=test.name,colorc.marker_color.cValue=test.cValue,colorc.showOptions=!1,colorc.showHolder=!0,updateColors($scope.model)},$scope.addDesc=function(){return curNum==MAX?($scope.errorModel.errorText=$filter("translate")("highlightmark.no_more"),!1):(curNum++,$scope.model.content.markers.length<3&&$scope.model.content.markers.push({marker_number:curNum,marker_title:"",marker_color:{},showOptions:!1,showHolder:!1}),curNum<MAX?$scope.view.showAddBtn=!0:$scope.view.showAddBtn=!1,void(curNum>1&&($scope.view.showDelBtn=!0)))},$scope.remove=function(e){if(curNum>1){var colorDesc,oLi=e.target.parentNode.parentNode.parentNode,index=$(oLi).index(),reColor=$scope.model.content.markers[index].marker_color;colorDesc=HexToName(reColor),$scope.colors.push({name:colorDesc,cValue:reColor}),$scope.model.content.markers.splice(index,1),curNum=$scope.model.content.markers.length,curNum<MAX&&($scope.view.showAddBtn=!0),1==curNum&&($scope.view.showDelBtn=!1);for(var i=index;i<curNum;i++)$scope.model.content.markers[i].marker_number--;oUl.removeChild(oLi),updateColors($scope.model)}else $scope.errorModel.errorText=$filter("translate")("highlightmark.one_at_least")},$timeout(function(){UserDataService.checkUserActivity(angular.element(".llk_toolbar .desprtion > a"))},100)}])});