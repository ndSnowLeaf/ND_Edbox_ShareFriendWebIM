function init(){ComicDialogue.init()}define("comicdialogue/utils",[],function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var reg=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;return String.prototype.colorHex=function(){var that=this;if(/^(rgb|RGB)/.test(that)){for(var aColor=that.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),strHex="#",i=0;i<aColor.length;i++){var hex=Number(aColor[i]).toString(16);"0"===hex&&(hex+=hex),strHex+=hex}return 7!==strHex.length&&(strHex=that),strHex}if(!reg.test(that))return that;var aNum=that.replace(/#/,"").split("");if(6===aNum.length)return that;if(3===aNum.length){for(var numHex="#",i=0;i<aNum.length;i+=1)numHex+=aNum[i]+aNum[i];return numHex}},{removeItemByValue:function(arr,value){if(arr.length>0){var tempIndex=arr.indexOf(value);tempIndex>-1&&arr.splice(tempIndex,1)}}}});var Toast=function(config){this.context=null==config.context?$("body"):config.context,this.message=config.message,this.time=null==config.time?3e3:config.time,this.left=config.left,this.top=config.top,this.init()},msgEntity;Toast.prototype={init:function(){$("#toastMessage").remove();var msgDIV=new Array;msgDIV.push('<div id="toastMessage">'),msgDIV.push("<span>"+this.message+"</span>"),msgDIV.push("</div>"),msgEntity=$(msgDIV.join("")).appendTo(this.context);var left=null==this.left?this.context.width()/2-msgEntity.find("span").width()/2:this.left,top=null==this.top?"20px":this.top;msgEntity.css({position:"absolute",top:top,"z-index":"99",left:left,"background-color":"black",color:"white","font-size":"18px",padding:"10px",margin:"10px"}),msgEntity.hide()},show:function(){msgEntity.fadeIn(this.time/2),msgEntity.fadeOut(this.time/2)}};var ComicDialogue={config:{minWidth:30,minHeight:45,tipButtom:15,topZindex:100,bottomZindex:2,editWidth:755,editHeight:555,containWidth:700,containHeight:600},CurrentTip:null,CurrentMouseObject:null,CurrentMouseType:"none",CurrentMode:"none",container:null,mouseStartPoint:null,allowAddTip:!0,scope:null,init:function(scope){ComicDialogue.container=$(".div_container"),ComicDialogue.scope=scope,$(".div_addtip").on("mousedown touchstart",function(e){ComicDialogue.addTip()}),$(".tip").each(function(index,dom){ComicDialogue.CurrentTip=$(this),ComicDialogue.setTipWidthHeight(),ComicDialogue.setTipTextArea(),ComicDialogue.setTipTextStyle(),ComicDialogue.drawTip($(this).find(".tip-bg"),$(this).attr("drawtype"),$(this).attr("drawcolor"))}),ComicDialogue.CurrentTip=null,$(document).on("mousedown touchstart",function(e){ComicDialogue.mouseDown(e)}).on("mousemove touchmove",function(e){ComicDialogue.mouseMove(e)}).on("mouseup touchend",function(e){ComicDialogue.mouseUp(e)}).on("dblclick doubletap",function(e){ComicDialogue.mouseDbClick(e)})},getTipParam:function(tip){return{tipType:tip.attr("drawtype")?parseInt(tip.attr("drawtype")):0,tipLeft:tip.attr("drawleft")?parseInt(tip.attr("drawleft")):0,tipTop:tip.attr("drawtop")?parseInt(tip.attr("drawtop")):0,tipWidth:tip.attr("drawwidth")?parseInt(tip.attr("drawwidth")):0,tipHeight:tip.attr("drawheight")?parseInt(tip.attr("drawheight")):0,tipColor:tip.attr("drawcolor")?tip.attr("drawcolor"):"#000000",textColor:tip.attr("fontcolor")?tip.attr("fontcolor"):"#000000",fontFamily:tip.attr("fontfamily")?tip.attr("fontfamily"):"宋体",fontSize:tip.attr("fontsize")?parseInt(tip.attr("fontsize")):14,textAlign:tip.attr("textalign")?tip.attr("textalign"):"center",diretion:tip.attr("textdiretion")?parseInt(tip.attr("textdiretion")):0,tipContext:tip.find(".text-input").html()}},getTipDialogues:function(){var dialogues=[];return $(".tip").each(function(){dialogues.push(ComicDialogue.getTipParam($(this)))}),dialogues},loadItem:function(item,scaleW,scaleH){item.tipLeft=item.tipLeft*scaleW+3,item.tipTop=(item.tipTop+5)*scaleH,item.tipWidth=item.tipWidth*scaleW,item.tipHeight=item.tipHeight*scaleH,ComicDialogue.CurrentTip=$('<div class="tip" onclick="ComicDialogue.setCurrentTip(this)"><canvas class="tip-bg"></canvas><div class="move-area"><div class="text-area"><div class="text-cell"><div class="text-input">'+item.tipContext+"</div></div></div></div></div>"),ComicDialogue.CurrentTip.attr("drawtype",item.tipType).attr("drawleft",item.tipLeft).attr("drawtop",item.tipTop).attr("drawcolor",item.tipColor).attr("drawwidth",item.tipWidth).attr("drawheight",item.tipHeight).attr("fontcolor",item.textColor).attr("textalign",item.tipAlign).attr("textdiretion",item.diretion).attr("fontsize",item.fontSize).attr("fontfamily",item.fontFamily),ComicDialogue.container.append(ComicDialogue.CurrentTip),ComicDialogue.setTipWidthHeight(),ComicDialogue.setTipTextArea(),ComicDialogue.setTipTextStyle(),ComicDialogue.drawTip(ComicDialogue.CurrentTip.find(".tip-bg"),ComicDialogue.CurrentTip.attr("drawtype"),ComicDialogue.CurrentTip.attr("drawcolor"))},setCurrentTip:function(dom){ComicDialogue.CurrentTip=$(dom),ComicDialogue.CurrentMouseObject=$(event.target)},addTip:function(){ComicDialogue.cancelSelect();var w=100,h=75,l=(ComicDialogue.container.width()-w)/2,t=(ComicDialogue.container.height()-h)/2,item={tipType:0,tipLeft:l,tipTop:t,tipColor:"#FFFFFF",tipWidth:100,tipHeight:75,textColor:"#000000",tipAlign:"center",diretion:0,fontSize:14,fontFamily:"宋体",tipContext:""};ComicDialogue.loadItem(item,1,1),ComicDialogue.showButton(),ComicDialogue.textTip(),ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues()},drawTip:function(cvs,type,color){switch(parseInt(type)){case 1:ComicDialogue.drawRectangle(cvs,color);break;case 2:ComicDialogue.drawRhombus(cvs,color);break;default:ComicDialogue.drawCircle(cvs,color)}},drawRectangle:function(cvs,bgColor){bgColor=bgColor?bgColor:"#FFFFFF";var borderColor="#FFFFFF"!=bgColor?bgColor:"#000000",w=cvs.width(),h=cvs.height();if(cvs[0].getContext){var ctx=cvs[0].getContext("2d");ctx.save(),ctx.clearRect(0,0,w,h),ctx.strokeStyle=borderColor;var b=ComicDialogue.config.tipButtom;ctx.lineWidth=2,ctx.roundRect(1,1,w-2,h-b,10,bgColor,borderColor),ctx.beginPath(),ctx.moveTo((w-10)/2,h-b),ctx.lineTo((w-10)/2+7,h-3),ctx.lineTo((w-10)/2+14,h-b),ctx.fillStyle=bgColor,ctx.fill(),ctx.stroke()}},drawCircle:function(cvs,bgColor){bgColor=bgColor?bgColor:"#FFFFFF";var borderColor="#FFFFFF"!=bgColor?bgColor:"#000000",w=cvs.width(),h=cvs.height();if(cvs[0].getContext){var ctx=cvs[0].getContext("2d");ctx.save(),ctx.clearRect(0,0,w,h),ctx.strokeStyle=borderColor;var b=ComicDialogue.config.tipButtom;ctx.lineWidth=2,ctx.ellipse(w/2,(h-b)/2,w/2-2,(h-b)/2-2,bgColor,borderColor),ctx.beginPath(),ctx.moveTo((w-10)/2,h-b-3),ctx.lineTo((w-10)/2+6,h-3),ctx.lineTo((w-10)/2+12,h-b-3),ctx.fillStyle=bgColor,ctx.fill(),ctx.stroke()}},drawRhombus:function(cvs,bgColor){bgColor=bgColor?bgColor:"#FFFFFF";var borderColor="#FFFFFF"!=bgColor?bgColor:"#000000",w=cvs.width(),h=cvs.height();if(cvs[0].getContext){var ctx=cvs[0].getContext("2d");ctx.save(),ctx.clearRect(0,0,w,h),ctx.strokeStyle=borderColor;var b=ComicDialogue.config.tipButtom,qx=Math.tan(15*Math.PI/180)*(h-b);ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(qx,1),ctx.lineTo(w-1,1),ctx.lineTo(w-qx,h-b),ctx.lineTo(1,h-b),ctx.closePath(),ctx.fillStyle=bgColor,ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.moveTo((w-qx-10)/2,h-b-1),ctx.lineTo((w-qx-10)/2+7,h-3),ctx.lineTo((w-qx-10)/2+14,h-b-1),ctx.fillStyle=bgColor,ctx.fill(),ctx.stroke()}},cancelSelect:function(){ComicDialogue.CurrentMode="none",null!=ComicDialogue.CurrentTip&&$(".tip").each(function(index,dom){ComicDialogue.CurrentTip=$(dom),$(dom).css("z-index",ComicDialogue.config.bottomZindex).removeAttr("status"),ComicDialogue.setTipIsEdit(!1),$(dom).find("._resize").hide(),$(dom).find(".btn-area").hide(),ComicDialogue.CurrentTip=null})},mouseDbClick:function(event){ComicDialogue.CurrentMouseObject=$(event.target),"edit"!=ComicDialogue.CurrentMode&&(ComicDialogue.CurrentMouseObject.hasClass("move-area")||ComicDialogue.CurrentMouseObject.hasClass("text-area")||ComicDialogue.CurrentMouseObject.hasClass("text-cell")||ComicDialogue.CurrentMouseObject.hasClass("text-input"))&&ComicDialogue.setTipIsEdit(!0)},mouseDown:function(e){if(ComicDialogue.CurrentMouseObject=$(e.target),!(ClientProxy&&ClientProxy.isClosest()||(ClientProxy&&ClientProxy.isOpen()&&ClientProxy.close(),ComicDialogue.CurrentMouseObject.hasClass("none")))){if(ComicDialogue.CurrentMouseObject.hasClass("btn-text"))return ComicDialogue.CurrentTip=ComicDialogue.CurrentMouseObject.closest(".tip"),void ComicDialogue.textTip();if(ComicDialogue.CurrentMouseObject.hasClass("btn-style"))return ComicDialogue.CurrentTip=ComicDialogue.CurrentMouseObject.closest(".tip"),void ComicDialogue.styleTip(e);if(ComicDialogue.CurrentMouseObject.hasClass("btn-delete"))return ComicDialogue.CurrentTip=ComicDialogue.CurrentMouseObject.closest(".tip"),void ComicDialogue.deleteTip();if(ComicDialogue.CurrentMouseObject.hasClass("_resize"))ComicDialogue.setTipIsEdit(!1),ComicDialogue.CurrentTip=ComicDialogue.CurrentMouseObject.closest(".tip"),ComicDialogue.CurrentMouseType="resize",ComicDialogue.mouseStartPoint=ComicDialogue.getPoint(e);else if(ComicDialogue.CurrentMouseObject.hasClass("move-area")||ComicDialogue.CurrentMouseObject.hasClass("text-area")||ComicDialogue.CurrentMouseObject.hasClass("text-cell")||ComicDialogue.CurrentMouseObject.hasClass("text-input")||ComicDialogue.CurrentMouseObject.hasClass("tip-bg")){if("move"!=ComicDialogue.CurrentMouseObject.closest(".tip").attr("status")&&ComicDialogue.cancelSelect(),"edit"==ComicDialogue.CurrentMode)return;ComicDialogue.CurrentTip=ComicDialogue.CurrentMouseObject.closest(".tip"),ComicDialogue.CurrentTip.css("z-index",ComicDialogue.config.topZindex).attr("status","move"),ComicDialogue.showButton(),ComicDialogue.CurrentMouseType="move",ComicDialogue.mouseStartPoint=ComicDialogue.getPoint(e)}else ComicDialogue.CurrentMouseType="none",ComicDialogue.cancelSelect()}},mouseMove:function(event){if("none"!=ComicDialogue.CurrentMouseType&&null!=ComicDialogue.CurrentTip)switch(ComicDialogue.CurrentMouseType){case"move":clearSlct();var start=ComicDialogue.mouseStartPoint,end=ComicDialogue.getPoint(event),maxLeft=$(".div_container").width()-ComicDialogue.CurrentTip.width(),maxTop=$(".div_container").height()-ComicDialogue.CurrentTip.height(),x=parseInt(start.left)+parseInt(end.x)-parseInt(start.x);x=x<0?0:x,x=x>maxLeft?maxLeft:x;var y=parseInt(start.top)+parseInt(end.y)-parseInt(start.y);y=y<0?0:y,y=y>maxTop?maxTop:y,ComicDialogue.CurrentTip.css("left",x+"px").attr("drawleft",x).css("top",y+"px").attr("drawtop",y),ComicDialogue.setButtonArea();break;case"resize":clearSlct();var start=ComicDialogue.mouseStartPoint,end=ComicDialogue.getPoint(event);ComicDialogue.resizeTip(start,end)}},mouseUp:function(event){ComicDialogue.CurrentMouseType="none",ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues()},resizeTip:function(start,end){var moveX=end.x-start.x,moveY=(start.left+moveX,end.y-start.y),left=(start.top+moveY,start.left+moveX),top=start.top+moveY,width=start.w-moveX,height=start.h-moveY,max={w:0,h:0},min={w:ComicDialogue.config.minWidth,h:ComicDialogue.config.minHeight};if(ComicDialogue.CurrentMouseObject.hasClass("_nw")){max.w=$(".div_container").width()+start.left,max.h=$(".div_container").height()+start.top,width=start.w-moveX,height=start.h-moveY;ComicDialogue.CurrentTip.find(".btn-area").height();left<0?(left=0,width=start.w+start.left):width<min.w&&(width=min.w,left=start.left+start.w-min.w),top<0?(top=0,height=start.h+start.top):height<min.h&&(height=min.h,top=start.top+start.h-min.h),ComicDialogue.CurrentTip.css("left",left+"px").css("width",width+"px").css("top",top+"px").css("height",height+"px")}else ComicDialogue.CurrentMouseObject.hasClass("_w")?(max.w=$(".div_container").width()+start.left,max.h=$(".div_container").height()+start.top,width=start.w-moveX,left<0?(left=0,width=start.w+start.left):width<min.w&&(width=min.w,left=start.left+start.w-min.w),ComicDialogue.CurrentTip.css("left",left+"px").css("width",width+"px")):ComicDialogue.CurrentMouseObject.hasClass("_sw")?(max.w=$(".div_container").width()+start.left,max.h=$(".div_container").height()-start.top,width=start.w-moveX,height=start.h+moveY,left<0?(left=0,width=start.w+start.left):width<min.w?(width=min.w,left=start.left+start.w-min.w):width>max.w&&(width=max.w,left=start.left+start.w-max.w),height<min.h?height=min.h:height>max.h&&(height=max.h),ComicDialogue.CurrentTip.css("left",left+"px").css("width",width+"px").css("height",height+"px")):ComicDialogue.CurrentMouseObject.hasClass("_s")?(max.h=$(".div_container").height()-start.top,height=start.h+moveY,height<min.h?height=min.h:height>max.h&&(height=max.h),ComicDialogue.CurrentTip.css("height",height+"px")):ComicDialogue.CurrentMouseObject.hasClass("_se")?(max.w=$(".div_container").width()-start.left,max.h=$(".div_container").height()-start.top,width=start.w+moveX,height=start.h+moveY,width<min.w?width=min.w:width>max.w&&(width=max.w),height<min.h?height=min.h:height>max.h&&(height=max.h),ComicDialogue.CurrentTip.css("width",width+"px").css("height",height+"px")):ComicDialogue.CurrentMouseObject.hasClass("_e")?(max.w=$(".div_container").width()-start.left,width=start.w+moveX,width<min.w?width=min.w:width>max.w&&(width=max.w),ComicDialogue.CurrentTip.css("width",width+"px")):ComicDialogue.CurrentMouseObject.hasClass("_ne")?(max.w=$(".div_container").width()-start.left,max.h=$(".div_container").height()+start.top,width=start.w+moveX,height=start.h-moveY,width<min.w?width=min.w:width>max.w&&(width=max.w),top<0?(top=0,height=start.h+start.top):height<min.h?(height=min.h,top=start.top+start.h-min.h):height>max.h&&(height=max.h,top=start.top+start.h-max.h),ComicDialogue.CurrentTip.css("top",top+"px").css("width",width+"px").css("height",height+"px")):ComicDialogue.CurrentMouseObject.hasClass("_n")&&(max.h=$(".div_container").height()+start.top,height=start.h-moveY,top<0?(top=0,height=start.h+start.top):height<min.h?(height=min.h,top=start.top+start.h-min.h):height>max.h&&(height=max.h,top=start.top+start.h-max.h),ComicDialogue.CurrentTip.css("top",top+"px").css("height",height+"px"));ComicDialogue.setTipTextArea(),ComicDialogue.setButtonArea(),ComicDialogue.CurrentTip.attr("drawwidth",ComicDialogue.CurrentTip.width()).attr("drawheight",ComicDialogue.CurrentTip.height()).attr("drawleft",ComicDialogue.CurrentTip.css("left").replace("px","")).attr("drawtop",ComicDialogue.CurrentTip.css("top").replace("px",""));var cvs=ComicDialogue.CurrentTip.find("canvas").attr("width",ComicDialogue.CurrentTip.width()).attr("height",ComicDialogue.CurrentTip.height());ComicDialogue.drawTip(cvs,ComicDialogue.CurrentTip.attr("drawtype"),ComicDialogue.CurrentTip.attr("drawcolor"))},setTipWidthHeight:function(){var width=parseInt(ComicDialogue.CurrentTip.attr("drawwidth"));ComicDialogue.CurrentTip.width(width>0?width:100);var height=parseInt(ComicDialogue.CurrentTip.attr("drawheight"));ComicDialogue.CurrentTip.height(height>0?height:75);var left=parseInt(ComicDialogue.CurrentTip.attr("drawleft"));ComicDialogue.CurrentTip.css("left",left>0?left+"px":"0px");var top=parseInt(ComicDialogue.CurrentTip.attr("drawtop"));ComicDialogue.CurrentTip.css("top",top>0?top+"px":"0px"),ComicDialogue.CurrentTip.find("canvas").attr("width",ComicDialogue.CurrentTip.width()).attr("height",ComicDialogue.CurrentTip.height()),ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues()},setTipIsEdit:function(edit){if(edit){ComicDialogue.CurrentMode="edit",ComicDialogue.CurrentMouseType="none",ComicDialogue.CurrentTip.find(".text-input").css("cursor","text").attr("contenteditable","true");var editor=ComicDialogue.CurrentTip.find(".text-input")[0];window.setTimeout(function(){var sel,range;window.getSelection&&document.createRange?(range=document.createRange(),range.selectNodeContents(editor),range.collapse(!0),range.setEnd(editor,editor.childNodes.length),range.setStart(editor,editor.childNodes.length),sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(range)):document.body.createTextRange&&(range=document.body.createTextRange(),range.moveToElementText(editor),range.collapse(!0),range.select())},1)}else ComicDialogue.replaceHtml(),ComicDialogue.CurrentTip.find(".text-input").attr("contenteditable","false").css("cursor","move")},replaceHtml:function(){if(null!=ComicDialogue.CurrentTip){var input=ComicDialogue.CurrentTip.find(".text-input"),html=input.html();html=html.replace(/<div>/g,"").replace(/<\/div>/g,"<br />"),input.html(html)}},setTipTextArea:function(){var w=ComicDialogue.CurrentTip.width(),h=ComicDialogue.CurrentTip.height();switch(parseInt(ComicDialogue.CurrentTip.attr("drawtype"))){case 1:ComicDialogue.CurrentTip.find(".text-area").css("width",w-20+"px").css("height",h-35+"px").css("top","10px").css("left","10px"),ComicDialogue.CurrentTip.find(".text-input").css("max-height",h-35).css("max-width",w-20);break;case 2:var b=ComicDialogue.config.tipButtom,x=parseInt(Math.tan(15*Math.PI/180)*(h-b));ComicDialogue.CurrentTip.find(".text-area").css("width",w-2*x-2+"px").css("height",h-30+"px").css("top","10px").css("left",x+2+"px"),ComicDialogue.CurrentTip.find(".text-input").css("max-height",h-30).css("max-width",w-2*x-2);break;default:h-=15;var x=parseInt(w*Math.cos(Math.atan(h/w)))-5,y=parseInt(h*Math.sin(Math.atan(h/w)));ComicDialogue.CurrentTip.find(".text-area").css("width",x-3+"px").css("height",y+"px").css("left",parseInt((w-x)/2)+2+"px").css("top",parseInt((h-y)/2)+"px"),ComicDialogue.CurrentTip.find(".text-input").css("max-height",y).css("max-width",x-3)}ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues()},setTipTextStyle:function(){var color=ComicDialogue.CurrentTip.attr("fontcolor"),family=ComicDialogue.CurrentTip.attr("fontfamily"),size=ComicDialogue.CurrentTip.attr("fontsize"),align=ComicDialogue.CurrentTip.attr("textalign")?ComicDialogue.CurrentTip.attr("textalign"):"center",diretion=ComicDialogue.CurrentTip.attr("textdiretion");ComicDialogue.CurrentTip.find(".text-input").css("color",color?color:"#000000").css("font-family",family?family:"宋体").css("font-size",(size?size:16)+"px").css("text-align",align),"1"==diretion?ComicDialogue.CurrentTip.find(".text-area").addClass("diretion-y-r"):ComicDialogue.CurrentTip.find(".text-area").removeClass("diretion-y-r"),ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues()},setButtonArea:function(){var btn=ComicDialogue.CurrentTip.find(".btn-area"),l=0,w=btn.width();if(ComicDialogue.CurrentTip.width()>w)l=(ComicDialogue.CurrentTip.width()-w)/2;else{var leave=$(".div_container").width()-parseInt(ComicDialogue.CurrentTip.css("left").replace("px",""))-ComicDialogue.CurrentTip.width();leave<w-ComicDialogue.CurrentTip.width()&&(l=ComicDialogue.CurrentTip.width()-w-2)}btn.css("left",l+"px");var topH=30,top=parseInt(ComicDialogue.CurrentTip.css("top").replace("px",""));top<topH?btn.removeClass("area-t").removeClass("area-b").addClass("area-b"):btn.removeClass("area-t").removeClass("area-b").addClass("area-t")},textTip:function(){ComicDialogue.CurrentTip.find("._btn").removeClass("active"),ComicDialogue.CurrentTip.find(".btn-text").addClass("active"),ComicDialogue.setTipIsEdit(!0)},styleTip:function(e){ComicDialogue.CurrentTip.find("._btn").removeClass("active"),ComicDialogue.CurrentTip.find(".btn-style").addClass("active"),ComicDialogue.CurrentMode="style",ComicDialogue.CurrentMouseType="none",ComicDialogue.setTipIsEdit(!1);var param=ComicDialogue.getTipParam(ComicDialogue.CurrentTip);param.left=ComicDialogue.CurrentTip.width()+parseInt(ComicDialogue.CurrentTip.css("left").replace("px",""))+$(".div_container").offset().left+5,param.top=parseInt(ComicDialogue.CurrentTip.css("top").replace("px",""))+$(".div_container").offset().top,ClientProxy.open(param,e),ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues()},deleteTip:function(){ComicDialogue.CurrentTip.find(".btn-area").removeClass("active"),ComicDialogue.CurrentTip.find(".btn-delete").addClass("active"),ComicDialogue.CurrentTip.remove(),ComicDialogue.CurrentTip=null,ComicDialogue.CurrentMode="none",ComicDialogue.CurrentMouseType="none"},showButton:function(){ComicDialogue.CurrentTip.css("z-index",ComicDialogue.config.topZindex).attr("status","move"),0==ComicDialogue.CurrentTip.find("._resize").length?ComicDialogue.CurrentTip.find(".move-area").css("border-width","1px").append($('<span class="_resize _nw"></span><span class="_resize _w"></span><span class="_resize _sw"></span><span class="_resize _s"></span><span class="_resize _se"></span><span class="_resize _e"></span><span class="_resize _ne"></span><span class="_resize _n"></span>')):ComicDialogue.CurrentTip.find("._resize").show(),0==ComicDialogue.CurrentTip.find(".btn-area").length?ComicDialogue.CurrentTip.find(".move-area").append($('<div class="btn-area"><span class="_btn btn-text">文字</span><span class="_btn btn-style">样式</span><span class="_btn btn-delete">删除</span></span>')):(ComicDialogue.CurrentTip.find(".btn-area").show(),ComicDialogue.CurrentTip.find(".btn-area").removeClass("active")),ComicDialogue.setButtonArea()},getPoint:function(ev){var x=parseInt(ev.pageX),y=parseInt(ev.pageY);ev.type.indexOf("touch")>=0&&ev.originalEvent&&ev.originalEvent.touches&&ev.originalEvent.touches.length>0&&(x=parseInt(ev.originalEvent.touches[0].pageX),y=parseInt(ev.originalEvent.touches[0].pageY));var top=parseInt(ComicDialogue.CurrentTip.css("top").replace("px","")),left=parseInt(ComicDialogue.CurrentTip.css("left").replace("px","")),w=parseInt(ComicDialogue.CurrentTip.width()),h=parseInt(ComicDialogue.CurrentTip.height());return{x:x,y:y,top:top,left:left,w:w,h:h}},setTipStyle:function(param){null!=ComicDialogue.CurrentTip&&(ComicDialogue.CurrentTip.attr("drawtype",param.tipType),ComicDialogue.CurrentTip.attr("drawcolor",param.tipColor),ComicDialogue.drawTip(ComicDialogue.CurrentTip.find(".tip-bg"),param.tipType,param.tipColor),ComicDialogue.setTipTextArea(),ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues())},setTipText:function(param){null!=ComicDialogue.CurrentTip&&(ComicDialogue.CurrentTip.attr("fontcolor",param.textColor),ComicDialogue.CurrentTip.attr("fontfamily",param.fontFamily),ComicDialogue.CurrentTip.attr("fontsize",param.fontSize),ComicDialogue.CurrentTip.attr("textalign",param.textAlign),ComicDialogue.CurrentTip.attr("textdiretion",param.diretion),ComicDialogue.setTipTextStyle(),ComicDialogue.scope.model.content.dialogues=ComicDialogue.getTipDialogues())}},clearSlct="getSelection"in window?function(){window.getSelection().removeAllRanges()}:function(){document.selection.empty()};CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r,bgColor,borderColor){return this.beginPath(),this.moveTo(x+r,y),this.arcTo(x+w,y,x+w,y+h,r),this.arcTo(x+w,y+h,x,y+h,r),this.arcTo(x,y+h,x,y,r),this.arcTo(x,y,x+w,y,r),this.closePath(),this.fillStyle=bgColor,this.fill(),this.strokeStyle=borderColor,this.stroke(),this},CanvasRenderingContext2D.prototype.ellipse=function(x,y,a,b,bgColor,borderColor){var step=a>b?1/a:1/b;this.save(),this.beginPath(),this.moveTo(x+a,y);for(var i=0;i<2*Math.PI;i+=step)this.lineTo(x+a*Math.cos(i),y+b*Math.sin(i));return this.closePath(),this.fillStyle=bgColor,this.fill(),this.strokeStyle=borderColor,this.stroke(),this};var BubblerData={titles:["气泡","文字"],tipTypes:[{label:"interaction/styles/comicdialogue/assets/images/wood/u1356.png",name:"0"},{label:"interaction/styles/comicdialogue/assets/images/wood/u1354.png",name:"1"},{label:"interaction/styles/comicdialogue/assets/images/wood/u1358.png",name:"2"}],tipColors:["#E84C3D","#E77E23","#FFD700","#2FCC71","#3598DC","#9C59B8","#FF6699","#BEC3C7","#808B8D","#FFFFFF","#913EB0","#FF00CC","#96A6A6","#999999","#333333"],fonts:["宋体","黑体","楷体","仿宋","隶书","幼圆"],textColors:["#333333","#E84C3D","#FFFFFF"],fontOps:[{label:"-",name:"interaction/styles/comicdialogue/assets/images/wood/decrease_font.png"},{label:"+",name:"interaction/styles/comicdialogue/assets/images/wood/increase_font.png"}],diretions:[{label:"横向",name:"0"},{label:"竖向",name:"1"}],aligns:[{label:"interaction/styles/comicdialogue/assets/images/wood/Untitled-2-17.png",name:"left"},{label:"interaction/styles/comicdialogue/assets/images/wood/Untitled-2-18.png",name:"center"},{label:"interaction/styles/comicdialogue/assets/images/wood/Untitled-2-19.png",name:"right"}]},BubblerBox={current:{tipType:0,tipColor:"#E84C3D",fontFamily:"SimHei",textColor:"#000000",fontSize:14,diretion:0,textAlign:"left",left:0,top:0,move:!1,isOpen:!1},conflictColor:"yellow",box:void 0,bulid:function(){function bulidBox(){var box=document.createElement("div");$(box).addClass("bubble_box"),$(document.body).append(box),BubblerBox.box=box}function bulidTab(){var title=document.createElement("div");$(title).addClass("box_title"),$(BubblerBox.box).append(title);var span0=document.createElement("span");$(span0).text("气泡").addClass("tab-com first current").on("click touchstart",function(){BubblerBox._tab(0)}),$(title).append(span0);var span1=document.createElement("span");$(span1).text("文字").addClass("tab-com second").on("click touchstart",function(){BubblerBox._tab(1)}),$(title).append(span1)}function bulidBubblerType(){var tab0=document.createElement("div");$(tab0).addClass("tab0"),$(BubblerBox.box).append(tab0);var boxBG=document.createElement("div");$(boxBG).addClass("box_background"),$(tab0).append(boxBG),$.each(BubblerData.tipTypes,function(index,dom){var type=document.createElement("div");dom.name==BubblerBox.current.tipType?$(type).addClass("item current").html('<img src="'+dom.label+'" />').on("click touchstart",function(){BubblerBox._setTipType(dom.name)}):$(type).addClass("item").html('<img src="'+dom.label+'" />').on("click touchstart",function(){BubblerBox._setTipType(dom.name)}),$(boxBG).append(type)});var boxBGColor=document.createElement("div");$(boxBGColor).addClass("box_background_color"),$(tab0).append(boxBGColor);var boxBGColorTitle=document.createElement("div");$(boxBGColorTitle).addClass("box_background_color title").html("<span>气泡填充颜色</span>"),$(boxBGColor).append(boxBGColorTitle);var boxBGColorContainer=document.createElement("div");$(boxBGColorContainer).addClass("box_background_color container"),$(boxBGColor).append(boxBGColorContainer),$.each(BubblerData.tipColors,function(index,dom){var color=document.createElement("div");dom==BubblerBox.current.tipColor?$(color).css({"background-color":dom,border:"solid 2px white"}).on("click touchstart",function(){BubblerBox._setTipColor(dom)}):$(color).css({"background-color":dom,border:"solid 2px "+dom}).on("click touchstart",function(){BubblerBox._setTipColor(dom)}),$(boxBGColorContainer).append(color)})}function bulidBubblerText(){var tab1=document.createElement("div");$(tab1).addClass("tab1"),$(BubblerBox.box).append(tab1);var boxText=document.createElement("div");$(boxText).addClass("bubble_box_text"),$(tab1).append(boxText);var boxTextItem0=document.createElement("div");$(boxTextItem0).addClass("bubble_box_text_item"),$(boxText).append(boxTextItem0);var boxTextItem0Title=document.createElement("div");$(boxTextItem0Title).text("字体").addClass("text_item_title"),$(boxTextItem0).append(boxTextItem0Title);var boxTextItem0Options=document.createElement("div");$(boxTextItem0Options).addClass("text_item_options").text(BubblerBox.current.fontFamily).on("click touchstart",function(){BubblerBox._showFonts()}),$(boxTextItem0).append(boxTextItem0Options);var boxTextItem0Label=document.createElement("label");$(boxTextItem0Label).text(">"),$(boxTextItem0).append(boxTextItem0Label);var boxTextItem1=document.createElement("div");$(boxTextItem1).addClass("bubble_box_text_item"),$(boxText).append(boxTextItem1);var boxTextItem1Title=document.createElement("div");$(boxTextItem1Title).addClass("text_item_title").text("颜色"),$(boxTextItem1).append(boxTextItem1Title);var boxTextItem1Options=document.createElement("div");$(boxTextItem1Options).addClass("text_item_options").on("click touchstart",function(){BubblerBox._showColors()}),$(boxTextItem1).append(boxTextItem1Options);var boxTextItem1Options0=document.createElement("div");$(boxTextItem1Options0).addClass("text_item_color option_color").css({"background-color":BubblerBox.current.textColor}),$(boxTextItem1Options).append(boxTextItem1Options0);var boxTextItem1Label=document.createElement("label");$(boxTextItem1Label).text(">"),$(boxTextItem1).append(boxTextItem1Label);var boxTextItem2=document.createElement("div");$(boxTextItem2).addClass("bubble_box_text_item"),$(boxText).append(boxTextItem2);var boxTextItem2Container=document.createElement("div");$(boxTextItem2).append(boxTextItem2Container);var boxTextItem2Title=document.createElement("div");$(boxTextItem2Title).addClass("text_item_title").text("字号"),$(boxTextItem2Container).append(boxTextItem2Title);var boxTextItem2Options=document.createElement("div");$(boxTextItem2Options).addClass("text_item_options"),$(boxTextItem2Container).append(boxTextItem2Options),$.each(BubblerData.fontOps,function(index,dom){var boxTextItem2Options1=document.createElement("div");0==index?$(boxTextItem2Options1).addClass("text_item_font").on("click touchstart",function(){BubblerBox._decreaseFontSize()}):$(boxTextItem2Options1).addClass("text_item_font").on("click touchstart",function(){BubblerBox._increaseFontSize()}),$(boxTextItem2Options).append(boxTextItem2Options1);var boxTextItem2Options1Img=document.createElement("img");$(boxTextItem2Options1Img).width(25).height(25).attr("src",dom.name),$(boxTextItem2Options1).append(boxTextItem2Options1Img)});var boxTextItem3=document.createElement("div");$(boxTextItem3).addClass("bubble_box_text_item"),$(boxText).append(boxTextItem3);var boxTextItem3Container=document.createElement("div");$(boxTextItem3).append(boxTextItem3Container);var boxTextItem3Title=document.createElement("div");$(boxTextItem3Title).text("方向"),$(boxTextItem3Title).addClass("text_item_title"),$(boxTextItem3Container).append(boxTextItem3Title);var boxTextItem3Options=document.createElement("div");$(boxTextItem3Options).addClass("text_item_options"),$(boxTextItem3Container).append(boxTextItem3Options),$.each(BubblerData.diretions,function(index,dom){var item=document.createElement("div");dom.name==BubblerBox.current.diretion?$(item).addClass("text_item_diretion current").html("<span>"+dom.label+"</span>").on("click touchstart",function(){BubblerBox._setDiretion(dom.name)}):$(item).addClass("text_item_diretion").html("<span>"+dom.label+"</span>").on("click touchstart",function(){BubblerBox._setDiretion(dom.name)}),$(boxTextItem3Options).append(item)});var boxTextItem4=document.createElement("div");$(boxTextItem4).addClass("bubble_box_text_item"),$(boxText).append(boxTextItem4);var boxTextItem4Container=document.createElement("div");$(boxTextItem4).append(boxTextItem4Container);var boxTextItem4Title=document.createElement("div");$(boxTextItem4Title).text("对齐"),$(boxTextItem4Title).addClass("text_item_title"),$(boxTextItem4Container).append(boxTextItem4Title);var boxTextItem4Options=document.createElement("div");$(boxTextItem4Options).addClass("text_item_options"),$(boxTextItem4Container).append(boxTextItem4Options),$.each(BubblerData.aligns,function(index,dom){var item=document.createElement("div");dom.name==BubblerBox.current.textAlign?$(item).addClass("text_item_align current").on("click touchstart",function(){BubblerBox._setAlign(dom.name)}).append('<img src="'+dom.label+'" width="25" height="25"></img>'):$(item).addClass("text_item_align").on("click touchstart",function(){BubblerBox._setAlign(dom.name)}).append('<img src="'+dom.label+'" width="25" height="25"></img>'),$(boxTextItem4Options).append(item)})}function bulidBubblerFont(){var tab2=document.createElement("div");$(tab2).addClass("tab2"),$(BubblerBox.box).append(tab2);var boxBG=document.createElement("div");$(boxBG).addClass("bubble_box_text_item_font"),$(tab2).append(boxBG);var fontSetting=document.createElement("div");$(fontSetting).html("字体设置<span style='float:right;' >返回</span>").css({"font-weight":"bold"}).find("> span").on("click touchstart",function(){BubblerBox._tab(1)}),$(boxBG).append(fontSetting),
$.each(BubblerData.fonts,function(index,dom){var item=document.createElement("div");BubblerBox.current.fontFamily==dom?$(item).css({"font-weight":"bold"}).text(dom).on("click touchstart",function(){BubblerBox._setFont(dom)}):$(item).text(dom).on("click touchstart",function(){BubblerBox._setFont(dom)}),$(boxBG).append(item)})}function bulidBubblerColor(){var tab3=document.createElement("div");$(tab3).addClass("tab3"),$(BubblerBox.box).append(tab3);var boxBG=document.createElement("div");$(boxBG).addClass("bubble_box_text_item_color"),$(tab3).append(boxBG);var fontSetting=document.createElement("div");$(fontSetting).html("颜色设置<span style='float:right;' >返回</span>").css({"font-weight":"bold"}).find("> span").on("click touchstart",function(){BubblerBox._tab(1)}),$(boxBG).append(fontSetting);var boxBGColorContainer=document.createElement("div");$(boxBGColorContainer).addClass("bubble_box_text_item_color_container"),$(boxBG).append(boxBGColorContainer),$.each(BubblerData.tipColors,function(index,dom){var color=document.createElement("div");dom.toUpperCase()==BubblerBox.current.textColor.toUpperCase()?"#FFFFFF"==dom.toUpperCase()?$(color).css({"background-color":dom,border:"solid 2px "+BubblerBox.conflictColor}).on("click touchstart",function(){BubblerBox._setTextColor(dom)}):$(color).css({"background-color":dom,border:"solid 2px white"}).on("click touchstart",function(){BubblerBox._setTextColor(dom)}):$(color).css({"background-color":dom,border:"solid 2px "+dom}).on("click touchstart",function(){BubblerBox._setTextColor(dom)}),$(boxBGColorContainer).append(color)})}bulidBox(),bulidTab(),bulidBubblerType(),bulidBubblerText(),bulidBubblerFont(),bulidBubblerColor()},show:function(params,ev1){var ev=ev1||window.event,p=BubblerBox.getPoint(ev);BubblerBox.wrap(params),BubblerBox.bulid(),BubblerBox.current.isOpen=!0,BubblerBox.current.left||(BubblerBox.current.left=p.x),BubblerBox.current.top||(BubblerBox.current.top=p.y),$(".bubble_box").css({left:BubblerBox.current.left,top:BubblerBox.current.top}),$(".bubble_box").show(),$(".bubble_box").on("mousedown touchstart",function(e){e.stopPropagation(),e.preventDefault(),BubblerBox.current.move=!0;var p=BubblerBox.getPoint(e);BubblerBox.current.left=p.x-parseInt($(".bubble_box").css("left")),BubblerBox.current.top=p.y-parseInt($(".bubble_box").css("top")),$(document).on("mousemove touchmove",function(e){e.stopPropagation(),e.preventDefault();var p=BubblerBox.getPoint(e);if(BubblerBox.current.move){var x=p.x-BubblerBox.current.left,y=p.y-BubblerBox.current.top;$(".bubble_box").css({top:y,left:x})}}).on("mouseup touchend",function(){e.stopPropagation(),e.preventDefault(),BubblerBox.current.move=!1})})},getPoint:function(ev){var x=parseInt(ev.pageX),y=parseInt(ev.pageY);return ev.type.indexOf("touch")>=0&&ev.originalEvent&&ev.originalEvent.touches&&ev.originalEvent.touches.length>0&&(x=parseInt(ev.originalEvent.touches[0].pageX),y=parseInt(ev.originalEvent.touches[0].pageY)),{x:x,y:y}},close:function(){BubblerBox.current.isOpen=!1,$(".bubble_box").hide(),$(".bubble_box").remove()},isOpen:function(){return BubblerBox.current.isOpen},wrap:function(params){BubblerBox.current=params},_setTipType:function(tipType){BubblerBox.current.tipType=tipType,$(".box_background .item").each(function(index,dom){$(dom).removeClass("current"),index==tipType&&$(dom).addClass("current")}),ClientProxy.setTipStyle(BubblerBox.current)},_setTipColor:function(tipColor){return BubblerBox.current.textColor==tipColor?void new Toast({context:$("body"),message:"背景颜色和文本颜色不能一样"}).show():(BubblerBox.current.tipColor=tipColor,$(".box_background_color .container div").each(function(index,dom){var color=$(dom).css("background-color").colorHex().toUpperCase();$(dom).css({border:"2px solid "+color}),color==tipColor&&("#FFFFFF"==tipColor.toUpperCase()?$(dom).css({border:"2px solid "+BubblerBox.conflictColor}):$(dom).css({border:"2px solid white"}))}),void ClientProxy.setTipStyle(BubblerBox.current))},_setFont:function(fontFamily){BubblerBox.current.fontFamily=fontFamily,$(".bubble_box_text").find(".bubble_box_text_item:eq(0) >.text_item_options").text(BubblerBox.current.fontFamily),$(".bubble_box_text_item_font :gt(1)").css({"font-weight":"normal"}),$(".bubble_box_text_item_font >div").each(function(index,dom){var text=$(dom).text();text==BubblerBox.current.fontFamily&&$(dom).css({"font-weight":"bold"})}),ClientProxy.setTipText(BubblerBox.current)},_decreaseFontSize:function(){BubblerBox.current.fontSize-=1,BubblerBox.current.fontSize<14&&(BubblerBox.current.fontSize=14),ClientProxy.setTipText(BubblerBox.current)},_increaseFontSize:function(){BubblerBox.current.fontSize+=1,BubblerBox.current.fontSize>30&&(BubblerBox.current.fontSize=30),ClientProxy.setTipText(BubblerBox.current)},_setTextColor:function(textColor){return BubblerBox.current.tipColor==textColor?void new Toast({context:$("body"),message:"背景颜色和文本颜色不能一样"}).show():(BubblerBox.current.textColor=textColor,$(".bubble_box_text").find(".bubble_box_text_item:eq(1) >div + >div").css({"background-color":BubblerBox.current.textColor}),$(".bubble_box_text_item_color_container >div").each(function(index,dom){$(dom).css({border:"solid 2px "+BubblerData.tipColors[index]}),textColor==BubblerData.tipColors[index]&&("#FFFFFF"==textColor.toUpperCase()?$(dom).css({border:"solid 2px "+BubblerBox.conflictColor}):$(dom).css({border:"solid 2px white"}))}),void ClientProxy.setTipText(BubblerBox.current))},_setDiretion:function(diretion){BubblerBox.current.diretion=diretion,$(".text_item_diretion").each(function(index,dom){$(dom).removeClass("current"),index==diretion&&$(dom).addClass("current")}),ClientProxy.setTipText(BubblerBox.current)},_setAlign:function(textAlign){BubblerBox.current.textAlign=textAlign,$(".text_item_align").each(function(index,dom){var align=BubblerBox._getTextAlign(index);$(dom).removeClass("current"),align==textAlign&&$(dom).addClass("current")}),ClientProxy.setTipText(BubblerBox.current)},_getTextAlign:function(index){return BubblerData.aligns[index].name},_getTextColor:function(index){return BubblerData.textColors[index]},_tab:function(tabIndex){switch(tabIndex){case 0:$(".tab0").show(),$(".tab1").hide(),$(".tab2").hide(),$(".tab3").hide();break;case 1:$(".tab0").hide(),$(".tab1").show(),$(".tab2").hide(),$(".tab3").hide()}$(".box_title span").each(function(index,dom){$(dom).removeClass("current"),tabIndex==index&&$(dom).addClass("current")})},_showFonts:function(){$(".tab0").hide(),$(".tab1").hide(),$(".tab2").show(),$(".tab3").hide()},_showColors:function(){$(".tab0").hide(),$(".tab1").hide(),$(".tab2").hide(),$(".tab3").show()}},ClientProxy={setTipStyle:function(params){ComicDialogue.setTipStyle(params)},setTipText:function(params){ComicDialogue.setTipText(params)},open:function(params,ev){BubblerBox.show(params,ev)},close:function(){BubblerBox.close()},isOpen:function(){return BubblerBox.isOpen()},isClosest:function(){return ComicDialogue.CurrentMouseObject.closest(".bubble_box").length>0}};define("comicdialogue/bubbler",function(){}),define("comicdialogue/directive/comicdialogue.directive",["components/site-directive/assets-select/assets-select","components/site-directive/error-tip/error-tip","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","comicdialogue/utils","comicdialogue/bubbler"],function(){}),define(["app","comicdialogue/directive/comicdialogue.directive"],function(app){"use strict";app.controller("comicdialogue_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","$rootScope","$filter",function($scope,skin_service,$stateParams,CustomEditorService,$rootScope,$filter){function updateInfo(url){function filter(input){return input?$filter("filterRefPath")(input):""}$scope.info.scaleSize=[];var img=new Image,imgUrl=filter(url);img.src=imgUrl,url&&($scope.errorModel.errorText=$filter("translate")("pointsequencing.loading")),img.onload=function(){$scope.info.oriWidth=img.width,$scope.info.oriHeight=img.height,$scope.resizeFunc()},$scope.background_button_title="更改漫画图片",$scope.model.content.background.url=imgUrl,$(".comicdialoguebg").css({"background-image":"url("+imgUrl+")"})}$rootScope.moduleScope=$scope,$scope.errorModel={},$scope.delData={data:{}},$scope.background_button_title="添加漫画图片",$scope.model={skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/pointsequencing/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/pointsequencing/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},id:"",title:"",module_code:"nd_comicdialogue",properties:[{name:"question_id",display_name:"题目ID",type:"string",value:"",is_localized:!1},{name:"question_url",display_name:"题目内容",type:"jsonFile",value:"",is_localized:!1}],content:{allow_addtip:!0,title:"",desc:"",bg_width:"",bg_height:"",background:{url:"",scale:1},dialogues:[]}};var loadingData=function(id){$scope.isloadingData=!0,CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?$scope.model=$scope.decodeData(rtnData,!0):$scope.model.id=rtnData.id,skin_service.set_skin_by_code($scope.model.skin.code,"v1"),$scope.errorModel.errorText="",$scope.isloadingData=!1):$scope.errorModel.errorText=$filter("translate")("app.unvalidno")},function(error){$scope.errorModel.errorText=$filter("translate")("app.question.get.error")})};$stateParams.id?loadingData($stateParams.id):skin_service.set_skin_by_code($scope.model.skin.code,"v1"),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.validPostData=function(){var modelData=$scope.model;return""==$.trim(modelData.content.title)?($scope.errorModel.errorText=$filter("translate")("pointsequencing.no_title"),$scope.errorModel.dismissErrorTip(1e3),!1):""!=$.trim(modelData.content.background.url)||($scope.errorModel.errorText="请添加漫画图片",$scope.errorModel.dismissErrorTip(1e3),!1)},$scope.encodeData=function(model){return model},$scope.decodeData=function(model,isInitLoad){return model},$scope.resourceValidParam={imageType:["image/jpg","image/jpeg","image/webp","image/gif","image/png","image/bmp"],imageSize:1048576},$scope.addAssets=function(asset_type){asset_type&&updateInfo($scope.info.description.asset)},$scope.resizeFunc=function(){var width,height,orgWidth=$scope.info.oriWidth,orgHeight=$scope.info.oriHeight,clientWidth=window.document.body.clientWidth,clientHeight=window.document.body.clientHeight;clientWidth>=1315&&clientHeight>=910?(width=830.719,height=569.672):clientWidth>=1160&&clientHeight>=812?(width=721.156,height=514.891):(width=551,height=429.797),$scope.info.oriWidth=orgWidth,$scope.info.oriHeight=orgHeight;var tmpWidth,tmpHeight;$scope.info.oriWidth>width?(tmpHeight=width*$scope.info.oriHeight/$scope.info.oriWidth,tmpWidth=width,$(".comicdialoguebg").css({top:(height-tmpHeight)/2}),tmpHeight>height&&(tmpWidth=height*$scope.info.oriWidth/$scope.info.oriHeight,tmpHeight=height,$(".comicdialoguebg").css({top:0}))):$scope.info.oriHeight>height?(tmpWidth=height*$scope.info.oriWidth/$scope.info.oriHeight,tmpHeight=height,$(".comicdialoguebg").css({top:0}),tmpWidth>width&&(tmpHeight=width*$scope.info.oriHeight/$scope.info.oriWidth,tmpWidth=width,$(".comicdialoguebg").css({top:(height-tmpHeight)/2}))):(tmpHeight=height,tmpWidth=width),$scope.model.content.bg_width=tmpWidth,$scope.model.content.bg_height=tmpHeight,$(".comicdialoguebg").width(tmpWidth),$(".comicdialoguebg").height(tmpHeight),$scope.$apply()},$scope.info={description:{text:"",asset_type:"",asset:"",image_extend:{rotate:"",resize:""}},title:$scope.model.title,titleLength:0,timer:{timer_type:$scope.model.timer.timer_type,time_minute:$scope.model.timer.time_minute,time_second:$scope.model.timer.time_second},background:{url:"",scale:0}},$scope.event={},$scope.event.titleChange=function(){var title=$("textarea.tit").val();$scope.info.titleLength=title.length},ComicDialogue.init($scope),$scope.resizeFunc(),$(window).resize($scope.resizeFunc)}])});