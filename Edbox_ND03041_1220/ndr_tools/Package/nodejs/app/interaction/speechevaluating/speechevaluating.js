define("speechevaluating/directive/select",["angularAMD"],function(angularAMD){angularAMD.directive("unitSelect",[function(){return{restrict:"E",templateUrl:"interaction/speechevaluating/directive/select.html",scope:{currentId:"=currentId",content:"=content",isShow:"=isShow",showWordsById:"=showWordsById"},replace:!0,link:function(scope,element,attrs){scope.list=scope.content.units,scope.currentId&&scope.showWordsById(scope.currentId)}}}])}),define("speechevaluating/directive/speechevaluating.directive",["components/site-directive/assets-select/assets-select","components/site-directive/error-tip/error-tip","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","speechevaluating/directive/select"],function(){}),define(["app","speechevaluating/directive/speechevaluating.directive","lifecycle.service"],function(app){"use strict";app.controller("speechevaluating_ctrl",["$scope","skin_service","LifecycleService","$stateParams","CustomEditorService","$rootScope","$filter",function($scope,skin_service,LifecycleService,$stateParams,CustomEditorService,$rootScope,$filter){function findWordBayValue(val){var i=0,l=0;for(l=showContent.words.length;i<l;i++)if(showContent.words[i].word===val)return showContent.words[i];return!1}function removeItemByValue(arr,value){if(arr.length>0){var tempIndex=arr.indexOf(value);tempIndex>-1&&arr.splice(tempIndex,1)}}$rootScope.moduleScope=$scope,$scope.errorModel={},$scope.model={id:"",module_code:"nd_speechevaluating",title:"",skin:{code:"wood",css_url:"",name:$filter("translate")("app.skin.wood"),package_url:""},packages:[],timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},properties:[{name:"question_id",display_name:"题目ID",type:"string",value:"",is_localized:!1},{name:"question_url",display_name:"题目内容",type:"jsonFile",value:"",is_localized:!1}],content:{units:[{id:"001",title:"My name is Cool",name:"小学英语闽教版五年级上Unit2",count:4,parts:[{id:"001001",title:"",name:"part 1",count:4}]},{id:"002",title:"Unit 2:My name is Cool",name:"小学英语闽教版五年级上Unit3",count:7,parts:[{id:"002001",title:"",name:"part 1",count:7}]}],words:[{id:"1",parentId:"001001",word:"about",phonogram:"[ə'baʊt]",meaning:"关于",speech:"prep.",voice_url:"speechevaluating/assets/media/about.mp3"},{id:"2",parentId:"001004",word:"august",phonogram:"[ɔ:ˈgʌst]",meaning:"八月",speech:"n.",voice_url:"speechevaluating/assets/media/august.mp3"},{id:"3",parentId:"001002",word:"find",phonogram:"[faɪnd]",meaning:"找到；发现",speech:"vt.",voice_url:"speechevaluating/assets/media/find.mp3"},{id:"4",parentId:"001001",word:"holiday",phonogram:"['hɔlədi]",meaning:"假日",speech:"n.",voice_url:"speechevaluating/assets/media/holiday.mp3"},{id:"5",parentId:"001002",word:"july",phonogram:"[dʒʊˈlaɪ]",meaning:"七月",speech:"n.",voice_url:"speechevaluating/assets/media/july.mp3"},{id:"6",parentId:"001005",word:"kind",phonogram:"[kaɪnd]",meaning:"亲切",speech:"adj.",voice_url:"speechevaluating/assets/media/kind.mp3"},{id:"7",parentId:"001002",word:"lovely",phonogram:"['lʌvlɪ]",meaning:"可爱",speech:"adj.",voice_url:"speechevaluating/assets/media/lovely.mp3"},{id:"8",parentId:"002001",word:"October",phonogram:"[ɒk'təʊbə]",meaning:"十月",speech:"n.",voice_url:"speechevaluating/assets/media/October.mp3"},{id:"9",parentId:"002002",word:"panda",phonogram:"['pændə]",meaning:"熊猫",speech:"n.",voice_url:"speechevaluating/assets/media/panda.mp3"},{id:"10",parentId:"002001",word:"photo",phonogram:"['fəʊtəʊ]",meaning:"照片",speech:"n.",voice_url:"speechevaluating/assets/media/photo.mp3"},{id:"11",parentId:"002002",word:"smile",phonogram:"[smaɪl]",meaning:"微笑",speech:"vi.",voice_url:"speechevaluating/assets/media/smile.mp3"}],showWords:[],addWords:[]}},$scope.showConfirm=!1,$scope.showAlert=!1,$scope.options={editorValue:"",isShow:!1,textTemp:""};var showContent=$scope.model.content;$scope.model.content.currentId="001",$scope.showContent=showContent,$scope.addWord=function(item){item.isAdd||(item.isAdd=!0,showContent.addWords.push(item))},$scope.addWords=function(){for(var i=0,l=showContent.showWords.length;i<l;i++){var item=showContent.showWords[i];$scope.addWord(item)}},$scope.cleanWords=function(){showContent.addWords.length>0&&($scope.showConfirm=!0)},$scope.deleteWords=function(){for(var i=0,l=showContent.addWords.length;i<l;i++)showContent.addWords[i].isAdd=!1;showContent.addWords=[],$scope.windowColse("showConfirm")},$scope.deleteWord=function(item){item.isAdd=!1,removeItemByValue(showContent.addWords,item)},$scope.windowColse=function(value){$scope[value]=!1},$scope.isEditorWord=!1,$scope.editorWord=function(){$scope.isEditorWord=!0,$scope.options.editorValue="",angular.element("#editorWordInput").focus(100)},$scope.editorWordBlur=function(){if(""===$scope.options.editorValue)return void($scope.isEditorWord=!1);var word=findWordBayValue($scope.options.editorValue);word===!1?($scope.showAlert=!0,angular.element("#exam_wood_speech_evaluating .pop_box_alert").on("click.alert",function(e){var $target=angular.element(e.target);$target.closest(".pop_box .com_m_sideboard_1").length<1&&($scope.showAlert=!1,$scope.isEditorWord=!1,$scope.$apply(),angular.element("#exam_wood_speech_evaluating .pop_box_alert").off("click.alert"))})):($scope.addWord(word),$scope.isEditorWord=!1)},$scope.editorWordKeydown=function(e){13===e.which&&$scope.editorWordBlur()},$scope.wordItemEditBlur=function(item){if(item.isEditor=!1,""!==$scope.options.textTemp&&$scope.options.textTemp!==item.word){for(var i=0,l=showContent.addWords.length;i<l;i++)if(showContent.addWords[i].word===$scope.options.textTemp)return;for(var i=0,l=showContent.words.length;i<l;i++)if(showContent.words[i].word===$scope.options.textTemp)return void $scope.deleteWord(item)}},$scope.showWordsById=function(currentId){showContent.showWords=[];for(var i=0,l=showContent.words.length;i<l;i++)showContent.words[i].parentId.indexOf(currentId)&&showContent.showWords.push(showContent.words[i]);showContent.currentId=currentId,$scope.options.isShow=!1},$scope.dbclick=function(item){for(var i=0,l=showContent.addWords.length;i<l;i++)showContent.addWords[i].isEditor=!1;item.isEditor=!0,$scope.options.textTemp=angular.copy(item.word)};var loadingData=function(id){$scope.isloadingData=!0,CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?$scope.model=$scope.decodeData(rtnData,!0):$scope.model.id=rtnData.id,skin_service.set_skin_by_code($scope.model.skin.code,"v1"),$scope.errorModel.errorText="",$scope.isloadingData=!1):$scope.errorModel.errorText=$filter("translate")("app.unvalidno")},function(error){$scope.errorModel.errorText=$filter("translate")("app.question.get.error")})};$stateParams.id?loadingData($stateParams.id):skin_service.set_skin_by_code($scope.model.skin.code,"v1"),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.validPostData=function(){var modelData=$scope.model;return""==$.trim(modelData.title)?($scope.errorModel.errorText=$filter("translate")("count.notnull.title"),!1):!(modelData.content.addWords.length<=0)||($scope.errorModel.errorText=$filter("translate")("speechevaluating.words_empty"),!1)},$scope.encodeData=function(model){model.title=window.customHtmlEncode(model.title);for(var addWords=model.content.addWords,i=0,l=addWords.length;i<l;i++)addWords[i].phonogram=window.customHtmlEncode(addWords[i].phonogram),addWords[i].meaning=window.customHtmlEncode(addWords[i].meaning);return model.packages=[],model},$scope.decodeData=function(model,isInitLoad){model.title=window.customHtmlDecode(model.title),model.content.addWords=[];for(var i=0,l=model.content.words.length;i<l;i++)model.content.words[i].isAdd===!0&&model.content.addWords.push(model.content.words[i]);for(var addWords=model.content.addWords,i=0,l=addWords.length;i<l;i++)addWords[i].phonogram=window.customHtmlDecode(addWords[i].phonogram),addWords[i].meaning=window.customHtmlDecode(addWords[i].meaning);return showContent=model.content,$scope.showContent=showContent,$scope.showWordsById&&$scope.showWordsById(showContent.currentId),model}}])});