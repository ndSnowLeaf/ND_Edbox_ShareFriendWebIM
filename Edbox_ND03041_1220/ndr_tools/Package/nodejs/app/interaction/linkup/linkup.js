define("linkup/directive/item/item",["angularAMD"],function(angularAMD){angularAMD.directive("matchItem",[function(){return{restrict:"E",templateUrl:"interaction/linkup/directive/item/item.html",scope:{itemsData:"=itemsData",itemNew:"=itemData",indexNew:"@itemIndex",moduleSubtype:"@",delData:"=",remoteHandler:"=?"},controller:["$rootScope","$scope","$timeout",function($rootScope,$scope,$timeout){$scope.imageSize=120,$scope.resourceValidParam={imageType:["image/jpg","image/jpeg","image/webp","image/gif","image/png","image/bmp"],imageSize:1048576};var newData=null;newData="image2text"==$scope.moduleSubtype?{source:{item_type:"image",href:""},target:{item_type:"text",text:""}}:"image2image"==$scope.moduleSubtype?{source:{item_type:"image",href:""},target:{item_type:"image",href:""}}:{source:{item_type:"text",text:""},target:{item_type:"text",text:""}};var watchChange=function(newValue,oldValue){newValue!=oldValue&&$scope.remoteHandler&&$scope.remoteHandler.changeData()};$scope.$watch("itemNew.source.text",watchChange),$scope.$watch("itemNew.source.href",watchChange),$scope.$watch("itemNew.target.text",watchChange),$scope.$watch("itemNew.target.href",watchChange),$scope.itemNew&&$scope.itemNew.source||angular.copy(newData,$scope.itemsData[$scope.indexNew]),$scope.delMatchItem=function(itemOld,index){$scope.itemsData.length<=3?angular.copy(newData,itemOld):($scope.itemsData.splice(index,1),$scope.delData.data=angular.copy(itemOld)),$scope.remoteHandler&&$scope.remoteHandler.changeData()},$scope.clickText=function(data,thisObj){data.isEditText=!0,$timeout(function(){$(thisObj.target).prev().prev().find("textarea").focus()},100)},$scope.editorText=function(data,thisObj){data.isEditText=!0,$timeout(function(){$(thisObj.target).closest(".itemcon").find("textarea").focus()},100)};var startTime;$scope.onMousedown=function(event){startTime=(new Date).getTime(),$(event.target).attr("cancelClick",!1)},$scope.onMouseup=function(event,href){var interval=(new Date).getTime()-startTime;if(interval>=300){$(event.target).attr("cancelClick",!0);var moduleScope=$rootScope.moduleScope;return moduleScope.imagePreviewHref=href.replace("?size="+$scope.imageSize,"?"),moduleScope.isImagePreview=!0,!1}}}]}}])}),define("linkup/directive/linkup.directive",["components/site-directive/assets-select/assets-select","components/site-directive/error-tip/error-tip","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","linkup/directive/item/item"],function(){}),define(["app","linkup/directive/linkup.directive"],function(app){"use strict";app.controller("linkup_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","$rootScope","$filter",function($scope,skin_service,$stateParams,CustomEditorService,$rootScope,$filter){function setDefaultTitle(module_subtype){switch(module_subtype){case"image2image":$scope.defaultTitleSetting.title=$filter("translate")("linkup.title.image2image");break;case"image2text":$scope.defaultTitleSetting.title=$filter("translate")("linkup.title.image2text");break;case"text2text":$scope.defaultTitleSetting.title=$filter("translate")("linkup.title.text2text")}}$rootScope.moduleScope=$scope,$scope.errorModel={},$scope.delData={data:{}},$scope.model={title:"",skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/linkup/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/linkup/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"}};var initModel={module_subtype:"image2text",title:"",skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/linkup/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/linkup/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},items:[{},{},{}]},loadingData=function(id){$scope.isloadingData=!0,CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?($scope.model=$scope.decodeOrder(rtnData),setDefaultTitle($scope.model.module_subtype),skin_service.set_skin_by_code($scope.model.skin.code,"v1")):($scope.showGuide=!0,initModel.id=rtnData.id,skin_service.set_skin_by_code($scope.model.skin.code,"v1")),$scope.errorModel.errorText="",$scope.isloadingData=!1):$scope.errorModel.errorText=$filter("translate")("linkup.unvalidno")},function(error){$scope.errorModel.errorText=$filter("translate")("linkup.get_title_error")})};$stateParams.id?($scope.showGuide=!1,loadingData($stateParams.id)):($scope.showGuide=!0,skin_service.set_skin_by_code(initModel.skin.code,"v1")),$scope.defaultTitleSetting={isCleared:!1},$scope.setModuleSubtype=function(module_subtype){$scope.showGuide=!1,initModel.module_subtype=module_subtype,$scope.model.items=[{},{},{}],$scope.model.module_subtype=module_subtype,$scope.model.id=initModel.id,setDefaultTitle($scope.model.module_subtype),$scope.model.title||($scope.model.title=$scope.defaultTitleSetting.title),$rootScope.scaleHtml()},$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.addLinkup=function(){$scope.model.items.push(angular.copy($scope.delData.data)),$scope.delData={data:{}}},$scope.validPostData=function(){var modelData=$scope.model;if(""==$.trim(modelData.title))$scope.errorModel.errorText=$filter("translate")("linkup.no_title");else{for(var itemsCount=0,i=0;i<modelData.items.length;i++){if(!modelData.items[i].source.href&&!modelData.items[i].source.text||!modelData.items[i].target.href&&!modelData.items[i].target.text)return void($scope.errorModel.errorText=$filter("translate")("linkup.no_content"));itemsCount++}if(!(itemsCount<3))return!0;$scope.errorModel.errorText=$filter("translate")("linkup.content_min")}},$scope.encodeOrder=function(model){var newModel=angular.copy(model);newModel.title=window.customHtmlEncode(newModel.title);for(var i=0;i<newModel.items.length;i++)"text"==newModel.items[i].source.item_type&&(newModel.items[i].source.text=window.customHtmlEncode(newModel.items[i].source.text)),"text"==newModel.items[i].target.item_type&&(newModel.items[i].target.text=window.customHtmlEncode(newModel.items[i].target.text));return newModel},$scope.encodeData=function(model){var newModel=angular.copy(model);newModel.title=window.customHtmlEncode(newModel.title);for(var i=0;i<newModel.items.length;i++)"text"==newModel.items[i].source.item_type&&(newModel.items[i].source.text=window.customHtmlEncode(newModel.items[i].source.text)),"text"==newModel.items[i].target.item_type&&(newModel.items[i].target.text=window.customHtmlEncode(newModel.items[i].target.text));return newModel},$scope.decodeOrder=function(model){var newModel=angular.copy(model);newModel.title=window.customHtmlDecode(newModel.title);for(var i=0;i<newModel.items.length;i++)"text"==newModel.items[i].source.item_type&&(newModel.items[i].source.text=window.customHtmlDecode(newModel.items[i].source.text)),"text"==newModel.items[i].target.item_type&&(newModel.items[i].target.text=window.customHtmlDecode(newModel.items[i].target.text));return newModel},$scope.decodeData=function(model){var newModel=angular.copy(model);newModel.title=window.customHtmlDecode(newModel.title);for(var i=0;i<newModel.items.length;i++)"text"==newModel.items[i].source.item_type&&(newModel.items[i].source.text=window.customHtmlDecode(newModel.items[i].source.text)),"text"==newModel.items[i].target.item_type&&(newModel.items[i].target.text=window.customHtmlDecode(newModel.items[i].target.text));return newModel},$scope.playFAQVideo=function(){var box=angular.element(".llk_toolbar .desprtion");$scope.faqVideoOffset={left:box.offset().left+"px",top:Math.max(box.offset().top-600,0)+"px"},$scope.isFAQVideoVisible=!0},$scope.closeFAQVideo=function(){$scope.isFAQVideoVisible=!1},$scope.closeImagePreview=function(){$scope.isImagePreview=!1}}])});