define("arithmetic/service/utils.service",["angularAMD","mathjs"],function(angularAMD,math){"use strict";angularAMD.service("ArithmeticUtils",["$rootScope",function($rootScope){var regx={symbol:/[+-×÷]/,symbol_dot:/[+-×÷.]/,int:/^[1-9][0-9]{0,4}$/,int_uncomplete:/^[1-9][0-9]{0,3}$/,float:/(^[1-9][0-9]{0,3}[\.]{1}[0-9]{1,4}$)|(^[0][\.][0-9]{1,4}$)/,float_uncomplete:/(^[1-9][0-9]{0,3}[\.]{1}[0-9]{0,4}$)|(^[0][\.][0-9]{0,4}$)/};String.prototype.isInt=function(){return regx.int.test(this)},String.prototype.isIntUncomplete=function(){return regx.int_uncomplete.test(this)},String.prototype.isFloat=function(){var result=regx.float.test(this);return result&&this.length>6&&(result=!1),result},String.prototype.isFloatUncomplete=function(){var result=regx.float_uncomplete.test(this);return result&&this.length>6&&(result=!1),result},String.prototype.arrayBySymbol=function(){for(var symbol="+-×÷",list=[],i=0;i<symbol.length;i++)if(list=this.split(symbol[i]),list.length>1)return list;return list},Array.prototype.joinArrayItem=function(){for(var arr=[],i=0,l=this.length;i<l;i++)("."!=this[i].num||this.dot_show)&&(arr[i]=this[i].num);return arr.join("")},String.prototype.isContainsSymbols=function(){for(var symbol="+-×÷",result=!1,count=0,i=0;i<symbol.length;i++){var index=this.indexOf(symbol[i]);index>-1&&count++;var lastIndex=this.lastIndexOf(symbol[i]);index!=lastIndex&&count++}return result=count>1},String.prototype.getSymbol=function(){for(var symbol="+-×÷",i=0;i<symbol.length;i++){var index=this.indexOf(symbol[i]);if(index>-1)return symbol[i]}return""},String.prototype.sliceString=function(){var self=this,result=self;return self.indexOf(".")>-1&&self.split(".")[1].length>4&&(result=self.split(".")[0]+"."+self.split(".")[1].substr(0,4)),result};var Utils={getPowArr:function(){for(var powArr=[],i=0;i<10;i++)powArr.push(Math.pow(10,i));return powArr},setTextZero:function(text,num){for(var result=text,i=0;i<num;i++)result+="0";return result},wrapNumItems:function(strNum,numArr){this.wrapIntItems(strNum,numArr),this.wrapDotItems(strNum,numArr)},wrapIntItems:function(strNum,numArr){for(var intNum=strNum.split(".")[0],i=0,l=intNum.length;i<l;i++){var character=strNum.charAt(i),tmpDot={};tmpDot={index:Math.pow(10,l-i)+1,num:".",hide:!1,dot_show:!1,dashed:!1},numArr.push(tmpDot);var tempNum={};tempNum={index:Math.pow(10,l-i),num:character,hide:!1,dot_show:!1,dashed:!1},numArr.push(tempNum)}for(var dotNum=strNum.split(".").length>1?strNum.split(".")[1]:"",i=0,l=dotNum.length;i<l;i++){var character=dotNum.charAt(i),tmpDot={};tmpDot={index:-(Math.pow(10,i+1)+1),num:".",hide:!1,dot_show:!1,dashed:!1},numArr.push(tmpDot);var tempNum={};tempNum={index:-Math.pow(10,i+1),num:character,hide:!1,dot_show:!1,dashed:!1},numArr.push(tempNum)}},wrapDotItems:function(strNum,numArr){for(var i=0,l=strNum.length;i<l;i++){var character=strNum.charAt(i);"."==character&&(numArr[2*i].dot_show=!0)}},wrapByDivisorItem:function(numArr){for(var i=0;i<numArr.length;i++){var numItem=numArr[i];"."==numItem.num&&numItem.dot_show&&(numItem.dashed=!0)}},getDivisorItemLessOneIndex:function(origArr,wrapArr){for(var origIndex=0,wrapIndex=0,endIndex=0,firstMatch=!1,i=0;i<origArr.length;i++){if(i%2==1)for(var origItem=origArr[i],j=0;j<wrapArr.length;j++)if(j%2==1){var wrapItem=wrapArr[j];if(origItem.num==wrapItem.num&&parseInt(wrapItem.num)>0&&parseInt(origItem.num)>0){origIndex=i,wrapIndex=j,firstMatch=!0;break}}if(firstMatch)break}for(var origLength=origArr.length-origIndex+1,i=(wrapArr.length-wrapIndex+1,0);i<wrapArr.length;i++)if(i==origLength-1){endIndex=i;break}return{orig:origIndex,wrap:wrapIndex,end:endIndex}},wrapDivisorItemLessOne:function(origArr,wrapArr){for(var result=[],divisorIndex=this.getDivisorItemLessOneIndex(origArr,wrapArr),i=divisorIndex.end;i<wrapArr.length;i++){var wrapItem=wrapArr[i];i%2==1&&"0"==wrapItem.num&&(wrapItem.dashed=!0)}for(var origArr_new=origArr.slice(0,divisorIndex.orig),wrapArr_new=wrapArr.slice(divisorIndex.wrap,wrapArr.length),i=0;i<origArr_new.length;i++){var origItem=origArr_new[i];if("."==origItem.num&&0!==i){origItem.dashed=!0;break}}for(var i=divisorIndex.end;i<wrapArr_new.length;i++){var wrapItem=wrapArr_new[i];"0"==wrapItem.num&&0!==i&&(wrapItem.dashed=!0)}return result=origArr_new.concat(wrapArr_new)},wrapDivisorItem:function(origArr,wrapArr){for(var result=origArr,i=0;i<wrapArr.length;i++){var warpNumItem=wrapArr[i];i>result.length-1&&("."==warpNumItem.num?warpNumItem.dashed=!1:warpNumItem.dashed=!0,result.push(warpNumItem));var numItem=result[i];numItem.num==warpNumItem.num&&"."==numItem.num&&numItem.dot_show!=warpNumItem.dot_show&&(1==numItem.dot_show?(numItem.dashed=!0,numItem.dot_show=!0):(numItem.dashed=!1,numItem.dot_show=!0))}return result},getFrontZeroLength:function(text){for(var length=0,i=0;i<text.length;i++)if("."!=text[i]){if("0"!=text[i])break;length++}return length},getFractionLength:function(text){var len=text.indexOf(".")>-1?text.split(".")[1].length:0;return len},getProcedureNum:function(firstNum,secondNum,resultNum,index){for(var pows=Utils.getPowArr(),sub2=parseInt(resultNum.substr(0,index+1))*parseInt(secondNum),m=1,k=1,tmp=parseInt(firstNum.substr(0,m))-parseInt(sub2);tmp<0;)m++,m>firstNum.length?(tmp=parseInt(firstNum.substr(0,firstNum.length))*pows[k]-parseInt(sub2),k++):tmp=parseInt(firstNum.substr(0,m))-parseInt(sub2);var sub1=tmp+parseInt(resultNum.substr(index,1))*parseInt(secondNum);return sub1.toString()},getProcedureNum1:function(firstNum,secondNum,resultNum){for(var result="",procedureNum1="",i=0;i<resultNum.length;i++){var character=resultNum[i],procedureNum2=parseInt(character)*parseInt(secondNum);if(0!==procedureNum2){procedureNum1=Utils.getProcedureNum(firstNum,secondNum,resultNum,i);break}}for(var j=0;j<firstNum.length;j++){var item=firstNum.substr(0,j+1),num=parseInt(item)-parseInt(procedureNum1);if(!(num<0)){result=item;break}firstNum+="0"}return result},getResultFrontZeroCount:function(resultNum){for(var zeros=[],i=0;i<resultNum.length;i++){var character=resultNum[i];if("0"!==character)break;zeros.push({index:i})}return zeros.length},getResultAfterNotZeroIndex:function(resultNum){for(var index=0,i=resultNum.length;i>0;i--){var character=resultNum[i-1];if("0"!==character){index=i;break}}return index},getResutOffset:function(firstNumber,secondNumber,resultNumber){var virZero=this.getResultFrontZeroByFristNumber(firstNumber,secondNumber),realZero=this.getResultFrontZeroCount(resultNumber),offset=virZero-realZero;return offset},wrapResultNumber:function(offset,resultNumber){for(var zeroStr="",i=0;i<offset;i++)zeroStr+="0";return zeroStr+resultNumber.toString()},getResultFrontZeroByFristNumber:function(firstNumber,secondNumber){for(var zero=0,i=0;i<firstNumber.length;i++){var item=firstNumber.substr(0,i+1),num=parseInt(item)-parseInt(secondNumber);if(!(num<0))break;zero++,item.length==firstNumber.length&&(firstNumber+="0")}return zero},getOffset:function(firstNum,secondNum,resultNum,operator){var firstNum_dotLength=firstNum.split(".").length>1?firstNum.split(".")[1].length:0,secondNum_dotLength=secondNum.split(".").length>1?secondNum.split(".")[1].length:0,resultNum_dotLength=resultNum.split(".").length>1?resultNum.split(".")[1].length:0,firstNum_Length=firstNum.split(".")[0].length,secondNum_Length=secondNum.split(".")[0].length,resultNum_Length=resultNum.split(".")[0].length,maxLength_left=0,maxLength_right=0;return maxLength_left=firstNum_Length>maxLength_left?firstNum_Length:maxLength_left,maxLength_left=secondNum_Length>maxLength_left?secondNum_Length:maxLength_left,maxLength_left=resultNum_Length>maxLength_left?resultNum_Length:maxLength_left,maxLength_right=firstNum_dotLength>maxLength_right?firstNum_dotLength:maxLength_right,maxLength_right=secondNum_dotLength>maxLength_right?secondNum_dotLength:maxLength_right,maxLength_right=resultNum_dotLength>maxLength_right?resultNum_dotLength:maxLength_right,"multiply"==operator?{first:{left_blank:maxLength_right-resultNum_dotLength,right_blank:0},second:{left_blank:maxLength_right-resultNum_dotLength,right_blank:0},result:{left_blank:0,right_blank:0}}:"divide"==operator?{first:{left_blank:0,right_blank:0},second:{left_blank:0,right_blank:0},result:{left_blank:0,right_blank:0}}:{first:{left_blank:maxLength_left-firstNum_Length,right_blank:maxLength_right-firstNum_dotLength},second:{left_blank:maxLength_left-secondNum_Length,right_blank:maxLength_right-secondNum_dotLength},result:{left_blank:maxLength_left-resultNum_Length,right_blank:maxLength_right-resultNum_dotLength}}},getLoopResult:function(text){var result="",loopStart=text.indexOf("("),loopEnd=text.indexOf(")");if(loopStart>-1&&loopEnd>-1){var loopText=text.substr(loopStart+1,loopEnd-loopStart-1);result=text.substr(0,loopStart);for(var i=0;i<5;i++)result+=loopText}else result=text;return result},getDealedResult:function(n1,n2,c){var aFractionLength=this.getFractionLength(n1.toString()),bFractionLength=this.getFractionLength(n2.toString()),cFractionLength=this.getFractionLength(c.toString()),maxLength=0;maxLength=aFractionLength>maxLength?aFractionLength:maxLength,maxLength=bFractionLength>maxLength?bFractionLength:maxLength;var cArr=c.split("."),cEnd="";if(cFractionLength<maxLength)for(var i=0;i<maxLength-cFractionLength;i++)cEnd+="0";return maxLength>0?cArr.length>1?cArr[0]+"."+cArr[1]+cEnd:cArr[0]+"."+cEnd:cArr[0]},getResult:function(n1,n2,oper){if("+"===oper){var c=this.getLoopResult(math.fraction(n1).add(n2).toString());return this.getDealedResult(n1,n2,c)}if("-"===oper){var c=this.getLoopResult(math.fraction(n1).sub(n2).toString());return this.getDealedResult(n1,n2,c)}return"×"===oper?this.getLoopResult(math.fraction(n1).mul(n2).toString()):"÷"===oper?this.getLoopResult(math.fraction(n1).div(n2).toString()):void 0},getInputText:function($inputText,character){var inputText=$inputText.val(),startIndex=$inputText[0].selectionStart,endIndex=$inputText[0].selectionEnd;return inputText=inputText.substr(0,startIndex)+character+inputText.substr(endIndex,inputText.length),{inputText:inputText,startIndex:startIndex,endIndex:endIndex}},parseInputText:function(inputText){var list=(inputText.length,inputText.arrayBySymbol()),firstNumber=list[0],secondNumber=list[1],operator=inputText.getSymbol();return{firstNumber:firstNumber,secondNumber:secondNumber,operator:operator}},isInputValid:function(inputText){inputText.length;if(inputText.isContainsSymbols())return!1;var list=inputText.arrayBySymbol(),firstNumber=list[0],secondNumber="";return list.length>1&&(secondNumber=list[1]),!(!firstNumber.isInt()&&"0"!==firstNumber&&!firstNumber.isFloatUncomplete())&&!(secondNumber.length>0&&!secondNumber.isInt()&&"0"!==secondNumber&&!secondNumber.isFloatUncomplete())},isExpressValid:function(inputText){var text=inputText;text.length;if(text.isContainsSymbols())return!1;var list=text.arrayBySymbol();if(list.length<=1)return!1;var firstNumber="",secondNumber="";return firstNumber=list[0],secondNumber=list[1],!(!firstNumber.isInt()&&!firstNumber.isFloat())&&!(secondNumber.length>0&&!secondNumber.isInt()&&!secondNumber.isFloat())}};return Utils}])}),define("arithmetic/directive/count-panel/count-panel",["angularAMD","arithmetic/service/utils.service"],function(angularAMD){angularAMD.directive("countPanel",["$filter","ArithmeticUtils",function($filter,Utils){return{restrict:"E",templateUrl:"interaction/arithmetic/directive/count-panel/count-panel.html",scope:{inputData:"=countData",error:"=error",errorModel:"=errorModel"},replace:!0,link:function(scope,element,attrs){function focusNewVauleByIndex(value,Index){$inputText.val(value),$inputText[0].focus(),$inputText[0].setSelectionRange(Index,Index)}var KEYCODE={KP_BackSpace:8,KP_Home:36,KP_Select:41,KP_Dot:190,KP_0_RB:48,KP_9_LB:57,KP_8_Star:56,KP_0:96,KP_Enter:108,KP_Subtract:109,KP_Dot_Right:110,KP_Divide:111,KP_Equal_Plus:187,KP_Minus_Underline:189,KP_Division_Question:191,Chinese:229},cArr=["0","1","2","3","4","5","6","7","8","9","×","+",".","-","","÷"],$inputText=$("#f_inputText");scope.getKeyText=function(keyCode){var c="";return keyCode>=KEYCODE.KP_0&&keyCode<KEYCODE.KP_Enter||keyCode===KEYCODE.KP_Subtract||keyCode===KEYCODE.KP_Divide?c=cArr[keyCode-KEYCODE.KP_0]:keyCode>=KEYCODE.KP_0_RB&&keyCode<=KEYCODE.KP_9_LB&&event.shiftKey===!1?c=cArr[keyCode-KEYCODE.KP_0_RB]:keyCode==KEYCODE.KP_Equal_Plus&&event.shiftKey===!0||(keyCode==KEYCODE.KP_Minus_Underline||keyCode==KEYCODE.KP_Division_Question)&&event.shiftKey===!1?c=cArr[keyCode-176]:keyCode==KEYCODE.KP_8_Star&&event.shiftKey===!0?c=cArr[10]:keyCode!=KEYCODE.KP_Dot&&keyCode!=KEYCODE.KP_Dot_Right||(c=cArr[12]),c},scope.keybaord=function(event){var keyCode=event.keyCode;if(keyCode===KEYCODE.Chinese)return event.preventDefault(),!0;var c=($inputText[0].selectionStart,$inputText.val(),scope.getKeyText(keyCode));if($inputText.val().isFloat()||$inputText.val().isInt()||"0"===$inputText.val()||"×"!=c&&"+"!=c&&"-"!=c&&"÷"!=c||(scope.errorModel.errorText=$filter("translate")("count.integer.format.error"),event.preventDefault()),keyCode>=KEYCODE.KP_0&&keyCode<KEYCODE.KP_Enter||keyCode===KEYCODE.KP_Subtract||keyCode===KEYCODE.KP_Divide||keyCode>=KEYCODE.KP_0_RB&&keyCode<=KEYCODE.KP_9_LB&&event.shiftKey===!1||keyCode==KEYCODE.KP_Equal_Plus&&event.shiftKey===!0||(keyCode==KEYCODE.KP_Minus_Underline||keyCode==KEYCODE.KP_Division_Question)&&event.shiftKey===!1||keyCode==KEYCODE.KP_8_Star&&event.shiftKey===!0||keyCode==KEYCODE.KP_Dot||keyCode==KEYCODE.KP_Dot_Right||keyCode==KEYCODE.KP_BackSpace||keyCode>KEYCODE.KP_Home&&keyCode<KEYCODE.KP_Select||event.preventDefault(),c.length>0){var inputObj=Utils.getInputText($inputText,c),text=inputObj.inputText;Utils.isInputValid(text)||(scope.errorModel.errorText=$filter("translate")("count.integer.format.error"),event.preventDefault())}},scope.pasteValid=function(e){var inputText=e.originalEvent.clipboardData.getData("text/plain");/[0-9+×÷-]/g.test(inputText)===!1&&(scope.errorModel.errorText=$filter("translate")("count.integer.format.error"),document.execCommand("insertText",!1,""),e.preventDefault())},scope.keyup=function(e){var inputText=$inputText.val(),startIndex=$inputText[0].selectionStart,endIndex=$inputText[0].selectionEnd;/[*\/]/.test(inputText)&&(inputText=inputText.replace(/\*/g,"×").replace(/\//,"÷"),focusNewVauleByIndex(inputText,startIndex)),startIndex!==endIndex||Utils.isInputValid(inputText)||(inputText=inputText.substr(0,startIndex-1)+inputText.substr(startIndex),focusNewVauleByIndex(inputText,startIndex-1)),scope.inputData=inputText},scope.$watch("inputData",function(newValue,oldValue){"0"===newValue&&(scope.inputData="")}),scope.getNum=function(character){if($inputText.val().isFloat()||$inputText.val().isInt()||"0"===$inputText.val()||"×"!=character&&"+"!=character&&"-"!=character&&"÷"!=character){var inputObj=Utils.getInputText($inputText,character),text=inputObj.inputText;Utils.isInputValid(text)&&(scope.inputData=text,$inputText.val(text),focusNewVauleByIndex(text,inputObj.startIndex+1)),text&&scope.keyup()}},scope.deleteNum=function(){var inputText=scope.inputData;if(inputText.length===$inputText[0].selectionStart){var text=inputText.replace(/.$/,"");scope.inputData=text,$inputText.val(text)}else{var startIndex=$inputText[0].selectionStart,endIndex=$inputText[0].selectionEnd;if(startIndex<endIndex)inputText=inputText.substr(0,startIndex)+inputText.substr(endIndex);else{var str=inputText.substr(0,startIndex-1)+inputText.substr(startIndex);inputText=str,startIndex--}focusNewVauleByIndex(inputText,startIndex),scope.inputData=inputText}}}}}])}),define("arithmetic/directive/translate-panel/translate-panel",["angularAMD"],function(angularAMD){angularAMD.directive("translatePanel",["$filter",function($filter){return{restrict:"E",templateUrl:"interaction/arithmetic/directive/translate-panel/translate-panel.html",scope:{calNum:"=calNum"},link:function(scope,element,attrs){function mulResult(item){var n1,n2,n3,findItemByIndex=function(numItems){for(var i=0,l=numItems.length;i<l;i++)if(numItems[i].index===item.index)return numItems[i];return!1};return n1=findItemByIndex(scope.calNum.number_first.items),parseInt(scope.calNum.number_first.number)<0?(n3=findItemByIndex(scope.calNum.number_second.items),n2=findItemByIndex(scope.calNum.number_result.items)):(n2=findItemByIndex(scope.calNum.number_second.items),n3=findItemByIndex(scope.calNum.number_result.items)),n1&&n2&&n1.hide&&n2.hide?n1.num==n2.num&&("0"===n1||"9"===n1):!(n1&&n3&&n1.hide&&n3.hide||n3&&n2&&n2.hide&&n3.hide)||(!n2.hide&&"9"===n1.num&&"0"===n3.num||!n1.hide&&"9"===n2.num&&"0"===n3.num)}scope.changeDotClass=function(item){var className="com_u_btn_dot dot_defalut";return item.dot_show&&(className+=" dot_show"),className=item.hide?className.replace("dot_defalut","dot_fill"):className.replace("dot_fill","dot_defalut")},scope.checkNum=function(item){if(("."!=item.num||item.dot_show)&&(item.hide=!item.hide,item.hide)){var oper=scope.calNum.operator.operator;"+"!==oper&&"-"!==oper||mulResult(item)||(item.hide=!item.hide,scope.$parent.errorModel.errorText=$filter("translate")("count.multiple.result.error"))}}}}}])}),define("arithmetic/directive/multiply-panel/multiply-panel",["angularAMD"],function(angularAMD){angularAMD.directive("multiplyPanel",[function(){return{restrict:"E",templateUrl:"interaction/arithmetic/directive/multiply-panel/multiply-panel.html",scope:{calNum:"=calNum"},link:function(scope,element,attrs){scope.changeDotClass=function(item){var className="com_u_btn_dot dot_defalut";return item.dot_show&&(className+=" dot_show"),className=item.hide?className.replace("dot_defalut","dot_fill"):className.replace("dot_fill","dot_defalut")},scope.checkNum=function(item){("."!=item.num||item.dot_show)&&(item.hide=!item.hide)}}}}])}),define("arithmetic/directive/division-panel/division-panel",["angularAMD"],function(angularAMD){angularAMD.directive("divisionPanel",[function(){return{restrict:"E",templateUrl:"interaction/arithmetic/directive/division-panel/division-panel.html",scope:{calNum:"=calNum"},link:function(scope,element,attrs){scope.changeDotClass=function(item){var className="com_u_btn_dot dot_defalut";return item.dot_show&&(className+=" dot_show"),item.dashed&&(className+=" dot_dashed"),className=item.hide?className.replace("dot_defalut","dot_fill"):className.replace("dot_fill","dot_defalut")},scope.changeNumClass=function(item){var className="com_u_btn2";return item.dashed&&(className+=" com_u_zero"),className},scope.checkNum=function(item){("."!=item.num||item.dot_show)&&(item.hide=!item.hide)}}}}])}),define("arithmetic/directive/arithmetic.directive",["components/site-directive/assets-select/assets-select","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","components/site-directive/error-tip/error-tip","arithmetic/directive/count-panel/count-panel","arithmetic/directive/translate-panel/translate-panel","arithmetic/directive/multiply-panel/multiply-panel","arithmetic/directive/division-panel/division-panel"],function(){}),define("arithmetic/service/algorithm.service",["angularAMD","mathjs"],function(angularAMD,math){"use strict";angularAMD.service("Algorithm",["ArithmeticUtils",function(Utils){var AlgorithmCommand=function(){var numItem={number_first:{number:"",symbol:{symbol:"+",hide:!1},items:[]},number_second:{number:"",symbol:{symbol:"+",hide:!1},items:[]},number_result:{number:"",symbol:{symbol:"+",hide:!1},items:[]},operator:{operator:"",hide:!1},procedure:[]},obj={};return obj.a=0,obj.b=0,obj.operator="",obj.c=0,obj.item={},obj.getActionName=function(symbol){return"+"==symbol?"add":"-"==symbol?"sub":"×"==symbol?"mul":"div"},obj.action={base:function(){obj.item=numItem,obj.item.operator.operator=obj.operator,obj.item.number_first.number=obj.a,Utils.wrapNumItems(obj.a,obj.item.number_first.items),obj.item.number_second.number=obj.b,Utils.wrapNumItems(obj.b,obj.item.number_second.items),obj.c=Utils.getResult(obj.a,obj.b,obj.operator).toString(),obj.item.number_result.number=obj.c,Utils.wrapNumItems(obj.c,obj.item.number_result.items);var offset=Utils.getOffset(obj.a,obj.b,obj.c,obj.operator);obj.item.number_first.offset=offset.first,obj.item.number_second.offset=offset.second,obj.item.number_result.offset=offset.result},baseDiv:function(){obj.item=numItem,obj.item.operator.operator=obj.operator,obj.item.number_first.number=obj.a,Utils.wrapNumItems(obj.a,obj.item.number_first.items),obj.item.number_second.number=obj.b,Utils.wrapNumItems(obj.b,obj.item.number_second.items),obj.c=Utils.getResult(obj.a,obj.b,obj.operator).toString(),obj.c=obj.c.sliceString(),obj.item.number_result.number=obj.c,Utils.wrapNumItems(obj.c,obj.item.number_result.items);var offset=Utils.getOffset(obj.a,obj.b,obj.c,obj.operator);obj.item.number_first.offset=offset.first,obj.item.number_second.offset=offset.second,obj.item.number_result.offset=offset.result},add:function(){return obj.action.base(),obj.item},sub:function(){return obj.action.base(),obj.item},mul:function(){obj.action.base();for(var result,k=obj.b.length-1,i=obj.b.length-1,j=0;i>=0;i--)"."!=obj.b[i]&&(result=math.fraction(obj.b[i]).mul(obj.a.replace(".","")).valueOf(),0!==result?(obj.item.procedure[j]={},obj.item.procedure[j].items=[],Utils.wrapNumItems(result+"",obj.item.procedure[j].items),obj.item.procedure[j].number=result,obj.item.procedure[j].offset=obj.b.length-k-1,j++,k--):k--);return 1==obj.item.procedure.length&&(delete obj.item.procedure,obj.item.procedure=[]),obj.item},div:function(){var pows=Utils.getPowArr(),fractionLength=Utils.getFractionLength(obj.b.toString()),a=(math.fraction(obj.b).mul(pows[fractionLength]).toString(),math.fraction(obj.a).mul(pows[fractionLength]).toString()),number_result=obj._getResultNumber(obj.a.toString(),obj.b.toString(),obj.operator);obj.c=number_result.number;var number_first=obj._getFirstNumber(obj.a,a,obj.operator),number_second=obj._getSecondNumber(obj.b,obj.operator),procedure=obj._getProcedure(obj.a.replace(".",""),obj.b.replace(".",""),number_result.number.replace(".",""),obj.operator),remainder=obj._getRemainder(obj.a.replace(".",""),obj.b.replace(".",""),number_result.number.replace(".",""),obj.operator),operator=obj._getOperator(obj.operator);return obj.item.number_first=number_first,obj.item.number_second=number_second,obj.item.number_result=number_result,obj.item.operator=operator,obj.item.procedure=procedure,obj.item.remainder=remainder,obj.item}},obj._getOperator=function(operator){var item={operator:operator,hide:!1};return item},obj._getFirstNumber=function(number,wrapNumber,operator){var item={items:[],number:number,offset:0,symbol:{hide:!1,symbol:operator}};Utils.wrapNumItems(item.number,item.items);var item1={items:[],number:wrapNumber,offset:0,symbol:{hide:!1,symbol:operator}};Utils.wrapNumItems(item1.number,item1.items);var result=[];return result=parseFloat(number)<1?Utils.wrapDivisorItemLessOne(item.items,item1.items):Utils.wrapDivisorItem(item.items,item1.items),item.items=result,item},obj._getSecondNumber=function(number,operator){var item={items:[],number:number,offset:0,symbol:{hide:!1,symbol:operator}};return Utils.wrapNumItems(item.number,item.items),Utils.wrapByDivisorItem(item.items),item},obj._getResultNumber=function(firstNumber,secondNumber,operator){var resultNumber=Utils.getResult(firstNumber,secondNumber,operator).toString();resultNumber=resultNumber.sliceString();var item={items:[],number:resultNumber,offset:0,symbol:{hide:!1,symbol:operator}};return Utils.wrapNumItems(item.number,item.items),item},obj._getProcedure=function(firstNumber,secondNumber,resultNumber,operator){var procedures=[],procedureNum1=Utils.getProcedureNum1(firstNumber,secondNumber,resultNumber),resultOffset=Utils.getResutOffset(firstNumber,secondNumber,resultNumber);resultNumber=Utils.wrapResultNumber(resultOffset,resultNumber);for(var i=0,m=0;i<resultNumber.length;i++){var procedure1={items:[],number:"",offset:0,tempOffset:0},procedure2={items:[],number:"",offset:0,tempOffset:0},character=resultNumber[i],procedureNum2=parseInt(character)*parseInt(secondNumber);0!==procedureNum2&&(0!==m&&(procedureNum1=Utils.getProcedureNum(firstNumber,secondNumber,resultNumber,i),procedure1.number=procedureNum1,procedure1.offset=i-procedureNum1.toString().length+1,Utils.wrapNumItems(procedure1.number+"",procedure1.items),procedures.push(procedure1)),procedure2.number=procedureNum2,procedure2.offset=i-procedureNum2.toString().length+1,Utils.wrapNumItems(procedure2.number+"",procedure2.items),procedures.push(procedure2),m++)}return procedures},obj._getRemainder=function(firstNumber,secondNumber,resultNumber,operator){var procedureNum1=Utils.getProcedureNum(firstNumber,secondNumber,resultNumber,resultNumber.length-1),procedureNum2=parseInt(resultNumber.substr(resultNumber.length-1,1))*parseInt(secondNumber),resultOffset=Utils.getResutOffset(firstNumber,secondNumber,resultNumber);resultNumber=Utils.wrapResultNumber(resultOffset,resultNumber);var item={items:[],number:"",offset:0};item.number=parseInt(procedureNum1)-parseInt(procedureNum2),Utils.wrapNumItems(item.number+"",item.items);var index=Utils.getResultAfterNotZeroIndex(resultNumber);return item.offset={left_blank:index-item.number.toString().length,right_blank:0},item},obj.excute=function(msg){if(null!=msg){var actionName=this.getActionName(msg.param.operator);return this.a=msg.param.firstNumber,this.b=msg.param.secondNumber,this.operator=msg.param.operator,msg.param="[object Array]"===Object.prototype.toString.call(msg.param)?msg.param:[msg.param],obj.action[actionName].apply(actionName,msg.param)}},obj},data={number_first:{},number_second:{},number_result:{},operator:{},procedure:[],originNum:""},algorithm={};return algorithm.data=data,algorithm.getItem=function(command,param){var algorithmCommand=new AlgorithmCommand,item=algorithmCommand.excute({command:command,param:param});return item},algorithm}])}),define("arithmetic/service/arithmetic.service",["angularAMD","mathjs","arithmetic/service/algorithm.service"],function(angularAMD,math){"use strict";angularAMD.service("ArithmeticService",["skin_service","CustomEditorService","$stateParams","$rootScope","$filter","$timeout","ArithmeticUtils","Algorithm",function(skin_service,customEditorService,$stateParams,$rootScope,$filter,$timeout,Utils,Algorithm){var defaultTitleSetting={isCleared:!1,title:$filter("translate")("count.default.title")},model={id:"",title:defaultTitleSetting.title,skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/arithmetic/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/arithmetic/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},prompt:{number_first:{number:23,symbol:{symbol:"-",hide:!1},items:[{num:2,hide:1,index:1},{num:3,hide:1,index:1}]},number_second:{number:23,symbol:{symbol:"-",hide:!1},items:[{num:2,hide:1,index:1},{num:3,hide:1,index:1}]},number_result:{number:23,symbol:{symbol:"-",hide:!1},items:[{num:2,hide:1,index:1},{num:3,hide:1,index:1}]},operator:{operator:"+",hide:1},procedure:[{offset:2,number:[{num:2,hide:!1,index:1},{num:3,hide:!1,index:1}]}],remainder:[{num:2,hide:!1,index:1},{num:3,hide:!1,index:1}]}},count={placeholder:{title:"请输入标题"},inputValue:"",flag:!0,calError:!1},errorModel={errorText:""},calNum={originNum:""},data={model:model,errorModel:errorModel,count:count,calNum:calNum,defaultTitleSetting:defaultTitleSetting},formulaErrorTip=$filter("translate")("count.formula.error"),service={};return service.scope=null,service.initData=function(){$stateParams.id?customEditorService.getQuestionInfoById($stateParams.id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?(angular.extend(service.scope.model,service.decodeModel(rtnData)),service.scope.calNum=service.scope.model.prompt,service.scope.calNum.screen="",service.scope.calNum.screen+=service.scope.calNum.number_first.number,service.scope.calNum.screen+=service.scope.calNum.operator.operator,service.scope.calNum.screen+=service.scope.calNum.number_second.number,service.scope.calNum.originNum=service.scope.calNum.screen,service.scope.count.inputValue=service.scope.calNum.screen):service.scope.model.id=rtnData.id,service.scope.errorModel.errorText="",skin_service.set_skin_by_code(service.scope.model.skin.code,"v1")):service.scope.errorModel.errorText=$filter("translate")("count.unvalidno")},function(){service.scope.errorModel.errorText=$filter("translate")("count.get_title_error")}):skin_service.set_skin_by_code(service.scope.model.skin.code,"v1")},service.init=function(scope){angular.extend(scope,data),this.scope=scope,this.initData()},service.previousStep=function(){service.scope.count.flag=!0},service.nextStep=function(){var input=$("#f_inputText").val().trim();if(!Utils.isExpressValid(input))return void(service.scope.errorModel.errorText=formulaErrorTip);var firstNum,secondNum,resultNum,inputObj=Utils.parseInputText(input);if(firstNum=inputObj.firstNumber,secondNum=inputObj.secondNumber,!firstNum.isInt()&&!firstNum.isFloat()||!secondNum.isInt()&&!secondNum.isFloat())return void(service.scope.errorModel.errorText=formulaErrorTip);var operator=inputObj.operator;if("÷"===operator&&0===parseFloat(secondNum))return void(service.scope.errorModel.errorText=$filter("translate")("count.zero.divide.error"));if(resultNum=Utils.getResult(firstNum,secondNum,operator).toString(),resultNum<0)return void(service.scope.errorModel.errorText=$filter("translate")("count.negative.error"));if("÷"===operator&&0===parseInt(resultNum))return void(service.scope.errorModel.errorText=$filter("translate")("count.divide.error"));var item=Algorithm.getItem(inputObj.operator,inputObj);service.scope.calNum=item,service.scope.count.flag=!1},service.validData=function(){var modelData=service.scope.model;if(""==$.trim(modelData.title))return service.scope.errorModel.errorText=$filter("translate")("count.notnull.title"),!1;if(service.scope.count.flag===!0)return service.scope.errorModel.errorText=$filter("translate")("count.next.step"),!1;for(var allItems=[].concat(service.scope.calNum.number_first.items).concat(service.scope.calNum.number_second.items).concat(service.scope.calNum.number_result.items),i=0,l=service.scope.calNum.procedure.length;i<l;i++)allItems=allItems.concat(service.scope.calNum.procedure[i].items);"÷"===service.scope.calNum.operator.operator&&(allItems=allItems.concat(service.scope.calNum.remainder.items));for(var flag=!1,i=0,l=allItems.length;i<l;i++)if(allItems[i].hide===!0){flag=!0;break}return flag!==!1||(service.scope.errorModel.errorText=$filter("translate")("count.no_content"),!1)},service.encodeModel=function(model){var newModel=angular.copy(model);return newModel.title=window.customHtmlEncode(newModel.title),newModel.prompt=service.scope.calNum,newModel.originNum="","×"===newModel.prompt.operator.operator?newModel.prompt.operator.operator="*":"÷"===newModel.prompt.operator.operator&&(newModel.prompt.operator.operator="/"),newModel},service.decodeModel=function(model){var newModel=angular.copy(model);newModel.title=window.customHtmlDecode(newModel.title),"*"===newModel.prompt.operator.operator?newModel.prompt.operator.operator="×":"/"===newModel.prompt.operator.operator&&(newModel.prompt.operator.operator="÷"),service.scope.calNum=newModel.prompt;for(var procedure=service.scope.calNum.procedure,fl=service.scope.calNum.number_first.number.toString().length,i=0,l=procedure.length;i<l;i++)procedure[i].tempOffset=fl-procedure[i].items.length-procedure[i].offset;return newModel},service}])}),define(["app","arithmetic/directive/arithmetic.directive","arithmetic/service/arithmetic.service"],function(app){"use strict";app.controller("arithmetic_ctrl",["$scope","$rootScope","ArithmeticService",function($scope,$rootScope,ArithmeticService){ArithmeticService.init($scope),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.nextStep=function(){ArithmeticService.nextStep()},$scope.previousStep=function(){ArithmeticService.previousStep()},$scope.validPostData=function(){return ArithmeticService.validData();
},$scope.encodeOrder=function(model){return ArithmeticService.encodeModel(model)},$scope.decodeOrder=function(model){return ArithmeticService.decodeModel(model)}}])});