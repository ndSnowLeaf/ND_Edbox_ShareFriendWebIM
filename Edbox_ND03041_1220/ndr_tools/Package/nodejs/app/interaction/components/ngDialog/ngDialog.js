define(["angularAMD","css!components/ngDialog/assets/ngDialog.css"],function(e){"use strict";var a,n=e,o=angular.element,l=angular.isDefined,t=(document.body||document.documentElement).style,i=l(t.animation)||l(t.WebkitAnimation)||l(t.MozAnimation)||l(t.MsAnimation)||l(t.OAnimation),r="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",s=!1;return n.provider("ngDialog",function(){var e=this.defaults={className:"ngdialog-theme-default",plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceBodyReload=function(e){s=e||!1},this.setDefaults=function(a){angular.extend(e,a)};var n,l=0,t=0,c={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller",function(d,g,u,p,m,f,v,b,y){var h=d.find("body");s&&f.$on("$locationChangeSuccess",function(){h=d.find("body")});var D={onDocumentKeydown:function(e){27===e.keyCode&&C.close("$escape")},activate:function(e){e.data("$ngDialogOptions").trapFocus&&(e.on("keydown",D.onTrapFocusKeydown),h.on("keydown",D.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",D.onTrapFocusKeydown),h.off("keydown",D.onTrapFocusKeydown)},deactivateAll:function(e){angular.forEach(function(e){var a=angular.element(e);D.deactivate(a)})},setBodyPadding:function(e){var a=parseInt(h.css("padding-right")||0,10);h.css("padding-right",a+e+"px"),h.data("ng-dialog-original-padding",a)},resetBodyPadding:function(){var e=h.data("ng-dialog-original-padding");e?h.css("padding-right",e+"px"):h.css("padding-right","")},performCloseDialog:function(e,o){var l=e.attr("id");if(void 0!==b.Hammer){var s=a.hammerTime;s.off("tap",n),s.destroy&&s.destroy(),delete a.hammerTime}else e.unbind("click");1===t&&h.unbind("keydown"),e.hasClass("ngdialog-closing")||(t-=1);var d=e.data("$ngDialogPreviousFocus");d&&angular.element(d).filter(":visible").length>0&&d.focus(),f.$broadcast("ngDialog.closing",e),t=t<0?0:t,i?(a.$destroy(),e.unbind(r).bind(r,function(){e.remove(),0===t&&(h.removeClass("ngdialog-open"),D.resetBodyPadding()),f.$broadcast("ngDialog.closed",e)}).addClass("ngdialog-closing")):(a.$destroy(),e.remove(),0===t&&(h.removeClass("ngdialog-open"),D.resetBodyPadding()),f.$broadcast("ngDialog.closed",e)),c[l]&&(c[l].resolve({id:l,value:o,$dialog:e,remainingDialogs:t}),delete c[l])},closeDialog:function(e,a){var n=e.data("$ngDialogPreCloseCallback");if(n&&angular.isFunction(n)){var o=n.call(e,a);angular.isObject(o)?o.closePromise?o.closePromise.then(function(){D.performCloseDialog(e,a)}):o.then(function(){D.performCloseDialog(e,a)},function(){}):!1!==o&&D.performCloseDialog(e,a)}else D.performCloseDialog(e,a)},onTrapFocusKeydown:function(e){var a,n=angular.element(e.currentTarget);if(n.hasClass("ngdialog"))a=n;else if(null===(a=D.getActiveDialog()))return;var o=9===e.keyCode,l=!0===e.shiftKey;o&&D.handleTab(a,e,l)},handleTab:function(e,a,n){var o=D.getFocusableElements(e);if(0===o.length)return void(document.activeElement&&document.activeElement.blur());var l=document.activeElement,t=Array.prototype.indexOf.call(o,l),i=-1===t,r=0===t,s=t===o.length-1,c=!1;n?(i||r)&&(o[o.length-1].focus(),c=!0):(i||s)&&(o[0].focus(),c=!0),c&&(a.preventDefault(),a.stopPropagation())},autoFocus:function(e){var a=e[0],n=angular.element("*[autofocus]",a);if(null===n||(n.focus(),document.activeElement!==n)){var l=D.getFocusableElements(e);if(l.length>0)return void l[0].focus();var t=D.filterVisibleElements(angular.element("h1,h2,h3,h4,h5,h6,p,span",a));if(t.length>0){var i=t[0];o(i).attr("tabindex","0"),i.focus()}}},getFocusableElements:function(e){var a=e[0],n=angular.element("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",a);return D.filterVisibleElements(n)},filterVisibleElements:function(e){for(var a=[],n=0;n<e.length;n++){var o=e[n];(o.offsetWidth>0||o.offsetHeight>0)&&a.push(o)}return a},getActiveDialog:function(){var e=angular.element(".ngdialog",document);return 0===e.length?null:o(e[e.length-1])},applyAriaAttributes:function(e,a){if(a.ariaAuto){if(!a.ariaRole){var n=D.getFocusableElements(e).length>0?"dialog":"alertdialog";a.ariaRole=n}a.ariaLabelledBySelector||(a.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),a.ariaDescribedBySelector||(a.ariaDescribedBySelector="article,section,p")}a.ariaRole&&e.attr("role",a.ariaRole),D.applyAriaAttribute(e,"aria-labelledby",a.ariaLabelledById,a.ariaLabelledBySelector),D.applyAriaAttribute(e,"aria-describedby",a.ariaDescribedById,a.ariaDescribedBySelector)},applyAriaAttribute:function(e,a,n,l){if(n&&e.attr(a,n),l){var t=e.attr("id"),i=angular.element(l,e[0]);if(!i)return;var r=t+"-"+a;return o(i).attr("id",r),e.attr(a,r),r}}},C={open:function(i){function r(e,a){return m.get(e,a||{}).then(function(e){return e.data||""})}var s=this,d=angular.copy(e);i=i||{},angular.extend(d,i),l+=1,s.latestID="ngdialog"+l;var $;c[s.latestID]=$=p.defer(),a=angular.isObject(d.scope)?d.scope.$new():f.$new();var B,k;return p.when(function(e){return e?angular.isString(e)&&d.plain?e:"boolean"!=typeof d.cache||d.cache?g.get(e)||r(e,{cache:!0}):r(e,{cache:!1}):"Empty template"}(d.template||d.templateUrl)).then(function(e){if(g.put(d.template||d.templateUrl,e),d.showClose&&(e+='<div class="ngdialog-close"></div>'),s.$result=B=o('<div id="ngdialog'+l+'" class="ngdialog"></div>'),B.html(d.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+e+"</div>":'<div class="ngdialog-content" role="document">'+e+"</div>"),B.data("$ngDialogOptions",d),d.data&&angular.isString(d.data)){var i=d.data.replace(/^\s*/,"")[0];a.ngDialogData="{"===i||"["===i?angular.fromJson(d.data):d.data}else d.data&&angular.isObject(d.data)&&(a.ngDialogData=d.data);if(d.controller&&(angular.isString(d.controller)||angular.isArray(d.controller)||angular.isFunction(d.controller))){var r=y(d.controller,{$scope:a,$element:B});B.data("$ngDialogControllerController",r)}if(d.className&&B.addClass(d.className),k=d.appendTo&&angular.isString(d.appendTo)?angular.element(d.appendTo,document):h,D.applyAriaAttributes(B,d),d.preCloseCallback){var c;angular.isFunction(d.preCloseCallback)?c=d.preCloseCallback:angular.isString(d.preCloseCallback)&&a&&(angular.isFunction(a[d.preCloseCallback])?c=a[d.preCloseCallback]:a.$parent&&angular.isFunction(a.$parent[d.preCloseCallback])?c=a.$parent[d.preCloseCallback]:f&&angular.isFunction(f[d.preCloseCallback])&&(c=f[d.preCloseCallback])),c&&B.data("$ngDialogPreCloseCallback",c)}if(a.closeThisDialog=function(e){D.closeDialog(B,e)},v(function(){var e=angular.element(".ngdialog",document);D.deactivateAll(e),u(B)(a);var n=b.innerWidth-h.prop("clientWidth");h.addClass("ngdialog-open");var o=n-(b.innerWidth-h.prop("clientWidth"));o>0&&D.setBodyPadding(o),k.append(B),D.activate(B),d.trapFocus&&D.autoFocus(B),d.name?f.$broadcast("ngDialog.opened",{dialog:B,name:d.name}):f.$broadcast("ngDialog.opened",B)}),d.closeByEscape&&h.bind("keydown",D.onDocumentKeydown),d.closeByNavigation&&f.$on("$locationChangeSuccess",function(){D.closeDialog(B)}),d.preserveFocus&&B.data("$ngDialogPreviousFocus",document.activeElement),n=function(e){var a=!!d.closeByDocument&&o(e.target).hasClass("ngdialog-overlay"),n=o(e.target).hasClass("ngdialog-close");(a||n)&&C.close(B.attr("id"),n?"$closeButton":"$document")},void 0!==b.Hammer){(a.hammerTime=b.Hammer(B[0])).on("tap",n)}else B.bind("click",n);return t+=1,C}),{id:"ngdialog"+l,closePromise:$.promise,close:function(e){D.closeDialog(B,e)}}},openConfirm:function(e){var a=p.defer(),n={closeByEscape:!1,closeByDocument:!1};angular.extend(n,e),n.scope=angular.isObject(n.scope)?n.scope.$new():f.$new(),n.scope.confirm=function(e){a.resolve(e);var n=o(document.getElementById(l.id));D.performCloseDialog(n,e)};var l=C.open(n);return l.closePromise.then(function(e){return e?a.reject(e.value):a.reject()}),a.promise},showConfirm:function(e,a,n){var l=p.defer();void 0==typeof e&&(e="是否确定要删除？"),void 0===a&&(a={ok:"确定",cancel:"取消"}),void 0===a.ok&&(a.ok="确定"),void 0===a.cancel&&(a.cancel="取消"),void 0===n&&(n={});var t='<div class="ngdialog-message">                            <h4>'+e+'</h4><br />                            </div>                            <div class="ngdialog-buttons">                                <button type="button" class="ngdialog-button ngdialog-button-secondary " ng-click="confirm()"  >'+a.ok+'</button>                                <button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()"  >'+a.cancel+"</button>                            </div>";n.template=t,n.plain=!0;var i={closeByEscape:!1,closeByDocument:!1};angular.extend(i,n),i.scope=angular.isObject(i.scope)?i.scope.$new():f.$new(),i.scope.confirm=function(e){l.resolve(e);var a=o(document.getElementById(r.id));D.performCloseDialog(a,e)};var r=C.open(i);return r.closePromise.then(function(e){return e?l.reject(e.value):l.reject()}),l.promise},close:function(e,a){var n=o(document.getElementById(e));n.length?D.closeDialog(n,a):C.closeAll(a);var l=!0,t=angular.element(".ngdialog");return angular.forEach(t,function(e){if(l){"none"!=angular.element(e).css("display")&&(l=!1)}}),l&&t.length>0&&(h.removeClass("ngdialog-open"),D.resetBodyPadding()),C},reopen:function(e){var a=o(document.getElementById(e));return a[0]&&(h.addClass("ngdialog-open"),D.setBodyPadding(),a.show()),C},closeAll:function(e){for(var a=angular.element(".ngdialog",document),n=a.length;n>-1;n--){var l=a[n];D.closeDialog(o(l),e)}},getDefaults:function(){return e}};return C}]}),n.directive("ngDialog",["ngDialog",function(e){return{restrict:"A",scope:{ngDialogScope:"="},link:function(a,n,o){n.on("click",function(n){n.preventDefault();var l=angular.isDefined(a.ngDialogScope)?a.ngDialogScope:"noScope";angular.isDefined(o.ngDialogClosePrevious)&&e.close(o.ngDialogClosePrevious);var t=e.getDefaults();e.open({template:o.ngDialog,className:o.ngDialogClass||t.className,controller:o.ngDialogController,scope:l,data:o.ngDialogData,showClose:"false"!==o.ngDialogShowClose&&("true"===o.ngDialogShowClose||t.showClose),closeByDocument:"false"!==o.ngDialogCloseByDocument&&("true"===o.ngDialogCloseByDocument||t.closeByDocument),closeByEscape:"false"!==o.ngDialogCloseByEscape&&("true"===o.ngDialogCloseByEscape||t.closeByEscape),preCloseCallback:o.ngDialogPreCloseCallback||t.preCloseCallback})})}}}]),n});