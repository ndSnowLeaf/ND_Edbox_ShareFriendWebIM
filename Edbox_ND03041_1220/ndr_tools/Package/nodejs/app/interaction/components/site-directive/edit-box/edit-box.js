define(["angularAMD","css!components/site-directive/edit-box/edit-box.css"],function(e){e.directive("editbox",[function(){new Array;return{restrict:"EA",scope:{maxSize:"=maxSize",minSize:"=minSize",maxLength:"=maxLength",title:"="},link:function(e,t,n,i){function r(e,t){for(var n="",i=e.length,r=0,c=0;c<=i-1;c++){if(r>=t)return n;r+=1,n+=e.charAt(c)}return n}function c(){t.rows=1,t.css("line-height","65px")}function o(){var n=l;h=Math.floor(2*t.width()/(n+1));var i=t.val(),o=i.length;0==o&&c();var s=parseFloat(((t.width()-o)/o).toFixed(2));if(o>=n){var u=r(i,n);e.title=u,a()}s<=f&&d!=s&&s>=h&&(d=s,t.css("fontSize",s),c()),s<=f&&d!=s&&s>=h&&(d=s,t.css("line-height",1),t.css("fontSize",s)),s<=h&&(t.css("fontSize",h),t.rows=2,t.css("line-height",1),t.css("text-align","center"),t.css("vertical-align","middle")),s>=h&&d!=s&&(s>f?(t.css("fontSize",f),c()):t.css("fontSize",s))}function a(){clearTimeout(u),clearInterval(v),u=setTimeout(function(){clearInterval(v),t.css("border","1px solid transparent")},3e3),v=setInterval(s,300)}function s(){m?(t.css("border","1px solid transparent"),m=!1):(t.css("border","1px solid red"),m=!0)}t.removeAttr("title");var l=e.maxLength||75,f=e.maxSize,h=e.minSize;l>100&&(l=100),t.attr("maxlength",l),e.$watch("title",function(e,t){e&&e!=t&&o()}),e.$on("changgedSkin",o),e.$watch("element.width()",function(e,t){e&&e!=t&&o()});var d=t.css("fontSize");t.bind("input enterKey",function(e){o()}),t.bind("keydown",function(e){if(t.val().length>=l&&8!=e.which&&46!=e.which&&t[0].selectionStart==t[0].selectionEnd)return e.cancelable=!0,e.preventDefault(),!1}),n.placeholder&&(t.on("focus",function(e){t.attr("placeholder","")}),t.on("blur",function(e){t.attr("placeholder",n.placeholder)}));var u=0,v=0,m=!1}}}])});