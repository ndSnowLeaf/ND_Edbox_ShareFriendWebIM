define(["angularAMD"],function(e){e.directive("matchItem",[function(){return{restrict:"E",templateUrl:"interaction/components/site-directive/match-item/match-item.html",scope:{itemsData:"=itemsData",itemNew:"=itemData",indexNew:"@itemIndex",maxlength:"=maxlength",moduleSubtype:"@",delData:"=",imageSize:"@",isCommonValid:"@",selfValidation:"=",addImage:"&addImage",addText:"&addText"},controller:["$rootScope","$scope","$timeout",function(e,t,i){t.commonValidParam={imageType:["image/jpg","image/jpeg","image/webp","image/gif","image/png","image/bmp"],imageSize:1048576};var a=null;a="image2text"==t.moduleSubtype?{source:{item_type:"image",href:""},target:{item_type:"text",text:""}}:"image2image"==t.moduleSubtype?{source:{item_type:"image",href:""},target:{item_type:"image",href:""}}:{source:{item_type:"text",text:""},target:{item_type:"text",text:""}},t.itemNew&&t.itemNew.source||angular.copy(a,t.itemsData[t.indexNew]),t.delMatchItem=function(e,i){t.itemsData.length<=3?angular.copy(a,e):(t.itemsData.splice(i,1),t.delData.data=angular.copy(e))},t.clickText=function(e,t){e.isEditText=!0,i(function(){$(t.target).prev().prev().find("textarea").focus()},100)},t.addAssets=function(e,i){if(t.addImage){t.addImage()}},t.textAreaBlur=function(e,a){if("source"==e?t.itemNew.source.isEditText=!1:t.itemNew.target.isEditText=!1,t.addText){t.addText()||i(function(){$(a.target).focus()},100)}};var m;t.onMousedown=function(e){m=(new Date).getTime(),$(e.target).attr("cancelClick",!1)},t.onMouseup=function(i,a){if((new Date).getTime()-m>=300){$(i.target).attr("cancelClick",!0);var n=e.moduleScope;return n.imagePreviewHref=a.replace("?size="+t.imageSize,"?"),n.isImagePreview=!0,!1}},t.editorText=function(e,t){e.isEditText=!0,i(function(){$(t.target).closest(".itemcon").find("textarea").focus()},100)}}]}}])});