define(["angularAMD","components/site-directive/foot-tool/foot-tool-time","components/site-directive/foot-tool/save-buttons/new-save-buttons","components/site-directive/interaction-hint/interaction-hint","components/site-directive/confirm-popup/confirm-popup"],function(e){e.directive("footTool",["skin_service","$stateParams","$rootScope","$filter","UserDataService","UtilsService","CONSTANTS_GLOBAL",function(e,t,i,o,n,a,l){return{restrict:"E",scope:{isSimpleMode:"=isSimpleMode",descriptionId:"=descriptionId",model:"=model",postData:"=postData",validData:"=",encodeData:"=",decodeData:"=",buttonCallback:"=",arrayHide:"=arrayHide",apiVersion:"@",interactionHint:"@"},templateUrl:"interaction/components/site-directive/foot-tool/foot-tool.html",link:function(s,r,c){s.showInteractionHint=!(!1===s.interactionHint||"false"===s.interactionHint),$("#description-id a.mainlink").attr("draggable","false");var d,p;if(s.arrHide=[!1,!1,!1,!1,!1,!1],s.arrayHide)for(d=0,p=s.arrayHide.length;d<p;d++)s.arrHide[s.arrayHide[d]-1]=!0;angular.element(".com_lay_foottool").on("click","ul.left_ul > li",function(e){var t=angular.element(e.target),o=$(this);if(t.hasClass("btn_submit")||t.hasClass("btn_cancel"))return o.has(".toolpop").removeClass("on"),!1;if(o.hasClass("disprtion")&&!o.hasClass("on")){i.QuestionGuideOpenTime=(new Date).getTime();var n=i.$$phase;"$apply"!=n&&"$digest"!=n&&i.$apply()}if(o.hasClass("on"))return!1;o.siblings("li").removeClass("on"),o.has(".toolpop").addClass("on"),e.stopPropagation(),e.preventDefault(),angular.element(".exam_wood").on("click",function(){o.has(".toolpop").removeClass("on"),angular.element(".exam_wood").off("click"),angular.element("#descriptionTemplate").hasClass("on")||i.stopQuestionGuidePlayer&&i.stopQuestionGuidePlayer(),"timesetId"===o.attr("id")&&angular.element("#timesetId").trigger("resetTime")})}),setTimeout(function(){!s.model.id&&e.set_skin_by_code("wood","v1"),$(angular.element("#"+s.descriptionId).children()).appendTo(angular.element("#descriptionTemplate")),t.isPreview&&"false"!==t.isPreview||n.checkUserActivity(angular.element(".com_lay_foottool").find(".disprtion"))},100),e.get_skins().then(function(e){s.list=e,angular.forEach(s.list,function(e){e.cover_url="interaction/"+t.area+"/assets/css/"+e.code+".png?"+require.s.contexts._.config.urlArgs})}),s.selectSkin=function(t){e.set_skin(t,version),angular.extend(model.skin,t),s.$parent.$parent.hide()};var u=s.$root.moduleScope;u&&angular.isObject(u.defaultTitleSetting)&&(s.continueAction=function(){s.shouldShowConfirmTitlePopup=!1,s.$emit(l.FS_CONTINUE_ACTION_EVENT,s.continueActionType)},s.renameTitle=function(){s.shouldShowConfirmTitlePopup=!1,u.defaultTitleSetting.titleTarget&&a.selectAllText(u.defaultTitleSetting.titleTarget)},s.$on(l.FP_DEFAULT_TITLE_CONFIRM_EVENT,function(e,t){s.shouldShowConfirmTitlePopup=!0,s.confirmPopupMessage=o("translate")("app.def.title.confirm").replace("{title}",'<label style="color: #0099FF;">'+window.customHtmlEncode(u.defaultTitleSetting.title)+"</label>"),s.continueActionType=t}))}}}])});