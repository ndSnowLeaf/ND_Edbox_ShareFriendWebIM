define(["angularAMD","css!components/site-directive/question-guide/assets/css/style.css"],function(e){e.directive("questionGuide",[function(){return{restrict:"E",templateUrl:"interaction/components/site-directive/question-guide/question-guide.html",replace:!0,transclude:!1,scope:{imageRoot:"@",imagePreview:"@",imageList:"=",imagePrefix:"@",imageSuffix:"@",imageAmount:"@",interval:"@",autoSwitch:"@"},controller:["$scope","$rootScope","$timeout",function(e,i,t){if(e.GUIDE_MODE={PREVIEW:"preview",EDITOR:"editor"},e.currentMode=e.GUIDE_MODE.PREVIEW,e.guideImgIndex=0,e.imagePreview?e.previewImage=e.imageRoot+"/"+e.imagePreview:e.previewImage=e.imageRoot+"/"+e.imagePrefix+e.imageSuffix,e.editorImages=[],angular.isArray(e.imageList))e.imageAmount=e.imageList.length,angular.forEach(e.imageList,function(i,t){e.editorImages.push({actived:0===t,src:e.imageRoot+"/"+i})});else for(var o=0;o<e.imageAmount;o++)e.editorImages.push({actived:0===o,src:e.imageRoot+"/"+e.imagePrefix+(o+1)+e.imageSuffix});e.editorImages.length>0&&(e.currentImageEditor=e.editorImages[0]);var n=function(i){e.currentImageEditor&&(e.currentImageEditor.actived=!1),e.currentImageEditor=e.editorImages[i],e.currentImageEditor.actived=!0},r=function(){a(),i.questionGuidePlayer=setInterval(function(){e.guideImgIndex+1==e.imageAmount?(a(),t(function(){n(0),r()},3e3)):(n(++e.guideImgIndex),e.$apply())},e.interval||1500)},a=function(){i.questionGuidePlayer&&clearInterval(i.questionGuidePlayer),i.questionGuidePlayer=null,e.guideImgIndex=0};i.stopQuestionGuidePlayer=a;var u,c=function(){u=t(function(){s(),e.switchToEditor()},5e3)},s=function(){u&&(t.cancel(u),u=null)};e.switchToPreview=function(i){i&&(i.stopPropagation(),i.preventDefault()),a(),e.currentMode=e.GUIDE_MODE.PREVIEW},e.switchToEditor=function(i){i&&(i.stopPropagation(),i.preventDefault()),s(),n(0),r(),e.currentMode=e.GUIDE_MODE.EDITOR},e.$watch("$root.QuestionGuideOpenTime",function(){i.QuestionGuideOpenTime&&(e.switchToPreview(),c())}),e.$on("$destroy",function(){a()}),"true"===e.autoSwitch&&c()}]}}])});