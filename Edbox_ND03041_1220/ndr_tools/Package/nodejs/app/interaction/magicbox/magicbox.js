define("magicbox/directive/magicbox.directive",["components/site-directive/assets-select/assets-select","components/site-directive/error-tip/error-tip","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","components/site-directive/contenteditable/contenteditable","components/site-services/charset.service"],function(){}),define(["app","magicbox/directive/magicbox.directive"],function(app){"use strict";app.controller("magicbox_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","CharsetService","UserDataService","$rootScope","$filter","$timeout",function($scope,skin_service,$stateParams,CustomEditorService,CharsetService,UserDataService,$rootScope,$filter,$timeout){function checkDuplicateAnswer(){angular.forEach($scope.wordTips,function(item,index){item.selected=!1}),angular.forEach($scope.rows,function(row){angular.forEach(row,function(col){col.selectedH=col.selectedV=col.duplicated=!1})});var userInputWords=getUserInputWords(),isExisted=!1;return angular.forEach($scope.wordTips,function(item,index){if(!isExisted){var matchCount=0,wordBoxs=[],length=item.word.length;angular.forEach(userInputWords,function(userInputWord){for(var matchIndex=userInputWord.chars.indexOf(item.word);matchIndex>-1;){if(matchCount++,isHorizontal(userInputWord.direction))for(var i=0;i<length;i++)wordBoxs.push($scope.rows[userInputWord.x][userInputWord.y+matchIndex+i]);else for(var i=0;i<length;i++)wordBoxs.push($scope.rows[userInputWord.x+matchIndex+i][userInputWord.y]);matchIndex=userInputWord.chars.indexOf(item.word,matchIndex+1)}}),isExisted=matchCount>1,isExisted&&($scope.tipOnOver(item),$scope.errorModel.errorText=$filter("translate")("magicbox.duplicate_answer"),$timeout.cancel(timer),clearInterval(interval),interval=setInterval(function(){wordBoxs[0].duplicated?$scope.$apply(function(){angular.forEach(wordBoxs,function(box){box.duplicated=!1})}):$scope.$apply(function(){angular.forEach(wordBoxs,function(box){box.duplicated=!0})})},300),timer=$timeout(function(){clearInterval(interval),angular.forEach(wordBoxs,function(box){box.duplicated=!1})},2e3))}}),isExisted}function getUserInputWords(){for(var tempWord,cell,userInputWords=[],rowNum=$scope.rows.length,colNum=$scope.rows[0].length,i=0;i<rowNum;i++){tempWord={direction:DIRECTION.HORIZONTAL,chars:""};for(var j=0;j<colNum;j++)cell=$scope.rows[i][j],cell.char?(tempWord.chars||(tempWord.x=i,tempWord.y=j),tempWord.chars+=cell.char):(tempWord.chars&&tempWord.chars.length>1&&userInputWords.push(tempWord),tempWord={direction:DIRECTION.HORIZONTAL,chars:""});tempWord.chars&&tempWord.chars.length>1&&userInputWords.push(tempWord)}for(var j=0;j<colNum;j++){tempWord={direction:DIRECTION.VERTICAL,chars:""};for(var i=0;i<rowNum;i++)cell=$scope.rows[i][j],cell.char?(tempWord.chars||(tempWord.x=i,tempWord.y=j),tempWord.chars+=cell.char):(tempWord.chars&&tempWord.chars.length>1&&userInputWords.push(tempWord),tempWord={direction:DIRECTION.VERTICAL,chars:""});tempWord.chars&&tempWord.chars.length>1&&userInputWords.push(tempWord)}return userInputWords}function focusElement(element,immediate){element&&(immediate?element.focus():$timeout(function(){element.focus()},100))}function getBoxCoordinate(target){var $box;return $box="DIV"==angular.uppercase(target.tagName)?$(target):$(target).parents("div:first"),$box.hasClass("wordBox")&&!$box.hasClass("delete")?{x:$box.attr("boxX"),y:$box.attr("boxY")}:null}function onRightDirection(direction,boxSrc,boxDest){return isHorizontal(direction)?boxSrc.x==boxDest.x:boxSrc.y==boxDest.y}function selectBox(box){if($.inArray(box,boxesSelected)<=-1)if(null!=slidingDirection)if(isHorizontal(slidingDirection)){var startY=boxesSelected[boxesSelected.length-1].y;if(isReversed)for(var i=startY;i>box.y;i--){var boxTemp=$scope.rows[box.x-1][i-2];boxTemp.forNewtipH=!0,boxesSelected.push(boxTemp)}else for(var i=startY;i<box.y;i++){var boxTemp=$scope.rows[box.x-1][i];boxTemp.forNewtipH=!0,boxesSelected.push(boxTemp)}}else{var startX=boxesSelected[boxesSelected.length-1].x;if(isReversed)for(var i=startX;i>box.x;i--){var boxTemp=$scope.rows[i-2][box.y-1];startBox.forNewtipH=!1,startBox.forNewtipV=!0,boxTemp.forNewtipV=!0,boxesSelected.push(boxTemp)}else for(var i=startX;i<box.x;i++){var boxTemp=$scope.rows[i][box.y-1];startBox.forNewtipH=!1,startBox.forNewtipV=!0,boxTemp.forNewtipV=!0,boxesSelected.push(boxTemp)}}else box.forNewtipH=!0,boxesSelected.push(box)}function stopSliding(cancel){if(isMouseDown=!1,cancel)angular.forEach(boxesSelected,function(box){box.forNewtipH=box.forNewtipV=!1});else if(boxesSelected.length<2)startBox.forNewtipH=startBox.forNewtipV=!1;else{var endBox=boxesSelected[boxesSelected.length-1];addTip(startBox.x==endBox.x?DIRECTION.HORIZONTAL:DIRECTION.VERTICAL,boxesSelected)}}function getBeginBox(direction,boxesSelected){var boxFirst=boxesSelected[0],boxLast=boxesSelected[boxesSelected.length-1];return isHorizontal(direction)?boxLast.y>boxFirst.y?boxFirst:boxLast:boxLast.x>boxFirst.x?boxFirst:boxLast}function checkDuplicateTips(direction,boxesSelected){var isValid=!0,wordsSelected="";return isHorizontal(direction)?angular.forEach(boxesSelected,function(box){wordsSelected+=box.char,isNotEmptyArray(box.tipsLinked)&&angular.forEach(box.tipsLinked,function(tip){if(isHorizontal(tip.direction))return $scope.errorModel.errorText=$filter("translate")("magicbox.duplicate_tips_onbox"),isValid=!1,!1})}):angular.forEach(boxesSelected,function(box){wordsSelected+=box.char,isNotEmptyArray(box.tipsLinked)&&angular.forEach(box.tipsLinked,function(tip){if(!isHorizontal(tip.direction))return $scope.errorModel.errorText=$filter("translate")("magicbox.duplicate_tips_onbox"),isValid=!1,!1})}),isValid&&angular.forEach($scope.wordTips,function(tip){if(tip.word==wordsSelected)return $scope.errorModel.errorText=$filter("translate")("magicbox.duplicate_word"),isValid=!1,!1}),isValid||angular.forEach(boxesSelected,function(box){box.forNewtipH=box.forNewtipV=!1}),isValid}function addTip(direction,boxesSelected){if(!checkDuplicateTips(direction,boxesSelected))return!1;var beginBox=getBeginBox(direction,boxesSelected),newTip={actived:!0,x:beginBox.x,y:beginBox.y,word:"",direction:direction,boxesLinked:boxesSelected};isReversed?angular.forEach(boxesSelected,function(box){box.tipsLinked.push(newTip),newTip.word=box.char+newTip.word}):angular.forEach(boxesSelected,function(box){box.tipsLinked.push(newTip),newTip.word+=box.char}),$scope.wordTips.push(newTip),isHorizontal(direction)?beginBox.horizontalIndex=$scope.wordTips.length:beginBox.verticalIndex=$scope.wordTips.length,$timeout(function(){focusElement($(".com_m_sidecon li:last-child input"),!0)},100)}function focusWordBox(wordBox){null!=currentWordBox&&(currentWordBox.actived=!1),wordBox.actived=!0,currentWordBox=wordBox,focusElement($($(".wordboard .wordshow")[wordBox.x-1]).find("input")[wordBox.y-1])}function extendsWordBox(direction,fromBox,boxNum,chars){if(isHorizontal(direction)){for(var i=1;i<=boxNum;i++)angular.forEach($scope.rows,function(row,index){row.push({x:index+1,y:fromBox.y+i,tipsLinked:[]})}),chars&&chars.length>=i&&($scope.rows[fromBox.x-1][fromBox.y+i-1].char=chars.charAt(i-1));adjustSize($scope.rows[0].length>$scope.rows.length?$scope.rows[0].length:$scope.rows.length),$timeout(function(){focusWordBox($scope.rows[fromBox.x-1][fromBox.y+boxNum-1])},100)}else{for(var newRow,cols=$scope.rows[0].length,i=1;i<=boxNum;i++){newRow=[];for(var j=0;j<cols;j++)newRow.push({x:fromBox.x+i,y:j+1,tipsLinked:[]});$scope.rows.push(newRow),chars&&chars.length>=i&&($scope.rows[fromBox.x+i-1][fromBox.y-1].char=chars.charAt(i-1))}adjustSize($scope.rows[0].length>$scope.rows.length?$scope.rows[0].length:$scope.rows.length),$timeout(function(){focusWordBox($scope.rows[fromBox.x+boxNum-1][fromBox.y-1])},100)}}function adjustSize(num){num<7?$scope.typebox="largeBox":num>=7&&num<9?$scope.typebox="normalBox":num>=9&&num<=11&&($scope.typebox="smallBox")}function shouldIgnoreChange(item){if(isChineseInput){if($scope.language==$scope.LANGUAGE.CHINESE)return CharsetService.getChineses(item.char).length>0?(isChineseInput=!1,!1):(isChineseInput=!1,item.char="",!0);if(shouldIgnoreTextChange){var theChars=CharsetService.getAlphabets(item.char).toLowerCase();return theChars.length>0&&(item.char=theChars.charAt(0)),!0}}return!1}function updateXY(){angular.forEach($scope.rows,function(row,indexX){angular.forEach(row,function(col,indexY){col.x=indexX+1,col.y=indexY+1})}),angular.forEach($scope.wordTips,function(tip,index){var beginBox=getBeginBox(tip.direction,tip.boxesLinked);tip.x=beginBox.x,tip.y=beginBox.y})}function autoFillBoxes(){if($scope.language==$scope.LANGUAGE.CHINESE){var userInputChars=[];angular.forEach($scope.rows,function(row,indexX){angular.forEach(row,function(col,indexY){col.char&&userInputChars.push(col.char)})}),angular.forEach($scope.rows,function(row,indexX){angular.forEach(row,function(col,indexY){col.char&&0!=col.char.length||(col.char=generateChinese(userInputChars))})})}else angular.forEach($scope.rows,function(row,indexX){angular.forEach(row,function(col,indexY){col.char&&0!=col.char.length||(col.char=CharsetService.getRandomAlphabet(!0).toLowerCase())})})}function generateChinese(userInputChars){for(var rdChar=CharsetService.getRandomChineseChar(),isExisted=$.inArray(rdChar,userInputChars)>-1;isExisted;)rdChar=CharsetService.getRandomChineseChar(),isExisted=$.inArray(rdChar,userInputChars)>-1;return rdChar}function deleteTip(tip,$index){$scope.wordTips.splice($index,1);var matchIndex;angular.forEach($scope.rows,function(row){angular.forEach(row,function(col){matchIndex=$.inArray(tip,col.tipsLinked),matchIndex>-1&&col.tipsLinked.splice($.inArray(tip,col.tipsLinked),1),col.selectedH=!1,col.selectedV=!1,col.forNewTipH=!1,col.forNewTipV=!1})}),isHorizontal(tip.direction)?$scope.rows[tip.x-1][tip.y-1].horizontalIndex=null:$scope.rows[tip.x-1][tip.y-1].verticalIndex=null,$scope.wordTips.length>$index&&angular.forEach($scope.wordTips,function(item,index){isHorizontal(item.direction)?$scope.rows[item.x-1][item.y-1].horizontalIndex=index+1:$scope.rows[item.x-1][item.y-1].verticalIndex=index+1})}var DIRECTION={HORIZONTAL:"horizontal",VERTICAL:"vertical"};$scope.LANGUAGE={CHINESE:"chinese",ENGLISH:"english"};var MAX_WIDTH=10,MAX_HEIGHT=10;$scope.errorModel={},$scope.model={title:"",skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/magicbox/wood/css/wood.css",name:$filter("translate")("magicbox.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/magicbox/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},border:{width:5,height:5},words:[],chars:[]},$rootScope.moduleScope=$scope,$scope.defaultTitleSetting={isCleared:!1,title:$filter("translate")("magicbox.default.title")},$scope.model.title=$scope.defaultTitleSetting.title;var loadingData=function(id){$scope.isloadingData=!0,CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?($scope.model=$scope.decodeData(rtnData),skin_service.set_skin_by_code($scope.model.skin.code,"v1")):($scope.showGuide=!0,$scope.model.id=rtnData.id,skin_service.set_skin_by_code($scope.model.skin.code,"v1")),$scope.errorModel.errorText="",$scope.isloadingData=!1,setValues(!1)):$scope.errorModel.errorText=$filter("translate")("magicbox.unvalidno")},function(error){$scope.errorModel.errorText=$filter("translate")("magicbox.get_title_error")})};$scope.wordTips=[],$scope.rows=[];var isHorizontal=function(direction){return direction==DIRECTION.HORIZONTAL},isNotEmptyArray=function(array){return $.isArray(array)&&array.length>0};$scope.typebox="largeBox";var setValues=function(isNew){if(isNew)for(var cols,rowNum=Math.min($scope.model.border.height,MAX_HEIGHT),colNum=Math.min($scope.model.border.width,MAX_WIDTH),i=1;i<=rowNum;i++){$scope.rows.push(cols=[]);for(var j=1;j<=colNum;j++)cols.push({x:i,y:j,tipsLinked:[]})}else{$scope.language=CharsetService.isChineseChar($scope.model.chars[0])?$scope.LANGUAGE.CHINESE:$scope.LANGUAGE.ENGLISH;for(var cols,rowNum=Math.min($scope.model.border.height,MAX_HEIGHT),colNum=Math.min($scope.model.border.width,MAX_WIDTH),charIndex=0,i=1;i<=rowNum;i++){$scope.rows.push(cols=[]);for(var j=1;j<=colNum;j++)cols.push({x:i,y:j,char:$scope.model.chars.length>charIndex?$scope.model.chars[charIndex++]:"",tipsLinked:[]})}adjustSize(rowNum>colNum?rowNum:colNum),angular.forEach($scope.model.words,function(item,index){var tip=angular.extend(item);$scope.wordTips.push(tip),tip.boxesLinked=[];for(var i=0;i<tip.word.length;i++)if(isHorizontal(tip.direction)){var box=$scope.rows[tip.x-1][tip.y-1+i];tip.boxesLinked.push(box),box.tipsLinked.push(tip),$scope.rows[item.x-1][item.y-1].horizontalIndex=index+1}else{var box=$scope.rows[tip.x-1+i][tip.y-1];tip.boxesLinked.push(box),box.tipsLinked.push(tip),$scope.rows[item.x-1][item.y-1].verticalIndex=index+1}})}};$stateParams.id?($scope.showGuide=!1,loadingData($stateParams.id)):($scope.showGuide=!0,skin_service.set_skin_by_code($scope.model.skin.code,"v1"),setValues(!0)),$scope.setQuestionLang=function(language){$scope.showGuide=!1,$scope.language=language},$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.validPostData=function(){var modelData=$scope.model;if(""!=$.trim(modelData.title)){var isOk=!0;return $scope.wordTips.length<3?($scope.errorModel.errorText=$filter("translate")("magicbox.least_tips"),isOk=!1):($.each($scope.wordTips,function(index,tip){if(!tip.hint||0==tip.hint.length)return $scope.errorModel.errorText=$filter("translate")("magicbox.empty_tip"),tip.actived=!0,focusElement($(".com_m_sidecon li input")[index]),isOk=!1,!1}),isOk&&(isOk=!checkDuplicateAnswer())),isOk}$scope.errorModel.errorText=$filter("translate")("magicbox.no_title")},$scope.encodeData=function(model){autoFillBoxes();var newModel=angular.copy(model);return newModel.title=window.customHtmlEncode(newModel.title),newModel.border.width=$scope.rows[0].length,newModel.border.height=$scope.rows.length,newModel.words=[],newModel.chars=[],angular.forEach($scope.rows,function(row){angular.forEach(row,function(col){newModel.chars.push(col.char)})}),angular.forEach($scope.wordTips,function(tip){newModel.words.push({x:tip.x,y:tip.y,word:tip.word,hint:tip.hint,direction:tip.direction})}),newModel},$scope.decodeData=function(model){var newModel=angular.copy(model);return newModel.title=window.customHtmlDecode(newModel.title),angular.forEach(newModel.words,function(item){item.hint=window.customHtmlDecode(item.hint)}),newModel};var timer,interval,slidingDirection,isReversed,startBox,boxesSelected,isMouseDown=!1;$scope.mousedown=function($event){var coordinate=getBoxCoordinate($event.target);coordinate&&coordinate.x&&coordinate.y&&(startBox=$scope.rows[coordinate.x-1][coordinate.y-1],startBox.char&&(isMouseDown=!0,boxesSelected=[],slidingDirection=null,startBox.forNewtipH=!0,$.inArray(startBox,boxesSelected)<=-1&&boxesSelected.push(startBox)))},$scope.mouseover=function($event){var coordinate=getBoxCoordinate($event.target);if(isMouseDown){if(null==slidingDirection&&boxesSelected.length>1)if(boxesSelected[0].x==boxesSelected[1].x)slidingDirection=DIRECTION.HORIZONTAL,isReversed=boxesSelected[0].y>boxesSelected[1].y;else{if(boxesSelected[0].y!=boxesSelected[1].y)return stopSliding(!0),!1;slidingDirection=DIRECTION.VERTICAL,isReversed=boxesSelected[0].x>boxesSelected[1].x,startBox.forNewtipH=!1,startBox.forNewtipV=!0,boxesSelected[1].forNewtipH=!1,boxesSelected[1].forNewtipV=!0}if(coordinate&&coordinate.x&&coordinate.y){var box=$scope.rows[coordinate.x-1][coordinate.y-1];!box.char||null!=slidingDirection&&!onRightDirection(slidingDirection,boxesSelected[boxesSelected.length-1],box)?stopSliding():selectBox(box)}else stopSliding(),angular.forEach(boxesSelected,function(box){box.forNewtipH=box.forNewtipV=!1})}if(!isMouseDown&&coordinate&&coordinate.x&&coordinate.y){var box=$scope.rows[coordinate.x-1][coordinate.y-1];isNotEmptyArray(box.tipsLinked)&&angular.forEach(box.tipsLinked,function(tip){tip.selected=!0,angular.forEach(tip.boxesLinked,function(box){isHorizontal(tip.direction)?box.selectedH=!0:box.selectedV=!0})})}},$scope.mouseup=function($event){if(isMouseDown){var coordinate=getBoxCoordinate($event.target);selectBox($scope.rows[coordinate.x-1][coordinate.y-1]),stopSliding()}},$scope.mouseleave=function($event,item){isNotEmptyArray(item.tipsLinked)&&angular.forEach(item.tipsLinked,function(tip){tip.selected=!1,tip.chars&&(tip.actived=!1),angular.forEach(tip.boxesLinked,function(box){box.selectedH=!1,box.selectedV=!1,isMouseDown||(box.forNewtipH=box.forNewtipV=!1)})})};var currentWordBox=null;$scope.activeWordBox=function(item,$event){item.actived||(null!=currentWordBox&&(currentWordBox.actived=!1),item.actived=!0,currentWordBox=item,$scope.textDirection=DIRECTION.HORIZONTAL,focusElement("DIV"==angular.uppercase($event.target.tagName)?$($event.target).find("input"):$($event.target).parents("div:first").find("input")))},$scope.keydownOnBoard=function($event){if(229==$event.keyCode||197==$event.keyCode)isChineseInput=!0,shouldIgnoreTextChange=!1;else if(isChineseInput=!1,currentWordBox)switch($event.keyCode){case 8:!currentWordBox.char&&currentWordBox.y>1&&focusWordBox($scope.rows[currentWordBox.x-1][currentWordBox.y-2]);break;case 13:$scope.textDirection=DIRECTION.VERTICAL;break;case 37:currentWordBox.y>1&&focusWordBox($scope.rows[currentWordBox.x-1][currentWordBox.y-2]);break;case 38:currentWordBox.x>1&&focusWordBox($scope.rows[currentWordBox.x-2][currentWordBox.y-1]);break;case 39:currentWordBox.y<$scope.rows[0].length?focusWordBox($scope.rows[currentWordBox.x-1][currentWordBox.y]):currentWordBox.y<MAX_WIDTH&&extendsWordBox(DIRECTION.HORIZONTAL,currentWordBox,1);break;case 40:currentWordBox.x<$scope.rows.length?focusWordBox($scope.rows[currentWordBox.x][currentWordBox.y-1]):currentWordBox.x<MAX_HEIGHT&&extendsWordBox(DIRECTION.VERTICAL,currentWordBox,1)}};var isChineseInput=!1,shouldIgnoreTextChange=!1,getItemChars=function(item){var chars;return chars=$scope.language==$scope.LANGUAGE.CHINESE?CharsetService.getChineses(item.char):CharsetService.getAlphabets(item.char).toLowerCase()};$scope.changeOnBox=function($event,item){if(shouldIgnoreChange(item)){var chars=getItemChars(item);return void(chars&&chars.length>0?item.char=chars.charAt(0):item.char="")}shouldIgnoreTextChange=!0;var chars=getItemChars(item);if(isHorizontal($scope.textDirection)){var colNum=$scope.rows[0].length,fromBox=item;if(chars.length>0)if(item.y==MAX_WIDTH)item.char=chars.charAt(chars.length-1);else{item.char=chars.charAt(0);for(var i=0;i<chars.length-1;i++)item.y+i<colNum&&(fromBox=$scope.rows[item.x-1][item.y+i],fromBox.char=chars.charAt(i+1));if(item.y+chars.length>colNum&&colNum<MAX_WIDTH){var extendNum=Math.min(MAX_WIDTH-colNum,item.y+chars.length-colNum-1);extendsWordBox($scope.textDirection,fromBox,extendNum,chars.substring(fromBox.y-item.y+1))}else fromBox!=item&&focusWordBox(fromBox)}else item.char=""}else{var rowNum=$scope.rows.length,fromBox=item;if(chars.length>0)if(item.x==MAX_HEIGHT)item.char=chars.charAt(chars.length-1);else{item.char=chars.charAt(0);for(var i=0;i<chars.length-1;i++)item.x+i<rowNum&&(fromBox=$scope.rows[item.x+i][item.y-1],fromBox.char=chars.charAt(i+1));if(item.x+chars.length>rowNum&&rowNum<MAX_HEIGHT){var extendNum=Math.min(MAX_HEIGHT-rowNum,item.x+chars.length-rowNum-1);extendsWordBox($scope.textDirection,fromBox,extendNum,chars.substring(fromBox.x-item.x+1))}else fromBox!=item&&focusWordBox(fromBox)}else item.char=""}angular.forEach($scope.wordTips,function(tip){var word="";angular.forEach(tip.boxesLinked,function(box){word+=box.char}),tip.word=word})},$scope.blurOnBox=function($event,item){if(item.actived=!1,!item.char||0==item.char.length){item.horizontalIndex=null,item.verticalIndex=null;for(var length=item.tipsLinked.length,i=0;i<length;i++){var tip=item.tipsLinked[0];deleteTip(tip,$.inArray(tip,$scope.wordTips))}}},$scope.removeRow=function($event,item,$index){angular.forEach($scope.rows[$index],function(box){for(var length=box.tipsLinked.length,i=0;i<length;i++){var tip=box.tipsLinked[0],tipIndex=$.inArray(tip,$scope.wordTips);tipIndex>-1&&deleteTip(tip,tipIndex)}});$scope.rows.splice($index,1)[0];adjustSize($scope.rows.length>$scope.rows[0].length?$scope.rows.length:$scope.rows[0].length),updateXY()},$scope.removeCol=function($event,$index){angular.forEach($scope.rows,function(row){for(var box=row[$index],length=box.tipsLinked.length,i=0;i<length;i++){var tip=box.tipsLinked[0],tipIndex=$.inArray(tip,$scope.wordTips);tipIndex>-1&&deleteTip(tip,tipIndex)}}),angular.forEach($scope.rows,function(row){row.splice($index,1)}),adjustSize($scope.rows.length>$scope.rows[0].length?$scope.rows.length:$scope.rows[0].length),updateXY()},$scope.clearWords=function(){$scope.wordTips=[],angular.forEach($scope.rows,function(row,indexX){angular.forEach(row,function(col,indexY){col.char="",col.tipsLinked=[],col.horizontalIndex=null,col.verticalIndex=null})})};var currentTipBox;$scope.activeTipBox=function(item,$event){currentTipBox&&(currentTipBox.actived=!1),item.actived=!0,currentTipBox=item,focusElement("LI"==angular.uppercase($event.target.tagName)?$($event.target).find("input"):$($event.target).parents("li:first").find("input"))},$scope.tipOnBlur=function(item){item.actived=!1},$scope.tipOnOver=function(item){item.selected=!0,angular.forEach(item.boxesLinked,function(box){isHorizontal(item.direction)?box.selectedH=!0:box.selectedV=!0})},$scope.tipOnOut=function(item){item.selected=!1,angular.forEach(item.boxesLinked,function(box){isHorizontal(item.direction)?box.selectedH=box.forNewtipH=!1:box.selectedV=box.forNewtipV=!1})},$scope.saveTip=function($event,item){13==$event.keyCode&&(item.actived=!1)},$scope.removeTip=function($event,tip,$index){deleteTip(tip,$index),$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1}}])});