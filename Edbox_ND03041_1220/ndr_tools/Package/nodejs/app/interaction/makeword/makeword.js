define("makeword/directive/makeword.directive",["components/site-directive/assets-select/assets-select","components/site-directive/error-tip/error-tip","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/confirm-popup/confirm-popup","components/site-directive/foot-tool/foot-tool"],function(){}),define("makeword/service/RestPingYingService",["angularAMD"],function(angularAMD){"use strict";angularAMD.service("PinYingService",["RestPinYingEditor","$stateParams","$filter",function(RestPinYingEditor,$stateParams,$filter){return{getPinYing:function(character){return RestPinYingEditor().one("pinyins").getList("",{character:character})}}}])}),define(["app","makeword/directive/makeword.directive","makeword/service/RestPingYingService","css!makeword/assets/css/style_wood.css"],function(app){"use strict";function initContent(type){return{type:type,pages:[initPage(type)]}}function initPage(type){var page={title:"",character:"",hidePinyin:!1,items:[]};return type==QUESTION_TYPE_XJZ&&(page.items=[initItem(),initItem()]),page}function initItem(character,answerCount){var item={character:character||"",answers:[]};answerCount=answerCount||1;for(var i=0;i<answerCount;i++)item.answers.push(0);return item}function initPageShowStates(len){var states=new Array(len);states[0]=!0;for(var i=1;i<len;i++)states[i]=!1;return states}var QUESTION_TYPE_DYZ=0,QUESTION_TYPE_XJZ=1;config.slides_host+"/v2.0/pinyins";Array.prototype.fill=function(value,start,end){start||(start=0),end||(end=this.length);for(var i=start;i<end;i++)this[i]=value};var getDefaultPlaceholder=function(model,$filter){if(jQuery.isEmptyObject(model.content))return"组词";var type=model.content.type;return $filter("translate")(type==QUESTION_TYPE_DYZ?"makeword.title.dyz":"makeword.title.xjz")};app.controller("makeword.contentController",["$scope","$filter",function($scope,$filter){$(".spell_content").mouseover(function(){$(this).addClass("on")}).mouseout(function(){$(this).removeClass("on")}),$scope.view={pageShowStates:initPageShowStates(2),allowAddPage:!0,allowDelPage:!0,showConfirmPopup:!1,confirmPopupMessage:$filter("translate")("makeword.message.delete.page")},$scope.initContent=function(type){$scope.model.content=initContent(type),$scope.model.placeholder=getDefaultPlaceholder($scope.model,$filter),$scope.model.title==$scope.model.placeholder&&($scope.model.title="")},$scope.$watch(function(){return $scope.model.content.pages&&$scope.model.content.pages.length},function(newValue){$scope.view.allowAddPage=newValue<10,$scope.view.allowDelPage=newValue>=2}),$scope.switchPage=function(index){$scope.view.pageShowStates.fill(!1);var lastPageIndex=$scope.model.content.pages.length-1;index>lastPageIndex?$scope.view.pageShowStates[lastPageIndex]=!0:$scope.view.pageShowStates[index]=!0},$scope.addPage=function(){$scope.model.content.pages.push(initPage($scope.model.content.type)),$scope.switchPage($scope.model.content.pages.length-1)},$scope.delPage=function(index){""==$scope.model.content.pages[index].character?($scope.model.content.pages.splice(index,1),$scope.switchPage(index)):($scope.view.showConfirmPopup=!0,$scope.delPageIndex=index)},$scope.confirmPopup=function(){var index=$scope.delPageIndex;$scope.model.content.pages.splice(index,1),$scope.switchPage(index),$scope.view.showConfirmPopup=!1,$scope.delPageIndex=-1}}]),app.controller("makeword.pageController",["$scope","$http","$filter","PinYingService","$timeout",function($scope,$http,$filter,PinYingService,$timeout){$scope.model.content.type==QUESTION_TYPE_DYZ?$scope.$watch("page.character",function(value){if(value){if(" "!=value&&!value.match(/^[\u4e00-\u9fa5]$/))return $scope.page.character="",$scope.page.title="",void $timeout(function(){});$scope.page.title=value}}):$scope.$watch(function(){return $scope.page.items[0]&&$scope.page.items[0].character},function(newValue){$scope.page.title=newValue}),$scope.isInitialized=function(){return $scope.page.items.length>0},$scope.generatePinyin=function(){$scope.page.character&&($scope.generating=!0,PinYingService.getPinYing($scope.page.character).then(function(data){$scope.generating=!1;var pinyins=data;if(pinyins&&pinyins.length>1)for(var i=0;i<pinyins.length;i++)$scope.page.items.push(initItem(pinyins[i]));else $scope.errorModel.errorText=$filter("translate")("makeword.error.text.empty.pinyin")},function(){$scope.errorModel.errorText=$filter("translate")("makeword.error.text.generate.pinyin"),$scope.generating=!1}))},$scope.view2={pinyinButtonLabel:$filter("translate")($scope.page.hidePinyin?"makeword.button.pinyin.label.show":"makeword.button.pinyin.label.hide")},$scope.showPinyin=function(){$scope.page.hidePinyin=!$scope.page.hidePinyin,$scope.view2.pinyinButtonLabel=$filter("translate")($scope.page.hidePinyin?"makeword.button.pinyin.label.show":"makeword.button.pinyin.label.hide")},$scope.addItem=function(){$scope.page.items.length>=6||$scope.page.items.push(initItem())}}]),app.controller("makeword.itemController",["$scope","$timeout",function($scope,$timeout){$scope.view={allowAddAnswer:!0,allowDelAnswer:!0},$scope.$watch(function(){return $scope.item.answers.length},function(newValue){$scope.view.allowAddAnswer=newValue<3,$scope.view.allowDelAnswer=newValue>1}),$scope.addAnswer=function(){$scope.item.answers.push(0)},$scope.delAnswer=function(){$scope.item.answers.pop()},$scope.delItem=function(index){$scope.page.items.splice(index,1)},$scope.$watch("item.character",function(value){if($scope.model.content.type!=QUESTION_TYPE_DYZ)return value&&" "==!value&&!value.match(/^[\u4e00-\u9fa5]$/)?($scope.item.character="",void $timeout(function(){})):void 0})}]),app.controller("makeword_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","$rootScope","$filter",function($scope,skin_service,$stateParams,CustomEditorService,$rootScope,$filter){$rootScope.moduleScope=$scope,$scope.errorModel={},$scope.model={id:"",module_code:"nd_makeword",title:"",placeholder:"组词",skin:{code:"wood",css_url:"",name:$filter("translate")("app.skin.wood"),package_url:""},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},properties:[{name:"question_id",display_name:"习题内容",type:"string",value:"",is_localized:!1},{name:"question_url",display_name:"题目内容",type:"jsonFile",value:"",is_localized:!1}],content:{}};var loadingData=function(id){$scope.isloadingData=!0,CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?$scope.model=$scope.decodeData(rtnData,!0):$scope.model.id=rtnData.id,skin_service.set_skin_by_code($scope.model.skin.code,"v1"),$scope.errorModel.errorText="",$scope.isloadingData=!1):$scope.errorModel.errorText=$filter("translate")("app.unvalidno")},function(error){$scope.errorModel.errorText=$filter("translate")("app.question.get.error")})};$scope.emptyContent=function(){return jQuery.isEmptyObject($scope.model.content)},$stateParams.id?loadingData($stateParams.id):skin_service.set_skin_by_code($scope.model.skin.code,"v1"),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.validPostData=function(){var modelData=$scope.model;$scope.errorModel.errorText="",""==$.trim(modelData.title)&&(modelData.title=$scope.model.placeholder);for(var pages=modelData.content.pages,i=0;i<pages.length;i++)pages[i].items.length<2?$scope.errorModel.errorText=$filter("translate")("makeword.items.length.less2"):""==pages[i].items[0].character&&($scope.errorModel.errorText=$filter("translate")("makeword.items.first.empty"));return!$scope.errorModel.errorText},$scope.encodeData=function(model){return model},$scope.decodeData=function(model,isInitLoad){return model.placeholder=getDefaultPlaceholder(model,$filter),model.title==model.placeholder&&(model.title=""),model}}])});