define("order/directive/order.directive",["components/site-directive/assets-select/assets-select","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","components/site-directive/error-tip/error-tip","components/site-directive/image-transform/image-transform","components/site-directive/contenteditable/contenteditable","components/site-directive/insert-media-box/insert-media-box"],function(){}),define(["app","order/directive/order.directive"],function(app){"use strict";app.controller("order_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","UtilsService","$rootScope","$filter",function($scope,skin_service,$stateParams,CustomEditorService,UtilsService,$rootScope,$filter){$scope.errorModel={},$scope.MAX_OPTIONS=8,$scope.MIN_OPTIONS=3,$scope.model={description:{text:"",asset_type:"",asset:"",image_extend:{rotate:"",resize:""}},title:$filter("translate")("order.order_type"),skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/order/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/order/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"},items:[{},{},{}]},$rootScope.moduleScope=$scope,$scope.defaultTitleSetting={isCleared:!1,title:$filter("translate")("order.default.title")},$scope.model.description.text=$scope.defaultTitleSetting.title,$scope.onFocusTitle=function(event){$scope.focusTextBox=!0,$scope.model.description.text==$scope.defaultTitleSetting.title&&setTimeout(function(){UtilsService.selectAllText(event.target)},150)},$scope.onBlurTitle=function(event){$scope.focusTextBox=!1,$scope.defaultTitleSetting.titleTarget||($scope.defaultTitleSetting.titleTarget=event.target),$.trim($scope.model.description.text)?$scope.defaultTitleSetting.isCleared=!1:($scope.defaultTitleSetting.isCleared=!0,$scope.model.description.text=$scope.defaultTitleSetting.title)};var loadingData=function(id){CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?angular.extend($scope.model,$scope.decodeData(rtnData)):$scope.model.id=rtnData.id,$scope.errorModel.errorText="",skin_service.set_skin_by_code($scope.model.skin.code,"v1")):$scope.errorModel.errorText=$filter("translate")("linkup.unvalidno")},function(){$scope.errorModel.errorText=$filter("translate")("linkup.get_title_error")})};$stateParams.id?($scope.showGuide=!1,loadingData($stateParams.id)):($scope.showGuide=!0,skin_service.set_skin_by_code($scope.model.skin.code,"v1")),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml()}),$scope.validPostData=function(){var modelData=$scope.model;if(""==$.trim(modelData.description.text))$scope.errorModel.errorText=$filter("translate")("table.notnull.desc");else{var itemsCount=0,newData=[];if(angular.forEach(modelData.items,function(value,index){""!==$.trim(value.text)&&(itemsCount++,newData.push(value))}),!(itemsCount<$scope.MIN_OPTIONS))return _.remove(modelData.items,function(item){return""==$.trim(item.text)}),!0;$scope.errorModel.errorText=$filter("translate")("order.unvalid.count")}},$scope.addItem=function($index){$scope.model.items.push({})},$scope.removeItem=function($index){$scope.model.items.splice($index,1)},$scope.encodeData=function(model){var newModel=angular.copy(model);newModel.description.text=window.customHtmlEncode(newModel.description.text);for(var i=0;i<newModel.items.length;i++)newModel.items[i].text=window.customHtmlEncode(newModel.items[i].text);return newModel},$scope.decodeData=function(model){var newModel=angular.copy(model);newModel.description.text=window.customHtmlDecode(newModel.description.text);for(var i=0;i<newModel.items.length;i++)newModel.items[i].text=window.customHtmlDecode(newModel.items[i].text);return newModel},$scope.sortTaskItem={handle:"> div.sort_handler",stop:function(e,ui){ui.item.scope().$index}}}])});