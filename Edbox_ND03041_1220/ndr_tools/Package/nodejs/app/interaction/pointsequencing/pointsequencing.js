define("pointsequencing/directive/point/point",["angularAMD"],function(angularAMD){angularAMD.directive("point",["$filter","$timeout",function($filter,$timeout){return{restrict:"AE",replace:!0,templateUrl:"interaction/pointsequencing/directive/point/point.html",scope:{opt:"=",panel:"=",errorModel:"=",panelEvent:"="},controller:["$scope","$element","$compile","$timeout",function($scope,$element,$compile,$timeout){$("div.point",$element).draggable({containment:"#pointsequencing-img",start:function(event,ui){$scope.$apply(function(){$scope.info.opacity=.65,$scope.info.lastPosition.x=$scope.opt.x,$scope.info.lastPosition.y=$scope.opt.y,$scope.panel.display="none",$scope.exec.stopOtherPointEdit()})},stop:function(event,ui){$scope.$apply(function(){return $scope.info.opacity=.65,$scope.opt.x=ui.position.left-$scope.panel.position.left,$scope.opt.y=ui.position.top-$scope.panel.position.top,$scope.panelEvent.checkPointEdge($scope.opt),$scope.panel.display="inline-block",$scope.panelEvent.checkPointOverlay($scope.opt)?void $timeout(function(){$scope.opt.x=$scope.info.lastPosition.x,$scope.opt.y=$scope.info.lastPosition.y},100):void $scope.panelEvent.checkPointLegal()})}}),$scope.opt.stopEdit=function(){$scope.info.opacity=.65,$scope.opt.contentEditable=!1;var $input=$("input.point-editor",$element);$input.length>0&&($scope.opt.value=$input.val(),$input.remove()),$scope.panelEvent.updateShowValue()},$scope.info={opacity:.65,lastPosition:{x:0,y:0}},$scope.exec={};var lastValue=$scope.opt.value;$scope.exec.stopOtherPointEdit=function(){$timeout(function(){var i,len;for(i=0,len=$scope.panel.points.length;i<len;i++)$scope.panel.points[i].contentEditable===!0&&$scope.panel.points[i].stopEdit()})},$scope.exec.mouseenter=function(){$scope.panel.enterPoint=!0},$scope.exec.mouseleave=function(){$scope.panel.enterPoint=!1},$scope.exec.select=function(event){$scope.panelEvent.selectPoint($scope.opt),event.stopPropagation()},$scope.exec.editValue=function(){function checkNum(input){var re=/^[0-9]*$/;return re.test(input)}function checkChar(input){var re=/^[A-Za-z]*$/;return re.test(input)}function checkChinese(input){var reg=new RegExp("[\\u4E00-\\u9FFF]+","g");return reg.test(input)}function checkDuplicate(input){var i,len;for(i=0,len=$scope.panel.points.length;i<len;i++)if($scope.panel.points[i]!=$scope.opt&&$scope.panel.points[i].value===input)return!0;return!1}$scope.info.opacity=1,$scope.panelEvent.startEditPoint($scope.opt);var $input=($scope.opt.value,$('<input class="point-editor" ng-model="opt.value" type="text" ng-style="{lineHeight:panel.pointSize.height+\'px\'}"style="position:relative;color: #bd1300;font-weight: 700;width: 100%;height: 100%;text-align: center;background-color: transparent;border: 0px"/>'));$compile($input)($scope).appendTo($("div.point",$element)),$input.get(0).addEventListener("change",function(){var value=$input.val();if(checkDuplicate(value))return $input.val(lastValue),$scope.errorModel.errorText=$filter("translate")("pointsequencing.pointvalue_duplicate"),$scope.errorModel.dismissErrorTip(1e3),void $scope.$apply();if(checkNum(value)){if(value.length>3)return $input.val(lastValue),$scope.errorModel.errorText=$filter("translate")("pointsequencing.input.error"),$scope.errorModel.dismissErrorTip(1e3),$scope.panelEvent.clearStatus(),void $scope.$apply()}else if(checkChar(value)){if(value.length>1)return $input.val(value.substring(0,1)),$scope.errorModel.errorText=$filter("translate")("pointsequencing.input.error"),$scope.errorModel.dismissErrorTip(1e3),$scope.panelEvent.clearStatus(),void $scope.$apply()}else if(checkChinese(value)){if(value.length>1)return $input.val(lastValue),$scope.errorModel.errorText=$filter("translate")("pointsequencing.input.error"),$scope.errorModel.dismissErrorTip(1e3),$scope.panelEvent.clearStatus(),void $scope.$apply()}else if(value.length>0)return $input.val(lastValue),$scope.errorModel.errorText=$filter("translate")("pointsequencing.input.error"),$scope.errorModel.dismissErrorTip(1e3),$scope.panelEvent.clearStatus(),void $scope.$apply();lastValue=value}),$input.bind("keypress",function(event){"13"==event.keyCode&&$timeout(function(){$scope.panelEvent.clearStatus()})}),$input.focus()}}]}}])}),define("pointsequencing/directive/pointsequencing.directive",["components/site-directive/assets-select/assets-select","components/site-directive/edit-box/new-edit-box","components/site-directive/foot-tool/time-box/new-time-box","components/site-directive/foot-tool/foot-tool","components/site-directive/select-skin/select-skin","components/site-directive/error-tip/error-tip","components/site-directive/image-transform/image-transform","pointsequencing/directive/point/point"],function(){}),define(["app","./directive/pointsequencing.directive","jqueryui"],function(app){"use strict";app.controller("pointsequencing_ctrl",["$scope","skin_service","$stateParams","CustomEditorService","$rootScope","$filter","$timeout","$http","$compile",function($scope,skin_service,$stateParams,CustomEditorService,$rootScope,$filter,$timeout,$http,$compile){function segmentsIntr(a,b,c,d){var area_abc=(a.x-c.x)*(b.y-c.y)-(a.y-c.y)*(b.x-c.x),area_abd=(a.x-d.x)*(b.y-d.y)-(a.y-d.y)*(b.x-d.x);if(area_abc*area_abd>=0)return!1;var area_cda=(c.x-a.x)*(d.y-a.y)-(c.y-a.y)*(d.x-a.x),area_cdb=area_cda+area_abc-area_abd;if(area_cda*area_cdb>=0)return!1;var t=area_cda/(area_abd-area_abc),dx=t*(b.x-a.x),dy=t*(b.y-a.y);return{x:a.x+dx,y:a.y+dy}}function updateInfo(url,clearPoints){function filter(input){return input?$filter("filterRefPath")(input):""}function setScaleSizes(sizeBeyond){$scope.info.scaleSize=[];var i,imgWh,adjustWh,width=0,height=0,containterWidth=$("#pointsequencing-containter").width()-20,containterHeight=$("#pointsequencing-containter").height()-20;if($scope.info.adjustSize.width=5*containterWidth/7,$scope.info.adjustSize.height=5*containterHeight/7,$scope.info.maxWidth=containterWidth,$scope.info.maxHeight=containterHeight,imgWh=$scope.info.oriWidth/$scope.info.oriHeight,adjustWh=$scope.info.adjustSize.width/$scope.info.adjustSize.height,imgWh>adjustWh){for(width=$scope.info.adjustSize.width,height=$scope.info.oriHeight*width/$scope.info.oriWidth,$scope.info.scaleSize.push({width:width,height:height}),i=0;i<2;i++)width+=35,height=$scope.info.oriHeight*width/$scope.info.oriWidth,$scope.info.scaleSize.push({width:width,height:height});width=$scope.info.adjustSize.width;var size;for(i=0;i<$scope.info.firstScalePosition;i++)width-=35,height=$scope.info.oriHeight*width/$scope.info.oriWidth,size={width:width,height:height},$scope.info.scaleSize.splice(0,0,size)}else{for(height=$scope.info.adjustSize.height,width=$scope.info.oriWidth*height/$scope.info.oriHeight,$scope.info.scaleSize.push({width:width,height:height}),i=0;i<2;i++)height+=25,width=$scope.info.oriWidth*height/$scope.info.oriHeight,$scope.info.scaleSize.push({width:width,height:height});height=$scope.info.adjustSize.height;var size;for(i=0;i<$scope.info.firstScalePosition;i++)height-=25,width=$scope.info.oriWidth*height/$scope.info.oriHeight,size={width:width,height:height},$scope.info.scaleSize.splice(0,0,size)}if(0==$scope.info.isNew)for(i=0;i<$scope.info.scaleSize.length;i++)if(imgWh>adjustWh){if(Math.abs($scope.info.scaleSize[i].width/$scope.info.oriWidth-$scope.info.background.scale)<1e-6){$scope.info.firstScalePosition=i;break}}else if(Math.abs($scope.info.scaleSize[i].height/$scope.info.oriHeight-$scope.info.background.scale)<1e-6){$scope.info.firstScalePosition=i;break}$scope.info.currentScalePosition=$scope.info.firstScalePosition,ScrollBar.maxValue=$scope.info.scaleSize.length-1,ScrollBar.Initialize()}function getImgUuid(url){if(url){var headTag="/assets/",footTag=".pkg",headIndex=url.indexOf(headTag)+headTag.length,footIndex=url.indexOf(footTag),uuid=url.substring(headIndex,footIndex);return uuid}}function reset(){$scope.info.background.url=url,$scope.info.imgSrc=$scope.info.background.url;var sizeBeyond=!1;if(sizeBeyond=img.width>$scope.info.maxWidth||img.height>$scope.info.maxHeight,$scope.info.ratio=img.width/img.height,setScaleSizes(sizeBeyond),clearPoints!==!1&&($scope.info.points=[],$scope.info.value=1),0==$scope.info.isNew){var i;for(i=0;i<$scope.info.scaleSize.length;i++)if(Math.abs($scope.info.oriHeight*$scope.info.background.scale-$scope.info.scaleSize[i].height)<.01&&Math.abs($scope.info.oriWidth*$scope.info.background.scale-$scope.info.scaleSize[i].width)<.01){$scope.info.currentScalePosition=i;break}}calImagePosition(),$img.width($scope.info.scaleSize[$scope.info.currentScalePosition].width),$img.height($scope.info.scaleSize[$scope.info.currentScalePosition].height),$scope.info.currentImageSize.width=$scope.info.scaleSize[$scope.info.currentScalePosition].width,$scope.info.currentImageSize.height=$scope.info.scaleSize[$scope.info.currentScalePosition].height,ScrollBar.setValue($scope.info.currentScalePosition),$scope.info.isNew=!0}var img=new Image;img.src=filter(url),url&&($scope.errorModel.errorText=$filter("translate")("pointsequencing.loading")),img.onload=function(){$scope.info.oriWidth=img.width,$scope.info.oriHeight=img.height;var preHost=window.config.lifecycle_host,uuid=getImgUuid(url),address=preHost+"/v0.6/assets/"+uuid+"?include=TI,LC,EDU,CG,CR";$http({method:"GET",url:address}).success(function(data,status,headers,config){200===status&&$timeout(function(){var imgSize=data.tech_info.href.size;$scope.errorModel.dismissErrorTip(100),imgSize/1024/1024>10?($scope.info.background.url="",$scope.errorModel.errorText=$filter("translate")("pointsequencing.imagesize"),$scope.errorModel.dismissErrorTip(1e3)):reset()})}).error(function(data,status,headers,config){$scope.errorModel.dismissErrorTip(100),reset()})}}function afterDeletePoint(index){if($scope.info.value>1&&$scope.info.value--,$scope.info.enterPoint=!1,index<$scope.info.points.length)for(var i=index;i<$scope.info.points.length;i++)$scope.info.points[i].value=i+1}function getNewPointValue(){var maxValue=1,i=0,len=0,curValue=0,isExist=!1;for(i=0,len=$scope.info.points.length;i<len;i++)$.isNumeric($scope.info.points[i].value)&&(curValue=Number($scope.info.points[i].value),maxValue=curValue>maxValue?curValue:maxValue);if(maxValue>=999)for(i=1;i<999;i++){for(var j=0;j<len;j++)if($.isNumeric($scope.info.points[j].value)&&(curValue=Number($scope.info.points[j].value),curValue===i)){isExist=!0;break}if(!isExist){$scope.info.value=i;break}isExist=!1}else $scope.info.value=maxValue+1}function calImagePosition(isAdjust){var parent=$img.parent(),parentWidth=parent.width(),parentHeight=parent.height(),imgWidth=isAdjust?$scope.info.scaleSize[$scope.info.firstScalePosition].width:$scope.info.scaleSize[$scope.info.currentScalePosition].width,imgHeight=isAdjust?$scope.info.scaleSize[$scope.info.firstScalePosition].height:$scope.info.scaleSize[$scope.info.currentScalePosition].height;$scope.info.position.left=(parentWidth-imgWidth)/2,$scope.info.position.top=(parentHeight-imgHeight)/2,$scope.info.background.scale=imgWidth/$scope.info.oriWidth}function updatePointPosition(oriWidth,newWidth,oriHeight,newHeight){var i,len,point;for(i=0,len=$scope.info.points.length;i<len;i++)point=$scope.info.points[i],point.x=newWidth*point.x/oriWidth,point.y=newHeight*point.y/oriHeight}function fun(){$timeout(function(){var containterWidth=$("#pointsequencing-containter").width()-20,containterHeight=$("#pointsequencing-containter").height()-20;$scope.info.adjustSize.width=5*containterWidth/7,$scope.info.adjustSize.height=5*containterHeight/7,$scope.info.maxWidth=containterWidth,$scope.info.maxHeight=containterHeight;var img=new Image;img.src=$filter("filterRefPath")($scope.info.background.url);var sizeBeyond=!1;if(sizeBeyond=img.width>$scope.info.maxWidth||img.height>$scope.info.maxHeight,$scope.info.ratio=img.width/img.height,setScaleSizesEx(sizeBeyond),calImagePosition(),$img.width($scope.info.scaleSize[$scope.info.currentScalePosition].width),$img.height($scope.info.scaleSize[$scope.info.currentScalePosition].height),$scope.info.currentImageSize.width=$scope.info.scaleSize[$scope.info.currentScalePosition].width,$scope.info.currentImageSize.height=$scope.info.scaleSize[$scope.info.currentScalePosition].height,ScrollBar.setValue($scope.info.currentScalePosition),""!==$scope.info.background.url){var position=$scope.info.currentScalePosition;$scope.event.scaleTo(position),$scope.event.scaleImg(!1)}},300)}function setScaleSizesEx(sizeBeyond){$scope.info.scaleSize=[];var i,imgWh,adjustWh,width=0,height=0;if(imgWh=$scope.info.oriWidth/$scope.info.oriHeight,adjustWh=$scope.info.adjustSize.width/$scope.info.adjustSize.height,imgWh>adjustWh){for(width=$scope.info.adjustSize.width,height=$scope.info.oriHeight*width/$scope.info.oriWidth,$scope.info.scaleSize.push({width:width,height:height}),i=0;i<2;i++)width+=35,height=$scope.info.oriHeight*width/$scope.info.oriWidth,$scope.info.scaleSize.push({width:width,height:height});width=$scope.info.adjustSize.width;var size;for(i=0;i<$scope.info.firstScalePosition;i++)width-=35,height=$scope.info.oriHeight*width/$scope.info.oriWidth,size={width:width,height:height},$scope.info.scaleSize.splice(0,0,size)}else{for(height=$scope.info.adjustSize.height,width=$scope.info.oriWidth*height/$scope.info.oriHeight,$scope.info.scaleSize.push({width:width,height:height}),i=0;i<2;i++)height+=25,width=$scope.info.oriWidth*height/$scope.info.oriHeight,$scope.info.scaleSize.push({width:width,height:height});height=$scope.info.adjustSize.height;var size;for(i=0;i<$scope.info.firstScalePosition;i++)height-=25,width=$scope.info.oriWidth*height/$scope.info.oriHeight,size={width:width,height:height},$scope.info.scaleSize.splice(0,0,size)}ScrollBar.Initialize()}$scope.errorModel={},$scope.delData={data:{}},$scope.model={skin:{code:"wood",css_url:"${ref-path}/edu/esp/preparecustomeditor/pointsequencing/wood/css/wood.css",name:$filter("translate")("linkup.muwen"),package_url:"${ref-path}/edu/esp/preparecustomeditor/pointsequencing/wood"},timer:{timer_type:"sequence",time_minute:"0",time_second:"0"}},$rootScope.moduleScope=$scope,$scope.defaultTitleSetting={isCleared:!1,title:$filter("translate")("pointsequencing.default.title")},$scope.model.title=$scope.defaultTitleSetting.title,$scope.LabelAddImage=$filter("translate")("pointsequencing.image.add"),$scope.LabelChangeImage=$filter("translate")("pointsequencing.image.change");var loadingData=function(id){$scope.isloadingData=!0,CustomEditorService.getQuestionInfoById(id).then(function(rtnData){rtnData?(""!=rtnData.skin.code?($scope.model=$scope.decodeOrder(rtnData),skin_service.set_skin_by_code($scope.model.skin.code,"v1")):($scope.showGuide=!0,$scope.model.id=rtnData.id,skin_service.set_skin_by_code($scope.model.skin.code,"v1")),$scope.errorModel.errorText="",$scope.isloadingData=!1,null!==rtnData.background?($scope.info.isNew=!1,$scope.info.background=rtnData.background,$scope.info.background.scale=rtnData.background.scale,null!=rtnData.points&&($scope.info.points=rtnData.points,$scope.event.updateShowValue())):($scope.info.isNew=!0,$scope.info.background.url="",$scope.info.background.scale=1)):($scope.errorModel.errorText=$filter("translate")("pointsequencing.unvalidno"),$scope.errorModel.dismissErrorTip(1e3))},function(error){$scope.errorModel.errorText=$filter("translate")("pointsequencing.get_title_error"),$scope.errorModel.dismissErrorTip(1e3)})};$stateParams.id?($scope.showGuide=!1,loadingData($stateParams.id)):($scope.showGuide=!0,skin_service.set_skin_by_code($scope.model.skin.code,"v1")),$scope.$on("changgedSkin",function(){$rootScope.scaleHtml(function(){$scope.info.background.url&&updateInfo($scope.info.background.url,!1)})}),$scope.validPostData=function(){for(var p,i=0,len=$scope.info.points.length;i<len;i++)p=$scope.info.points[i],1==p.contentEditable&&(p.contentEditable=!1);var modelData=$scope.model;if(""==$.trim(modelData.title))$scope.errorModel.errorText=$filter("translate")("pointsequencing.no_title"),$scope.errorModel.dismissErrorTip(1e3);else if($scope.info.points.length<=2)$scope.errorModel.errorText=$filter("translate")("pointsequencing.pointnum_noenough"),$scope.errorModel.dismissErrorTip(1e3);else if($scope.event.checkPointLegal()!==!1)return modelData.background=$scope.info.background,modelData.points=$scope.info.points,!0},$scope.errorModel.dismissErrorTip=function(delay){$timeout(function(){$scope.errorModel.errorText=""},delay)},$scope.encodeOrder=function(model){return model},$scope.decodeOrder=function(model){return model},$scope.addAssets=function(asset_type){asset_type&&($scope.info.background.scale=0,$scope.info.currentScalePosition=-1,updateInfo($scope.info.description.asset))};var ScrollBar={value:0,maxValue:100,scrollWidth:0,step:1,currentX:0,Initialize:function(){this.getValue(),this.scrollWidth=$(".progress_bar").width(),this.Value(),$(".scroll_Thumb").draggable(""===$scope.info.background.url?"disable":"enable")},Value:function(){var currentValue,valite=!1;$(".scroll_Thumb").draggable({containment:".progress",start:function(event,ui){valite=!0},drag:function(event,ui){0!=valite&&(currentValue=ui.position.left,ScrollBar.currentX=currentValue,ScrollBar.value=Math.round(ScrollBar.maxValue*(currentValue/ScrollBar.scrollWidth)),$scope.$apply(function(){$scope.event.scaleTo(ScrollBar.value)}))},stop:function(event,ui){$(".scroll_Thumb").css({left:ScrollBar.currentX+"px"}),ScrollBar.value=Math.round(ScrollBar.maxValue*(currentValue/ScrollBar.scrollWidth)),$scope.$apply(function(){$scope.event.scaleTo(ScrollBar.value),ScrollBar.setValue(ScrollBar.value)}),valite=!1}})},setValue:function(v){ScrollBar.currentX=Math.floor(ScrollBar.scrollWidth*(v/ScrollBar.maxValue)),$(".scroll_Thumb").css({left:ScrollBar.currentX+"px"})},setposition:function(left){$(".scroll_Thumb").css({left:left+"px"})},getValue:function(){this.currentX=$(".progress_bar").width()*(this.value/this.maxValue)}},$img=$("#pointsequencing-img"),$replaceFocus=$("#replaceFocus"),$showPoint=$("#showPoint");$showPoint.unbind("click");var pointInfo={num:0,x:0,y:0,value:"",contentEditable:!1,isSelected:!1,isErrorPoint:!1};$scope.info={description:{text:"",asset_type:"",asset:"",image_extend:{rotate:"",resize:""}},title:$scope.model.title,titleLength:0,timer:{timer_type:$scope.model.timer.timer_type,time_minute:$scope.model.timer.time_minute,time_second:$scope.model.timer.time_second},background:{url:"",scale:0},adjustSize:{width:465,height:320},imgSrc:"",value:1,editingPoing:null,enterPoint:!1,bestAdjustScale:1,inAdjustModel:!1,points:[],scaleSize:[],isNew:!0,oriWidth:0,oriHeight:0,maxWidth:465,maxHeight:320,ratio:1,step:.1,selectedPoint:null,currentScalePosition:-1,firstScalePosition:5,currentImageSize:{width:0,height:0},finish:!1,mousePosition:{x:0,y:0},hoverOpacity:0,display:"none",pointSize:{width:30,height:30},pointSizeDefault:30,position:{left:0,top:0}},$scope.event={},$scope.event.titleChange=function(){var title=$("textarea.tit").val();$scope.info.titleLength=title.length},$scope.event.checkPointOverlay=function(point){var i,len;for(i=0,len=$scope.info.points.length;i<len;i++)if($scope.info.points[i]!=point){var distance=(point.x-$scope.info.points[i].x)*(point.x-$scope.info.points[i].x)+(point.y-$scope.info.points[i].y)*(point.y-$scope.info.points[i].y);if(distance<$scope.info.pointSize.width*$scope.info.pointSize.width)return $scope.errorModel.errorText=$filter("translate")("pointsequencing.point_overlay"),$scope.errorModel.dismissErrorTip(1e3),!0}return!1},$scope.event.checkPointLegal=function(){var i,j,len,a,b,c,d,intr,points=$scope.info.points;if(points.length>2)for(i=0,len=points.length;i<len-2;i++)for(a=points[i],b=points[i+1],j=i+1;j<len-1;j++)if(c=points[j],d=points[j+1],intr=segmentsIntr(a,b,c,d),intr!==!1)return a.isErrorPoint=!0,b.isErrorPoint=!0,c.isErrorPoint=!0,d.isErrorPoint=!0,$scope.errorModel.errorText=$filter("translate")("pointsequencing.segmentsIntr"),!1;for(i=0,len=points.length;i<len;i++)points[i].isErrorPoint=!1;return $scope.errorModel.dismissErrorTip(100),!0},$scope.event.selectPoint=function(point){null!=$scope.info.selectedPoint&&($scope.info.selectedPoint.isSelected=!1),null!==point&&($replaceFocus.focus(),point.isSelected=!0,$scope.info.selectedPoint=point)},$replaceFocus.bind("keyup",function(event){var currKey=0,e=e||event;if(currKey=e.keyCode||e.which||e.charCode,46===currKey&&null!==$scope.info.selectedPoint){var i,len,index=-1;for(i=0,len=$scope.info.points.length;i<len;i++)if($scope.info.points[i]===$scope.info.selectedPoint){index=i,$scope.info.points.splice(index,1),$scope.$apply(function(){afterDeletePoint(index)});break}index>-1&&$scope.$apply(function(){for(i=index,len=$scope.info.points.length;i<len;i++){var num=$scope.info.points[i].num;$scope.info.points[i].num=num-1}$scope.event.checkPointLegal()})}}),$scope.event.onMouseMove=function(event){$scope.info.mousePosition.x=event.offsetX,$scope.info.mousePosition.y=event.offsetY,$scope.info.hoverOpacity=.5},$scope.event.onMouseEnter=function(){$scope.info.hoverOpacity=.5,$scope.info.display="inline-block"},$scope.event.onMouseLeave=function(event){var pointOffsetX=$scope.info.pointSize.width/2,pointOffsetY=$scope.info.pointSize.height/2;(event.offsetX<=pointOffsetX||event.offsetX>=$scope.info.currentImageSize.width-pointOffsetX||event.offsetY<=pointOffsetY||event.offsetY>=$scope.info.currentImageSize.height-pointOffsetY)&&($scope.info.display="none")},$scope.event.updateShowValue=function(){getNewPointValue()},$scope.event.startEditPoint=function(point){return null===$scope.info.editingPoing||void 0===$scope.info.editingPoing?($scope.info.editingPoing=point,void($scope.info.editingPoing.contentEditable=!0)):void($scope.info.editingPoing!=point?($scope.info.editingPoing.stopEdit(),point.contentEditable=!0,$scope.info.editingPoing=point):$scope.info.editingPoing==point&&($scope.info.editingPoing.contentEditable=!0))},$scope.event.checkPointEdge=function(point){point&&(point.x<0&&(point.x=0),point.x>$scope.info.currentImageSize.width-$scope.info.pointSize.width&&(point.x=$scope.info.currentImageSize.width-$scope.info.pointSize.width),point.y<0&&(point.y=0),point.y>$scope.info.currentImageSize.height-$scope.info.pointSize.height&&(point.y=$scope.info.currentImageSize.height-$scope.info.pointSize.height))},$scope.event.addPointInContainter=function(event){if(""!==$scope.info.background.url&&$scope.info.enterPoint!==!0){$scope.event.clearStatus();var point=$.extend(!0,{},pointInfo);point.num=$scope.info.points.length+1,point.x=$scope.info.mousePosition.x-$scope.info.pointSize.width/2,point.y=$scope.info.mousePosition.y-$scope.info.pointSize.height/2,$scope.event.checkPointEdge(point),$scope.event.checkPointOverlay(point)||(point.value=$scope.info.value+"",$scope.info.points.push(point),$scope.event.selectPoint($scope.info.points[$scope.info.points.length-1]),$scope.event.checkPointLegal(),getNewPointValue())}},$scope.event.clearStatus=function(){for(var point,i=0,len=$scope.info.points.length;i<len;i++)point=$scope.info.points[i],point.contentEditable===!0&&point.stopEdit&&$.isFunction(point.stopEdit)&&point.stopEdit();$scope.event.selectPoint(null)},$scope.event.adjustToSize=function(){if(""!==$scope.info.background.url){var position=$scope.info.firstScalePosition;$scope.event.scaleTo(position)}},$scope.event.scaleTo=function(position){if(!(position===$scope.info.currentScalePosition||position>=$scope.info.scaleSize.length||position<0)){var width=$scope.info.scaleSize[position].width,height=$scope.info.scaleSize[position].height;updatePointPosition($img.width(),width,$img.height(),height),$img.width(width),$img.height(height),$scope.info.currentImageSize.width=width,$scope.info.currentImageSize.height=height,$scope.info.currentScalePosition=position,$scope.info.pointSize.width=$scope.info.pointSizeDefault,$scope.info.pointSize.height=$scope.info.pointSizeDefault,calImagePosition(),ScrollBar.setValue(position),$scope.info.inAdjustModel=!1}},$scope.event.scaleImg=function(zoomOut){var position;position=zoomOut?$scope.info.currentScalePosition+1:$scope.info.currentScalePosition-1,$scope.event.scaleTo(position)},$scope.resourceValidParam={imageType:["image/jpg","image/jpeg","image/webp","image/gif","image/png","image/bmp"],imageSize:1048576},angular.element(window).resize(fun)}])});