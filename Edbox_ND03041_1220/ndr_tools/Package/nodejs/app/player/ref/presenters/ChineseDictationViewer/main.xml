<?xml version='1.0' encoding='UTF-8' ?>
<addon id='ChineseDictationViewer'>
<properties>

                <property />

</properties>

<dependencies>

<jsDependency>
    <javaScript  name="typescript-polyfill" version="1.0.0" />
    <javaScript  name="mini-tablet" version="1.1.0" />
</jsDependency>


</dependencies>

<css>

<![CDATA[.addon_ChineseDictationViewer .js_tablet{position:relative}.addon_ChineseDictationViewer .js_tablet[data-text]:before{content:"" attr(data-text) "";position:absolute;width:100%;height:100%;font-size:11em;font-family:KaiTi;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center}]]>

</css>


<view>

<![CDATA[<div class="chineseCharacter-module js_container"><div class="chineseCharacter-module-title js_title hide_dom"><span class="chineseCharacter-module-title-text"></span></div></div>]]>
</view>


<presenter>

<![CDATA[/*!   version: 1.2.2  -   updated: 2017-08-28 14:37:50   */
window["AddonChineseDictationViewer_create"]=function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=20)}([function(module,exports){/*! constants */
Object.defineProperty(exports,"__esModule",{value:true});exports.QuestionCode="ChineseCharacterDictation";exports.QuestionName="汉字听写题";exports.AnswerState={NoAnswer:"NO_ANSWER",NoComplete:"NO_COMPLETE",Complete:"COMPLETE"};var Recognizer;(function(Recognizer){Recognizer.AppName="chinese-recognize";Recognizer.EventName="recognizeCharacter";Recognizer.EventCallbackName="recognizeCharacterCallback";Recognizer.Timeout=10*1e3;var RecoginzeResult;(function(RecoginzeResult){RecoginzeResult[RecoginzeResult["Success"]=0]="Success";RecoginzeResult[RecoginzeResult["Fault"]=1]="Fault";RecoginzeResult[RecoginzeResult["SuccessButNotCheckSequence"]=2]="SuccessButNotCheckSequence";RecoginzeResult[RecoginzeResult["StrokeNumberError"]=3]="StrokeNumberError";RecoginzeResult[RecoginzeResult["StrokeSequenceError"]=4]="StrokeSequenceError"})(RecoginzeResult=Recognizer.RecoginzeResult||(Recognizer.RecoginzeResult={}))})(Recognizer=exports.Recognizer||(exports.Recognizer={}));var Tablet;(function(Tablet){Tablet.MaxNum=4;var TabletMode;(function(TabletMode){TabletMode[TabletMode["Freeze"]=0]="Freeze";TabletMode[TabletMode["Write"]=1]="Write";TabletMode[TabletMode["Erase"]=2]="Erase"})(TabletMode=Tablet.TabletMode||(Tablet.TabletMode={}));var VerifyResult;(function(VerifyResult){VerifyResult[VerifyResult["Pass"]=0]="Pass";VerifyResult[VerifyResult["Null"]=1]="Null";VerifyResult[VerifyResult["Uneven"]=2]="Uneven"})(VerifyResult=Tablet.VerifyResult||(Tablet.VerifyResult={}))})(Tablet=exports.Tablet||(exports.Tablet={}));exports.ComponentEvents={TabletActive:"tablet/active",TabletChange:"tablet/change",TabletClear:"tablet/clear"};exports.ViewStyles={Hidden:"hide_dom",Disabled:"disabled",Active:"on"}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:true});var constants_1=__webpack_require__(0);var utils_1=__webpack_require__(3);var BaseComponent=function(){function BaseComponent(service,emitter){this.locked=false;this.$service=service;this.$emitter=emitter;this.uuid=utils_1.uuid();this.render();this.bind()}BaseComponent.prototype.destroy=function(){this.unbind();this.$el.remove();delete this.$service;delete this.$emitter};BaseComponent.prototype.render=function(){};BaseComponent.prototype.bind=function(){};BaseComponent.prototype.unbind=function(){};BaseComponent.prototype.mount=function($el,options){if(options&&options.type==="before"){$el.prepend(this.$el)}else{$el.append(this.$el)}this.mounted()};BaseComponent.prototype.mounted=function(){};BaseComponent.prototype.reset=function(){};BaseComponent.prototype.getState=function(){return{}};BaseComponent.prototype.setState=function(state){};BaseComponent.prototype.lock=function(isLock){this.locked=isLock};BaseComponent.prototype.setVisible=function(isVisible){this.$el[isVisible?"removeClass":"addClass"].call(this.$el,constants_1.ViewStyles.Hidden)};BaseComponent.prototype.toString=function(){return this.uuid};return BaseComponent}();exports.default=BaseComponent},function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var Environment={};exports.default=Environment;exports.set=function(env){return Object.assign(Environment,env)}},function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function mustache(html,data){return typeof data==="function"?html.replace(/\{\{([\w\.-_]+)\}\}/g,function(m,$1){return data($1)}):html.replace(/\{\{([\w-_]+)\}\}/g,function(m,$1){return typeof data[$1]==="undefined"?"":data[$1]})}exports.mustache=mustache;function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)})}exports.uuid=uuid},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:true});var logger;if(Logger){(logger=Logger.get("ChineseDictationViewer")).appendHandler(function(message){return window.console.log(message)},{level:Logger.DEBUG})}else{logger=window.console}exports.default=logger},function(module,exports,__webpack_require__){/*! api */
Object.defineProperty(exports,"__esModule",{value:true});var constants_1=__webpack_require__(0);var env_1=__webpack_require__(2);var PromiseList={};var TimerList={};var Api=function(){function Api(presenter){this.context=presenter;if(env_1.default.isPC){}else{this.context.$dispatchEvent("createPresenter",PresenterEventType.NATIVE_EVENT,{presenterId:constants_1.Recognizer.AppName,instanceId:constants_1.Recognizer.AppName})}this.context.$addEventListener(constants_1.Recognizer.EventCallbackName,PresenterEventType.NATIVE_EVENT,function(data){var id=String(data.id);if(PromiseList[id]){PromiseList[id].resolve(data.data);delete PromiseList[id]}if(TimerList[id]){window.clearTimeout(TimerList[id]);delete TimerList[id]}})}Api.prototype.destroy=function(){if(env_1.default.isPC){}else{this.context.$dispatchEvent("destroyPresenter",PresenterEventType.NATIVE_EVENT,{instanceId:constants_1.Recognizer.AppName})}this.context.$removeEventListener();delete this.context};Api.prototype.recognize=function(data){var promise=$.Deferred();if(Array.isArray(data)&&data.length){var d={id:Date.now().toString(),data:data};PromiseList[d.id]=promise;if(env_1.default.isPC){this.context.$dispatchEvent(constants_1.Recognizer.EventName,PresenterEventType.PPT_NATIVE_EVENT,d)}else if(env_1.default.isApp){this.context.$dispatchEvent("sendToPresenter",PresenterEventType.NATIVE_EVENT,{instanceId:constants_1.Recognizer.AppName,type:constants_1.Recognizer.EventName,data:d})}TimerList[d.id]=setTimeout(function(){if(promise.state()==="pending"){promise.resolve()}},constants_1.Recognizer.Timeout*data.length)}else{promise.resolve()}return promise};Api.prototype.changeSubmitState=function(isCanSubmit){this.context.$dispatchEvent($PresenterEvent["AnswerFlowController"].QUESTION_STATE_CHANGE,PresenterEventType.IC_PLAYER_EVENT,{canSubmit:isCanSubmit})};Api.prototype.changeClassroomState=function(){if(env_1.default.isPC){this.context.playerController.startFlow("css_classroom_status_changed",{presenterCode:"ChineseDictationViewer"})}};Api.prototype.restoreClassStateComplete=function(){this.context.$dispatchEvent("css_recover_complete",PresenterEventType.IC_PLAYER_EVENT,{presenterCode:"ChineseDictationViewer"})};return Api}();exports.default=Api},function(module,exports,__webpack_require__){/*! app */
Object.defineProperty(exports,"__esModule",{value:true});var constants_1=__webpack_require__(0);var logger_1=__webpack_require__(4);var env_1=__webpack_require__(2);var event_emitter_1=__webpack_require__(19);var action_1=__webpack_require__(14);var tablet_1=__webpack_require__(18);var definition_1=__webpack_require__(15);var SELECTOR_CONTAINER=".js_container";var App=function(){function App(view,$service){this.answerResult=[];this.answerState=constants_1.AnswerState.NoAnswer;this.noJudgeSubmitState=true;this.isModify=false;this.$view=$(view);this.$service=$service;this.$emitter=new event_emitter_1.default;this.render();this.bind();this.$service.$api.changeSubmitState(true)}App.prototype.destroy=function(){var _this=this;this.unbind();Object.keys(this.components).forEach(function(item){return _this.components[item].destroy()});delete this.components;delete this.$emitter;delete this.$service};App.prototype.getQuestionInfo=function(){return{id:this.questionModel&&this.questionModel.id||constants_1.QuestionCode,type_code:"ChineseDictationViewer",type_name:constants_1.QuestionName,url:"",dispatchOnly:true,canSubmitEmpty:true}};App.prototype.getState=function(){return{traces:this.components.tablet.getState().data.map(function(item){return item.trace}),isModify:this.isModify}};App.prototype.setState=function(state){if(state){this.components.tablet.setState({pinyin:this.questionModel.data.question_data.pinyin,trace:state.traces});this.isModify=state.isModify}};App.prototype.getResult=function(options){var _this=this;var result={questionId:this.questionModel.id,answerState:this.answerState,answer:{answer_result:true,correct_response:[],user_response:[]}};var userResponse={trace:[],result:[],verify:[],data:{data:[]}};var hasResponse=false,hasAllResponse=true;var characters=this.questionModel.data.question_data.word;var tabletData=this.components.tablet.getState().data;for(var i=0,l=characters.length;i<l;i++){var tabletItemData=tabletData[i];userResponse.trace.push(tabletItemData.trace);userResponse.result.push({result:constants_1.Recognizer.RecoginzeResult.Fault});userResponse.verify.push(tabletItemData.verifyResult);userResponse.data.data.push({type:"raw",data_type:"raw",value:tabletItemData.verifyResult.type!==constants_1.Tablet.VerifyResult.Null?(hasResponse=true,tabletItemData.base64):(hasAllResponse=false,"")})}result.answerState=hasResponse?hasAllResponse?constants_1.AnswerState.Complete:constants_1.AnswerState.NoComplete:constants_1.AnswerState.NoAnswer;if(!this.isModify){if(this.answerResult&&this.answerResult.length){userResponse.result=this.answerResult}result.answer.user_response.push(userResponse);result.answer.answer_result=this.isAnswerCorrect(this.answerResult);return result}else{var recognizeData_1=[];characters.forEach(function(item,index){var trace=tabletData[index].trace;if(trace.length){recognizeData_1.push({character:item,trace:env_1.default.isApp?trace:JSON.stringify(trace)})}},this);if(!!recognizeData_1.length){logger_1.default.debug("recognizeCharacter",JSON.stringify(recognizeData_1));var promise=this.$service.$api.recognize(recognizeData_1).then(function(recognizeResult){logger_1.default.debug("recognizeCharacterCallback",JSON.stringify(characters),JSON.stringify(recognizeResult));if(recognizeResult&&recognizeResult.length){userResponse.result=characters.map(function(item){return recognizeResult.find(function(x){return x.character===item})||{result:constants_1.Recognizer.RecoginzeResult.Fault}})}result.answer.answer_result=_this.isAnswerCorrect(userResponse.result);return userResponse});result.answer.user_response.push(promise)}else{result.answer.user_response.push(userResponse);result.answer.answer_result=false}return result}};App.prototype.showAnswer=function(answerType,specialAnswer){if(answerType==="correct"){var questionData=this.questionModel.data.question_data;this.components.action.setVisible(false);this.components.tablet.setState({pinyin:questionData.pinyin,word:questionData.word,trace:[]});this.components.definition.setState({content:questionData.definition,extraContent:questionData.extraDefinition,unfolded:true})}};App.prototype.lockQuestion=function(isLock){var _this=this;Object.keys(this.components).forEach(function(item){return _this.components[item].lock(isLock)})};App.prototype.resetQuestion=function(){var _this=this;Object.keys(this.components).forEach(function(item){return _this.components[item].reset()});setTimeout(function(){return _this.$service.$api.changeSubmitState(true)},0)};App.prototype.loadQuestion=function(data,answer,options){var _this=this;if(answer&&typeof answer.then==="function"){return answer.then(function(res){_this.loadQuestion(data,res,options);_this.$service.$api.changeClassroomState();return data})}var defer=$.Deferred();defer.resolve(data);this.questionModel=data;if(options&&(options.isShowAnswer||options.isPPTShowAnswer)){this.showAnswer("correct")}else{var questionData=data.data.question_data;this.components.action.setVisible(true);this.components.tablet.setState({pinyin:questionData.pinyin,trace:answer&&answer.trace||[],base64:answer&&answer.data&&answer.data.data||[]});this.components.action.setState({audio:questionData.audio||""});this.components.definition.setState({content:questionData.definition,extraContent:questionData.extraDefinition,word:questionData.word,pinyin:questionData.pinyin});this.answerState=answer?constants_1.AnswerState.NoComplete:constants_1.AnswerState.NoAnswer;this.answerResult=answer&&answer.result||[];this.noJudgeSubmitState=options.noJudgeSubmitState}this.lockQuestion(options.isLock);this.isModify=false;this.$service.$api.changeClassroomState();return defer.promise()};App.prototype.bind=function(){var _this=this;this.$emitter.on(constants_1.ComponentEvents.TabletChange,function(){_this.isModify=true;_this.answerState=constants_1.AnswerState.NoComplete;_this.$service.$api.changeSubmitState(true);_this.$service.$api.changeClassroomState()});this.$emitter.on(constants_1.ComponentEvents.TabletClear,function(){_this.isModify=true;_this.$service.$api.changeSubmitState(true);_this.$service.$api.changeClassroomState()})};App.prototype.unbind=function(){this.$emitter.clear()};App.prototype.render=function(){var _this=this;this.components={tablet:new tablet_1.default(this.$service,this.$emitter),action:new action_1.default(this.$service,this.$emitter),definition:new definition_1.default(this.$service,this.$emitter)};var $container=this.$view.find(SELECTOR_CONTAINER);Object.keys(this.components).forEach(function(item){return _this.components[item].mount($container)})};App.prototype.isAnswerCorrect=function(answer){for(var i=0,l=answer.length;i<l;i++){if(answer[i].result!==constants_1.Recognizer.RecoginzeResult.Success){return false}}return!!answer.length};return App}();exports.default=App},function(module,exports){/*! stats */
Object.defineProperty(exports,"__esModule",{value:true});exports.default={convertDataForStatistics:function(originalData){var value=originalData.value;var questionType=value.questionType;var convertedData={questionType:questionType,elapsedTime:value.elapsedTime||0,spend_time:value.elapsedTime||0,finishedNum:value.finishedNum,unfinishedNum:value.unfinishedNum,totalNum:value.finishedNum+value.unfinishedNum,submit_count:value.finishedNum+value.unfinishedNum,unfinishedUsers:value.unfinishedUserIds,correctUsers:[],wrongUsers:[],allrightStu:[],correctNum:0,wrongNum:0};if(value.answers&&value.answers[0].length>0){for(var index=0;index<value.answers[0].length;index++){var object=value.answers[0][index];if(object&&object.userIds){var data=JSON.parse(object.answer);if(value.questionType&&value.questionType==questionType){if(data){var response=data.user_response;if(response&&response[0]&&response[0].subquestionState==="NO_ANSWER"){continue}if(data.answer_result===true){convertedData.correctUsers=convertedData.correctUsers.concat(object.userIds)}else{convertedData.wrongUsers=convertedData.wrongUsers.concat(object.userIds)}}else{convertedData.wrongUsers=convertedData.wrongUsers.concat(object.userIds)}}}}}convertedData.allrightStu=convertedData.allrightStu.concat(convertedData.correctUsers);convertedData.correctNum=convertedData.correctUsers.length;convertedData.wrongNum=convertedData.wrongUsers.length;value.convertedData=convertedData;return originalData},getStatisticClass:function(){return"c"}}},function(module,exports){module.exports='<div class="chineseCharacter-module-btns js_action"><div class=module-btns-box><span class=ChineseCd-preload-img01></span><a href=javascript:; class="module-btns-item js_button js_button_eraser"><i class="btn-icon eraser-icon"></i> <span class=btn-text>{{action.eraser}}</span></a> <a href=javascript:; class="module-btns-item js_button js_button_voice"><i class="btn-icon voice-icon"></i> <span class=btn-text>{{action.voice}}</span></a></div></div>'},function(module,exports){module.exports='<div class="chineseCharacter-module-decipher ChineseCd-light-scrollbar"><div class="module-decipher-text js_definition_container"><strong class=module-decipher-strong>{{label.paraphrase}}</strong><div class=module-decipher-textwrap><span class="module-decipher-intext js_definition"></span> <span class="module-decipher-intext-2 js_definition_extend"></span> <a class="link-viewmore js_definition_button hide_dom">{{action.unfold}}</a></div></div></div>'},function(module,exports){module.exports='<li class="chineseCharacter-module-spell-item js_tablet_item"><div class=spell_letter><span class="spell_letter-text js_pinyin"></span></div><div class="spell_characters wrong-character-box"><div class="spell_characters-box js_tablet"></div></div></li>'},function(module,exports){module.exports="<li><span>{{pinyin}}</span><div><img src={{base64}}></div></li>"},function(module,exports){module.exports="<div class=js_tablet_nav><ul></ul></div>"},function(module,exports){module.exports='<div class=chineseCharacter-module-spell><ul class="chineseCharacter-module-spell-box js_tablet_box"></ul></div>'},function(module,exports,__webpack_require__){/*! action */
Object.defineProperty(exports,"__esModule",{value:true});var base_component_1=__webpack_require__(1);var constants_1=__webpack_require__(0);var utils_1=__webpack_require__(3);var Template=__webpack_require__(8);var SELECTOR_BUTTON=".js_button";var SELECTOR_ERASER=".js_button_eraser";var SELECTOR_VOICE=".js_button_voice";var Action=function(_super){__extends(Action,_super);function Action(){return _super!==null&&_super.apply(this,arguments)||this}Action.prototype.destroy=function(){_super.prototype.destroy.call(this);this.$audio.pause();delete this.$audio};Action.prototype.getState=function(){return{}};Action.prototype.setState=function(state){if(typeof state.audio==="string"){this.$audio.pause();this.$audio.src=state.audio;this.$audio.load()}};Action.prototype.lock=function(isLock){_super.prototype.lock.call(this,isLock);if(isLock){this.$audio.pause();this.reset()}else{this.$audio.play()}};Action.prototype.reset=function(){this.$el.find(SELECTOR_BUTTON).removeClass(constants_1.ViewStyles.Active)};Action.prototype.render=function(){var _this=this;if(!this.$el){this.$el=$(utils_1.mustache(Template,function(key){return _this.$service.$i18n(key)}))}if(!this.$audio){this.$audio=new Audio;this.$audio.volume=1;this.$audio.autoplay=false;this.$audio.preload="auto"}};Action.prototype.bind=function(){var _this=this;var $eraserBtn=this.$el.find(SELECTOR_ERASER);var $voiceBtn=this.$el.find(SELECTOR_VOICE);this.$el.find(SELECTOR_BUTTON).on("click",function(event){if(_this.locked){event.stopImmediatePropagation()}});$eraserBtn.on("click",function(event){return _this.$emitter.emit(constants_1.ComponentEvents.TabletClear)});$voiceBtn.on("click",function(event){_this.$audio.currentTime=0;_this.$audio.play()});this.$audio.addEventListener("play",function(event){return $voiceBtn.addClass(constants_1.ViewStyles.Active)});["pause","ended","error","abort"].forEach(function(item){return _this.$audio.addEventListener(item,function(event){return $voiceBtn.removeClass(constants_1.ViewStyles.Active)})})};Action.prototype.unbind=function(){this.$el.find(SELECTOR_ERASER).off("click");this.$el.find(SELECTOR_VOICE).off("click")};Action.prototype.play=function(){this.$audio.play()};Action.prototype.pause=function(){this.$audio.pause()};return Action}(base_component_1.default);exports.default=Action},function(module,exports,__webpack_require__){/*! definition */
Object.defineProperty(exports,"__esModule",{value:true});var base_component_1=__webpack_require__(1);var constants_1=__webpack_require__(0);var utils_1=__webpack_require__(3);var Template=__webpack_require__(9);var SELECTOR_CONTAINER=".js_definition_container";var SELECTOR_CONTENT=".js_definition";var SELECTOR_EXTEND=".js_definition_extend";var SELECTOR_BUTTON=".js_definition_button";var STYLE_OPEN="open";var Definition=function(_super){__extends(Definition,_super);function Definition(){return _super!==null&&_super.apply(this,arguments)||this}Definition.prototype.setState=function(state){var content=state.content||state.extraContent;if(content){var extraContent=state.content&&state.extraContent?state.extraContent:"";if(Array.isArray(state.word)&&Array.isArray(state.pinyin)&&state.word.length&&state.pinyin.length){var pinyin_1=state.pinyin;var pinyinMap_1=state.word.reduce(function(memo,item,index){return memo[item]=pinyin_1[index],memo},{});var word_1=state.word;_a=[content,extraContent].map(function(item){return item.replace(new RegExp("("+word_1.join("")+"|["+word_1.join("")+"]+)","g"),function(m,$1){return'（<span class="module-decipher-spell-text">'+$1.split("").map(function(item){return pinyinMap_1[item]}).join(" ")+"</span>）"})}),content=_a[0],extraContent=_a[1]}this.$el.find(SELECTOR_CONTENT).html(content);this.$el.find(SELECTOR_EXTEND).html(extraContent);$.prototype[state.unfolded?"addClass":"removeClass"].call(this.$el.find(SELECTOR_CONTAINER),STYLE_OPEN);$.prototype[extraContent&&!state.unfolded?"removeClass":"addClass"].call(this.$el.find(SELECTOR_BUTTON),constants_1.ViewStyles.Hidden).html(this.$service.$i18n("action.unfold"));this.$el.removeClass(constants_1.ViewStyles.Hidden).scrollTop(0)}else{this.$el.addClass(constants_1.ViewStyles.Hidden)}var _a};Definition.prototype.reset=function(){};Definition.prototype.render=function(){var _this=this;if(!this.$el){this.$el=$(utils_1.mustache(Template,function(key){return _this.$service.$i18n(key)}))}};Definition.prototype.bind=function(){var _this=this;this.$el.on("mousedown",function(event){if(event.which===2){event.preventDefault()}});this.$el.find(SELECTOR_BUTTON).on("click",function(event){var $container=_this.$el.find(SELECTOR_CONTAINER);if($container.hasClass(STYLE_OPEN)){$container.removeClass(STYLE_OPEN);event.currentTarget.innerHTML=_this.$service.$i18n("action.unfold")}else{$container.addClass(STYLE_OPEN);event.currentTarget.innerHTML=_this.$service.$i18n("action.fold")}})};Definition.prototype.unbind=function(){this.$el.off("mousedown");this.$el.find(SELECTOR_BUTTON).off("click")};return Definition}(base_component_1.default);exports.default=Definition},function(module,exports,__webpack_require__){/*! tablet-item */
Object.defineProperty(exports,"__esModule",{value:true});var base_component_1=__webpack_require__(1);var constants_1=__webpack_require__(0);var Template=__webpack_require__(10);var SELECTOR_PINYIN=".js_pinyin";var SELECTOR_TABLET=".js_tablet";var TabletItem=function(_super){__extends(TabletItem,_super);function TabletItem(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isTouched=false;return _this}TabletItem.prototype.setState=function(state){this.$el.find(SELECTOR_PINYIN).html(state.pinyin||"");if(state.word){this.$el.find(SELECTOR_TABLET).attr("data-text",state.word)}else{this.$el.find(SELECTOR_TABLET).removeAttr("data-text")}if(state.trace){this.tablet.clear();this.tablet.setTrace(state.trace)}};TabletItem.prototype.getState=function(){return{trace:this.tablet.getTrace(),base64:this.tablet.getDataURL("png",.5),verifyResult:this.tablet.verify()}};TabletItem.prototype.mounted=function(){var width=this.$el.find(SELECTOR_TABLET).width();this.tablet.setSize(width,width)};TabletItem.prototype.reset=function(){this.$el.find(SELECTOR_TABLET).removeAttr("data-text");this.tablet.clear();this.tablet.setTrace([])};TabletItem.prototype.lock=function(isLock){_super.prototype.lock.call(this,isLock);this.tablet.setMode(isLock?constants_1.Tablet.TabletMode.Freeze:constants_1.Tablet.TabletMode.Write)};TabletItem.prototype.render=function(){if(!this.$el){this.$el=$(Template)}if(!this.tablet){this.tablet=new MiniTablet(this.$el.find(SELECTOR_TABLET).get(0));this.tablet.setMode(constants_1.Tablet.TabletMode.Write);this.tablet.setWriter({lineWidth:8})}};TabletItem.prototype.bind=function(){var _this=this;this.$el.find(SELECTOR_TABLET).on("touchstart mousedown",function(event){return _this.isTouched=true}).on("touchmove touchend touchcancel mousemove mouseup mouseout",function(event){if(_this.locked||!_this.isTouched)return;_this.isTouched=false;_this.$emitter.emit(constants_1.ComponentEvents.TabletActive,{id:_this.toString()})});this.tablet.on("change",function(){return _this.$emitter.emit(constants_1.ComponentEvents.TabletChange,{id:_this.toString()})})};TabletItem.prototype.unbind=function(){this.$el.find(SELECTOR_TABLET).off("click")};TabletItem.prototype.setActive=function(actived){this.$el[actived?"addClass":"removeClass"].call(this.$el,constants_1.ViewStyles.Active)};TabletItem.prototype.clear=function(){this.tablet.clear()};return TabletItem}(base_component_1.default);exports.default=TabletItem},function(module,exports,__webpack_require__){/*! tablet-nav */
Object.defineProperty(exports,"__esModule",{value:true});var base_component_1=__webpack_require__(1);var constants_1=__webpack_require__(0);var utils_1=__webpack_require__(3);var Template=__webpack_require__(12);var ItemTemplate=__webpack_require__(11);var SELECTOR_LIST="ul";var SELECTOR_LIST_ITEM="li";var TabletNav=function(_super){__extends(TabletNav,_super);function TabletNav(){return _super!==null&&_super.apply(this,arguments)||this}TabletNav.prototype.setState=function(state){if(state.items instanceof Array){this.$el.find(SELECTOR_LIST).html(state.items.map(function(item){return utils_1.mustache(ItemTemplate,item)}).join(""))}};TabletNav.prototype.lock=function(isLock){_super.prototype.lock.call(this,isLock);this.setPreviewIndex(-isLock)};TabletNav.prototype.render=function(){if(!this.$el){this.$el=$(Template)}};TabletNav.prototype.bind=function(){var _this=this;this.$el.find(SELECTOR_LIST).on("click","li",function(event){if(_this.locked)return;var index=+$(event.currentTarget).index();_this.setPreviewIndex(+index);_this.$emitter.emit(constants_1.ComponentEvents.TabletActive,{index:+index})})};TabletNav.prototype.unbind=function(){this.$el.find(SELECTOR_LIST).off("click")};TabletNav.prototype.setPreviewContent=function(index,content){this.$el.find(SELECTOR_LIST_ITEM).eq(index).find("img").attr("src",content)};TabletNav.prototype.setPreviewIndex=function(index){var $items=this.$el.find(SELECTOR_LIST_ITEM);$items.removeClass(constants_1.ViewStyles.Active);if(!!~index){$items.eq(index).addClass(constants_1.ViewStyles.Active)}};return TabletNav}(base_component_1.default);exports.default=TabletNav},function(module,exports,__webpack_require__){/*! tablet */
Object.defineProperty(exports,"__esModule",{value:true});var base_component_1=__webpack_require__(1);var tablet_item_1=__webpack_require__(16);var tablet_nav_1=__webpack_require__(17);var constants_1=__webpack_require__(0);var env_1=__webpack_require__(2);var Template=__webpack_require__(13);var SELECTOR_BOX=".js_tablet_box";var Tablet=function(_super){__extends(Tablet,_super);function Tablet(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.items=[];return _this}Tablet.prototype.destroy=function(){_super.prototype.destroy.call(this);this.items.forEach(function(item){return item.destroy()});this.nav&&this.nav.destroy();this.items=[]};Tablet.prototype.setState=function(state){var _this=this;if(Array.isArray(state.pinyin)&&state.pinyin.length){this.itemNum=state.pinyin.length;if(state.pinyin.length>this.items.length){var $box=this.$el.find(SELECTOR_BOX);for(var i=0,l=state.pinyin.length-this.items.length;i<l;i++){var tablet=new tablet_item_1.default(this.$service,this.$emitter);tablet.mount($box);this.items.push(tablet)}}this.items.forEach(function(item,index){if(index+1<=_this.itemNum){item.setState({pinyin:state.pinyin&&state.pinyin[index]||undefined,word:state.word&&state.word[index]||undefined,trace:state.trace?state.trace[index]||[]:undefined});item.setVisible(true)}else{item.setVisible(false)}});if(this.nav){if(this.itemNum>1){this.nav.setState({items:state.pinyin.map(function(item,index){return{pinyin:item,base64:state.base64&&state.base64[index]&&state.base64[index].value||""}})});this.nav.setVisible(true)}else{this.nav.setVisible(false)}}}};Tablet.prototype.getState=function(){var data=[];for(var i=0;i<this.itemNum;i++){data.push(this.items[i].getState())}return{data:data}};Tablet.prototype.lock=function(isLock){_super.prototype.lock.call(this,isLock);this.nav&&this.nav.lock(isLock);this.items.forEach(function(item){return item.lock(isLock)});this.toggleTablet(-isLock)};Tablet.prototype.reset=function(){this.items.forEach(function(item){return item.reset()});this.toggleTablet(0)};Tablet.prototype.render=function(){if(!this.$el){this.$el=$(Template)}if(env_1.default.isHomework){this.nav=new tablet_nav_1.default(this.$service,this.$emitter);this.nav.mount(this.$el,{type:"before"})}};Tablet.prototype.bind=function(){var _this=this;this.$emitter.on(constants_1.ComponentEvents.TabletClear,function(){var current=_this.items[_this.currentIndex];if(current){current.clear();_this.nav&&_this.nav.setPreviewContent(_this.currentIndex,_this.items[_this.currentIndex].getState().base64)}});this.$emitter.on(constants_1.ComponentEvents.TabletActive,function(_a){var id=_a.id,index=_a.index;var query;if((query=id,typeof id!=="undefined")||(query=index,typeof index!=="undefined")){_this.toggleTablet(query)}});if(this.nav){this.$emitter.on(constants_1.ComponentEvents.TabletChange,function(_a){var id=_a.id;var index=_this.items.findIndex(function(item){return item.toString()===id});if(!!~index){_this.nav.setPreviewContent(index,_this.items[index].getState().base64)}})}};Tablet.prototype.toggleTablet=function(index){if(typeof index==="string"){index=this.items.findIndex(function(item){return item.toString()===index});if(this.nav){this.nav.setPreviewIndex(index)}}if(typeof index==="number"){this.currentIndex=index;this.items.forEach(function(item,itemIndex){return item.setActive(itemIndex===index)})}};return Tablet}(base_component_1.default);exports.default=Tablet},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:true});var logger_1=__webpack_require__(4);var EventEmitter=function(){function EventEmitter(){this.listeners={}}EventEmitter.prototype.on=function(name,handler){if(!this.listeners[name]){this.listeners[name]=[]}this.listeners[name].push(handler)};EventEmitter.prototype.emit=function(name){var params=[];for(var _i=1;_i<arguments.length;_i++){params[_i-1]=arguments[_i]}if(this.listeners[name]&&this.listeners[name].length){this.listeners[name].forEach(function(listener){return listener.apply(null,params)})}else{logger_1.default.warn("[event-emitter] listener name "+name+" is null")}};EventEmitter.prototype.clear=function(name){if(typeof name==="string"&&this.listeners[name]){delete this.listeners[name]}else{this.listeners={}}};return EventEmitter}();exports.default=EventEmitter},function(module,exports,__webpack_require__){/*! presenter */
Object.defineProperty(exports,"__esModule",{value:true});var api_1=__webpack_require__(5);var app_1=__webpack_require__(6);var stats_1=__webpack_require__(7);var env_1=__webpack_require__(2);var logger_1=__webpack_require__(4);var Presenter=function(_super){__extends(Presenter,_super);function Presenter(name){var _this=_super.call(this)||this;_this.metaInfo=Object.assign(_this.metaInfo||{},{name:"ChineseDictationViewer",type:PresenterType.PRESENTER_COMPONENT});return _this}Presenter.prototype.run=function(view,model){env_1.set({isPC:this.isPPTShell||this.isPC||this.isTeacher,isApp:this.isApp===true,isHomework:this.isHomework===true});try{this.$api=new api_1.default(this);this.$app=new app_1.default(view,{$api:this.$api,$i18n:this.$translator.translate.bind(this.$translator)})}catch(e){logger_1.default.error(e)}};Presenter.prototype.destroy=function(){if(this.$app){this.$app.destroy()}if(this.$api){this.$api.destroy()}delete this.$service;delete this.$app;delete this.$api};Presenter.prototype.getService=function(){var _this=this;if(!this.$service){this.$service={getQuestionInfo:function(){return _this.$app.getQuestionInfo()},setLocationProperties:function(data){return _this.$translator.setData(data)},getResult:function(options){return _this.$app.getResult(options)},showAnswer:function(answerType,specialAnswer){return _this.$app.showAnswer(answerType,specialAnswer)},showResultHint:function(){},getState:function(){return _this.$app.getState()},setState:function(state){return _this.$app.setState(state)},getClassroomStatus:function(){return _this.$app.getState()},setClassroomStatus:function(state){_this.$app.setState(state);_this.$api.restoreClassStateComplete()},clearClassroomStatus:function(){},lockQuestion:function(){return _this.$app.lockQuestion(true)},unlockQuestion:function(){return _this.$app.lockQuestion(false)},resetQuestion:function(){return _this.$app.resetQuestion()},finishQuestion:function(){return _this.$app.lockQuestion(true)},loadQuestion:function(data,answer,options){return _this.$app.loadQuestion(data,answer,options)},startStatistics:function(){},convertDataForStatistics:function(data){return stats_1.default.convertDataForStatistics(data)},getStatisticClass:function(){return stats_1.default.getStatisticClass()}}}return this.$service};return Presenter}(BasicPresenter);module.exports=function(){return new Presenter("ChineseDictationViewer")}}]);]]>

</presenter>


<resources>



</resources>

</addon>