<?xml version='1.0' encoding='UTF-8' ?>
<addon id='FreeCombineElement'>
<properties>



</properties>

<dependencies>

<jsDependency>
    <javaScript  name="ShapeBuilder" version="1.0.0" />
    <javaScript  name="typescript-polyfill" version="1.0.0" />
</jsDependency>


</dependencies>

<css>

<![CDATA[.addon_FreeCombineElement .fct_module_wrapper .js_element_richtext .js_element_content em,.addon_FreeCombineElement .fct_module_wrapper .js_element_shape .js_shape_text em{font-style:italic!important}.addon_FreeCombineElement .fct_module_wrapper{pointer-events:none;transform-origin:center center}.addon_FreeCombineElement .fct_module_wrapper .js_element_scope{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;transform-origin:center center}.addon_FreeCombineElement .fct_module_wrapper .js_element_ctrl{pointer-events:auto;display:none}.addon_FreeCombineElement .fct_module_wrapper .js_element_ctrl div,.addon_FreeCombineElement .fct_module_wrapper .js_element_ctrl span{z-index:1}.addon_FreeCombineElement .fct_module_wrapper.js_active:not(.js_pinned) .js_element_ctrl{display:block}.addon_FreeCombineElement .fct_module_wrapper.js_pinned .js_element_scope{overflow:visible}.addon_FreeCombineElement .fct_module_wrapper.js_pinned .js_element_richtext{text-shadow:#fff .1em 0 .15em,#fff 0 .1em .15em,#fff -.1em 0 .15em,#fff 0 -.1em .15em}.addon_FreeCombineElement .fct_module_wrapper.js_pinned .js_element_picture .item_wh_100,.addon_FreeCombineElement .fct_module_wrapper.js_pinned .js_element_table table{border:5px solid #fff}.addon_FreeCombineElement .fct_module_wrapper .js_element_richtext .js_element_content{pointer-events:auto;width:auto;height:auto;max-width:100%;max-height:100%;display:inline-block;line-height:1.5;word-wrap:break-word}.addon_FreeCombineElement .fct_module_wrapper .js_element_shape .js_element_content{width:auto!important;height:auto!important}.addon_FreeCombineElement .fct_module_wrapper .js_element_shape .js_shape_text{line-height:1.5;color:#fff;overflow:hidden;word-wrap:break-word}.addon_FreeCombineElement .fct_module_wrapper .js_element_shape svg{pointer-events:all}.addon_FreeCombineElement .fct_module_wrapper .js_element_picture,.addon_FreeCombineElement .fct_module_wrapper .js_element_table{pointer-events:auto}]]>

</css>


<view>

<![CDATA[<div class="fct_module_wrapper js_element_root"><div class="fct_shape_controller js_element_ctrl"><div class="fct_shapeMove move_n"></div><div class="fct_shapeMove move_s"></div><div class="fct_shapeMove move_w"></div><div class="fct_shapeMove move_e"></div><span class="fct_shapeResize resize_n"></span> <span class="fct_shapeResize resize_s"></span> <span class="fct_shapeResize resize_w"></span> <span class="fct_shapeResize resize_e"></span> <span class="fct_shapeResize resize_se"></span> <span class="fct_shapeResize resize_sw"></span> <span class="fct_shapeResize resize_ne"></span> <span class="fct_shapeResize resize_nw"></span> <span class="fct_shapeResize resize_rotate js_element_rotate_button"></span></div></div>]]>
</view>


<presenter>

<![CDATA[/*!   version: 1.1.5  updated: 2017-07-03 16:05:56   */
window["AddonFreeCombineElement_create"]=function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=13)}([function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.PresenterName="FreeCombineElement";exports.EventName="FreeCombineElementEvent";exports.EventTypes={Active:"active",Update:"update"};var ApplicationTypes;(function(ApplicationTypes){ApplicationTypes[ApplicationTypes["Singleton"]=0]="Singleton";ApplicationTypes[ApplicationTypes["Multiple"]=1]="Multiple"})(ApplicationTypes=exports.ApplicationTypes||(exports.ApplicationTypes={}));var ElementMode;(function(ElementMode){ElementMode[ElementMode["Disabled"]=0]="Disabled";ElementMode[ElementMode["Selected"]=1]="Selected";ElementMode[ElementMode["Colored"]=2]="Colored"})(ElementMode=exports.ElementMode||(exports.ElementMode={}));exports.ElementTypes={Picture:"picture",RichText:"richtext",Shape:"shape",Table:"table"};exports.DomSelectors={Root:".js_element_root",Content:".js_element_content",RotateButton:".js_element_rotate_button"};exports.DomClassNames={Active:"js_active",Pinned:"js_pinned",Body:"js_element_scope",Ctrl:"js_element_ctrl",RotateButton:"js_element_rotate_button"};exports.DomStyles={ShapeLineMinHeight:8,TextContainerPadding:10,TextFontSize:16,PinnedStrokeWidth:5,PinnedStrokeColor:"#fff"};exports.DomAttrs={Index:"data-element-index",Colorable:"data-element-colorable"};exports.PressTime=.1*1e3},function(module,exports){/*! utils */
Object.defineProperty(exports,"__esModule",{value:true});function calcRotateAngle(centre,start,end){if(~~start.x===~~end.x&&~~start.y===~~end.y){return 0}var point1={x:start.x-centre.x,y:start.y-centre.y};var point2={x:end.x-centre.x,y:end.y-centre.y};var edgeA=Math.sqrt(Math.pow(point1.x-point2.x,2)+Math.pow(point1.y-point2.y,2));var edgeB=Math.sqrt(Math.pow(point1.x,2)+Math.pow(point1.y,2));var edgeC=Math.sqrt(Math.pow(point2.x,2)+Math.pow(point2.y,2));var disY=360*Math.acos((Math.pow(edgeB,2)+Math.pow(edgeC,2)-Math.pow(edgeA,2))/(2*edgeB*edgeC))/(2*Math.PI);var direction=point1.x*point2.y-point1.y*point2.x;return direction<0?-disY:disY}exports.calcRotateAngle=calcRotateAngle;function isElementsInStage($stage){var $elems=[];for(var _i=1;_i<arguments.length;_i++){$elems[_i-1]=arguments[_i]}var stage=$stage.getBoundingClientRect();for(var _a=0,$elems_1=$elems;_a<$elems_1.length;_a++){var $elem=$elems_1[_a];var rect=($elem.jquery?$elem.get(0):$elem).getBoundingClientRect();if(rect.top<stage.top||rect.left<stage.left||rect.right>stage.right||rect.bottom>stage.bottom){return false}}return true}exports.isElementsInStage=isElementsInStage;function setElementStyle(style){var $elems=[];for(var _i=1;_i<arguments.length;_i++){$elems[_i-1]=arguments[_i]}var css={};for(var s in style){switch(s){case"rotate":case"angle":css.transform="rotate("+style[s]+"deg) translateZ(0)";break;case"x":case"left":css.left=style[s];break;case"y":case"top":css.top=style[s];break;case"scale":case"color":break;default:css[s]=style[s];break}}$elems.forEach(function($el){for(var k in css){$el.style[k]=typeof css[k]==="number"?css[k]+"px":css[k]}})}exports.setElementStyle=setElementStyle;function getScaleStyle(style,scale){if(scale===void 0){scale=1}var result={};for(var s in style){result[s]=s==="rotate"||s==="scale"||s==="color"?style[s]:style[s]*scale}return result}exports.getScaleStyle=getScaleStyle;function render(tmpl,data){return tmpl.replace(/\{\{([\w-_]+)(?:\:([\w]+))?\}\}/g,function(m,$1,$2){return typeof $1==="undefined"?typeof $2==="undefined"?"":$2:data[$1]})}exports.render=render;function toFirstUpperCase(str){return str.replace(/(^\w)/,function(m,$1){return $1.toUpperCase()})}exports.toFirstUpperCase=toFirstUpperCase;function filterHtmlProperties(html,handler){if(typeof handler!=="function"){handler=function(){}}var reg_attr=/\s([a-z-]+)="([\s\S]+?)"/gm;var reg_css=/([a-z-]+)\s?:\s?([\w#]+);?/gm;return html.replace(reg_attr,function(m,$1,$2){if($1==="style"){return' style="'+$2.replace(reg_css,handler)+'"'}return handler(m,$1,$2)})}exports.filterHtmlProperties=filterHtmlProperties},function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var BaseCommander=function(){function BaseCommander(){}BaseCommander.prototype.start=function(ctx,next){next(ctx)};BaseCommander.prototype.doing=function(ctx,next){next(ctx)};BaseCommander.prototype.done=function(ctx,next){next(ctx)};BaseCommander.prototype.undo=function(ctx,next){next(ctx)};BaseCommander.prototype.getState=function(){return{}};BaseCommander.prototype.setState=function(state){};return BaseCommander}();exports.default=BaseCommander},function(module,exports,__webpack_require__){/*! baseElement */
Object.defineProperty(exports,"__esModule",{value:true});var utils_1=__webpack_require__(1);var BaseElement=function(){function BaseElement(view,model,type){this.$view=view;this.model=model;if(type){this.type=type}this.render();this.bind()}BaseElement.prototype.render=function(){var style=utils_1.getScaleStyle(this.model.state,this.model.state.scale);utils_1.setElementStyle(style,this.$view)};BaseElement.prototype.update=function(state){};BaseElement.prototype.bind=function(){};BaseElement.prototype.unbind=function(){};BaseElement.prototype.mounted=function(){};BaseElement.prototype.destroy=function(){this.unbind();delete this.$view;delete this.model};return BaseElement}();exports.default=BaseElement},function(module,exports,__webpack_require__){/*! application */
Object.defineProperty(exports,"__esModule",{value:true});var constant_1=__webpack_require__(0);var utils_1=__webpack_require__(1);var transformer_1=__webpack_require__(14);var picture_1=__webpack_require__(9);var richtext_1=__webpack_require__(10);var shape_1=__webpack_require__(11);var table_1=__webpack_require__(12);var Elements={picture:picture_1.default,richtext:richtext_1.default,shape:shape_1.default,table:table_1.default};var IC_PLAYER_EVENT=(__ConstVariable.PresenterEventType||PresenterEventType).IC_PLAYER_EVENT;var Application=function(){function Application(view,model,presenter){this.state=null;this.elements=[];this.focusedElementIndex=-1;this.moveable=false;this.colorable=false;this.$view=view;this.model=model;this.$presenter=presenter}Application.prototype.run=function(){var _this=this;this.transformer=new transformer_1.default(this.$view);if(typeof this.model.elements==="undefined"){this.model.elements=[this.model]}this.createInstance();var context=this;Object.defineProperties(this.$view,{childViews:{get:function(){return context.elements.map(function(element){return element.$view})}},shapes:{get:function(){return context.elements.reduce(function(memo,element){if(element.type===constant_1.ElementTypes.Shape){memo.push(element["shape"])}return memo},[])}}});if(this.moveable){this.transformer.add("move","rotate")}if(this.colorable){this.transformer.add("color")}this.render();this.bind();this.transformer.on("active",function(){_this.$presenter.logger.debug("[free-combine-element]: active ",_this.model.identifier);_this.$presenter.$dispatchEvent(constant_1.EventName,IC_PLAYER_EVENT,{type:constant_1.EventTypes.Active,data:{identifier:_this.model.identifier}})});this.transformer.on("update",function(current){var state=Object.assign({},_this.state,current);Object.assign(_this.state,_this.transformer.getState());_this.$presenter.logger.debug("[free-combine-element]: update ",_this.model.identifier,JSON.stringify(state));_this.$presenter.$dispatchEvent(constant_1.EventName,IC_PLAYER_EVENT,{type:constant_1.EventTypes.Update,data:{identifier:_this.model.identifier,isGroupBehavior:false,state:state}})})};Application.prototype.destroy=function(){this.unbind();this.elements.forEach(function(item){return item.destroy});delete this.transformer;delete this.$presenter};Application.prototype.bind=function(){var _this=this;this.domEventHandler=function(event){var matched=false;var root=event.currentTarget;var target=event.target;while(target!==root){if(target.nodeType===1){if(target.classList.contains(constant_1.DomClassNames.Body)){_this.focusedElementIndex=+target.getAttribute(constant_1.DomAttrs.Index);matched=true}else if(target.classList.contains(constant_1.DomClassNames.Ctrl)){matched=true}}if(matched){break}else{target=target.parentNode}}if(matched){if(typeof _this.focusedElementIndex==="number"&&_this.focusedElementIndex!==-1){_this.transformer.setExecOptions({isActived:false,isColorable:!!+target.getAttribute(constant_1.DomAttrs.Colorable)});_this.transformer.execute(event)}}};["mousedown","touchstart","touchmove","touchend"].forEach(function(item){_this.$view.addEventListener(item,_this.domEventHandler,false)});this.$presenter.$attachDelegateEvent("mousemove",function(selector,event){if(event.type==="touchmove")return;_this.transformer.execute(event)});this.$presenter.$attachDelegateEvent("mouseup",function(selector,event){if(event.type==="touchend")return;_this.transformer.execute(event)});this.$presenter.$attachDelegateEvent("pageLeave",function(selector,event){_this.transformer.execute(event)})};Application.prototype.unbind=function(){var _this=this;["mousedown","touchstart","touchmove","touchend"].forEach(function(item){_this.$view.removeEventListener(item,_this.domEventHandler,false)});delete this.domEventHandler;this.$presenter.$removeEventListener()};Application.prototype.render=function(){if(!this.moveable){this.$view.classList.add(constant_1.DomClassNames.Pinned)}this.update()};Application.prototype.update=function(){var state=this.state;if(!state){var style=Object.assign({left:0,top:0,scale:0,rotate:0},this.model.state);state=utils_1.getScaleStyle(style,this.model.stage.scale);this.state=state}utils_1.setElementStyle(state,this.$view);this.transformer.setState(state);if(this.colorable){this.elements.forEach(function(element,index){if(element.type===constant_1.ElementTypes.Shape){element.update({color:typeof state.color==="string"?state.color:state.color[index]})}})}};Application.prototype.getInfo=function(){var element=this.elements[!!~this.focusedElementIndex?this.focusedElementIndex:0];var type=element&&element.type||(this.elements.length>1?"combination":this.elements[0].type);var subType=element&&element.type===constant_1.ElementTypes.Shape?element.model.data.shapeType||"":"";var colorable=element?shape_1.isFillableShape(element):false;return{type:type,identifier:this.model.identifier,group:typeof this.model.group==="object"?this.model.group.id:this.model.group,moveable:this.moveable,subType:subType,colorable:colorable}};Application.prototype.getState=function(){return this.state};Application.prototype.setState=function(state){if(state){this.state=state;this.update()}};Application.prototype.setActive=function(isActive){this.$view.classList[isActive?"add":"remove"](constant_1.DomClassNames.Active)};Application.prototype.setStage=function(stage){this.transformer.setState({$stage:stage})};Application.prototype.setMode=function(mode,data){var state=typeof data==="object"?data:[];state.mode=mode;this.transformer.setState(state)};Application.prototype.setColor=function(color){if(this.colorable&&color!==this.state.color){var currentColor=this.state.color;this.state.color=color;this.update();this.transformer.emit("update",{color:currentColor})}};Application.prototype.reset=function(){this.state=null;this.update()};Application.prototype.createInstance=function(){var state=null;var colorState={};var moveable=this.model.moveable!==false,colorable=false;var scale=this.model.stage.scale||1;var isSingleton=this.model.elements.length===1;var elements=this.model.elements.map(function(element,index){if(element.type===constant_1.ElementTypes.Shape){if(element.data.fillColor){colorState[index]=element.data.fillColor}if(!colorable&&shape_1.isFillableShape(element)){colorable=true}}var elementState=isSingleton?{scale:scale,width:element.position.width||0,height:element.position.height||0}:Object.assign({scale:scale},element.position);return{type:element.type,model:{data:element.data,state:elementState}}});if(isSingleton){state=Object.assign({},this.model.elements[0].position);if(elements[0].type===constant_1.ElementTypes.Shape&&!shape_1.isFillableShape(elements[0])){this.$view.style.minHeight=constant_1.DomStyles.ShapeLineMinHeight+"px"}}else{if(this.model.group){state={top:this.model.group.y||this.model.group.top||0,left:this.model.group.x||this.model.group.left||0,width:this.model.group.width||0,height:this.model.group.height||0,rotate:this.model.group.rotate||0}}}if(!moveable){elements.forEach(function(element){if(element.type===constant_1.ElementTypes.Shape){if(shape_1.isFillableShape(element)){element.model.data.edgeWidth=constant_1.DomStyles.PinnedStrokeWidth;element.model.data.edgeColor=constant_1.DomStyles.PinnedStrokeColor}else{element.model.data.lineEdgeWidth=constant_1.DomStyles.PinnedStrokeWidth;element.model.data.lineEdgeColor=constant_1.DomStyles.PinnedStrokeColor}}})}if(state){state.color=colorState;this.model.state=state}else{this.$presenter.logger.debug("[free-combine-element]: createInstance model.state is null")}this.addElements.apply(this,elements);this.moveable=moveable;this.colorable=colorable};Application.prototype.addElements=function(){var _this=this;var elements=[];for(var _i=0;_i<arguments.length;_i++){elements[_i]=arguments[_i]}var views=[],elems=[];elements.forEach(function(item,index){var type=item.type.toLowerCase();if(Elements[type]){var $view=document.createElement("div");$view.className="fct_module_scope js_element_scope js_element_"+type;$view.innerHTML='<div class="fct_module_shape js_element_content"></div>';$view.setAttribute.call($view,constant_1.DomAttrs.Index,index);$view.setAttribute.call($view,constant_1.DomAttrs.Colorable,+shape_1.isFillableShape(item));var element=new Elements[type]($view,item.model);views.push($view);elems.push(element)}});var fragment=document.createDocumentFragment();for(var _a=0,views_1=views;_a<views_1.length;_a++){var view=views_1[_a];fragment.appendChild(view)}this.$view.appendChild(fragment);elems.forEach(function(elem){elem.mounted();_this.elements.push(elem)})};return Application}();exports.default=Application},function(module,exports,__webpack_require__){/*! commander/color */
Object.defineProperty(exports,"__esModule",{value:true});var base_commander_1=__webpack_require__(2);var constant_1=__webpack_require__(0);var Color=function(_super){__extends(Color,_super);function Color(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.color="";_this.nextColor="";return _this}Color.prototype.done=function(ctx,next){var _this=this;if(ctx.mode===constant_1.ElementMode.Colored){if(this.color===this.nextColor||!ctx.options.isColorable){if(!ctx.options.isActived)ctx.emit("active")}else{var color=this.color;ctx.$el["shapes"].forEach(function(item){return item.fill(_this.nextColor)});this.color=this.nextColor;ctx.emit("update",{color:color})}}else{next(ctx)}};Color.prototype.getState=function(){return{color:this.color}};Color.prototype.setState=function(state){if(state.color){this[state.mode===constant_1.ElementMode.Colored?"nextColor":"color"]=state.color}};return Color}(base_commander_1.default);exports.default=Color},function(module,exports,__webpack_require__){/*! commander/filter */
Object.defineProperty(exports,"__esModule",{value:true});var base_commander_1=__webpack_require__(2);var constant_1=__webpack_require__(0);var Filter=function(_super){__extends(Filter,_super);function Filter(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.startX=0;_this.startY=0;_this.pressedTime=0;return _this}Filter.prototype.start=function(ctx,next){if(ctx.event.type==="touchstart"){var toucher=ctx.event["touches"][0];this.startX=toucher.pageX;this.startY=toucher.pageY;ctx.event.preventDefault();ctx.event.stopPropagation()}else{this.startX=ctx.event["pageX"];this.startY=ctx.event["pageY"]}this.pressedTime=Date.now();next({$el:ctx.$el,emit:ctx.emit,target:ctx.event.target})};Filter.prototype.doing=function(ctx,next){var endX=ctx.event["pageX"],endY=ctx.event["pageY"];if(ctx.event.type==="touchmove"){var toucher=ctx.event["touches"][0];endX=toucher.pageX;endY=toucher.pageY;ctx.event.stopPropagation()}if(this.pressedTime&&Date.now()-this.pressedTime>constant_1.PressTime){if(!ctx.options.isActived){ctx.options.isActived=true;ctx.emit("active")}ctx.options.startX=this.startX;ctx.options.startY=this.startY;ctx.options.endX=endX;ctx.options.endY=endY;next(ctx)}};Filter.prototype.done=function(ctx,next){if(ctx.event.type==="touchend"){ctx.event.stopPropagation()}if(!ctx.options.isActived){if(ctx.mode!==constant_1.ElementMode.Colored||ctx.mode===constant_1.ElementMode.Colored&&!ctx.options.isColorable){ctx.options.isActived=true;ctx.emit("active")}}this.pressedTime=0;next(ctx)};return Filter}(base_commander_1.default);exports.default=Filter},function(module,exports,__webpack_require__){/*! commander/move */
Object.defineProperty(exports,"__esModule",{value:true});var base_commander_1=__webpack_require__(2);var constant_1=__webpack_require__(0);var utils_1=__webpack_require__(1);var Move=function(_super){__extends(Move,_super);function Move(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isMoving=false;_this.posX=0;_this.posY=0;_this.disX=0;_this.disY=0;return _this}Move.prototype.start=function(ctx,next){this.isMoving=false;this.disX=this.disY=0;if(!ctx.target.classList.contains(constant_1.DomClassNames.RotateButton)){this.isMoving=true}next(ctx)};Move.prototype.doing=function(ctx,next){if(this.isMoving){this.disX=ctx.options.endX-ctx.options.startX;this.disY=ctx.options.endY-ctx.options.startY;utils_1.setElementStyle({left:this.posX+this.disX,top:this.posY+this.disY},ctx.$el)}else{next(ctx)}};Move.prototype.done=function(ctx,next){if(this.isMoving&&(this.disX||this.disY)){var left=this.posX,top_1=this.posY;this.posX+=this.disX;this.posY+=this.disY;ctx.emit("update",{left:left,top:top_1})}else{next(ctx)}};Move.prototype.undo=function(ctx,next){if(this.isMoving&&(this.disX||this.disY)){utils_1.setElementStyle({left:this.posX,top:this.posY},ctx.$el)}else{next(ctx)}};Move.prototype.getState=function(){return{left:this.posX,top:this.posY}};Move.prototype.setState=function(state){if(typeof state.left==="number")this.posX=state.left;if(typeof state.top==="number")this.posY=state.top};return Move}(base_commander_1.default);exports.default=Move},function(module,exports,__webpack_require__){/*! commander/rotate */
Object.defineProperty(exports,"__esModule",{value:true});var base_commander_1=__webpack_require__(2);var constant_1=__webpack_require__(0);var utils_1=__webpack_require__(1);var Rotate=function(_super){__extends(Rotate,_super);function Rotate(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isRotating=false;_this.left=0;_this.top=0;_this.angle=0;_this.lastAngle=0;return _this}Rotate.prototype.start=function(ctx,next){this.isRotating=false;this.lastAngle=this.angle;if(ctx.target.classList.contains(constant_1.DomClassNames.RotateButton)){var rect=ctx.$el.getBoundingClientRect();this.isRotating=true;this.left=rect.left+rect.width/2;this.top=rect.top+rect.height/2}next(ctx)};Rotate.prototype.doing=function(ctx,next){if(this.isRotating){var disAngle=utils_1.calcRotateAngle({x:this.left,y:this.top},{x:ctx.options.startX,y:ctx.options.startY},{x:ctx.options.endX,y:ctx.options.endY});this.lastAngle=this.angle+disAngle;utils_1.setElementStyle({rotate:this.lastAngle},ctx.$el)}else{next(ctx)}};Rotate.prototype.done=function(ctx,next){if(this.isRotating&&this.angle!==this.lastAngle){var rotate=this.angle;this.angle=this.lastAngle;ctx.emit("update",{rotate:rotate})}else{next(ctx)}};Rotate.prototype.undo=function(ctx,next){if(this.isRotating&&this.angle!==this.lastAngle){utils_1.setElementStyle({rotate:this.angle},ctx.$el)}else{next(ctx)}};Rotate.prototype.getState=function(){return{rotate:this.angle}};Rotate.prototype.setState=function(state){if(typeof state.rotate==="number"){this.angle=state.rotate;this.lastAngle=state.rotate}};return Rotate}(base_commander_1.default);exports.default=Rotate},function(module,exports,__webpack_require__){/*! element/picture */
Object.defineProperty(exports,"__esModule",{value:true});var base_element_1=__webpack_require__(3);var constant_1=__webpack_require__(0);var Picture=function(_super){__extends(Picture,_super);function Picture(view,model){return _super.call(this,view,model,constant_1.ElementTypes.Picture)||this}Picture.prototype.render=function(){_super.prototype.render.call(this);var $content=this.$view.querySelector(constant_1.DomSelectors.Content);$content.innerHTML='<span class="item_wh_100"><img src="'+this.model.data.url+'"></span>'};Picture.prototype.bind=function(){var _this=this;["mousedown","touchstart"].forEach(function(item){_this.$view.addEventListener(item,_this.preventImageDefault,false)})};Picture.prototype.unbind=function(){var _this=this;["mousedown","touchstart"].forEach(function(item){_this.$view.removeEventListener(item,_this.preventImageDefault,false)})};Picture.prototype.preventImageDefault=function(event){if(event.target.nodeName.toLowerCase()==="img"){event.preventDefault()}};return Picture}(base_element_1.default);exports.default=Picture},function(module,exports,__webpack_require__){/*! element/richtext */
Object.defineProperty(exports,"__esModule",{value:true});var base_element_1=__webpack_require__(3);var constant_1=__webpack_require__(0);var utils_1=__webpack_require__(1);var RichText=function(_super){__extends(RichText,_super);function RichText(view,model){return _super.call(this,view,model,constant_1.ElementTypes.RichText)||this}RichText.prototype.render=function(){_super.prototype.render.call(this);var scale=this.model.state.scale||1;var padding=constant_1.DomStyles.TextContainerPadding*scale;var fontSize=constant_1.DomStyles.TextFontSize*scale;if(this.model.data.html){var html=utils_1.filterHtmlProperties(this.model.data.html,function(m,k,v){switch(k){case"font-size":return"font-size:"+parseInt(v)*scale+"px;";case"width":case"height":case"background":return"";default:return m}});var $content=this.$view.querySelector(constant_1.DomSelectors.Content);$content.style.padding=padding+"px";$content.style.fontSize=fontSize+"px";$content.innerHTML=html}};RichText.prototype.bind=function(){var _this=this;["mousedown","touchstart"].forEach(function(item){_this.$view.addEventListener(item,_this.preventAnchorDefault,false)})};RichText.prototype.unbind=function(){var _this=this;["mousedown","touchstart"].forEach(function(item){_this.$view.removeEventListener(item,_this.preventAnchorDefault,false)})};RichText.prototype.preventAnchorDefault=function(event){if(event.target.nodeName.toLowerCase()==="a"){event.preventDefault()}};return RichText}(base_element_1.default);exports.default=RichText},function(module,exports,__webpack_require__){/*! element/shape */
Object.defineProperty(exports,"__esModule",{value:true});var base_element_1=__webpack_require__(3);var constant_1=__webpack_require__(0);var utils_1=__webpack_require__(1);function isFillableShape(element){return element.type===constant_1.ElementTypes.Shape&&!((element.model||element).data.points instanceof Array)}exports.isFillableShape=isFillableShape;var Shape=function(_super){__extends(Shape,_super);function Shape(view,model){return _super.call(this,view,model,constant_1.ElementTypes.Shape)||this}Shape.prototype.mounted=function(){this.shape=new ShapeBuilder(this.$view.querySelector(constant_1.DomSelectors.Content));this.shape.setShape(this.model.data.shapeType);var data=this.model.data,state=this.model.state;var scale=state.scale,width=state.width*scale,height=state.width*scale;if(data.edgeWidth&&this.shape.setAttr){this.shape.setAttr({strokeWidth:data.edgeWidth})}this.shape.setSize(state.width*scale,state.height*scale).fill(data.fillColor).stroke(data.edgeColor,data.edgeWidth);if(data.points&&data.points.length){var points=Array.prototype.concat.apply([],data.points);if(scale!==1){points=points.map(function(item){return item*scale})}if(data.lineEdgeColor&&data.lineEdgeWidth){points.push.call(points,data.lineEdgeColor,data.lineEdgeWidth)}this.shape.line.apply(this.shape,points);this.$view.style.minHeight=constant_1.DomStyles.ShapeLineMinHeight+"px"}if(data.html){data.textStyle.padding=constant_1.DomStyles.TextContainerPadding;data.textStyle.fontSize=constant_1.DomStyles.TextFontSize;var style=scale!==1?Object.keys(data.textStyle).reduce(function(memo,item){memo[item]=parseInt(data.textStyle[item])*scale+"px";return memo},{}):data.textStyle;var html=utils_1.filterHtmlProperties(data.html,function(m,k,v){if(k==="font-size"){return"font-size:"+parseInt(v)*scale+"px;"}return m});var $content=this.$view.querySelector(constant_1.DomSelectors.Content);var $div=document.createElement("div");$div.className="js_shape_text";$div.innerHTML=html;style.position="absolute";for(var k in style){$div.style[k]=style[k]}$content.appendChild($div)}};Shape.prototype.update=function(state){if(state.color){this.shape.fill(state.color)}};return Shape}(base_element_1.default);exports.default=Shape},function(module,exports,__webpack_require__){/*! element/table */
Object.defineProperty(exports,"__esModule",{value:true});var base_element_1=__webpack_require__(3);var constant_1=__webpack_require__(0);var Table=function(_super){__extends(Table,_super);function Table(view,model){return _super.call(this,view,model,constant_1.ElementTypes.Table)||this}Table.prototype.render=function(){_super.prototype.render.call(this);var $content=this.$view.querySelector(constant_1.DomSelectors.Content);$content.innerHTML=this.model.data.html;var $table=$content.querySelector("table");$table.style.width="100%";$table.style.height="100%"};return Table}(base_element_1.default);exports.default=Table},function(module,exports,__webpack_require__){/*! presenter */
Object.defineProperty(exports,"__esModule",{value:true});var constant_1=__webpack_require__(0);var app_1=__webpack_require__(4);var Presenter=function(_super){__extends(Presenter,_super);function Presenter(presenterName){var _this=_super.call(this)||this;_this.metaInfo=Object.assign(_this.metaInfo||{},{name:"FreeCombineElement",type:__ConstVariable.PresenterType.PRESENTER_COMPONENT});_this.logger.appendHandler(function(message,context){window.console.debug(message)},{level:Logger.DEBUG});return _this}Presenter.prototype.run=function(view,model){try{this.$app=new app_1.default(view.querySelector(constant_1.DomSelectors.Root),model,this);this.$app.run()}catch(e){this.logger.debug(e.message)}};Presenter.prototype.destroy=function(){if(this.$app){this.$app.destroy()}delete this.$app;delete this.$service};Presenter.prototype.getService=function(){var _this=this;if(!this.$service){this.$service={getPresenterIdentify:function(){return _this.$app.getInfo().identifier},getState:function(){return _this.$app.getState()},setState:function(state){return _this.$app.setState(state)},getElementInfo:function(){return _this.$app.getInfo()},getElementState:function(){return _this.$app.getState()},setElementState:function(state){return _this.$app.setState(state)},resetElementState:function(){return _this.$app.reset()},setElementMode:function(mode,data){return _this.$app.setMode(mode,data)},setActive:function(isActive){return _this.$app.setActive(isActive)},fillColor:function(color){return _this.$app.setColor(color)},setStage:function(stage){return _this.$app.setStage(stage)},getSiblings:function(){/*! abolished */return[]},setSiblings:function(){/*! abolished*/return void 0}}}return this.$service};return Presenter}(BasicPresenter);module.exports=function(){return new Presenter("FreeCombineElement")}},function(module,exports,__webpack_require__){/*! transformer */
Object.defineProperty(exports,"__esModule",{value:true});var constant_1=__webpack_require__(0);var utils_1=__webpack_require__(1);var color_1=__webpack_require__(5);var move_1=__webpack_require__(7);var rotate_1=__webpack_require__(8);var filter_1=__webpack_require__(6);var Commanders={color:color_1.default,move:move_1.default,rotate:rotate_1.default,filter:filter_1.default};var Transformer=function(){function Transformer(view){this.commanders=[];this.emitters={};this.execOption={};this.mode=constant_1.ElementMode.Selected;this.isExecuting=false;this.$view=view}Transformer.prototype.execute=function(event){if(this.mode===constant_1.ElementMode.Disabled||!this.commanders.length){return}var command="";switch(event.type){case"mousedown":case"touchstart":this.isExecuting=true;command="start";break;case"mousemove":case"touchmove":if(!this.isExecuting)return;command="doing";break;case"mouseup":case"mouseleave":case"touchend":case"touchcancel":default:if(!this.isExecuting)return;this.isExecuting=false;command=utils_1.isElementsInStage.apply(void 0,[this.$stage].concat(this.$view["childViews"]))===false?"undo":"done";break}var index=0;var commanders=this.commanders;var next=function(data){if(index>=commanders.length){return}var cmd=commanders[index++];cmd[command].call(cmd,data,next)};next({event:event,mode:this.mode,emit:this.emit.bind(this),$el:this.$view,options:this.execOption})};Transformer.prototype.add=function(){var _this=this;var commanders=[];for(var _i=0;_i<arguments.length;_i++){commanders[_i]=arguments[_i]}if(!this.commanders.length&&commanders[0]!=="filter"){commanders.unshift("filter")}commanders.forEach(function(item){if(Commanders[item]){var cmd=new Commanders[item];_this.commanders.push(cmd)}})};Transformer.prototype.remove=function(name){var _this=this;this.eachCommanders(function(item,index){if(name===item.name&&_this.commanders.splice(index,-1)){return false}})};Transformer.prototype.has=function(name){name=name.toLowerCase();var hasCommander=false;this.eachCommanders(function(item){if(name===item.name){hasCommander=true;return false}});return hasCommander};Transformer.prototype.on=function(name,handler){if(typeof handler==="function"){this.emitters[name]=handler}};Transformer.prototype.emit=function(name,params){if(this.emitters[name]){this.emitters[name](params)}else{console.log("[free-combine-element]: transformer.emit ",name," not exits")}};Transformer.prototype.getState=function(){return Object.assign.apply(Object,[{}].concat(this.eachCommanders("getState")))};Transformer.prototype.setState=function(state){if(state.mode){this.mode=state.mode}if(state.$stage){this.$stage=state.$stage}this.eachCommanders("setState",state)};Transformer.prototype.setExecOptions=function(options){this.execOption=options};Transformer.prototype.eachCommanders=function(handler,param){var result=[];for(var i=-1,item=void 0;item=this.commanders[++i];){var ret=typeof handler==="string"?item[handler].call(item,param):handler.call(this,item,i);if(ret===false){return}else{result.push(ret)}}return result};return Transformer}();exports.default=Transformer}]);]]>

</presenter>


<resources>



</resources>

</addon>