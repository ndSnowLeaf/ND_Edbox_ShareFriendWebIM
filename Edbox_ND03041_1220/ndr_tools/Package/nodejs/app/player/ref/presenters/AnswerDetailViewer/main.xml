<?xml version='1.0' encoding='UTF-8' ?>
<addon id='AnswerDetailViewer'>
<properties>

                <property />

</properties>

<dependencies>

<jsDependency>
    <javaScript  name="vue-libs" version="2.1.10" />
</jsDependency>


</dependencies>

<css>

<![CDATA[.addon_AnswerDetailViewer{display:none}]]>

</css>


<view>

<![CDATA[<div class="js_vue_app" style="width:100%;height:100%"><div class="chineseCharacter-module-answer"><div class="chineseCharacter-module-student-title"><div class="student-answer-text" v-html="header"></div></div><div class="chineseCharacter-module-student-box-ul js_answer_list" ref="listBox"><ul class="chineseCharacter-module-student-box-ul-box" ref="leftList"><answer-item v-for="item in leftList" :answer="item" @click-word="clickWord"></answer-item></ul><ul class="chineseCharacter-module-student-box-ul-box" ref="rightList"><answer-item v-for="item in rightList" :answer="item" @click-word="clickWord"></answer-item></ul></div></div><div class="mixedModule-resultview" v-show="resultLevel" :class="[resultLevel? 'resultview-' + resultLevel: '']"></div><div class="chineseCharacter-pop-bgtips" v-show="message" :class="{'notice-tip-box-auto': message}"><div class="pop_text_main"><span class="font_size">{{message}}</span></div></div></div>]]>
</view>


<presenter>

<![CDATA[/*!   updated: 2017-09-27 16:48:08   */
window["AddonAnswerDetailViewer_create"]=function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=7)}([function(module,exports){module.exports={PresenterName:"AnswerDetailViewer",NativePresenterName:"ChineseCharacterDictation",NativeSubExamType:"ChineseCharacterDictationItem",RecoginzeResult:{Success:0,Fault:1,SuccessButNotCheckSequence:2,StrokeNumberError:3,StrokeSequenceError:4},PresenterEventName:"AnswerDetailViewerEvent",ScrollMinDistance:10,AnswerBaseHeight:199,AnswerPaddingHeight:29,AnswerResultHeight:42,ViewStyles:{Scrollbar:"ChineseCd-light-scrollbar"},StrokeUnicodeMap:{"提":"㇀","弯钩":"㇁","斜钩":"㇂","卧钩":"㇃","竖弯":"㇄","横折折":"㇅","横折钩":"㇆","横撇":"㇇","横折弯钩":"㇈","竖折折钩":"㇉","横折提":"㇊","横折折撇":"㇋","横撇弯钩":"㇌","横折弯":"㇍","横折折折":"㇎","捺":"㇏","横":"㇐","竖":"㇑","撇":"㇒","竖撇":"㇓","点":"㇔","横折":"㇕","横钩":"㇖","竖折":"㇗","竖弯折":"㇘","竖提":"㇙","竖钩":"㇚","撇点":"㇛","撇折":"㇜","提捺":"㇝","竖折折":"㇞","竖弯钩":"㇟","横斜弯钩":"㇠","横折折折钩":"㇡","撇钩":"㇢","圈":"㇣","竖折撇":"ㄣ"}}},function(module,exports){var Environment={};exports.set=function(env){if(env&&env instanceof Object){for(var key in env){Environment[key]=env[key]}}};exports.get=function(){return Environment}},function(module,exports,__webpack_require__){var Const=__webpack_require__(0);var logger;if(Logger){(logger=Logger.get(Const.PresenterName),logger).appendHandler(function(message,context){window.console.log(message)},{level:Logger.DEBUG})}else{logger=window.console}module.exports=logger},function(module,exports,__webpack_require__){/*! api */
var Const=__webpack_require__(0);var Api=function(presenter){this.$presenter=presenter;this.$wordcard=null};Api.prototype={destroy:function(){this.$presenter.$removeEventListener();this.$presenter=null;this.$wordcard=null},onCalled:function(options){this.$presenter.$addEventListener(Const.PresenterEventName,PresenterEventType.IC_PLAYER_EVENT,function(data){if(data.type==="show"){options.show(data.data)}else if(data.type==="hide"){options.hide()}})},createPresenter:function(){this.$presenter.$dispatchEvent("createPresenter",PresenterEventType.NATIVE_EVENT,{presenterId:Const.NativePresenterName,instanceId:Const.NativePresenterName})},destroyPresenter:function(){this.$presenter.$dispatchEvent("destroyPresenter",PresenterEventType.NATIVE_EVENT,{presenterId:Const.NativePresenterName,instanceId:Const.NativePresenterName})},noticeGetAnswer:function(userId,examId){this.$presenter.$dispatchEvent("Exam",PresenterEventType.PPT_NATIVE_EVENT,{type:"subExamAnswer",source:Const.PresenterName,isShowAnswer:true,users:[userId],value:{subExamId:examId,subExamType:Const.NativeSubExamType,handinMethod:"student"}})},onNoticeGetAnswer:function(callback){this.$presenter.$addEventListener("ExamCallback",PresenterEventType.NATIVE_EVENT,function(data){if(data.type==="subExamAnswer"&&data.target===Const.PresenterName){callback(data)}})},onGetAnswer:function(callback){this.$presenter.$addEventListener("showAnswerCompoundCallback",PresenterEventType.NATIVE_EVENT,function(data){if(data.question_type===Const.NativePresenterName&&data.subExamType===Const.NativeSubExamType){callback(data)}})},requireWordCard:function($container){var _this=this;return this.$presenter.$requireComponent("WordCardController",[],$container,{}).then(function(presenter){_this.$wordcard=presenter.getService()})},launchWordCard:function(options){this.$wordcard&&this.$wordcard.execute({eventData:options,eventName:"ShowWordCard"})},onCloseWordCard:function(callback){this.$presenter.$addEventListener("ShowCardClose",PresenterEventType.IC_PLAYER_EVENT,callback)},getQuestionContent:function(){var content=null;this.$presenter.$addEventListener("ChineseDictation/QuestionModel/Callback",PresenterEventType.IC_PLAYER_EVENT,function(data){if(data&&data.data){content=data.data}});this.$presenter.$dispatchEvent("ChineseDictation/QuestionModel",PresenterEventType.IC_PLAYER_EVENT);return content}};module.exports=Api},function(module,exports,__webpack_require__){/*! app */
var Const=__webpack_require__(0);var Rolload=__webpack_require__(8);var createVueInstance=__webpack_require__(9);var env=__webpack_require__(1).get();var logger=__webpack_require__(2);var App=function($view,$service){this.$view=$view;this.$service=$service;this.$rolload=null;this.studentId="";this.questionContent=$service.$api.getQuestionContent();this.$vue=createVueInstance(this.$view);this.bind()};App.prototype={destroy:function(){this.unbind();if(this.$rolload){this.$rolload.destroy()}this.$vue.$destroy();this.$vue=this.$service=null},bind:function(){var _this=this;this.$service.$api.onCalled({show:function(data){_this.enter(data)},hide:function(){_this.exit()}});this.$vue.clickWord=function(questionId,index){_this.launchWordCard(questionId,index)}},unbind:function(){},enter:function(data){logger.debug("enter",JSON.stringify(data));if(typeof data!=="undefined"){this.setIntactData(data)}this.$view.style.display="block";if(data.from==="self"){}else{if(env.isPC&&!env.isStudent&&data.studentId){this.studentId=data.studentId;this.enterFromStats()}}},enterFromStats:function(){if(!this.$rolload){var _this=this;this.$service.$api.onNoticeGetAnswer(function(data){logger.debug("subExamAnswerCallback",data);_this.$rolload.next();if(data.value.result===false){logger.warn("subExamAnswerCallback","收题失败",data)}});this.$service.$api.onGetAnswer(function(data){logger.debug("showAnswerCompoundCallback",data);_this.setPartialData(data)});this.$rolload=new Rolload({$el:this.$view.querySelector(".js_answer_list"),itemSelector:".js_answer_list_item",load:function(item){logger.debug("subExamAnswer",_this.studentId,item.id);_this.$service.$api.noticeGetAnswer(_this.studentId,item.id)}})}setTimeout(function(){this.$rolload.refresh()}.bind(this),0)},exit:function(){logger.debug("exit");this.$view.style.display="none"},setIntactData:function(data){if(data.studentId&&this.studentId===data.studentId){return}var viewData=this.convertToViewData(data);this.$vue.$data.header=this.getHeaderContent(viewData);this.$vue.$data.leftList=viewData.leftList;this.$vue.$data.rightList=viewData.rightList;if(env.isApp||env.isStudent){this.$vue.showLevelResult(this.getResultLevel(viewData),2e3)}},setPartialData:function(data){if(data&&data.answerData&&data.answerData.data instanceof Array){var target=null;for(var i=0,l=Math.max(this.$vue.$data.leftList.length,this.$vue.$data.rightList.length);i<l;i++){var leftItem=this.$vue.$data.leftList[i];if(leftItem&&leftItem.id===data.subExamId){target=leftItem;break}var rightItem=this.$vue.$data.rightList[i];if(rightItem&&rightItem.id===data.subExamId){target=rightItem;break}}if(target){var isLoaded=false;data.answerData.data.forEach(function(item,index){if(item.value){if(target.data[index]){target.data[index].dataURL=item.value}if(!isLoaded){isLoaded=true}}});target.loaded=isLoaded}}},convertToViewData:function(data){var minute=~~(data.submitTime/60),second=data.submitTime%60;var rightNum=0,wrongNum=0;var leftItemNum=0,rightItemNum=0,leftList=[],rightList=[];data.answerData.forEach(function(answer){var id=answer.id;var questionData=this.questionContent.find(function(item){return item.SubQuestionId===id});if(questionData){questionData=questionData.SubQuestionData}var result=[],isCorrect=true;var dataUrlList=answer.data?answer.data.data:null;(questionData.word||answer.word||[]).forEach(function(item,index){var _result=(answer.result||[])[index];if(isCorrect&&(!_result||_result.result!==Const.RecoginzeResult.Success)){isCorrect=false}var dataURL="";if(dataUrlList&&dataUrlList[index]){dataURL=dataUrlList[index].value}result.push({dataURL:dataURL,pinyin:(questionData.pinyin||[])[index],result:_result?_result.result:Const.RecoginzeResult.Fault,message:this.getRecognizeMessage(item,_result)})},this);if(isCorrect){rightNum++}else{wrongNum++}var leftAbstractHeight=this.getAbstractHeight(leftList.length,leftItemNum),rightAbstractHeight=this.getAbstractHeight(rightList.length,rightItemNum);if(leftAbstractHeight<=rightAbstractHeight){leftList.push({id:id,index:answer.index,loaded:false,data:result});leftItemNum+=result.length}else{rightList.push({id:id,index:answer.index,loaded:false,data:result});rightItemNum+=result.length}},this);return{total:data.answerData.length,rightNum:rightNum,wrongNum:wrongNum,minute:minute,second:second,leftList:leftList,rightList:rightList,from:data.from}},getResultLevel:function(data){var accuracy=data.rightNum/data.total*100;switch(true){case accuracy===100:return"a";case accuracy>=80:return"b";case accuracy>=60:return"c";default:return"d"}},getTipMessage:function(data){var accuracy=data.rightNum/data.total*100;switch(true){case accuracy===100:return this.$service.$i18n("tip.correct.all");case accuracy>=80:return this.$service.$i18n("tip.correct.most");case accuracy>=60:return this.$service.$i18n("tip.correct.many");default:return this.$service.$i18n("tip.correct.few")}},getHeaderContent:function(data){var content=this.$service.$i18n("header.time",["<span>"+data.minute+"</span>","<span>"+data.second+"</span>"]);if(data.from==="self"){content+=" "+this.$service.$i18n("header.counter",["<span>"+data.total+"</span>",'<span class="right-text">'+data.rightNum+"</span>",'<span class="wrong-text">'+data.wrongNum+"</span>"])}content+='<span class="chineseCharacter-sut-tip">'+this.$service.$i18n("header.tip")+"</span>";return content},getRecognizeMessage:function(word,recognize){var result=Const.RecoginzeResult.Fault;if(recognize&&typeof recognize.result!=="undefined"){result=recognize.result}switch(result){case Const.RecoginzeResult.Success:return this.$service.$i18n("result.right",word);case Const.RecoginzeResult.StrokeNumberError:return this.$service.$i18n("result.wrong.num",[word,recognize.correctStrokeNum,recognize.writeStrokeNum]);case Const.RecoginzeResult.StrokeSequenceError:return this.$service.$i18n("result.wrong.sequence",word);default:return this.$service.$i18n("result.wrong",word)}},launchWordCard:function(questionId,index){var questionData=this.questionContent.find(function(item){return item.SubQuestionId===questionId});if(questionData&&questionData.SubQuestionData){var pinyin=questionData.SubQuestionData.pinyin[index]||"";var resource=questionData.SubQuestionData.wordCardResources&&questionData.SubQuestionData.wordCardResources[index]||"";if(resource){this.$service.$wordcard.show({pinyin:pinyin,resource:resource})}else{this.$vue.toast(this.$service.$i18n("tip.wordcard.null"),2e3);logger.info("launch wordcard: resource is null",questionId,index,pinyin)}}else{this.$vue.toast(this.$service.$i18n("tip.wordcard.null"),2e3);logger.warn("launch wordcard: questionData is null",questionId)}},getAbstractHeight:function(answerNum,resultNum){return answerNum*Const.AnswerBaseHeight+(answerNum-1)*Const.AnswerPaddingHeight+resultNum*Const.AnswerResultHeight}};module.exports=App},function(module,exports,__webpack_require__){/*! wordcard */
var Const=__webpack_require__(0);var env=__webpack_require__(1).get();var Controller=function($container,$api){this.$container=$container;this.$api=$api;this.$view=null;this.hasShown=false};Controller.prototype={destroy:function(){delete this.$api;delete this.$view},run:function(){var $div=document.createElement("div");$div.className="_from_addon_"+Const.PresenterName;var style={display:"none",position:"fixed",width:"100%",height:"100%",top:0,left:0,zIndex:1500,background:"rgba(0,0,0,.4)"};for(var k in style){$div.style[k]=style[k]}this.$view=$div;if(this.$container.jquery){this.$container.append($div)}else{this.$container.appendChild($div)}delete this.$container;this.$api.requireWordCard($div);this.$api.onCloseWordCard(this.hide.bind(this))},setContainer:function($container){this.$container=$container},show:function(options){if(this.hasShown)return;this.hasShown=true;var resource=options.resource;var matched=resource.match(/\/([\w-_]+)(?:\.[a-zA-Z]*)?$/);var identify=matched?matched[1]:Date.now().toString();this.$api.launchWordCard({content:"JuniorGrade",identify:identify,phonetic:options.pinyin,resourceRoot:resource,scene:"InClass",stage:"ChineseCharacterDictation",showCard:true,maxCard:1});var waitTime=env.isPC?50:150;setTimeout(function(){this.$view.style.display="block";this.hasShown=false}.bind(this),waitTime)},hide:function(){this.$view.style.display="none"}};module.exports=Controller},function(module,exports){module.exports='<li class="chineseCharacter-module-student-box js_answer_list_item" :data-id=answer.id :data-index=answer.index :data-loaded=answer.loaded><div class=chineseCharacter-module-student-item><div class=chineseCharacter-module-student-num><span class=student-num-text>{{answer.index + 1}}</span></div><div class=chineseCharacter-module-spell><ul class=chineseCharacter-module-spell-box><template v-for="(item, index) in answer.data"><li class=chineseCharacter-module-spell-item :class="{\'you-are-right\': item.result === 0, \'you-are-wrong\': item.result !== 0}" @click="$emit(\'click-word\', answer.id, index)"><div class=spell_letter><span class=spell_letter-text>{{item.pinyin}}</span></div><div class="spell_characters wrong-character-box"><div class=spell_characters-box><img :src=item.dataURL v-if=item.dataURL></div></div></li>&#x0020;</template></ul></div><div class=chineseCharacter-module-student-result-box><p class=student-result-text v-for="item in answer.data" :class="{\'you-are-right\': item.result === 0, \'you-are-wrong\': item.result !== 0}"><i class=student-result-icon></i>{{item.message}}</p></div></div></li>'},function(module,exports,__webpack_require__){/*! presenter */
var Const=__webpack_require__(0);var Api=__webpack_require__(3);var Application=__webpack_require__(4);var WordCardCtrl=__webpack_require__(5);var env=__webpack_require__(1);var logger=__webpack_require__(2);var Presenter=BaseController.extend({metaInfo:{name:Const.PresenterName,type:PresenterType.PRESENTER_COMPONENT},$init:function(){this._super();this.$service=null;this.$api=null;this.$application=null;this.$wordcard=null},$afterSetLayoutService:function(){this._launchWordCard()},run:function(view,model){env.set({isTeacher:this.isTeacher,isStudent:this.isStudent,isPC:this.isPPTShell||this.isPC||this.isWeb,isApp:this.isApp});try{this.$api=new Api(this);this.$wordcard=new WordCardCtrl(view,this.$api);this.$application=new Application(view,{$api:this.$api,$wordcard:this.$wordcard,$i18n:this.$translator.translate.bind(this.$translator)});this._launchWordCard()}catch(e){logger.debug(e.message)}},destroy:function(){if(this.$application){this.$application.destroy()}if(this.$wordcard){this.$wordcard.destroy()}if(this.$api){this.$api.destroy()}delete this.$application;delete this.$wordcard;delete this.$api},getService:function(){if(!this.$service){var _this=this;return{setLocationProperties:function(data){_this.$translator.setData(data)},showAnswerDetail:function(data){_this.$application.enter(data)},hideAnswerDetail:function(){_this.$application.exit()}}}return this.$service},_launchWordCard:function(){if(this.layoutService&&this.$wordcard){var $container=typeof this.layoutService.getContainer==="function"?this.layoutService.getContainer("PopupPanel"):null;if($container){this.$wordcard.setContainer($container)}this.$wordcard.run();this._launchWordCard=function(){}}}});module.exports=function(){return new Presenter}},function(module,exports){/*! rolload */
var Rolload=function(options){if(!options.$el||!options.itemSelector){throw new Error("[AnswerDetailViewer]: $el or itemSelector is error")}this.$el=options.$el;this.itemSelector=options.itemSelector;this.items=[];this.timer=null;this.queue=[];this.isLoading=false;this.delay=typeof options.delay==="number"?options.delay:LoadSettings.delay;this.load=typeof options.load==="function"?options.load:function(){};this.init()};Rolload.prototype={init:function(){this.$el.addEventListener("scroll",this._scroll.bind(this));this.refresh()},destroy:function(){this.$el=this.onLoad=null;this.$el.removeEventListener("scroll",this._scroll.bind(this))},refresh:function(){var viewHeight=this.$el.offsetHeight;this.firstLoad=LoadSettings.firstLoad*viewHeight;this.eachLoad=LoadSettings.eachLoad*viewHeight;this.preload=LoadSettings.preload*viewHeight;this.queue=[];this.items=Array.prototype.reduce.call(this.$el.querySelectorAll(this.itemSelector),function(memo,$item){var loaded=$item.getAttribute("data-loaded");if(loaded!=="true"){memo.push({id:$item.getAttribute("data-id"),index:+$item.getAttribute("data-index"),top:$item.offsetTop})}return memo},[]).sort(function(a,b){return a.index-b.index});this.isLoading=false;this._pushInRange(0,this.firstLoad)},next:function(){this.isLoading=false;if(this.queue.length){this.isLoading=true;this.load(this.queue.shift())}},_pushInRange:function(start,end){var i=0,item=this.items[i];while(item){if(item.top>=start&&item.top<end){this.queue.push(item);this.items.splice(i,1)}else{i+=1}item=this.items[i]}if(!this.isLoading){this.next()}},_scroll:function(event){if(!this.items.length)return;clearTimeout(this.timer);var scrollTop=event.target.scrollTop;this.timer=setTimeout(function(){this._pushInRange(scrollTop,scrollTop+this.preload+this.eachLoad)}.bind(this),this.delay)}};var LoadSettings={delay:.1*1e3,firstLoad:2,eachLoad:1,preload:1};module.exports=Rolload},function(module,exports,__webpack_require__){/*! vue */
var Const=__webpack_require__(0);var ListItemTemplate=__webpack_require__(6);module.exports=function($view){return new Vue({el:$view.querySelector(".js_vue_app"),data:{header:"",message:"",resultLevel:"",leftList:[],rightList:[]},components:{"answer-item":{props:["answer"],template:ListItemTemplate}},watch:{header:function(){this.$refs.listBox.scrollTop=0;setTimeout(function(){var isNeedScroll=Math.max(this.$refs.leftList.offsetHeight,this.$refs.rightList.offsetHeight)>this.$refs.listBox.offsetHeight+Const.ScrollMinDistance;this.$refs.listBox.classList[isNeedScroll?"add":"remove"](Const.ViewStyles.Scrollbar)}.bind(this),0)}},methods:{toast:function(content,auto){this.message=content;auto&&setTimeout(function(){this.message=""}.bind(this),+auto)},showLevelResult:function(level,auto){this.resultLevel=level;auto&&setTimeout(function(){this.resultLevel=""}.bind(this),+auto)}}})}}]);]]>

</presenter>


<resources>



</resources>

</addon>