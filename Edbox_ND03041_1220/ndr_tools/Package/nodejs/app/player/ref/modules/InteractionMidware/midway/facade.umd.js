!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(e.jQuery)}(this,function(e){"use strict";function t(e,t){if(e)throw new Error("[midway] "+t)}function n(e,t){return e.substr(0,t.length)===t}function r(e,t){return n(e,"file://")?e=e.replace(/(\/{0,3})\/*/g,"$1"):(e=e.replace(/:\//g,"://"),e=e.replace(/([^:\s\%\3\A])\/+/g,"$1/")),e=e.replace(/\/(\?|&|#[^!])/g,"$1"),e=e.replace(/(\?.+)\?/g,"$1&")}function o(e,t){t.name&&e.unshift((new Date).toUTCString(),"("+t.level.name+")","["+t.name+"]")}function i(){var e=arguments,t=e[0],n=void 0,r=void 0;for(r=1;r<e.length;r++)for(n in e[r])n in t||!e[r].hasOwnProperty(n)||(t[n]=e[r][n]);return t}function a(e,t,n){Object.defineProperty?Object.defineProperty(e,t,{configurable:!0,writable:!0,value:n}):e[t]=n}function s(e,t){if(!l(e)||!Object.prototype.hasOwnProperty.call(e,"_id"))throw new TypeError(t+" method called on incompatible receiver "+("undefined"==typeof e?"undefined":N(e)))}function l(e){return Object(e)===e}function u(e){return e+"_"+c()+"."+c()}function c(){return Math.random().toString().substring(2)}function f(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){return e&&f(e,t)&&e[t]}function h(){p("extendModule",we),p("extendModuleRequire",ye),p("extendModuleDefine",me),p("extendModuleRelease",ge)}function p(e,t){"function"==typeof t?Object.defineProperty(Oe,e,{enumerable:!0,writable:!1,configurable:!1,value:t}):Oe[e]||(Oe[e]=t)}function v(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0][0],i=n[0][1],a=n[0][2],s=n[0][3],l=o;(null!==i||void 0!==i)&&i.length>0&&i.forEach(function(e){"__Id"===e.name&&(l=e.value)});var u={addonId:o,id:l,layout:{left:0,top:0,width:"100%",height:"100%"},properties:null===i?[]:i};return s&&null!==s&&(e.extend(u.layout,s),void 0!==s.zindex&&(u["z-index"]=s.zindex)),null!==a&&e.extend(u,{renderTo:a}),u}function y(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0][0],o=t[0][1],i=t[0][2],a=t[0][3],s={};Array.prototype.isArray(o)&&o.length>0&&o.forEach(function(e){s[e.name]=e.value||(e.text?JSON.parse(e.text):void 0)});var l=void 0;void 0!==i&&(l="string"==typeof i?this.View.querySelector(i):i instanceof jQuery?i[0]:i);var u=$.extend(a,{style:{width:"100%",height:"100%"}});return{code:r,model:s,attributes:u,rendTo:l}}function g(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}function m(e,t){switch(t.level.name){case"DEBUG":console.debug(e);break;case"INFO":console.info(e);break;case"WARN":console.warn(e);break;case"ERROR":console.error(e);break;default:console.log(e)}}function w(t,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=void 0;if(t.Online===!1)a=J.urlJoin(t.ConfigPath||"configuration",o);else if("development"===t.RunEnvironment);else{if(void 0===n||void 0===r)throw Error("invalid arguments");a=J.urlJoin(t.BasePath,"players",n,r,o)}return e.ajax({url:a,dataType:"json",method:"GET",cache:!1,async:i})}function b(e){if("string"!=typeof e||e.indexOf(":")<0)throw new Error("invalid component name");var t=e.split(":");if(2!==t.length)throw new Error("the component name only contain namespace and names");return{ns:t[0],key:t[1]}}function E(e,t){if(!ee.hasProp(et,e))throw Error("component context not exists!");if(!et[e].PackageLoaded)return et[e].config();var n=rt.shift();n?E(n):et[e].load()}function S(e,t){if(it[e]){var n=C(e),r=n.finishPromise;n.finishPromise=function(){r(),t.resolve()}}t.dependCount+=1,E(e).then(function(){t.dependCount-=1,t.finishPromise(),t.resolve()})}function A(e){if(ee.hasProp(ot,e))throw new Error("def has exists");var t={};return t.promise=new Promise(function(n,r){t.resolve=n,t.reject=r,t.finishPromise=function(){t.dependCount-=1,et[e].PackageLoaded=!0}}),t.namespace=e,t.dependCount=0,t}function C(e){var t=void 0;return e&&(t=ee.hasProp(ot,e)&&ot[e],t||(t=ot[e]=A(e))),t}function P(e,t,n){if(!ee.hasProp(et,e))throw new Error("the namespace "+e+" not loaded!");var r=et[e].getConfig(t);if(!r)throw Error("The component does not exist in the specified namespace");if("private"===r.visibility)throw Error("The component "+t+" is not available for private components");return et[e].get(t,n)}function k(e){var t=void 0,n=void 0,r=void 0;return e&&"function"==typeof e.beforeRun&&(t=e.beforeRun),e&&"function"==typeof e.beforeDestroy&&(n=e.beforeDestroy),e&&e.injectModel&&(r=e.injectModel),function(e){if(Object.defineProperty(e.prototype,"beforeDestroy",{configurable:!1,enumerable:!0,writable:!1,value:function(){if(O(this.metaInfo.name,this._CLASS_ID_),n){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(this,t)}}}),Object.defineProperty(e.prototype,"beforeRun",{configurable:!1,enumerable:!0,writable:!1,value:function(){if(L(this.metaInfo.name,this._CLASS_ID_,this),t){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(this,n)}}}),"function"==typeof e.prototype.run){var o=e.prototype.run;e.prototype.run=function(){if(this.QueryString&&this.QueryString.app){var t=this.QueryString.app;nt[t]&&nt[t][this.metaInfo.name]&&(r=r?$.extend(!0,r,nt[t][this.metaInfo.name]):nt[t][this.metaInfo.name])}for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.push(r),e.prototype.beforeRun.apply(this,i),o.apply(this,i)}}if("function"==typeof e.prototype.destroy){var i=e.prototype.destroy;e.prototype.destroy=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.prototype.beforeDestroy.apply(this,n),i.apply(this.args)}}}}function L(e,t,n){ee.hasProp(tt,e)||(tt[e]={}),ee.hasProp(tt[e],t)||(tt[e][t]=n)}function O(e,t){ee.hasProp(tt,e)&&ee.hasProp(tt[e],t)&&delete tt[e][t],ee.isEmptyObject(tt[e])&&delete tt[e]}function I(){p("injectModel",function(e,t,n){ee.hasProp(nt,e)||(nt[e]={}),n&&(nt[e][t]=n)}),p("componentDefine",lt),p("componentRequire",ut),p("componentConfig",st),p("ManagedComponent",k)}function R(){String.prototype.trim=function(e,t){return e?"left"===t?this.replace(new RegExp("^\\"+e+"+","g"),""):"right"===t?this.replace(new RegExp("\\"+e+"+$","g"),""):this.replace(new RegExp("^\\"+e+"+|\\"+e+"+$","g"),""):this.replace(/^\s+|\s+$/g,"")},"function"!=typeof String.prototype.insert&&(String.prototype.insert=function(e,t){return e>0?this.substring(0,e)+t+this.substring(e,this.length):t+this})}function T(){self.__extends||(self.__extends=function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),self.__decorate||(self.__decorate=function(e,t,n,r){var o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r,a=void 0;if("object"===("undefined"==typeof Reflect?"undefined":N(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i}),self.__assign||(self.__assign=function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}),self.__awaiter||(self.__awaiter=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t)).next())})}),self.__generator||(self.__generator=function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,a&&(s=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(s=o.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],a=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=void 0,a=void 0,s=void 0;return{next:n(0),throw:n(1),return:n(2)}})}function M(){"function"!=typeof Array.prototype.from&&(Array.prototype.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t},r=Math.pow(2,53)-1,o=function(e){var t=n(e);return Math.min(Math.max(t,0),r)};return function(e){var n=this,r=Object(e);if(null===e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i=arguments.length>1?arguments[1]:void 0,a=void 0;if("undefined"!=typeof i){if(!t(i))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(a=arguments[2])}for(var s=o(r.length),l=t(n)?Object(new n(s)):new Array(s),u=0,c=void 0;u<s;)c=r[u],i?l[u]="undefined"==typeof a?i(c,u):i.call(a,c,u):l[u]=c,u+=1;return l.length=s,l}}()),"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){var n=void 0,r=void 0;if(null===this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;r<i;){var a=void 0;r in o&&(a=o[r],e.call(n,a,r,o)),r++}}),"function"!=typeof Array.prototype.each&&(Array.prototype.each=function(e,t){var n=void 0,r=void 0;if(null===this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;r<i;){var a=void 0;r in o&&(a=o[r],e.call(n,a,r,o)),r++}}),"function"!=typeof Array.prototype.isArray&&(Array.prototype.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"function"!=typeof Array.prototype.includes&&(Array.prototype.includes=function(e,t){if(null===this)throw new TypeError('"this" is null or not defined');var n=Object(this),r=n.length>>>0;if(0===r)return!1;for(var o=0|t,i=Math.max(o>=0?o:r-Math.abs(o),0);i<r;){if(n[i]===e)return!0;i++}return!1}),"function"!=typeof Array.prototype.find&&(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,r=arguments[1],o=void 0,i=0;i<n;i++)if(o=t[i],e.call(r,o,i,t))return o}),"function"!=typeof Array.prototype.findIndex&&(Array.prototype.findIndex=function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,r=arguments[1],o=void 0,i=0;i<n;i++)if(o=t[i],e.call(r,o,i,t))return i;return-1}),"function"!=typeof Array.prototype.compact&&(Array.prototype.compact=function(){for(var e=-1,t=null===this?0:this.length,n=0,r=[];++e<t;){var o=this[e];o&&(r[n++]=o)}return r})}e="default"in e?e.default:e;var N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},x=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),D=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},B=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},U=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},F=/\$\{(.+?)\}/g,V="0123456789abcdefghijklmnopqrstuvwxyz",J={applyTemplate:function(e,t){return e.replace(F,function(e,n){return t[n]||e})},createReg:function(e){return e.length?new RegExp("^("+e.join("|")+")$"):/^$/},uuid:function(e){for(var t=[],n=0;n<e;n++)t[n]=V.substr(Math.floor(36*Math.random()),1);return t.join("")},urlJoin:function(){var e=arguments,t={};"object"===N(arguments[0])&&(e=arguments[0],t=arguments[1]||{}),e=Array.prototype.compact.call(e);var n=[].splice.call(e,0).join("/");return r(n,t)},randomWord:function(e,t,n){var r="",o=t,i=["0","1","2","3","4","5","6","7","8","9"];e&&(o=Math.round(Math.random()*(n-t))+t);for(var a=-1,s=0;s<o;s++)a=Math.round(Math.random()*(i.length-1)),r+=i[a];return r}},W="${root}/resources/scene/config.json",q=function(){function e(){j(this,e),this.scenceCollection={}}return x(e,[{key:"getConfig",value:function(e,t){var n=this,r=$.Deferred();return this.scenceCollection[e]?r.resolve({config:this.scenceCollection[e]}):this._loadSceneConfig(t.metaInfo.name,t).done(function(){r.resolve({config:n.scenceCollection[e]})}),r.promise()}},{key:"exists",value:function(e){return!!this.scenceCollection[e]}},{key:"_loadSceneConfig",value:function(e,t){var n=this,r=$.Deferred(),o=t._trimSlash(),i=J.applyTemplate(W,{root:o?o:"/"});return $.getJSON(i).done(function(e){$.each(e,function(e,t){void 0===n.scenceCollection[e]&&(n.scenceCollection[e]=t)}),r.resolve()}),r.promise()}}]),e}(),H=function(){var e=void 0,t="Scene Manager";return{name:t,getInstance:function(){return void 0===e&&(e=new q),e}}}(),z=document.head||document.getElementsByTagName("head")[0]||document.documentElement,Q={addStyle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t(void 0===e,"style url is undefined");var r=document.createElement("link");if(r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href",e),void 0!==n)for(var o in n)script.setAttribute(o,attr[o]);return z.appendChild(r),r},addJavascript:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t(void 0===e,"script url is undefined");var r=$.Deferred(),o=document.createElement("script");if(o.type="text/javascript",o.charset="utf-8",o.async=!0,o.src=e,void 0!==n)for(var i in n)o.setAttribute(i,attr[i]);return o.onerror=function(){console.error("javascript load failure!, URL="+e),r.reject()},o.onload=o.onreadystatechange=function(t,n){(n||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,o=null,n?(r.reject(),console.error("load javascript abort!, URL="+e)):r.resolve())},z.appendChild(o),r.promise()},addEmbedStyle:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=document.createElement("style");if(n.styleSheet?n.styleSheet.cssText=e:n.innerHTML=e,void 0!==t)for(var r in t)n.setAttribute(r,t[r]);return z.appendChild(n),n},addEmbedScript:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=document.createElement("script");if(n.setAttribute("language","Javascript"),n.text=e,void 0!==t)for(var r in t)n.setAttribute(r,t[r]);return z.appendChild(n),n},checkStyle:function(e){var t=!1;return"string"==typeof e?$.each(document.head.childNodes,function(n,r){if("LINK"===r.nodeName&&r.attributes.href.value===e)return t=!0,!1}):"function"==typeof e&&$.each(document.head.childNodes,function(n,r){if(("LINK"===r.nodeName||"STYLE"===r.nodeName)&&e.call(void 0,r))return t=!0,!1}),t},removeStyle:function(e){if("string"==typeof e){var t=e;document.head.childNodes.forEach(function(e){"LINK"===e.nodeName&&e.attributes.href.value===t&&z.removeChild(e)})}else"function"==typeof e&&document.head.childNodes.forEach(function(t){"LINK"===t.nodeName&&e.call(void 0,t)&&z.removeChild(t)})},removeStyleElement:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;t(void 0===e,"style element is undefined"),z.removeChild(e),e=null}},G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{filterLevel:K.OFF};j(this,e),this.context=t,this.setLevel(t.filterLevel),this.logHandler=[]}return x(e,[{key:"setLevel",value:function(e){e&&"value"in e&&(this.context.filterLevel=e)}},{key:"enabledFor",value:function(e){var t=this.context.filterLevel;return e.value>=t.value}},{key:"debug",value:function(){this.enabledFor(K.DEBUG)&&this.invoke(K.DEBUG,arguments)}},{key:"info",value:function(){this.enabledFor(K.INFO)&&this.invoke(K.INFO,arguments)}},{key:"warn",value:function(){this.enabledFor(K.WARN)&&this.invoke(K.WARN,arguments)}},{key:"error",value:function(){this.enabledFor(K.ERROR)&&this.invoke(K.ERROR,arguments)}},{key:"time",value:function(e){this.enabledFor(K.TIME)&&"string"==typeof e&&e.length>0&&this.invoke(K.TIME,[e,"start"])}},{key:"timeEnd",value:function(e){this.enabledFor(K.TIME)&&"string"==typeof e&&e.length>0&&this.invoke(K.TIME,[e,"end"])}},{key:"appendHandler",value:function(e,t){void 0===t&&(t={}),void 0===t.level&&(t.level=this.context.filterLevel),void 0===t.formatter&&(t.formatter=o),void 0!=e&&"function"==typeof e&&t.formatter&&"function"==typeof t.formatter&&($.extend(this.context,{filterLevel:t.level}),this.logHandler.push({handle:e,level:t.level,formatter:t.formatter}))}},{key:"invoke",value:function(e,t){var n=this;$.extend(this.context,{level:e}),$.each(this.logHandler,function(r,o){try{if(e.value>=o.level.value){var i=Array.prototype.slice.call(t);o.formatter(i,n.context),o.handle(i,n.context)}}catch(e){return console.log("LOGGER ERROR!",e),!0}})}}]),e}(),Y=function(){var e={};return{name:"Log Manager",version:"2.0.0",get:function(t){return"unknown"==t.toLowerCase()?new G(i({name:t,filterLevel:K.OFF})):e[t]?(e[t].logHandler=[],e[t]):(e[t]=new G(i({name:t,filterLevel:K.OFF})),e[t])}}},K={DEBUG:{value:1,name:"DEBUG"},INFO:{value:2,name:"INFO"},TIME:{value:3,name:"TIME"},WARN:{value:4,name:"WARN"},ERROR:{value:8,name:"ERROR"},OFF:{value:99,name:"OFF"}},X={PresenterType:{LAUNCHER:"presenterLauncher",CONTROLLER:"presenterController",LAYOUT:"presenterLayout",FUNCTIONAL:"presenterComponent"},PresenterBridge:{SMART_CLASS:"com.nd.pad.icr.ui.IcrJsBridge",HOMEWORK:"com.nd.android.homework.ui.HomeworkJsBridge"},PresenterEventType:{IC_PLAYER_EVENT:"ic_player_event",NATIVE_EVENT:"native_event",PPT_NATIVE_EVENT:"ppt_native_event"},PresenterEventScope:{Global:"global_bundle",Current:"current_bundle"},PresenterLogLevel:{DEBUG:K.DEBUG,INFO:K.INFO,TIME:K.TIME,WARN:K.WARN,ERROR:K.ERROR,OFF:K.OFF}},Z=arguments,ee={runSequence:function(e,t){var n=$.Deferred().resolve(),r=void 0;return e.forEach(function(e,t){$.isFunction(e.fn)&&(n=n.then(function(){try{r=t;var n=e.args||Z;return e.isAppendArgs===!0&&(n=Array.prototype.slice.call(Z,0),n=n.concat(fnConfig.args)),e.fn.apply(e.scope||window,n)}catch(e){return $.Deferred(function(t){t.reject(e)})}},function(e){return e}))}),n.fail(function(e){console.error("execute %s, number of %d error",t||"task",++r,e||"")})},execute:function(e,t,n,r){var o="",i={};if("string"==typeof t&&(o=t,t={},t[o]=n||[]),e)for(var a in t){var s=e[a];if($.isFunction(s)){var l=t[a],u=$.isArray(l)?"apply":"call";i[a]=Function.prototype[u].call(s,e,l)}else r===!0&&logger.error("不存在["+a+"]方法")}return o?i[o]:i},createDelegate:function(e,t,n,r,o){return function(){var i=t||Z;n===!0&&(i=Array.prototype.slice.call(Z,0),i=i.concat(t));try{return e.apply(r||window,i)}catch(e){if($.isFunction(o))return o(e);throw e}}},defer:function(e,t,n,r,o){var i=functionHelper.createDelegate(t,n,r,o);return e>0?window.setTimeout(i,e):(i(),0)},createPromiseThen:function(e,t,n,r,o){return $.isFunction(e.reject)||(o=r,r=n,n=t,t=e,e=$.Deferred()),ee.createDelegate(t,n,r,o,function(t){return e.reject(t),e.promise()})},isEmptyObject:function(e){for(var t in e)return!1;return!0},isOwnEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},hasProp:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},getOwn:function(e,t){return e&&Object.prototype.hasOwnProperty.call(e,t)&&e[t]},defineProperty:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{configurable:!1,enumerable:!1,writable:!1};Object.defineProperty(e,t,{configurable:r.configurable||!1,enumerable:r.enumerable||!1,writable:r.writable||!1,value:n})}},te={params:{},get:function(){return te.params}},ne=location.search;ne=ne.substr(1,ne.length);var re=ne.split("&");re.forEach(function(e){var t=e.split("="),n=t[0];n&&(te.params[n]=decodeURIComponent(t[1]))});var oe="zh_CN",ie=!1,ae=function(){function n(){j(this,n),this._languageConfig={},this._languageSet={}}return x(n,[{key:"loadConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"language.json",o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!ie){var i=J.urlJoin(Ie.BasePath,t,r);return e.ajax({url:i,dataType:"json",async:o}).done(function(e){if(Array.prototype.isArray(e)&&e.length>0){var t=e.filter(function(e){return"presenter"===e.type});t.each(function(e){n._languageConfig[e.name]||(n._languageConfig[e.name]={},n._languageSet[e.name]={},e.urls.each(function(t){n._languageConfig[e.name][t.code]=t.url}))})}ie=!0}).fail(function(){console.warn("language config file not loaded!")})}}},{key:"loadLanguage",value:function(e,n){var r=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];void 0===n&&(n=oe),t(ie===!1,"language config not load");var i=$.Deferred();if(this._languageSet[e])if(this._languageSet[e][n])i.resolve({lang:this._languageSet[e][n]});else{var a=J.urlJoin(Ie.BasePath,Ie.LanguageBasePath,this._languageConfig[e][n]);$.ajax({url:a,async:o,dataType:"json"}).done(function(t){r._languageSet[e][n]=t,i.resolve({lang:r._languageSet[e][n]})}).fail(function(){i.resolve({lang:void 0})})}else i.resolve({lang:void 0});return i.promise()}},{key:"replaceView",value:function(n,r){if(void 0!==r&&null!==r){t(ie===!1,"language config not load");var o=n instanceof e?viewz:$(n);$.each(r,function(e,t){var n=o.find(".lang_"+e);n.length>0&&n.text(t)})}}},{key:"CurrentLanguage",get:function(){return void 0===te.params._lang_?oe:te.params._lang_}}]),n}(),se=function(){var e=void 0,t="I18n Manager";return{name:t,getInstance:function(){return void 0===e&&(e=new ae),e}}}(),le=function(){function e(){if(j(this,e),void 0===this)throw new TypeError("Constructor WeakMap requires 'new'");if(this._id=u("_WeakMap"),this._polyfill=!0,arguments.length>0)throw new TypeError("WeakMap iterable is not supported")}return x(e,[{key:"delete",value:function(e){if(s(this,"delete"),!l(e))return!1;var t=e[this._id];return!(!t||t[0]!==e)&&(delete e[this._id],!0)}},{key:"get",value:function(e){if(s(this,"get"),l(e)){var t=e[this._id];return t&&t[0]===e?t[1]:void 0}}},{key:"has",value:function(e){if(s(this,"has"),!l(e))return!1;var t=e[this._id];return!(!t||t[0]!==e)}},{key:"set",value:function(e,t){if(s(this,"set"),!l(e))throw new TypeError("Invalid value used as weak map key");var n=e[this._id];return n&&n[0]===e?(n[1]=t,this):(a(e,this._id,[e,t]),this)}}]),e}();window.WeakMap||(window.WeakMap=le);var ue=new WeakMap,ce=function(){function e(){j(this,e),this._styleConfig={},this._loadedStyle={},this._courseobjectToSkin={},this._containVersion=!1}return x(e,[{key:"loadConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"style.config.json",n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!ee.isOwnEmptyObject(this._styleConfig))return void console.info("style config has been loaded! can't load repeatedly!!");ue.set(this,J.urlJoin(Ie.BasePath,Ie.AssetsBasePath));var i=J.urlJoin(Ie.BasePath,e,t);return $.ajax({url:i,dataType:"json",async:r}).done(function(e){for(var t in e){var r=e[t];r.styles&&Array.prototype.isArray(r.styles)&&r.styles.forEach(function(e){void 0===e.default&&(e.default={app:"pptshell",skin:"__default",language:"zh_CN"})})}n._styleConfig=e,n._containVersion=o}).fail(function(){console.warn("can't load style config file!")})}},{key:"releaseStyle",value:function(e){for(var t in this._loadedStyle)if(0===t.indexOf(e)){var n=this._loadedStyle[t];n.loaded&&(n.elements.forEach(function(e){Q.removeStyleElement(e)}),n.elements=[],n.loaded=!1)}}},{key:"loadStyle",value:function(e,n,r,o){var i=this;if(t(void 0===e,"the style library name is empty"),!ee.hasProp(this._styleConfig,e))return void console.warn("specified courseware object are not configured with style libraries");var a=e+"_"+n+"_"+r+"_"+o;if(!ee.hasProp(this._loadedStyle,a)){this._loadedStyle[a]={loaded:!1,styles:[],elements:[]};var s=this._styleConfig[e].styles;s.forEach(function(e){var t={app:n||e.default.app,skin:r||e.default.skin,language:o||e.default.language},s=e.configs.find(function(e){return e.app===t.app&&e.skin===t.skin&&e.language.indexOf(t.language)>=0});void 0!==s&&(i._containVersion&&(s.link=s.link.insert(s.link.indexOf(e.code)+e.code.length,"/"+e.version)),i._loadedStyle[a].styles.push(J.applyTemplate(s.link,{assets:ue.get(i)})))})}var l=this._loadedStyle[a];!l.loaded&&l.styles.length>0&&(l.styles.forEach(function(e){var t=Q.addStyle(e);l.elements.push(t)}),l.loaded=!0,this._courseobjectToSkin[e]=a)}},{key:"changeStyle",value:function(e,t,n,r){var o=e+"_"+t+"_"+n+"_"+r;return this._courseobjectToSkin[e]===o?void console.info("the specified style library configuration has been loaded"):(this._removeStyle(this._courseobjectToSkin[e]),void this.loadStyle(e,t,n,r))}},{key:"_removeStyle",value:function(e){var t=this._loadedStyle[e];t.loaded&&(t.elements.forEach(function(e){Q.removeStyleElement(e)}),t.elements=[],t.loaded=!1)}}]),e}(),fe=function(){var e=void 0,t="Style Manager";return{name:t,getInstance:function(){return void 0===e&&(e=new ce),e}}}(),de=!1,he=function(){function t(){j(this,t),this._coursewareConfigSet={}}return x(t,[{key:"loadConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"coursesubject.json",o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!de){var i=J.urlJoin(Ie.BasePath,t,r);return e.ajax({url:i,dataType:"json",async:o}).done(function(e){n._coursewareConfigSet=e,de=!0}).fail(function(){console.warn("courseware object config load error!!")})}}},{key:"getConfig",value:function(e){return this._coursewareConfigSet[e]||null}}]),t}(),pe=function(){var e=void 0,t="CoursewareConfig Manager";return{name:t,getInstance:function(){return void 0===e&&(e=new he),e}}}(),ve={},ye=function(e,t){var n="_";"string"==typeof t&&(n=t);var r=d(ve,n);if(!r)throw new Error("context not exists");return r.load(e),ve[n].getDef(e)},ge=function(e,t){var n="_";"string"==typeof t&&(n=t);var r=d(ve,n);if(!r)throw new Error("context not exists");r.unload(e)},me=function(e,t,n,r){var o="_";"string"!=typeof n||t||(o=n),"function"!=typeof t&&"function"==typeof n&&(t=n);var i=d(ve,o);i&&i.pushQueue(e,t,r)},_e={ExtendModule:"ExtendModule",StyleResource:"StyleResource",MaterialResource:"MaterialResource"},we={config:function(e){if(e.context){var t=d(ve,e.context);return t?t.config(e):ve[e.context]=new be(e.context,e),e.context}throw new Error("")},isBrowser:function(){return"undefined"!=typeof document&&"undefined"!=typeof navigator}},be=function(){function e(t,n){j(this,e),this._name=t,this._defaultConfig={waitSeconds:7,baseUrl:"./"},n&&(this._config=$.extend(!0,this._defaultConfig,n)),this._extendConfig={},this._deferreds={},this._requires={},this._queue=[],this._cache={}}return x(e,[{key:"config",value:function(e){e&&e.context===this._name&&(this._name=e.context,$.extend(!0,this._config,e))}},{key:"load",value:function(e){var t=this;this._makeDef(e);var n=null;this._getModuleConfig(e).done(function(r){switch(r.config?n=r.config:(n=r,t._extendConfig[e]=n),n.type){case _e.ExtendModule:if(n.style){var o=J.urlJoin(t._config.baseUrl,e,n.style);Q.checkStyle(o)||Q.addStyle(o)}if(n.main)if(f(t._cache,e)){var i=d(t._cache,e);t._deferreds[e].resolve(i.clazz)}else{var a=J.urlJoin(t._config.baseUrl,e,n.main);t._loadScript({id:e,url:a})}delete t._requires[e];break;case _e.StyleResource:n.files&&Array.isArray(n.files)?(n.files.forEach(function(n){var r=J.urlJoin(t._config.baseUrl,e,n);Q.checkStyle(r)||Q.addStyle(r)}),t._deferreds[e].resolve()):t._deferreds[e].reject();break;case _e.MaterialResource:if(n.files&&Array.isArray(n.files)){var s=[];n.files.forEach(function(n){s.push(J.urlJoin(t._config.baseUrl,e,n))}),t._deferreds[e].resolve(s)}else t._deferreds[e].reject()}})}},{key:"unload",value:function(e){var t=this,n=d(this._extendConfig,e);if(!n)throw new Error("can not found key in current context");switch(n.type){case _e.ExtendModule:if(n.style){var r=J.urlJoin(this._config.baseUrl,e,n.style);Q.removeStyle(r)}break;case _e.StyleResource:n.files&&Array.isArray(extendConfig.files)&&n.files.forEach(function(n){var r=J.urlJoin(t._config.baseUrl,e,n);Q.removeStyle(r)})}}},{key:"getDef",value:function(e){var t=f(this._deferreds,e);if(t)return this._deferreds[e].promise}},{key:"pushQueue",value:function(e,t,n){_.findIndex(this._queue,["key",e])>0||this._queue.push({key:e,main:t,scope:n})}},{key:"_makeDef",value:function(e){var t={};t.promise=new Promise(function(e,n){t.resolve=e,t.reject=function(e){n(e)}}),f(this._deferreds,e)&&delete this._deferreds[e],this._deferreds[e]=t}},{key:"_loadScript",value:function(e){var t=document.createElement("script");t.setAttribute("data-extend-module",e.id),t.type="text/javascript",t.charset="utf-8",t.async=!0,t.src=e.url,t.addEventListener("load",this._onScriptLoaded.bind(this),!1),t.addEventListener("error",this._onScriptError.bind(this),!1),document.head.appendChild(t)}},{key:"_getModuleConfig",value:function(e){if(this._extendConfig[e])return $.Deferred().resolve({config:this._extendConfig[e]});var t=J.urlJoin(this._config.baseUrl,e,"package.json");return $.getJSON(t)}},{key:"_onScriptError",value:function(){}},{key:"_onScriptLoaded",value:function(e){var t=e.target.dataset.extendModule,n=void 0;if(f(this._deferreds,t)){var r=this._extendConfig[t].options||{},o=_.find(this._queue,["key",t]);o?(n=o.main.apply(o.scope||window,[r]),f(this._cache,t)||(this._cache[t]={clazz:n,config:{}}),this._deferreds[t].resolve(n)):this._deferreds[t].resolve(null)}}}],[{key:"IsBrowser",get:function(){return"undefined"!=typeof document&&"undefined"!=typeof navigator}}]),e}(),Ee=arguments,Se=window,Ae=/^.*?(?=[^\/]*(\?|$))/,Ce=/^(\w+:\/\/|\/)/,Pe=/^((http|https):\/\/|\/)/,ke={getBase:function(e){return e?Ae.exec(e)[0]:""},isAbsolute:function(e){return Ce.test(e)},isHttpAddress:function(e){return Pe.test(e)},resolve:function(e,t){return 1===Ee.length&&(t=e,e=ke.getBaseLocationUrl()),ke.isAbsolute(t)?t:e+"/"+t;
},getBaseLocationUrl:function(){var e=ke.getBase(location.href);return ke.getBaseLocationUrl=function(){return e},Se.getBaseLocationUrl()}},Le=!1,Oe={},Ie={BasePath:"",ConfigurationPath:"configuration",LanguageBasePath:"languages",StyleBasePath:"style",AssetsBasePath:"assets",ComponentBasePath:"js-library",ExtendBasePath:"extends",RunEnvironment:"product"};Object.defineProperty(Oe,"version",{value:"1.2.5"}),Object.defineProperty(Oe,"globalConfig",{enumerable:!1,writable:!1,configurable:!1,value:function(e){"string"==typeof e.BasePath&&(Ie.BasePath=e.BasePath),"string"==typeof e.LanguageBasePath&&(Ie.LanguageBasePath=e.LanguageBasePath),"string"==typeof e.AssetsBasePath&&(Ie.AssetsBasePath=e.AssetsBasePath),"string"==typeof e.ComponentBasePath&&(Ie.ComponentBasePath=e.ComponentBasePath),"string"==typeof e.NativeBridgeClass&&Object.defineProperty(Ie,"NativeBridgeClass",{value:e.NativeBridgeClass}),Object.defineProperty(Ie,"Online",{value:ke.isHttpAddress(Ie.BasePath)}),void 0!==e.RunEnvironment&&"string"==typeof e.RunEnvironment&&("product"!==e.RunEnvironment&&"development"!==e.RunEnvironment||(Ie.RunEnvironment=e.RunEnvironment))}}),Object.defineProperty(Oe,"startup",{enumerable:!1,writable:!1,configurable:!1,value:function(t){if(Le!==!0){if(Le=!0,"object"!==("undefined"==typeof t?"undefined":N(t)))return void console.warn("startup option error");var n=e.extend({configPath:J.urlJoin(Ie.BasePath,Ie.LanguageBasePath),configFile:"language.json",load:!0},t.i18n),r=e.extend({configPath:J.urlJoin(Ie.BasePath,Ie.ConfigurationPath),configFile:"coursesubject.json"},t.courseware),o=e.extend({context:"_",load:!0},t.extend),i=e.extend({configPath:J.urlJoin(Ie.BasePath,Ie.AssetsBasePath,Ie.StyleBasePath),configFile:"style.config.json",containVersion:!1,load:!0},t.style),a=void 0===t.async||t.async;if(n.load){console.info("===Execute multi-language manager to initialization===");var s=n.configPath||Ie.LanguageBasePath,l=n.configFile||"language.json",u=se.getInstance();p("i18nManager",u),u.loadConfig(s,l,a)}if(o.load){console.info("===Execute the expansion module manager to initialize===");var c=o.context||"_",f=J.urlJoin(Ie.BasePath,Ie.AssetsBasePath,Ie.ExtendBasePath);h(),Oe.extendModule.config({context:c,baseUrl:f})}if(i.load){console.info("===Execute the style library module manager to initialize===");var d=i.configPath||J.urlJoin(Ie.BasePath,Ie.AssetsBasePath,Ie.StyleBasePath),v=i.configFile||"style.config.json",y=i.containVersion||!1,g=fe.getInstance();p("styleManager",g),g.loadConfig(d,v,a,y)}console.info("===Load courseware object config===");var m=r.configPath||Ie.ConfigurationPath,_=r.configFile||"coursesubject.json";pe.getInstance().loadConfig(m,_,a)}}});var Re,Te,Me,Ne,je,xe,De,Be,$e,Ue,Fe,Ve,Je,We,qe=function(){function t(){j(this,t)}return x(t,null,[{key:"ConstructorAdapter",value:function(){return void 0===window.icCreatePlayer?function(e){}:function(e){ee.defineProperty(e.prototype,"onEventReceived",function(e,t){var n=this;this.webEvents&&$.each(this.webEvents,function(r,o){if(o.name===e)return $.each(o.callbacks,function(r,o){o.call(n,t,e)}),!1})}),ee.defineProperty(e.prototype,"webEvents",[],{writable:!0}),ee.defineProperty(e.prototype,"nativeListener",{},{writable:!0}),ee.defineProperty(e.prototype,"nativeBridge",window.Bridge?window.Bridge:He)}}},{key:"MethodAdapter",value:function(){return void 0===window.icCreatePlayer?function(e,t,n){return n}:function(t,n,r){var o=r.value;switch(n){case"requireComponent":r.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=v(t);return o.call(this,r)};break;case"addEventListener":r.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=arguments[0],o=arguments[1],i=arguments[2];if(null===i||"function"!=typeof i)throw Error("callback is null or not a function");if(o===X.PresenterEventType.IC_PLAYER_EVENT){for(var a=!1,s=0;s<this.webEvents.length;s++)if(this.webEvents[s].name===r){this.webEvents[s].callbacks.push(i),a=!0;break}a||(this.webEvents.push({name:r,callbacks:[i]}),this._playerController.getEventBus().addEventListener(r,this))}else if(o===X.PresenterEventType.NATIVE_EVENT){var l=this.nativeBridge.registerListener(r,i,this);this.nativeListener[l]=l}};break;case"removeEventListener":r.value=function(){var t=this;if(this.nativeListener&&(e.each(this.nativeListener,function(e,n){t.nativeBridge.unRegisterListener(e,n)}),this.nativeListener=null),this.webEvents){for(;this.webEvents.length>0;)this.webEvents.pop();this.webEvents=null}};break;case"dispatchEvent":r.value=function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=(arguments.length<=2?void 0:arguments[2])||{};if(t===X.PresenterEventType.IC_PLAYER_EVENT)return this.PlayerController.getEventBus().sendEvent(e,n),!0;if(t===X.PresenterEventType.NATIVE_EVENT||t===X.PresenterEventType.PPT_NATIVE_EVENT){var r="";if(r=void 0!==Ie.NativeBridgeClass?Ie.NativeBridgeClass:this.embedApplication("exercise")?X.PresenterBridge.HOMEWORK:X.PresenterBridge.SMART_CLASS,t===X.PresenterEventType.NATIVE_EVENT)return this.nativeBridge.callNative(r,e,n);if(t===X.PresenterEventType.PPT_NATIVE_EVENT)return this.nativeBridge.callNative(r,"sendEvent",{eventName:e,eventData:n})}};break;case"_init":r.value=function(){if(window.player){var e=window.player.getPlayerServices().getRuntime();this._environment.isApp=e==window.icCreatePlayer.RUNTIME.STUDENT_MOBILE||e==window.icCreatePlayer.RUNTIME.TEACHER_MOBILE,this._environment.isWeb=e==window.icCreatePlayer.RUNTIME.WEB,this._environment.isPC=e==window.icCreatePlayer.RUNTIME.TEACHER_PC,this._environment.isTeacher=e==window.icCreatePlayer.RUNTIME.TEACHER_MOBILE,this._environment.isStudent=e==window.icCreatePlayer.RUNTIME.STUDENT_MOBILE}o.call(this)}}return r.writable=r.enumerable=r.configurable=!1,r}}}]),t}(),He={registerListener:function(){console.warn("window bridge is null, this message from default bridge")},unRegisterListener:function(){console.warn("window bridge is null, this message from default bridge")},callNative:function(){console.warn("window bridge is null, this message from default bridge")}},ze=function(){function e(){j(this,e)}return x(e,null,[{key:"ConstructorAdapter",value:function(){return void 0===window.Midway?function(e){}:function(e){}}},{key:"MethodAdapter",value:function(){return void 0===window.Midway?function(e,t,n){return n}:function(e,t,n){var r=n.value;return"requireComponent"===t?n.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=y.call(this,t);return r.call(this,o)}:"addEventListener"===t?n.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=arguments[0],o=arguments[1],i=arguments[2],a=o;if(o===ConstVariable.PresenterEventType.IC_PLAYER_EVENT&&(a="web_event"),null===i||"function"!=typeof i)throw Error("callback is null or not a function");this.PlayerController.getEventBus().addEventListener(r,a,i,this)}:"removeEventListener"===t||("dispatchEvent"===t?n.value=function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=(arguments.length<=2?void 0:arguments[2])||{},r=t,o=void 0;t===ConstVariable.PresenterEventType.IC_PLAYER_EVENT&&(r="web_event"),"web_event"===r&&(o=(arguments.length<=3?void 0:arguments[3])||"current_bundle"),this.PlayerController.getEventBus().dispatchEvent(e,r,n,o)}:"_init"===t&&(n.value=function(){this._environment.isApp="mobile"===window.Midway.Settings.Runtime,this._environment.isWeb="web"===window.Midway.Settings.Runtime,this._environment.isPC="pc"===window.Midway.Settings.Runtime,this._environment.isTeacher="teacher"===window.Midway.Terminal,this._environment.isStudent="student"===window.Midway.Terminal,r.call(this)})),n.writable=n.enumerable=n.configurable=!1,n}}}]),e}(),Qe=(Re=qe.ConstructorAdapter(),Te=ze.ConstructorAdapter(),Me=qe.MethodAdapter(),Ne=ze.MethodAdapter(),je=qe.MethodAdapter(),xe=ze.MethodAdapter(),De=qe.MethodAdapter(),Be=ze.MethodAdapter(),$e=qe.MethodAdapter(),Ue=ze.MethodAdapter(),Fe=qe.MethodAdapter(),Ve=ze.MethodAdapter(),Re(Je=Te((We=function(){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;j(this,n),this._basePath="/",this._queryString={},this._playerController=null,this._logger=null,this._interface={},this._clazz=t,this._environment={isApp:!1,isWeb:!0,isPC:!1,isTeacher:!1,isStudent:!1},this._view=null,this._model=null,this._injectModel=null,this._customConfigModel=null,this._currentLanguage="zh_CN",this._app=void 0,this.metaInfo={name:"",type:X.PresenterType.FUNCTIONAL},this._CLASS_ID_=J.randomWord(!1,16),r&&e.extend(!0,this._interface,r),this._init()}return x(n,[{key:"setPlayerController",value:function(e){t(void 0===e,"player controller is null"),t(void 0===e.require,"player controller not contain require method"),t(void 0===e.getEventBus,"player controller not contain getEventBus method"),this._playerController=e}},{key:"setBasePath",value:function(e){this._basePath=void 0!==e?e:"/"}},{key:"setUrlParams",value:function(e){this._queryString=e,this._currentLanguage=e._lang_||"zh_CN",this._queryString.app?this._app=this._queryString.app:this._queryString.sys&&(this._app=this._queryString.sys)}},{key:"run",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._view=t[0][0]||void 0,this._model=t[0][1]||void 0,this._injectModel=t[0][2]||void 0,this._customConfigModel=pe.getInstance().getConfig(this.metaInfo.coursewareObject||this.metaInfo.name),this._initModuleService()}},{key:"destroy",value:function(){this.removeEventListener(),this.$release()}},{key:"getSkin",value:function(){return"wood"}},{key:"embedApplication",value:function(e){if(this.QueryString){var t=void 0!==this.QueryString.sys?this.QueryString.sys:void 0!==this.QueryString.app?this.QueryString.app:"unknown";return t===e}return!1}},{key:"addEventListener",value:function(){return-1}},{key:"removeEventListener",value:function(){return-1}},{key:"dispatchEvent",value:function(e,t,n){return-1}},{key:"requireComponent",value:function(){var t=arguments[0],n=e.Deferred();return this.PlayerController.require(t).done(function(t){if(t._handleOver_){var r=[];for(var o in t._handleOver_)r.push(t._handleOver_[o]);e.when.apply($,r).done(function(){n.resolve(t)})}else n.resolve(t)}),n}},{key:"createDelegate",value:function(t,n,r,o,i){return function(){var a=n||arguments;r===!0&&(a=Array.prototype.slice.call(arguments,0),a=a.concat(n));try{return t.apply(o||window,a)}catch(t){if(e.isFunction(i))return i(t);throw t}}}},{key:"runSequence",value:function(e,t){return ee.runSequence(e,t)}},{key:"$launch",value:function(e){}},{key:"$release",value:function(){}},{key:"_init",value:function(){this.metaInfo?this.metaInfo=e.extend(this.metaInfo,{_CLASS_ID_:this._CLASS_ID_}):this.metaInfo={_CLASS_ID_:this._CLASS_ID_},this._logger=Y().get(this._clazz?this._clazz:this.metaInfo.name),this.Logger.appendHandler(m,{level:K.DEBUG})}},{key:"_trimSlash",value:function(){var e=this.BasePath;return e&&e.length>1&&"/"===e[e.length-1]&&(e=e.substr(0,e.length-1)),e}},{key:"_initModuleService",value:function(){if(void 0!==this.__ModuleServices){var t=this;e.each(this.__ModuleServices,function(e,n){if(!t[e]){if(n.hasFilter){var r=n.filter.call(t);t[e]=void 0!=r?new window.__ServiceComponent[n.namespace][r]:void 0}else t[e]=new n.clazz;t[e].setContext&&t[e].setContext.call(t[e],t)}})}}},{key:"MetaInfo",get:function(){return this.metaInfo}},{key:"Logger",get:function(){return this._logger}},{key:"BasePath",get:function(){return this._basePath}},{key:"PlayerController",get:function(){return this._playerController}},{key:"QueryString",get:function(){return this._queryString}},{key:"Environment",get:function(){return this._environment}},{key:"View",get:function(){return this._view}},{key:"Model",get:function(){return this._model}},{key:"InjectModel",get:function(){return this._injectModel}},{key:"CustomConfig",get:function(){return this._customConfigModel}},{key:"Language",get:function(){return this._currentLanguage}}]),n}(),g(We.prototype,"addEventListener",[Me,Ne],Object.getOwnPropertyDescriptor(We.prototype,"addEventListener"),We.prototype),g(We.prototype,"removeEventListener",[je,xe],Object.getOwnPropertyDescriptor(We.prototype,"removeEventListener"),We.prototype),g(We.prototype,"dispatchEvent",[De,Be],Object.getOwnPropertyDescriptor(We.prototype,"dispatchEvent"),We.prototype),g(We.prototype,"requireComponent",[$e,Ue],Object.getOwnPropertyDescriptor(We.prototype,"requireComponent"),We.prototype),g(We.prototype,"_init",[Fe,Ve],Object.getOwnPropertyDescriptor(We.prototype,"_init"),We.prototype),Je=We))||Je)||Je),Ge=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return j(this,n),U(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t))}return B(n,e),x(n,[{key:"run",value:function(){for(var e=this,t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];if(D(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"run",this).call(this,r),this.metaInfo.type===X.PresenterType.LAUNCHER){var i=D(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getSkin",this).call(this);if(window.Midware.styleManager){var a=this.metaInfo.styleLib||this.metaInfo.name;Midware.styleManager.loadStyle(a,this._app,i,this.Language)}}var s=$.Deferred().resolve(),l={};return s.then(function(){var t=$.Deferred();return window.Midware.i18nManager?Midware.i18nManager.loadLanguage(e.metaInfo.name,e.Language).done(function(n){se.getInstance().replaceView(e.View,n.lang),l=n.lang,t.resolve()}):t.resolve(),t.promise()}).then(function(){return H.getInstance().getConfig(e.metaInfo.name,e)}).then(function(t){return e._launcherScene(t.config)}).then(function(t){return e.Logger.debug({scene:t.currentScene,lang:l}),e.$launch({scene:t.currentScene,lang:l})}).done(function(){e.Logger.info("module method launch has been run!")})}},{key:"destroy",value:function(){this.metaInfo.type===X.PresenterType.LAUNCHER&&window.Midware.styleManager&&Midware.styleManager.releaseStyle(this.metaInfo.name),D(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this)}},{key:"_launcherScene",value:function(e){var n=this;t(void 0===this.metaInfo.name,"property name is null in meta info!");var r=$.Deferred();if(e.scene&&Array.prototype.isArray(e.scene)){var o=e.scene.find(function(e){return e.name===n.CurrentApp});if(!o&&e.default&&(o=e.scene.find(function(t){return t.name===e.default})),o&&o.style){var i=this._trimSlash()+o.style;Q.checkStyle(i)||Q.addStyle(i)}r.resolve({currentScene:o})}else console.error("scene config error!!"),r.resolve({currentScene:void 0});return r.promise()}},{key:"CurrentApp",get:function(){return this._app}}]),n}(Qe),Ye=function(e){function t(e,n){return j(this,t),U(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return B(t,e),x(t,[{key:"run",value:function(){for(var e=this,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];if(D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this,r),this.metaInfo.type===X.PresenterType.LAUNCHER){var i=this.getSkin();if(window.Midware.styleManager){var a=this.metaInfo.styleLib||this.metaInfo.name;Midware.styleManager.loadStyle(a,this._app,i,this.Language)}}var s=$.Deferred().resolve(),l={};return s.then(function(){var t=$.Deferred();return window.Midware.i18nManager?Midware.i18nManager.loadLanguage(e.metaInfo.name,e.Language).done(function(n){se.getInstance().replaceView(e.View,n.lang),l=n.lang,t.resolve()}):t.resolve(),t.promise()}).then(function(){return e.$launch({lang:l})}).done(function(){e.Logger.info("launch presenter complete!")})}},{key:"destroy",value:function(){this.metaInfo.type===X.PresenterType.LAUNCHER&&window.Midware.styleManager&&Midware.styleManager.releaseStyle(this.metaInfo.name),D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"setModuleSkin",value:function(e){this.metaInfo.type===X.PresenterType.LAUNCHER&&window.Midware.styleManager&&Midware.styleManager.changeStyle(this.metaInfo.name,this._app,e,this.Language)}},{key:"ComponentLoader",get:function(){if(this.metaInfo.type!==X.PresenterType.LAUNCHER||!this.loader)throw new Error("current module is not Launcher!!");return this.loader}}]),t}(Qe),Ke=function(){var e=function(){};return e.prototype.isUnderControl=function(e,t){return console.log("default control service"),!1},e.prototype.beforePresenterRun=function(e,t,n){console.log("default control service")},e.prototype.afterPresenterRun=function(e,t,n){console.log("default control service")},e.prototype.afterSetLayoutService=function(e){console.log("default control service")},e.prototype.getInterfaceMethods=function(){return console.log("default control service"),[]},new e},Xe="__Custom",Ze=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;j(this,t);var r=U(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.metaInfo.type=X.PresenterType.CONTROLLER,r._controlService=Ke(),r._interface.processBeforeRun=r.processBeforeRun.bind(r),r._interface.processAfterRun=r.processAfterRun.bind(r),r._serviceList={},r._loadDeffers={},r._layoutService=null,r._interceptPresenter=[],r._interceptOnce=!0,r}return B(t,e),x(t,[{key:"processBeforeRun",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{getService:null,metaInfo:null};if(t.getService&&t.metaInfo&&"function"==typeof t.getService){var n=t.metaInfo,r=t.getService();if(void 0!==r&&r.then){var o=n.name+"@"+n._CLASS_ID_;void 0===this._loadDeffers[o]&&(this._loadDeffers[o]=$.Deferred()),r.then(function(){e._processService(n,t._service_),e._loadDeffers[o]&&"pending"===e._loadDeffers[o].state()&&e._loadDeffers[o].resolve()})}else this._processService(n,r);if(n.type===X.PresenterType.FUNCTIONAL){var i=n.name+"@"+n._CLASS_ID_,a=this.metaInfo.name+"-"+i;t._handleOver_=t._handleOver_||{},t._handleOver_[a]=t._handleOver_[a]||$.Deferred()}}}},{key:"processAfterRun",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{getService:null,metaInfo:null,_handleOver_:null};if(t.getService&&t.metaInfo&&"function"==typeof t.getService){var n=t.metaInfo,r=n.name+"@"+n._CLASS_ID_;this._loadDeffers[r]?this._loadDeffers[r].then(function(){e._processServiceAfter(n,r),n.type===X.PresenterType.FUNCTIONAL&&t._handleOver_&&t._handleOver_[e.metaInfo.name+"-"+r].resolve()}):(this._processServiceAfter(n,r),n.type===X.PresenterType.FUNCTIONAL&&t._handleOver_&&t._handleOver_[this.metaInfo.name+"-"+r].resolve())}}},{key:"_discoverInterface",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interface:"",methods:[]},n=arguments[2],r=arguments[3],o=!0;if(0===t.methods.length?o=!1:$.each(t.methods,function(e,t){if(void 0===r[t])return o=!1,!1}),o){var i=!1;$.each(this._serviceList[e],function(e,t){if(t.metaInfo.name===n.name&&t.metaInfo._CLASS_ID_===n._CLASS_ID_)return i=!0,!1}),i||(this._serviceList[e].push({metaInfo:n,service:r}),this.ControlService.beforePresenterRun(t.name,n,r))}}},{key:"_processService",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:null,type:null},n=arguments[1];t.type===X.PresenterType.LAYOUT&&null===this._layoutService&&(this._layoutService=n,this._controlService.afterSetLayoutService(n));var r=this._controlService.getInterfaceMethods();if(Array.isArray(r)&&r.length>0&&$.each(r,function(r,o){var i=o.name+"@"+t._CLASS_ID_;e._serviceList[i]||(e._serviceList[i]=[]),e._discoverInterface(i,o,t,n)}),this._controlService.isUnderControl(t,n)){this._serviceList[Xe]=this._serviceList.__Custom||[];var o=!1;$.each(this._serviceList[Xe],function(e,n){if(n.metaInfo.name===t.name)return o=!0,!1}),o||(this._serviceList[Xe].push({metaInfo:t,service:n}),this._controlService.beforePresenterRun(Xe,t,n))}}},{key:"_processServiceAfter",value:function(e,t){if($.inArray(t,this._interceptPresenter)>=0){if(this.InterceptOnce)return}else this._interceptPresenter.push(t);var n=this;$.each(this._serviceList,function(t,r){var o=t.split("@"),i=o[0];o[1];$.each(r,function(t,r){r.metaInfo.name+"@"+r.metaInfo._CLASS_ID_==e.name+"@"+e._CLASS_ID_&&n._controlService.afterPresenterRun(i,r.metaInfo,r.service)})})}},{key:"InterceptOnce",get:function(){return this._interceptOnce},set:function(e){"boolean"==typeof e&&(this._interceptOnce=e)}},{key:"ControlService",get:function(){return this._controlService},set:function(e){$.extend(this._controlService,e)}},{key:"__interface",get:function(){return this._interface}},{key:"LayoutService",get:function(){return this._layoutService}}]),t}(Ye),et={},tt={},nt={},rt=[],ot={},it={},at={},st=function(e,t){var n=$.Deferred();return"string"==typeof e&&"string"==typeof t&&w(Ie,e,t,"config.json").done(function(e){ee.hasProp(e,"script")&&e.script.forEach(function(e){if("string"==typeof e.name&&"string"==typeof e.version&&0===e.name.indexOf("component-")){var t=e.name.substring(10);ee.hasProp(at,t)||(at[t]=e.version)}}),n.resolve()}).fail(function(){console.error("Unable to read the online player's configuration file"),n.reject()}),"object"===("undefined"==typeof e?"undefined":N(e))&&"undefined"==typeof t&&($.extend(!0,at,e),n.resolve()),n},lt=function(e,t,n){var r=b(e),o=[];"function"==typeof t&&void 0===n&&(n=t);var i={depends:[],visibility:"public"};"object"===("undefined"==typeof t?"undefined":N(t))&&"function"==typeof n&&(Array.prototype.isArray(t)?i.depends=t:(i.visibility=ee.hasProp(t,"visibility")?ee.getOwn(t,"visibility"):"public",i.depends=ee.hasProp(t,"depends")?ee.getOwn(t,"depends"):[])),ee.hasProp(et,r.ns)||(rt.push({ns:r.ns,loaded:!1}),et[r.ns]=new ct(r.ns)),i.depends.forEach(function(e){var t=b(e);rt.findIndex(function(e){return e.ns===t.ns})===-1&&rt.push({ns:t.ns,loaded:!1}),ee.hasProp(et,t.ns)||(et[t.ns]=new ct(t.ns)),o.push(t)}),et[r.ns].push(r.key,o,n,i)},ut=function(e){var t=[],n=[],r="component";if("string"==typeof e){var o=b(e);n.push(o.ns),t.push(o)}else"object"===("undefined"==typeof e?"undefined":N(e))&&Array.prototype.isArray(e)&&(r="load",e.forEach(function(e){var r=b(e);n.findIndex(function(e){return e===r.ns})===-1&&n.push(r.ns),t.findIndex(function(e){return e.ns===r.ns&&e.key===r.key})===-1&&t.push(r)}));var i=[];return n.forEach(function(e){ee.hasProp(et,e)||ee.hasProp(it,e)||(rt.push({ns:e,loaded:!1}),et[e]=new ct(e),et[e].config()),i.push(C(e).promise)}),"component"===r?function(){return Promise.all(i).then(function(){return delete it[t[0].ns],et[t[0].ns].load(t[0].key)})}:Promise.all(i).then(function(){var e={};return t.forEach(function(t){delete it[t.ns],e[t.ns+":"+t.key]=et[t.ns].load(t.key)}),e})},ct=function(){function e(t){j(this,e),this._components={},this._classes={},this._ns=t,this._hasBeenLoaded=!1}return x(e,[{key:"push",value:function(e,t,n,r){ee.hasProp(this._components,e)||(this._components[e]={depends:t,main:n,visibility:r.visibility})}},{key:"config",value:function(){if(this._hasBeenLoaded)return void console.warn("this component namespace has been loaded!");var e=this._ns.toLowerCase()+".dist.js?"+(new Date).getTime(),t=ee.getOwn(at,this._ns)||("development"===Ie.RunEnvironment?"dist":""),n=void 0;n=""===Ie.BasePath?J.urlJoin(Ie.ComponentBasePath,"component-"+this._ns,t,e):J.urlJoin(Ie.BasePath,Ie.ComponentBasePath,"component-"+this._ns,t,e);var r=C(this._ns);return this._loadScript({id:this._ns,url:n}),r.promise}},{key:"load",value:function(e){var t=this;if(!ee.hasProp(this._components,e))throw new Error("the namespace "+this._ns+" not contain component names "+e);var n=this._components[e],r=[];if("private"===n.visibility)throw Error("The component "+e+" is not available for private components");return n.depends&&Array.prototype.isArray(n.depends)&&n.depends.forEach(function(e){e.ns===t._ns?t.get(e.key,r):P(e.ns,e.key,r)}),n.main.apply(window,r)}},{key:"get",value:function(e,t){var n=this;if(ee.hasProp(this._classes,e))t.push(this._classes[e]);else{var r=this._components[e],o=[];r.depends&&r.depends.length>0&&r.depends.forEach(function(e){e.ns===n._ns?n.get(e.key,o):P(e.ns,e.key,o)});var i=r.main.apply(window,o);this._classes[e]=i,t.push(i)}}},{key:"getConfig",value:function(e){return ee.getOwn(this._components,e)}},{key:"_loadScript",value:function(e){if(!it[e.id]){it[e.id]=!0;var t=document.createElement("script");t.setAttribute("data-extend-module",e.id),t.type="text/javascript",t.charset="utf-8",t.async=!0,t.src=e.url,t.addEventListener("load",this._onScriptLoaded.bind(this),!1),t.addEventListener("error",this._onScriptError.bind(this),!1),document.head.appendChild(t)}}},{key:"_onScriptLoaded",value:function(){var e=this,t=rt.find(function(t){return t.ns===e._ns});t.loaded=!0;var n=rt.find(function(e){return e.loaded===!1});n?S(n.ns,C(this._ns)):C(this._ns).resolve()}},{key:"_onScriptError",value:function(){C(this._ns).reject()}},{key:"PackageLoaded",get:function(){return this._hasBeenLoaded},set:function(e){this._hasBeenLoaded=e}}]),e}(),ft={UNANSWERED:"UNANSWERED",PARTICAL_ANSWERED:"PARTICAL_ANSWERED",ALL_ANSWERED:"ALL_ANSWERED"},dt={SINGLE:"single",MULTIPLE:"multiple",ORDERED:"ordered"},ht={STRING:"string",MULTIPLE_STRING:"multipleString",BOOLEAN:"boolean",FLOAT:"float",INTEGER:"integer",ARRAY:"array",PAIR:"pair",JSON:"json"},pt={INCOMPLETE:"INCOMPLETE",COMPLETE:"COMPLETE",PASSED:"PASSED",FAILED:"FAILED"},vt={deepClone:function(e){return"object"===("undefined"==typeof e?"undefined":N(e))?JSON.parse(JSON.stringify(e)):e}},yt=function(e){var t={baseType:ht.STRING,cardinality:dt.MULTIPLE,value:[]};return e&&e.value&&(t.value=vt.deepClone(e.value),"multipleString"===e.baseType&&(t.baseType=ht.MULTIPLE_STRING),"single"===e.cardinality?t.cardinality=dt.SINGLE:"ordered"===e.cardinality?t.cardinality=dt.ORDERED:"multiple"===e.cardinality&&(t.cardinality=dt.MULTIPLE)),t},gt={parseModel:function(e){var t=[],n=e.modelMap,r=e.hintFeedback||{},o=e.answerFeedback||{},i=e.correctAnswer,a=void 0,s=void 0,l=void 0,u=void 0,c=!0,f="";for(a in n)n.hasOwnProperty(a)&&(s=n[a],l=s.modelType,f||(f=a),"textEntryInteraction"!==l&&(c=!1),u={id:a,qti:!0,type:l,name:"",subjective:!1,hint:{content:""},analysis:{content:""},correctAnswer:{cardinality:"",baseType:"",value:[]},detail:{}},r[a]&&void 0!==r[a].content&&(u.hint.content=r[a].content),o[a]&&void 0!==o[a].content&&(u.analysis.content=o[a].content),("choiceInteraction_vote"===l||"extendedTextInteraction"===l||"drawingInteraction_drawing"===l||"drawingInteraction"===l||"drawingInteraction_handwrite"===l||"choiceInteraction"===l&&"vote"===s.questionType)&&(u.subjective=!0),i[a]&&(u.correctAnswer=yt(i[a])),u.detail=s,t.push(u));return t},parseAnswerState:function(e){var t={answerState:e.completionStatus===pt.PASSED,items:{}},n=void 0;e.responseVariable.length;return e.responseVariable.forEach(function(e){n={id:e.identifier,unAnsweredCount:0,answerState:e.state===pt.PASSED,completeState:ft.ALL_ANSWERED,candidateResponse:vt.deepClone(e.candidateResponse),correctResponse:vt.deepClone(e.correctResponse)};var r=n.candidateResponse.filter(function(e){return""!==e}).length;n.unAnsweredCount=n.correctResponse.length-r,n.unAnsweredCount<0&&(n.unAnsweredCount=0),0===r?n.completeState=ft.UNANSWERED:r===n.correctResponse.length||0===n.correctResponse.length&&r>0?n.completeState=ft.ALL_ANSWERED:n.completeState=ft.PARTICAL_ANSWERED,t.items[e.identifier]=n}),t},isQtiAnswerState:function(e){return!!(e&&e.completionStatus&&e.responseVariable)}},mt={checkOneValue:function(e,t,n){if("object"===("undefined"==typeof t?"undefined":N(t))&&"object"===("undefined"==typeof n?"undefined":N(n)))return t=JSON.stringify(t),n=JSON.stringify(n),t===n;switch(e){case ht.STRING:case ht.BOOLEAN:case ht.FLOAT:case ht.INTEGER:return t===n;case ht.ARRAY:case ht.PAIR:case ht.JSON:return JSON.stringify(t)===JSON.stringify(n);default:return"object"===("undefined"==typeof t?"undefined":N(t))&&"object"===("undefined"==typeof n?"undefined":N(n))&&(t=JSON.stringify(t),n=JSON.stringify(n)),t===n}},single:function(e,t,n){return this.checkOneValue(e,t[0],n[0])},ordered:function(e,t,n){var r=void 0,o=void 0,i=t.length;if(i!==n.length)return!1;for(r=0;r<i&&(o=this.checkOneValue(e,t[r],n[r]),o!==!1);r++);return o},multiple:function(e,t,n){var r=void 0,o=void 0,i=t.length,a=void 0,s=n.slice();if(i!==n.length)return!1;for(r=0;r<i;r++){a=t[r];for(var l=0,u=s.length;s.length;){var c=s.shift();if(o=this.checkOneValue(e,a,c))break;if(s.push(c),l++,l>=u){o=!1;break}}if(o===!1)break}return o},getCompleteState:function(e,t){var n=t-e;return n<0&&(n=0),0===e?ft.UNANSWERED:e===t?ft.ALL_ANSWERED:ft.PARTICAL_ANSWERED},checkAnswer:function(e,t){var n=e.value||[],r=n.length,o=e.cardinality,i=e.baseType,a=void 0;return a=!e||!r||t.length===r&&this[o](i,n,t)}},_t={getNormalItemResult:function(e,t,n){var r=t&&t.value||[],o=n.value||[],i={id:e.id,unAnsweredCount:0,answerState:!1,completeState:ft.ALL_ANSWERED,candidateResponse:vt.deepClone(o),correctResponse:vt.deepClone(r)},a=o.filter(function(e){return""!==e}).length;return 0!==r.length&&(i.unAnsweredCount=r.length-a),0===a?i.completeState=ft.UNANSWERED:a<r.length&&(i.completeState=ft.PARTICAL_ANSWERED),n.answerState===!0||n.answerState===!1?i.answerState=n.answerState:t&&t.value&&r.length||!e.getModel?e.subjective?i.answerState=!0:i.answerState=mt.checkAnswer(t,o):i.answerState=!1,i},getQtiItemResult:function(e){var t=gt.parseAnswerState(e),n=Object.keys(t.items),r=t.items[n[0]];return r},getItemState:function(e,t){var n=e.correctAnswer||{},r=(n&&n.value||[],t.value||[],void 0);return r=gt.isQtiAnswerState(t)?this.getQtiItemResult(t):this.getNormalItemResult(e,n,t),r.id=e.id,r},isQtiState:function(e){var t=!0;for(var n in e)if(e.hasOwnProperty(n)&&(t=gt.isQtiAnswerState(e[n]),!t))break;return t},getAnswerState:function(e,t){var n=this,r=e.items||[],o=(r.length||1,{answerState:!0,items:{}}),i=Object.keys(t);if(r.length>0&&1===i.length&&this.isQtiState(t))return gt.parseAnswerState(t[i[0]]);if(0===r.length){if(!t[e.id])throw new Error("答案id和模型id不匹配",t,e.id);o.items[e.id]=n.getItemState(e,t[e.id]||{})}else r.forEach(function(e){var r=e.id;if(!t[e.id])throw new Error("答案id和模型id不匹配",t,r);o.items[r]=n.getItemState(e,t[r]||{})});var a=void 0;for(var s in o.items)o.items.hasOwnProperty(s)&&(a=o.items[s],a.answerState===!1&&(o.answerState=!1));return o},getDefaultState:function(e){var t={answerState:!1,items:{}};return e.items&&e.items.length>0?e.items.forEach(function(e){t.items[e.id]={id:e.id,unAnsweredCount:0,answerState:!1,completeState:ft.UNANSWERED,candidateResponse:[],correctResponse:vt.deepClone(e.correctAnswer)}},this):t.items[e.id]={id:e.id,unAnsweredCount:0,answerState:!1,completeState:ft.UNANSWERED,candidateResponse:[],correctResponse:[]},t}},wt={getCheckState:function(e,t){return _t.getAnswerState(e,t)},getDefaultState:function(e){return _t.getDefaultState(e)}},bt=function(){function e(){j(this,e),this._eventHandler={}}return x(e,[{key:"trigger",value:function(){var e=Array.prototype.slice.apply(arguments,[0]),t=e.shift();if(t&&(t=t.toLowerCase()),!this._eventHandler||!this._eventHandler[t])return!1;var n=this._eventHandler[t];return n.forEach(function(t){t.cb.apply(t.domain||this,e)}),!0}},{key:"on",value:function(e,t,n){return this._eventHandler[e]||(this._eventHandler[e]=[]),this._eventHandler[e].push({cb:t,domain:n}),!0}},{key:"off",value:function(e,t,n){var r=this._eventHandler[e];if(r&&r.length>0)for(var o,i=r.length,a=0;a<i;a++)if(o=r[a],o&&t===o.cb){if(n&&n!==o.domain)continue;r.splice(a,1),a--,i--}r&&0===r.length&&delete this._eventHandler[e]}}]),e}(),Et=function(){throw new Error("该方法还未实现")},St=function(){function e(t){j(this,e),this.questionId=t,this.answerState=null,this.userAnswer=null,this.event=new bt}return x(e,[{key:"getQuestionModel",value:function(){Et()}},{key:"getAnswerState",
value:function(){this.event.trigger("beforeGetAnswerState");var e=this.answerState;return e?vt.deepClone(e):wt.getDefaultState(this.getQuestionModel())}},{key:"getAnswer",value:function(){return vt.deepClone(this.userAnswer)}},{key:"trigger",value:function(e,t){e=e.toLowerCase(),"answerchange"===e&&(this.userAnswer=t,this.answerState=wt.getCheckState(this.getQuestionModel(),t)),this.event.trigger(e,t)}},{key:"on",value:function(e,t){this.event.on(e.toLowerCase(),t)}},{key:"off",value:function(e,t){this.event.off(e.toLowerCase(),t)}},{key:"getTipType",value:function(){Et()}},{key:"extendResult",value:function(e){Et()}},{key:"getQuestionInfo",value:function(){Et()}},{key:"showAnswer",value:function(e,t){Et()}},{key:"lockQuestion",value:function(){Et()}},{key:"unlockQuestion",value:function(){Et()}},{key:"finishQuestion",value:function(){Et()}},{key:"resetQuestion",value:function(){Et()}},{key:"showResultHint",value:function(){Et()}}],[{key:"parseQtiModel",value:function(e){return gt.parseModel(e)}}]),e}();!function(e){T(),M(),R(),e.Midware||(e.Midware=Oe),e.ConstVariable||(e.ConstVariable=e.Midware.ConstVariable=X),e.CommonClass||(e.CommonClass=e.Midware.CommonClass=Ye),e.SceneClass||(e.SceneClass=e.Midware.SceneClass=Ge),e.CommonController||(e.CommonController=e.Midware.CommonController=Ze),e.CommonService||(e.CommonService=e.Midware.CommonService=St),I()}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:window)});
