{"version":3,"sources":["ndplayer.js"],"names":["window","$","__applicationContext","exports","module","Array","prototype","forEach","callback","thisArg","T","k","this","TypeError","O","Object","len","length","arguments","kValue","call","each","filter","fun","t","res","i","val","push","definitions","caches","automatics","defineClass","config","className","classUtils","require","create","createByDef","key","def","obj","type","console","debug","toLowerCase","define","fn","Error","initialize","run","ErrorData","PLAYERERROR","eventName","msg","invokeMethod","eventData","CoursePlayer","invokeMethodPPT","drawMethod","result","JSON","parse","close","coursePlayer","getDrawSetting","_color","_width","_setting","color","width","paint","getPaintSetting","param","request_query","setting","stringify","drawLine","start","end","lineWidth","_start","x","y","_end","request_shape","shape","drawCircle","centre","radius","sAngle","eAngle","counterclockwise","isFill","_start_angle","_sweep_angle","start_angle","sweep_angle","tool","urlUtil","modelCreator","jsonParser","propTypeMapping","file","ppt","courseware","coursewareobject","question","flash","audio","image","video","jsonfile","json","html","ref-module","string","list","boolean","propParser","url","item","baseUrl","refPathParser","resolve","value","load","parser","textParsers","isCache","isPlainObject","text","itemProps","itemValue","itemPropValue","propValue","createProperty","name","default","trim","isFunction","promise","then","model","properties","p","when","apply","defaultWaitDialog","show","hide","defaultLang","currentLocation","stringUtil","logger","urlTemplate","locationCfg","_load","location","applyTemplate","base","done","fail","log","_loadPlayerI18n","icCreatePlayer","ref_path_tool","deferred","Deferred","loadPlayer","setLocation","default_lang","current","currentLang","split","rotate","isPointInPath","normalMode","e","event","fix","_w","element","_h","height","_pageX","undefined","pageX","originalEvent","touches","_pageY","pageY","_A","getRotateDeg","finalXY","getRotateXY","_finalX","_finalY","selfMode","mainModule","getPresenter","__interface","runInterface","toolConfig","swapItems","arr","index1","newArry","splice","concat","swapTool","toolList","listType","unqiueId","adjust","opType","_self","_finalToolList","_allFlase","sequence","top","bottom","flag","getElement","css","active","allFlase","DrawingBoard","constructor","$el","option","defaultOption","control","fillTolerance","webStorage","droppable","hideBoard","extend","board","canvasEl","canvas","boardEL","dom","$canvasWrapper","draw","saveHistory","_p","offset","getContext","ctx","save","strokeStyle","beginPath","moveTo","left","lineTo","closePath","stroke","arc","fillStyle","fill","redo","goForthInHistory","undo","goBackInHistory","reset","background","setColor","ev","trigger","setMode","mode","setSize","size","jsLibLoader","domUtil","loadScript","loadScripts","script","jsLib","autoLoad","toString","loadCombineScript","autoDeffer","notautoDeffer","mScript","jsLibConfig","isEmptyObject","autoload","reject","href","auto","notautoload","notauto","allLib","playerConfig","presenters","commons","replace","ignoreError","cssText","addStyleContent","loadCss","cssUrl","_cssUrl","addStyle","getCommons","createPageFn","pageConfig","id","moduleGroupType","addItem","getScripts","commonJsLib","version","functionUtil","runModuleMethod","args","flowName","sourcePresenterUnqiueId","methodName","$0","toUpperCase","player","eachPresenter","presenter","__model","_result","scope","flowData","scb","fcb","self","runFlag","runSequence","initData","_flowData","valid","validate","slice","pptshell","timer","delay","thumbnailSave","printScreen","eventBus","addEventListener","setTimeout","clearTimeout","stringUtils","createRefPath","refPath","newRefPath","createRefPathParser","getRefPath","build","coursewareUrl","coursewareRefPath","ref-path","ref-path-addon","getBase","getBaseLocationUrl","set","request","runtime","TEACHER_MOBILE","STUDENT_MOBILE","PROJECTION_MOBILE","WEB","TEACHER_PC","STUDENT_PC","runtimeMapping","mobile","teacher","student","projection","__default__","pc","RUNTIME","getRuntime","bridge","Bridge","terminal","pre","v","interval","timeObject","miuteObject","secondObject","miute","second","clearInterval","find","setInterval","stop","errorMessageTemplate","message","throwable","cause","errorType","execute","component","error","fireEvent","callListener","listener","listeners","selector","argsLength","isArray","removeEventListener","numOfCallbacks","newArray","hasEventListener","dispatch","targetEl","isFirefox","navigator","userAgent","indexOf","srcElement","target","closest","getEvents","str","maximize","minimize","finish","push_action","push_data","adjust_layout","layout_resize","forbide_full","play","push_status","configAttrName","static","attrName","createLayoutConfig","pushAttrName","layoutConfig","inArray","isNumeric","parseInt","zIndex","getZIndex","render","me","$layoutTarget","itemPromises","items","addModule","zindex","position","z-index","Layout","When","toolLayout","commonPageTemplate","pagePanelTemplate","commonPageRenderConfig","horizontal","sizeName","group","layout","vertical","commonPageRender","commonPages","$parent","$target","groupLoads","groupConfig","pageLoads","pages","getItems","$commonPagePanel","results","sumSize","page","_name","getAttribute","append","commonPageShow","isVisible","classTemplate","$classhandler","mainRender","$mainLayout","events","downEvents","moveEvents","upEvents","pageLeaveEvents","clickEvents","addPageEvent","downTime","downX","downY","isMove","Date","activePage","pageTarget","attachEvent","Math","abs","changedTouches","fontSizeCreater","adaptFlag","fontSize","utils","getFontSize","container","superClass","renderAllCommonPage","promises","pageChange","addClass","renderPage","waitDialog","$toolTarget","removeClass","renderTool","activeTool","addTool","setToolZIndex","isLargeZIndex","fireTool","minTool","switchCommonPage","Loader","packageParser","packageUrlTemplate","getKey","importJs","baseurl","loadJsList","jsUrl","releaseNum","addScript","importCss","importDependencies","dependencies","createLoadPromise","createPromiseThen","autoData","notautoData","loader","loadConfig","loaders","loaderList","_promises","_promise","simpleJsonParser","domUtils","presenterXmlParser","jsLibLoaderCreator","PresenterModel","scriptReg","cssReg","scriptTemplate","createFnTemplate","defineFnTemplate","cssUrlTemplate","packageLoader","loadPresenters","parseScript","removeAttribute","createFnName","addScriptContent","parseJsDependence","jsDependencyList","parseCss","$1","$2","presenterId","loadResult","data","packageConfig","setAttributes","setAttribute","view","indexNames","map","indexMap","add","indexKey","_map","getByIndex","index","getByKey","indexName","getArray","attributes","addPage","getPages","simpleType","array","object","attributeValues","attr","Type","attrs","getValue","ajaxProxy","defaultParser","textStatus","jqXHR","textParser","proxy","defer","refBaseParserConfig","ref-base","getData","addPresenter","addProperty","property","addEvent","handler","getIndexOfById","getIndexOfByName","__extendAttribute","keys","removeItem","initws","wsUrl","socket","Socket","encodeURI","onerror","count","maxCount","onmessage","onclose","code","reason","getTool","syncId","instance","getToolList","all","toolKey","createOption","action","_data","sync","__sys","NONEventFlag","toolState","decodeURIComponent","removeTool","MozWebSocket","WebSocket","sendTimer","wsurl","_eventbus","toolObject","_state","getState","closeTool","send","waitForConnection","readyState","that","updateTool","updateInfo","getPlayerServices","getAllToolState","playerException","Eventbus","uuid","layoutAlias","iframe","div","createLayout","layoutType","typeName","LayoutClass","parent","layoutTarget","initConfig","parentBaseUrl","_events","initComponent","createController","getController","controller","addEvents","getRefPathParser","renderTo","onRender","renderModel","afterLayout","isJquery","eventConfig","release","destroy","children","remove","loaderFactory","createModel","ModuleModel","i18nLoader","ModuleInterface","Wrap","Processer","createModuleModel","ID","createPresenter","fnName","_interface","test","createReg","getModel","setPlayerController","setUrlParams","get","setBasePath","setPaint","getPaint","lifeCycle","afterRender","isRequire","presenterModel","parentController","addToolItem","getItemRender","addonId","moduleDependency","isRelative","moduleConfig","requireModule","createModule","declareModuleId","lazyInitModules","getEventBus","options","comp","onEventReceived","_value","getPage","cssElement","isReportable","getQuestionInfo","setReportable","instanceOf","moduleTemplate","templateKey","setLocationProperties","langObject","initName","getStateId","setState","runLifeCycle","taskList","lifeName","Module","Collection","processPresenters","items_state","itemIds","getModuleList","getModule","getModulesByType","runModuleLifeCycle","reg","_setModuleState","stateValue","getStateValue","gotoConfig","getCallbackList","__extendConfig","processer","itemid","handlers","_handlerModule","processModule","modulelifeCycles","reportable","stateMap","mainParser","Page","refPathBuilder","eventname","table","State","PlayerFlow","toolApi","gotoPageController","createPage","presenterGetter","common","allPresenterGetter","state","stateToken","currentPageIndex","oriRefPathParse","_refPath","ref_path","ref_path_addon","playerCode","lang","i18nModel","playerFlows","TOOL","TOOLCONTROL","getI18nModel","callbackList","renderPromise","setContainerFontSize","getCurrentPageIndex","closeActivePage","gotoPageIndex","registerFlow","flowConfig","startFlow","flow","clearTool","gotoPage","gotoPageId","firstPage","lastPage","nextPage","prevPage","addExtendPage","hidePage","pageType","getPageType","closeExtendPage","mediaPause","mediaTags","docs","document","iframes","getElementsByTagName","src","contentWindow","tagName","doc","mediaEl","mediaElList","pause","pageUrl","preview","startPageIndex","startPageId","startPageName","createDelegate","toolPaint","getEventName","getUtils","updateToolProperties","stoolkey","dtoolkey","extendOptions","isMaxToolCount","onPageLoaded","DATA","MAXLIMIT","PUSHING","CURRENTPUSHTOOL","DIALOG","STEPLEFT","STEPTOP","isInPath","tHelper","tooldialog","toolPush","singleTools","toolLoadState","htmlMapping","up","down","defaultToolPosition","visibility","_left","_top","_position","itemLayout","right","adjustLeftTop","independent","dialogModel","__type","floor","used","getPositionIndex","updatePositionUsed","toolInit","toolExecute","hideTip","tip","jQuery","executeName","__options","executeArgs","getToolKey","bridgeClose","getDialogModel","getCommands","cssOption","el","_model","_listType","plugin","webglControl","topExcess","isToolsExcess","isOverMaxLimit","limitClass","_tip","toolType","modelType","enableFull","disabledFull","no_full","toolName","getToolNameI18n","display","smallIcon","ispushing","pushDomStatus","pushed_tip","cancel","sure","tip_full","tip_for_xp","setDisplayMode","initEvent","supportXP","getOS","disabledClose","click","singleton","delPositionUnqiueId","stopPush","switchToolContainerBG","enable","write","localStorage","setItem","ex","read","getItem","clear","localStorageController","addStates","loadFromString","getAsString","readState","writeState","lsState","writePageState","pageName","truncate","stack","limit","shift","settings","defaultOptions","provider","maxLength","onUpdate","initialItem","min","bind","canUndo","canRedo","regArray","sReg","join","RegExp","override","source","extendAttribute","superValue","classHelper","subClass","overrides","F","superClassPrototype","classDef","staticDef","rgba","getImageData","imageData","canvasMode","rotateAngle","detector","CanvasRenderingContext2D","webgl","createElement","WebGLRenderingContext","workers","Worker","fileapi","File","FileReader","FileList","Blob","websocket","isEnvLoaded","callNative","isOnline","status","pptInvokeMethod","nStatus","online_status","head","documentElement","_touchFlag","_eventName","move","createMouseEvent","evt","createEvent","first","initMouseEvent","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","appendChild","async","onload","onreadystatechange","_","isAbort","insertBefore","firstChild","appendTo","elem","getEventXY","functionHelper","isAppendArgs","exceptionHandler","callArgs","millis","appendArgs","callFn","injections","isCheck","singleExecuteName","params","callMethod","Function","fnConfigs","runIndex","$promise","fnConfig","errorLog","level","raf","requestAnimationFrame","caf","cancelAnimationFrame","vendors","vp","lastTime","now","nextTime","max","sSearch","search","oParam","substr","paramExpr","sParamName","templateRegExp","tpl","throttle","immediate","debounce","diff","context","curr","last_call","last_exec","exec","findOffset","curX","curY","offsetParent","offsetLeft","offsetTop","angle","matrix","values","a","b","atan2","PI","toFixed","getRotateOriginXY","parseFloat","goalX","cos","sin","goalY","baseReg","absoluteReg","isAbsolute","hexDigits","uuids","random","callDone","_count","_done","_results","toJsonByAttr","node","eachFn","mapKey","pptshellpaint","Paint","toolTargetHtml","toolIconHtml","isMouse","ToolZIndex","toolIconDown","is","initTool","canmove","currentToolIndex","oldtool","adjustList","currentTool","disabledMin","activeToolList","Tool_PopLimit","Tool_See","$toolContainer","$toolIconList","$iconEl","icon","prepend","currentToolZIndex","gotoPageIndexByNative","isCallback","isFromCache","getPlayerEvent","getPresentation","getPlayerEventBus","moduleId","getCommonsModule","getToolbarModule","getHeaderModule","getFooterModule","getCurrentPageView","sendEvent","isEmpty","getModules","isNaN","beforeSwitchToPage","getPageCount","pageInfo","getName","getId","getBaseURL","getCurrentPage","getBaseURl","getTableOfContents","getPreview","getCurrentPageState","getPlayerState","savePageState","getToolSysModel","_sys","widthFull","hideHead","hideToolBar","hideSYSWidth","disabled","disabledMove","selfBorder","oldXMLKey","adaptelang","i18n","sysModel","isOver","Tool","apiList","stoolview","waitI18nLoadDF","waitToolAddDF","toolconfiglist","toolkey","__option","preActive","rtype","rindex","unshift","curentTool","setPushDomEnable","setEnable","setDisable","range","m","minLeft","maxLeft","minTop","maxTop","deTip","moveTarge","isFull","hasClass","fontsize","resize","resizeScreen","ratio","side","next","stopPropagation","preventDefault","uniqueId","isForbide","mLeft","mTop","_parent","sidetool","autoFull","screen","preLeft","preTop","pushClassName","hideom","utilsXML","mainModel","parentTagName","$dom","parseXML","parentNode","rootPath","style","moduleModel","propertiesParse","parseModule","$event","handlerList","j","modules","_module","lazy-init","pageModel","moduleParse","presentersParse","parserMapping","addons","root","$page","idNameMapping","addon-descriptor","xmlUtils","dependenceParser","jsDependency","js","jsObject","moduleObject","tagMapping","dependence","buildProp","prop","oProp","sText","modulesParse","ToolModel","xmlUtil","$tool","ajax","cache","dataType","Tool_ToolName","Tool_Sure","Tool_Push","Tool_Pushing","Tool_Finish","Tool_Pushed_Tip","Tool_Tip","Tool_Cancel","Tool_bottom","Tool_top","Tool_full","Tool_Not_Support","DrawingBoardUtil","SimpleUndo","DrawingBoardMicroEvent","opts","mergeOptions","$canvas","$cursor","$controls","n","controlsPosition","storage","_getStorage","initHistory","history","restoreWebStorage","initDropEvents","errorMessage","defaultOpts","controls","eraserColor","fillHack","enlargeYourContainer","stretchImg","resetBackground","lineCap","lineJoin","saveWebStorage","blankCanvas","getImg","bgIsColor","isColor","prevMode","getMode","clearRect","fillRect","setImg","toggleClass","canvasWidth","canvasHeight","widths","boxBorderWidth","heights","boxBorderHeight","sum","multiplier","sub","initControls","addControl","restoreHistory","stretch","img","Image","oldGCO","globalCompositeOperation","drawImage","toDataURL","downloadImg","charAt","clearWebStorage","on","_onCanvasDrop","files","dataTransfer","fr","readAsDataURL","newMode","silent","unbind","setStrokeStyle","updatePixelColor","pixel","INDEX","r","g","X","Y","COLOR","pixelAt","coords","startColor","tolerance","useHack","compareColors","RGBToInt","queue","maxX","maxY","pop","putImageData","initDrawEvents","isDrawing","isMouseHovering","old","oldMid","_onInputStart","_getInputCoords","_onInputMove","_onInputStop","_onMouseOver","_onMouseOut","transform","-webkit-transform","-ms-transform","currentMid","_getMidInputCoords","quadraticCurveTo","rect","getBoundingClientRect","MicroEvent","fct","_boxBorderSize","withPadding","withMargin","direction","props","undef","path","pattern","template","tag","token","lookup","substring","c","ra","rb","ga","gb","ba","bb","Player","EventBus","defaultPlayerConfig","ref-path-online","ref-path-tool","toolClose","applyConfig","defaultConfig","defaultValue","winWidth","winHeight","clientHeight","clientWidth","winSizeValue","defaultWidth","defaultHeight","defaultFontSize","ua","re","match","setDefaultPlayerConfig","_default","PAGETYPE","PAGE","EXTEND_PAGE"],"mappings":"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","file":"ndplayer.min.js","sourcesContent":["/**ndplayer version :11.7.3**/\r\n(function(window,$){ var __applicationContext={exports:{}};(function(module){ 'use strict';\r\n// Production steps of ECMA-262, Edition 5, 15.4.4.18\r\n// Reference: http://es5.github.io/#x15.4.4.18\r\nif (!Array.prototype.forEach) {\r\n\r\n    Array.prototype.forEach = function (callback, thisArg) {\r\n\r\n        var T, k;\r\n\r\n        if (this === null) {\r\n            throw new TypeError(' this is null or not defined');\r\n        }\r\n\r\n        // 1. Let O be the result of calling toObject() passing the\r\n        // |this| value as the argument.\r\n        var O = Object(this);\r\n\r\n        // 2. Let lenValue be the result of calling the Get() internal\r\n        // method of O with the argument \"length\".\r\n        // 3. Let len be toUint32(lenValue).\r\n        var len = O.length >>> 0;\r\n\r\n        // 4. If isCallable(callback) is false, throw a TypeError exception.\r\n        // See: http://es5.github.com/#x9.11\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(callback + ' is not a function');\r\n        }\r\n\r\n        // 5. If thisArg was supplied, let T be thisArg; else let\r\n        // T be undefined.\r\n        if (arguments.length > 1) {\r\n            T = thisArg;\r\n        }\r\n\r\n        // 6. Let k be 0\r\n        k = 0;\r\n\r\n        // 7. Repeat, while k < len\r\n        while (k < len) {\r\n\r\n            var kValue;\r\n\r\n            // a. Let Pk be ToString(k).\r\n            //    This is implicit for LHS operands of the in operator\r\n            // b. Let kPresent be the result of calling the HasProperty\r\n            //    internal method of O with argument Pk.\r\n            //    This step can be combined with c\r\n            // c. If kPresent is true, then\r\n            if (k in O) {\r\n\r\n                // i. Let kValue be the result of calling the Get internal\r\n                // method of O with argument Pk.\r\n                kValue = O[k];\r\n\r\n                // ii. Call the Call internal method of callback with T as\r\n                // the this value and argument list containing kValue, k, and O.\r\n                callback.call(T, kValue, k, O);\r\n            }\r\n            // d. Increase k by 1.\r\n            k++;\r\n        }\r\n        // 8. return undefined\r\n    };\r\n}\r\n\r\nif (!Array.prototype.each) {\r\n\r\n    Array.prototype.each = function (callback, thisArg) {\r\n\r\n        var T, k;\r\n\r\n        if (this === null) {\r\n            throw new TypeError(' this is null or not defined');\r\n        }\r\n\r\n        // 1. Let O be the result of calling toObject() passing the\r\n        // |this| value as the argument.\r\n        var O = Object(this);\r\n\r\n        // 2. Let lenValue be the result of calling the Get() internal\r\n        // method of O with the argument \"length\".\r\n        // 3. Let len be toUint32(lenValue).\r\n        var len = O.length >>> 0;\r\n\r\n        // 4. If isCallable(callback) is false, throw a TypeError exception.\r\n        // See: http://es5.github.com/#x9.11\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(callback + ' is not a function');\r\n        }\r\n\r\n        // 5. If thisArg was supplied, let T be thisArg; else let\r\n        // T be undefined.\r\n        if (arguments.length > 1) {\r\n            T = thisArg;\r\n        }\r\n\r\n        // 6. Let k be 0\r\n        k = 0;\r\n\r\n        // 7. Repeat, while k < len\r\n        while (k < len) {\r\n\r\n            var kValue;\r\n\r\n            // a. Let Pk be ToString(k).\r\n            //    This is implicit for LHS operands of the in operator\r\n            // b. Let kPresent be the result of calling the HasProperty\r\n            //    internal method of O with argument Pk.\r\n            //    This step can be combined with c\r\n            // c. If kPresent is true, then\r\n            if (k in O) {\r\n\r\n                // i. Let kValue be the result of calling the Get internal\r\n                // method of O with argument Pk.\r\n                kValue = O[k];\r\n\r\n                // ii. Call the Call internal method of callback with T as\r\n                // the this value and argument list containing kValue, k, and O.\r\n                callback.call(T, kValue, k, O);\r\n            }\r\n            // d. Increase k by 1.\r\n            k++;\r\n        }\r\n        // 8. return undefined\r\n    };\r\n}\r\nif (!Array.prototype.filter) {\r\n    Array.prototype.filter = function (fun/*, thisArg*/) {\r\n        'use strict';\r\n\r\n        if (this === void 0 || this === null) {\r\n            throw new TypeError();\r\n        }\r\n\r\n        var t = Object(this);\r\n        var len = t.length >>> 0;\r\n        if (typeof fun !== 'function') {\r\n            throw new TypeError();\r\n        }\r\n\r\n        var res = [];\r\n        var thisArg = arguments.length >= 2 ? arguments[1] : void 0;\r\n        for (var i = 0; i < len; i++) {\r\n            if (i in t) {\r\n                var val = t[i];\r\n\r\n                // NOTE: Technically this should Object.defineProperty at\r\n                //       the next index, as push can be affected by\r\n                //       properties on Object.prototype and Array.prototype.\r\n                //       But that method's new, and collisions should be\r\n                //       rare, so use the more-compatible alternative.\r\n                if (fun.call(thisArg, val, i, t)) {\r\n                    res.push(val);\r\n                }\r\n            }\r\n        }\r\n\r\n        return res;\r\n    };\r\n}\r\n//定义容器管理\r\nvar definitions = {},\r\n    caches = {},\r\n    automatics = [];\r\n\r\nvar defineClass = function (config, className) {\r\n    var classUtils = require('core.utils.class');\r\n    return classUtils.create(config, className);\r\n};\r\n\r\nvar createByDef = function (key) {\r\n    var def = definitions[key];\r\n    if (def) {\r\n        delete definitions[key];\r\n        var module = {\r\n            'exports': {}\r\n        };\r\n        def.call(window, module.exports, module, require, $);\r\n        var obj = (module.type === 'class') ? defineClass(module.exports, key) : module.exports;\r\n        caches[key] = obj;\r\n        return obj;\r\n    } else {\r\n        console.debug('no definition:' + key);\r\n    }\r\n};\r\n\r\nvar require = function (key) {\r\n    if (key) {\r\n        key = key.toLowerCase();\r\n        var obj = caches[key];\r\n        //已经执行过从缓存里取\r\n        if (obj) {\r\n            return obj;\r\n        } else {\r\n            return createByDef(key);\r\n        }\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    'define': function (key, fn, type) {\r\n        if (key in definitions) {\r\n            throw new Error(\"player 11.7.3: \" + 'duplicate definition:' + key);\r\n        }\r\n        definitions[key] = fn;\r\n        if (type === \"automatic\") {\r\n            automatics.push(key);\r\n        }\r\n    },\r\n    'require': require,\r\n    'initialize': function () {\r\n        automatics.forEach(function (key) {\r\n            require(key).run();\r\n        });\r\n    }\r\n}; })(__applicationContext);__applicationContext=__applicationContext.exports;\n__applicationContext.define('core.bridge.courseplayer', function (exports,module,require,$) {\r\nvar ErrorData = {\r\n    PLAYERERROR: {\r\n        eventName: '',\r\n        msg: 'There isn\\'t a method named invokeMthod inside pptShell'\r\n    }\r\n}\r\nmodule.exports = {\r\n    invokeMethod: function (eventName, eventData) {\r\n        if (typeof (CoursePlayer) !== 'undefined' && CoursePlayer.invokeMethodPPT) {\r\n            return CoursePlayer.invokeMethodPPT(eventName, eventData);\r\n        } else {\r\n            ErrorData.PLAYERERROR.eventName = eventName;\r\n            return ErrorData;\r\n        }\r\n    },\r\n    drawMethod: function (eventName, eventData) {\r\n        if (typeof (CoursePlayer) !== 'undefined' && CoursePlayer.drawMethod)\r\n            return result = JSON.parse(CoursePlayer.drawMethod(eventName, eventData));\r\n        else {\r\n            ErrorData.PLAYERERROR.eventName = eventName;\r\n            return ErrorData;\r\n        }\r\n    },\r\n    close: function () {\r\n        if (typeof (CoursePlayer) !== 'undefined' && CoursePlayer.close) CoursePlayer.close();\r\n    }\r\n}\r\n\r\n}, '');\n__applicationContext.define('core.bridge.pptshell', function (exports,module,require,$) {\r\n'use strict';\r\nvar coursePlayer = require('core.bridge.courseplayer');\r\nvar getDrawSetting = function (fn) {\r\n    var _color = '#000000',\r\n        _width = 1;\r\n    if (typeof (fn) === 'function') {\r\n        var _setting = fn();\r\n        _color = _setting.color || _color;\r\n        _width = _setting.width || _width;\r\n    }\r\n    return {\r\n        'color': _color,\r\n        'width': _width\r\n    };\r\n};\r\nmodule.exports = {\r\n    \"paint\": {\r\n        /**\r\n         * 获取paint颜色与大小\r\n         * @return {Object} {\"color\" :\"#FF0000\",\"width\" :2}\r\n         */\r\n        \"getPaintSetting\": function () {\r\n            var param = {};\r\n            param.request_query = \"draw_setting\";\r\n            var setting = {};\r\n            var result = coursePlayer.drawMethod(\"drawsetting\", JSON.stringify({}));\r\n            //do api\r\n            setting.color = result.color || \"#ff0000\";\r\n            setting.width = result.width || 2;\r\n            return setting;\r\n        },\r\n\r\n        /**\r\n         * 画线\r\n         * @param  {Object} start     起始点，格式如下：{\"x\":12,\"y\":34.5}\r\n         * @param  {Object} end       结束点，格式如下：{\"x\":12,\"y\":34.5}\r\n         * @param  {String} color     16进制的颜色值 如：#ff0000\r\n         * @param  {number} lineWidth 笔尖大小的int值，如：20\r\n         * @return {[void]}           [description]\r\n         */\r\n        \"drawLine\": function (start, end, color, lineWidth) {\r\n            var _setting = getDrawSetting();\r\n            var _start = start || {\r\n                    \"x\": 0,\r\n                    \"y\": 0\r\n                },\r\n                _end = end || {\r\n                    \"x\": 0,\r\n                    \"y\": 0\r\n                };\r\n\r\n            var param = {};\r\n            param.request_shape = 'line';\r\n            param.shape = {\r\n                \"color\": color || _setting.color,\r\n                \"width\": lineWidth || _setting.width,\r\n                \"start\": _start,\r\n                \"end\": _end\r\n            };\r\n            //do\r\n            coursePlayer.drawMethod(\"drawLine\", JSON.stringify(param));\r\n        },\r\n        /**\r\n         * 画圆\r\n         * @param  {Object} centre    圆心\r\n         * @param  {[type]} radius    半径\r\n         * @param  {[type]} sAngle    开始角（弧度）\r\n         * @param  {[type]} eAngle    结束角（弧度）\r\n         * @param  {[type]} color     颜色 不传，会用默认的\r\n         * @param  {[type]} lineWidth 大小 不传，会用默认的\r\n         * @param  {Boolean} isFill 是否启用填充\r\n         * @return {[type]}           [description]\r\n         */\r\n        \"drawCircle\": function (centre, radius, sAngle, eAngle, counterclockwise, color, lineWidth, isFill) {\r\n            var _setting = getDrawSetting();\r\n            var _start, _end, _start_angle, _sweep_angle;\r\n\r\n            _start = {\r\n                \"x\": centre.x - radius,\r\n                \"y\": centre.y - radius\r\n            };\r\n            _end = {\r\n                \"x\": centre.x + radius,\r\n                \"y\": centre.y + radius\r\n            };\r\n            _start_angle = sAngle;\r\n            _sweep_angle = counterclockwise ? -eAngle : eAngle;\r\n            var param = {};\r\n            param.request_shape = 'arc';\r\n            param.shape = {\r\n                \"color\": color || _setting.color,\r\n                \"width\": lineWidth || _setting.width,\r\n                \"start\": _start,\r\n                \"end\": _end,\r\n                \"isFill\": isFill,\r\n                \"start_angle\": _start_angle,\r\n                \"sweep_angle\": _sweep_angle\r\n            };\r\n            coursePlayer.drawMethod(\"drawCircle\", JSON.stringify(param));\r\n        }\r\n    },\r\n    \"tool\": {\r\n        \"close\": function () {\r\n            coursePlayer.close();\r\n        }\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.common.createmodel', function (exports,module,require,$) {\r\n'use strict';\r\nvar urlUtil = require('core.utils.url');\r\nvar modelCreator = require('core.model.modelCreator');\r\nvar jsonParser = require('core.model.parser.simpleJsonParser');\r\n\r\nvar propTypeMapping = {\r\n    'file': 'url',\r\n    'ppt': 'url',\r\n    'courseware': 'url',\r\n    'coursewareobject': 'url',\r\n    'question': 'url',\r\n    'flash': 'url',\r\n    'audio': 'url',\r\n    'image': 'url',\r\n    'video': 'url',\r\n    'jsonfile': 'load',\r\n    'json': 'json',\r\n    'html': 'html',\r\n    'ref-module': 'default',\r\n    'string': 'default',\r\n    'list': 'list',\r\n    'boolean': 'boolean'\r\n};\r\n\r\nvar propParser = {\r\n    'url': function (item, baseUrl, refPathParser) {\r\n        return urlUtil.resolve(baseUrl, item.value);\r\n    },\r\n    'load': function (item, baseUrl, refPathParser) {\r\n        if (item.value) {\r\n            var url = propParser.url(item, baseUrl, refPathParser);\r\n            return modelCreator.create({\r\n                url: url,\r\n                parser: jsonParser,\r\n                textParsers: refPathParser,\r\n                isCache: false\r\n            });\r\n        }\r\n    },\r\n    'json': function (item, baseUrl, refPathParser) {\r\n        return ($.isPlainObject(item.value)) ? item.value : jsonParser.parse(item.text);\r\n    },\r\n    'html': function (item, baseUrl, refPathParser) {\r\n        return item.text || item.value;\r\n    },\r\n    'boolean': function (item, baseUrl, refPathParser) {\r\n        return item.value.toLowerCase() === 'true';\r\n    },\r\n    'list': function (item, baseUrl, refPathParser) {\r\n        var value = [];\r\n        item.value.forEach(function (itemProps) {\r\n            var itemValue = {};\r\n            itemProps.forEach(function (itemPropValue) {\r\n                var propValue = createProperty(itemPropValue, baseUrl, refPathParser);\r\n                itemValue[propValue.name] = propValue.value;\r\n            });\r\n            value.push(itemValue);\r\n        });\r\n        return value;\r\n    },\r\n    'default': function (item, baseUrl, refPathParser) {\r\n        return item.value;\r\n    }\r\n};\r\n\r\nvar createProperty = function (item, baseUrl, refPathParser) {\r\n    var parser = propTypeMapping[$.trim(item.type).toLowerCase()] || 'default';\r\n    var value = propParser[parser](item, baseUrl, refPathParser) || '';\r\n    value = parser === 'boolean' ? value != '' : value;\r\n\r\n    if ($.isFunction(value.promise)) {\r\n        return value.then(function (result) {\r\n            return {\r\n                'name': item.name,\r\n                'value': result.model\r\n            };\r\n        });\r\n    } else {\r\n        return {\r\n            'name': item.name,\r\n            'value': value\r\n        };\r\n    }\r\n};\r\n\r\n//根据属性值创建model对象\r\nmodule.exports = function (properties, baseUrl, refPathParser) {\r\n    var p = [],\r\n        model = {};\r\n    properties.forEach(function (item) {\r\n        p.push(createProperty(item, baseUrl, refPathParser));\r\n    });\r\n    return $.when.apply($, p).then(function () {\r\n        for (var i = 0, len = arguments.length; i < len; i++) {\r\n            var item = arguments[i];\r\n            model[item.name] = item.value;\r\n        }\r\n        return model;\r\n    });\r\n};\r\n}, '');\n__applicationContext.define('core.common.defaultwaitdialog', function (exports,module,require,$) {\r\n'use strict';\r\nvar defaultWaitDialog = {\r\n    show: function () {\r\n    },\r\n    hide: function () {\r\n    }\r\n};\r\n\r\nmodule.exports = defaultWaitDialog;\r\n\r\n}, '');\n__applicationContext.define('core.common.i18nloader', function (exports,module,require,$) {\r\n'use strict';\r\nvar modelCreator = require('core.model.modelCreator');\r\nvar stringUtil = require('core.utils.string');\r\nvar parser = require('core.model.parser.simpleJsonParser');\r\nvar logger = require('core.utils.log');\r\nvar urlTemplate = \"${base}resources/locations/${location}/lang.json\";\r\nvar defaultLang, currentLocation, locationCfg = {};\r\n\r\n\r\nvar _load = function(baseUrl, location, callback) {\r\n    modelCreator.create({\r\n        url: stringUtil.applyTemplate(urlTemplate, {\r\n            base: baseUrl,\r\n            location: location\r\n        }),\r\n        parser: parser\r\n    }).done(function(result) {\r\n        callback(result.model);\r\n    }).fail(function() {\r\n        if (location !== defaultLang) {\r\n            _load(baseUrl, locationCfg[location], callback);\r\n        } else {\r\n            callback({});\r\n            logger.log(\"load '\" + location + \"' error\");\r\n        }\r\n    });\r\n};\r\nvar _loadPlayerI18n = function(callback) {\r\n    modelCreator.create({\r\n        url: icCreatePlayer.ref_path_tool + '/tool.json',\r\n        parser: parser\r\n    }).done(function(result) {\r\n        callback(result.model);\r\n    }).fail(function() {\r\n        callback({});\r\n        logger.log(\"load '\" + icCreatePlayer.ref_path_tool + '/tool.json' + \"' error\");\r\n    });\r\n};\r\nmodule.exports = {\r\n    'load': function(baseUrl) {\r\n        var deferred = $.Deferred();\r\n        _load(baseUrl, currentLocation, function(result) {\r\n            deferred.resolve(result);\r\n        });\r\n        return deferred.promise();\r\n    },\r\n    'loadPlayer': function() {\r\n        var deferred = $.Deferred();\r\n        _loadPlayerI18n(function(result) {\r\n            deferred.resolve(result);\r\n        });\r\n        return deferred.promise();\r\n    },\r\n    'setLocation': function(location) {\r\n        location = location || {};\r\n        defaultLang = location.default_lang;\r\n        currentLocation = location.current || defaultLang;\r\n        var currentLang = (currentLocation && currentLocation.split(\"_\")[0]) || defaultLang;\r\n        locationCfg[currentLocation] = currentLang;\r\n        locationCfg[currentLang] = defaultLang;\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.common.ispointinpath', function (exports,module,require,$) {\r\n'use strict';\r\nvar rotate = require('core.utils.transform');\r\nvar isPointInPath = \"isPointInPath\";\r\n\r\n\r\n//player内正常模式判断是否选中\r\nvar normalMode = function (tool, e) {\r\n    var event = $.event.fix(e);\r\n    var _w = tool.element.width(),\r\n        _h = tool.element.height(),\r\n        _pageX = event.pageX === undefined ? event.originalEvent.touches[0].pageX : event.pageX,\r\n        _pageY = event.pageY === undefined ? event.originalEvent.touches[0].pageY : event.pageY;\r\n    var _A = rotate.getRotateDeg(tool.element[0]); //这里取返就是为了算相对位置直接取旋转前的X,Y，\r\n    var finalXY = rotate.getRotateXY(_pageX, _pageY, _A, tool.element[0]);\r\n    var _finalX = finalXY.x,\r\n        _finalY = finalXY.y;\r\n    if (_finalX >= 0 && _finalX <= _w && _finalY >= 0 && _finalY <= _h) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n};\r\n\r\n//presenter自身判断是否要选中\r\nvar selfMode = function (tool, event) {\r\n    if (tool.mainModule.getPresenter().__interface && typeof (tool.mainModule.getPresenter().__interface.isPointInPath) === 'function') {\r\n        return tool.mainModule.runInterface(isPointInPath, [event]);\r\n    } else {\r\n        return false;\r\n    }\r\n};\r\nmodule.exports = {\r\n    /**\r\n     判断坐标是否在当前路径\r\n    */\r\n    'resolve': function (tool, event) {\r\n        if (tool === null) return tool;\r\n        var option = tool.toolConfig;\r\n        if (tool.mainModule.getPresenter().__interface && typeof (tool.mainModule.getPresenter().__interface.isPointInPath) === 'function') {\r\n            return selfMode(tool, event);\r\n        } else {\r\n            return normalMode(tool, event);\r\n        }\r\n\r\n    },\r\n    /**\r\n     * tool位置处理\r\n     * @param  {[type]} arr   需要处理的队列\r\n     * @param  {[type]} index1 需要更换的位置\r\n     * @param  {[type]} type  放在队列的开始还是末尾\r\n     * @return {[type]}       返回修改后的队列\r\n     */\r\n    'swapItems': function (arr, index1, type) {\r\n        var newArry = [];\r\n        newArry[0] = arr[index1];\r\n        arr.splice(index1, 1);\r\n        if (type === 'first')\r\n            newArry = newArry.concat(arr);\r\n        else\r\n            newArry = arr.concat(newArry);\r\n        return newArry;\r\n    },\r\n    /**\r\n     * 把tool直接换到最后\r\n     * @param  {[type]} toolList [description]\r\n     * @param  {[type]} listType [description]\r\n     * @param  {[type]} index1   [description]\r\n     * @param  {[type]} index2   [description]\r\n     * @return {[type]}          [description]\r\n     */\r\n    'swapTool': function (toolList, listType, tool) {\r\n        for (var i = 0; i < toolList.list[listType].length; i++) {\r\n            if (toolList.list[listType][i].unqiueId === tool.unqiueId) {\r\n                toolList.list[listType] = this.swapItems(toolList.list[listType], i, 'last');\r\n            }\r\n        }\r\n        return toolList;\r\n    },\r\n    'adjust': function (toolList, event, tool, opType) {\r\n        if (!toolList) return;\r\n        var _self = this,\r\n            _finalToolList = toolList,\r\n            _allFlase = true,\r\n            sequence = {\r\n                'top': toolList.list.top,\r\n                'bottom': toolList.list.bottom\r\n            };\r\n        for (var listType in sequence) {\r\n            for (var i = 0; i < sequence[listType].length; i++) {\r\n                var flag;\r\n                if (sequence[listType][i].getElement(true).css('display') === 'none' && opType !== 'FIRETOOL')\r\n                    continue;\r\n                if (typeof (tool) !== 'undefined') {\r\n                    flag = (sequence[listType][i].unqiueId === tool.unqiueId);\r\n                } else {\r\n                    flag = _self.resolve(sequence[listType][i], event);\r\n                }\r\n                if (flag) {\r\n                    _allFlase = false;\r\n                    _finalToolList.list[listType] = this.swapItems(sequence[listType], i, 'first');\r\n                    _finalToolList.active = listType;\r\n                    break;\r\n                }\r\n            }\r\n            if (!_allFlase) break;\r\n        }\r\n        return {\r\n            'allFlase': _allFlase,\r\n            'toolList': _finalToolList\r\n        };\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.common.paint', function (exports,module,require,$) {\r\n'use strict';\r\nvar DrawingBoard = require('core.utils.drawingboard.board');\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function($el, option) {\r\n        var defaultOption = {\r\n            control: false,\r\n            fillTolerance: 500,\r\n            webStorage: 'false',\r\n            droppable: true,\r\n            hideBoard: true\r\n        };\r\n        var defaultOption = $.extend({}, defaultOption, option);\r\n        this.board = new DrawingBoard($el, defaultOption);\r\n        this.canvasEl = this.board.canvas;\r\n        this.boardEL = this.board.dom.$canvasWrapper;\r\n        this.boardEL.css(\"pointer-events\", \"none\");\r\n        if (defaultOption.hideBoard)\r\n            this.hide();\r\n\r\n    },\r\n    draw: function(fn) {\r\n        if (typeof(fn) === 'function') {\r\n            fn(this.canvasEl);\r\n            this.board.saveHistory();\r\n            this.show();\r\n        }\r\n\r\n    },\r\n    /**\r\n     * 画线\r\n     * @param  {Object} start     起始点，格式如下：{\"x\":12,\"y\":34.5}\r\n     * @param  {Object} end       结束点，格式如下：{\"x\":12,\"y\":34.5}\r\n     * @param  {String} color     16进制的颜色值 如：#ff0000\r\n     * @param  {number} lineWidth 笔尖大小的int值，如：20\r\n     * @return {[void]}           [description]\r\n     */\r\n    drawLine: function(start, end, color, lineWidth) {\r\n        var _p = $(this.canvasEl).offset();\r\n        if (this.canvasEl.getContext) {\r\n            var ctx = this.canvasEl.getContext(\"2d\");\r\n            ctx.save();\r\n            if (lineWidth)\r\n                ctx.lineWidth = lineWidth;\r\n            if (color)\r\n                ctx.strokeStyle = color;\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x - _p.left, start.y - _p.top);\r\n            ctx.lineTo(end.x - _p.left, end.y - _p.top);\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n            this.board.saveHistory();\r\n            this.show();\r\n        }\r\n\r\n    },\r\n    /**\r\n     * 画圆       \r\n     * @param  {Object} centre {\"x\":1,\"y\":1}   圆心\r\n     * @param  {[type]} radius    半径\r\n     * @param  {[type]} sAngle    开始角（弧度）\r\n     * @param  {[type]} eAngle    结束角（弧度）\r\n     * @param  {[type]} color     颜色\r\n     * @param  {[type]} lineWidth 大小\r\n     * @param  {Boolean} isFill 是否启用填充\r\n     * @return {[type]}           [description]\r\n     */\r\n\r\n    drawCircle: function(centre, radius, sAngle, eAngle, counterclockwise, color, lineWidth, isFill) {\r\n        if (this.canvasEl.getContext) {\r\n            var ctx = this.canvasEl.getContext('2d');\r\n            ctx.save();\r\n            if (lineWidth)\r\n                ctx.lineWidth = lineWidth;\r\n            if (color)\r\n                ctx.strokeStyle = color;\r\n            ctx.beginPath();\r\n            ctx.arc(centre.x, centre.y, radius, sAngle, eAngle, false);\r\n\r\n\r\n            if (color)\r\n                ctx.fillStyle = color;\r\n            if (isFill)\r\n                ctx.fill();\r\n            else\r\n                ctx.stroke();\r\n            ctx.closePath();\r\n            this.board.saveHistory();\r\n            this.show();\r\n        }\r\n    },\r\n    /**\r\n     * 重做\r\n     * @return {[void]} [description]\r\n     */\r\n    redo: function() {\r\n        this.board.goForthInHistory();\r\n    },\r\n    /**\r\n     * 撤消\r\n     * @return {[void]} [description]\r\n     */\r\n    undo: function() {\r\n        this.board.goBackInHistory();\r\n    },\r\n    /**\r\n     * 重置\r\n     * @return {void} [description]\r\n     */\r\n    reset: function() {\r\n        this.board.reset({\r\n            background: true\r\n        });\r\n    },\r\n    /**\r\n     * 获取paint颜色与大小\r\n     * @return {Object} {\"color\" :\"#FF0000\",\"width\" :2}\r\n     */\r\n    getPaintSetting: function() {\r\n        return {\r\n            \"width\": this.board.ctx.lineWidth || 1,\r\n            \"color\": this.board.color || \"#000000\"\r\n        };\r\n    },\r\n    /**\r\n     * 设置颜色\r\n     * @param {string} color [颜色值]\r\n     */\r\n    setColor: function(color) {\r\n        this.board.setColor(color);\r\n        this.board.ev.trigger('color:changed', color);\r\n    },\r\n    /**\r\n     * 设置画笔模式\r\n     * @param {string} mode pencil(画笔),eraser（橡皮檫）,filler（填冲）\r\n     */\r\n    setMode: function(mode) {\r\n        this.board.setMode(mode);\r\n        this.board.ev.trigger('mode:changed', mode);\r\n    },\r\n    /**\r\n     * 设置画笔大小\r\n     * @param {int} size 画笔大小\r\n     */\r\n    setSize: function(size) {\r\n        this.board.ctx.lineWidth = size;\r\n        this.board.ev.trigger('size:changed', size);\r\n    },\r\n    /**\r\n     * 显示画板\r\n     * @return {[type]} [description]\r\n     */\r\n    show: function() {\r\n        //this.boardEL.show();\r\n        this.boardEL.css('visibility', '');\r\n    },\r\n    /**\r\n     * 隐藏画板\r\n     * @return {[type]} [description]\r\n     */\r\n    hide: function() {\r\n        this.boardEL.css('visibility', 'hidden');\r\n    }\r\n};\r\n}, 'class');\n__applicationContext.define('core.common.playerconfig', function (exports,module,require,$) {\r\n'use strict';\r\nvar modelCreator = require('core.model.modelCreator');\r\nvar parser = require('core.model.parser.simpleJsonParser');\r\nvar jsLibLoader = require('core.loader.jsLibLoaderCreator').create();\r\nvar domUtil = require('core.utils.dom');\r\n\r\nvar loadScript = function (model, refPathParser) {\r\n    //初始化加载的jsLib\r\n    var loadScripts = [];\r\n    model.script = (model.script || []).filter(function (jsLib) {\r\n        //默认设置成自动加载\r\n        if (typeof jsLib.autoLoad == 'undefined') {\r\n            jsLib.autoLoad = true;\r\n        }\r\n        //兼容false和'false'的写法\r\n        if (jsLib.autoLoad.toString().toLowerCase() === 'false') {\r\n            //不自动加载继续保存\r\n            return jsLib;\r\n        } else {\r\n            //自动加载的加载完删除\r\n            loadScripts.push(jsLib);\r\n        }\r\n    });\r\n    return jsLibLoader.load(refPathParser, loadScripts);\r\n};\r\n\r\nvar loadCombineScript = function (model, refPathParser) {\r\n    var autoDeffer = $.Deferred();\r\n    var notautoDeffer = $.Deferred();\r\n    var script = model.mScript\r\n    icCreatePlayer.jsLibConfig = {}\r\n    if (!$.isEmptyObject(script.autoload)) {\r\n        modelCreator.create({\r\n            url: script.autoload.href,\r\n            textParsers: refPathParser,\r\n            parser: parser\r\n        }).then(function (result) {\r\n            icCreatePlayer.jsLibConfig.auto = result\r\n            autoDeffer.resolve()\r\n        }).fail(function () {\r\n            autoDeffer.reject()\r\n        })\r\n    } else {\r\n        autoDeffer.reject()\r\n    }\r\n    if (!$.isEmptyObject(script.notautoload)) {\r\n        modelCreator.create({\r\n            url: script.notautoload.href,\r\n            textParsers: refPathParser,\r\n            parser: parser\r\n        }).then(function (result) {\r\n            icCreatePlayer.jsLibConfig.notauto = result\r\n            notautoDeffer.resolve()\r\n        }).fail(function () {\r\n            notautoDeffer.reject()\r\n        })\r\n    } else {\r\n        notautoDeffer.reject()\r\n    }\r\n    return $.when.apply($, [autoDeffer.promise(), notautoDeffer.promise()]).then(function () {\r\n        var loadScripts = []\r\n        icCreatePlayer.jsLibConfig.allLib = $.extend(true,{}, icCreatePlayer.jsLibConfig.auto,icCreatePlayer.jsLibConfig.notauto)\r\n        $.each(icCreatePlayer.jsLibConfig.auto.model, function (key, value) {\r\n            loadScripts.push(value)\r\n        })\r\n        return jsLibLoader.load(refPathParser, loadScripts)\r\n    }).fail(function () {\r\n        return $.Deferred().reject(new Error(\"player 11.7.3: \" + 'get auto and notauto package fail'));\r\n    })\r\n};\r\n//缺省定制播放器配置，用于无定制播放器时兼容\r\nvar playerConfig = {\r\n    \"presenters\": {},\r\n    \"commons\": {},\r\n    \"script\": [],\r\n    \"css\": \"\"\r\n};\r\n\r\n\r\nmodule.exports = {\r\n    //获取定制播放器\r\n    'create': function (url, refPathParser) {\r\n        if (url) {\r\n            return modelCreator.create({\r\n                url: url.replace(/\\/*$/, \"/config.json\"),\r\n                ignoreError: true,\r\n                textParsers: refPathParser,\r\n                parser: parser\r\n            }).then(function (result) {\r\n                playerConfig = result.model;\r\n                if (playerConfig.cssText) {\r\n                    domUtil.addStyleContent(playerConfig.cssText);\r\n                }\r\n                //兼容是否合并加载script的package文件\r\n                if (playerConfig.mScript) {\r\n                    return loadCombineScript(playerConfig, refPathParser)\r\n                } else {\r\n                    return loadScript(playerConfig, refPathParser);\r\n                }\r\n            });\r\n        } else {\r\n            return $.Deferred().resolve(playerConfig).promise();\r\n        }\r\n    },\r\n    loadCss: function (cssUrl) {\r\n        //如果定制播放器没有配置缺省样式,使用课件的样式\r\n        var _cssUrl = playerConfig.css || cssUrl;\r\n        //加载完释放内存\r\n        delete playerConfig.css;\r\n        domUtil.addStyle(_cssUrl);\r\n    },\r\n    getCommons: function (commons, createPageFn) {\r\n        for (var key in playerConfig.commons) {\r\n            var pageConfig = playerConfig.commons[key];\r\n            //为定制播放器的通用页设置id，方便状态恢复\r\n            pageConfig.id = pageConfig.id || 'common_' + key;\r\n            pageConfig.moduleGroupType = 'common';\r\n            commons.addItem(key, createPageFn(pageConfig));\r\n        }\r\n        return commons;\r\n    },\r\n    getScripts: function (jsLib) {\r\n        //如果定制播放器配置了脚本库，就使用定制播放器的脚本库版本\r\n        if (playerConfig.mScript) {\r\n            $.each(icCreatePlayer.jsLibConfig.allLib, function (key, commonJsLib) {\r\n                if (jsLib.name == commonJsLib.name) {\r\n                    jsLib.version = commonJsLib.version;\r\n                    jsLib.href = commonJsLib.href;\r\n                }\r\n            });\r\n        } else {\r\n            playerConfig.script.forEach(function (commonJsLib) {\r\n                if (jsLib.name == commonJsLib.name) {\r\n                    jsLib.version = commonJsLib.version;\r\n                    jsLib.href = commonJsLib.href;\r\n                }\r\n            });\r\n        }\r\n        return jsLib;\r\n    },\r\n    getPresenter: function (name) {\r\n        return playerConfig.presenters[name];\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.common.playerflow', function (exports,module,require,$) {\r\n'use strict';\r\nvar functionUtil = require('core.utils.function');\r\n\r\nvar runModuleMethod = function(name, args) {\r\n    var flowName = this.name;\r\n    var sourcePresenterUnqiueId = this.sourcePresenterUnqiueId;\r\n    var methodName = this[name] || name.replace(/^\\w/, function($0) {\r\n        return flowName + $0.toUpperCase();\r\n    });\r\n    var result = [];\r\n    if (sourcePresenterUnqiueId) {\r\n        this.player.eachPresenter(function(module) {\r\n            if (module.presenter.__model && sourcePresenterUnqiueId === module.presenter.__model.$.unqiueId) {\r\n                var _result = module.runInterface(methodName, args);\r\n                if (_result)\r\n                    result.push(_result);\r\n            }\r\n        }, this.scope);\r\n    } else {\r\n        this.player.eachPresenter(function(module) {\r\n            var _result = module.runInterface(methodName, args);\r\n            if (_result)\r\n                result.push(_result);\r\n        }, this.scope);\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function(config, name, player) {\r\n        $.extend(this, config);\r\n        this.name = name;\r\n        this.player = player;\r\n    },\r\n    start: function(flowData, scope, scb, fcb) {\r\n        if (scope) {\r\n            this.scope = scope;\r\n        }\r\n        var self = this,\r\n            runFlag = true;\r\n        flowData = flowData || {};\r\n        this.sourcePresenterUnqiueId = flowData.sourcePresenterUnqiueId;\r\n        functionUtil.runSequence([{\r\n            fn: self.initData,\r\n            args: [flowData],\r\n            scope: self\r\n        }, {\r\n            fn: function(_flowData) {\r\n                //initData为空时\r\n                flowData = _flowData || flowData;\r\n                var result = runModuleMethod.call(this, 'dataParse', flowData);\r\n                return $.when.apply(this, result).then(function() {\r\n                    return flowData;\r\n                });\r\n            },\r\n            scope: self\r\n        }, {\r\n            fn: function() {\r\n                var valid = self.validate(flowData);\r\n                if (!valid) {\r\n                    runFlag = false;\r\n                    runModuleMethod.call(self, 'fail', Array.prototype.slice.call(arguments, 0));\r\n                    if (fcb) fcb();\r\n                } else {\r\n                    return valid;\r\n                }\r\n            },\r\n            scope: self\r\n        }, {\r\n            fn: function(flowData) {\r\n                if (runFlag) {\r\n                    this.done(flowData, function() {\r\n                        runModuleMethod.call(self, 'success', Array.prototype.slice.call(arguments, 0));\r\n                        if (scb) scb();\r\n                    }, function() {\r\n                        runModuleMethod.call(self, 'fail', Array.prototype.slice.call(arguments, 0));\r\n                        if (fcb) fcb();\r\n                    });\r\n                }\r\n            },\r\n            scope: self\r\n        }], 'playerFlowStart');\r\n    }\r\n};\r\n}, 'class');\n__applicationContext.define('core.common.pptshellpaint', function (exports,module,require,$) {\r\n'use strict';\r\nvar pptshell = require('core.bridge.pptshell');\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function() {\r\n\r\n    },\r\n    draw: function() {\r\n\r\n    },\r\n    /**\r\n     * 重做\r\n     * @return {[void]} [description]\r\n     */\r\n    redo: function() {},\r\n    /**\r\n     * 撤消\r\n     * @return {[void]} [description]\r\n     */\r\n    undo: function() {},\r\n    /**\r\n     * 重置\r\n     * @return {void} [description]\r\n     */\r\n    reset: function() {},\r\n    /**\r\n     * 获取paint颜色与大小\r\n     * @return {Object} {\"color\" :\"#FF0000\",\"width\" :2}\r\n     */\r\n    getPaintSetting: function() {\r\n        return pptshell.paint.getPaintSetting();\r\n    },\r\n\r\n    /**\r\n     * 画线\r\n     * @param  {Object} start     起始点，格式如下：{\"x\":12,\"y\":34.5}\r\n     * @param  {Object} end       结束点，格式如下：{\"x\":12,\"y\":34.5}\r\n     * @param  {String} color     16进制的颜色值 如：#ff0000\r\n     * @param  {number} lineWidth 笔尖大小的int值，如：20\r\n     * @return {[void]}           [description]\r\n     */\r\n    drawLine: function(start, end, color, lineWidth) {\r\n        pptshell.paint.drawLine(start, end, color, lineWidth);\r\n    },\r\n    /**\r\n     * 画圆       \r\n     * @param  {Object} centre    圆心\r\n     * @param  {[type]} radius    半径\r\n     * @param  {[type]} sAngle    开始角（弧度）\r\n     * @param  {[type]} eAngle    结束角（弧度）\r\n     * @param  {[type]} color     颜色 不传值，默认是paint的当前setting的值\r\n     * @param  {[type]} lineWidth 大小 不传值，默认是paint的当前setting的值\r\n     * @param  {Boolean} isFill 是否启用填充\r\n     * @return {[type]}           [description]\r\n     */\r\n    drawCircle: function(centre, radius, sAngle, eAngle, counterclockwise, color, lineWidth, isFill) {\r\n        pptshell.paint.drawCircle(centre, radius, sAngle, eAngle, counterclockwise, color, lineWidth, isFill);\r\n    },\r\n\r\n    /**\r\n     * 设置颜色\r\n     * @param {string} color [颜色值]\r\n     */\r\n    setColor: function(color) {\r\n        this.color = color;\r\n        //pptshellPaint.setColor(color);\r\n    },\r\n    /**\r\n     * 设置画笔模式\r\n     * @param {string} mode pencil(画笔),eraser（橡皮檫）,filler（填冲）\r\n     */\r\n    setMode: function(mode) {\r\n        this.mode = mode;\r\n    },\r\n    /**\r\n     * 设置画笔大小\r\n     * @param {int} size 画笔大小\r\n     */\r\n    setSize: function(size) {\r\n        this.size = size;\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.common.printscreen', function (exports,module,require,$) {\r\n'use strict';\r\nvar run = false,\r\n\ttimer = null,\r\n\tdelay = 15000;\r\nvar thumbnailSave = function() {\r\n\tif (!run) {\r\n\t\trun = true;\r\n\t\tif (typeof(CoursePlayer) !== 'undefined' && CoursePlayer.thumbnailSave) CoursePlayer.thumbnailSave();\r\n\t}\r\n};\r\nmodule.exports = {\r\n\tprintScreen: function(eventBus) {\r\n\t\teventBus.addEventListener('PLAYER.PRINTSCREEN', function() {\r\n\t\t\t//由于pptshell的绘制机，这里给个500 delay\r\n\t\t\ttimer = window.setTimeout(function() {\r\n\t\t\t\tthumbnailSave();\r\n\t\t\t\twindow.clearTimeout(timer);\r\n\t\t\t}, 500);\r\n\t\t});\r\n\t\t//兼容处理没回调事件，做的timeout 3500\r\n\t\ttimer = window.setTimeout(function() {\r\n\t\t\tthumbnailSave();\r\n\t\t\twindow.clearTimeout(timer);\r\n\t\t}, delay);\r\n\t}\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.common.refpathbuilder', function (exports,module,require,$) {\r\n'use strict';\r\nvar urlUtil = require('core.utils.url');\r\nvar stringUtils = require(\"core.utils.string\");\r\n\r\nvar createRefPath = function (refPath, baseUrl) {\r\n    var newRefPath = {};\r\n    for (var key in refPath) {\r\n        newRefPath[key] = urlUtil.resolve(baseUrl, refPath[key]);\r\n    }\r\n    return newRefPath;\r\n};\r\n\r\nvar createRefPathParser = function (refPath, baseUrl) {\r\n    refPath = createRefPath(refPath, baseUrl);\r\n    return {\r\n        parse: function (text) {\r\n            return stringUtils.applyTemplate(text, refPath);\r\n        },\r\n        getRefPath: function () {\r\n            return refPath;\r\n        }\r\n    };\r\n};\r\n\r\nmodule.exports = {\r\n    'build': function (refPath, coursewareUrl) {\r\n        refPath['ref-path-addon'] = refPath['ref-path-addon'] || refPath['ref-path'];\r\n        //单独播放一页的时候\r\n        var coursewareRefPath = refPath;\r\n        if (!coursewareUrl && refPath[\"ref-path-online\"]) {\r\n            coursewareRefPath = {\r\n                'ref-path': refPath[\"ref-path-online\"],\r\n                'ref-path-addon': refPath['ref-path-addon']\r\n            };\r\n        }\r\n        return {\r\n            //课件的refPath根据课件的main.xml来获取\r\n            'courseware': createRefPathParser(coursewareRefPath, urlUtil.getBase(coursewareUrl)),\r\n            //定制播放器的refPath根据index的地址来获取\r\n            'playerConfig': createRefPathParser(refPath, urlUtil.getBaseLocationUrl())\r\n        };\r\n    },\r\n    'set': function (player, key, url) {\r\n        player.refPathParser[key] = createRefPathParser(player.refPath, urlUtil.getBase(url));\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.common.runtime', function (exports,module,require,$) {\r\n'use strict';\r\nvar request = require('core.utils.request');\r\n\r\nvar runtime = {\r\n    'TEACHER_MOBILE': 'TeacherMobile',\r\n    'STUDENT_MOBILE': 'StudentMobile',\r\n    'PROJECTION_MOBILE': 'ProjectionMobile',\r\n    'WEB': 'Web',\r\n    'TEACHER_PC': 'TeacherPc',\r\n    'STUDENT_PC': 'StudentPc'\r\n};\r\nvar runtimeMapping = {\r\n    'mobile': {\r\n        'teacher': runtime.TEACHER_MOBILE,\r\n        'student': runtime.STUDENT_MOBILE,\r\n        'projection': runtime.PROJECTION_MOBILE,\r\n        '__default__': runtime.TEACHER_MOBILE\r\n    },\r\n    'pc': {\r\n        'teacher': runtime.TEACHER_PC,\r\n        'student': runtime.STUDENT_PC,\r\n        '__default__': runtime.TEACHER_PC\r\n    }\r\n};\r\nmodule.exports = {\r\n    'RUNTIME': runtime,\r\n    'getRuntime': function () {\r\n        var bridge = window.Bridge;\r\n        var terminal = request('terminal');\r\n        var result;\r\n        if (bridge && $.isFunction(bridge.getRuntime)) {\r\n            result = runtimeMapping[bridge.getRuntime().toLowerCase()];\r\n            if (typeof result === \"object\") {\r\n                result = result[terminal.toLowerCase()] || result.__default__;\r\n            }\r\n        }\r\n        return result || runtime.WEB;\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.common.timer', function (exports,module,require,$) {\r\n'use strict';\r\nvar timeObject = '.tooldialog_com_header_time';\r\nvar miuteObject = '.tooldialog_com_header_time .tooldialog_time_m em';\r\nvar secondObject = '.tooldialog_com_header_time .tooldialog_time_s em';\r\nvar miute = 0,\r\n\tsecond = 0,\r\n\tinterval;\r\n\r\nfunction pre(v) {\r\n\treturn (v + '').length < 2 ? ('0' + v) : v;\r\n}\r\n\r\nmodule.exports = {\r\n\t//这是从外面调用的。不能自己启\r\n\t'start': function(tool) {\r\n\t\tclearInterval(interval);\r\n\t\ttool.element.find(timeObject).show();\r\n\t\ttool.element.find(miuteObject).html(pre(miute));\r\n\t\ttool.element.find(secondObject).html(pre(second));\r\n\t\tinterval = setInterval(function() {\r\n\t\t\tif (second === 59) {\r\n\t\t\t\tmiute++;\r\n\t\t\t\tsecond = 0;\r\n\t\t\t} else {\r\n\t\t\t\tsecond++;\r\n\t\t\t}\r\n\t\t\ttool.element.find(miuteObject).html(pre(miute));\r\n\t\t\ttool.element.find(secondObject).html(pre(second));\r\n\t\t}, 1000);\r\n\r\n\t},\r\n\t'stop': function() {\r\n\t\twindow.clearInterval(interval);\r\n\t},\r\n\r\n\t'reset': function(tool) {\r\n\t\tmiute = second = 0;\r\n\t\twindow.clearInterval(interval);\r\n\t\ttool.element.find(timeObject).hide();\r\n\t\ttool.element.find(miuteObject).html(pre(miute));\r\n\t\ttool.element.find(secondObject).html(pre(second));\r\n\t},\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.exception.playerexception', function (exports,module,require,$) {\r\n'use strict';\r\nvar logger = require(\"core.utils.log\");\r\nvar stringUtil = require('core.utils.string');\r\nvar errorMessageTemplate = '${id}@${className} error:';\r\nmodule.exports = {\r\n    create: function (message, throwable, type) {\r\n        var e = new Error(\"player 11.7.3: \" + message);\r\n        e.cause = throwable;\r\n        e.errorType = type || \"playerException\";\r\n        return e;\r\n    },\r\n    execute: function (e, component) {\r\n        logger.error(stringUtil.applyTemplate(errorMessageTemplate, component), e);\r\n        component.fireEvent(\"error\", e);\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.eventbus.eventbus', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = \"class\";\r\n\r\nvar callListener = function (listener, args) {\r\n    listener.callback.apply(listener.scope || window, args.concat(listener.args));\r\n};\r\n\r\nmodule.exports = {\r\n    constructor: function () {\r\n        this.listeners = {};\r\n    },\r\n    /**\r\n     * 注册事件\r\n     * @param {string}  事件类型\r\n     * @param {Function} 事件\r\n     * @param {Object} scope\r\n     */\r\n    addEventListener: function (type, callback, scope) {\r\n        if (callback) {\r\n            var selector, argsLength;\r\n            if ($.isFunction(callback)) {\r\n                argsLength = 3;\r\n            } else if (callback) {\r\n                argsLength = 2;\r\n                scope = callback.scope;\r\n                if (callback.selector) {\r\n                    selector = ($.isArray(callback.selector)) ? callback.selector : [callback.selector];\r\n                }\r\n                callback = callback.fn;\r\n            }\r\n            if ($.isFunction(callback)) {\r\n                var args = arguments.length > argsLength ? Array.prototype.slice.call(arguments, argsLength) : [];\r\n                var listeners = this.listeners[type] || (this.listeners[type] = []);\r\n                listeners.push({\r\n                    scope: scope,\r\n                    callback: callback,\r\n                    selector: selector,\r\n                    args: args\r\n                });\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * 移除事件\r\n     * @param {string}  事件类型\r\n     * @param {Function} 事件\r\n     * @param {Object} scope\r\n     */\r\n    removeEventListener: function (type, callback, scope) {\r\n        if (typeof this.listeners[type] != \"undefined\") {\r\n            var numOfCallbacks = this.listeners[type].length;\r\n            var newArray = [];\r\n            for (var i = 0; i < numOfCallbacks; i++) {\r\n                var listener = this.listeners[type][i];\r\n                if (!(listener.scope == scope && listener.callback == callback)) {\r\n                    newArray.push(listener);\r\n                }\r\n            }\r\n            this.listeners[type] = newArray;\r\n        }\r\n    },\r\n    /**\r\n     * 判断事件是否存在\r\n     * @param {string}  事件类型\r\n     * @param {Function} 事件\r\n     * @param {Object} scope\r\n     * @returns {boolean}\r\n     */\r\n    hasEventListener: function (type, callback, scope) {\r\n        if (typeof this.listeners[type] != \"undefined\") {\r\n            var numOfCallbacks = this.listeners[type].length;\r\n            if (callback === undefined && scope === undefined) {\r\n                return numOfCallbacks > 0;\r\n            }\r\n            for (var i = 0; i < numOfCallbacks; i++) {\r\n                var listener = this.listeners[type][i];\r\n                if ((scope ? listener.scope == scope : true) && listener.callback == callback) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n    /**\r\n     * 委派事件\r\n     * @param {string} 事件类型\r\n     * @param {Object} target\r\n     */\r\n    dispatch: function (type) {\r\n        var args = arguments.length > 1 ? Array.prototype.slice.call(arguments, 1) : [];\r\n        //兼容之前gwt颁布的事件调用格式\r\n        args = [type].concat(args);\r\n        var targetEl;\r\n        var isFirefox = navigator.userAgent.indexOf(\"Firefox\") > 0;\r\n        if (isFirefox)\r\n            window.event = arguments[1] || null;\r\n        if (window.event) {\r\n            targetEl = event.srcElement || event.target;\r\n        }\r\n        if (this.listeners && this.listeners[type]) {\r\n            this.listeners[type].forEach(function (listener) {\r\n                //如果有设置selector\r\n                if (listener.selector && targetEl) {\r\n                    targetEl = $(targetEl);\r\n                    listener.selector.forEach(function (value) {\r\n                        if (targetEl.closest(value).length) {\r\n                            callListener(listener, args.concat([value, targetEl]));\r\n                        }\r\n                    });\r\n                } else {\r\n                    callListener(listener, args);\r\n                }\r\n            });\r\n        }\r\n    },\r\n    /**\r\n     * 查看当前所有监听的事件\r\n     * @returns {string}\r\n     */\r\n    getEvents: function () {\r\n        var str = \"\";\r\n        for (var type in this.listeners) {\r\n            var numOfCallbacks = this.listeners[type].length;\r\n            for (var i = 0; i < numOfCallbacks; i++) {\r\n                var listener = this.listeners[type][i];\r\n                str += listener.scope && listener.scope.className ? listener.scope.className : \"anonymous\";\r\n                str += \" listen for '\" + type + \"'\\n\";\r\n            }\r\n        }\r\n        return str;\r\n    }\r\n};\r\n}, 'class');\n__applicationContext.define('core.eventbus.eventname', function (exports,module,require,$) {\r\n'use strict';\r\nvar eventName = {\r\n    tool: {\r\n        maximize: 'PLAYER.TOOL.MAXIMIZE',\r\n        minimize: 'PLAYER.TOOL.MINIMIZE',\r\n        finish: 'PLAYER.TOOL.FINISH',\r\n        close: 'PLAYER.TOOL.CLOSE',\r\n        push_action: 'PLAYER.TOOL.PUSH_ACTION',\r\n        push_data: \"PLAYER.TOOL.PUSH_DATA\",\r\n        adjust_layout: \"PLAYER.TOOL.ADJUST_LAYOUT\",\r\n        layout_resize: \"PLAYER.TOOL.LAYOUT_RESIZE\",\r\n        forbide_full: \"PLAYER.TOOL.FORBIDE_FULL\"\r\n    },\r\n    play:{\r\n        push_status:\"PLAYER.GLOBAL.PUSH_STATUS\"\r\n    }\r\n};\r\nmodule.exports = eventName;\r\n\r\n}, '');\n__applicationContext.define('core.layout.layout', function (exports,module,require,$) {\r\n'use strict';\r\nvar configAttrName = ['width', 'height', 'top', 'right', 'bottom', 'left'];\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    static: {\r\n        attrName: configAttrName,\r\n        createLayoutConfig: function(config, pushAttrName) {\r\n            var layoutConfig = {};\r\n            var value;\r\n            if (pushAttrName) {\r\n                pushAttrName.forEach(function(name) {\r\n                    if ($.inArray(name, configAttrName) < 0) {\r\n                        configAttrName.push(name);\r\n                    }\r\n                });\r\n            }\r\n            configAttrName.forEach(function(name) {\r\n                value = config[name];\r\n                if (value) {\r\n                    layoutConfig[name] = ($.isNumeric(value)) ? parseInt(value, 10) : value;\r\n                }\r\n            });\r\n            return layoutConfig;\r\n        }\r\n    },\r\n    constructor: function(component) {\r\n        this.component = component;\r\n    },\r\n    zIndex: 300,\r\n    getZIndex: function() {\r\n        return this.zIndex++;\r\n    }\r\n};\r\n}, 'class');\n__applicationContext.define('core.layout.pageabsolutelayout', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: \"core.layout.Layout\",\r\n    render: function (target) {\r\n        var me = this;\r\n        this.$layoutTarget = target;\r\n        if (me.$layoutTarget.css('position') === 'static') {\r\n            $(me.$layoutTarget).css('position', 'relative');\r\n        }\r\n        var itemPromises = [];\r\n        me.component.items.forEach(function (module) {\r\n            itemPromises.push(me.addModule(module));\r\n        });\r\n        return $.when.apply($, itemPromises);\r\n    },\r\n    addModule: function (module) {\r\n        var zindex = module.getZIndex() || this.getZIndex();\r\n        return module.render(this.$layoutTarget).then(function (module) {\r\n            module.getElement(true).css({'position': 'absolute', 'z-index': zindex});\r\n        }, function () {\r\n            //一个module渲染失败,继续渲染其它\r\n            return $.Deferred().resolve();\r\n        });\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.layout.playerdivlayout', function (exports,module,require,$) {\r\n'use strict';\r\nvar stringUtil = require('core.utils.string'),\r\n    Layout = require('core.layout.Layout'),\r\n    When = require('core.utils.when'),\r\n    logger = require('core.utils.log'),\r\n    stringUtil = require('core.utils.string'),\r\n    toolLayout = require('core.common.layout.tool');\r\nvar urlUtil = require('core.utils.url');\r\nvar commonPageTemplate = '<div class=\"ic_${name}_panel ic_common_panel\" style=\"z-index: ${zIndex}\"></div>';\r\nvar pagePanelTemplate = '<div class=\"ic_page_panel\" style=\"z-index: ${zIndex}\"></div>';\r\n\r\n//公用页渲染配置\r\nvar commonPageRenderConfig = {\r\n    'horizontal': {\r\n        sizeName: 'height',\r\n        group: [{\r\n            name: ['header', 'toolbar'],\r\n            layout: 'top'\r\n        }, {\r\n            name: ['footer'],\r\n            layout: 'bottom'\r\n        }]\r\n    },\r\n    'vertical': {\r\n        sizeName: 'width',\r\n        group: [{\r\n            name: ['left'],\r\n            layout: 'left'\r\n        }, {\r\n            name: ['right'],\r\n            layout: 'right'\r\n        }]\r\n    }\r\n};\r\n//渲染公用页(top,right,bottom,left)\r\nvar commonPageRender = function (type) {\r\n    var me = this;\r\n    var commonPages = me.component.commonPages;\r\n    var config = commonPageRenderConfig[type];\r\n    var $parent = config.$target;\r\n    var groupLoads = [];\r\n    //按照分组渲染\r\n    config.group.forEach(function (groupConfig) {\r\n        var pageLoads = [];\r\n        var pages = commonPages.getItems(groupConfig.name);\r\n        if (pages && pages.length) {\r\n            //渲染页面外围结构\r\n            var $commonPagePanel = $(stringUtil.applyTemplate(commonPageTemplate, {\r\n                'name': groupConfig.layout,\r\n                'zIndex': me.getZIndex()\r\n            }));\r\n            var when = new When(pages.length, function (results) {\r\n                var sumSize = 0;\r\n                results.forEach(function (size) {\r\n                    sumSize += size;\r\n                });\r\n                $parent.css('padding-' + groupConfig.layout, sumSize);\r\n                $commonPagePanel.css(config.sizeName, sumSize);\r\n            });\r\n            //渲染页面\r\n            pages.forEach(function (page) {\r\n                page.addEventListener('renderModel', function (_name, model) {\r\n                    var layout = Layout.createLayoutConfig(model.getAttribute('layout'));\r\n                    var size = layout[config.sizeName];\r\n                    $(page.getElement()).css(config.sizeName, size);\r\n                    when.each(size);\r\n                });\r\n                pageLoads.push(page.render($commonPagePanel));\r\n            });\r\n            //渲染完毕再加入dom树\r\n            groupLoads.push($.when.apply($, pageLoads).done(function () {\r\n                $parent.append($commonPagePanel);\r\n            }));\r\n        }\r\n    });\r\n    return groupLoads;\r\n};\r\n\r\nvar commonPageShow = function (type, isVisible) {\r\n    var me = this;\r\n    var commonPages = me.component.commonPages;\r\n    var config = commonPageRenderConfig[type];\r\n    var classTemplate = \".ic_common_panel.ic_${name}_panel\";\r\n    //按照分组隐藏\r\n    config.group.forEach(function (groupConfig) {\r\n        var pages = commonPages.getItems(groupConfig.name);\r\n        if (pages && pages.length) {\r\n            //渲染页面外围结构\r\n            var $classhandler = $(stringUtil.applyTemplate(classTemplate, {\r\n                'name': groupConfig.layout\r\n            }));\r\n            if (isVisible) {\r\n                $classhandler.show();\r\n            } else {\r\n                $classhandler.hide();\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nvar mainRender = function ($parent) {\r\n    var me = this;\r\n    var $mainLayout = $(stringUtil.applyTemplate(pagePanelTemplate, {\r\n        'zIndex': me.getZIndex()\r\n    }));\r\n    $parent.append($mainLayout);\r\n    return $mainLayout;\r\n};\r\n\r\nvar events = require('core.common.layout.events');\r\nvar downEvents = events.downEvents,\r\n    moveEvents = events.moveEvents,\r\n    upEvents = events.upEvents,\r\n    clickEvents = events.clickEvents,\r\n    pageLeaveEvents = events.pageLeaveEvents,\r\n    isMouse = false;\r\n\r\nvar addPageEvent = (function () {\r\n    var isMove = false;\r\n    var downTime, downX, downY;\r\n    return function () {\r\n        var me = this;\r\n        downEvents.forEach(function (eventName) {\r\n            var fn = function (e) {\r\n                var event = $.event.fix(e);\r\n                isMove = true;\r\n                downTime = new Date();\r\n                downX = event.type.indexOf('touch') < 0 ? event.pageX : event.originalEvent.touches[0].pageX;\r\n                downY = event.type.indexOf('touch') < 0 ? event.pageY : event.originalEvent.touches[0].pageY;\r\n                me.component.activePage.fireEvent('mousedown', event);\r\n            };\r\n            if (me.pageTarget[0].addEventListener) {\r\n                me.pageTarget[0].addEventListener(eventName, fn);\r\n            } else {\r\n                me.pageTarget[0].attachEvent(eventName, fn);\r\n            }\r\n        });\r\n        moveEvents.forEach(function (eventName) {\r\n            var fn = function () {\r\n                if (isMove) {\r\n                    me.component.activePage.fireEvent('mousemove', event);\r\n                }\r\n            };\r\n            if (me.pageTarget[0].addEventListener) {\r\n                me.pageTarget[0].addEventListener(eventName, fn);\r\n            } else {\r\n                me.pageTarget[0].attachEvent(eventName, fn);\r\n            }\r\n        });\r\n        upEvents.forEach(function (eventName) {\r\n            var fn = function (e) {\r\n                var event = $.event.fix(e);\r\n                isMove = false;\r\n                me.component.activePage.fireEvent('mouseup', event);\r\n                var t = new Date() - downTime;\r\n                var x = Math.abs((event.pageX === undefined ? event.originalEvent.changedTouches[0].pageX : event.pageX) - downX);\r\n                var y = Math.abs((event.pageY === undefined ? event.originalEvent.changedTouches[0].pageY : event.pageY) - downY);\r\n                if (t < 180 && x < 3 && y < 3) {\r\n                    me.component.activePage.fireEvent('click', event);\r\n                }\r\n            };\r\n            if (me.pageTarget[0].addEventListener) {\r\n                me.pageTarget[0].addEventListener(eventName, fn);\r\n            } else {\r\n                me.pageTarget[0].attachEvent(eventName, fn);\r\n            }\r\n        });\r\n        pageLeaveEvents.forEach(function (eventName) {\r\n            var fn = function () {\r\n                me.component.activePage.fireEvent('pageLeave', event);\r\n            };\r\n            if (me.pageTarget[0].addEventListener) {\r\n                me.pageTarget[0].addEventListener(eventName, fn);\r\n            } else {\r\n                me.pageTarget[0].attachEvent(eventName, fn);\r\n            }\r\n        });\r\n    };\r\n})();\r\nvar fontSizeCreater = function () {\r\n    if (this.component.adaptFlag || this.component.adaptFlag == undefined) {\r\n        icCreatePlayer.fontSize = icCreatePlayer.utils.getFontSize();\r\n        if(icCreatePlayer.fontSize > 0){\r\n           this.component.container.css('font-size', icCreatePlayer.fontSize + 'px');\r\n        }\r\n    }\r\n    if(icCreatePlayer.fontSize != 0){\r\n       //只执行一次\r\n       fontSizeCreater = function () {}\r\n    }\r\n};\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: \"core.layout.Layout\",\r\n    constructor: function (component) {\r\n        require(\"core.layout.playerDivLayout\").prototype.superClass.constructor.call(this, component);\r\n        this.renderAllCommonPage = function () {\r\n            var me = this;\r\n            //第一次真正渲染通用页，第二次直接调用pageChange接口,不重复渲染\r\n            var promises = [];\r\n            for (var key in commonPageRenderConfig) {\r\n                promises = promises.concat(commonPageRender.call(me, key));\r\n            }\r\n            this.renderAllCommonPage = function () {\r\n                me.component.commonPages.forEach(function (page) {\r\n                    logger.log('page.pageChange');\r\n                    page.pageChange();\r\n                });\r\n            };\r\n            return $.when.apply($, promises);\r\n        };\r\n    },\r\n    render: function (target) {\r\n        commonPageRenderConfig.horizontal.$target = target;\r\n        commonPageRenderConfig.vertical.$target = mainRender.call(this, target);\r\n        this.pageTarget = mainRender.call(this, commonPageRenderConfig.vertical.$target);\r\n        addPageEvent.call(this);\r\n        this.pageTarget.addClass('ic_main_page_panel');\r\n\r\n        return this.renderPage();\r\n    },\r\n    renderPage: function () {\r\n        var me = this;\r\n        fontSizeCreater.call(me);\r\n        this.component.waitDialog.show();\r\n        this.component.activePage.addEventListener('afterLayout', function () {\r\n            me.component.waitDialog.hide();\r\n        });\r\n        var baseUrl = urlUtil.getBase(this.component.activePage.url);\r\n        icCreatePlayer['ref_base'] = baseUrl.replace(/\\/$/, '')\r\n        return this.component.activePage.render(this.pageTarget)\r\n            .then(function () {\r\n                console.log('activePage render finished');\r\n                return me.renderAllCommonPage();\r\n            })\r\n            .done(function () {\r\n                console.log('activePage PageLoaded');\r\n                me.component.fireEvent('PageLoaded');\r\n            });\r\n    },\r\n    activePage: function () {\r\n        if (this.$toolTarget){\r\n            this.$toolTarget.removeClass('ic_paint_active');\r\n            this.$toolTarget.css(\"display\",\"none\");\r\n        }\r\n    },\r\n    renderTool: function () {\r\n        return toolLayout.renderTool.apply(this);\r\n    },\r\n    activeTool: function (tool) {\r\n        toolLayout.activeTool.apply(this,[tool]);\r\n    },\r\n    addTool: function (tool) {\r\n        return toolLayout.addTool.apply(this, [tool]);\r\n    },\r\n    setToolZIndex: function (tool) {\r\n        toolLayout.setToolZIndex.apply(this, [tool]);\r\n    },\r\n    isLargeZIndex: function (tool) {\r\n        return toolLayout.isLargeZIndex.apply(this, [tool]);\r\n    },\r\n    /**\r\n     * 激活某一tool\r\n     * @param  {[type]} tool [description]\r\n     * @return {[type]}      [description]\r\n     */\r\n    fireTool: function (tool) {\r\n        toolLayout.fireTool.apply(this, [tool]);\r\n    },\r\n    /**\r\n     * 最小化TOOL\r\n     * @param  {[type]} tool [description]\r\n     * @return {[type]}      [description]\r\n     */\r\n    minTool: function (event, tool) {\r\n        toolLayout.minTool.apply(this, [event, tool]);\r\n    },\r\n    /**\r\n     * 关闭通用页开关\r\n     * @param name\r\n     * @param isVisible\r\n     */\r\n    switchCommonPage: function (name, isVisible) {\r\n        var me = this;\r\n        for (var key in commonPageRenderConfig) {\r\n            commonPageShow.call(me, key, isVisible);\r\n        }\r\n    }\r\n\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.loader.jslibloadercreator', function (exports,module,require,$) {\r\n'use strict';\r\nvar Loader = require('core.loader.Loader');\r\nvar modelCreator = require('core.model.modelCreator');\r\nvar stringUtils = require('core.utils.string');\r\nvar packageParser = require('core.model.parser.simpleJsonParser');\r\nvar urlUtil = require('core.utils.url');\r\nvar domUtil = require('core.utils.dom');\r\nvar functionUtil = require('core.utils.function');\r\n\r\nvar packageUrlTemplate = '${ref-path-addon}/js-library/${name}/${version}/package.json';\r\nmodule.exports = {\r\n    'create': function () {\r\n        var me = this;\r\n        var getKey = function (item) {\r\n            return item.name;\r\n        };\r\n\r\n        var importJs = function (model, baseurl) {\r\n            var loadJsList = [];\r\n            if (model.script && model.script.length > 0)\r\n                model.script.forEach(function (jsUrl) {\r\n                    jsUrl = urlUtil.resolve(baseurl, jsUrl);\r\n                    if (model.releaseNum) {\r\n                        jsUrl += \"?releaseNum=\" + model.releaseNum\r\n                    }\r\n                    loadJsList.push({\r\n                        fn: domUtil.addScript,\r\n                        args: [jsUrl]\r\n                    });\r\n                });\r\n            return functionUtil.runSequence(loadJsList, 'load js');\r\n        };\r\n\r\n        var importCss = function (model, baseurl) {\r\n            model.css.forEach(function (cssUrl) {\r\n                cssUrl = urlUtil.resolve(baseurl, cssUrl);\r\n                if (model.releaseNum) {\r\n                    cssUrl += \"?releaseNum=\" + model.releaseNum\r\n                }\r\n                domUtil.addStyle(cssUrl);\r\n            });\r\n        };\r\n\r\n        //todo:需要考虑循环依赖\r\n        var importDependencies = function (model, refPathParser) {\r\n            return me.create().load(refPathParser, model.dependencies);\r\n        };\r\n\r\n        var createLoadPromise = function (item, key, refPathParser) {\r\n            var deferred = $.Deferred();\r\n            item = require('core.common.playerConfig').getScripts(item);\r\n            //兼容是否压缩\r\n            if (!$.isEmptyObject(icCreatePlayer.jsLibConfig)) {\r\n                var result = {}\r\n                var autoData = icCreatePlayer.jsLibConfig.auto\r\n                var notautoData = icCreatePlayer.jsLibConfig.notauto\r\n                if (!$.isEmptyObject(autoData) && autoData.model && autoData.model[key]) {\r\n                    result.model = autoData.model[key]\r\n                    result.baseUrl = autoData.baseUrl\r\n                } else if (!$.isEmptyObject(notautoData) && notautoData.model && notautoData.model[key]) {\r\n                    result.model = notautoData.model[key]\r\n                    result.baseUrl = notautoData.baseUrl\r\n                }\r\n                if (result.model && result.baseUrl) {\r\n                    importCss(result.model, result.baseUrl)\r\n                    importDependencies(result.model, refPathParser)\r\n                        .then(functionUtil.createPromiseThen(deferred, importJs, [result.model, result.baseUrl]))\r\n                        .done(function () {\r\n                            deferred.resolve()\r\n                        })\r\n                } else {\r\n                    deferred.reject()\r\n                }\r\n            }\r\n            else {\r\n                var url = item.href || stringUtils.applyTemplate(packageUrlTemplate, $.extend(item, refPathParser.getRefPath()));\r\n                modelCreator.create({\r\n                    url: url,\r\n                    parser: packageParser\r\n                }).then(function (result) {\r\n                    //加载js库的样式\r\n                    importCss(result.model, result.baseUrl);\r\n                    return result;\r\n                }).then(function (result) {\r\n                    //加载js依赖库,然后再加载自身\r\n                    return importDependencies(result.model, refPathParser)\r\n                        .then(functionUtil.createPromiseThen(deferred, importJs, [result.model, result.baseUrl]));\r\n                }).done(function () {\r\n                    deferred.resolve();\r\n                });\r\n            }\r\n\r\n            //避免内存占用\r\n            return deferred.promise();\r\n        };\r\n        var loader = new Loader(getKey, createLoadPromise);\r\n        //惰性函数只创建一次\r\n        this.create = function () {\r\n            return loader;\r\n        };\r\n        return this.create();\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.loader.loader', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function (getKey, createLoadPromise) {\r\n        //缓存加载过loader\r\n        this.promises = {};\r\n        //获取loader的key\r\n        this.getKey = getKey;\r\n        //创建loader的promise\r\n        this.createLoadPromise = createLoadPromise;\r\n    },\r\n    load: function (loadConfig, loaders) {\r\n        //参数调整，loaders支持数组传入或者多参数传入\r\n        var loaderList = ($.isArray(loaders)) ? loaders : Array.prototype.slice.call(arguments, 1);\r\n        var me = this;\r\n        var _promises = [];\r\n        loaderList.forEach(function (item) {\r\n            //依次载入loader\r\n            var key = me.getKey(item);\r\n            //如果已经加载过loader就不再加载\r\n            var _promise = me.promises[key] || (me.promises[key] = me.createLoadPromise(item, key, loadConfig));\r\n            _promises.push(_promise);\r\n        });\r\n        return $.when.apply($, _promises);\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.loader.packageloadercreator', function (exports,module,require,$) {\r\n'use strict';\r\nvar Loader = require('core.loader.Loader');\r\nvar modelCreator = require('core.model.modelCreator');\r\nvar simpleJsonParser = require('core.model.parser.simpleJsonParser');\r\nvar domUtil = require('core.utils.dom');\r\nmodule.exports = {\r\n    'create': function () {\r\n        var getKey = function (item) {\r\n            return item;\r\n        };\r\n\r\n        var createLoadPromise = function (item, key, refPathParser) {\r\n            return modelCreator.create({\r\n                url: item,\r\n                parser: simpleJsonParser,\r\n                textParsers: refPathParser\r\n            }).done(function (result) {\r\n                if (result.model.css) {\r\n                    domUtil.addStyleContent(result.model.css);\r\n                }\r\n            });\r\n        };\r\n\r\n        var loader = new Loader(getKey, createLoadPromise);\r\n        this.create = function () {\r\n            return loader;\r\n        };\r\n        return this.create();\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.loader.presenterloadercreator', function (exports,module,require,$) {\r\n'use strict';\r\nvar Loader = require('core.loader.Loader');\r\nvar domUtils = require('core.utils.dom');\r\nvar stringUtils = require('core.utils.string');\r\nvar modelCreator = require('core.model.modelCreator');\r\nvar presenterXmlParser = require('core.model.parser.presenterXmlParser');\r\nvar jsLibLoaderCreator = require('core.loader.jsLibLoaderCreator');\r\nvar functionUtil = require('core.utils.function');\r\nvar PresenterModel = require('core.model.PresenterModel');\r\n\r\nvar scriptReg = /^\\s*function(\\s+\\w+)?\\s*\\(.*?\\)/i;\r\nvar cssReg = /url\\s*\\(\\s*(['\"]?)(resources[\\\\/].*?)\\1\\s*\\)/ig;\r\nvar scriptTemplate = '//# sourceURL=ndplayer-${type}\\r\\n${script}';\r\nvar createFnTemplate = 'Addon${type}_create';\r\nvar defineFnTemplate = 'function ${createFnName}()';\r\nvar cssUrlTemplate = 'url(\"${base}${name}\")';\r\n\r\nvar jsLibLoader = jsLibLoaderCreator.create();\r\nvar packageLoader = require('core.loader.packageLoaderCreator').create();\r\n//记录打包合并载入的js\r\nvar loadPresenters = {};\r\n\r\nvar parseScript = function (result, type) {\r\n    var model = result.model;\r\n    var script = model.removeAttribute('script');\r\n    model.createFnName = stringUtils.applyTemplate(createFnTemplate, {'type': type});\r\n    if (script) {\r\n        script = script.replace(scriptReg, stringUtils.applyTemplate(defineFnTemplate, model));\r\n        domUtils.addScriptContent(stringUtils.applyTemplate(scriptTemplate, {'type': type, 'script': script}));\r\n    }\r\n};\r\n\r\nvar parseJsDependence = function (model, refPath) {\r\n    var jsDependencyList = model.removeAttribute('jsDependency');\r\n    return jsLibLoader.load(refPath, jsDependencyList);\r\n};\r\n\r\nvar parseCss = function (result, type) {\r\n    var model = result.model;\r\n    var baseUrl = result.baseUrl;\r\n    var css = model.removeAttribute('css');\r\n    if (css) {\r\n        domUtils.addStyleContent(css.replace(cssReg, function ($0, $1, $2) {\r\n            return stringUtils.applyTemplate(cssUrlTemplate, {base: baseUrl, name: $2});\r\n        }));\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    'create': function () {\r\n        var getKey = function (item) {\r\n            return item.presenterId;\r\n        };\r\n\r\n        var createLoadPromise = function (item, key, refPathParser) {\r\n            var deferred = $.Deferred();\r\n            var loadResult;\r\n\r\n            //打包后的结果\r\n            if (item.data) {\r\n                packageLoader.load(refPathParser, item.data).done(function (packageConfig) {\r\n                    var item = packageConfig.model.presenters[key];\r\n                    var url = item.presenter;\r\n\r\n                    var model = new PresenterModel();\r\n                    model.setAttributes(item.dependencies);\r\n                    model.setAttribute('view', item.view);\r\n                    model.setAttribute('css', item.css);\r\n\r\n                    loadResult = {model: model, baseUrl: item.base};\r\n                    parseJsDependence(model, refPathParser).then(\r\n                        function () {\r\n                            return loadPresenters[url] || (loadPresenters[url] = domUtils.addScript(url));\r\n                        }\r\n                    ).then(function () {\r\n                        parseScript(loadResult, key);\r\n                        parseCss(loadResult, key);\r\n                        deferred.resolve(loadResult);\r\n                    });\r\n                });\r\n            } else {\r\n                modelCreator.create({\r\n                    url: item.url || item.href,\r\n                    textParsers: refPathParser,\r\n                    parser: presenterXmlParser\r\n                }).then(functionUtil.createPromiseThen(deferred, function (result) {\r\n                    loadResult = result;\r\n                    return parseJsDependence(result.model, refPathParser);\r\n                })).then(functionUtil.createPromiseThen(deferred, function () {\r\n                    parseScript(loadResult, key);\r\n                    parseCss(loadResult, key);\r\n                    deferred.resolve(loadResult);\r\n                }));\r\n            }\r\n\r\n\r\n            //防止闭包内存泄漏\r\n            return deferred.promise();\r\n        };\r\n\r\n        var loader = new Loader(getKey, createLoadPromise);\r\n        this.create = function () {\r\n            return loader;\r\n        };\r\n        return this.create();\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.model.collection', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function (indexNames) {\r\n        this.items = [];\r\n        this.map = {};\r\n        this.length = 0;\r\n        if (indexNames) {\r\n            this.indexNames = ($.isArray(indexNames)) ? indexNames : [indexNames];\r\n        }\r\n        this.indexMap = {};\r\n    },\r\n    indexNames: [],\r\n    add: function (key, item) {\r\n        //参数修正\r\n        if (arguments.length === 1) {\r\n            item = key;\r\n            key = '';\r\n        }\r\n        this.items.push(item);\r\n        this.map[key || this.length] = this.length;\r\n        var me = this;\r\n        this.indexNames.forEach(function (indexKey) {\r\n            var _map = me.indexMap[indexKey] || (me.indexMap[indexKey] = {});\r\n            _map[item[indexKey]] = me.length;\r\n        });\r\n        this.length++;\r\n    },\r\n    'getByIndex': function (index) {\r\n        return this.items[index];\r\n    },\r\n    'getByKey': function (key) {\r\n        return this.items[this.map[key]];\r\n    },\r\n    'find': function (indexName, key) {\r\n        return this.items[this.indexMap[indexName][key]];\r\n    },\r\n    indexOf: function (key, indexName) {\r\n        var _map = (indexName) ? this.indexMap[indexName] : this.map;\r\n        return (key in _map) ? _map[key] : -1;\r\n    },\r\n    'forEach': function (fn) {\r\n        for (var key in this.map) {\r\n            fn(this.getByKey(key), key);\r\n        }\r\n    },\r\n    'getArray': function () {\r\n        return this.items;\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.model.mainmodel', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = \"class\";\r\nmodule.exports = {\r\n    extend: \"core.model.Model\",\r\n    //style 样式内容\r\n    //css 样式url链接\r\n    //page格式{\"id\":\"\",\"name\":\"\",\"href\":\"\",preview:\"\"}\r\n    attributes: [{\"name\": \"pages\", \"type\": \"core.model.PageCollection\"}, \"css\", \"style\", {\r\n        \"name\": \"commons\",\r\n        \"type\": \"core.model.Table\"\r\n    }],\r\n    addPage: function (page) {\r\n        this.getAttribute(\"pages\").add(page);\r\n    },\r\n    getPages: function () {\r\n        return this.getAttribute(\"pages\");\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.model.model', function (exports,module,require,$) {\r\n'use strict';\r\nvar simpleType = {\r\n    'array': function () {\r\n        return [];\r\n    },\r\n    'object': function () {\r\n        return {};\r\n    }\r\n};\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function () {\r\n        this.attributeValues = {};\r\n        var me = this;\r\n        this.attributes.forEach(function (attr) {\r\n            if (typeof  attr === 'string') {\r\n                me.attributeValues[attr] = '';\r\n            } else {\r\n                var type = attr.type.toLowerCase();\r\n                var value;\r\n                if (type in simpleType) {\r\n                    value = simpleType[type]();\r\n                } else {\r\n                    var Type = require(attr.type);\r\n                    value = new Type();\r\n                }\r\n                me.attributeValues[attr.name] = value;\r\n            }\r\n        });\r\n    },\r\n    attributes: [],\r\n    setAttribute: function (name, value) {\r\n        if (name in this.attributeValues) {\r\n            this.attributeValues[name] = value;\r\n        }\r\n    },\r\n    getAttribute: function (name) {\r\n        return this.attributeValues[name];\r\n    },\r\n    removeAttribute: function (name) {\r\n        var value = this.getAttribute(name);\r\n        delete this.attributeValues[name];\r\n        return value;\r\n    },\r\n    setAttributes: function (attrs) {\r\n        for (var key in attrs) {\r\n            this.setAttribute(key, attrs[key]);\r\n        }\r\n    },\r\n    getValue: function () {\r\n        return this.attributeValues;\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.model.modelcreator', function (exports,module,require,$) {\r\n'use strict';\r\nvar urlUtil = require('core.utils.url');\r\nvar ajaxProxy = require('core.model.proxy.AjaxProxy');\r\nvar functionUtil = require('core.utils.function');\r\nvar stringUtils = require(\"core.utils.string\");\r\nvar defaultParser = {\r\n    'parse': function (text) {\r\n        return text;\r\n    }\r\n};\r\n\r\nvar parse = function (text, textStatus, jqXHR, textParsers, parser) {\r\n    textParsers.forEach(function (textParser) {\r\n        text = textParser.parse(text);\r\n    });\r\n    return parser.parse(text);\r\n};\r\n\r\nexports.create = function (config) {\r\n    var url = config.url;\r\n    var proxy = config.proxy || ajaxProxy;\r\n    var parser = config.parser || defaultParser;\r\n    var textParsers = config.textParsers || [];\r\n    var isCache = config.isCache;\r\n    if (!$.isArray(textParsers)) {\r\n        textParsers = [textParsers];\r\n    }\r\n    var defer = $.Deferred();\r\n    if (url) {\r\n        var baseUrl = urlUtil.getBase(url);\r\n        var refBaseParserConfig = {\r\n            'ref-base': baseUrl.replace(/\\/$/, '')\r\n        };\r\n        textParsers.push({\r\n            parse: function (text) {\r\n                return stringUtils.applyTemplate(text, refBaseParserConfig);\r\n            }\r\n        });\r\n        proxy.getData(url, isCache)\r\n            .fail(function () {\r\n                if (config.ignoreError) {\r\n                    var model = JSON.parse('{\"presenters\":{},\"commons\":{},\"script\":[],\"icplayerVersion\": \"11.7.3\"}');\r\n                    defer.resolve({'model': model, 'baseUrl': baseUrl});\r\n                } else {\r\n                    defer.reject(new Error(\"player 11.7.3: \" + 'ajax request error'));\r\n                }\r\n            })\r\n            .then(functionUtil.createPromiseThen(defer, parse, [textParsers, parser], true))\r\n            .fail(function (e) {\r\n                defer.reject(e);\r\n            })\r\n            .then(function (model) {\r\n                defer.resolve({'model': model, 'baseUrl': baseUrl});\r\n            }).fail(function (e) {\r\n            defer.reject(e);\r\n        });\r\n    } else {\r\n        defer.resolve({'model': null, 'baseUrl': ''});\r\n    }\r\n    return defer.promise();\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.model.modulegroupmodel', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: 'core.model.Model',\r\n    attributes: [\r\n        {'name': 'presenters', 'type': 'object'},\r\n        {'name': 'modules', 'type': 'core.model.Collection'}\r\n    ],\r\n    addModule: function (module) {\r\n        this.getAttribute('modules').add(module.getAttribute(\"id\"), module);\r\n    },\r\n    addPresenter: function (key, url) {\r\n        this.getAttribute('presenters')[key] = {'href': url};\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.model.modulemodel', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: 'core.model.Model',\r\n    //style格式{'href':'','content':''}\r\n    //propertie的格式{\"name\":\"\",\"type\":\"\",'value':''}\r\n    //handler的格式{'id':'','name':''}\r\n    //layout的格式{'left':'','top':'',width:'',height:''}\r\n    attributes: ['id', 'presenterId', 'layout', 'css', 'style', 'z-index', 'lazy-init', {\r\n        'name': 'properties', 'type': 'array'\r\n    }, {'name': 'events', 'type': 'core.model.Collection'}],\r\n    addProperty: function (property) {\r\n        this.getAttribute('properties').push(property);\r\n    },\r\n    addEvent: function (name, handler) {\r\n        this.getAttribute(\"events\").add(name, handler);\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.model.pagecollection', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = \"class\";\r\nmodule.exports = {\r\n    extend: \"core.model.Collection\",\r\n    indexNames: [\"id\", \"name\"],\r\n    getIndexOfById: function (id) {\r\n        return this.indexOf(id, this.indexNames[0]);\r\n    },\r\n    getIndexOfByName: function (name) {\r\n        var index = this.indexOf(name, this.indexNames[1]);\r\n        if (index == -1) {\r\n            throw new Error(\"The name of Index is not Found\");\r\n        }\r\n        return index;\r\n    }\r\n};\r\n}, 'class');\n__applicationContext.define('core.model.pagemodel', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: 'core.model.ModuleGroupModel',\r\n    attributes: [\r\n        'layout'\r\n    ],\r\n    __extendAttribute: ['attributes']\r\n};\r\n}, 'class');\n__applicationContext.define('core.model.presentermodel', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: 'core.model.Model',\r\n    //androidDependency格式{'type':'apk','href':''}\r\n    //jsDependency格式{'name':'','version':''}\r\n    attributes: ['css', 'view', 'script', {\r\n        'name': 'androidDependency',\r\n        'type': 'core.model.Collection'\r\n    }, {'name': 'jsDependency', 'type': 'array'}, {'name': 'moduleDependency', 'type': 'object'}]\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.model.table', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function () {\r\n        this.data = {};\r\n    },\r\n    addItem: function (key, item) {\r\n        var items = this.data[key] || (this.data[key] = []);\r\n        items.push(item);\r\n    },\r\n    getItems: function (key) {\r\n        var keys = ($.isArray(key)) ? key : arguments;\r\n        var len = keys.length;\r\n        var items = [], item;\r\n        for (var i = 0; i < len; i++) {\r\n            item = this.data[keys[i]];\r\n            items = (item) ? items.concat(item) : items;\r\n        }\r\n        return items;\r\n    },\r\n    forEach: function (fn) {\r\n        for (var key in this.data) {\r\n            this.data[key].forEach(fn);\r\n        }\r\n    },\r\n    removeItem: function (key) {\r\n        delete this.data[key];\r\n    }\r\n\r\n};\r\n}, 'class');\n__applicationContext.define('core.model.toolmodel', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: 'core.model.ModuleGroupModel',\r\n    attributes: [\r\n        'mainModule',\r\n        'layout',\r\n        {'name': 'properties', 'type': 'array'}\r\n    ],\r\n    addProperty: function (property) {\r\n        this.getAttribute('properties').push(property);\r\n    },\r\n    __extendAttribute: ['attributes']\r\n};\r\n}, 'class');\n__applicationContext.define('core.plugin.sync', function (exports,module,require,$) {\r\n'use strict';\r\nvar logger = require('core.utils.log');\r\nvar toolList, Socket = window.MozWebSocket || window.WebSocket,\r\n\r\n    socket;\r\nvar timer = null,sendTimer=null,maxCount=10,count=0,interval=500;\r\n\r\nvar instance = null;\r\nfunction initws(wsUrl) {\r\n    socket = new Socket(encodeURI(wsUrl));\r\n    socket.addEventListener('open', function () {\r\n        window.clearInterval(timer);\r\n    });\r\n\r\n    socket.onerror = function (event) {\r\n        logger.error('ERROR: ' + event.message);\r\n\r\n        if(count++>maxCount){\r\n            window.clearInterval(timer);\r\n        }\r\n        else{\r\n        timer = window.setInterval(function () {\r\n            socket = new Socket(encodeURI(wsUrl));\r\n        }, interval);}\r\n    };\r\n\r\n    socket.onmessage = function (event) {\r\n        resolve(event.data);\r\n    };\r\n\r\n    socket.onclose = function (event) {\r\n        logger.log('CLOSE: ' + event.code + ', ' + event.reason);\r\n    };\r\n}\r\n\r\n\r\nfunction getTool(syncId, key) {\r\n    toolList = instance.getToolList();\r\n    for (var i = 0; i < toolList.all.length; i++) {\r\n        if (toolList.all[i].toolKey === key && toolList.all[i].syncId === syncId)\r\n            return toolList.all[i];\r\n    }\r\n    return undefined;\r\n};\r\n\r\nfunction createOption(action, syncId, toolKey) {\r\n    var option = {};\r\n    option.eventData = {};\r\n    option.eventName = action;\r\n    option.eventData.syncId = syncId;\r\n    option.eventData.toolKey = toolKey;\r\n    return option;\r\n};\r\n\r\nfunction resolve(data) {\r\n    if (!player) return;\r\n    var _data = JSON.parse(data);\r\n    var eventName = _data.eventName;\r\n    var eventData = _data.eventData;\r\n    var tool = getTool(eventData.syncId, eventData.toolKey);\r\n\r\n    switch (eventName) {\r\n        case 'updateTool':\r\n            if (tool && tool.mainModule.getPresenter().__interface && tool.mainModule.getPresenter().__interface.sync)\r\n                tool.mainModule.getPresenter().__interface.sync(eventData);\r\n            break;\r\n        case 'addTool':\r\n            if (eventData.toolKey)\r\n                instance.addTool(eventData.toolKey, {\r\n                        __sys: {\r\n                            syncId: eventData.syncId,\r\n                            NONEventFlag: true\r\n                        }\r\n                    },\r\n                    eventData.toolState, {\r\n                        toolKey: eventData.toolKey,\r\n                        ref_path_tool: decodeURIComponent(icCreatePlayer.ref_path_tool) || '../tools'\r\n                    });\r\n            break;\r\n        case 'closeTool':\r\n            if (tool)\r\n                instance.removeTool(tool.unqiueId, 'player', true);\r\n\r\n    }\r\n\r\n};\r\nvar sync = {\r\n    start: function (player, wsurl) {\r\n        try {\r\n            //return null;\r\n            var me = this;\r\n            instance = player;\r\n            instance._eventbus.addEventListener('PLAYER.TOOL.FINISH', function () {\r\n                var toolObject = arguments[1];\r\n                var _state = toolObject.mainModule.getPresenter().getState ? toolObject.mainModule.getPresenter().getState() : '';\r\n                me.addTool(toolObject.syncId, toolObject.toolKey, _state);\r\n            });\r\n            instance._eventbus.addEventListener('PLAYER.TOOL.CLOSE', function () {\r\n                var toolObject = arguments[1];\r\n                me.closeTool(toolObject.syncId, toolObject.toolKey);\r\n            });\r\n            initws(wsurl);\r\n            return socket;\r\n        } catch (e) {\r\n            console.error(e);\r\n            // //尝试重连1000\r\n            // timer = window.setInterval(function() {\r\n            // \tif (!wsor)\r\n            // \t\twsor = ws.init(wsOption);\r\n            // \telse\r\n            // \t\twinddow.clearInterval(timer);\r\n            // }, 1000);\r\n        }\r\n    },\r\n    stop: function () {\r\n        socket.close();\r\n    },\r\n    send: function(data,callback) {\r\n        this.waitForConnection(function () {\r\n            console.log( socket.readyState)\r\n            console.log(JSON.stringify(data))\r\n            socket.send(JSON.stringify(data));\r\n            if (typeof callback !== 'undefined') {\r\n                callback();\r\n            }\r\n        }, 1);\r\n\r\n    },\r\n    waitForConnection: function (callback, interval) {\r\n        if (socket.readyState === 1) {\r\n            window.clearTimeout(sendTimer);\r\n            callback();\r\n        } else {\r\n            var that = this;\r\n            // optional: implement backoff for interval here\r\n           sendTimer= setTimeout(function () {\r\n                that.waitForConnection(callback, interval);\r\n            }, interval);\r\n        }\r\n    },\r\n    addTool: function (syncId, toolKey, toolState) {\r\n        try {\r\n            var option = createOption('addTool', syncId, toolKey);\r\n            option.eventData.toolState = toolState;\r\n            this.send(option);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    },\r\n    /**\r\n     * 更新\r\n     * @param  {[type]} syncId     tool.syncId\r\n     * @param  {[type]} toolKey    tool.Key\r\n     * @param  {[type]} updateInfo [description]\r\n     * @return {[type]}            void\r\n     */\r\n    updateTool: function (syncId, toolKey, updateInfo) {\r\n        try {\r\n            var option = createOption('updateTool', syncId, toolKey);\r\n            var toolState = instance.getPlayerServices().getState().getAllToolState();\r\n            option.eventData.toolState = toolState;\r\n            option.eventData.updateInfo = updateInfo;\r\n            this.send(option);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    },\r\n    closeTool: function (syncId, toolKey) {\r\n        try {\r\n            var option = createOption('closeTool', syncId, toolKey);\r\n            this.send(option);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n};\r\nmodule.exports = sync;\r\n}, '');\n__applicationContext.define('core.player.component', function (exports,module,require,$) {\r\n'use strict';\r\nvar modelCreator = require('core.model.modelCreator');\r\nvar playerException = require('core.exception.playerException');\r\nvar Eventbus = require('core.eventbus.eventbus');\r\nvar urlUtil = require('core.utils.url');\r\nvar functionUtil = require('core.utils.function');\r\nvar uuid = require('core.utils.uuid');\r\nvar Layout = require('core.layout.Layout');\r\n\r\nvar layoutAlias = {\r\n    'iframe': 'core.layout.playerIframeLayout',\r\n    'div': 'core.layout.playerDivLayout'\r\n};\r\nvar createLayout = function (layoutType, component) {\r\n    var typeName = layoutAlias[layoutType] || layoutType;\r\n    var LayoutClass = require(typeName);\r\n    return new LayoutClass(component);\r\n};\r\n\r\nvar getEventName = function (name) {\r\n    return (this._events[name]) ? name : \"__custom_\" + name;\r\n};\r\n\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function (config, parent) {\r\n        this.layoutTarget = undefined;\r\n        this.initConfig(config);\r\n        $.extend(this, config);\r\n        this.id = this.id || uuid(6);\r\n        this.unqiueId = uuid(8);\r\n        this.parent = parent || this;\r\n        this.top = this.parent.top || this;\r\n        this.parentBaseUrl = this.parent.baseUrl || urlUtil.getBaseLocationUrl();\r\n        this.url = this.url && urlUtil.resolve(this.parentBaseUrl, this.url);\r\n        if (this.layout) {\r\n            this.layout = createLayout(this.layout, this);\r\n        }\r\n        this._events = {};\r\n        this._eventbus = new Eventbus();\r\n        this.initComponent();\r\n        if ($.isPlainObject(this.listeners)) {\r\n            for (var name in this.listeners) {\r\n                this.addEventListener(name, this.listeners[name], this);\r\n            }\r\n        }\r\n    },\r\n    createController: function () {\r\n        return {};\r\n    },\r\n    //presenter获取的player的能力\r\n    getController: function () {\r\n        //只创建一次\r\n        return this.controller || (this.controller = this.createController());\r\n    },\r\n    initConfig: function (config) {\r\n        //href等同url\r\n        config.url = config.url || config.href;\r\n        delete config.href;\r\n        //layout处理成layoutConfig,防止冲突\r\n        if (config.layout) {\r\n            config.layoutConfig = Layout.createLayoutConfig(config.layout);\r\n            delete config.layout;\r\n        }\r\n    },\r\n    initComponent: function () {\r\n        this.addEvents(\r\n            //渲染自身数据完毕\r\n            'renderModel',\r\n            //渲染完毕\r\n            'render',\r\n            //销毁对象\r\n            'destroy');\r\n    },\r\n    load: function () {\r\n        return modelCreator.create({\r\n            'url': this.url,\r\n            'textParsers': [this.getRefPathParser()],\r\n            'parser': this.parser\r\n        });\r\n    },\r\n    getRefPathParser: function () {\r\n        return this.top.getRefPathParser();\r\n    },\r\n    //主入口，标识组件渲染到何处（dom）\r\n    render: function (renderTo) {\r\n        this.container = $(renderTo || this.renderTo);\r\n        var deferred = $.Deferred();\r\n        try {\r\n\r\n            this.fireEvent('beforeRender');\r\n            //记录load的结果\r\n            var loadResult;\r\n            //渲染前准备\r\n            this.onRender();\r\n            var me = this;\r\n            //开始加载数据\r\n            this.load()\r\n                .fail(function (e) {\r\n                    deferred.reject(playerException.create('load error', e));\r\n                })\r\n                .then(functionUtil.createPromiseThen(deferred, function (result) {\r\n                    loadResult = result;\r\n                    me.baseUrl = result.baseUrl;\r\n                    //渲染自身数据\r\n                    return me.renderModel(result.model, result.baseUrl);\r\n                }))\r\n                .fail(function (e) {\r\n                    deferred.reject(e);\r\n                })\r\n                .then(functionUtil.createPromiseThen(deferred, function () {\r\n                    me.fireEvent('renderModel', loadResult.model);\r\n                    //通过布局对象渲染子模块\r\n                    return me.layout && (me.layout.render(me.layoutTarget || me.element));\r\n                }))\r\n                .then(functionUtil.createPromiseThen(deferred, function () {\r\n                    me.fireEvent('afterLayout');\r\n                    return me.afterLayout();\r\n                }))\r\n                .then(function () {\r\n                    loadResult = null;\r\n                    deferred.resolve(me);\r\n                    me.fireEvent('render');\r\n                });\r\n        } catch (e) {\r\n            console.error(e);\r\n            deferred.reject(playerException.create('render error', e));\r\n        }\r\n        return deferred.fail(function (e) {\r\n            playerException.execute(e, me);\r\n        });\r\n    },\r\n    onRender: function () {\r\n        this.element = this.container;\r\n    },\r\n    renderModel: function (model, baseurl) { },\r\n    afterLayout: function () { },\r\n    getElement: function (isJquery) {\r\n        return (isJquery === true) ? this.element : this.element[0];\r\n    },\r\n    addEvents: function (eventConfig) {\r\n        //如果是字符串,表示多个参数,都是字符串\r\n        if (typeof eventConfig === 'string') {\r\n            var events = arguments,\r\n                i = events.length;\r\n            while (i--) {\r\n                this._events[events[i]] = this._events[events[i]] || true;\r\n            }\r\n        }\r\n        //对象一次声明,先放空,回头支持\r\n        //else {\r\n        //\r\n        //}\r\n    },\r\n    fireEvent: function (name) {\r\n        Eventbus.prototype.dispatch.apply(this._eventbus, arguments);\r\n    },\r\n    addEventListener: function (name) {\r\n        Eventbus.prototype.addEventListener.apply(this._eventbus, arguments);\r\n    },\r\n    release: function () {\r\n        this.destroy();\r\n        this.fireEvent('destroy', this);\r\n        //释放dom对象,如果container和element相同只释放子节点，如果不相同完全释放\r\n        if (this.element == this.container) {\r\n            this.element.children().remove();\r\n        } else {\r\n            this.element.remove();\r\n        }\r\n        // if (all) {\r\n        //     if (this.parent && this.parent.container && this.parent.container.find('.ic_paint').length > 0)\r\n        //         this.parent.container.find('.ic_paint').remove()\r\n        // }\r\n    },\r\n    destroy: function () { },\r\n    layout: undefined\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.player.module', function (exports,module,require,$) {\r\n'use strict';\r\nvar loaderFactory = require('core.loader.presenterLoaderCreator');\r\nvar functionUtil = require('core.utils.function');\r\nvar createModel = require('core.common.createModel');\r\nvar domUtil = require('core.utils.dom');\r\nvar request = require('core.utils.request');\r\nvar ModuleModel = require('core.model.ModuleModel');\r\nvar logger = require('core.utils.Log');\r\nvar stringUtil = require('core.utils.string');\r\nvar i18nLoader = require('core.common.i18nLoader');\r\n\r\nvar ModuleInterface = {\r\n    'Wrap': /^wrap$/,\r\n    'Processer': /^(processBeforeRun|processAfterRun|setCallbackList|setPageExtendConf)$/\r\n};\r\n\r\nvar createModuleModel = function () {\r\n    var me = this;\r\n    return createModel(this.properties, this.parent.baseUrl, this.getRefPathParser())\r\n        .then(function (model) {\r\n            return $.extend(model, {\r\n                '$': {\r\n                    'presenterId': me.presenterId,\r\n                    'unqiueId': me.id + '@' + me.parent.id,\r\n                    'scope': me.parent.moduleGroupType\r\n                },\r\n                'ID': me.id\r\n            });\r\n        });\r\n};\r\n\r\nvar createPresenter = function (fnName, baseUrl) {\r\n    var presenter = {};\r\n    try {\r\n        var me = this;\r\n        presenter = window[fnName].apply(window, [me.presenterId]);\r\n        //解析presenter的接口类型\r\n        var _interface = [];\r\n        if (presenter.__interface) {\r\n            for (var name in presenter.__interface) {\r\n                for (var key in ModuleInterface) {\r\n                    if (ModuleInterface[key].test(name)) {\r\n                        _interface.push(key);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this._interface = stringUtil.createReg(_interface);\r\n        presenter.__model = this.getModel();\r\n\r\n        functionUtil.execute(presenter, {\r\n            'setPlayerController': me.getController(),\r\n            'setUrlParams': request.get(),\r\n            'setBasePath': baseUrl,\r\n            'setPaint': me.top.getPaint()\r\n        });\r\n    } catch (e) {\r\n        logger.error('create presenter[' + fnName + '] error', e);\r\n    }\r\n    return presenter;\r\n};\r\n\r\nvar lifeCycle = {\r\n    'run': ['run'],\r\n    'show': ['pageShow'],\r\n    'destroy': ['pageLeave', 'destroy'],\r\n    'pageChange': ['pageChange'],\r\n    'afterRender': ['afterRender']\r\n};\r\n\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    extend: 'core.player.Component',\r\n    'isRequire': false,\r\n    load: function () {\r\n        var me = this;\r\n        return createModuleModel.call(this)\r\n            .then(function (model) {\r\n                me.presenterModel = model;\r\n                var loader = loaderFactory.create();\r\n                return loader.load(me.refPathParser, me);\r\n            });\r\n    },\r\n    createController: function () {\r\n        var me = this;\r\n        var controller = {\r\n            'addToolItem': function (config, target) {\r\n                if (me.parent.className === 'core.player.tool' && config) {\r\n                    config.renderTo = me.parent.element.find(require('core.player.tool').getItemRender(target));\r\n                    return this.require(config);\r\n                }\r\n            },\r\n            'require': function (config) {\r\n                var presenterId = config.presenterId = (config.presenterId || config.addonId);\r\n                delete config.addonId;\r\n                //定制播放器申明了,用定制播放器的版本,没有的用页面上申明的,防止版本冲突\r\n                var presenter = me.top.getPresenter(presenterId) || me.moduleDependency[presenterId];\r\n                if (presenter) {\r\n                    if (config.isRelative !== false) {\r\n                        ['top', 'left'].forEach(function (name) {\r\n                            config.layout[name] = me.layoutConfig[name] + parseInt(config.layout[name], 10);\r\n                        });\r\n                    }\r\n                    presenter.refPathParser = presenter.refPathParser || me.getRefPathParser();\r\n                    var moduleConfig = new ModuleModel();\r\n                    moduleConfig.setAttributes(config);\r\n                    var module = new me.constructor($.extend(moduleConfig.getValue(), presenter, {\r\n                        isRequire: true\r\n                    }), me.parent);\r\n\r\n                    var promise = (config.renderTo) ? module.render(config.renderTo) : me.parent.layout.addModule(module);\r\n                    return promise\r\n                        .then(function () {\r\n                            return me.parent.requireModule(module);\r\n                        })\r\n                        .then(function () {\r\n                            if ($.isFunction(config.callback)) {\r\n                                config.callback(module.getPresenter());\r\n                            }\r\n                            return module.getPresenter();\r\n                        });\r\n                } else {\r\n                    logger.error('require error, do not find addonId[' + presenterId + '] config,please check moduleDependency config');\r\n                }\r\n            },\r\n            'createModule': function (declareModuleId, config) {\r\n                var moduleConfig = me.parent.lazyInitModules[declareModuleId];\r\n                moduleConfig.isRelative = false;\r\n                $.extend(moduleConfig, config);\r\n                return this.require(moduleConfig);\r\n            },\r\n            'getEventBus': function () {\r\n                return {\r\n                    'addEventListener': function (name, listener, options) {\r\n                        var comp = me;\r\n                        options = options || {};\r\n                        while (comp.parent !== comp) {\r\n                            comp.addEventListener(name, {\r\n                                fn: listener.onEventReceived,\r\n                                scope: listener,\r\n                                selector: options.target\r\n                            });\r\n                            comp = comp.parent;\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n        };\r\n        var comp = this,\r\n            parentController;\r\n        while (true) {\r\n            comp = comp.parent;\r\n            parentController = comp.getController();\r\n            for (var key in parentController) {\r\n                if (key in controller) {\r\n                    (function (_value) {\r\n                        controller[key] = function () {\r\n                            return _value;\r\n                        };\r\n                    })($.extend(controller[key](), parentController[key]()));\r\n                } else {\r\n                    controller[key] = parentController[key];\r\n                }\r\n            }\r\n            if (comp.parent == comp) {\r\n                break;\r\n            }\r\n        }\r\n        return controller;\r\n    },\r\n    getPage: function () {\r\n        var page = this.parent;\r\n        //学科工具需要递归判断\r\n        while (page.className != 'core.player.page') {\r\n            page = page.parent;\r\n        }\r\n        return page;\r\n    },\r\n    renderModel: function (model, baseUrl) {\r\n        var deferred = $.Deferred();\r\n        var promise = deferred.resolve();\r\n        try {\r\n            this.moduleDependency = model.getAttribute('moduleDependency');\r\n            this.cssElement = $(domUtil.addStyle(this.css));\r\n            this.presenter = createPresenter.call(this, model.createFnName, baseUrl);\r\n            //如果moduel含有getQuestionInfo方法则将页面设置为题型页面isReportable=true\r\n            if (this.parent.isReportable && this.parent.isReportable() === false && $.isFunction(this.presenter.getQuestionInfo)) {\r\n                this.parent.setReportable(true);\r\n            }\r\n            var me = this;\r\n            if (me.instanceOf('Wrap')) {\r\n                promise = promise.then(function () {\r\n                    return me.runInterface('wrap', me.container[0]);\r\n                }).done(function (target) {\r\n                    me.container = $(target || me.container);\r\n                });\r\n            }\r\n            return promise\r\n                .done(function () {\r\n                    var moduleTemplate;\r\n                    if (!me.top.templateKey) {\r\n                        moduleTemplate = '<div class=\"addon_${presenterId} ic_module\" id=\"${id}\" style=\"${style}\"></div>';\r\n                    } else {\r\n                        moduleTemplate = '<div class=\"' + me.top.templateKey + '_${presenterId} ic_module\" id=\"${id}\" style=\"${style}\"></div>';\r\n                    }\r\n                    me.element = $(stringUtil.applyTemplate(moduleTemplate, me));\r\n                    me.element.css(me.layoutConfig);\r\n                    //comment the blow sentence for complicate IE8,but change appedn to html may cause some error?\r\n                    //me.element.append(modle.getAttribute('view'));\r\n                    me.element.html(model.getAttribute('view'));\r\n                    me.container.append(me.element);\r\n                })\r\n                .then(function () {\r\n                    //如果有语言包导入语言\r\n                    if ($.isFunction(me.presenter.setLocationProperties)) {\r\n                        return i18nLoader.load(baseUrl).done(function (langObject) {\r\n                            me.run('setLocationProperties', langObject);\r\n                        });\r\n                    }\r\n                })\r\n                .done(function () {\r\n                    var initName = 'init' + me.getController().getRuntime();\r\n                    me.run(initName);\r\n                });\r\n        } catch (e) {\r\n            logger.error('init module error', e);\r\n        }\r\n    },\r\n    'getPresenter': function () {\r\n        return this.presenter;\r\n    },\r\n    'getModel': function () {\r\n        return this.presenterModel;\r\n    },\r\n    'getStateId': function () {\r\n        return this.parent.id + this.id;\r\n    },\r\n    'getState': function () {\r\n        return this.run('getState');\r\n    },\r\n    'setState': function (value) {\r\n        //this.run('setState', [value, {isClassroomExam: true}]);\r\n        this.run('setState', value);\r\n    },\r\n    run: function (name, args) {\r\n        try {\r\n            return functionUtil.execute(this.presenter, name, args);\r\n        } catch (e) {\r\n            logger.error('run presenter[' + name + '] error', e);\r\n        }\r\n    },\r\n    runInterface: function (name, args) {\r\n        if (this.presenter && this.presenter.__interface)\r\n            return functionUtil.execute(this.presenter.__interface, name, args);\r\n    },\r\n    instanceOf: function (name) {\r\n        return this._interface.test(name);\r\n    },\r\n    runLifeCycle: function (name) {\r\n        var me = this;\r\n        var args = [me.getElement(), me.getModel()];\r\n        var taskList = [];\r\n        lifeCycle[name].forEach(function (lifeName) {\r\n            taskList.push({\r\n                'fn': me.presenter[lifeName],\r\n                'args': args,\r\n                'scope': me.presenter,\r\n                'name': me.presenterId + ':' + lifeName\r\n            });\r\n        });\r\n        return functionUtil.runSequence(taskList, 'run presenter lifecycle');\r\n    },\r\n    destroy: function () {\r\n        if (this.cssElement) {\r\n            this.cssElement.remove();\r\n        }\r\n        this.runLifeCycle('destroy');\r\n    },\r\n    getZIndex: function () {\r\n        return this['z-index'];\r\n    }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.player.modulegroup', function (exports,module,require,$) {\r\n'use strict';\r\nvar Module = require('core.player.Module');\r\nvar Collection = require('core.model.Collection');\r\nvar logger = require('core.utils.Log');\r\nvar functionUtil = require('core.utils.function');\r\n\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n  extend: \"core.player.Component\",\r\n  initComponent: function () {\r\n    require(\"core.player.ModuleGroup\").prototype.superClass.initComponent.call(this);\r\n    this.processPresenters = [];\r\n    this.lazyInitModules = {};\r\n  },\r\n  renderModel: function (model) {\r\n    var me = this;\r\n    this.items = new Collection();\r\n    this.items_state = {};\r\n    this.itemIds = [];\r\n    if (model) {\r\n      //页面上的presenter申明\r\n      var presenters = model.getAttribute('presenters') || {};\r\n      model.getAttribute('modules').forEach(function (moduleConfig) {\r\n        moduleConfig = moduleConfig.getValue();\r\n        //不解析加载延时加载的module，交给createModule方法调用\r\n        if (moduleConfig['lazy-init'] === true) {\r\n          me.lazyInitModules[moduleConfig.id] = moduleConfig;\r\n        } else {\r\n          //定制播放器申明了,用定制播放器的版本,没有的用页面上申明的,防止版本冲突\r\n          var presenter = me.top.getPresenter(moduleConfig.presenterId) || presenters[moduleConfig.presenterId];\r\n          if (presenter) {\r\n            //为空说明不是定制播放器上的,使用课件的refPath\r\n            presenter.refPathParser = presenter.refPathParser || me.getRefPathParser();\r\n            me.items.add(moduleConfig.id, new Module($.extend(moduleConfig, presenter), me));\r\n            me.itemIds.push(moduleConfig.id);\r\n          } else {\r\n            logger.error('do not find [' + moduleConfig.presenterId + ']presenter config');\r\n          }\r\n        }\r\n      });\r\n    }\r\n  },\r\n  getModuleList: function () {\r\n    return this.itemIds;\r\n  },\r\n  getModule: function (key) {\r\n    var presenter;\r\n    if (this.items) {\r\n      var module = this.items.getByKey(key);\r\n      presenter = module && module.getPresenter();\r\n    }\r\n    return presenter;\r\n  },\r\n  getModulesByType: function (type) {\r\n    var list = [];\r\n    this.items.getArray().forEach(function (module) {\r\n      if (module.presenterId == type) {\r\n        list.push(module.getPresenter());\r\n      }\r\n    });\r\n    return list;\r\n  },\r\n  //运行module的周期\r\n  runModuleLifeCycle: function (name) {\r\n    var reg = /^(run|show|afterRender)$/;\r\n    var promises = [];\r\n    var me = this;\r\n    this.items.forEach(function (module) {\r\n      if ((!reg.test(name)) || !module.isRequire) {\r\n        var model = module.getModel();\r\n        var view = module.getElement();\r\n        promises.push(module.runLifeCycle(name, view, model));\r\n      }\r\n    });\r\n    return $.when.apply($, promises);\r\n  },\r\n  _setModuleState: function (module) {\r\n    var stateValue = this.top.getStateValue(module.getStateId());\r\n    if (stateValue) {\r\n      module.setState([stateValue, this.gotoConfig ? (this.gotoConfig.options || {}) : {}]);\r\n    }\r\n  },\r\n  requireModule: function (module) {\r\n    var me = this;\r\n    this.items.add(module.id, module);\r\n    this.items_state[module.id] = false;\r\n    this.itemIds.push(module.id);\r\n    if (module.instanceOf('Processer')) {\r\n      this.processPresenters.push(module);\r\n    }\r\n\r\n    //如果是处理器,未运行run周期，就将其他presenter传给自己,同时将回调列表传给对应的presenter\r\n    if (module.instanceOf('Processer')) {\r\n      this.processPresenters.push(module);\r\n      this.items.forEach(function (item) {\r\n        module.runInterface('setCallbackList', item.top.getCallbackList());\r\n        module.runInterface('processBeforeRun', item.getPresenter());\r\n        if(me.gotoConfig && me.gotoConfig.__extendConfig){\r\n           module.runInterface('setPageExtendConf', me.gotoConfig.__extendConfig);\r\n        }\r\n      });\r\n    }\r\n    this.processPresenters.forEach(function (processer) {\r\n      //防止重复跑自己的发现\r\n      if (processer != module) {\r\n        processer.runInterface('setCallbackList', module.top.getCallbackList());\r\n        processer.runInterface('processBeforeRun', module.getPresenter());\r\n        if(me.gotoConfig && me.gotoConfig.__extendConfig){\r\n           processer.runInterface('setPageExtendConf',me.gotoConfig.__extendConfig)\r\n        }\r\n      }\r\n    });\r\n    var taskList = [];\r\n    ['run', this._setModuleState, 'show', 'afterRender'].forEach(function (name) {\r\n      if ($.isFunction(name)) {\r\n        taskList.push({\r\n          fn: name,\r\n          args: [module],\r\n          scope: me,\r\n          name: 'setState'\r\n        });\r\n      } else {\r\n        taskList.push({\r\n          fn: module.runLifeCycle,\r\n          args: [name],\r\n          scope: module,\r\n          name: name\r\n        });\r\n      }\r\n    });\r\n    return functionUtil.runSequence(taskList).done(function () {\r\n      me.items_state[module.id] = true;\r\n      //如果是处理器,如果已运行完自身的run周期，就将其他presenter传给自己\r\n      if (module.instanceOf('Processer')) {\r\n        me.items.forEach(function (item, itemid) {\r\n            if (me.items_state[itemid]) {\r\n                module.runInterface('processAfterRun', item.getPresenter());\r\n            }\r\n        });\r\n      }\r\n      me.processPresenters.forEach(function (processer) {\r\n        //防止重复跑自己的发现，\r\n        if (processer != module) {\r\n          processer.runInterface('processAfterRun', module.getPresenter());\r\n        }\r\n      });\r\n    });\r\n  },\r\n  afterLayout: function () {\r\n    var me = this;\r\n    this.items.forEach(function (module) {\r\n      if (!module.isRequire) {\r\n        //容器扩展接口\r\n        if (module.instanceOf('Processer') === true) {\r\n          me.processPresenters.push(module);\r\n        }\r\n        //添加事件关联,require的module不支持event、handler\r\n        if (module.events.length) {\r\n          module.events.forEach(function (handlers, eventName) {\r\n            handlers.forEach(function (handler) {\r\n              var _handlerModule = me.items.getByKey(handler.id);\r\n              if (_handlerModule && (handler.name in _handlerModule.getPresenter())) {\r\n                _handlerModule.getController().getEventBus().addEventListener(eventName, {\r\n                  'onEventReceived': function (name, data) {\r\n                    _handlerModule.run(handler.name, data);\r\n                  }\r\n                });\r\n              }\r\n            });\r\n          });\r\n        }\r\n        delete module.events;\r\n      }\r\n    });\r\n\r\n    this.processPresenters.forEach(function (processModule) {\r\n      me.items.forEach(function (module) {\r\n        processModule.runInterface('setCallbackList', me.top.getCallbackList());\r\n        processModule.runInterface('processBeforeRun', module.getPresenter());\r\n        if(me.gotoConfig && me.gotoConfig.__extendConfig){\r\n           processModule.runInterface('setPageExtendConf',me.gotoConfig.__extendConfig)\r\n        }\r\n      });\r\n    });\r\n    var taskList = [];\r\n    this.modulelifeCycles.forEach(function (name) {\r\n      if ($.isFunction(name)) {\r\n        taskList.push({\r\n          fn: name,\r\n          args: [],\r\n          scope: me,\r\n          name: name\r\n        });\r\n      } else {\r\n        taskList.push({\r\n          fn: me.runModuleLifeCycle,\r\n          args: [name],\r\n          scope: me,\r\n          name: name\r\n        });\r\n      }\r\n    });\r\n    return functionUtil.runSequence(taskList).done(function () {\r\n      me.processPresenters.forEach(function (processModule) {\r\n        me.items.forEach(function (module) {\r\n          if (!module.isRequire) {\r\n            processModule.runInterface('processAfterRun', module.getPresenter());\r\n          }\r\n        });\r\n      });\r\n    });\r\n  },\r\n  destroy: function () {\r\n      if (this.items) {\r\n          this.items.forEach(function (module) {\r\n              module.release();\r\n          });\r\n      }\r\n  },\r\n  'modulelifeCycles': ['run', 'show', 'afterRender'],\r\n  layout: 'core.layout.pageAbsoluteLayout'\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.player.page', function (exports,module,require,$) {\r\n'use strict';\r\nvar parser = require(\"core.model.parser.pageXmlParser\");\r\n\r\nvar setState = function() {\r\n    var me = this;\r\n    this.items.forEach(function(module) {\r\n        if (!module.isRequire) {\r\n            var stateValue = me.top.getStateValue(module.getStateId());\r\n            if (stateValue) {\r\n                module.setState([stateValue, me.gotoConfig.options || {}]);\r\n            }\r\n        }\r\n    });\r\n};\r\nmodule.type = \"class\";\r\nmodule.exports = {\r\n    extend: \"core.player.ModuleGroup\",\r\n    initComponent: function() {\r\n        require(\"core.player.Page\").prototype.superClass.initComponent.call(this);\r\n        this.reportable = false;\r\n        this.gotoConfig = this.gotoConfig || {};\r\n        this.addEvents(\r\n            //当前主页面加载渲染完毕(包括通用页面也加载渲染完毕)\r\n            'PageLoaded'\r\n        );\r\n    },\r\n    'moduleGroupType': 'page',\r\n    //通用页一次渲染的才调用\r\n    pageChange: function() {\r\n        this.runModuleLifeCycle('pageChange');\r\n    },\r\n    onRender: function() {\r\n        this.element = $('<div class=\"ic_page\"></div>');\r\n        this.container.append(this.element);\r\n    },\r\n    getState: function() {\r\n        var value, stateMap = {};\r\n        if (this.items)\r\n            this.items.forEach(function(module) {\r\n                value = module.getState();\r\n                if (value) {\r\n                    stateMap[module.getStateId()] = value;\r\n                }\r\n            });\r\n        return stateMap;\r\n    },\r\n    setReportable: function(reportable) {\r\n        this.reportable = reportable;\r\n    },\r\n    isReportable: function() {\r\n        return this.reportable;\r\n    },\r\n    'modulelifeCycles': ['run', setState, 'show', 'afterRender'],\r\n    parser: parser\r\n};\r\n}, 'class');\n__applicationContext.define('core.player.player', function (exports,module,require,$) {\r\n'use strict';\r\nvar mainParser = require(\"core.model.parser.mainXmlParser\");\r\nvar Page = require(\"core.player.page\");\r\nvar request = require('core.utils.request');\r\nvar refPathBuilder = require('core.common.refPathBuilder');\r\nvar playerConfig = require('core.common.playerConfig');\r\nvar eventname = require('core.eventbus.eventname');\r\nvar urlUtil = require('core.utils.url');\r\nvar table = require('core.model.table');\r\nvar logger = require('core.utils.Log');\r\nvar State = require('core.state.SimpleState');\r\nvar functionUtil = require('core.utils.function');\r\nvar i18nLoader = require('core.common.i18nLoader');\r\nvar PlayerFlow = require('core.common.PlayerFlow');\r\nvar toolApi = require('core.common.tool.toolapi');\r\nvar gotoPageController = require('core.common.player.gotopage');\r\nvar createModel = require('core.common.createModel');\r\n\r\n//创建Page,需要指定scope\r\nvar createPage = function (pageConfig) {\r\n  return new Page(pageConfig, this);\r\n};\r\n\r\nvar presenterGetter = {\r\n  'page': function () {\r\n    if (this.activePage.items) {\r\n      return this.activePage.items.getArray();\r\n    } else {\r\n      return [];\r\n    }\r\n  },\r\n  'tool': function () {\r\n    var list = [];\r\n    this.toolList.all.forEach(function (tool) {\r\n      if (tool.items) {\r\n        list = list.concat(tool.items.getArray());\r\n      }\r\n    });\r\n    return list;\r\n  },\r\n  'common': function () {\r\n    var list = [];\r\n    this.commonPages.forEach(function (page) {\r\n      if (page.items) {\r\n        list = list.concat(page.items.getArray());\r\n      }\r\n    });\r\n    return list;\r\n  }\r\n};\r\nvar allPresenterGetter = [];\r\nfor (var key in presenterGetter) {\r\n  allPresenterGetter.push(key);\r\n}\r\n\r\nmodule.type = \"class\";\r\nmodule.exports = {\r\n  extend: \"core.player.Component\",\r\n  initComponent: function () {\r\n    require(\"core.player.Player\").prototype.superClass.initComponent.call(this);\r\n    this.waitDialog = this.waitDialog || require('core.common.defaultWaitDialog');\r\n    this.pages = [];\r\n    this.state = new State(this.stateToken);\r\n    //默认显示第一页\r\n    this.currentPageIndex = 0;\r\n    //设置refPath\r\n    this.refPathParser = refPathBuilder.build(this.refPath, this.url);\r\n    this.oriRefPathParse = this.refPathParser\r\n    //设置全局的refPath,为qti等使用\r\n    var _refPath = this.getRefPathParser().getRefPath();\r\n    icCreatePlayer.ref_path = _refPath['ref-path'];\r\n    icCreatePlayer.ref_path_addon = _refPath['ref-path-addon'];\r\n    icCreatePlayer.ref_path_tool = window.decodeURIComponent(require('core.utils.request')('ref-path-tool')) || this.playerCode;\r\n    var lang = this.location.default_lang;\r\n    lang = (this.location.current === undefined || this.location.current === '') ? lang : this.location.current;\r\n    icCreatePlayer.lang = lang;\r\n    //为了方便清空module添加的事件,将pageLoaded事件设定在各自页上\r\n    this.addEventListener('PageLoaded', function () {\r\n      this.activePage.fireEvent('PageLoaded');\r\n      this.commonPages.forEach(function (page) {\r\n        page.fireEvent('PageLoaded');\r\n      });\r\n    }, this);\r\n    //toolList:存放学科工具\r\n    this.toolList = {\r\n      list: {\r\n        top: [],\r\n        bottom: []\r\n      },\r\n      all: [],\r\n      active: ''\r\n    };\r\n    this.i18nModel = {};\r\n    i18nLoader.setLocation(this.location);\r\n    this.playerFlows = {};\r\n    this.TOOL.TOOLCONTROL = toolApi.create(this);\r\n    require('core.common.printscreen').printScreen(this._eventbus);\r\n    console.log('player version : 11.7.3')\r\n  },\r\n  getI18nModel: function (key) {\r\n    var lang = icCreatePlayer.lang;\r\n    var text;\r\n    if (!text && !this.i18nModel.player) {\r\n      text = require('core.locations.' + lang + '.lang');\r\n      if (!text) {\r\n        text = require('core.locations.' + lang.split('_')[0] + '.lang');\r\n      }\r\n      // 兼容暂不支持的语言，使用英文版\r\n      if (!text) {\r\n        text = require('core.locations.zh_CN.lang');\r\n      }\r\n      this.i18nModel.player = text ? text : key;\r\n    }\r\n    return this.i18nModel;\r\n  },\r\n  getRefPathParser: function (key) {\r\n    //缺省取课件的refPath\r\n    return this.refPathParser[key || 'courseware'];\r\n  },\r\n  getCallbackList: function () {\r\n    return this.callbackList || {}\r\n  },\r\n  render: function (renderTo) {\r\n    this.container = $(renderTo);\r\n    return this.renderPromise = require(\"core.player.Player\").prototype.superClass.render.call(this, renderTo);\r\n  },\r\n  load: function () {\r\n    var me = this;\r\n    //下载定制播放器的配置\r\n    return playerConfig.create(this.playerCode, this.refPathParser.playerConfig)\r\n      .then(function () {\r\n        //在这里已经完成了自动加载lib库添加字体样式引用i18n_css\r\n        me.element.addClass('typefaces_' + me.location.current);\r\n        return require(\"core.player.Player\").prototype.superClass.load.call(me);\r\n      });\r\n  },\r\n  onRender: function () {\r\n    this.element = $('<div class=\"ic_player\"></div>');\r\n    this.container.append(this.element);\r\n  },\r\n  setContainerFontSize: function (fontSize) {\r\n    if (this.adaptFlag || this.adaptFlag == undefined) {\r\n      icCreatePlayer.fontSize = fontSize;\r\n      this.container.css('font-size', fontSize + 'px');\r\n    }\r\n  },\r\n  getCurrentPageIndex: function () {\r\n    return this.currentPageIndex;\r\n  },\r\n  closeActivePage: function () {\r\n    gotoPageController.closeActivePage.apply(this);\r\n  },\r\n  gotoPageIndex: function (index, config) {\r\n    gotoPageController.gotoPageIndex.apply(this, [index, config]);\r\n  },\r\n  //注册流程\r\n  registerFlow: function (key, flowConfig) {\r\n    this.playerFlows[key] = new PlayerFlow(flowConfig, key, this);\r\n  },\r\n  //启动流程\r\n  startFlow: function (key, data, scb, fcb) {\r\n    var flow = this.playerFlows[key];\r\n    if (flow) {\r\n      flow.start(data, data && data.scope, scb, fcb);\r\n    } else {\r\n      logger.log('not exist' + key + ' flow');\r\n      //throw '不存在' + key + '流程';\r\n    }\r\n  },\r\n  destroy: function () {\r\n    this.closeActivePage();\r\n    this.clearTool();\r\n    if (this.commonPages) {\r\n      this.commonPages.forEach(function (page) {\r\n        page.release();\r\n      });\r\n      this.commonPages = null;\r\n    }\r\n  },\r\n  //遍历presenter\r\n  eachPresenter: function (fn, scope) {\r\n    scope = scope || allPresenterGetter;\r\n    if (!$.isArray(scope)) {\r\n      scope = [scope];\r\n    }\r\n    var list = [];\r\n    var self = this;\r\n    scope.forEach(function (key) {\r\n      var fn = presenterGetter[key];\r\n      if (fn) {\r\n        list = list.concat(fn.call(self) || []);\r\n      }\r\n    });\r\n    list.forEach(fn);\r\n  },\r\n  getStateValue: function (key) {\r\n    return this.state.getState(key);\r\n  },\r\n  gotoPage: function (name, config) {\r\n    gotoPageController.gotoPage.apply(this, [name, config]);\r\n  },\r\n  gotoPageId: function (id, config) {\r\n    gotoPageController.gotoPageId.apply(this, [id, config]);\r\n  },\r\n  'firstPage': function () {\r\n    gotoPageController.firstPage.apply(this);\r\n  },\r\n  'lastPage': function () {\r\n    gotoPageController.lastPage.apply(this);\r\n  },\r\n  'nextPage': function () {\r\n    gotoPageController.nextPage.apply(this);\r\n  },\r\n  'prevPage': function () {\r\n    gotoPageController.prevPage.apply(this);\r\n  },\r\n  /**\r\n   * 增加拓展页\r\n   * @param config\r\n   */\r\n  \"addExtendPage\": function (config) {\r\n    var me = this;\r\n    this.refPathParser = refPathBuilder.build(this.refPath, config[\"ref-path\"]);\r\n    var _refPath = this.getRefPathParser().getRefPath();\r\n    icCreatePlayer.ref_path = _refPath['ref-path'];\r\n    icCreatePlayer.ref_path_addon = _refPath['ref-path-addon'];\r\n    icCreatePlayer.ref_path_tool = window.decodeURIComponent(require('core.utils.request')('ref-path-tool')) || this.playerCode;\r\n    this.top.layout.activePage()\r\n    this.closeActivePage();\r\n    config.url = config.url || config.href || \"\";\r\n    if (config.hidePage) {\r\n      config.hidePage.split(',').forEach(function (name) {\r\n        me.layout.switchCommonPage(name, false);\r\n      });\r\n    }\r\n    this.activePage = createPage.call(this, $.extend(config,{\r\n      \"pageType\": \"extendPage\"\r\n    }));\r\n    this.layout.renderPage();\r\n  },\r\n  /**\r\n   * 获取当前页类型\r\n   * @returns {number}\r\n   */\r\n  'getPageType': function () {\r\n    if (this.activePage) {\r\n      switch (this.activePage.pageType) {\r\n        case 'extendPage':\r\n          return 1;\r\n        default:\r\n          return 0;\r\n      }\r\n    }\r\n    return 0;\r\n  },\r\n  /**\r\n   * 关闭拓展页\r\n   */\r\n  'closeExtendPage': function () {\r\n    this.refPathParser = this.oriRefPathParse\r\n    var _refPath = this.getRefPathParser().getRefPath();\r\n    icCreatePlayer.ref_path = _refPath['ref-path'];\r\n    icCreatePlayer.ref_path_addon = _refPath['ref-path-addon'];\r\n    icCreatePlayer.ref_path_tool = window.decodeURIComponent(require('core.utils.request')('ref-path-tool')) || this.playerCode;\r\n    this.gotoPageIndex(this.currentPageIndex);\r\n  },\r\n  'mediaPause': function () {\r\n    try {\r\n      var mediaTags = [\"video\", \"audio\"];\r\n      var docs = [document];\r\n      var iframes = document.getElementsByTagName(\"iframe\");\r\n      for (var i = 0, iframe; iframe = iframes[i]; i++) {\r\n        if (iframe.src) {\r\n          docs.push(iframe.contentWindow.document);\r\n        }\r\n      }\r\n      mediaTags.forEach(function (tagName) {\r\n        docs.forEach(function (doc) {\r\n          var mediaElList = doc.getElementsByTagName(tagName),\r\n            mediaEl;\r\n          for (i = 0; mediaEl = mediaElList[i]; i++) {\r\n            mediaEl.pause && mediaEl.pause();\r\n          }\r\n        });\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n\r\n  },\r\n  renderModel: function (model, baseUrl) {\r\n    playerConfig.loadCss(model && model.getAttribute('css'));\r\n    var pageConfig = {\r\n      'url': ''\r\n    };\r\n    this.commonPages = new table();\r\n    if (this.pageUrl) {\r\n      pageConfig = {\r\n        url: this.pageUrl\r\n      };\r\n    } else if (model) {\r\n      var me = this;\r\n      this.pages = model.getPages();\r\n      this.pages.forEach(function (page) {\r\n        page.preview = page.preview && urlUtil.resolve(baseUrl, page.preview);\r\n      });\r\n      //获取开始页码\r\n      if (this.startPageIndex) {\r\n        this.currentPageIndex = parseInt(this.startPageIndex, 10);\r\n      } else if (this.startPageId) {\r\n        this.currentPageIndex = this.pages.getIndexOfById(this.startPageId);\r\n      } else if (this.startPageName) {\r\n        this.currentPageIndex = this.pages.getIndexOfByName(this.startPageName);\r\n      }\r\n      if (this.currentPageIndex >= 0) {\r\n        pageConfig = this.pages.getByIndex(this.currentPageIndex);\r\n      }\r\n      //定制播放器上配置的通用页\r\n      this.commonPages = playerConfig.getCommons(this.commonPages, functionUtil.createDelegate(createPage, null, null, this));\r\n      if (this.hidePage) {\r\n        this.hidePage.split(',').forEach(function (name) {\r\n          me.commonPages.removeItem(name);\r\n        });\r\n      }\r\n    }\r\n    this.activePage = createPage.call(this, pageConfig);\r\n  },\r\n  createController: function () {\r\n    return require('core.common.player.controller').createController.apply(this);\r\n  },\r\n  getPresenter: function (name) {\r\n    var presenter = playerConfig.getPresenter(name);\r\n    if (presenter) {\r\n      presenter.refPathParser = this.getRefPathParser('playerConfig');\r\n    }\r\n    return presenter;\r\n  },\r\n  getPaint: function () {\r\n    return this.toolPaint;\r\n  },\r\n\r\n  getEventName: function () {\r\n    return eventname;\r\n  },\r\n  getUtils: function () {\r\n    return icCreatePlayer.utils;\r\n  },\r\n  /**\r\n   * update tool box's display title, push button and so on\r\n   */\r\n  updateToolProperties: function (stoolkey, dtoolkey) {\r\n    this.TOOL.TOOLCONTROL.updateToolProperties.apply(this, [stoolkey, dtoolkey]);\r\n  },\r\n  /**\r\n   * [addTool description]\r\n   * @param {[type]} url           [description]\r\n   * @param {[type]} options       [options.width=\"100%\"; options.__sys={syncId:'',hide:['header','toolbar'],disable:['min','move','close']}]\r\n   * @param {[type]} state         [description]\r\n   * @param {[type]} extendOptions [description]\r\n   */\r\n  addTool: function (url, options, state, extendOptions) {\r\n    return this.TOOL.TOOLCONTROL.addTool.apply(this, [url, options, state, extendOptions]);\r\n  },\r\n  getToolList: function () {\r\n    return this.TOOL.TOOLCONTROL.getToolList.apply(this);\r\n  },\r\n  /**\r\n   * 判断是否已经超过限制\r\n   * @param listType:bottom工具窗，top:上层的工具\r\n   * @returns {boolean}\r\n   */\r\n  isMaxToolCount: function (listType) {\r\n    return this.TOOL.TOOLCONTROL.isMaxToolCount.apply(this, [listType]);\r\n  },\r\n  clearTool: function () {\r\n    this.TOOL.TOOLCONTROL.clearTool.apply(this);\r\n  },\r\n\r\n  //兼容处理，由于unqiueId与toolKey不可能 一样 把unqiueId也可能为toolKey\r\n  removeTool: function (unqiueId, scope, NONEventFlag) {\r\n    this.TOOL.TOOLCONTROL.removeTool.apply(this, [unqiueId, scope, NONEventFlag]);\r\n  },\r\n  parser: mainParser,\r\n  layout: 'div',\r\n  //兼容之前的版本\r\n  'getPlayerServices': function () {\r\n    return this.getController();\r\n  },\r\n  'onPageLoaded': function (fn) {\r\n    this.addEventListener('PageLoaded', fn, this);\r\n  },\r\n  /**\r\n   * 以后学科工具相关的API移至TOOL下面\r\n   */\r\n  TOOL: {\r\n    TOOLCONTROL: {},\r\n    DATA: {\r\n      bottom: {\r\n        'MAXLIMIT': request('bottomlimit') || 3\r\n      },\r\n      top: {\r\n        'MAXLIMIT': request('toplimit') || 10000\r\n      },\r\n      PUSHING: false,\r\n      CURRENTPUSHTOOL: null,\r\n      DIALOG: {\r\n        STEPLEFT: 0,\r\n        STEPTOP: 0\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.player.tool', function (exports,module,require,$) {\r\n'use strict';\r\nvar parser = require('core.model.parser.toolParser'),\r\n  createModel = require('core.common.createModel'),\r\n  logger = require('core.utils.Log'),\r\n  Layout = require('core.layout.Layout'),\r\n  eventname = require('core.eventbus.eventname'),\r\n  playerException = require('core.exception.playerException'),\r\n  isInPath = require('core.common.ispointinpath'),\r\n  pptshell = require('core.bridge.pptshell'),\r\n  stringUtil = require('core.utils.string'),\r\n  tHelper = require('core.common.tool.tool'),\r\n  toolLayout = require('core.common.layout.tool'),\r\n  tooldialog = require('core.common.tool.tooldialog'),\r\n  toolPush = require('core.common.tool.toolpush'),\r\n  throttle = require('core.utils.throttle'),\r\n  singleTools = {},\r\n  toolLoadState = {}, //有三种状态 none,pending,done\r\n  htmlMapping = {\r\n    'up': '<div class=\"ic_tool\"><div class=\"com_tooldialog_pop dialog_${id}\" style=\"display:none;z-index:9999;position:fixed\"><div class=\"com_tooldialog_pop_box\"><div class=\"com_tooldialog_pop_main\"><p class=\"com_tooldialog_pop_txt\">${tip_for_xp}</p></div></div></div></div>',\r\n    'down': '<div class=\"tooldialog_control ${id}\" style=\"visibility: hidden\"><div class=\"tooldialog_wrap\"><div class=\"com_tooldialog_pop com_tooldialog_pop_tips hide_dom _icplayer_fullscreen_tip\"><div class=\"com_tooldialog_pop_box\"><div class=\"com_tooldialog_pop_main\"><p class=\"com_tooldialog_pop_txt\">${tip_full}</p></div></div></div><div class=\"tooldialog_head\"><p class=\"tooldialog_title\"><span class=\"tooldialog_title_icon\"><img src=\"${smallIcon}\"/></span><em class=\"title\">${toolName}</em></p><div class=\"tooldialog_com_header_time\" style=\"display:none\"><div class=\"tooldialog_com_time\"><div class=\"tooldialog_time_default \"><span class=\"tooldialog_time_m\"><em>00</em></span><i>:</i><span class=\"tooldialog_time_s\"><em>00</em></span></div></div></div><div class=\"tooldialog_headleft\"></div></div><div class=\"tooldialog_content\"></div><div class=\"sidetool lefttool\"><div class=\"tool_wrap\"><a class=\"_icplayer_push_button btn_tool tool_push ${ispushing}\" style=\"display: ${display}\"><div class=\"tool_push_icon\"><div class=\"tool_push_icon_main\"><span class=\"tool_push_icon_nor\"></span><span class=\"tool_push_icon_end\"></span></div></div></a><a class=\"btn_tool tool_small\"></a><div class=\"tool_ctrol\"><a class=\"btn_tool tool_close\"></a><div class=\"tool_tip tool_tip_small\" style=\"display: none;\"><div class=\"tool_tip_wrap\"><p class=\"tip_text\" style=\"display: none;\" id=\"tip_next_push\"><em class=\"text\">${pushed_tip}</em></p><p class=\"tip_text\"><em class=\"text\">${tip}</em></p><a class=\"btn_tool_tip\"><em class=\"btn_text\">${sure}</em></a><a                                class=\"btn_tool_tip\"><em class=\"btn_text\">${cancel}</em></a></div></div></div><a class=\"btn_tool tool_full\"></a><a class=\"btn_tool to_fullscreen _icplayer_tool_fullscreen\"></a></div><div class=\"tool_wrap_mask hide_dom\"></div></div><div class=\"sidetool righttool\"><div class=\"tool_wrap\"><a class=\"_icplayer_push_button btn_tool tool_push ${ispushing}\" style=\"display: ${display}\"><div class=\"tool_push_icon\"><div class=\"tool_push_icon_main\"><span class=\"tool_push_icon_nor\"></span><span class=\"tool_push_icon_end\"></span></div></div></a><a class=\"btn_tool tool_small\"></a><div class=\"tool_ctrol\"><a class=\"btn_tool tool_close\"></a><div class=\"tool_tip tool_tip_small\" style=\"display: none;\"><div class=\"tool_tip_wrap\"><p class=\"tip_text\" id=\"tip_next_push\" style=\"display: none;\"><em class=\"text\">${pushed_tip}</em></p><p class=\"tip_text\"><em class=\"text\">${tip}</em></p><a class=\"btn_tool_tip\"><em class=\"btn_text\">${sure}</em></a><a                                class=\"btn_tool_tip\"><em class=\"btn_text\">${cancel}</em></a></div></div></div><a class=\"btn_tool tool_full\"></a><a class=\"btn_tool to_fullscreen _icplayer_tool_fullscreen\"></a></div><div class=\"tool_wrap_mask hide_dom\"></div></div><div class=\"com_tooldialog_pop dialog_${id}\" style=\"display:none;z-index:9999\"><div class=\"com_tooldialog_pop_box\"><div class=\"com_tooldialog_pop_main\"><p class=\"com_tooldialog_pop_txt\">${tip_for_xp}</p></div><div class=\"com_tooldialog_pop_foot\"><a class=\"com_tooldialog_pop_btn close_${id}\">${close}</a></div></div></div></div></div>'\r\n  },\r\n  defaultToolPosition = {\r\n    top: 0,\r\n    left: 0,\r\n    visibility: 'visible'\r\n  },\r\n  _left = 0,\r\n  _top = 0,\r\n  _position = [],\r\n  _maxCount = 3,\r\n  itemLayout = {\r\n    'right': 'tooldialog_com_header_time',\r\n    'left': 'tooldialog_headleft'\r\n  };\r\n\r\nvar adjustLeftTop = function () {\r\n  var me = this;\r\n  if (me.top.toolList.list.bottom.length === 0) {\r\n    _left = _top = 0;\r\n  }\r\n  if (me.toolConfig.independent !== true) {\r\n    if (!me.top.TOOL.DATA.PUSHING) {\r\n      me.element.find('.tool_push').removeClass('on');\r\n    }\r\n    //100%模式。只支持一个工具\r\n    if (me.dialogModel.__type !== 'pc') {\r\n      me.element.css({\r\n        'visibility': 'visible'\r\n      });\r\n    } else {\r\n      var left = Math.floor(($('body').width() - icCreatePlayer.fontSize * 60) / 2) + _left;\r\n      var top = Math.floor(($('body').height() - icCreatePlayer.fontSize * 33.75) / 2) + _top;\r\n      me.top.TOOL.DATA.DIALOG.STEPLEFT = icCreatePlayer.fontSize * 4 * 0.75;\r\n      me.top.TOOL.DATA.DIALOG.STEPTOP = icCreatePlayer.fontSize * 2.66667 * 0.75;\r\n      if (_position.length === 0) {\r\n        _position = [{\r\n          used: false,\r\n          unqiueId: undefined,\r\n          left: left,\r\n          top: top\r\n        }, {\r\n          used: false,\r\n          unqiueId: undefined,\r\n          left: left + me.top.TOOL.DATA.DIALOG.STEPLEFT,\r\n          top: top + me.top.TOOL.DATA.DIALOG.STEPTOP\r\n        }, {\r\n          used: false,\r\n          unqiueId: undefined,\r\n          left: left + 2 * me.top.TOOL.DATA.DIALOG.STEPLEFT,\r\n          top: top + 2 * me.top.TOOL.DATA.DIALOG.STEPTOP\r\n        }];\r\n      }\r\n      var index = tHelper.getPositionIndex(_position);\r\n      me.element.css({\r\n        'left': _position[index].left,\r\n        'top': _position[index].top,\r\n        'visibility': 'visible'\r\n      });\r\n      tHelper.updatePositionUsed(_position, index, me.unqiueId);\r\n    }\r\n  }\r\n}\r\nvar toolInit = function () {\r\n  var me = this;\r\n  var _options = me.options;\r\n  if (this.toolConfig) {\r\n    //this.options.__sys.toolKey = this.key;\r\n    this.options.__sys.toolKey = this.toolKey;\r\n    var promise = toolExecute.apply(this, arguments);\r\n    return $.when(promise).then(function () { });\r\n  }\r\n};\r\n\r\nvar hideTip = function (tip) {\r\n\tsetTimeout(function(){tip.addClass('hide_dom')},2000)\r\n}\r\n\r\nvar setState = function () {\r\n  var me = this;\r\n  this.items.forEach(function (item) {\r\n    if (!item.isRequire && me.state) {\r\n      me.state = JSON.parse(me.state);\r\n      var stateValue = me.state[me.toolKey + me.syncId];\r\n      if (stateValue) {\r\n        item.setState([stateValue, me.options || {}]);\r\n      }\r\n    }\r\n  });\r\n};\r\nvar toolExecute = function (options) {\r\n  var deferred = jQuery.Deferred();\r\n  if (this.toolConfig) {\r\n    var executeName = this.toolConfig.execute;\r\n    if (executeName) {\r\n      this.top.toolList.active = (this.toolConfig.independent === true) ? 'top' : 'bottom';\r\n      var __options = this.options;\r\n      // delete __options.__sys;\r\n      return this.mainModule.runInterface(executeName, options || this.options.executeArgs || __options);\r\n    } else {\r\n      deferred.resolve();\r\n    }\r\n  } else {\r\n    deferred.resolve();\r\n  }\r\n\r\n};\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n  extend: \"core.player.ModuleGroup\",\r\n  'static': {\r\n    'getItemRender': function (name) {\r\n      return '.tooldialog_head > .' + itemLayout[name];\r\n    },\r\n    'getTool': function (url, options, toolList) {\r\n      var key = tHelper.getToolKey(url, options);\r\n      if (options && options.toolKey) {\r\n        key = options.toolKey;\r\n      }\r\n      var tool = singleTools[key];\r\n      if (tool) {\r\n        toolExecute.call(tool.instance, options);\r\n        return tool.instance;\r\n      } else {\r\n        tool = toolList.filter(function (item) {\r\n          return (key === tHelper.getToolKey(item.key) && item.syncId === options.__sys.syncId);\r\n        });\r\n        tool = tool[0];\r\n        if (tool) {\r\n          toolExecute.call(tool, options);\r\n          return tool;\r\n        }\r\n      }\r\n    },\r\n    'removeTool': function (url) {\r\n      var key = tHelper.getToolKey(url),\r\n        tool = singleTools[key];\r\n      if (tool) {\r\n        toolLoadState[key] = undefined;\r\n        singleTools[key] = undefined;\r\n      }\r\n    },\r\n    'toolLoadState': toolLoadState,\r\n    'singleTools': singleTools,\r\n    /**\r\n     * 关闭\r\n     * @return {[type]} [description]\r\n     */\r\n    'bridgeClose': function () {\r\n      pptshell.tool.close();\r\n    }\r\n  },\r\n  initComponent: function () {\r\n    require(\"core.player.Tool\").prototype.superClass.initComponent.call(this);\r\n    this.syncId = this.unqiueId;\r\n    this.dialogModel = tHelper.getDialogModel(this.options);\r\n    this.toolKey = tHelper.getToolKey(this.key);\r\n    if (this.options.__sys.syncId) {\r\n      this.syncId = this.options.__sys.syncId;\r\n    } else {\r\n      this.options.__sys.syncId = this.syncId;\r\n    }\r\n    this.addEvents(\r\n      //学科工具上移动鼠标(pad上对应touch)\r\n      'mousemove',\r\n      //学科工具上点下鼠标(pad上对应touch)\r\n      'mousedown',\r\n      //学科工具上放开鼠标(pad上对应touch)\r\n      'mouseup');\r\n  },\r\n  createController: function () {\r\n    var me = this;\r\n    return {\r\n      'getCommands': function () {\r\n        return {\r\n          'closeTool': function (NONEventFlag) {\r\n            me.release(NONEventFlag);\r\n          }\r\n        };\r\n      }\r\n    };\r\n  },\r\n  show: function (cssOption) {\r\n    if (cssOption) {\r\n      this.element.css(cssOption);\r\n    } else {\r\n      this.element.show();\r\n    }\r\n  },\r\n  hide: function (cssOption) {\r\n    if (cssOption) {\r\n      this.element.css(cssOption);\r\n    } else {\r\n      this.element.hide();\r\n    }\r\n  },\r\n\r\n  getState: function () {\r\n    var value, stateMap = {};\r\n    this.items.forEach(function (item) {\r\n      value = item.getState();\r\n      if (value) {\r\n        stateMap[item.parent.toolKey + item.parent.syncId] = value;\r\n      }\r\n    });\r\n    return stateMap;\r\n  },\r\n  'moduleGroupType': 'tool',\r\n  renderModel: function (model, baseurl) {\r\n    require(\"core.player.Tool\").prototype.superClass.renderModel.call(this, model);\r\n    model = model.getValue();\r\n    var me = this,\r\n      el;\r\n    return createModel(model.properties, baseurl, this.getRefPathParser())\r\n      .then(function (_model) {\r\n        me.toolConfig = _model;\r\n        if (window.icCreatePlayer.request('hidepush') === 'true') {\r\n          _model.push = false;\r\n        }\r\n        if (_model.toolKey === undefined)\r\n          _model.toolKey = me.toolKey;\r\n        var _listType = _model.independent ? 'top' : 'bottom';\r\n        if (_listType === 'top' && icCreatePlayer.plugin.webglControl) {\r\n          var topExcess = icCreatePlayer.plugin.webglControl.isToolsExcess(me.toolKey);\r\n          if (topExcess) {\r\n            toolLoadState[me.toolKey] = undefined;\r\n            return $.Deferred().reject(playerException.create('top tool exceed max', new Error(\"player 11.7.3: \" + \"exceed max\")));\r\n          }\r\n        } else {\r\n          if (tHelper.isOverMaxLimit(me.top, _listType)) {\r\n            toolLoadState[me.toolKey] = undefined;\r\n            var limitClass = '._icplayer_limit_tip'\r\n            var _tip = me.top.layout.$toolTarget.find(limitClass).find('.com_tooldialog_pop_txt');\r\n            _tip.find('#maxlimit').html(me.top.TOOL.DATA[_listType].MAXLIMIT);\r\n            _tip.find('#classtool').html(me.top.getI18nModel().player['Tool_' + _listType])\r\n            me.top.layout.$toolTarget.find(limitClass).show();\r\n            window.setTimeout(function () {\r\n              me.top.layout.$toolTarget.find(limitClass).hide();\r\n            }, 3000);\r\n            return $.Deferred().reject(playerException.create('exceed max', new Error(\"player 11.7.3: \" + \"exceed max\")));\r\n          }\r\n        }\r\n        if (_model.toolType === 'pageTool') {\r\n          el = $(htmlMapping.up);\r\n          me.top.activePage.element.append(el)\r\n          me.element = el;\r\n        } else if (_listType === 'bottom') {\r\n          var modelType = me.dialogModel;\r\n          if (modelType.__type == 'pc' && me.toolConfig.enableFull === true) {\r\n            modelType.disabledFull = false\r\n            modelType.no_full = false\r\n          } else if (modelType.__type == 'pc' && me.toolConfig.enableFull === false) {\r\n            modelType.disabledFull = true\r\n            modelType.no_full = false\r\n          } else {\r\n            modelType.disabledFull = true\r\n            modelType.no_full = true\r\n          }\r\n          el = $(stringUtil.applyTemplate(htmlMapping.down, {\r\n            'toolName': me.options.__sys.toolName || ((_model.toolKey ? tHelper.getToolNameI18n(me.top.getI18nModel().tool, _model.toolKey) : _model.toolName)),\r\n            'display': (_model.push ? 'block' : 'none'),\r\n            'smallIcon': (_model.smallIcon || ''),\r\n            'ispushing': toolPush.pushDomStatus.apply(me) ? 'on' : 'click_disabled',\r\n            'push': (me.top.getI18nModel().player['Tool_Push']),\r\n            'pushed_tip': (me.top.getI18nModel().player['Tool_Pushed_Tip']),\r\n            'tip': (me.top.getI18nModel().player['Tool_Tip']),\r\n            'cancel': (me.top.getI18nModel().player['Tool_Cancel']),\r\n            'sure': (me.top.getI18nModel().player['Tool_Sure']),\r\n            'id': me.unqiueId,\r\n            'tip_full': (me.top.getI18nModel().player['Tool_full']),\r\n            'tip_for_xp': (me.top.getI18nModel().player['Tool_Not_Support']),\r\n            'close': (me.top.getI18nModel().player['Tool_See'])\r\n          }));\r\n          me.element.append(el);\r\n          tooldialog.setDisplayMode.apply(me, [modelType, false, el])\r\n          me.element = el;\r\n          me.layoutTarget = me.element.find('.tooldialog_content');\r\n          tooldialog.initEvent.apply(me, [modelType]);\r\n          if (_model.supportXP === false && icCreatePlayer.utils.getOS() === \"xp\") {\r\n            me.element.find('.dialog_' + me.unqiueId).css(\"display\", \"\")\r\n            if (me.dialogModel && (me.dialogModel.disabledClose || me.dialogModel.__type === \"pre\")) {\r\n              me.element.find('.close_' + me.unqiueId).css(\"display\", \"none\")\r\n            }\r\n            me.element.find('.close_' + me.unqiueId).click(function () {\r\n              me.container.find('.sideicon.' + me.unqiueId).remove();\r\n              me.release()\r\n            })\r\n          }\r\n        } else {\r\n          el = $(stringUtil.applyTemplate(htmlMapping.up, {\r\n            'id': me.unqiueId,\r\n            'tip_for_xp': (me.top.getI18nModel().player['Tool_Not_Support'])\r\n          }));\r\n          me.element.parent().append(el);\r\n          me.element = el;\r\n          if (_model.supportXP === false && icCreatePlayer.utils.getOS() === \"xp\") {\r\n            me.element.find('.dialog_' + me.unqiueId).css(\"display\", \"\")\r\n            hideTip(me.element.find('.dialog_' + me.unqiueId))\r\n            toolLoadState[me.toolKey] = undefined;\r\n            return $.Deferred().reject(playerException.create('top tool exceed max', new Error(\"player 11.7.3: \" + \"exceed max\")));\r\n          }\r\n        }\r\n\r\n        adjustLeftTop.apply(me);\r\n        me.toolConfig.execute = me.toolConfig.execute || 'execute';\r\n        toolLoadState[me.toolKey] = 'done';\r\n        if (me.toolConfig.singleton) {\r\n          singleTools[me.toolKey] = {\r\n            instance: me,\r\n            count: 1\r\n          };\r\n        }\r\n        me.layoutConfig = $.extend({},\r\n          defaultToolPosition,\r\n          Layout.createLayoutConfig(model.layout),\r\n          Layout.createLayoutConfig(me.options, ['visibility', 'display']));\r\n        if (_model.independent === true) {\r\n          me.element.css(me.layoutConfig);\r\n        }\r\n        me.mainModule = me.items.getByKey(model.mainModule);\r\n        toolLayout.setToolZIndex.apply(me.top.layout, [me]);\r\n      });\r\n  },\r\n  getRefPathParser: function () {\r\n    return this.top.getRefPathParser('tool');\r\n  },\r\n  getZIndex: function () {\r\n    return this.element.css('z-index');\r\n  },\r\n  release: function (NONEventFlag) {\r\n    var me = this;\r\n    toolLoadState[me.toolKey] = undefined;\r\n    tHelper.delPositionUnqiueId(_position, me.unqiueId);\r\n    if ($(me.top.layout.$toolTarget.find('._icplayer_limit_tip')).css(\"visibility\") != \"hidden\") {\r\n      me.top.layout.$toolTarget.find('._icplayer_limit_tip').hide();\r\n    }\r\n    if (!NONEventFlag) {\r\n      me.top.fireEvent(require('core.eventbus.eventname').tool.close, me);\r\n    }\r\n    require(\"core.player.Tool\").prototype.superClass.release.call(this);\r\n  },\r\n  push: function () {\r\n    toolPush.push.apply(this)\r\n  },\r\n  stopPush: function () {\r\n    toolPush.stopPush.apply(this)\r\n  },\r\n  isPointInPath: function (x, y) {\r\n    return isInPath(this, x, y);\r\n  },\r\n  /**\r\n   * 切换工具窗口的背景\r\n   * @param enable\r\n   */\r\n  switchToolContainerBG: function (enable) {\r\n    if (enable) {\r\n      this.container.parent().css('background-color', 'rgba(0,0,0,0.6)');\r\n    } else {\r\n      this.container.parent().css('background-color', '');\r\n    }\r\n  },\r\n  'modulelifeCycles': ['run', setState, 'show', 'afterRender', toolInit],\r\n  parser: parser\r\n};\r\n\r\n}, 'class');\n__applicationContext.define('core.state.localstoragecontroller', function (exports,module,require,$) {\r\n'use strict';\r\nvar key = '$$icplayerState';\r\nmodule.exports = {\r\n    'write': function (object) {\r\n        try {\r\n            localStorage.setItem(key, JSON.stringify(object));\r\n        } catch (ex) {\r\n            // ios 无痕模式下不支持，但是存在localStorage.setItem  \r\n        }\r\n    },\r\n    'read': function () {\r\n        return JSON.parse(localStorage.getItem(key) || '{}');\r\n    },\r\n    'clear': function () {\r\n        try {\r\n            localStorage.setItem(key, '');\r\n        } catch (ex) {\r\n            // ios 无痕模式下不支持，但是存在localStorage.setItem  \r\n        }\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.state.simplestate', function (exports,module,require,$) {\r\n'use strict';\r\nvar localStorageController = require('core.state.localStorageController');\r\n\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor: function (stateToken) {\r\n        this.data = {};\r\n        this.stateToken = stateToken;\r\n        if (this.stateToken) {\r\n            this.read();\r\n        } else {\r\n            localStorageController.clear();\r\n        }\r\n    },\r\n    addStates: function (state) {\r\n        $.extend(this.data, state);\r\n    },\r\n    getState: function (key) {\r\n        return this.data[key];\r\n    },\r\n    loadFromString: function (value) {\r\n        if (value) {\r\n            var state = JSON.parse(value);\r\n            this.addStates(state);\r\n        }\r\n    },\r\n    getAsString: function () {\r\n        return JSON.stringify(this.data);\r\n    },\r\n    readState: function () {\r\n        return localStorageController.read()[this.stateToken] || {};\r\n    },\r\n    writeState: function (state) {\r\n        var lsState = {};\r\n        lsState[this.stateToken] = state;\r\n        localStorageController.write(lsState);\r\n    },\r\n    read: function () {\r\n        if (this.stateToken) {\r\n            //读取stateToken对应的值\r\n            var lsState = this.readState();\r\n            for (var name in lsState) {\r\n                this.loadFromString(lsState[name]);\r\n            }\r\n            //只保留lsStateToken对应的值\r\n            this.writeState(lsState);\r\n        }\r\n    },\r\n    writePageState: function (pageName, state) {\r\n        if (this.stateToken) {\r\n            var lsState = this.readState();\r\n            lsState[pageName] = state;\r\n            this.writeState(lsState);\r\n        }\r\n    }\r\n};\r\n}, 'class');\n__applicationContext.define('core.utils.baseundo', function (exports,module,require,$) {\r\n'use strict';\r\n\r\n//载取\r\nfunction truncate(stack, limit) {\r\n    while (stack.length > limit) {\r\n        stack.shift();\r\n    }\r\n}\r\n/**\r\n * SimpleUndo is a very basic javascript undo/redo stack for managing histories of basically anything.\r\n * \r\n * options are: {\r\n * \t* `provider` : required. a function to call on `save`, which should provide the current state of the historized object through the given \"done\" callback\r\n * \t* `maxLength` : the maximum number of items in history\r\n * \t* `opUpdate` : a function to call to notify of changes in history. Will be called on `save`, `undo`, `redo` and `clear`\r\n * }\r\n * \r\n */\r\nmodule.type = 'class';\r\nmodule.exports = {\r\n    constructor:function(options){\r\n        var settings = options ? options : {};\r\n        var defaultOptions = {\r\n            provider: function () {\r\n                throw new Error(\"player 11.7.3: \" + \"No provider!\");\r\n            },\r\n            maxLength: 30,\r\n            onUpdate: function () { }\r\n        };\r\n\r\n        this.provider = (typeof settings.provider != 'undefined') ? settings.provider : defaultOptions.provider;\r\n        this.maxLength = (typeof settings.maxLength != 'undefined') ? settings.maxLength : defaultOptions.maxLength;\r\n        this.onUpdate = (typeof settings.onUpdate != 'undefined') ? settings.onUpdate : defaultOptions.onUpdate;\r\n\r\n        this.initialItem = null;\r\n        this.clear();\r\n    },\r\n     //初始化\r\n    initialize: function (initialItem) {\r\n        this.stack[0] = initialItem;\r\n        this.initialItem = initialItem;\r\n    },\r\n    //清除\r\n    clear: function () {\r\n        this.stack = [this.initialItem];\r\n        this.position = 0;\r\n        this.onUpdate();\r\n    },\r\n    //保存\r\n    save: function () {\r\n        this.provider(function (current) {\r\n            truncate(this.stack, this.maxLength);\r\n            this.position = Math.min(this.position, this.stack.length - 1);\r\n\r\n            this.stack = this.stack.slice(0, this.position + 1);\r\n            this.stack.push(current);\r\n            this.position++;\r\n            this.onUpdate();\r\n        }.bind(this));\r\n    },\r\n    //撤销\r\n    undo: function (callback) {\r\n        if (this.canUndo()) {\r\n            var item = this.stack[--this.position];\r\n            this.onUpdate();\r\n\r\n            if (callback) {\r\n                callback(item);\r\n            }\r\n        }\r\n    },\r\n    //重做\r\n    redo: function (callback) {\r\n        if (this.canRedo()) {\r\n            var item = this.stack[++this.position];\r\n            this.onUpdate();\r\n\r\n            if (callback) {\r\n                callback(item);\r\n            }\r\n        }\r\n    },\r\n    //是否可撤消\r\n    canUndo: function () {\r\n        return this.position > 0;\r\n    },\r\n    //是否可重做\r\n    canRedo: function () {\r\n        return this.position < this.count();\r\n    },\r\n    //获取个数\r\n    count: function () {\r\n        return this.stack.length - 1; // -1 是由于initialize initialItem\r\n    }\r\n};\r\n\r\n\r\n\r\n}, 'class');\n__applicationContext.define('core.utils.class', function (exports,module,require,$) {\r\n'use strict';\r\n\r\nvar createReg = function (regArray) {\r\n    if ($.isArray(regArray)) {\r\n        var sReg = \"^(\" + regArray.join(\"|\") + \")$\";\r\n        return new RegExp(sReg);\r\n    }\r\n};\r\n\r\nvar override = function (source, target, extendAttribute) {\r\n    var value;\r\n    for (var key in target) {\r\n        value = target[key];\r\n        if (extendAttribute && (key in source) && extendAttribute.test(key)) {\r\n            var superValue = source[key];\r\n            if ($.isArray(superValue)) {\r\n                value = source[key].concat(value);\r\n            } else {\r\n                value = $.extend(superValue, value);\r\n            }\r\n        }\r\n        source[key] = value;\r\n    }\r\n};\r\nvar classHelper = {\r\n    \"extend\": function (subClass, superClass, overrides) {\r\n        //参数多态修正\r\n        if (arguments.length === 2) {\r\n            //子类直接延用父类的构造函数\r\n            overrides = superClass;\r\n            superClass = subClass;\r\n            subClass = function () {\r\n                superClass.apply(this, arguments);\r\n            };\r\n        } else if (!subClass || subClass === Object) {\r\n            subClass = function () {\r\n                superClass.apply(this, arguments);\r\n            };\r\n        }\r\n        //设定空的构造函数,防止子类继承构造函数\r\n        var F = function () {\r\n        };\r\n        var superClassPrototype = F.prototype = superClass.prototype;\r\n        subClass.prototype = new F();\r\n        subClass.prototype.constructor = subClass;\r\n        subClass.prototype.superClass = superClassPrototype;\r\n        overrides = overrides || {};\r\n        //指定继承的属性(数组和对象),不是完全覆盖\r\n        var extendAttribute = createReg(overrides.__extendAttribute);\r\n        delete overrides.__extendAttribute;\r\n        override(subClass.prototype, overrides, extendAttribute);\r\n        //父类如果是普通对象,重新定义构造函数\r\n        if (superClass.prototype.constructor === Object.prototype.constructor) {\r\n            superClass.prototype.constructor = superClass;\r\n        }\r\n        return subClass;\r\n    },\r\n    \"create\": function (classDef, className) {\r\n        var subClass = classDef.constructor;\r\n        delete classDef.constructor;\r\n        var staticDef = classDef.static;\r\n        delete classDef.static;\r\n        if (classDef.extend) {\r\n            var superClass = require(classDef.extend);\r\n            delete classDef.extend;\r\n            subClass = classHelper.extend(subClass, superClass, classDef);\r\n        } else {\r\n            //use strict模式下不允许更改Object的prototype\r\n            if (subClass === Object) {\r\n                subClass = function () {\r\n                    Object.prototype.constructor.apply(this, arguments);\r\n                };\r\n            }\r\n            subClass.prototype = classDef;\r\n        }\r\n        subClass.prototype.className = className;\r\n        $.extend(subClass, staticDef);\r\n        return subClass;\r\n    }\r\n};\r\nmodule.exports = classHelper;\r\n}, '');\n__applicationContext.define('core.utils.detector', function (exports,module,require,$) {\r\n'use strict';\r\nvar rotate = require('core.utils.transform');\r\nvar rgba = [0, 0, 0, 0];\r\nvar getImageData = function (ctx, x, y) {\r\n\tvar flag = false;\r\n\tvar imageData = ctx.getImageData(x, y, 1, 1);\r\n\tfor (var i = 0; i < rgba.length; i++) {\r\n\t\tif (imageData.data[i] !== rgba[i]) {\r\n\t\t\tflag = true;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn flag;\r\n};\r\n//canvas模式判断是否选中\r\nvar canvasMode = function (canvas, event) {\r\n\ttry {\r\n\t\tvar rotateAngle, finalXY;\r\n\t\tvar x = event.pageX || (event.changedTouches ? event.changedTouches[0].pageX : 0),\r\n\t\t\ty = event.pageY || (event.changedTouches ? event.changedTouches[0].pageY : 0);\r\n\t\tvar ctx = canvas.getContext('2d');\r\n\t\trotateAngle = rotate.getRotateDeg(canvas); //这里取返就是为了算相对位置直接取旋转前的X,Y，\r\n\t\tfinalXY = rotate.getRotateXY(x, y, rotateAngle, canvas);\r\n\t\treturn getImageData(ctx, finalXY.x, finalXY.y);\r\n\t} catch (e) {\r\n\t\tconsole.error(e);\r\n\t\treturn false;\r\n\t}\r\n};\r\nvar detector = {\r\n\t/**\r\n\t * 检测是否支持canvas\r\n\t * @type {[type]}\r\n\t */\r\n\tcanvas: !!window.CanvasRenderingContext2D,\r\n\t/**\r\n\t * 检测是否支持webgl\r\n\t * @param  {[type]} ) {\t\ttry       {\t\t\tvar canvas [description]\r\n\t * @return {[type]}   [description]\r\n\t */\r\n\twebgl: (function () {\r\n\r\n\t\ttry {\r\n\r\n\t\t\tvar canvas = document.createElement('canvas');\r\n\t\t\treturn !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));\r\n\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t})(),\r\n\t/**\r\n\t * 检查是否支持workers\r\n\t * @type {[type]}\r\n\t */\r\n\tworkers: !!window.Worker,\r\n\t/**\r\n\t * 检测是否支持fileapi\r\n\t * @type {[type]}\r\n\t */\r\n\tfileapi: window.File && window.FileReader && window.FileList && window.Blob,\r\n\t/**\r\n\t * 检查是否支持websocket\r\n\t * @type {[type]}\r\n\t */\r\n\twebsocket: !!window.WebSocket,\r\n\t/**\r\n\t * 检测当前运行环境Env是否已经加载\r\n\t * @return {[boolean]}   [description]\r\n\t */\r\n\tisEnvLoaded: function () {\r\n\t\ttry {\r\n\t\t\tif (typeof (isApp) !== 'undefined' && typeof (Bridge) !== 'undefined' && typeof (Bridge.callNative) !== 'undefined') {\r\n\t\t\t\treturn !!Bridge.callNative('com.nd.pad.icr.ui.IcrJsBridge', 'isEnvLoaded', {}).result;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\t/**\r\n\t * 判断当前event是否在canvas内\r\n\t * @param  {[type]}  canvas  canvas 的 dom\r\n\t * @param  {[type]}  event  \r\n\t * @return {Boolean}        [description]\r\n\t */\r\n\tisPointInPath: function (canvas, event) {\r\n\t\treturn canvasMode(canvas, event);\r\n\t},\r\n\t/**\r\n\t * 判断学生是否有在线\r\n\t * @return {Boolean} true 在线；false 不在线。\r\n\t */\r\n\tisOnline: function () {\r\n\t\tvar status = Object.create(null);\r\n\t\tif (typeof (CoursePlayer) !== 'undefined' && CoursePlayer.pptInvokeMethod) {\r\n\t\t\tvar nStatus = CoursePlayer.pptInvokeMethod(\"getOnlineStatus\", \"{}\");\r\n\t\t\tstatus = JSON.parse(nStatus);\r\n\t\t}\r\n\t\treturn status.online_status ? status.online_status : false\r\n\t}\r\n\r\n};\r\nmodule.exports = detector;\r\n}, '');\n__applicationContext.define('core.utils.dom', function (exports,module,require,$) {\r\n'use strict';\r\nvar logger = require('core.utils.log');\r\nvar head = document.head || document.getElementsByTagName('head')[0] || document.documentElement;\r\nvar _touchFlag = ('ontouchstart' in window);\r\nvar _eventName = _touchFlag ? {\r\n    down: 'touchstart',\r\n    up: 'touchend',\r\n    move: 'touchmove'\r\n} : {\r\n    down: 'mousedown',\r\n    up: 'mouseup',\r\n    move: 'mousemove'\r\n};\r\n\r\nmodule.exports = {\r\n    /**\r\n     创建Mouse事件\r\n     @param:event,当前的event事件\r\n     @param:type,mouse事件的类型\r\n     */\r\n    createMouseEvent: function (event, type) {\r\n        var evt = document.createEvent('MouseEvents');\r\n        var touches = event.changedTouches,\r\n            first = touches ? touches[0] : null;\r\n        //switch (type) {\r\n        //    case \"touchstart\": type = \"mousedown\"; break;\r\n        //    case \"touchmove\": type = \"mousemove\"; break;\r\n        //    case \"touchend\": type = \"mouseup\"; break;\r\n        //    default: ;\r\n        //}\r\n\r\n        if (_touchFlag) {\r\n            evt.initMouseEvent(type || event.type, true, true, window, 0, first.screenX, first.screenY, first.clientX, first.clientY, event.ctrlKey, event.altKey, event.shiftKey, event.metaKey, event.button, event.relatedTarget);\r\n        } else {\r\n            evt.initMouseEvent(type || event.type, true, true, window, 0, event.screenX, event.screenY, event.clientX, event.clientY, event.ctrlKey, event.altKey, event.shiftKey, event.metaKey, event.button, event.relatedTarget);\r\n        }\r\n        return evt;\r\n    },\r\n    addStyle: function (url) {\r\n        if (url) {\r\n            var css = document.createElement('link');\r\n            css.setAttribute('rel', 'stylesheet');\r\n            css.setAttribute('type', 'text/css');\r\n            css.setAttribute('href', url);\r\n            head.appendChild(css);\r\n            return css;\r\n        }\r\n    },\r\n    addScript: function (url) {\r\n        var deferred = $.Deferred();\r\n        var script = document.createElement('script');\r\n        script.async = true;\r\n        script.src = url;\r\n        script.onerror = function () {\r\n            logger.error('js script load failure:' + url);\r\n            deferred.resolve();\r\n        };\r\n        script.onload = script.onreadystatechange = function (_, isAbort) {\r\n            if (isAbort || !script.readyState || /loaded|complete/.test(script.readyState)) {\r\n                script.onload = script.onreadystatechange = null;\r\n                script = null;\r\n                if (!isAbort) {\r\n                    deferred.resolve();\r\n                } else {\r\n                    deferred.resolve();\r\n                    logger.error('js script loading is Abort:' + url);\r\n                }\r\n            }\r\n        };\r\n\r\n        head.insertBefore(script, head.firstChild);\r\n        return deferred.promise();\r\n    },\r\n    addStyleContent: function (text) {\r\n        $(\"<style type='text/css'>\" + text + \"</style>\").appendTo(\"head\");\r\n    },\r\n    addScriptContent: function (code) {\r\n        var elem = document.createElement('script');\r\n        elem.setAttribute('language', 'JavaScript');\r\n        elem.text = code;\r\n        head.appendChild(elem);\r\n    },\r\n    getEventXY: function (e) {\r\n        if (e.type !== 'touchedn') {\r\n            return {\r\n                \"x\": e.pageX || (e.touches && e.touches.length > 0 && e.touches[0].pageX) || -1,\r\n                \"y\": e.pageY || (e.touches && e.touches.length > 0 && e.touches[0].pageY) || -1\r\n            };\r\n        } else {\r\n            return {\r\n                \"x\": e.pageX || (e.changedTouches && e.changedTouches.length > 0 && e.changedTouches[0].pageX) || -1,\r\n                \"y\": e.pageY || (e.changedTouches && e.changedTouches.length > 0 && e.changedTouches[0].pageY) || -1\r\n            };\r\n        }\r\n    },\r\n    eventName: _eventName\r\n};\r\n}, '');\n__applicationContext.define('core.utils.function', function (exports,module,require,$) {\r\n'use strict';\r\nvar logger = require('core.utils.log');\r\nvar functionHelper = {\r\n    /**\r\n     * 创建函数的回调函数\r\n     * @param fn 需要创建的函数\r\n     * @param params\r\n     */\r\n    'createDelegate': function(fn, args, isAppendArgs, scope, exceptionHandler) {\r\n        return function() {\r\n            //如果创建的时候没有输入参数，使用调用的参数\r\n            var callArgs = args || arguments;\r\n            if (isAppendArgs === true) {\r\n                //arguments数组化\r\n                callArgs = Array.prototype.slice.call(arguments, 0);\r\n                callArgs = callArgs.concat(args);\r\n            }\r\n            try {\r\n                return fn.apply(scope || window, callArgs);\r\n            } catch (e) {\r\n                console.error(e);\r\n                if ($.isFunction(exceptionHandler)) {\r\n                    return exceptionHandler(e);\r\n                } else {\r\n                    throw e;\r\n                }\r\n            }\r\n        };\r\n    },\r\n    'defer': function(millis, fn, args, appendArgs, scope) {\r\n        var callFn = functionHelper.createDelegate(fn, args, appendArgs, scope);\r\n        if (millis > 0) {\r\n            return window.setTimeout(callFn, millis);\r\n        }\r\n        //直接调用，返回0的timerId\r\n        callFn();\r\n        return 0;\r\n    },\r\n    'createPromiseThen': function(deferred, fn, args, isAppendArgs, scope) {\r\n        if (!$.isFunction(deferred.reject)) {\r\n            scope = isAppendArgs;\r\n            isAppendArgs = args;\r\n            args = fn;\r\n            fn = deferred;\r\n            deferred = $.Deferred();\r\n        }\r\n        return this.createDelegate(fn, args, isAppendArgs, scope, function(e) {\r\n            deferred.reject(e);\r\n            return deferred.promise();\r\n        });\r\n    },\r\n    'execute': function(instance, injections, args, isCheck) {\r\n        //参数整理\r\n        var singleExecuteName = '';\r\n        var result = {};\r\n        if (typeof injections === 'string') {\r\n            singleExecuteName = injections;\r\n            injections = {};\r\n            injections[singleExecuteName] = args || [];\r\n        }\r\n        if (instance) {\r\n            for (var name in injections) {\r\n                var fn = instance[name];\r\n                if ($.isFunction(fn)) {\r\n                    var params = injections[name];\r\n                    var callMethod = ($.isArray(params)) ? 'apply' : 'call';\r\n                    result[name] = Function.prototype[callMethod].call(fn, instance, params);\r\n                } else if (isCheck === true) {\r\n                    logger.error(\"not exist [\" + name + '] function');\r\n                }\r\n            }\r\n        }\r\n        return (singleExecuteName) ? result[singleExecuteName] : result;\r\n    },\r\n    //顺序执行函数列表\r\n    //[{fn:function(){},args:[],scope:this}]\r\n    'runSequence': function(fnConfigs, name) {\r\n        var $promise = $.Deferred().resolve();\r\n        var runIndex;\r\n        fnConfigs.forEach(function(fnConfig, index) {\r\n            if ($.isFunction(fnConfig.fn)) {\r\n                $promise = $promise.then(function() {\r\n                    try {\r\n                        runIndex = index;\r\n                        //如果创建的时候没有输入参数，使用调用的参数\r\n                        var callArgs = fnConfig.args || arguments;\r\n                        if (fnConfig.isAppendArgs === true) {\r\n                            //arguments数组化\r\n                            callArgs = Array.prototype.slice.call(arguments, 0);\r\n                            callArgs = callArgs.concat(fnConfig.args);\r\n                        }\r\n                        logger.log(fnConfig.name);\r\n                        return fnConfig.fn.apply(fnConfig.scope || window, callArgs);\r\n                    } catch (e) {\r\n                        console.error(e);\r\n                        return $.Deferred(function(deferred) {\r\n                            deferred.reject(e);\r\n                        });\r\n                    }\r\n                }, function(message) {\r\n                    return message;\r\n                });\r\n            }\r\n        });\r\n        return $promise.fail(function(e) {\r\n            logger.error('run %s,the %d is wrong : %o', name || \" task \", ++runIndex, e || \"\");\r\n            logger.error(e);\r\n\r\n        });\r\n    }\r\n};\r\nmodule.exports = functionHelper;\r\n}, '');\n__applicationContext.define('core.utils.log', function (exports,module,require,$) {\r\n'use strict';\r\nvar errorLog = function (e) {\r\n    if (e.cause) {\r\n        errorLog(e.cause);\r\n    }\r\n    logger.error(e);\r\n};\r\nvar level = 'error';\r\n\r\n\r\nvar log = function (message, type) {\r\n    if (type === level) {\r\n        console[type](message);\r\n    }\r\n};\r\n\r\nvar logger = {\r\n    'log': function (message) {\r\n        log(\"player 11.7.3: \" + message, 'log');\r\n    },\r\n    'error': function (message, e) {\r\n        log(e,'error');\r\n        if (e) {\r\n            errorLog(e);\r\n        }\r\n    }\r\n\r\n};\r\n\r\nmodule.exports = logger;\r\n}, '');\n__applicationContext.define('core.utils.raf', function (exports,module,require,$) {\r\nvar raf = window.requestAnimationFrame;\r\nvar caf = window.cancelAnimationFrame;\r\nvar vendors = ['webkit', 'moz'];\r\nfor (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\r\n    var vp = vendors[i];\r\n    raf = window[vp + 'RequestAnimationFrame'];\r\n    caf = (window[vp + 'CancelAnimationFrame'] || window[vp + 'CancelRequestAnimationFrame']);\r\n}\r\nif (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\r\n    var lastTime = 0;\r\n    raf = function (callback) {\r\n        var now = Date.now();\r\n        var nextTime = Math.max(lastTime + 16, now);\r\n        return window.setTimeout(function () {\r\n            callback(lastTime = nextTime);\r\n        }, nextTime - now);\r\n    };\r\n    caf = window.clearTimeout;\r\n}\r\nmodule.exports = {\r\n    raf: raf,\r\n    caf: caf\r\n};\r\n}, '');\n__applicationContext.define('core.utils.request', function (exports,module,require,$) {\r\n'use strict';\r\nvar sSearch = location.search;\r\nvar oParam = {};\r\nsSearch = sSearch.substr(1, sSearch.length);\r\nvar params = sSearch.split('&');\r\nparams.forEach(function (paramExpr) {\r\n    var param = paramExpr.split('=');\r\n    var key = param[0];\r\n    if (key) {\r\n        var value = decodeURIComponent(param[1]);\r\n        oParam[key] = value;\r\n    }\r\n});\r\nvar fn = (function (sParamName) {\r\n    return oParam[sParamName] || '';\r\n});\r\nfn.get = function () {\r\n    return oParam;\r\n};\r\nmodule.exports = fn;\r\n}, '');\n__applicationContext.define('core.utils.string', function (exports,module,require,$) {\r\n'use strict';\r\nvar templateRegExp = /\\$\\{(.+?)\\}/g;\r\nmodule.exports = {\r\n    \"applyTemplate\": function (tpl, attrs) {\r\n        return tpl.replace(templateRegExp, function ($0, $1) {\r\n            return attrs[$1] || $0;\r\n        });\r\n    },\r\n    'createReg': function (array) {\r\n        return (array.length) ? new RegExp('^(' + array.join(\"|\") + ')$') : /^$/;\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.utils.throttle', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.exports = {\r\n  /*\r\n   * 频率控制 返回函数连续调用时，fn 执行频率限定为每多少时间执行一次\r\n   * @param fn {function}  需要调用的函数\r\n   * @param delay  {number}    延迟时间，单位毫秒\r\n   * @param immediate  {bool} 给 immediate参数传递false 绑定的函数先执行，而不是delay后后执行。\r\n   * @return {function}实际调用函数\r\n   */\r\n  throttle: function(fn, delay, immediate, debounce) {\r\n    var curr = +new Date(), //当前事件\r\n      last_call = 0,\r\n      last_exec = 0,\r\n      timer = null,\r\n      diff, //时间差\r\n      context, //上下文\r\n      args,\r\n      exec = function() {\r\n        last_exec = curr;\r\n        fn.apply(context, args);\r\n      };\r\n    return function() {\r\n      curr = +new Date();\r\n      context = this,\r\n        args = arguments,\r\n        diff = curr - (debounce ? last_call : last_exec) - delay;\r\n      clearTimeout(timer);\r\n      if (debounce) {\r\n        if (immediate) {\r\n          timer = setTimeout(exec, delay);\r\n        } else if (diff >= 0) {\r\n          exec();\r\n        }\r\n      } else {\r\n        if (diff >= 0) {\r\n          exec();\r\n        } else if (immediate) {\r\n          timer = setTimeout(exec, -diff);\r\n        }\r\n      }\r\n      last_call = curr;\r\n    };\r\n  },\r\n  /*\r\n   * 空闲控制 返回函数连续调用时，空闲时间必须大于或等于 delay，fn 才会执行\r\n   * @param fn {function}  要调用的函数\r\n   * @param delay   {number}    空闲时间\r\n   * @param immediate  {bool} 给 immediate参数传递false 绑定的函数先执行，而不是delay后后执行。\r\n   * @return {function}实际调用函数\r\n   */\r\n  debounce: function(fn, delay, immediate) {\r\n    return this.throttle(fn, delay, immediate, true);\r\n  }\r\n};\r\n}, '');\n__applicationContext.define('core.utils.transform', function (exports,module,require,$) {\r\n'use strict';\r\nvar findOffset = function(obj) {\r\n    var curX = 0,\r\n        curY = 0;\r\n    if (obj.offsetParent) {\r\n        do {\r\n            curX += obj.offsetLeft;\r\n            curY += obj.offsetTop;\r\n        } while (obj = obj.offsetParent);\r\n        return {\r\n            x: curX,\r\n            y: curY\r\n        };\r\n    } else\r\n        return {\r\n            \"x\": 0,\r\n            \"y\": 0\r\n        };\r\n};\r\nmodule.exports = {\r\n    //获取元素的旋转的角度\r\n    getRotateDeg: function(dom) {\r\n        var me = $(dom), angle;\r\n        var matrix = me.css(\"-webkit-transform\") ||\r\n            me.css(\"-moz-transform\") ||\r\n            me.css(\"-ms-transform\") ||\r\n            me.css(\"-o-transform\") ||\r\n            me.css(\"transform\");\r\n        if (typeof matrix === 'string' && matrix !== 'none'&&matrix!=='') {\r\n            var values = matrix.split('(')[1].split(')')[0].split(',');\r\n            var a = values[0];\r\n            var b = values[1];\r\n              angle = (Math.atan2(b, a) * (180 / Math.PI)).toFixed(3);\r\n        } else {\r\n              angle = 0;\r\n        }\r\n        return angle;\r\n    },\r\n    getRotateOriginXY: function(dom) {\r\n        var str = $(dom).css('transform-origin');\r\n        return str ? {\r\n            x: parseFloat(str.split(' ')[0], 10),\r\n            y: parseFloat(str.split(' ')[1], 10)\r\n        } : {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n    },\r\n    getRotateXY: function(x, y, angle, dom) {\r\n        var p = findOffset(dom);\r\n        var t = this.getRotateOriginXY(dom);\r\n\r\n        x = x - parseInt(p.x) - t.x;\r\n        y = y - parseInt(p.y) - t.y;\r\n        if (angle < 0) {\r\n            angle = 360 + angle % 360; //3个限项 0-90 90-180 180-270 270-360\r\n        } else {\r\n            angle = angle % 360; //3个限项 0-90 90-180 180-270 270-360\r\n        }\r\n        var goalX = x * Math.cos(angle * Math.PI / 180) + y * Math.sin(angle * Math.PI / 180);\r\n        var goalY = y * Math.cos(angle * Math.PI / 180) - x * Math.sin(angle * Math.PI / 180);\r\n        return {\r\n            x: goalX + t.x,\r\n            y: goalY + t.y\r\n        };\r\n    }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.utils.url', function (exports,module,require,$) {\r\n'use strict';\r\n//获取baseurl，找到第一个?或者结束的\r\nvar baseReg = /^.*?(?=[^\\/]*(\\?|$))/;\r\nvar absoluteReg = /^(\\w+:\\/\\/|\\/)/;\r\nmodule.exports = {\r\n    'getBase': function (url) {\r\n        return (url) ? baseReg.exec(url)[0] : '';\r\n    },\r\n    'isAbsolute': function (url) {\r\n        return absoluteReg.test(url);\r\n    },\r\n    'resolve': function (base, url) {\r\n        if (arguments.length === 1) {\r\n            url = base;\r\n            base = this.getBaseLocationUrl();\r\n        }\r\n        return this.isAbsolute(url) ? url : base + url;\r\n    },\r\n    'getBaseLocationUrl': function () {\r\n        var url = this.getBase(location.href);\r\n        this.getBaseLocationUrl = function () {\r\n            return url;\r\n        };\r\n        return this.getBaseLocationUrl();\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.utils.uuid', function (exports,module,require,$) {\r\n'use strict';\r\nvar hexDigits = '0123456789abcdefghijklmnopqrstuvwxyz';\r\nmodule.exports = function(len) {\r\n\tvar uuids = [];\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tuuids[i] = hexDigits.substr(Math.floor(Math.random() * 36), 1);\r\n\t}\r\n\treturn uuids.join('');\r\n};\r\n}, '');\n__applicationContext.define('core.utils.when', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.type = 'class';\r\nvar callDone = function () {\r\n    if (this._count === 0) {\r\n        this._done.call(window, this._results);\r\n    }\r\n};\r\nmodule.exports = {\r\n    constructor: function (count, fn) {\r\n        this._count = count;\r\n        this._done = fn;\r\n        if (count) {\r\n            this._results = [];\r\n        } else {\r\n            callDone.call(this);\r\n        }\r\n    },\r\n    each: function (result) {\r\n        this._count--;\r\n        this._results.push(result);\r\n        callDone.call(this);\r\n    }\r\n};\r\n}, 'class');\n__applicationContext.define('core.utils.xml', function (exports,module,require,$) {\r\n'use strict';\r\nmodule.exports = {\r\n    'toJsonByAttr': function (obj, node, attrs, eachFn) {\r\n        if (!$.isPlainObject(obj)) {\r\n            eachFn = attrs;\r\n            attrs = node;\r\n            node = obj;\r\n            obj = {};\r\n        }\r\n        if (node) {\r\n            attrs.forEach(function (attr) {\r\n                var mapKey;\r\n                if (typeof attr === \"string\") {\r\n                    mapKey = attr;\r\n                } else {\r\n                    for (var key in attr) {\r\n                        mapKey = key;\r\n                        attr = attr[key];\r\n                    }\r\n                }\r\n                var value = (($.isFunction(attr)) ? attr(node.getAttribute(mapKey) || \"\") : node.getAttribute(attr)) || \"\";\r\n                if ($.isFunction(eachFn)) {\r\n                    value = eachFn(value, mapKey);\r\n                }\r\n                obj[mapKey] = value;\r\n            });\r\n        }\r\n        return obj;\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.common.layout.events', function (exports,module,require,$) {\r\nmodule.exports = {\r\n    downEvents: ['mousedown', 'touchstart'],\r\n    moveEvents: ['mousemove', 'touchmove'],\r\n    upEvents: ['mouseup', 'touchend'],\r\n    clickEvents: ['click'],\r\n    pageLeaveEvents: ['mouseleave']\r\n}\r\n}, '');\n__applicationContext.define('core.common.layout.tool', function (exports,module,require,$) {\r\nvar events = require('core.common.layout.events'),\r\n    request = require('core.utils.request'),\r\n    adjust = require('core.common.ispointinpath'),\r\n    pptshellpaint = require('core.common.pptshellpaint'),\r\n    Paint = require('core.common.Paint'),\r\n    stringUtil = require('core.utils.string');\r\nvar toolTargetHtml = '<div class=\"ic_paint\"><div class=\"ic_tool_container tooldialog_skin_wood\"><div class=\"com_tooldialog\"><div class=\"com_tooldialog_student_mask\"></div><div class=\"sideicon_wrap leftwrap scrollbar_style_gray\" ><ul class=\"sideicon_list\"></ul></div><div class=\"sideicon_wrap rightwrap scrollbar_style_gray\" ><ul class=\"sideicon_list\"></ul></div></div><div class=\"com_tooldialog_pop _icplayer_limit_tip\" style=\"display:none;z-index:9999\" onclick=\"$(this).hide()\"><div class=\"com_tooldialog_pop_box\"><div class=\"com_tooldialog_pop_main\" ><p class=\"com_tooldialog_pop_txt\">${Tool_PopLimit}</p></div><div class=\"com_tooldialog_pop_foot\"><a class=\"com_tooldialog_pop_btn\" href=\"javascript:;\">${Tool_See}</a></div></div></div></div></div>';\r\nvar toolIconHtml = '<li class=\"sideicon ${id} min\" style=\"display: none\"><img src=\"${icon}\" alt=\"\" /></li>';\r\nvar downEvents = events.downEvents,\r\n    moveEvents = events.moveEvents,\r\n    upEvents = events.upEvents,\r\n    clickEvents = events.clickEvents,\r\n    pageLeaveEvents = events.pageLeaveEvents,\r\n    isMouse = false,\r\n    ToolZIndex = {\r\n        'up': 6000,\r\n        'down': 3000\r\n    };\r\nvar toolIconDown = function (event, me) {\r\n    var $target = $(event.srcElement || event.target).closest('.sideicon');\r\n    var tool = $target.data('toolRef');\r\n    if (tool) {\r\n        me.fireTool(tool);\r\n        if ($target.length) {\r\n            if (!$target.is(\":hidden\")) {\r\n                tool.show();\r\n                me.$toolTarget.find('.sideicon.' + tool.unqiueId).hide();\r\n            }\r\n        }\r\n    } else {\r\n        if ((event.srcElement || event.target).className !== 'btn_tool tool_close') {\r\n            me.$toolTarget.find('.tool_tip').hide();\r\n        }\r\n    }\r\n};\r\nvar initTool = (function () {\r\n    var downTime, downX, downY;\r\n    var canmove, currentToolIndex;\r\n    return function () {\r\n        var me = this;\r\n        downEvents.forEach(function (item) {\r\n            var fn = function (e) {\r\n                var event = $.event.fix(e);\r\n                isMouse = !(event.type.indexOf('touch') >= 0);\r\n                //图标事件\r\n                toolIconDown(event, me);\r\n                if (me.component.toolList.active !== '') {\r\n                    var oldtool = me.component.toolList.list[me.component.toolList.active][0];\r\n                    var adjustList = adjust.adjust(me.component.toolList, event);\r\n                    me.component.toolList = adjustList.toolList;\r\n                    downX = event.pageX || event.originalEvent.touches[0].pageX;\r\n                    downY = event.pageY || event.originalEvent.touches[0].pageY;\r\n                    if (!adjustList.allFlase) {\r\n                        canmove = true;\r\n                        currentToolIndex = 0;\r\n                        var currentTool = me.component.toolList.list[adjustList.toolList.active][currentToolIndex];\r\n                        me.setToolZIndex(currentTool);\r\n                        downTime = new Date();\r\n                        currentTool.fireEvent('mousedown', event);\r\n                        if (me.component.toolList.active !== '') {\r\n                            currentTool.fireEvent('focus', event);\r\n                            if (oldtool && oldtool.unqiueId !== currentTool.unqiueId) {\r\n                                oldtool.fireEvent('blur', event);\r\n                            }\r\n                        }\r\n                        me.minTool(event, currentTool);\r\n                        var $target = $(event.srcElement || event.target).closest('.tool_small');\r\n                        if ($target && $target.length && !currentTool.dialogModel.disabledMin) {\r\n                            me.$toolTarget.find('.sideicon.' + currentTool.unqiueId).show();\r\n                        }\r\n                    } else {\r\n                        currentToolIndex = 0;\r\n                        if (oldtool)\r\n                            oldtool.fireEvent('blur', event);\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n            if (me.$toolTarget[0].addEventListener) {\r\n                me.$toolTarget[0].addEventListener(item, fn, true);\r\n            } else {\r\n                me.$toolTarget[0].attachEvent(item, fn);\r\n            }\r\n        });\r\n        moveEvents.forEach(function (item) {\r\n            var fn = function (event) {\r\n                var activeToolList = me.component.toolList.list[me.component.toolList.active];\r\n                if (canmove && activeToolList.length >= (currentToolIndex || 0) + 1) {\r\n                    activeToolList[currentToolIndex].fireEvent('mousemove', event);\r\n                }\r\n                return true;\r\n            };\r\n            if (me.$toolTarget[0].addEventListener) {\r\n                me.$toolTarget[0].addEventListener(item, fn, true);\r\n            } else {\r\n                me.$toolTarget[0].attachEvent(item, fn);\r\n            }\r\n        });\r\n        clickEvents.forEach(function (item) {\r\n            var fn = function (event) {\r\n                var activeToolList = me.component.toolList.list[me.component.toolList.active];\r\n                if (canmove && activeToolList.length >= (currentToolIndex || 0) + 1) {\r\n                    activeToolList[currentToolIndex].fireEvent(item, event);\r\n                }\r\n                return true;\r\n            };\r\n            if (me.$toolTarget[0].addEventListener) {\r\n                me.$toolTarget[0].addEventListener(item, fn, true);\r\n            } else {\r\n                me.$toolTarget[0].attachEvent(item, fn);\r\n            }\r\n        });\r\n        upEvents.forEach(function (item) {\r\n            var fn = function (e) {\r\n                var event = $.event.fix(e);\r\n                canmove = false;\r\n                //click事件发出去后toolList可能发生变化\r\n                if (me.component.toolList.active !== '' && me.component.toolList.list[me.component.toolList.active].length > currentToolIndex) {\r\n                    me.component.toolList.list[me.component.toolList.active][currentToolIndex].fireEvent('mouseup', event);\r\n                }\r\n                var t = new Date() - downTime;\r\n                var x = Math.abs((event.pageX === undefined ? event.originalEvent.changedTouches[0].pageX : event.pageX) - downX);\r\n                var y = Math.abs((event.pageY === undefined ? event.originalEvent.changedTouches[0].pageY : event.pageY) - downY);\r\n                if (me.component.toolList.active !== '') {\r\n                    if (!isMouse && t < 180 && x < 3 && y < 3 && me.component.toolList.list[me.component.toolList.active].length > currentToolIndex) {\r\n                        me.component.toolList.list[me.component.toolList.active][currentToolIndex].fireEvent('click', event);\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n            if (me.$toolTarget[0].addEventListener) {\r\n                me.$toolTarget[0].addEventListener(item, fn, true);\r\n            } else {\r\n                me.$toolTarget[0].attachEvent(item, fn);\r\n            }\r\n        });\r\n        pageLeaveEvents.forEach(function (item) {\r\n            var fn = function (event) {\r\n                canmove = false;\r\n                //click事件发出去后toolList可能发生变化\r\n                if (me.component.toolList.active !== '' && me.component.toolList.list[me.component.toolList.active].length > currentToolIndex) {\r\n                    me.component.toolList.list[me.component.toolList.active][currentToolIndex].fireEvent('mouseup', event);\r\n                }\r\n                return false;\r\n            };\r\n            if (me.$toolTarget[0].addEventListener) {\r\n                me.$toolTarget[0].addEventListener(item, fn, false);\r\n            } else {\r\n                me.$toolTarget[0].attachEvent('onclick', fn);\r\n            }\r\n        });\r\n        var fn = function (event) {\r\n            if (me.component.toolList.active !== '') {\r\n                if (isMouse && me.component.toolList.list[me.component.toolList.active].length > currentToolIndex) {\r\n                    me.component.toolList.list[me.component.toolList.active][currentToolIndex].fireEvent('click', event);\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        if (me.$toolTarget[0].addEventListener) {\r\n            me.$toolTarget[0].addEventListener('click', fn);\r\n        } else {\r\n            me.$toolTarget[0].attachEvent('onclick', fn);\r\n        }\r\n    };\r\n})();\r\nmodule.exports = {\r\n    'renderTool': function () {\r\n        //初始化构建Tool环境\r\n        this.$toolTarget = $(stringUtil.applyTemplate(toolTargetHtml, {\r\n            'Tool_PopLimit': this.component.getI18nModel().player['Tool_PopLimit'],\r\n            'Tool_See': this.component.getI18nModel().player['Tool_See']\r\n        }));\r\n        initTool.call(this);\r\n        this.pageTarget.append(this.$toolTarget);\r\n        this.$toolContainer = this.$toolTarget.find('.com_tooldialog');\r\n        this.$toolIconList = this.$toolContainer.find('.sideicon_list');\r\n        //添加画板\r\n        var paint;\r\n        if (request('sys') === 'pptshell') {\r\n            paint = new pptshellpaint(this.$toolTarget);\r\n        } else {\r\n            paint = new Paint(this.$toolTarget);\r\n        }\r\n        return paint;\r\n    },\r\n    'activeTool': function (tool) {\r\n        if(tool && tool.toolConfig && tool.toolConfig.toolType === 'pageTool' && this.$toolTarget){\r\n            this.$toolTarget.removeClass('ic_paint_active');\r\n        }else if (this.$toolTarget){\r\n            this.$toolTarget.addClass('ic_paint_active');\r\n        }\r\n    },\r\n    'addTool': function (tool) {\r\n        var me = this;\r\n        return tool.render(this.$toolContainer).done(function () {\r\n           // me.setToolZIndex(tool);\r\n            if (tool.toolConfig.independent !== true) {\r\n                //设置icon\r\n                var $iconEl = $(stringUtil.applyTemplate(toolIconHtml, {\r\n                    'icon': tool.toolConfig.icon,\r\n                    'id': tool.unqiueId\r\n                }));\r\n                $iconEl.data('toolRef', tool);\r\n                me.$toolIconList.prepend($iconEl);\r\n            }\r\n        });\r\n    },\r\n    setToolZIndex: function (tool) {\r\n        var me = this;\r\n        var flag = (tool.toolConfig.independent !== true) ? 'down' : 'up';\r\n        var zindex = ToolZIndex[flag] + this.getZIndex();\r\n        if (tool.zIndex === undefined || !me.isLargeZIndex(tool)) {\r\n            tool.zIndex = zindex;\r\n            tool.getElement(true).css('z-index', zindex);\r\n        }\r\n    },\r\n    isLargeZIndex: function (tool) {\r\n        var me = this;\r\n        var currentToolZIndex = tool.zIndex;\r\n        var flag = false;\r\n        if (me.component.toolList.list[me.component.toolList.active] === undefined)\r\n            return flag;\r\n        for (var i = 0; i < me.component.toolList.list[me.component.toolList.active].length; i++) {\r\n            if (currentToolZIndex < me.component.toolList.list[me.component.toolList.active][i].zIndex) {\r\n                flag = false;\r\n                break;\r\n            } else {\r\n                flag = true;\r\n            }\r\n        }\r\n        return flag;\r\n    },\r\n    /**\r\n     * 激活某一tool\r\n     * @param  {[type]} tool [description]\r\n     * @return {[type]}      [description]\r\n     */\r\n    fireTool: function (tool) {\r\n        var me = this;\r\n        var oldtool = me.component.toolList.list[me.component.toolList.active][0];\r\n        var adjustList = adjust.adjust(me.component.toolList, null, tool, 'FIRETOOL');\r\n        me.component.toolList = adjustList.toolList;\r\n        var currentTool = tool;\r\n        me.setToolZIndex(currentTool);\r\n        currentTool.fireEvent('mousedown', event);\r\n        if (me.component.toolList.active !== '') {\r\n            currentTool.fireEvent('focus', event);\r\n            currentTool.fireEvent(require('core.eventbus.eventname').tool.maximize);\r\n            if (oldtool.unqiueId !== currentTool.unqiueId) {\r\n                oldtool.fireEvent('blur', event);\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * 最小化TOOL\r\n     * @param  {[type]} tool [description]\r\n     * @return {[type]}      [description]\r\n     */\r\n    minTool: function (event, tool) {\r\n        var target = event.srcElement || event.target;\r\n        if (target.className === \"btn_tool tool_small\") {\r\n            var me = this;\r\n            me.component.toolList = adjust.swapTool(me.component.toolList, me.component.toolList.active, tool);\r\n            tool.fireEvent(require('core.eventbus.eventname').tool.minimize);\r\n        }\r\n    }\r\n}\r\n\r\n}, '');\n__applicationContext.define('core.common.player.command', function (exports,module,require,$) {\r\nvar logger = require('core.utils.Log');\r\nmodule.exports= {\r\n    'getCommands': function (me) {\r\n        return {\r\n          'gotoPageIndex': function (index, config) {\r\n            me.gotoPageIndex(index, config);\r\n          },\r\n          'gotoPage': function (pageName, config) {\r\n            logger.log('gotoPage:pageName' + pageName + ':config:' + config);\r\n            me.gotoPage(pageName, config);\r\n          },\r\n          'gotoPageId': function (id, config) {\r\n            me.gotoPageId(id, config);\r\n          },\r\n          'gotoPageIndexByNative': function (index) {\r\n            me.gotoPageIndex(index, {\r\n              isCallback: false,\r\n              isFromCache: true\r\n            });\r\n          },\r\n          'firstPage': function () {\r\n            me.firstPage();\r\n          },\r\n          'lastPage': function () {\r\n            me.lastPage();\r\n          },\r\n          'nextPage': function () {\r\n            me.nextPage();\r\n          },\r\n          'prevPage': function () {\r\n            me.prevPage();\r\n          },\r\n          'mediaPause': function () {\r\n            me.mediaPause();\r\n          },\r\n          'closeActivePage': function () {\r\n            me.closeActivePage();\r\n            me.commonPages.forEach(function (page) {\r\n              page.fireEvent('PageLoaded');\r\n            });\r\n          },\r\n          'addExtendPage': function (config) {\r\n            me.addExtendPage(config);\r\n          },\r\n          'closeExtendPage': function () {\r\n            me.closeExtendPage();\r\n            me.commonPages.forEach(function (page) {\r\n              page.fireEvent('PageLoaded');\r\n            });\r\n          }\r\n        };\r\n      }\r\n}\r\n}, '');\n__applicationContext.define('core.common.player.controller', function (exports,module,require,$) {\r\nvar runtime = require('core.common.runtime');\r\nmodule.exports = {\r\n    createController: function () {\r\n        var me = this;\r\n        return {\r\n            'getPlayerEvent': function () {\r\n                return me._eventbus;\r\n            },\r\n            'registerFlow': function () {\r\n                me.registerFlow.apply(me, arguments);\r\n            },\r\n            'startFlow': function () {\r\n                me.startFlow.apply(me, arguments);\r\n            },\r\n            'eachPresenter': function () {\r\n                me.eachPresenter.apply(me, arguments);\r\n            },\r\n            'updateTool': function () {\r\n                me.updateToolProperties.apply(me, arguments);\r\n            },\r\n            'getPresentation': function () {\r\n                return require('core.common.player.presentation').getPresentation(me);\r\n            },\r\n            'getCurrentPageIndex': function () {\r\n                return me.getCurrentPageIndex();\r\n            },\r\n            'getRuntime': runtime.getRuntime,\r\n            'getPaint': function () {\r\n                return me.getPaint();\r\n            },\r\n            'clearTool': function () {\r\n                me.clearTool();\r\n            },\r\n            'removeTool': function (unqiueId, scope) {\r\n                me.removeTool(unqiueId, scope);\r\n            },\r\n\r\n            'addTool': function (url, options, state) {\r\n                return me.addTool(url, options, state);\r\n            },\r\n            'getPlayerEventBus': function () {\r\n                return this._eventbus;\r\n            },\r\n            'getEventBus': function () {\r\n                return require('core.common.player.eventbus').getEventBus(me);\r\n            },\r\n            'getCommands': function () {\r\n                return require('core.common.player.command').getCommands(me);\r\n            },\r\n            'getState': function () {\r\n                return require('core.common.player.state').getState(me);\r\n            },\r\n            'getModule': function (moduleId) {\r\n                return me.activePage.getModule(moduleId);\r\n            },\r\n            'getModulesByType': function (type) {\r\n                return me.activePage.getModulesByType(type);\r\n            },\r\n            'getCommonsModule': function (name, moduleId) {\r\n                var pages = me.commonPages.getItems(name);\r\n                return (pages.length) ? pages[0].getModule(moduleId) : null;\r\n            },\r\n            'getToolbarModule': function (moduleId) {\r\n                return this.getCommonsModule('toolbar', moduleId);\r\n            },\r\n            'getHeaderModule': function (moduleId) {\r\n                return this.getCommonsModule('header', moduleId);\r\n            },\r\n            'getFooterModule': function (moduleId) {\r\n                return this.getCommonsModule('footer', moduleId);\r\n            },\r\n            'getCurrentPageView': function () {\r\n                return me.activePage.getElement();\r\n            }\r\n        };\r\n    }\r\n}\r\n}, '');\n__applicationContext.define('core.common.player.eventbus', function (exports,module,require,$) {\r\nmodule.exports = {\r\n    'getEventBus': function (me) {\r\n        return {\r\n          'sendEvent': function (name, data) {\r\n            //可能不存在activePage,只渲染通用页\r\n            if (me.activePage) {\r\n              me.activePage.fireEvent(name, data);\r\n            }\r\n            //激活通用页的事件\r\n            me.commonPages.forEach(function (page) {\r\n              page.fireEvent(name, data);\r\n            });\r\n            //激活Tool页的事件\r\n            me.toolList.all.forEach(function (tool) {\r\n              tool.fireEvent(name, data);\r\n            });\r\n          }\r\n        };\r\n      }\r\n}\r\n}, '');\n__applicationContext.define('core.common.player.gotopage', function (exports,module,require,$) {\r\nvar logger = require('core.utils.Log'),\r\n    playerConfig = require('core.common.playerConfig'),\r\n    Page = require(\"core.player.page\");\r\nmodule.exports = {\r\n    getCurrentPageIndex: function () {\r\n        return this.currentPageIndex;\r\n    },\r\n    closeActivePage: function () {\r\n        if (this.activePage && this.activePage.isEmpty !== true) {\r\n            var me = this;\r\n            this.mediaPause();\r\n            if (this.activePage.pageType != \"extendPage\") {\r\n                //保留上一页的状态\r\n                if (this.activePage) {\r\n                    this.state.addStates(this.activePage.getState());\r\n                }\r\n            } else if (this.activePage.hidePage) {\r\n                this.activePage.hidePage.split(',').forEach(function (name) {\r\n                    me.layout.switchCommonPage(name, true);\r\n                });\r\n            }\r\n            //释放上一页\r\n            this.activePage.release();\r\n            this.activePage = {\r\n                isEmpty: true,\r\n                isReportable: function () {\r\n                    return false\r\n                },\r\n                getModuleList: function () {\r\n                    return [];\r\n                },\r\n                getState: function () {\r\n                    return {};\r\n                },\r\n                release: function () {},\r\n                getModule: function () {\r\n                    return {};\r\n                },\r\n                getModules: function () {\r\n                    return [];\r\n                },\r\n                fireEvent: function () {}\r\n            };\r\n        }\r\n    },\r\n    gotoPageIndex: function (index, config) {\r\n        logger.log('gotoPageIndex:' + index + ':config:' + config);\r\n        index = parseInt(index, 10);\r\n        if (!isNaN(index) && index >= 0 && index < this.pages.length) {\r\n            this.closeActivePage();\r\n            var pageConfig = this.pages.getByIndex(index);\r\n            config = config || {};\r\n            //留给native跳页的判断\r\n            if (config.isCallback !== false && $.isFunction(this.beforeSwitchToPage)) {\r\n                //index页面传入\r\n                if (this.beforeSwitchToPage({\r\n                        \"index\": index,\r\n                        \"id\": pageConfig.id,\r\n                        \"params\": {}\r\n                    }) === false) {\r\n                    return false;\r\n                }\r\n            }\r\n            delete config.isCallback;\r\n            //载入教师端的状态\r\n            this.state.loadFromString(config.state);\r\n            delete config.state;\r\n\r\n            pageConfig.gotoConfig = config;\r\n            this.activePage = new Page(pageConfig, this);\r\n            this.currentPageIndex = index;\r\n            this.layout.renderPage();\r\n        } else {\r\n            logger.error('invalid code [' + index + ']');\r\n        }\r\n    },\r\n    gotoPage: function (name, config) {\r\n        var index = this.pages.getIndexOfByName(name);\r\n        this.gotoPageIndex(index, config);\r\n    },\r\n    gotoPageId: function (id, config) {\r\n        var index = this.pages.getIndexOfById(id);\r\n        this.gotoPageIndex(index, config);\r\n    },\r\n    firstPage: function () {\r\n        this.gotoPageIndex(0);\r\n    },\r\n    lastPage: function () {\r\n        this.gotoPageIndex(this.pages.length - 1);\r\n    },\r\n    nextPage: function () {\r\n        this.gotoPageIndex(this.currentPageIndex + 1);\r\n    },\r\n    prevPage: function () {\r\n        this.gotoPageIndex(this.currentPageIndex - 1);\r\n    }\r\n}\r\n\r\n}, '');\n__applicationContext.define('core.common.player.presentation', function (exports,module,require,$) {\r\nmodule.exports = {\r\n  'getPresentation': function (me) {\r\n    return {\r\n      getPageCount: function () {\r\n        return me.pages.length;\r\n      },\r\n      getPage: function (index) {\r\n        var pageInfo = me.pages.getByIndex(index);\r\n        return {\r\n          'getName': function () {\r\n            return pageInfo.name;\r\n          },\r\n          'getId': function () {\r\n            return pageInfo.id;\r\n          },\r\n          'getBaseURL': function () {\r\n            return pageInfo.href;\r\n          },\r\n          //不建议使用，只能获取当前已渲染页的值\r\n          'getModules': function () {\r\n            return me.activePage.getModuleList() || [];\r\n          },\r\n          'isReportable': function () {\r\n            return me.activePage.isReportable();\r\n          }\r\n        };\r\n      },\r\n      getCurrentPage: function () {\r\n        if (me.activePage) {\r\n          return {\r\n            'getName': function () {\r\n              return me.activePage.name\r\n            },\r\n            'getId': function () {\r\n              return me.activePage.id\r\n            },\r\n            'getBaseURl': function () {\r\n              return me.activePage.href\r\n            },\r\n            'isReportable': function () {\r\n              return me.activePage.isReportable();\r\n            }\r\n          }\r\n        } else {\r\n          return {}\r\n        }\r\n      },\r\n      getTableOfContents: function () {\r\n        return {\r\n          'size': function () {\r\n            return me.pages.length;\r\n          },\r\n          'get': function (index) {\r\n            var pageInfo = me.pages.getByIndex(index);\r\n            return {\r\n              'getName': function () {\r\n                return pageInfo.name;\r\n              },\r\n              'getId': function () {\r\n                return pageInfo.id;\r\n              },\r\n              'getBaseURL': function () {\r\n                return pageInfo.href;\r\n              },\r\n              'getPreview': function () {\r\n                return pageInfo.preview;\r\n              }\r\n            };\r\n          }\r\n        };\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n}, '');\n__applicationContext.define('core.common.player.state', function (exports,module,require,$) {\r\nmodule.exports = {\r\n    'getState': function (me) {\r\n        return {\r\n            'getCurrentPageState': function () {\r\n                return JSON.stringify(me.activePage.getState());\r\n            },\r\n            'getAllToolState': function () {\r\n                var value, stateMap = {};\r\n                me.getToolList().all.forEach(function (tool) {\r\n                    value = tool.getState();\r\n                    if (value) {\r\n                        $.each(value, function (key, value) {\r\n                            stateMap[key] = value;\r\n                        });\r\n                    }\r\n                });\r\n                return JSON.stringify(stateMap);\r\n            },\r\n            'getPlayerState': function () {\r\n                return me.state.getAsString();\r\n            },\r\n            'savePageState': function (name) {\r\n                if (name) {\r\n                    var pages = me.commonPages.getItems(name);\r\n                    if (pages.length) {\r\n                        //目前只先保存第一页\r\n                        me.state.writePageState(name, JSON.stringify(pages[0].getState()));\r\n                    }\r\n                } else {\r\n                    me.state.writePageState('page', this.getCurrentPageState());\r\n                    me.state.writePageState('tool', this.getAllToolState());\r\n                }\r\n            }\r\n        };\r\n    }\r\n}\r\n}, '');\n__applicationContext.define('core.common.tool.tool', function (exports,module,require,$) {\r\n'use strict';\r\nvar getToolSysModel = function (options) {\r\n  var _sys = options.__sys;\r\n  if (!_sys) {\r\n    return {};\r\n  } else {\r\n    var widthFull = (options.width === \"100%\"),\r\n      hideHead = (_sys.hide && _sys.hide.indexOf('header') >= 0),\r\n      hideToolBar = (_sys.hide && _sys.hide.indexOf('toolbar') >= 0),\r\n      hideSYSWidth = (_sys.width === '100%'),\r\n      disabledMin = _sys.disabled.indexOf('min') >= 0,\r\n      disabledClose = _sys.disabled.indexOf('close') >= 0,\r\n      disabledMove = _sys.disabled.indexOf('move') >= 0,\r\n      disabledFull = _sys.disabled.indexOf('full') >=0,\r\n      selfBorder = _sys.selfBorder;\r\n    return {\r\n      widthFull: widthFull,\r\n      hideHead: hideHead,\r\n      hideToolBar: hideToolBar,\r\n      hideSYSWidth: hideSYSWidth,\r\n      disabledMin: disabledMin,\r\n      disabledClose: disabledClose,\r\n      disabledMove: disabledMove,\r\n      disabledFull: disabledFull,\r\n      selfBorder: selfBorder\r\n    };\r\n  }\r\n}\r\nmodule.exports = {\r\n  getToolKey: function (url, options) {\r\n    try {\r\n      if (options && options.toolKey) {\r\n        return options.toolKey;\r\n      }\r\n      var oldXMLKey = url.split('/')[url.split('/').length - 2],\r\n        toolKey = (oldXMLKey.indexOf('.') >= 0) ? url.split('/')[url.split('/').length - 3] : oldXMLKey;\r\n      return toolKey || url;\r\n    } catch (ex) {\r\n      return url;\r\n    }\r\n  },\r\n  getPositionIndex: function (position) {\r\n    for (var i = 0; i < position.length; i++) {\r\n      if (!position[i].used) {\r\n        return i;\r\n      }\r\n    }\r\n    return 0;\r\n  },\r\n  updatePositionUsed: function (position, index, unqiueId) {\r\n    if (index >= 0) {\r\n      position[index].used = true;\r\n      position[index].unqiueId = unqiueId;\r\n    }\r\n  },\r\n  delPositionUnqiueId: function (position, unqiueId) {\r\n    for (var i = 0; i < position.length; i++) {\r\n      if (position[i].unqiueId === unqiueId) {\r\n        position[i].unqiueId === undefined;\r\n        position[i].used = false;\r\n      }\r\n    }\r\n  },\r\n  getToolNameI18n: function (data, key) {\r\n    var toolName = key,\r\n      lang = icCreatePlayer.lang;\r\n    if (lang === 'zh') {\r\n      lang = 'zh_CN';\r\n    }\r\n    var adaptelang = lang.split('_')[0];\r\n    for (var i = data.length - 1; i >= 0; i--) {\r\n      if (data[i].toolKey === key) {\r\n        toolName = data[i].i18n[lang] || data[i].i18n[adaptelang] || data[i].i18n['zh_CN'];\r\n        break;\r\n      }\r\n    }\r\n    return toolName;\r\n  },\r\n  getDialogModel: function (options) {\r\n    var sysModel = getToolSysModel(options);\r\n    if ((sysModel.widthFull || sysModel.hideToolBar) && !sysModel.hideHead) {\r\n      sysModel.__type = 'stu';\r\n    } else if (sysModel.hideHead && sysModel.hideToolBar) {\r\n      sysModel.__type = 'pre';\r\n    } else if (sysModel.hideSYSWidth) {\r\n      sysModel.__type = 'mobile'\r\n    } else {\r\n      sysModel.__type = 'pc'\r\n    }\r\n    return sysModel;\r\n  },\r\n  /**\r\n   * 判断是否已经超过限制\r\n   * @param me:player实例\r\n   * @param listType:top bottom\r\n   * @returns {*}\r\n   */\r\n  isOverMaxLimit: function (me, listType) {\r\n    var toolList,\r\n\r\n      isOver = false;\r\n    if (!listType) {\r\n      listType = ['top', 'bottom'];\r\n      for (var i = 0; i < listType.length; i++) {\r\n        toolList = me.toolList.list[listType[i]] || [];\r\n        isOver = toolList.length >= me.TOOL.DATA[listType[i]].MAXLIMIT;\r\n        if (isOver) {\r\n          break;\r\n        }\r\n      }\r\n      return isOver;\r\n    } else {\r\n      toolList = me.toolList.list[listType] || [];\r\n      return toolList.length >= me.TOOL.DATA[listType].MAXLIMIT;\r\n    }\r\n\r\n    // if (listType === 'bottom') {\r\n    //   return toolList.length >= me.TOOL[listType].MAXLIMIT;\r\n    // } else {\r\n    //   return toolList || toolList.filter(function (item) {\r\n    //       return item.toolConfig.limited\r\n    //     }).length >= me.TOOL[listType].MAXLIMIT;\r\n    // }\r\n  }\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.common.tool.toolapi', function (exports,module,require,$) {\r\nvar Tool = require('core.player.Tool'),\r\n    logger = require('core.utils.log'),\r\n    stringUtils = require(\"core.utils.string\"),\r\n    urlUtil = require('core.utils.url'),\r\n    i18nLoader = require('core.common.i18nLoader'),\r\n    createModel = require('core.common.createModel'),\r\n    refPathBuilder = require('core.common.refPathBuilder'),\r\n    toolPush = require('core.common.tool.toolpush'),\r\n    logger = require('core.utils.log'),\r\n    tHelper = require('core.common.tool.tool');\r\nvar apiList = {\r\n    /**\r\n     * update tool box's display title, push button and so on\r\n     */\r\n    updateToolProperties: function (stoolkey, dtoolkey) {\r\n        var me = this;\r\n        if (me.toolList && me.toolList.all && me.i18nModel && me.i18nModel.tool && stoolkey && dtoolkey) {\r\n            var stoolview = null,\r\n                url = \"\";\r\n            me.toolList.all.forEach(function (item) {\r\n                if (item.toolKey === stoolkey) {\r\n                    stoolview = item.element;\r\n                }\r\n            });\r\n            $.each(me.i18nModel.tool, function (index, item) {\r\n                if (item.toolKey == dtoolkey) {\r\n                    url = icCreatePlayer.ref_path_tool + \"/\" + item.url;\r\n                }\r\n            });\r\n            url = stringUtils.applyTemplate(url, me.refPath);\r\n            url = urlUtil.resolve(url);\r\n            var tool = new Tool({\r\n                url: url,\r\n                key: dtoolkey,\r\n                options: {\r\n                    __sys: {\r\n                        disabled: [],\r\n                        hide: []\r\n                    }\r\n                }\r\n            }, me);\r\n            tool.load().done(function (data) {\r\n                createModel(data.model.getValue().properties, data.baseUrl, tool.getRefPathParser()).then(function (model) {\r\n                    if (stoolview) {\r\n                        stoolview.find('.tooldialog_head span img').attr('src', model.smallIcon);\r\n                        stoolview.find('.tooldialog_head em.title').text(tHelper.getToolNameI18n(me.i18nModel.tool, dtoolkey));\r\n                        if (model.push) {\r\n                            stoolview.find('._icplayer_push_button').css('display', 'block');\r\n                        } else {\r\n                            stoolview.find('._icplayer_push_button').css('display', 'none');\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    },\r\n    /**\r\n     * [addTool description]\r\n     * @param {[type]} url           [description]\r\n     * @param {[type]} options       [options.width=\"100%\"; options.__sys={syncId:'',hide:['header','toolbar'],disable:['min','move','close']}]\r\n     * @param {[type]} state         [description]\r\n     * @param {[type]} extendOptions [description]\r\n     */\r\n    addTool: function (url, options, state, extendOptions) {\r\n        var me = this;\r\n        if (me.waitI18nLoadDF && me.waitToolAddDF &&\r\n            me.waitI18nLoadDF.promise().state() === 'pending' && me.waitToolAddDF.promise().state() === 'pending') {\r\n            logger.error('you click too fast');\r\n            return me.waitToolAddDF.promise();\r\n        }\r\n        me.waitToolAddDF = $.Deferred();\r\n        me.waitI18nLoadDF = $.Deferred();\r\n        //第一次添加时候执行渲染Tool布局\r\n        me.renderPromise.then(function () {\r\n            me.toolPaint = me.layout.renderTool();\r\n            //加载工具tool.json配置\r\n            i18nLoader.loadPlayer().done(function (toolconfiglist) {\r\n                me.i18nModel.tool = toolconfiglist;\r\n                me.waitI18nLoadDF.resolve();\r\n            }).fail(function () {\r\n                me.waitI18nLoadDF.resolve();\r\n            });\r\n        });\r\n        me.waitI18nLoadDF.then(function () {\r\n            //后续添加就不再渲染Tool布局\r\n            me.addTool = function (url, options, state, extendOptions) {\r\n                me.layout.activeTool();\r\n                return me.waitI18nLoadDF.promise().then(function () {\r\n                    var toolkey = tHelper.getToolKey(url, options);\r\n                    if (url && me.i18nModel && me.i18nModel.tool &&\r\n                        (url.indexOf(\"file:\") !== 0 && url.indexOf(\"http:\") !== 0 && url.indexOf(\"https:\") !== 0)) {\r\n                        $.each(me.i18nModel.tool, function (index, item) {\r\n                            if (item.toolKey == toolkey) {\r\n                                url = icCreatePlayer.ref_path_tool + \"/\" + item.url;\r\n                                if (options.__option === undefined) {\r\n                                    options.__option = {}\r\n                                }\r\n                                options.__option = $.extend({}, item.option, options.__option)\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    url = stringUtils.applyTemplate(url, me.refPath);\r\n                    url = urlUtil.resolve(url);\r\n                    refPathBuilder.set(me, 'tool', url);\r\n                    var deferred = $.Deferred();\r\n                    if (Tool.toolLoadState[toolkey] === 'pending') {\r\n                        logger.error('you click too fast');\r\n                        return deferred.promise();\r\n                    }\r\n                    if (Tool.toolLoadState[toolkey] !== 'done') {\r\n                        Tool.toolLoadState[toolkey] = 'pending';\r\n                    }\r\n\r\n                    options = $.extend(true, {\r\n                        __sys: {\r\n                            syncId: '',\r\n                            hide: [''],\r\n                            disabled: ['']\r\n                        }\r\n                    }, options);\r\n\r\n                    var toolObject = Tool.getTool(url, options, me.toolList.all);\r\n                    var preActive = me.toolList.active;\r\n\r\n                    //判断是否单例\r\n                    if (toolObject) {\r\n                        try {\r\n                            me.layout.setToolZIndex(toolObject);\r\n                            if (preActive && toolObject != me.toolList.list[preActive][0]) {\r\n                                me.toolList.list[preActive][0].fireEvent('blur', {});\r\n                            } else {\r\n                                me.layout.activeTool();\r\n                            }\r\n                            var rtype = '';\r\n                            var rindex = -1;\r\n                            $.each(me.toolList.list, function (type, list) {\r\n                                $.each(list, function (index, tool) {\r\n                                    if (tool == toolObject) {\r\n                                        rtype = type;\r\n                                        rindex = index;\r\n                                    }\r\n                                });\r\n                            });\r\n                            if (rtype && rindex != -1) {\r\n                                me.toolList.list[rtype] = require('core.common.ispointinpath').swapItems(me.toolList.list[rtype], rindex, 'first');\r\n                            }\r\n                        } catch (e) {\r\n                            console.error(e);\r\n                        }\r\n                        deferred.resolve(toolObject);\r\n                    } else {\r\n                        var params = {\r\n                            'url': url,\r\n                            'key': url,\r\n                            'listeners': {\r\n                                'destroy': function () {\r\n                                    //me 指向page\r\n                                    //this 指向tool\r\n                                    me.removeTool(this.unqiueId);\r\n                                }\r\n                            },\r\n                            'options': options\r\n                        };\r\n                        if (state) {\r\n                            params['state'] = state;\r\n                        }\r\n                        var group = new Tool(params, me);\r\n                        me.layout.addTool(group, options).done(function (toolObject) {\r\n\r\n                            //如果存在学科工具了就激活最后一个学科工具的blur事件,否则激活学科工具层\r\n                            try {\r\n                                if (preActive) {\r\n                                    me.toolList.list[preActive][0].fireEvent('blur', {});\r\n                                } else {\r\n                                    me.layout.activeTool(toolObject);\r\n                                }\r\n                            } catch (e) {\r\n                                console.error(e);\r\n                            }\r\n\r\n                            me.toolList.all.push(toolObject);\r\n\r\n                            //再根据independent分组存放\r\n                            var flag = (toolObject.toolConfig.independent === true) ? 'top' : 'bottom';\r\n                            me.toolList.active = flag;\r\n                            var list = me.toolList.list[flag];\r\n                            me.toolList.list[flag].unshift(toolObject);\r\n                            if (!toolObject.options.__sys.NONEventFlag) {\r\n                                me.fireEvent(require('core.eventbus.eventname').tool.finish, toolObject);\r\n                            }\r\n\r\n                            deferred.resolve(toolObject);\r\n                        }).fail(function () {\r\n                            deferred.reject();\r\n                        });\r\n                    }\r\n\r\n                    return deferred.promise();\r\n                });\r\n            };\r\n            me.addTool(url, options, state, extendOptions).then(function (data) {\r\n                me.waitToolAddDF.resolve(data);\r\n            }).fail(function () {\r\n                me.waitToolAddDF.reject();\r\n            });\r\n        });\r\n        return me.waitToolAddDF.promise();\r\n    },\r\n    getToolList: function () {\r\n        return this.toolList;\r\n    },\r\n    /**\r\n     * 判断是否已经超过限制\r\n     * @param listType:bottom工具窗，top:上层的工具\r\n     * @returns {boolean}\r\n     */\r\n    isMaxToolCount: function (listType) {\r\n        return require('core.common.tool').isOverMaxLimit(this, listType)\r\n    },\r\n    clearTool: function () {\r\n        var me = this;\r\n        while (me.toolList.all.length) {\r\n            me.toolList.all[0].release();\r\n        }\r\n        me.toolList.active = '';\r\n        me.toolList.list = {\r\n            top: [],\r\n            bottom: []\r\n        };\r\n        Tool.toolLoadState = {};\r\n    },\r\n    //兼容处理，由于unqiueId与toolKey不可能 一样 把unqiueId也可能为toolKey\r\n    removeTool: function (unqiueId, scope, NONEventFlag) {\r\n        var me = this;\r\n        var key = \"\";\r\n        var flag = \"\";\r\n        var curentTool;\r\n        me.toolList.all = me.toolList.all.filter(function (item) {\r\n            //兼容处理，由于unqiueId与toolKey不可能 一样 把unqiueId也可能为toolKey\r\n            if (item.unqiueId === unqiueId || item.toolKey === unqiueId) {\r\n                key = item.toolKey;\r\n                curentTool = item;\r\n                flag = (item.toolConfig.independent === true) ? 'top' : 'bottom';\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n        if (flag !== '') {\r\n            me.toolList.list[flag] = me.toolList.list[flag].filter(function (item) {\r\n                return !(item.unqiueId === unqiueId || item.toolKey === unqiueId);\r\n            });\r\n        }\r\n\r\n        //计算单例计数\r\n        Tool.removeTool(key);\r\n        if (curentTool && scope === 'player') {\r\n            curentTool.getController().getCommands().closeTool(NONEventFlag);\r\n        }\r\n        //如果不存在学科工具了就清空页面\r\n        if (!this.toolList.all.length) {\r\n            me.toolList.active = '';\r\n            this.layout.activePage();\r\n            Tool.bridgeClose();\r\n        }\r\n    },\r\n    /**\r\n     * 设置推送框的状态，true:可用的状态，false：不可用的状态。\r\n     */\r\n    setPushDomEnable: function (flag) {\r\n        var me = this.player || this;\r\n        me.fireEvent(require('core.eventbus.eventname').play.push_status, { 'status': flag });\r\n        if (flag) {\r\n            toolPush.setEnable();\r\n        } else {\r\n            toolPush.setDisable();\r\n        }\r\n    },\r\n    player: {}\r\n}\r\nmodule.exports = {\r\n    create: function (player) {\r\n        apiList.player = player\r\n        return apiList;\r\n    }\r\n}\r\n\r\n}, '');\n__applicationContext.define('core.common.tool.tooldialog', function (exports,module,require,$) {\r\nvar left, top,\r\n    range = {},\r\n    isMove = false,\r\n    eventname = require('core.eventbus.eventname'),\r\n    throttle = require('core.utils.throttle'),\r\n    domUtil = require('core.utils.dom');\r\nmodule.exports = {\r\n    initEvent: function (modelType) {\r\n        var me = this;\r\n        me.addEventListener('mousedown', {\r\n            fn: function () {\r\n                if (modelType.__type !== 'pc' || (modelType.__type == 'pc' && modelType.disabledMove)) {\r\n                    isMove = false;\r\n                } else {\r\n                    isMove = true;\r\n                }\r\n                var m = domUtil.getEventXY(event);\r\n                var p = me.element.position();\r\n                left = p.left - m.x;\r\n                top = p.top - m.y;\r\n                range.minLeft = 0 - me.element.width() + me.top.TOOL.DATA.DIALOG.STEPLEFT;\r\n                range.maxLeft = me.top.getElement(true).width() - me.top.TOOL.DATA.DIALOG.STEPLEFT;\r\n                range.minTop = 0;\r\n                range.maxTop = me.top.getElement(true).height() - me.top.TOOL.DATA.DIALOG.STEPTOP;\r\n            },\r\n            selector: ['.tooldialog_head', '.btn_tool.tool_full']\r\n        });\r\n        me.addEventListener('mousedown', {\r\n            fn: function () {\r\n                var container = me.container.find('.tooldialog_control.' + me.unqiueId)\r\n                if (modelType.__type == 'pc' && !modelType.disabledFull) {\r\n                    var moveTarge = container.find('.btn_tool.tool_full')\r\n                    var target = container.find('._icplayer_tool_fullscreen');\r\n                    var isFull = target.hasClass('exit_fullscreen')\r\n                    var fontsize = icCreatePlayer.utils.getFontSize()\r\n                    if (isFull) {\r\n                        modelType.disabledMove = false\r\n                        moveTarge.removeClass('click_disabled')\r\n                        target.removeClass('exit_fullscreen').addClass('to_fullscreen')\r\n                        container.css('font-size','')\r\n                        container.removeClass('go_to_fullscreen')\r\n                    } else {\r\n                        modelType.disabledMove = true\r\n                        moveTarge.addClass('click_disabled')\r\n                        target.addClass('exit_fullscreen').removeClass('to_fullscreen')\r\n                        container.css('font-size', fontsize+ 'px')\r\n                        container.addClass('go_to_fullscreen')\r\n                    }\r\n                    if (me.mainModule && me.mainModule.presenter && me.mainModule.presenter.__interface) {\r\n                        var resize = me.mainModule.presenter.__interface.resizeScreen\r\n                        if ($.isFunction(resize)) {\r\n                            resize({ ratio: isFull ?icCreatePlayer.fontSize /fontsize * 3 /4 : fontsize / icCreatePlayer.fontSize * 4 / 3 })\r\n                        }\r\n                    }\r\n                } else if (modelType.__type == 'pc' && modelType.no_full) {\r\n                    var tip = container.find('._icplayer_fullscreen_tip')\r\n                    tip.removeClass('hide_dom')\r\n                    me.deTip(tip)\r\n                }\r\n            },\r\n            selector: '._icplayer_tool_fullscreen'\r\n        });\r\n        me.deTip = throttle.debounce(function (tip) {\r\n             tip.addClass('hide_dom')\r\n             console.log('hide')\r\n            }, 2000, true)\r\n        me.addEventListener('mousedown', {\r\n            fn: function () {\r\n                if (!modelType.disabledMin) {\r\n                    me.element.hide();\r\n                    var side = me.container.find('.sideicon.' + me.unqiueId);\r\n                    if (me.top.TOOL.DATA.CURRENTPUSHTOOL === me.unqiueId) {\r\n                        side.addClass('on');\r\n                    } else {\r\n                        side.removeClass('on');\r\n                    }\r\n                }\r\n            },\r\n            selector: '.btn_tool.tool_small'\r\n        });\r\n        me.addEventListener('mousedown', {\r\n            fn: function () {\r\n                if (!modelType.disabledClose) {\r\n                    if (me.top.TOOL.DATA.PUSHING && me.top.TOOL.DATA.CURRENTPUSHTOOL === me.unqiueId) {\r\n                        me.element.find('.tool_tip').removeClass('tool_tip_small');\r\n                        me.element.find('.tool_tip').find('#tip_next_push').show();\r\n                    } else {\r\n                        me.element.find('.tool_tip').addClass('tool_tip_small');\r\n                        me.element.find('.tool_tip').find('#tip_next_push').hide();\r\n                    }\r\n                    me.element.find('.tool_tip').hide();\r\n                    $(event.srcElement || event.target).next('.tool_tip').show();\r\n                }\r\n            },\r\n            selector: '.btn_tool.tool_close'\r\n        });\r\n        me.addEventListener('mousedown', {\r\n            fn: function () {\r\n                event.stopPropagation();\r\n                event.preventDefault();\r\n                me.element.find('.tool_tip').hide();\r\n                var target = $(event.srcElement || event.target);\r\n                if (target.find('.btn_text').text() === me.top.getI18nModel().player['Tool_Sure'] || target.text() === me.top.getI18nModel().player['Tool_Sure']) {\r\n                    me.container.find('.sideicon.' + me.unqiueId).remove();\r\n                    if (me.top.TOOL.DATA.PUSHING && me.top.TOOL.DATA.CURRENTPUSHTOOL === me.unqiueId) {\r\n                        me.stopPush();\r\n                    }\r\n                    me.release();\r\n                }\r\n            },\r\n            selector: '.tool_tip_wrap'\r\n        });\r\n        me.addEventListener('mousedown', {\r\n            fn: function () {\r\n                event.stopPropagation();\r\n                if (event.type == 'mousedown') {\r\n                    var target = $(event.srcElement || event.target);\r\n                    if ((target.hasClass('_icplayer_push_button') || target.parent().parent().parent().hasClass('_icplayer_push_button')) && !me.top.TOOL.DATA.PUSHING) {\r\n                        me.push();\r\n                    } else if ((target.hasClass('on') && target.hasClass('_icplayer_push_button')) || (target.parent().parent().parent().hasClass('on') && target.parent().parent().parent().hasClass('_icplayer_push_button'))) {\r\n                        if (me.top.TOOL.DATA.PUSHING && me.top.TOOL.DATA.CURRENTPUSHTOOL === me.unqiueId) {\r\n                            me.stopPush();\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            selector: '.btn_tool.tool_push'\r\n        });\r\n        me.addEventListener(eventname.tool.push_action, {\r\n            fn: function (eventName, eventData) {\r\n                if (eventData) {\r\n                    var uniqueId = me.mainModule.getPresenter() ? (me.mainModule.getPresenter().__model ? me.mainModule.getPresenter().__model.$.unqiueId : 0) : 0;\r\n                    if (eventData.action == 'push') {\r\n                        if (!me.top.TOOL.DATA.PUSHING && eventData.toolKey == me.toolKey && eventData.uniqueId == uniqueId) {\r\n                            me.push();\r\n                        }\r\n                    } else if (eventData.action == 'stop_push') {\r\n                        if (me.top.TOOL.DATA.PUSHING && eventData.toolKey == me.toolKey && eventData.uniqueId == uniqueId) {\r\n                            me.stopPush();\r\n                        }\r\n                    }\r\n\r\n                }\r\n            }\r\n        });\r\n        me.addEventListener(eventname.tool.forbide_full, {\r\n            fn: function (eventName, eventData) {\r\n                if (modelType.__type == 'pc' && eventData && eventData.id && eventData.id === me.toolKey + \"@\" + me.id) {\r\n                    var container = me.container.find('.tooldialog_control.' + me.unqiueId)\r\n                    var target = container.find('._icplayer_tool_fullscreen');\r\n                    modelType.disabledFull = eventData.isForbide === true\r\n                    if (eventData.isForbide) {\r\n                        target.addClass('click_disabled')\r\n                    } else {\r\n                        target.removeClass('click_disabled')\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        me.addEventListener('mousedown', {\r\n            fn: function () {\r\n                var target = event.srcElement || event.target;\r\n                if (target.className !== 'btn_tool tool_close') {\r\n                    me.element.find('.tool_tip').hide();\r\n                }\r\n            }\r\n        });\r\n        me.addEventListener('mousemove', {\r\n            fn: function () {\r\n                if (isMove) {\r\n                    var m = domUtil.getEventXY(event);\r\n                    var mLeft = m.x + left;\r\n                    var mTop = m.y + top;\r\n                    if (mLeft > range.minLeft && mLeft < range.maxLeft && mTop > range.minTop && mTop < range.maxTop) {\r\n                        me.element.css({\r\n                            'left': mLeft,\r\n                            'top': mTop\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        me.addEventListener('mouseup', function () {\r\n            isMove = false;\r\n        });\r\n    },\r\n    setDisplayMode: function (modelType, adjust, el) {\r\n        var me = this;\r\n        var _parent = me.element.parent();\r\n        var sidetool = (el || me.element).find('.sidetool');\r\n        var head = (el || me.element).find('.tooldialog_head');\r\n        me.element.removeClass('com_tooldialog_student');\r\n        me.element.removeClass('com_tooldialog_board');\r\n        _parent.removeClass('tool_to_edit');\r\n        _parent.removeClass('tool_to_phone');\r\n        _parent.removeClass('tool_outline');\r\n        sidetool.find('.tool_small').removeClass('click_disabled');\r\n        sidetool.find('.tool_close').removeClass('click_disabled');\r\n        sidetool.find('.tool_full').removeClass('click_disabled');\r\n        head.css('display', '');\r\n        switch (modelType.__type) {\r\n            case \"stu\":\r\n                {\r\n                    me.element.addClass('com_tooldialog_student');\r\n                    if (me.toolConfig && me.toolConfig.autoFull) {\r\n                        head.css('display', 'none');\r\n                    }\r\n                    break;\r\n                }\r\n            case \"pre\":\r\n                {\r\n                    me.element.addClass('com_tooldialog_student');\r\n                    _parent.addClass('tool_to_edit');\r\n                    break;\r\n                }\r\n            case \"mobile\":\r\n                {\r\n                    me.element.addClass('com_tooldialog_board');\r\n                    _parent.addClass('tool_to_phone');\r\n                    break;\r\n                }\r\n            case \"pc\":\r\n                {\r\n                    me.top.container.css('font-size', ((window.screen.width < 1280) ? 16 : icCreatePlayer.fontSize) + 'px');\r\n                    if (window.screen.width < 1280) {\r\n                        icCreatePlayer.fontSize = 16;\r\n                    }\r\n                    me.element.addClass('com_tooldialog_board');\r\n                    break;\r\n                }\r\n        }\r\n        if (modelType.selfBorder) {\r\n            _parent.addClass('tool_outline');\r\n        }\r\n        if (modelType.disabledMin) {\r\n            sidetool.find('.tool_small').addClass('click_disabled');\r\n        }\r\n        if (modelType.disabledClose) {\r\n            sidetool.find('.tool_close').addClass('click_disabled');\r\n        }\r\n        if (modelType.disabledMove) {\r\n            sidetool.find('.tool_full').addClass('click_disabled');\r\n        }\r\n        if (modelType.disabledFull) {\r\n            sidetool.find('._icplayer_tool_fullscreen').addClass('click_disabled');\r\n        }\r\n\r\n        //adjust position\r\n        if (adjust) {\r\n            if (modelType.__type !== 'pc') {\r\n                me.preLeft = me.element.css('left');\r\n                me.preTop = me.element.css('top');\r\n                me.element.css({\r\n                    'left': 0,\r\n                    'top': 0,\r\n                    'width': '100%',\r\n                    'height': '100%'\r\n                });\r\n            } else {\r\n                if (me.preLeft && me.preTop) {\r\n                    me.element.css({\r\n                        'left': me.preLeft,\r\n                        'top': me.preTop\r\n                    });\r\n                }\r\n                me.element.css({\r\n                    'width': '',\r\n                    'height': ''\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n}, '');\n__applicationContext.define('core.common.tool.toolpush', function (exports,module,require,$) {\r\nvar eventname = require('core.eventbus.eventname'),\r\n  detector = require('core.utils.detector'),\r\n  tooldialog = require('core.common.tool.tooldialog'),\r\n  logger = require('core.utils.Log');\r\nmodule.exports = {\r\n  push: function () {\r\n    var me = this;\r\n    var timer = require('core.common.timer');\r\n    var pushClassName = '.btn_tool.tool_push';\r\n    var hideom = \".tool_wrap_mask\";\r\n    var uniqueId = me.mainModule.getPresenter() ? (me.mainModule.getPresenter().__model ? me.mainModule.getPresenter().__model.$.unqiueId : 0) : 0;\r\n    //prevent click event when user pushing tool\r\n    me.element.find(hideom).removeClass('hide_dom');\r\n    me.element.find(pushClassName).addClass('tool_push_ing');\r\n    me.top.startFlow('exerciseStart', {\r\n      scope: ['tool', 'common'],\r\n      sourcePresenterUnqiueId: uniqueId\r\n    }, function () {\r\n      me.top.TOOL.DATA.PUSHING = true;\r\n      me.top.TOOL.DATA.CURRENTPUSHTOOL = me.unqiueId;\r\n      me.switchToolContainerBG(true);\r\n      //after pushing tool event finished ,add hide_dom to enable push button;\r\n      $(pushClassName).removeClass('on').removeClass('tool_push_ing').addClass('click_disabled');\r\n      me.element.find(hideom).addClass('hide_dom');\r\n      me.element.find(pushClassName).addClass('on');\r\n      if (detector.isOnline()) {\r\n        me.element.find(pushClassName).removeClass('click_disabled');\r\n      }\r\n      timer.start(me);\r\n      me.fireEvent(eventname.tool.push_data, {\r\n        \"toolKey\": me.toolKey,\r\n        \"uniqueId\": uniqueId,\r\n        \"action\": \"push\",\r\n        \"result\": \"success\"\r\n      });\r\n      if (me.toolConfig && me.toolConfig.autoFull) {\r\n        tooldialog.setDisplayMode.apply(me,[{\r\n          __type: \"stu\"\r\n        }, true]);\r\n        me.fireEvent(eventname.tool.adjust_layout, {\r\n          \"toolKey\": me.toolKey,\r\n          \"uniqueId\": uniqueId\r\n        })\r\n      }\r\n    }, function () {\r\n      logger.error(\"push fail\");\r\n      $(pushClassName).removeClass('on').removeClass('tool_push_ing');\r\n      if (detector.isOnline()) {\r\n        $(pushClassName).removeClass('click_disabled');\r\n      }\r\n      me.element.find(hideom).addClass('hide_dom');\r\n      me.fireEvent(eventname.tool.push_data, {\r\n        \"toolKey\": me.toolKey,\r\n        \"uniqueId\": uniqueId,\r\n        \"action\": \"push\",\r\n        \"result\": \"fail\"\r\n      });\r\n    });\r\n  },\r\n  stopPush: function () {\r\n    var me = this;\r\n    var timer = require('core.common.timer');\r\n    var pushClassName = '.btn_tool.tool_push';\r\n    var hideom = \".tool_wrap_mask\";\r\n    //prevent click event when user pushing tool\r\n    me.element.find(hideom).removeClass('hide_dom');\r\n\r\n    var uniqueId = me.mainModule.getPresenter() ? (me.mainModule.getPresenter().__model ? me.mainModule.getPresenter().__model.$.unqiueId : 0) : 0;\r\n    me.top.startFlow('exerciseExit', {\r\n      scope: ['tool', 'common'],\r\n      sourcePresenterUnqiueId: uniqueId\r\n    }, function () {\r\n      me.fireEvent(eventname.tool.push_data, {\r\n        \"toolKey\": me.toolKey,\r\n        \"uniqueId\": uniqueId,\r\n        \"action\": \"stop_push\",\r\n        \"result\": \"success\"\r\n      });\r\n      if (me.toolConfig && me.toolConfig.autoFull) {\r\n        tooldialog.setDisplayMode.apply(me,[{\r\n          __type: \"pc\"\r\n        }, true]);\r\n        me.fireEvent(eventname.tool.adjust_layout, {\r\n          \"toolKey\": me.toolKey,\r\n          \"uniqueId\": uniqueId\r\n        });\r\n      }\r\n      setTimeout(function () {\r\n        me.element.find(hideom).addClass('hide_dom');\r\n      }, 1000);\r\n    }, function () {\r\n      me.fireEvent(eventname.tool.push_data, {\r\n        \"toolKey\": me.toolKey,\r\n        \"uniqueId\": uniqueId,\r\n        \"action\": \"stop_push\",\r\n        \"result\": \"success\"\r\n      });\r\n    });\r\n    me.top.TOOL.DATA.PUSHING = false;\r\n    me.top.TOOL.DATA.CURRENTPUSHTOOL = undefined;\r\n    me.switchToolContainerBG(false);\r\n    timer.reset(me);\r\n    setTimeout(function () {\r\n      me.element.find(hideom).addClass('hide_dom');\r\n    }, 1000);\r\n\r\n    $(pushClassName).removeClass('on').removeClass('click_disabled');\r\n  },\r\n  setEnable: function () {\r\n    $('.ic_tool_container').find('._icplayer_push_button').removeClass('click_disabled');\r\n  },\r\n  setDisable: function () {\r\n    $('.ic_tool_container').find('._icplayer_push_button').addClass('click_disabled');\r\n  },\r\n  /**\r\n   * 返回pushdom的状态。true:可用的状态，false：不可用的状态\r\n   * @return {boolean}\r\n   */\r\n  pushDomStatus: function(){\r\n    var me = this;\r\n    return !(me.top.TOOL.DATA.PUSHING||!detector.isOnline())\r\n  }\r\n}\r\n\r\n}, '');\n__applicationContext.define('core.model.parser.mainxmlparser', function (exports,module,require,$) {\r\n'use strict';\r\nvar utilsXML = require('core.utils.xml');\r\nvar mainModel = require('core.model.mainModel');\r\n\r\nmodule.exports = {\r\n    parse: function (text) {\r\n        var $dom = $($.parseXML(text));\r\n        var model = new mainModel();\r\n        var commonPages = model.getAttribute('commons');\r\n        var index = 0;\r\n        var parentTagName;\r\n        $dom.find(\"page\").each(function (i, page) {\r\n            var pageInfo = utilsXML.toJsonByAttr(page, ['id', 'name', 'href', 'preview']);\r\n            pageInfo.id = pageInfo.id || 'page_' + index;\r\n            parentTagName = page.parentNode.tagName.toLowerCase();\r\n            if (parentTagName === 'folder') {\r\n                if (pageInfo.name) {\r\n                    commonPages.addItem(pageInfo.name, pageInfo);\r\n                }\r\n            } else {\r\n                if (parentTagName === 'coursewareobject') {\r\n                    var rootPath = page.parentNode.getAttribute(\"rootPath\");\r\n                    pageInfo.href = rootPath + pageInfo.href;\r\n                }\r\n                model.addPage(pageInfo);\r\n            }\r\n            index++;\r\n        });\r\n\r\n        $dom.find('style').each(function (i, style) {\r\n            model.setAttribute('css', style.getAttribute('href'));\r\n            model.setAttribute('style', $(style).text());\r\n        });\r\n        return model;\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.model.parser.moduleparse', function (exports,module,require,$) {\r\n'use strict';\r\nvar moduleModel = require('core.model.ModuleModel');\r\nvar utilsXML = require('core.utils.xml');\r\nvar propertiesParse = require('core.model.parser.propertiesParse');\r\nvar Layout = require('core.layout.Layout');\r\n\r\nvar parseModule = {\r\n    'style': function (module, element) {\r\n        module.setAttribute('css', $(element).attr('href'));\r\n        var style = $(element).text();\r\n        if (style) {\r\n            module.setAttribute('style', style);\r\n        }\r\n    },\r\n    'events': function (module, element) {\r\n        $(element).children('event').each(function (i, event) {\r\n            var $event = $(event);\r\n            var eventName = $event.attr('name');\r\n            if (eventName) {\r\n                var handlerList = [];\r\n                $event.children('handler').each(function (j, handler) {\r\n                    handlerList.push(utilsXML.toJsonByAttr(handler, [{'id': 'targetId'}, {'name': 'handlerName'}]));\r\n                });\r\n                if (handlerList.length) {\r\n                    module.addEvent(eventName, handlerList);\r\n                }\r\n            }\r\n        });\r\n    },\r\n    'properties': propertiesParse\r\n};\r\n\r\nmodule.exports = function (parent, modules) {\r\n    //兼容新旧格式module和addonModule都支持\r\n    var index = 0;\r\n    $(modules).children('module,addonModule').each(function (i, module) {\r\n        var _module = new moduleModel();\r\n        var moduleConfig = utilsXML.toJsonByAttr(module, ['addonId', 'moduleId', 'presenterId', 'id', 'isVisible', 'isLocked', 'style', {\r\n            'lazy-init': function (value) {\r\n                return value.toLowerCase() === 'true';\r\n            }\r\n        }]);\r\n        //兼容新旧格式,addonId和presenterId\r\n        if (!moduleConfig.presenterId && moduleConfig.addonId) {\r\n            moduleConfig.presenterId = moduleConfig.addonId;\r\n        }\r\n        moduleConfig.id = moduleConfig.id || 'module_' + index;\r\n        var layout = utilsXML.toJsonByAttr(module, Layout.attrName);\r\n        _module.setAttributes(moduleConfig);\r\n        _module.setAttribute('layout', layout);\r\n\r\n        $(module).children().each(function (i, element) {\r\n            var fn = parseModule[element.tagName];\r\n            if ($.isFunction(fn)) {\r\n                fn(_module, element);\r\n            }\r\n        });\r\n        parent.addModule(_module);\r\n        index++;\r\n    });\r\n};\r\n}, '');\n__applicationContext.define('core.model.parser.pagexmlparser', function (exports,module,require,$) {\r\n'use strict';\r\nvar pageModel = require('core.model.pageModel');\r\nvar moduleParse = require('core.model.parser.moduleParse');\r\nvar utilsXML = require('core.utils.xml');\r\nvar Layout = require('core.layout.Layout');\r\nvar presentersParse = require('core.model.parser.presenterDecalareParse');\r\n\r\nvar parserMapping = {\r\n    modules: moduleParse,\r\n    addons: presentersParse,\r\n    presenters: presentersParse\r\n};\r\n\r\nmodule.exports = {\r\n    parse: function (text) {\r\n        var dom = $.parseXML(text);\r\n        var model = new pageModel();\r\n        var root = dom.documentElement;\r\n        var layout = utilsXML.toJsonByAttr(root, Layout.attrName);\r\n        model.setAttribute('layout', layout);\r\n        var $page = $(dom).find('page');\r\n        $page.children().each(function (i, element) {\r\n            var parser = parserMapping[element.tagName];\r\n            if (parser) {\r\n                parser(model, element);\r\n            }\r\n        });\r\n        return model;\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.model.parser.presenterdecalareparse', function (exports,module,require,$) {\r\n'use strict';\r\n\r\nvar idNameMapping = {\r\n    'presenter': 'id',\r\n    'addon-descriptor': 'addonId'\r\n};\r\n\r\nmodule.exports = function (parent, presenters) {\r\n    //兼容旧格式\r\n    $(presenters).children('presenter,addon-descriptor').each(function (i, presenter) {\r\n        var href = presenter.getAttribute('href');\r\n        if (href) {\r\n            parent.addPresenter(presenter.getAttribute(idNameMapping[presenter.tagName]), href);\r\n        }\r\n    });\r\n};\r\n}, '');\n__applicationContext.define('core.model.parser.presenterxmlparser', function (exports,module,require,$) {\r\n'use strict';\r\nvar PresenterModel = require('core.model.PresenterModel');\r\nvar xmlUtils = require('core.utils.xml');\r\nvar dependenceParser = {\r\n    'jsDependency': function (element, attr) {\r\n        $(element).children('javascript').each(function (i, js) {\r\n            var jsObject = xmlUtils.toJsonByAttr(js, ['name', 'version']);\r\n            attr.push(jsObject);\r\n        });\r\n    },\r\n    'moduleDependency': function (element, attr) {\r\n        $(element).children('module').each(function (i, module) {\r\n            var moduleObject = xmlUtils.toJsonByAttr(module, ['addonId', 'href']);\r\n            attr[moduleObject.addonId] = moduleObject;\r\n        });\r\n    }\r\n};\r\n\r\nvar tagMapping = {\r\n    'presenter': 'script'\r\n};\r\n\r\nexports.parse = function (text) {\r\n    var model = new PresenterModel();\r\n    var dom = $($.parseXML(text));\r\n    dom.find('dependencies').children().each(function (i, dependence) {\r\n        var fn = dependenceParser[dependence.tagName];\r\n        if ($.isFunction(fn)) {\r\n            fn(dependence, model.getAttribute(dependence.tagName));\r\n        }\r\n    });\r\n    dom.children('presenter,addon').children('css,view,script,presenter').each(function (index, element) {\r\n        var tagName = element.tagName;\r\n        if (tagName in tagMapping) {\r\n            tagName = tagMapping[tagName];\r\n        }\r\n        model.setAttribute(tagName, $.trim($(element).text()));\r\n    });\r\n    return model;\r\n};\r\n}, '');\n__applicationContext.define('core.model.parser.propertiesparse', function (exports,module,require,$) {\r\n'use strict';\r\nvar utilsXML = require('core.utils.xml');\r\n\r\nvar buildProp = function (element, fn) {\r\n    $(element).children('property').each(function (i, prop) {\r\n        var oProp;\r\n        if (prop.getAttribute('type') === 'list') {\r\n            oProp = utilsXML.toJsonByAttr(prop, ['name', 'type']);\r\n            oProp.value = [];\r\n            $(prop).find('items>item').each(function (i, item) {\r\n                var itemProps = [];\r\n                buildProp(item, function (oProp) {\r\n                    itemProps.push(oProp);\r\n                });\r\n                oProp.value.push(itemProps);\r\n            });\r\n        } else {\r\n            oProp = utilsXML.toJsonByAttr(prop, ['name', 'type', 'value']);\r\n            var sText = $.trim($(prop).text());\r\n            if (sText) {\r\n                oProp.text = sText;\r\n            }\r\n        }\r\n        fn(oProp);\r\n    });\r\n};\r\n\r\n\r\nmodule.exports = function (parent, element) {\r\n    buildProp(element, function (oProp) {\r\n        parent.addProperty(oProp);\r\n    });\r\n};\r\n}, '');\n__applicationContext.define('core.model.parser.simplejsonparser', function (exports,module,require,$) {\r\n'use strict';\r\nexports.parse = function (text) {\r\n    return JSON.parse(text);\r\n};\r\n}, '');\n__applicationContext.define('core.model.parser.toolparser', function (exports,module,require,$) {\r\n'use strict';\r\nvar modulesParse = require('core.model.parser.moduleParse');\r\nvar propertiesParse = require('core.model.parser.propertiesParse');\r\nvar presentersParse = require('core.model.parser.presenterDecalareParse');\r\nvar ToolModel = require('core.model.ToolModel');\r\nvar xmlUtil = require('core.utils.xml');\r\nvar Layout = require('core.layout.Layout');\r\n\r\nvar parserMapping = {\r\n    'presenters': presentersParse,\r\n    'properties': propertiesParse,\r\n    'modules': modulesParse\r\n};\r\n\r\nmodule.exports = {\r\n    'parse': function (text) {\r\n        var model = new ToolModel();\r\n        var dom = $.parseXML(text);\r\n        var $tool = $(dom).children('tool');\r\n        var toolLayout = xmlUtil.toJsonByAttr($tool[0], Layout.attrName);\r\n        model.setAttribute('layout', toolLayout);\r\n\r\n        $tool.children().each(function (i, element) {\r\n            var key = element.tagName;\r\n            var parser = parserMapping[key];\r\n            if (parser) {\r\n                parser(model, element);\r\n            }\r\n            if (key === 'modules') {\r\n                model.setAttribute('mainModule', element.getAttribute('main') || 'main');\r\n            }\r\n        });\r\n        return model;\r\n    }\r\n};\r\n}, '');\n__applicationContext.define('core.model.proxy.ajaxproxy', function (exports,module,require,$) {\r\n'use strict';\r\nexports.getData = function (url, isCache) {\r\n    return $.ajax({\r\n        \"url\": url,\r\n        \"cache\": (isCache !== false),\r\n\t\t\"dataType\": \"text\"\r\n    });\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.locations.en.lang', function (exports,module,require,$) {\r\nmodule.exports = {\r\n\t\"Tool_ToolName\": \"Tool Name\",\r\n\t\"Tool_Sure\": \"Confirm\",\r\n\t\"Tool_Push\": \"Send\",\r\n\t\"Tool_Pushing\": \"Sending\",\r\n\t\"Tool_Finish\": \"End\",\r\n\t\"Tool_Pushed_Tip\": \"The tool has already been sent to student(s). It will close for student(s) if you close now\",\r\n\t\"Tool_Tip\": \"Close?\",\r\n\t\"Tool_Cancel\": \"Cancel\",\r\n\t\"Tool_PopLimit\": \"You have already opened <span id='maxlimit'></span> <span id='classtool'></span>.<br/>Please close 1 before you open another.\",\r\n\t\"Tool_See\": \"Got It\",\r\n\t\"Tool_bottom\": \"class tools\",\r\n\t\"Tool_top\": \"common tools\",\r\n\t\"Tool_full\": \"This function is coming soon.\",\r\n\t\"Tool_Not_Support\": \"Sorry，this tool does not support Windows XP, please experience in Windows 7 and above.\"\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.locations.en_us.lang', function (exports,module,require,$) {\r\nmodule.exports = {\r\n\t\"Tool_ToolName\": \"Tool Name\",\r\n\t\"Tool_Sure\": \"Confirm\",\r\n\t\"Tool_Push\": \"Send\",\r\n\t\"Tool_Pushing\": \"Sending\",\r\n\t\"Tool_Finish\": \"End\",\r\n\t\"Tool_Pushed_Tip\": \"The tool has already been sent to student(s). It will close for student(s) if you close now\",\r\n\t\"Tool_Tip\": \"Close?\",\r\n\t\"Tool_Cancel\": \"Cancel\",\r\n\t\"Tool_PopLimit\": \"You have already opened <span id='maxlimit'></span> <span id='classtool'></span>.<br/>Please close 1 before you open another.\",\r\n\t\"Tool_See\": \"Got It\",\r\n\t\"Tool_bottom\":\"class tools\",\r\n\t\"Tool_top\":\"common tools\",\r\n\t\"Tool_full\":\"This function is coming soon.\",\r\n\t\"Tool_Not_Support\": \"Sorry，this tool does not support Windows XP, please experience in Windows 7 and above.\"\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.locations.ja.lang', function (exports,module,require,$) {\r\nmodule.exports = {\r\n\t\"Tool_ToolName\": \"工具名称\",\r\n\t\"Tool_Sure\": \"OK\",\r\n\t\"Tool_Push\": \"送信\",\r\n\t\"Tool_Pushing\": \"送信中\",\r\n\t\"Tool_Finish\": \"終了\",\r\n\t\"Tool_Pushed_Tip\": \"ツールは生徒端末に送信されました。今閉じると生徒端末の使用が終了となりますが。\",\r\n\t\"Tool_Tip\": \"ツールを閉じますか？\",\r\n\t\"Tool_Cancel\": \"キャンセル\",\r\n\t\"Tool_PopLimit\": \"既に<span id='maxlimit'></span>つの<span id='classtool'></span>が開かれました，<br/>新たなツールを開く前に、開かれたツールを閉じてください。\",\r\n\t\"Tool_See\": \"了解です...\",\r\n\t\"Tool_bottom\":\"教科ツール\",\r\n\t\"Tool_top\":\"一般ツール\",\r\n\t\"Tool_full\":\"機能開発中、乞うご期待!\"\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.locations.ja_jp.lang', function (exports,module,require,$) {\r\nmodule.exports = {\r\n\t\"Tool_ToolName\": \"工具名称\",\r\n\t\"Tool_Sure\": \"OK\",\r\n\t\"Tool_Push\": \"送信\",\r\n\t\"Tool_Pushing\": \"送信中\",\r\n\t\"Tool_Finish\": \"終了\",\r\n\t\"Tool_Pushed_Tip\": \"ツールは生徒端末に送信されました。今閉じると生徒端末の使用が終了となりますが。\",\r\n\t\"Tool_Tip\": \"ツールを閉じますか？\",\r\n\t\"Tool_Cancel\": \"キャンセル\",\r\n\t\"Tool_PopLimit\": \"既に<span id='maxlimit'></span>つの<span id='classtool'></span>が開かれました，<br/>新たなツールを開く前に、開かれたツールを閉じてください。\",\r\n\t\"Tool_See\": \"了解です...\",\r\n\t\"Tool_bottom\":\"教科ツール\",\r\n\t\"Tool_top\":\"一般ツール\",\r\n\t\"Tool_full\":\"機能開発中、乞うご期待!\"\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.locations.zh.lang', function (exports,module,require,$) {\r\nmodule.exports = {\r\n\t\"Tool_ToolName\": \"工具名称\",\r\n\t\"Tool_Sure\": \"确定\",\r\n\t\"Tool_Push\": \"推送\",\r\n\t\"Tool_Pushing\": \"推送中\",\r\n\t\"Tool_Finish\": \"结束\",\r\n\t\"Tool_Pushed_Tip\": \"工具已推送至学生端，此时关闭将同时结束学生端使用。\",\r\n\t\"Tool_Tip\": \"确认关闭当前工具吗？\",\r\n\t\"Tool_Cancel\": \"取消\",\r\n\t\"Tool_PopLimit\": \"老师，已经打开<span id='maxlimit'></span>个<span id='classtool'></span>，<br/>请先关闭已有的工具，再新开工具。\",\r\n\t\"Tool_See\": \"知道了...\",\r\n\t\"Tool_bottom\":\"课时工具\",\r\n\t\"Tool_top\":\"常用工具\",\r\n\t\"Tool_full\":\"该功能程序哥哥正在加班加点的开发中哦，<br>敬请期待！\",\r\n\t\"Tool_Not_Support\": \"抱歉，该工具不支持XP系统，请在win7及以上的操作系统中体验。\"\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.locations.zh_cn.lang', function (exports,module,require,$) {\r\nmodule.exports = {\r\n\t\"Tool_ToolName\": \"工具名称\",\r\n\t\"Tool_Sure\": \"确定\",\r\n\t\"Tool_Push\": \"推送\",\r\n\t\"Tool_Pushing\": \"推送中\",\r\n\t\"Tool_Finish\": \"结束\",\r\n\t\"Tool_Pushed_Tip\": \"工具已推送至学生端，此时关闭将同时结束学生端使用。\",\r\n\t\"Tool_Tip\": \"确认关闭当前工具吗？\",\r\n\t\"Tool_Cancel\": \"取消\",\r\n\t\"Tool_PopLimit\": \"老师，已经打开<span id='maxlimit'></span>个<span id='classtool'></span>，<br/>请先关闭已有的工具，再新开工具。\",\r\n\t\"Tool_See\": \"知道了...\",\r\n\t\"Tool_bottom\":\"课时工具\",\r\n\t\"Tool_top\":\"常用工具\",\r\n\t\"Tool_full\":\"该功能程序哥哥正在加班加点的开发中哦，<br>敬请期待！\",\r\n\t\"Tool_Not_Support\": \"抱歉，该工具不支持XP系统，请在win7及以上的操作系统中体验。\"\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.locations.zh_hk.lang', function (exports,module,require,$) {\r\nmodule.exports = {\r\n\t\"Tool_ToolName\": \"工具名稱\",\r\n\t\"Tool_Sure\": \"確定\",\r\n\t\"Tool_Push\": \"推送\",\r\n\t\"Tool_Pushing\": \"推送中\",\r\n\t\"Tool_Finish\": \"結束\",\r\n\t\"Tool_Pushed_Tip\": \"工具已推送至學生端，此時關閉將同時結束學生端使用。\",\r\n\t\"Tool_Tip\": \"確認關閉當前工具嗎？\",\r\n\t\"Tool_Cancel\": \"取消\",\r\n\t\"Tool_PopLimit\": \"老師，已經打開<span id='maxlimit'></span>個<span id='classtool'></span>，<br/>請先關閉已有的工具，再新開工具。\",\r\n\t\"Tool_See\": \"知道了...\",\r\n\t\"Tool_bottom\":\"課時工具\",\r\n\t\"Tool_top\":\"常用工具\",\r\n\t\"Tool_full\":\"該功能程序哥哥正在加班加點的開發中哦，<br>敬請期待！\",\r\n\t\"Tool_Not_Support\": \"抱歉，該工具不支持XP系統，請在win7及以上的操作系統中體驗。\"\r\n};\r\n\r\n}, '');\n__applicationContext.define('core.utils.drawingboard.board', function (exports,module,require,$) {\r\n'use strict';\r\nvar DrawingBoardUtil = require('core.utils.drawingboard.utils');\r\nvar SimpleUndo = require('core.utils.baseundo');\r\nvar DrawingBoardMicroEvent = require('core.utils.drawingboard.microevent');\r\nvar uuid = require('core.utils.uuid');\r\nvar DrawingBoard = function(el, opts) {\r\n\tthis.opts = this.mergeOptions(opts);\r\n\r\n\tthis.ev = new DrawingBoardMicroEvent();\r\n    //为存储时key\r\n\t$.data(el,'id',uuid(8));\r\n\tthis.$el = el;\r\n\tif (!this.$el.length)\r\n\t\treturn false;\r\n\tvar tpl = '<div class=\"ic_page_tool_drawing-board-canvas-wrapper\"><canvas class=\"ic_page_tool_drawing-board-canvas\"></canvas><div class=\"ic_page_tool_drawing-board-cursor ic_page_tool_drawing-board-utils-hidden\"></div></div>';\r\n\tthis.$el.addClass('ic_page_tool_drawing-board').append(tpl);\r\n\tthis.dom = {\r\n\t    $canvasWrapper: this.$el.find('.ic_page_tool_drawing-board-canvas-wrapper'),\r\n\t    $canvas: this.$el.find('.ic_page_tool_drawing-board-canvas'),\r\n\t    $cursor: this.$el.find('.ic_page_tool_drawing-board-cursor'),\r\n\t    $controls: this.$el.find('.ic_page_tool_drawing-board-controls')\r\n\t};\r\n\r\n\t$.each(['left', 'right', 'center'], $.proxy(function(n, val) {\r\n\t\tif (this.opts.controlsPosition.indexOf(val) > -1) {\r\n\t\t\tthis.dom.$controls.attr('data-align', val);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}, this));\r\n\r\n\tthis.canvas = this.dom.$canvas.get(0);\r\n\tthis.ctx = this.canvas && this.canvas.getContext && this.canvas.getContext('2d') ? this.canvas.getContext('2d') : null;\r\n\tthis.color = this.opts.color;\r\n\r\n\tif (!this.ctx) {\r\n\t\tif (this.opts.errorMessage)\r\n\t\t\tthis.$el.html(this.opts.errorMessage);\r\n\t\treturn false;\r\n\t}\r\n\tthis.storage = this._getStorage();\r\n\r\n\tthis.initHistory();\r\n\t//init default board values before controls are added (mostly pencil color and size)\r\n\tthis.reset({ webStorage: false, history: false, background: false });\r\n\t//init controls (they will need the default board values to work like pencil color and size)\r\n    //this.initControls();\r\n\t//set board's size after the controls div is added\r\n\tthis.resize();\r\n\t//reset the board to take all resized space\r\n\tthis.reset({ webStorage: false, history: false, background: true });\r\n\tthis.restoreWebStorage();\r\n\tthis.initDropEvents();\r\n\t//this.initDrawEvents();\r\n};\r\n\r\nDrawingBoard.defaultOpts = {\r\n\tcontrols: ['Color', 'DrawingMode', 'Size', 'Navigation'],\r\n\tcontrolsPosition: \"top left\",\r\n\tcolor: \"#000000\",\r\n\tsize: 1,\r\n\tbackground: false,\r\n\teraserColor: \"background\",\r\n\tfillTolerance: 100,\r\n\tfillHack: true, //try to prevent issues with anti-aliasing with a little hack by default\r\n\twebStorage: 'session',\r\n\tdroppable: false,\r\n\tenlargeYourContainer: false,\r\n\terrorMessage: \"<p>Your Broswer version is too older. <a href=\\\"http://browsehappy.com/\\\" target=\\\"_blank\\\">please update the browser to the latest.</a></p>\",\r\n\tstretchImg: false //是否拉伸背景图片\r\n};\r\nDrawingBoard.prototype = {\r\n\r\n\tmergeOptions: function(opts) {\r\n\t\topts = $.extend({}, DrawingBoard.defaultOpts, opts);\r\n\t\tif (!opts.background && opts.eraserColor === \"background\")\r\n\t\t\topts.eraserColor = \"transparent\";\r\n\t\treturn opts;\r\n\t},\r\n\r\n\treset: function(opts) {\r\n\t\topts = $.extend({\r\n\t\t\tcolor: this.opts.color,\r\n\t\t\tsize: this.opts.size,\r\n\t\t\twebStorage: true,\r\n\t\t\thistory: true,\r\n\t\t\tbackground: false\r\n\t\t}, opts);\r\n\r\n\t\tthis.setMode('pencil');\r\n\r\n\t\tif (opts.background) {\r\n\t\t\tthis.resetBackground(this.opts.background, $.proxy(function() {\r\n\t\t\t\tif (opts.history) this.saveHistory();\r\n\t\t\t}, this));\r\n\t\t}\r\n\r\n\t\tif (opts.color) this.setColor(opts.color);\r\n\t\tif (opts.size) this.ctx.lineWidth = opts.size;\r\n\r\n\t\tthis.ctx.lineCap = \"round\";\r\n\t\tthis.ctx.lineJoin = \"round\";\r\n\r\n\t\tif (opts.webStorage) this.saveWebStorage();\r\n\r\n\t\tif (opts.history && !opts.background) this.saveHistory();\r\n\r\n\t\tthis.blankCanvas = this.getImg();\r\n\r\n\t\tthis.ev.trigger('board:reset', opts);\r\n\t},\r\n\r\n\tresetBackground: function(background, callback) {\r\n\t\tbackground = background || this.opts.background;\r\n\r\n\t\tvar bgIsColor = DrawingBoardUtil.isColor(background);\r\n\t\tvar prevMode = this.getMode();\r\n\t\tthis.setMode('pencil');\r\n\t\tthis.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\t\tif (bgIsColor) {\r\n\t\t\tthis.ctx.fillStyle = background;\r\n\t\t\tthis.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\t\t\tthis.history.initialize(this.getImg());\r\n\t\t\tif (callback) callback();\r\n\t\t} else if (background)\r\n\t\t\tthis.setImg(background, {\r\n\t\t\t\tcallback: $.proxy(function() {\r\n\t\t\t\t\tthis.history.initialize(this.getImg());\r\n\t\t\t\t\tif (callback) callback();\r\n\t\t\t\t}, this)\r\n\t\t\t});\r\n\t\tthis.setMode(prevMode);\r\n\t},\r\n\r\n\tresize: function() {\r\n\t    this.dom.$controls.toggleClass('ic_page_tool_drawing-board-controls-hidden', (!this.controls || !this.controls.length));\r\n\r\n\t\tvar canvasWidth, canvasHeight;\r\n\t\tvar widths = [\r\n\t\t\tthis.$el.width(),\r\n\t\t\tDrawingBoardUtil.boxBorderWidth(this.$el),\r\n\t\t\tDrawingBoardUtil.boxBorderWidth(this.dom.$canvasWrapper, true, true)\r\n\t\t];\r\n\t\tvar heights = [\r\n\t\t\tthis.$el.height(),\r\n\t\t\tDrawingBoardUtil.boxBorderHeight(this.$el),\r\n\t\t\tthis.dom.$controls.height(),\r\n\t\t\tDrawingBoardUtil.boxBorderHeight(this.dom.$controls, false, true),\r\n\t\t\tDrawingBoardUtil.boxBorderHeight(this.dom.$canvasWrapper, true, true)\r\n\t\t];\r\n\t\tvar sum = function(values, multiplier) { //make the sum of all array values\r\n\t\t\tmultiplier = multiplier || 1;\r\n\t\t\tvar res = values[0];\r\n\t\t\tfor (var i = 1; i < values.length; i++) {\r\n\t\t\t\tres = res + (values[i]*multiplier);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t};\r\n\t\tvar sub = function(values) { return sum(values, -1); }; //substract all array values from the first one\r\n\r\n\t\tif (this.opts.enlargeYourContainer) {\r\n\t\t\tcanvasWidth = this.$el.width();\r\n\t\t\tcanvasHeight = this.$el.height();\r\n\r\n\t\t\tthis.$el.width( sum(widths) );\r\n\t\t\tthis.$el.height( sum(heights) );\r\n\t\t} else {\r\n\t\t\tcanvasWidth = sub(widths);\r\n\t\t\tcanvasHeight = sub(heights);\r\n\t\t}\r\n\r\n\t\tthis.dom.$canvasWrapper.css('width', canvasWidth + 'px');\r\n\t\tthis.dom.$canvasWrapper.css('height', canvasHeight + 'px');\r\n\r\n\t\tthis.dom.$canvas.css('width', canvasWidth + 'px');\r\n\t\tthis.dom.$canvas.css('height', canvasHeight + 'px');\r\n\r\n\t\tthis.canvas.width = canvasWidth;\r\n\t\tthis.canvas.height = canvasHeight;\r\n\t},\r\n\tinitControls: function() {\r\n\t\t\r\n\t},\r\n\r\n\t\r\n\taddControl: function() {\r\n\r\n\t},\r\n\r\n\tinitHistory: function() {\r\n\t\tthis.history = new SimpleUndo({\r\n\t\t\tmaxLength: 30,\r\n\t\t\tprovider: $.proxy(function(done) {\r\n\t\t\t\tdone(this.getImg());\r\n\t\t\t}, this),\r\n\t\t\tonUpdate: $.proxy(function() {\r\n\t\t\t\tthis.ev.trigger('historyNavigation');\r\n\t\t\t}, this)\r\n\t\t});\r\n\t},\r\n\r\n\tsaveHistory: function() {\r\n\t\tthis.history.save();\r\n\t},\r\n\r\n\trestoreHistory: function(image) {\r\n\t\tthis.setImg(image, {\r\n\t\t\tcallback: $.proxy(function() {\r\n\t\t\t\tthis.saveWebStorage();\r\n\t\t\t}, this)\r\n\t\t});\r\n\t},\r\n\r\n\tgoBackInHistory: function() {\r\n\t\tthis.history.undo($.proxy(this.restoreHistory, this));\r\n\t},\r\n\r\n\tgoForthInHistory: function() {\r\n\t\tthis.history.redo($.proxy(this.restoreHistory, this));\r\n\t},\r\n\r\n\r\n\tsetImg: function(src, opts) {\r\n\t\topts = $.extend({\r\n\t\t\tstretch: this.opts.stretchImg,\r\n\t\t\tcallback: null\r\n\t\t}, opts);\r\n\r\n\t\tvar ctx = this.ctx;\r\n\t\tvar img = new Image();\r\n\t\tvar oldGCO = ctx.globalCompositeOperation;\r\n\t\timg.onload = function() {\r\n\t\t\tctx.globalCompositeOperation = \"source-over\";\r\n\t\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\t\t\tif (opts.stretch) {\r\n\t\t\t\tctx.drawImage(img, 0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\t\t\t} else {\r\n\t\t\t\tctx.drawImage(img, 0, 0);\r\n\t\t\t}\r\n\r\n\t\t\tctx.globalCompositeOperation = oldGCO;\r\n\r\n\t\t\tif (opts.callback) {\r\n\t\t\t\topts.callback();\r\n\t\t\t}\r\n\t\t};\r\n\t\timg.src = src;\r\n\t},\r\n\r\n\tgetImg: function() {\r\n\t\treturn this.canvas.toDataURL(\"image/png\");\r\n\t},\r\n\r\n\tdownloadImg: function() {\r\n\t\tvar img = this.getImg();\r\n\t\timg = img.replace(\"image/png\", \"image/octet-stream\");\r\n\t\twindow.location.href = img;\r\n\t},\r\n\r\n\r\n\tsaveWebStorage: function() {\r\n\t\tif (window[this.storage]) {\r\n\t\t\twindow[this.storage].setItem('drawing-board-' +$.data(this,'id'), this.getImg());\r\n\t\t\tthis.ev.trigger('board:save' + this.storage.charAt(0).toUpperCase() + this.storage.slice(1), this.getImg());\r\n\t\t}\r\n\t},\r\n\r\n\trestoreWebStorage: function() {\r\n\t    if (window[this.storage] && window[this.storage].getItem('drawing-board-' + $.data(this, 'id')) !== null) {\r\n\t        this.setImg(window[this.storage].getItem('drawing-board-' + $.data(this, 'id')));\r\n\t        this.ev.trigger('board:restore' + this.storage.charAt(0).toUpperCase() + this.storage.slice(1), window[this.storage].getItem('drawing-board-' + $.data(this, 'id')));\r\n\t\t}\r\n\t},\r\n\r\n\tclearWebStorage: function() {\r\n\t    if (window[this.storage] && window[this.storage].getItem('drawing-board-' + $.data(this, 'id')) !== null) {\r\n\t        window[this.storage].removeItem('drawing-board-' + $.data(this, 'id'));\r\n\t\t\tthis.ev.trigger('board:clear' + this.storage.charAt(0).toUpperCase() + this.storage.slice(1));\r\n\t\t}\r\n\t},\r\n\r\n\t_getStorage: function() {\r\n\t\tif (!this.opts.webStorage || !(this.opts.webStorage === 'session' || this.opts.webStorage === 'local')) return false;\r\n\t\treturn this.opts.webStorage + 'Storage';\r\n\t},\r\n\r\n\r\n\r\n\t\r\n\r\n\tinitDropEvents: function() {\r\n\t\tif (!this.opts.droppable)\r\n\t\t\treturn false;\r\n\r\n\t\tthis.dom.$canvas.on('dragover dragenter drop', function(e) {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\r\n\t\tthis.dom.$canvas.on('drop', $.proxy(this._onCanvasDrop, this));\r\n\t},\r\n\r\n\t_onCanvasDrop: function(e) {\r\n\t\te = e.originalEvent ? e.originalEvent : e;\r\n\t\tvar files = e.dataTransfer.files;\r\n\t\tif (!files || !files.length || files[0].type.indexOf('image') == -1 || !window.FileReader)\r\n\t\t\treturn false;\r\n\t\tvar fr = new FileReader();\r\n\t\tfr.readAsDataURL(files[0]);\r\n\t\tfr.onload = $.proxy(function(ev) {\r\n\t\t\tthis.setImg(ev.target.result, {\r\n\t\t\t\tcallback: $.proxy(function() {\r\n\t\t\t\t\tthis.saveHistory();\r\n\t\t\t\t}, this)\r\n\t\t\t});\r\n\t\t\tthis.ev.trigger('board:imageDropped', ev.target.result);\r\n\t\t\tthis.ev.trigger('board:userAction');\r\n\t\t}, this);\r\n\t},\r\n\r\n\r\n\r\n\t\r\n\r\n\tsetMode: function(newMode, silent) {\r\n\t\tsilent = silent || false;\r\n\t\tnewMode = newMode || 'pencil';\r\n\r\n\t\tthis.ev.unbind('board:startDrawing', $.proxy(this.fill, this));\r\n\r\n\t\tif (this.opts.eraserColor === \"transparent\")\r\n\t\t\tthis.ctx.globalCompositeOperation = newMode === \"eraser\" ? \"destination-out\" : \"source-over\";\r\n\t\telse {\r\n\t\t\tif (newMode === \"eraser\") {\r\n\t\t\t    if (this.opts.eraserColor === \"background\" && DrawingBoardUtil.isColor(this.opts.background))\r\n\t\t\t\t\tthis.ctx.strokeStyle = this.opts.background;\r\n\t\t\t    else if (DrawingBoardUtil.isColor(this.opts.eraserColor))\r\n\t\t\t\t\tthis.ctx.strokeStyle = this.opts.eraserColor;\r\n\t\t\t} else if (!this.mode || this.mode === \"eraser\") {\r\n\t\t\t\tthis.ctx.strokeStyle = this.color;\r\n\t\t\t}\r\n\r\n\t\t\tif (newMode === \"filler\")\r\n\t\t\t\tthis.ev.bind('board:startDrawing', $.proxy(this.fill, this));\r\n\t\t}\r\n\t\tthis.mode = newMode;\r\n\t\tif (!silent)\r\n\t\t\tthis.ev.trigger('board:mode', this.mode);\r\n\t},\r\n\r\n\tgetMode: function() {\r\n\t\treturn this.mode || \"pencil\";\r\n\t},\r\n\r\n\tsetColor: function(color) {\r\n\t\tvar that = this;\r\n\t\tcolor = color || this.color;\r\n\t\tif (!DrawingBoardUtil.isColor(color))\r\n\t\t\treturn false;\r\n\t\tthis.color = color;\r\n\t\tif (this.opts.eraserColor !== \"transparent\" && this.mode === \"eraser\") {\r\n\t\t\tvar setStrokeStyle = function(mode) {\r\n\t\t\t\tif (mode !== \"eraser\")\r\n\t\t\t\t\tthat.strokeStyle = that.color;\r\n\t\t\t\tthat.ev.unbind('board:mode', setStrokeStyle);\r\n\t\t\t};\r\n\t\t\tthis.ev.bind('board:mode', setStrokeStyle);\r\n\t\t} else\r\n\t\t\tthis.ctx.strokeStyle = this.color;\r\n\t},\r\n\r\n\t\r\n\tfill: function(e) {\r\n\t\tif (this.getImg() === this.blankCanvas) {\r\n\t\t\tthis.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\t\t\tthis.ctx.fillStyle = this.color;\r\n\t\t\tthis.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar img = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n\t\t// constants identifying pixels components\r\n\t\tvar INDEX = 0, X = 1, Y = 2, COLOR = 3;\r\n\r\n\t\tvar stroke = this.ctx.strokeStyle;\r\n\t\tvar r = parseInt(stroke.substr(1, 2), 16);\r\n\t\tvar g = parseInt(stroke.substr(3, 2), 16);\r\n\t\tvar b = parseInt(stroke.substr(5, 2), 16);\r\n\r\n\t\tvar start = DrawingBoardUtil.pixelAt(img, parseInt(e.coords.x, 10), parseInt(e.coords.y, 10));\r\n\t\tvar startColor = start[COLOR];\r\n\t\tvar tolerance = this.opts.fillTolerance;\r\n\t\tvar useHack = this.opts.fillHack; //see https://github.com/Leimi/drawingboard.js/pull/38\r\n\r\n\t\tif (DrawingBoardUtil.compareColors(startColor, DrawingBoardUtil.RGBToInt(r, g, b), tolerance))\r\n\t\t\treturn;\r\n\r\n\t\tvar queue = [start];\r\n\r\n\t\tvar pixel;\r\n\t\tvar maxX = img.width - 1;\r\n\t\tvar maxY = img.height - 1;\r\n\r\n\t\tfunction updatePixelColor(pixel) {\r\n\t\t\timg.data[pixel[INDEX]] = r;\r\n\t\t\timg.data[pixel[INDEX] + 1] = g;\r\n\t\t\timg.data[pixel[INDEX] + 2] = b;\r\n\t\t}\r\n\r\n\t\twhile ((pixel = queue.pop())) {\r\n\t\t\tif (useHack)\r\n\t\t\t\tupdatePixelColor(pixel);\r\n\r\n\t\t\tif (DrawingBoardUtil.compareColors(pixel[COLOR], startColor, tolerance)) {\r\n\t\t\t\tif (!useHack)\r\n\t\t\t\t\tupdatePixelColor(pixel);\r\n\t\t\t\tif (pixel[X] > 0) // west\r\n\t\t\t\t    queue.push(DrawingBoardUtil.pixelAt(img, pixel[X] - 1, pixel[Y]));\r\n\t\t\t\tif (pixel[X] < maxX) // east\r\n\t\t\t\t    queue.push(DrawingBoardUtil.pixelAt(img, pixel[X] + 1, pixel[Y]));\r\n\t\t\t\tif (pixel[Y] > 0) // north\r\n\t\t\t\t    queue.push(DrawingBoardUtil.pixelAt(img, pixel[X], pixel[Y] - 1));\r\n\t\t\t\tif (pixel[Y] < maxY) // south\r\n\t\t\t\t    queue.push(DrawingBoardUtil.pixelAt(img, pixel[X], pixel[Y] + 1));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.ctx.putImageData(img, 0, 0);\r\n\t},\r\n\r\n\r\n\r\n\r\n\tinitDrawEvents: function() {\r\n\t\t\r\n\t\tthis.isDrawing = false;\r\n\t\tthis.isMouseHovering = false;\r\n\t\tthis.coords = {};\r\n\t\tthis.coords.old = this.coords.current = this.coords.oldMid = { x: 0, y: 0 };\r\n\r\n\t\tthis.dom.$canvas.on('mousedown touchstart', $.proxy(function(e) {\r\n\t\t\tthis._onInputStart(e, this._getInputCoords(e) );\r\n\t\t}, this));\r\n\r\n\t\tthis.dom.$canvas.on('mousemove touchmove', $.proxy(function(e) {\r\n\t\t\tthis._onInputMove(e, this._getInputCoords(e) );\r\n\t\t}, this));\r\n\r\n\t\t//this.dom.$canvas.on('mousemove', $.proxy(function(e) {\r\n\r\n\t\t//}, this));\r\n\r\n\t\tthis.dom.$canvas.on('mouseup touchend', $.proxy(function(e) {\r\n\t\t\tthis._onInputStop(e, this._getInputCoords(e) );\r\n\t\t}, this));\r\n\r\n\t\tthis.dom.$canvas.on('mouseover', $.proxy(function(e) {\r\n\t\t\tthis._onMouseOver(e, this._getInputCoords(e) );\r\n\t\t}, this));\r\n\r\n\t\tthis.dom.$canvas.on('mouseout', $.proxy(function(e) {\r\n\t\t\tthis._onMouseOut(e, this._getInputCoords(e) );\r\n\r\n\t\t}, this));\r\n\r\n\t\t$('body').on('mouseup touchend', $.proxy(function() {\r\n\t\t\tthis.isDrawing = false;\r\n\t\t}, this));\r\n\r\n\t\tif (window.requestAnimationFrame) requestAnimationFrame( $.proxy(this.draw, this) );\r\n\t},\r\n\r\n\tdraw: function() {\r\n\t\t\r\n\t\tif (window.requestAnimationFrame && this.ctx.lineWidth > 10 && this.isMouseHovering) {\r\n\t\t\tthis.dom.$cursor.css({ width: this.ctx.lineWidth + 'px', height: this.ctx.lineWidth + 'px' });\r\n\t\t\tvar transform = DrawingBoardUtil.tpl(\"translateX({{x}}px) translateY({{y}}px)\", { x: this.coords.current.x - (this.ctx.lineWidth / 2), y: this.coords.current.y - (this.ctx.lineWidth / 2) });\r\n\t\t\tthis.dom.$cursor.css({ 'transform': transform, '-webkit-transform': transform, '-ms-transform': transform });\r\n\t\t\tthis.dom.$cursor.removeClass('ic_page_tool_drawing-board-utils-hidden');\r\n\t\t} else {\r\n\t\t    this.dom.$cursor.addClass('ic_page_tool_drawing-board-utils-hidden');\r\n\t\t}\r\n\r\n\t\tif (this.isDrawing) {\r\n\t\t\tvar currentMid = this._getMidInputCoords(this.coords.current);\r\n\t\t\tthis.ctx.beginPath();\r\n\t\t\tthis.ctx.moveTo(currentMid.x, currentMid.y);\r\n\t\t\tthis.ctx.quadraticCurveTo(this.coords.old.x, this.coords.old.y, this.coords.oldMid.x, this.coords.oldMid.y);\r\n\t\t\tthis.ctx.stroke();\r\n\r\n\t\t\tthis.coords.old = this.coords.current;\r\n\t\t\tthis.coords.oldMid = currentMid;\r\n\t\t}\r\n\r\n\t\tif (window.requestAnimationFrame) requestAnimationFrame( $.proxy(function() { this.draw(); }, this) );\r\n\t},\r\n\r\n\t_onInputStart: function(e, coords) {\r\n\t\tthis.coords.current = this.coords.old = coords;\r\n\t\tthis.coords.oldMid = this._getMidInputCoords(coords);\r\n\t\tthis.isDrawing = true;\r\n\r\n\t\tif (!window.requestAnimationFrame) this.draw();\r\n\r\n\t\tthis.ev.trigger('board:startDrawing', {e: e, coords: coords});\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\t},\r\n\r\n\t_onInputMove: function(e, coords) {\r\n\t\tthis.coords.current = coords;\r\n\t\tthis.ev.trigger('board:drawing', {e: e, coords: coords});\r\n\r\n\t\tif (!window.requestAnimationFrame) this.draw();\r\n\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\t},\r\n\r\n\t_onInputStop: function(e, coords) {\r\n\t\tif (this.isDrawing && (!e.touches || e.touches.length === 0)) {\r\n\t\t\tthis.isDrawing = false;\r\n\r\n\t\t\tthis.saveWebStorage();\r\n\t\t\tthis.saveHistory();\r\n\r\n\t\t\tthis.ev.trigger('board:stopDrawing', {e: e, coords: coords});\r\n\t\t\tthis.ev.trigger('board:userAction');\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseOver: function(e, coords) {\r\n\t\tthis.isMouseHovering = true;\r\n\t\tthis.coords.old = this._getInputCoords(e);\r\n\t\tthis.coords.oldMid = this._getMidInputCoords(this.coords.old);\r\n\r\n\t\tthis.ev.trigger('board:mouseOver', {e: e, coords: coords});\r\n\t},\r\n\r\n\t_onMouseOut: function(e, coords) {\r\n\t\tthis.isMouseHovering = false;\r\n\r\n\t\tthis.ev.trigger('board:mouseOut', {e: e, coords: coords});\r\n\t},\r\n\r\n\t_getInputCoords: function(e) {\r\n\t\te = e.originalEvent ? e.originalEvent : e;\r\n\t\tvar\r\n\t\t\trect = this.canvas.getBoundingClientRect(),\r\n\t\t\twidth = this.dom.$canvas.width(),\r\n\t\t\theight = this.dom.$canvas.height()\r\n\t\t;\r\n\t\tvar x, y;\r\n\t\tif (e.touches && e.touches.length == 1) {\r\n\t\t\tx = e.touches[0].pageX;\r\n\t\t\ty = e.touches[0].pageY;\r\n\t\t} else {\r\n\t\t\tx = e.pageX;\r\n\t\t\ty = e.pageY;\r\n\t\t}\r\n\t\tx = x - this.dom.$canvas.offset().left;\r\n\t\ty = y - this.dom.$canvas.offset().top;\r\n\t\tx *= (width / rect.width);\r\n\t\ty *= (height / rect.height);\r\n\t\treturn {\r\n\t\t\tx: x,\r\n\t\t\ty: y\r\n\t\t};\r\n\t},\r\n\r\n\t_getMidInputCoords: function(coords) {\r\n\t\treturn {\r\n\t\t\tx: this.coords.old.x + coords.x>>1,\r\n\t\t\ty: this.coords.old.y + coords.y>>1\r\n\t\t};\r\n\t}\r\n};\r\nmodule.exports = DrawingBoard;\r\n}, '');\n__applicationContext.define('core.utils.drawingboard.microevent', function (exports,module,require,$) {\r\n'use strict';\r\n/**\r\n * https://github.com/jeromeetienne/microevent.js\r\n * MicroEvent - to make any js object an event emitter (server or browser)\r\n *\r\n * - pure javascript - server compatible, browser compatible\r\n * - dont rely on the browser doms\r\n * - super simple - you get it immediatly, no mistery, no magic involved\r\n *\r\n * - create a MicroEventDebug with goodies to debug\r\n *   - make it safer to use\r\n*/\r\n\r\nvar MicroEvent = function () { };\r\n\r\nMicroEvent.prototype = {\r\n    bind: function (event, fct) {\r\n        this._events = this._events || {};\r\n        this._events[event] = this._events[event] || [];\r\n        this._events[event].push(fct);\r\n    },\r\n    unbind: function (event, fct) {\r\n        this._events = this._events || {};\r\n        if (event in this._events === false) return;\r\n        this._events[event].splice(this._events[event].indexOf(fct), 1);\r\n    },\r\n    trigger: function (event /* , args... */) {\r\n        this._events = this._events || {};\r\n        if (event in this._events === false) return;\r\n        for (var i = 0; i < this._events[event].length; i++) {\r\n            this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1));\r\n        }\r\n    }\r\n};\r\n//module.type = 'class';\r\nmodule.exports = MicroEvent;\r\n}, '');\n__applicationContext.define('core.utils.drawingboard.utils', function (exports,module,require,$) {\r\n\"use strict\";\r\n\r\n(function () {\r\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n    }\r\n}());\r\nfunction _boxBorderSize($el, withPadding, withMargin, direction) {\r\n    if ($el.length <= 0) return 0;\r\n    withPadding = !!withPadding || true;\r\n    withMargin = !!withMargin || false;\r\n    var width = 0,\r\n        props;\r\n    if (direction == \"width\") {\r\n        props = ['border-left-width', 'border-right-width'];\r\n        if (withPadding) props.push('padding-left', 'padding-right');\r\n        if (withMargin) props.push('margin-left', 'margin-right');\r\n    } else {\r\n        props = ['border-top-width', 'border-bottom-width'];\r\n        if (withPadding) props.push('padding-top', 'padding-bottom');\r\n        if (withMargin) props.push('margin-top', 'margin-bottom');\r\n    }\r\n    for (var i = props.length - 1; i >= 0; i--)\r\n        width += parseInt($el.css(props[i]).replace('px', ''), 10);\r\n    return width;\r\n}\r\nmodule.exports = {\r\n    /**\r\n    * Tim (lite)\r\n    *   github.com/premasagar/tim\r\n    *//*\r\n\tA tiny, secure JavaScript micro-templating script.\r\n   */\r\n    tpl : (function(){\r\n        var start   = \"{{\",\r\n            end     = \"}}\",\r\n            path    = \"[a-z0-9_][\\\\.a-z0-9_]*\", // e.g. config.person.name\r\n            pattern = new RegExp(start + \"\\\\s*(\"+ path +\")\\\\s*\" + end, \"gi\"),\r\n            undef;\r\n\r\n        return function(template, data){\r\n            // Merge data into the template string\r\n            return template.replace(pattern, function(tag, token){\r\n                var path = token.split(\".\"),\r\n                    len = path.length,\r\n                    lookup = data,\r\n                    i = 0;\r\n\r\n                for (; i < len; i++){\r\n                    lookup = lookup[path[i]];\r\n\r\n                    // Property not found\r\n                    if (lookup === undef){\r\n                        throw \"tim: '\" + path[i] + \"' not found in \" + tag;\r\n                    }\r\n\r\n                    // Return the required value\r\n                    if (i === len - 1){\r\n                        return lookup;\r\n                    }\r\n                }\r\n            });\r\n        };\r\n    }()),\r\n    \r\n    boxBorderWidth : function($el, withPadding, withMargin) {\r\n        return _boxBorderSize($el, withPadding, withMargin, 'width');\r\n    },\r\n    boxBorderHeight : function($el, withPadding, withMargin) {\r\n        return _boxBorderSize($el, withPadding, withMargin, 'height');\r\n    },\r\n    isColor : function(string) {\r\n        if (!string || !string.length) return false;\r\n        return (/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i).test(string) || $.inArray(string.substring(0, 3), ['rgb', 'hsl']) !== -1;\r\n    },RGBToInt : function(r, g, b) {\r\n        var c = 0;\r\n        c |= (r & 255) << 16;\r\n        c |= (g & 255) << 8;\r\n        c |= (b & 255);\r\n        return c;\r\n    },pixelAt: function(image, x, y) {\r\n        var i = (y * image.width + x) * 4;\r\n        var c = this.RGBToInt(\r\n            image.data[i],\r\n            image.data[i + 1],\r\n            image.data[i + 2]\r\n        );\r\n\r\n        return [\r\n            i, // INDEX\r\n            x, // X\r\n            y, // Y\r\n            c  // COLOR\r\n        ];\r\n    },compareColors: function(a, b, tolerance) {\r\n        if (tolerance === 0) {\r\n            return (a === b);\r\n        }\r\n\r\n        var ra = (a >> 16) & 255, rb = (b >> 16) & 255,\r\n            ga = (a >> 8) & 255, gb = (b >> 8) & 255,\r\n            ba = a & 255, bb = b & 255;\r\n\r\n        return (Math.abs(ra - rb) <= tolerance)&& (Math.abs(ga - gb) <= tolerance)&& (Math.abs(ba - bb) <= tolerance);\r\n    }\r\n};\r\n\r\n\r\n}, '');\n(function(window,$,require){ 'use strict';\r\n//定义全局icCreatePlayer,兼容之前gwt的版本\r\nvar request = require('core.utils.request');\r\nvar Player = require('core.player.Player');\r\nvar detector = require('core.utils.detector');\r\nvar sync = require('core.plugin.sync');\r\nvar EventBus = require('core.eventbus.eventbus');\r\nvar defaultPlayerConfig = {\r\n  'refPath': {\r\n    'ref-path': request('ref-path'),\r\n    'ref-path-addon': request('ref-path-addon'),\r\n    'ref-path-online': request('ref-path-online'),\r\n    'ref-path-tool': request('ref-path-tool') || '../tools/'\r\n  },\r\n  'url': request('main') || request('main-url'),\r\n  'pageUrl': request('page-url'),\r\n  'playerCode': request('player-code'),\r\n  'hidePage': request('hidePage'),\r\n  'stateToken': request('ls_token'),\r\n  'location': {\r\n    'current': request('_lang_'),\r\n    'default_lang': 'zh'\r\n  },\r\n  'startPageIndex': request(\r\n    'startPageIndex'),\r\n  'startPageId': request('startPageId'),\r\n  'startPageName': request('startPageName'),\r\n  'toolClose': function () { }\r\n};\r\n//将默认配置应用到config上,方便独立页面发布,player自动获取url上的参数,以页面配置为主,为空时才自动获取\r\nvar applyConfig = function (config, defaultConfig) {\r\n  var defaultValue, value;\r\n  for (var key in defaultConfig) {\r\n    defaultValue = defaultConfig[key];\r\n    value = config[key];\r\n    if ($.isPlainObject(value)) {\r\n      //深度遍历\r\n      applyConfig(value, defaultValue);\r\n    } else if (!(key in config)) {\r\n      //index上没有配置再套用默认配置\r\n      config[key] = defaultConfig[key];\r\n    }\r\n  }\r\n};\r\n\r\n//计算fontSize\r\nvar getFontSize = function () {\r\n  var winWidth = 0;\r\n  var winHeight = 0;\r\n  if (document.documentElement && document.documentElement.clientHeight && document.documentElement.clientWidth) {\r\n    winWidth = document.documentElement.clientWidth;\r\n    winHeight = document.documentElement.clientHeight;\r\n  }\r\n  var winSizeValue = {\r\n    'width': winWidth,\r\n    'height': winHeight\r\n  };\r\n  var defaultWidth = 1920;\r\n  var defaultHeight = 1080;\r\n  var defaultFontSize = 24;\r\n\r\n  if (winSizeValue.width === 0 && winSizeValue.height === 0) {\r\n    winSizeValue.width = icCreatePlayer.request('docWidth')\r\n    winSizeValue.height = icCreatePlayer.request('docHeight')\r\n  }\r\n\r\n  var fontSize = 0;\r\n  if (winSizeValue.width / winSizeValue.height <= defaultWidth / defaultHeight) {\r\n    fontSize = winSizeValue.width / defaultWidth * defaultFontSize;\r\n  } else {\r\n    fontSize = winSizeValue.height / defaultHeight * defaultFontSize;\r\n  }\r\n  return fontSize;\r\n};\r\n\r\nvar getOS = function () {\r\n  if (window.navigator && window.navigator.userAgent) {\r\n    var ua = window.navigator.userAgent.toLowerCase();\r\n    var re = /windows nt \\d+\\.+\\d+/;\r\n    var result = ua.match(re);\r\n    if (result && result[0]) {\r\n      switch (result[0]) {\r\n        case \"windows nt 5.1\": {\r\n          return \"xp\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return \"UnKnown\"\r\n};\r\n\r\nwindow.icCreatePlayer = {\r\n  'create': function (config) {\r\n    config = config || {};\r\n    applyConfig(config, defaultPlayerConfig);\r\n    var player = new Player(config);\r\n    return player;\r\n  },\r\n  'request': request,\r\n  'detector': detector,\r\n  'coursePlayer': require('core.bridge.courseplayer'),\r\n  'utils': {\r\n    throttle: require('core.utils.throttle'),\r\n    raf: require('core.utils.raf'),\r\n    EventBus: EventBus,\r\n    getFontSize: getFontSize,\r\n    getOS: getOS\r\n  },\r\n  'RUNTIME': require('core.common.runtime').RUNTIME,\r\n  'setDefaultPlayerConfig': function (_default) {\r\n    applyConfig(_default, defaultPlayerConfig);\r\n    defaultPlayerConfig = _default;\r\n  },\r\n  /**\r\n   * 页类型\r\n   */\r\n  'PAGETYPE': {\r\n    'PAGE': 0,\r\n    'EXTEND_PAGE': 1\r\n  },\r\n  fontSize: '',\r\n  sync: sync,\r\n  plugin: Object.create(null),\r\n  version: '11.7.3'\r\n};\r\n\r\n__applicationContext.initialize(); })(window,jQuery,__applicationContext.require); })(window,jQuery)"]}