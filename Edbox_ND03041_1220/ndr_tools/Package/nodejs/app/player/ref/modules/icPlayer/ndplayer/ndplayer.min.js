!function(e,t){var o={exports:{}};!function(o){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var o,n;if(null===this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(o=t),n=0;n<i;){var s;n in r&&(s=r[n],e.call(o,s,n,r)),n++}}),Array.prototype.each||(Array.prototype.each=function(e,t){var o,n;if(null===this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(o=t),n=0;n<i;){var s;n in r&&(s=r[n],e.call(o,s,n,r)),n++}}),Array.prototype.filter||(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),o=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],r=arguments.length>=2?arguments[1]:void 0,i=0;i<o;i++)if(i in t){var s=t[i];e.call(r,s,i,t)&&n.push(s)}return n});var n={},r={},i=[],s=function(e,t){var o=l("core.utils.class");return o.create(e,t)},a=function(o){var i=n[o];if(i){delete n[o];var a={exports:{}};i.call(e,a.exports,a,l,t);var c="class"===a.type?s(a.exports,o):a.exports;return r[o]=c,c}console.debug("no definition:"+o)},l=function(e){if(e){e=e.toLowerCase();var t=r[e];return t?t:a(e)}};o.exports={define:function(e,t,o){if(e in n)throw new Error("player 11.7.3: duplicate definition:"+e);n[e]=t,"automatic"===o&&i.push(e)},require:l,initialize:function(){i.forEach(function(e){l(e).run()})}}}(o),o=o.exports,o.define("core.bridge.courseplayer",function(e,t,o,n){var r={PLAYERERROR:{eventName:"",msg:"There isn't a method named invokeMthod inside pptShell"}};t.exports={invokeMethod:function(e,t){return"undefined"!=typeof CoursePlayer&&CoursePlayer.invokeMethodPPT?CoursePlayer.invokeMethodPPT(e,t):(r.PLAYERERROR.eventName=e,r)},drawMethod:function(e,t){return"undefined"!=typeof CoursePlayer&&CoursePlayer.drawMethod?result=JSON.parse(CoursePlayer.drawMethod(e,t)):(r.PLAYERERROR.eventName=e,r)},close:function(){"undefined"!=typeof CoursePlayer&&CoursePlayer.close&&CoursePlayer.close()}}},""),o.define("core.bridge.pptshell",function(e,t,o,n){"use strict";var r=o("core.bridge.courseplayer"),i=function(e){var t="#000000",o=1;if("function"==typeof e){var n=e();t=n.color||t,o=n.width||o}return{color:t,width:o}};t.exports={paint:{getPaintSetting:function(){var e={};e.request_query="draw_setting";var t={},o=r.drawMethod("drawsetting",JSON.stringify({}));return t.color=o.color||"#ff0000",t.width=o.width||2,t},drawLine:function(e,t,o,n){var s=i(),a=e||{x:0,y:0},l=t||{x:0,y:0},c={};c.request_shape="line",c.shape={color:o||s.color,width:n||s.width,start:a,end:l},r.drawMethod("drawLine",JSON.stringify(c))},drawCircle:function(e,t,o,n,s,a,l,c){var u,d,p,f,h=i();u={x:e.x-t,y:e.y-t},d={x:e.x+t,y:e.y+t},p=o,f=s?-n:n;var g={};g.request_shape="arc",g.shape={color:a||h.color,width:l||h.width,start:u,end:d,isFill:c,start_angle:p,sweep_angle:f},r.drawMethod("drawCircle",JSON.stringify(g))}},tool:{close:function(){r.close()}}}},""),o.define("core.common.createmodel",function(e,t,o,n){"use strict";var r=o("core.utils.url"),i=o("core.model.modelCreator"),s=o("core.model.parser.simpleJsonParser"),a={file:"url",ppt:"url",courseware:"url",coursewareobject:"url",question:"url",flash:"url",audio:"url",image:"url",video:"url",jsonfile:"load",json:"json",html:"html","ref-module":"default",string:"default",list:"list","boolean":"boolean"},l={url:function(e,t,o){return r.resolve(t,e.value)},load:function(e,t,o){if(e.value){var n=l.url(e,t,o);return i.create({url:n,parser:s,textParsers:o,isCache:!1})}},json:function(e,t,o){return n.isPlainObject(e.value)?e.value:s.parse(e.text)},html:function(e,t,o){return e.text||e.value},"boolean":function(e,t,o){return"true"===e.value.toLowerCase()},list:function(e,t,o){var n=[];return e.value.forEach(function(e){var r={};e.forEach(function(e){var n=c(e,t,o);r[n.name]=n.value}),n.push(r)}),n},"default":function(e,t,o){return e.value}},c=function(e,t,o){var r=a[n.trim(e.type).toLowerCase()]||"default",i=l[r](e,t,o)||"";return i="boolean"===r?""!=i:i,n.isFunction(i.promise)?i.then(function(t){return{name:e.name,value:t.model}}):{name:e.name,value:i}};t.exports=function(e,t,o){var r=[],i={};return e.forEach(function(e){r.push(c(e,t,o))}),n.when.apply(n,r).then(function(){for(var e=0,t=arguments.length;e<t;e++){var o=arguments[e];i[o.name]=o.value}return i})}},""),o.define("core.common.defaultwaitdialog",function(e,t,o,n){"use strict";var r={show:function(){},hide:function(){}};t.exports=r},""),o.define("core.common.i18nloader",function(e,t,o,n){"use strict";var r,i,s=o("core.model.modelCreator"),a=o("core.utils.string"),l=o("core.model.parser.simpleJsonParser"),c=o("core.utils.log"),u="${base}resources/locations/${location}/lang.json",d={},p=function(e,t,o){s.create({url:a.applyTemplate(u,{base:e,location:t}),parser:l}).done(function(e){o(e.model)}).fail(function(){t!==r?p(e,d[t],o):(o({}),c.log("load '"+t+"' error"))})},f=function(e){s.create({url:icCreatePlayer.ref_path_tool+"/tool.json",parser:l}).done(function(t){e(t.model)}).fail(function(){e({}),c.log("load '"+icCreatePlayer.ref_path_tool+"/tool.json' error")})};t.exports={load:function(e){var t=n.Deferred();return p(e,i,function(e){t.resolve(e)}),t.promise()},loadPlayer:function(){var e=n.Deferred();return f(function(t){e.resolve(t)}),e.promise()},setLocation:function(e){e=e||{},r=e.default_lang,i=e.current||r;var t=i&&i.split("_")[0]||r;d[i]=t,d[t]=r}}},""),o.define("core.common.ispointinpath",function(e,t,o,n){"use strict";var r=o("core.utils.transform"),i="isPointInPath",s=function(e,t){var o=n.event.fix(t),i=e.element.width(),s=e.element.height(),a=void 0===o.pageX?o.originalEvent.touches[0].pageX:o.pageX,l=void 0===o.pageY?o.originalEvent.touches[0].pageY:o.pageY,c=r.getRotateDeg(e.element[0]),u=r.getRotateXY(a,l,c,e.element[0]),d=u.x,p=u.y;return d>=0&&d<=i&&p>=0&&p<=s},a=function(e,t){return!(!e.mainModule.getPresenter().__interface||"function"!=typeof e.mainModule.getPresenter().__interface.isPointInPath)&&e.mainModule.runInterface(i,[t])};t.exports={resolve:function(e,t){if(null===e)return e;e.toolConfig;return e.mainModule.getPresenter().__interface&&"function"==typeof e.mainModule.getPresenter().__interface.isPointInPath?a(e,t):s(e,t)},swapItems:function(e,t,o){var n=[];return n[0]=e[t],e.splice(t,1),n="first"===o?n.concat(e):e.concat(n)},swapTool:function(e,t,o){for(var n=0;n<e.list[t].length;n++)e.list[t][n].unqiueId===o.unqiueId&&(e.list[t]=this.swapItems(e.list[t],n,"last"));return e},adjust:function(e,t,o,n){if(e){var r=this,i=e,s=!0,a={top:e.list.top,bottom:e.list.bottom};for(var l in a){for(var c=0;c<a[l].length;c++){var u;if(("none"!==a[l][c].getElement(!0).css("display")||"FIRETOOL"===n)&&(u="undefined"!=typeof o?a[l][c].unqiueId===o.unqiueId:r.resolve(a[l][c],t))){s=!1,i.list[l]=this.swapItems(a[l],c,"first"),i.active=l;break}}if(!s)break}return{allFlase:s,toolList:i}}}}},""),o.define("core.common.paint",function(e,t,o,n){"use strict";var r=o("core.utils.drawingboard.board");t.type="class",t.exports={constructor:function(e,t){var o={control:!1,fillTolerance:500,webStorage:"false",droppable:!0,hideBoard:!0},o=n.extend({},o,t);this.board=new r(e,o),this.canvasEl=this.board.canvas,this.boardEL=this.board.dom.$canvasWrapper,this.boardEL.css("pointer-events","none"),o.hideBoard&&this.hide()},draw:function(e){"function"==typeof e&&(e(this.canvasEl),this.board.saveHistory(),this.show())},drawLine:function(e,t,o,r){var i=n(this.canvasEl).offset();if(this.canvasEl.getContext){var s=this.canvasEl.getContext("2d");s.save(),r&&(s.lineWidth=r),o&&(s.strokeStyle=o),s.beginPath(),s.moveTo(e.x-i.left,e.y-i.top),s.lineTo(t.x-i.left,t.y-i.top),s.closePath(),s.stroke(),this.board.saveHistory(),this.show()}},drawCircle:function(e,t,o,n,r,i,s,a){if(this.canvasEl.getContext){var l=this.canvasEl.getContext("2d");l.save(),s&&(l.lineWidth=s),i&&(l.strokeStyle=i),l.beginPath(),l.arc(e.x,e.y,t,o,n,!1),i&&(l.fillStyle=i),a?l.fill():l.stroke(),l.closePath(),this.board.saveHistory(),this.show()}},redo:function(){this.board.goForthInHistory()},undo:function(){this.board.goBackInHistory()},reset:function(){this.board.reset({background:!0})},getPaintSetting:function(){return{width:this.board.ctx.lineWidth||1,color:this.board.color||"#000000"}},setColor:function(e){this.board.setColor(e),this.board.ev.trigger("color:changed",e)},setMode:function(e){this.board.setMode(e),this.board.ev.trigger("mode:changed",e)},setSize:function(e){this.board.ctx.lineWidth=e,this.board.ev.trigger("size:changed",e)},show:function(){this.boardEL.css("visibility","")},hide:function(){this.boardEL.css("visibility","hidden")}}},"class"),o.define("core.common.playerconfig",function(e,t,o,n){"use strict";var r=o("core.model.modelCreator"),i=o("core.model.parser.simpleJsonParser"),s=o("core.loader.jsLibLoaderCreator").create(),a=o("core.utils.dom"),l=function(e,t){var o=[];return e.script=(e.script||[]).filter(function(e){return"undefined"==typeof e.autoLoad&&(e.autoLoad=!0),"false"===e.autoLoad.toString().toLowerCase()?e:void o.push(e)}),s.load(t,o)},c=function(e,t){var o=n.Deferred(),a=n.Deferred(),l=e.mScript;return icCreatePlayer.jsLibConfig={},n.isEmptyObject(l.autoload)?o.reject():r.create({url:l.autoload.href,textParsers:t,parser:i}).then(function(e){icCreatePlayer.jsLibConfig.auto=e,o.resolve()}).fail(function(){o.reject()}),n.isEmptyObject(l.notautoload)?a.reject():r.create({url:l.notautoload.href,textParsers:t,parser:i}).then(function(e){icCreatePlayer.jsLibConfig.notauto=e,a.resolve()}).fail(function(){a.reject()}),n.when.apply(n,[o.promise(),a.promise()]).then(function(){var e=[];return icCreatePlayer.jsLibConfig.allLib=n.extend(!0,{},icCreatePlayer.jsLibConfig.auto,icCreatePlayer.jsLibConfig.notauto),n.each(icCreatePlayer.jsLibConfig.auto.model,function(t,o){e.push(o)}),s.load(t,e)}).fail(function(){return n.Deferred().reject(new Error("player 11.7.3: get auto and notauto package fail"))})},u={presenters:{},commons:{},script:[],css:""};t.exports={create:function(e,t){return e?r.create({url:e.replace(/\/*$/,"/config.json"),ignoreError:!0,textParsers:t,parser:i}).then(function(e){return u=e.model,u.cssText&&a.addStyleContent(u.cssText),u.mScript?c(u,t):l(u,t)}):n.Deferred().resolve(u).promise()},loadCss:function(e){var t=u.css||e;delete u.css,a.addStyle(t)},getCommons:function(e,t){for(var o in u.commons){var n=u.commons[o];n.id=n.id||"common_"+o,n.moduleGroupType="common",e.addItem(o,t(n))}return e},getScripts:function(e){return u.mScript?n.each(icCreatePlayer.jsLibConfig.allLib,function(t,o){e.name==o.name&&(e.version=o.version,e.href=o.href)}):u.script.forEach(function(t){e.name==t.name&&(e.version=t.version,e.href=t.href)}),e},getPresenter:function(e){return u.presenters[e]}}},""),o.define("core.common.playerflow",function(e,t,o,n){"use strict";var r=o("core.utils.function"),i=function(e,t){var o=this.name,n=this.sourcePresenterUnqiueId,r=this[e]||e.replace(/^\w/,function(e){return o+e.toUpperCase()}),i=[];return n?this.player.eachPresenter(function(e){if(e.presenter.__model&&n===e.presenter.__model.$.unqiueId){var o=e.runInterface(r,t);o&&i.push(o)}},this.scope):this.player.eachPresenter(function(e){var o=e.runInterface(r,t);o&&i.push(o)},this.scope),i};t.type="class",t.exports={constructor:function(e,t,o){n.extend(this,e),this.name=t,this.player=o},start:function(e,t,o,s){t&&(this.scope=t);var a=this,l=!0;e=e||{},this.sourcePresenterUnqiueId=e.sourcePresenterUnqiueId,r.runSequence([{fn:a.initData,args:[e],scope:a},{fn:function(t){e=t||e;var o=i.call(this,"dataParse",e);return n.when.apply(this,o).then(function(){return e})},scope:a},{fn:function(){var t=a.validate(e);return t?t:(l=!1,i.call(a,"fail",Array.prototype.slice.call(arguments,0)),s&&s(),void 0)},scope:a},{fn:function(e){l&&this.done(e,function(){i.call(a,"success",Array.prototype.slice.call(arguments,0)),o&&o()},function(){i.call(a,"fail",Array.prototype.slice.call(arguments,0)),s&&s()})},scope:a}],"playerFlowStart")}}},"class"),o.define("core.common.pptshellpaint",function(e,t,o,n){"use strict";var r=o("core.bridge.pptshell");t.type="class",t.exports={constructor:function(){},draw:function(){},redo:function(){},undo:function(){},reset:function(){},getPaintSetting:function(){return r.paint.getPaintSetting()},drawLine:function(e,t,o,n){r.paint.drawLine(e,t,o,n)},drawCircle:function(e,t,o,n,i,s,a,l){r.paint.drawCircle(e,t,o,n,i,s,a,l)},setColor:function(e){this.color=e},setMode:function(e){this.mode=e},setSize:function(e){this.size=e}}},"class"),o.define("core.common.printscreen",function(t,o,n,r){"use strict";var i=!1,s=null,a=15e3,l=function(){i||(i=!0,"undefined"!=typeof CoursePlayer&&CoursePlayer.thumbnailSave&&CoursePlayer.thumbnailSave())};o.exports={printScreen:function(t){t.addEventListener("PLAYER.PRINTSCREEN",function(){s=e.setTimeout(function(){l(),e.clearTimeout(s)},500)}),s=e.setTimeout(function(){l(),e.clearTimeout(s)},a)}}},""),o.define("core.common.refpathbuilder",function(e,t,o,n){"use strict";var r=o("core.utils.url"),i=o("core.utils.string"),s=function(e,t){var o={};for(var n in e)o[n]=r.resolve(t,e[n]);return o},a=function(e,t){return e=s(e,t),{parse:function(t){return i.applyTemplate(t,e)},getRefPath:function(){return e}}};t.exports={build:function(e,t){e["ref-path-addon"]=e["ref-path-addon"]||e["ref-path"];var o=e;return!t&&e["ref-path-online"]&&(o={"ref-path":e["ref-path-online"],"ref-path-addon":e["ref-path-addon"]}),{courseware:a(o,r.getBase(t)),playerConfig:a(e,r.getBaseLocationUrl())}},set:function(e,t,o){e.refPathParser[t]=a(e.refPath,r.getBase(o))}}},""),o.define("core.common.runtime",function(t,o,n,r){"use strict";var i=n("core.utils.request"),s={TEACHER_MOBILE:"TeacherMobile",STUDENT_MOBILE:"StudentMobile",PROJECTION_MOBILE:"ProjectionMobile",WEB:"Web",TEACHER_PC:"TeacherPc",STUDENT_PC:"StudentPc"},a={mobile:{teacher:s.TEACHER_MOBILE,student:s.STUDENT_MOBILE,projection:s.PROJECTION_MOBILE,__default__:s.TEACHER_MOBILE},pc:{teacher:s.TEACHER_PC,student:s.STUDENT_PC,__default__:s.TEACHER_PC}};o.exports={RUNTIME:s,getRuntime:function(){var t,o=e.Bridge,n=i("terminal");return o&&r.isFunction(o.getRuntime)&&(t=a[o.getRuntime().toLowerCase()],"object"==typeof t&&(t=t[n.toLowerCase()]||t.__default__)),t||s.WEB}}},""),o.define("core.common.timer",function(t,o,n,r){"use strict";function i(e){return(e+"").length<2?"0"+e:e}var s,a=".tooldialog_com_header_time",l=".tooldialog_com_header_time .tooldialog_time_m em",c=".tooldialog_com_header_time .tooldialog_time_s em",u=0,d=0;o.exports={start:function(e){clearInterval(s),e.element.find(a).show(),e.element.find(l).html(i(u)),e.element.find(c).html(i(d)),s=setInterval(function(){59===d?(u++,d=0):d++,e.element.find(l).html(i(u)),e.element.find(c).html(i(d))},1e3)},stop:function(){e.clearInterval(s)},reset:function(t){u=d=0,e.clearInterval(s),t.element.find(a).hide(),t.element.find(l).html(i(u)),t.element.find(c).html(i(d))}}},""),o.define("core.exception.playerexception",function(e,t,o,n){"use strict";var r=o("core.utils.log"),i=o("core.utils.string"),s="${id}@${className} error:";t.exports={create:function(e,t,o){var n=new Error("player 11.7.3: "+e);return n.cause=t,n.errorType=o||"playerException",n},execute:function(e,t){r.error(i.applyTemplate(s,t),e),t.fireEvent("error",e)}}},""),o.define("core.eventbus.eventbus",function(t,o,n,r){"use strict";o.type="class";var i=function(t,o){t.callback.apply(t.scope||e,o.concat(t.args))};o.exports={constructor:function(){this.listeners={}},addEventListener:function(e,t,o){if(t){var n,i;if(r.isFunction(t)?i=3:t&&(i=2,o=t.scope,t.selector&&(n=r.isArray(t.selector)?t.selector:[t.selector]),t=t.fn),r.isFunction(t)){var s=arguments.length>i?Array.prototype.slice.call(arguments,i):[],a=this.listeners[e]||(this.listeners[e]=[]);a.push({scope:o,callback:t,selector:n,args:s})}}},removeEventListener:function(e,t,o){if("undefined"!=typeof this.listeners[e]){for(var n=this.listeners[e].length,r=[],i=0;i<n;i++){var s=this.listeners[e][i];s.scope==o&&s.callback==t||r.push(s)}this.listeners[e]=r}},hasEventListener:function(e,t,o){if("undefined"!=typeof this.listeners[e]){var n=this.listeners[e].length;if(void 0===t&&void 0===o)return n>0;for(var r=0;r<n;r++){var i=this.listeners[e][r];if((!o||i.scope==o)&&i.callback==t)return!0}}return!1},dispatch:function(t){var o=arguments.length>1?Array.prototype.slice.call(arguments,1):[];o=[t].concat(o);var n,s=navigator.userAgent.indexOf("Firefox")>0;s&&(e.event=arguments[1]||null),e.event&&(n=event.srcElement||event.target),this.listeners&&this.listeners[t]&&this.listeners[t].forEach(function(e){e.selector&&n?(n=r(n),e.selector.forEach(function(t){n.closest(t).length&&i(e,o.concat([t,n]))})):i(e,o)})},getEvents:function(){var e="";for(var t in this.listeners)for(var o=this.listeners[t].length,n=0;n<o;n++){var r=this.listeners[t][n];e+=r.scope&&r.scope.className?r.scope.className:"anonymous",e+=" listen for '"+t+"'\n"}return e}}},"class"),o.define("core.eventbus.eventname",function(e,t,o,n){"use strict";var r={tool:{maximize:"PLAYER.TOOL.MAXIMIZE",minimize:"PLAYER.TOOL.MINIMIZE",finish:"PLAYER.TOOL.FINISH",close:"PLAYER.TOOL.CLOSE",push_action:"PLAYER.TOOL.PUSH_ACTION",push_data:"PLAYER.TOOL.PUSH_DATA",adjust_layout:"PLAYER.TOOL.ADJUST_LAYOUT",layout_resize:"PLAYER.TOOL.LAYOUT_RESIZE",forbide_full:"PLAYER.TOOL.FORBIDE_FULL"},play:{push_status:"PLAYER.GLOBAL.PUSH_STATUS"}};t.exports=r},""),o.define("core.layout.layout",function(e,t,o,n){"use strict";var r=["width","height","top","right","bottom","left"];t.type="class",t.exports={"static":{attrName:r,createLayoutConfig:function(e,t){var o,i={};return t&&t.forEach(function(e){n.inArray(e,r)<0&&r.push(e)}),r.forEach(function(t){o=e[t],o&&(i[t]=n.isNumeric(o)?parseInt(o,10):o)}),i}},constructor:function(e){this.component=e},zIndex:300,getZIndex:function(){return this.zIndex++}}},"class"),o.define("core.layout.pageabsolutelayout",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.layout.Layout",render:function(e){var t=this;this.$layoutTarget=e,"static"===t.$layoutTarget.css("position")&&n(t.$layoutTarget).css("position","relative");var o=[];return t.component.items.forEach(function(e){o.push(t.addModule(e))}),n.when.apply(n,o)},addModule:function(e){var t=e.getZIndex()||this.getZIndex();return e.render(this.$layoutTarget).then(function(e){e.getElement(!0).css({position:"absolute","z-index":t})},function(){return n.Deferred().resolve()})}}},"class"),o.define("core.layout.playerdivlayout",function(e,t,o,n){"use strict";var r=o("core.utils.string"),i=o("core.layout.Layout"),s=o("core.utils.when"),a=o("core.utils.log"),r=o("core.utils.string"),l=o("core.common.layout.tool"),c=o("core.utils.url"),u='<div class="ic_${name}_panel ic_common_panel" style="z-index: ${zIndex}"></div>',d='<div class="ic_page_panel" style="z-index: ${zIndex}"></div>',p={horizontal:{sizeName:"height",group:[{name:["header","toolbar"],layout:"top"},{name:["footer"],layout:"bottom"}]},vertical:{sizeName:"width",group:[{name:["left"],layout:"left"},{name:["right"],layout:"right"}]}},f=function(e){var t=this,o=t.component.commonPages,a=p[e],l=a.$target,c=[];return a.group.forEach(function(e){var d=[],p=o.getItems(e.name);if(p&&p.length){var f=n(r.applyTemplate(u,{name:e.layout,zIndex:t.getZIndex()})),h=new s(p.length,function(t){var o=0;t.forEach(function(e){o+=e}),l.css("padding-"+e.layout,o),f.css(a.sizeName,o)});p.forEach(function(e){e.addEventListener("renderModel",function(t,o){var r=i.createLayoutConfig(o.getAttribute("layout")),s=r[a.sizeName];n(e.getElement()).css(a.sizeName,s),h.each(s)}),d.push(e.render(f))}),c.push(n.when.apply(n,d).done(function(){l.append(f)}))}}),c},h=function(e,t){var o=this,i=o.component.commonPages,s=p[e],a=".ic_common_panel.ic_${name}_panel";s.group.forEach(function(e){var o=i.getItems(e.name);if(o&&o.length){var s=n(r.applyTemplate(a,{name:e.layout}));t?s.show():s.hide()}})},g=function(e){var t=this,o=n(r.applyTemplate(d,{zIndex:t.getZIndex()}));return e.append(o),o},m=o("core.common.layout.events"),v=m.downEvents,y=m.moveEvents,_=m.upEvents,P=(m.clickEvents,m.pageLeaveEvents),T=function(){var e,t,o,r=!1;return function(){var i=this;v.forEach(function(s){var a=function(s){var a=n.event.fix(s);r=!0,e=new Date,t=a.type.indexOf("touch")<0?a.pageX:a.originalEvent.touches[0].pageX,o=a.type.indexOf("touch")<0?a.pageY:a.originalEvent.touches[0].pageY,i.component.activePage.fireEvent("mousedown",a)};i.pageTarget[0].addEventListener?i.pageTarget[0].addEventListener(s,a):i.pageTarget[0].attachEvent(s,a)}),y.forEach(function(e){var t=function(){r&&i.component.activePage.fireEvent("mousemove",event)};i.pageTarget[0].addEventListener?i.pageTarget[0].addEventListener(e,t):i.pageTarget[0].attachEvent(e,t)}),_.forEach(function(s){var a=function(s){var a=n.event.fix(s);r=!1,i.component.activePage.fireEvent("mouseup",a);var l=new Date-e,c=Math.abs((void 0===a.pageX?a.originalEvent.changedTouches[0].pageX:a.pageX)-t),u=Math.abs((void 0===a.pageY?a.originalEvent.changedTouches[0].pageY:a.pageY)-o);l<180&&c<3&&u<3&&i.component.activePage.fireEvent("click",a)};i.pageTarget[0].addEventListener?i.pageTarget[0].addEventListener(s,a):i.pageTarget[0].attachEvent(s,a)}),P.forEach(function(e){var t=function(){i.component.activePage.fireEvent("pageLeave",event)};i.pageTarget[0].addEventListener?i.pageTarget[0].addEventListener(e,t):i.pageTarget[0].attachEvent(e,t)})}}(),b=function(){(this.component.adaptFlag||void 0==this.component.adaptFlag)&&(icCreatePlayer.fontSize=icCreatePlayer.utils.getFontSize(),icCreatePlayer.fontSize>0&&this.component.container.css("font-size",icCreatePlayer.fontSize+"px")),0!=icCreatePlayer.fontSize&&(b=function(){})};t.type="class",t.exports={extend:"core.layout.Layout",constructor:function(e){o("core.layout.playerDivLayout").prototype.superClass.constructor.call(this,e),this.renderAllCommonPage=function(){var e=this,t=[];for(var o in p)t=t.concat(f.call(e,o));return this.renderAllCommonPage=function(){e.component.commonPages.forEach(function(e){a.log("page.pageChange"),e.pageChange()})},n.when.apply(n,t)}},render:function(e){return p.horizontal.$target=e,p.vertical.$target=g.call(this,e),this.pageTarget=g.call(this,p.vertical.$target),T.call(this),this.pageTarget.addClass("ic_main_page_panel"),this.renderPage()},renderPage:function(){var e=this;b.call(e),this.component.waitDialog.show(),this.component.activePage.addEventListener("afterLayout",function(){e.component.waitDialog.hide()});var t=c.getBase(this.component.activePage.url);return icCreatePlayer.ref_base=t.replace(/\/$/,""),this.component.activePage.render(this.pageTarget).then(function(){return console.log("activePage render finished"),e.renderAllCommonPage()}).done(function(){console.log("activePage PageLoaded"),e.component.fireEvent("PageLoaded")})},activePage:function(){this.$toolTarget&&(this.$toolTarget.removeClass("ic_paint_active"),this.$toolTarget.css("display","none"))},renderTool:function(){return l.renderTool.apply(this)},activeTool:function(e){l.activeTool.apply(this,[e])},addTool:function(e){return l.addTool.apply(this,[e])},setToolZIndex:function(e){l.setToolZIndex.apply(this,[e])},isLargeZIndex:function(e){return l.isLargeZIndex.apply(this,[e])},fireTool:function(e){l.fireTool.apply(this,[e])},minTool:function(e,t){l.minTool.apply(this,[e,t])},switchCommonPage:function(e,t){var o=this;for(var n in p)h.call(o,n,t)}}},"class"),o.define("core.loader.jslibloadercreator",function(e,t,o,n){"use strict";var r=o("core.loader.Loader"),i=o("core.model.modelCreator"),s=o("core.utils.string"),a=o("core.model.parser.simpleJsonParser"),l=o("core.utils.url"),c=o("core.utils.dom"),u=o("core.utils.function"),d="${ref-path-addon}/js-library/${name}/${version}/package.json";t.exports={create:function(){var e=this,t=function(e){return e.name},p=function(e,t){var o=[];return e.script&&e.script.length>0&&e.script.forEach(function(n){n=l.resolve(t,n),e.releaseNum&&(n+="?releaseNum="+e.releaseNum),o.push({fn:c.addScript,args:[n]})}),u.runSequence(o,"load js")},f=function(e,t){e.css.forEach(function(o){o=l.resolve(t,o),e.releaseNum&&(o+="?releaseNum="+e.releaseNum),c.addStyle(o)})},h=function(t,o){return e.create().load(o,t.dependencies)},g=function(e,t,r){var l=n.Deferred();if(e=o("core.common.playerConfig").getScripts(e),n.isEmptyObject(icCreatePlayer.jsLibConfig)){var c=e.href||s.applyTemplate(d,n.extend(e,r.getRefPath()));i.create({url:c,parser:a}).then(function(e){return f(e.model,e.baseUrl),e}).then(function(e){return h(e.model,r).then(u.createPromiseThen(l,p,[e.model,e.baseUrl]))}).done(function(){l.resolve()})}else{var g={},m=icCreatePlayer.jsLibConfig.auto,v=icCreatePlayer.jsLibConfig.notauto;!n.isEmptyObject(m)&&m.model&&m.model[t]?(g.model=m.model[t],g.baseUrl=m.baseUrl):!n.isEmptyObject(v)&&v.model&&v.model[t]&&(g.model=v.model[t],g.baseUrl=v.baseUrl),g.model&&g.baseUrl?(f(g.model,g.baseUrl),h(g.model,r).then(u.createPromiseThen(l,p,[g.model,g.baseUrl])).done(function(){l.resolve()})):l.reject()}return l.promise()},m=new r(t,g);return this.create=function(){return m},this.create()}}},""),o.define("core.loader.loader",function(e,t,o,n){"use strict";t.type="class",t.exports={constructor:function(e,t){this.promises={},this.getKey=e,this.createLoadPromise=t},load:function(e,t){var o=n.isArray(t)?t:Array.prototype.slice.call(arguments,1),r=this,i=[];return o.forEach(function(t){var o=r.getKey(t),n=r.promises[o]||(r.promises[o]=r.createLoadPromise(t,o,e));i.push(n)}),n.when.apply(n,i)}}},"class"),o.define("core.loader.packageloadercreator",function(e,t,o,n){"use strict";var r=o("core.loader.Loader"),i=o("core.model.modelCreator"),s=o("core.model.parser.simpleJsonParser"),a=o("core.utils.dom");t.exports={create:function(){var e=function(e){return e},t=function(e,t,o){return i.create({url:e,parser:s,textParsers:o}).done(function(e){e.model.css&&a.addStyleContent(e.model.css)})},o=new r(e,t);return this.create=function(){return o},this.create()}}},""),o.define("core.loader.presenterloadercreator",function(e,t,o,n){"use strict";var r=o("core.loader.Loader"),i=o("core.utils.dom"),s=o("core.utils.string"),a=o("core.model.modelCreator"),l=o("core.model.parser.presenterXmlParser"),c=o("core.loader.jsLibLoaderCreator"),u=o("core.utils.function"),d=o("core.model.PresenterModel"),p=/^\s*function(\s+\w+)?\s*\(.*?\)/i,f=/url\s*\(\s*(['"]?)(resources[\\/].*?)\1\s*\)/gi,h="//# sourceURL=ndplayer-${type}\r\n${script}",g="Addon${type}_create",m="function ${createFnName}()",v='url("${base}${name}")',y=c.create(),_=o("core.loader.packageLoaderCreator").create(),P={},T=function(e,t){var o=e.model,n=o.removeAttribute("script");o.createFnName=s.applyTemplate(g,{type:t}),n&&(n=n.replace(p,s.applyTemplate(m,o)),i.addScriptContent(s.applyTemplate(h,{type:t,script:n})))},b=function(e,t){var o=e.removeAttribute("jsDependency");return y.load(t,o)},x=function(e,t){var o=e.model,n=e.baseUrl,r=o.removeAttribute("css");r&&i.addStyleContent(r.replace(f,function(e,t,o){return s.applyTemplate(v,{base:n,name:o})}))};t.exports={create:function(){var e=function(e){return e.presenterId},t=function(e,t,o){var r,s=n.Deferred();return e.data?_.load(o,e.data).done(function(e){var n=e.model.presenters[t],a=n.presenter,l=new d;l.setAttributes(n.dependencies),l.setAttribute("view",n.view),l.setAttribute("css",n.css),r={model:l,baseUrl:n.base},b(l,o).then(function(){return P[a]||(P[a]=i.addScript(a))}).then(function(){T(r,t),x(r,t),s.resolve(r)})}):a.create({url:e.url||e.href,textParsers:o,parser:l}).then(u.createPromiseThen(s,function(e){return r=e,b(e.model,o)})).then(u.createPromiseThen(s,function(){T(r,t),x(r,t),s.resolve(r)})),s.promise()},o=new r(e,t);return this.create=function(){return o},this.create()}}},""),o.define("core.model.collection",function(e,t,o,n){"use strict";t.type="class",t.exports={constructor:function(e){this.items=[],this.map={},this.length=0,e&&(this.indexNames=n.isArray(e)?e:[e]),this.indexMap={}},indexNames:[],add:function(e,t){1===arguments.length&&(t=e,e=""),this.items.push(t),this.map[e||this.length]=this.length;var o=this;this.indexNames.forEach(function(e){var n=o.indexMap[e]||(o.indexMap[e]={});n[t[e]]=o.length}),this.length++},getByIndex:function(e){return this.items[e]},getByKey:function(e){return this.items[this.map[e]]},find:function(e,t){return this.items[this.indexMap[e][t]]},indexOf:function(e,t){var o=t?this.indexMap[t]:this.map;return e in o?o[e]:-1},forEach:function(e){for(var t in this.map)e(this.getByKey(t),t)},getArray:function(){return this.items}}},"class"),o.define("core.model.mainmodel",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.model.Model",attributes:[{name:"pages",type:"core.model.PageCollection"},"css","style",{name:"commons",type:"core.model.Table"}],addPage:function(e){this.getAttribute("pages").add(e)},getPages:function(){return this.getAttribute("pages")}}},"class"),o.define("core.model.model",function(e,t,o,n){"use strict";var r={array:function(){return[]},object:function(){return{}}};t.type="class",t.exports={constructor:function(){this.attributeValues={};var e=this;this.attributes.forEach(function(t){if("string"==typeof t)e.attributeValues[t]="";else{var n,i=t.type.toLowerCase();if(i in r)n=r[i]();else{var s=o(t.type);n=new s}e.attributeValues[t.name]=n}})},attributes:[],setAttribute:function(e,t){e in this.attributeValues&&(this.attributeValues[e]=t)},getAttribute:function(e){return this.attributeValues[e]},removeAttribute:function(e){var t=this.getAttribute(e);return delete this.attributeValues[e],t},setAttributes:function(e){for(var t in e)this.setAttribute(t,e[t])},getValue:function(){return this.attributeValues}}},"class"),o.define("core.model.modelcreator",function(e,t,o,n){"use strict";var r=o("core.utils.url"),i=o("core.model.proxy.AjaxProxy"),s=o("core.utils.function"),a=o("core.utils.string"),l={parse:function(e){return e}},c=function(e,t,o,n,r){return n.forEach(function(t){e=t.parse(e)}),r.parse(e)};e.create=function(e){var t=e.url,o=e.proxy||i,u=e.parser||l,d=e.textParsers||[],p=e.isCache;n.isArray(d)||(d=[d]);var f=n.Deferred();if(t){var h=r.getBase(t),g={"ref-base":h.replace(/\/$/,"")};d.push({parse:function(e){return a.applyTemplate(e,g)}}),o.getData(t,p).fail(function(){if(e.ignoreError){var t=JSON.parse('{"presenters":{},"commons":{},"script":[],"icplayerVersion": "11.7.3"}');f.resolve({model:t,baseUrl:h})}else f.reject(new Error("player 11.7.3: ajax request error"))}).then(s.createPromiseThen(f,c,[d,u],!0)).fail(function(e){f.reject(e)}).then(function(e){f.resolve({model:e,baseUrl:h})}).fail(function(e){f.reject(e)})}else f.resolve({model:null,baseUrl:""});return f.promise()}},""),o.define("core.model.modulegroupmodel",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.model.Model",attributes:[{name:"presenters",type:"object"},{name:"modules",type:"core.model.Collection"}],addModule:function(e){this.getAttribute("modules").add(e.getAttribute("id"),e)},addPresenter:function(e,t){this.getAttribute("presenters")[e]={href:t}}}},"class"),o.define("core.model.modulemodel",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.model.Model",attributes:["id","presenterId","layout","css","style","z-index","lazy-init",{name:"properties",type:"array"},{name:"events",type:"core.model.Collection"}],addProperty:function(e){this.getAttribute("properties").push(e)},addEvent:function(e,t){this.getAttribute("events").add(e,t)}}},"class"),o.define("core.model.pagecollection",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.model.Collection",indexNames:["id","name"],getIndexOfById:function(e){return this.indexOf(e,this.indexNames[0])},getIndexOfByName:function(e){var t=this.indexOf(e,this.indexNames[1]);if(t==-1)throw new Error("The name of Index is not Found");return t}}},"class"),o.define("core.model.pagemodel",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.model.ModuleGroupModel",
attributes:["layout"],__extendAttribute:["attributes"]}},"class"),o.define("core.model.presentermodel",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.model.Model",attributes:["css","view","script",{name:"androidDependency",type:"core.model.Collection"},{name:"jsDependency",type:"array"},{name:"moduleDependency",type:"object"}]}},"class"),o.define("core.model.table",function(e,t,o,n){"use strict";t.type="class",t.exports={constructor:function(){this.data={}},addItem:function(e,t){var o=this.data[e]||(this.data[e]=[]);o.push(t)},getItems:function(e){for(var t,o=n.isArray(e)?e:arguments,r=o.length,i=[],s=0;s<r;s++)t=this.data[o[s]],i=t?i.concat(t):i;return i},forEach:function(e){for(var t in this.data)this.data[t].forEach(e)},removeItem:function(e){delete this.data[e]}}},"class"),o.define("core.model.toolmodel",function(e,t,o,n){"use strict";t.type="class",t.exports={extend:"core.model.ModuleGroupModel",attributes:["mainModule","layout",{name:"properties",type:"array"}],addProperty:function(e){this.getAttribute("properties").push(e)},__extendAttribute:["attributes"]}},"class"),o.define("core.plugin.sync",function(t,o,n,r){"use strict";function i(t){u=new p(encodeURI(t)),u.addEventListener("open",function(){e.clearInterval(f)}),u.onerror=function(o){d.error("ERROR: "+o.message),m++>g?e.clearInterval(f):f=e.setInterval(function(){u=new p(encodeURI(t))},v)},u.onmessage=function(e){l(e.data)},u.onclose=function(e){d.log("CLOSE: "+e.code+", "+e.reason)}}function s(e,t){c=y.getToolList();for(var o=0;o<c.all.length;o++)if(c.all[o].toolKey===t&&c.all[o].syncId===e)return c.all[o]}function a(e,t,o){var n={};return n.eventData={},n.eventName=e,n.eventData.syncId=t,n.eventData.toolKey=o,n}function l(e){if(player){var t=JSON.parse(e),o=t.eventName,n=t.eventData,r=s(n.syncId,n.toolKey);switch(o){case"updateTool":r&&r.mainModule.getPresenter().__interface&&r.mainModule.getPresenter().__interface.sync&&r.mainModule.getPresenter().__interface.sync(n);break;case"addTool":n.toolKey&&y.addTool(n.toolKey,{__sys:{syncId:n.syncId,NONEventFlag:!0}},n.toolState,{toolKey:n.toolKey,ref_path_tool:decodeURIComponent(icCreatePlayer.ref_path_tool)||"../tools"});break;case"closeTool":r&&y.removeTool(r.unqiueId,"player",!0)}}}var c,u,d=n("core.utils.log"),p=e.MozWebSocket||e.WebSocket,f=null,h=null,g=10,m=0,v=500,y=null,_={start:function(e,t){try{var o=this;return y=e,y._eventbus.addEventListener("PLAYER.TOOL.FINISH",function(){var e=arguments[1],t=e.mainModule.getPresenter().getState?e.mainModule.getPresenter().getState():"";o.addTool(e.syncId,e.toolKey,t)}),y._eventbus.addEventListener("PLAYER.TOOL.CLOSE",function(){var e=arguments[1];o.closeTool(e.syncId,e.toolKey)}),i(t),u}catch(n){console.error(n)}},stop:function(){u.close()},send:function(e,t){this.waitForConnection(function(){console.log(u.readyState),console.log(JSON.stringify(e)),u.send(JSON.stringify(e)),"undefined"!=typeof t&&t()},1)},waitForConnection:function(t,o){if(1===u.readyState)e.clearTimeout(h),t();else{var n=this;h=setTimeout(function(){n.waitForConnection(t,o)},o)}},addTool:function(e,t,o){try{var n=a("addTool",e,t);n.eventData.toolState=o,this.send(n)}catch(r){console.error(r)}},updateTool:function(e,t,o){try{var n=a("updateTool",e,t),r=y.getPlayerServices().getState().getAllToolState();n.eventData.toolState=r,n.eventData.updateInfo=o,this.send(n)}catch(i){console.error(i)}},closeTool:function(e,t){try{var o=a("closeTool",e,t);this.send(o)}catch(n){console.error(n)}}};o.exports=_},""),o.define("core.player.component",function(e,t,o,n){"use strict";var r=o("core.model.modelCreator"),i=o("core.exception.playerException"),s=o("core.eventbus.eventbus"),a=o("core.utils.url"),l=o("core.utils.function"),c=o("core.utils.uuid"),u=o("core.layout.Layout"),d={iframe:"core.layout.playerIframeLayout",div:"core.layout.playerDivLayout"},p=function(e,t){var n=d[e]||e,r=o(n);return new r(t)};t.type="class",t.exports={constructor:function(e,t){if(this.layoutTarget=void 0,this.initConfig(e),n.extend(this,e),this.id=this.id||c(6),this.unqiueId=c(8),this.parent=t||this,this.top=this.parent.top||this,this.parentBaseUrl=this.parent.baseUrl||a.getBaseLocationUrl(),this.url=this.url&&a.resolve(this.parentBaseUrl,this.url),this.layout&&(this.layout=p(this.layout,this)),this._events={},this._eventbus=new s,this.initComponent(),n.isPlainObject(this.listeners))for(var o in this.listeners)this.addEventListener(o,this.listeners[o],this)},createController:function(){return{}},getController:function(){return this.controller||(this.controller=this.createController())},initConfig:function(e){e.url=e.url||e.href,delete e.href,e.layout&&(e.layoutConfig=u.createLayoutConfig(e.layout),delete e.layout)},initComponent:function(){this.addEvents("renderModel","render","destroy")},load:function(){return r.create({url:this.url,textParsers:[this.getRefPathParser()],parser:this.parser})},getRefPathParser:function(){return this.top.getRefPathParser()},render:function(e){this.container=n(e||this.renderTo);var t=n.Deferred();try{this.fireEvent("beforeRender");var o;this.onRender();var r=this;this.load().fail(function(e){t.reject(i.create("load error",e))}).then(l.createPromiseThen(t,function(e){return o=e,r.baseUrl=e.baseUrl,r.renderModel(e.model,e.baseUrl)})).fail(function(e){t.reject(e)}).then(l.createPromiseThen(t,function(){return r.fireEvent("renderModel",o.model),r.layout&&r.layout.render(r.layoutTarget||r.element)})).then(l.createPromiseThen(t,function(){return r.fireEvent("afterLayout"),r.afterLayout()})).then(function(){o=null,t.resolve(r),r.fireEvent("render")})}catch(s){console.error(s),t.reject(i.create("render error",s))}return t.fail(function(e){i.execute(e,r)})},onRender:function(){this.element=this.container},renderModel:function(e,t){},afterLayout:function(){},getElement:function(e){return e===!0?this.element:this.element[0]},addEvents:function(e){if("string"==typeof e)for(var t=arguments,o=t.length;o--;)this._events[t[o]]=this._events[t[o]]||!0},fireEvent:function(e){s.prototype.dispatch.apply(this._eventbus,arguments)},addEventListener:function(e){s.prototype.addEventListener.apply(this._eventbus,arguments)},release:function(){this.destroy(),this.fireEvent("destroy",this),this.element==this.container?this.element.children().remove():this.element.remove()},destroy:function(){},layout:void 0}},"class"),o.define("core.player.module",function(t,o,n,r){"use strict";var i=n("core.loader.presenterLoaderCreator"),s=n("core.utils.function"),a=n("core.common.createModel"),l=n("core.utils.dom"),c=n("core.utils.request"),u=n("core.model.ModuleModel"),d=n("core.utils.Log"),p=n("core.utils.string"),f=n("core.common.i18nLoader"),h={Wrap:/^wrap$/,Processer:/^(processBeforeRun|processAfterRun|setCallbackList|setPageExtendConf)$/},g=function(){var e=this;return a(this.properties,this.parent.baseUrl,this.getRefPathParser()).then(function(t){return r.extend(t,{$:{presenterId:e.presenterId,unqiueId:e.id+"@"+e.parent.id,scope:e.parent.moduleGroupType},ID:e.id})})},m=function(t,o){var n={};try{var r=this;n=e[t].apply(e,[r.presenterId]);var i=[];if(n.__interface)for(var a in n.__interface)for(var l in h)h[l].test(a)&&i.push(l);this._interface=p.createReg(i),n.__model=this.getModel(),s.execute(n,{setPlayerController:r.getController(),setUrlParams:c.get(),setBasePath:o,setPaint:r.top.getPaint()})}catch(u){d.error("create presenter["+t+"] error",u)}return n},v={run:["run"],show:["pageShow"],destroy:["pageLeave","destroy"],pageChange:["pageChange"],afterRender:["afterRender"]};o.type="class",o.exports={extend:"core.player.Component",isRequire:!1,load:function(){var e=this;return g.call(this).then(function(t){e.presenterModel=t;var o=i.create();return o.load(e.refPathParser,e)})},createController:function(){for(var e,t=this,o={addToolItem:function(e,o){if("core.player.tool"===t.parent.className&&e)return e.renderTo=t.parent.element.find(n("core.player.tool").getItemRender(o)),this.require(e)},require:function(e){var o=e.presenterId=e.presenterId||e.addonId;delete e.addonId;var n=t.top.getPresenter(o)||t.moduleDependency[o];if(n){e.isRelative!==!1&&["top","left"].forEach(function(o){e.layout[o]=t.layoutConfig[o]+parseInt(e.layout[o],10)}),n.refPathParser=n.refPathParser||t.getRefPathParser();var i=new u;i.setAttributes(e);var s=new t.constructor(r.extend(i.getValue(),n,{isRequire:!0}),t.parent),a=e.renderTo?s.render(e.renderTo):t.parent.layout.addModule(s);return a.then(function(){return t.parent.requireModule(s)}).then(function(){return r.isFunction(e.callback)&&e.callback(s.getPresenter()),s.getPresenter()})}d.error("require error, do not find addonId["+o+"] config,please check moduleDependency config")},createModule:function(e,o){var n=t.parent.lazyInitModules[e];return n.isRelative=!1,r.extend(n,o),this.require(n)},getEventBus:function(){return{addEventListener:function(e,o,n){var r=t;for(n=n||{};r.parent!==r;)r.addEventListener(e,{fn:o.onEventReceived,scope:o,selector:n.target}),r=r.parent}}}},i=this;;){i=i.parent,e=i.getController();for(var s in e)s in o?!function(e){o[s]=function(){return e}}(r.extend(o[s](),e[s]())):o[s]=e[s];if(i.parent==i)break}return o},getPage:function(){for(var e=this.parent;"core.player.page"!=e.className;)e=e.parent;return e},renderModel:function(e,t){var o=r.Deferred(),n=o.resolve();try{this.moduleDependency=e.getAttribute("moduleDependency"),this.cssElement=r(l.addStyle(this.css)),this.presenter=m.call(this,e.createFnName,t),this.parent.isReportable&&this.parent.isReportable()===!1&&r.isFunction(this.presenter.getQuestionInfo)&&this.parent.setReportable(!0);var i=this;return i.instanceOf("Wrap")&&(n=n.then(function(){return i.runInterface("wrap",i.container[0])}).done(function(e){i.container=r(e||i.container)})),n.done(function(){var t;t=i.top.templateKey?'<div class="'+i.top.templateKey+'_${presenterId} ic_module" id="${id}" style="${style}"></div>':'<div class="addon_${presenterId} ic_module" id="${id}" style="${style}"></div>',i.element=r(p.applyTemplate(t,i)),i.element.css(i.layoutConfig),i.element.html(e.getAttribute("view")),i.container.append(i.element)}).then(function(){if(r.isFunction(i.presenter.setLocationProperties))return f.load(t).done(function(e){i.run("setLocationProperties",e)})}).done(function(){var e="init"+i.getController().getRuntime();i.run(e)})}catch(s){d.error("init module error",s)}},getPresenter:function(){return this.presenter},getModel:function(){return this.presenterModel},getStateId:function(){return this.parent.id+this.id},getState:function(){return this.run("getState")},setState:function(e){this.run("setState",e)},run:function(e,t){try{return s.execute(this.presenter,e,t)}catch(o){d.error("run presenter["+e+"] error",o)}},runInterface:function(e,t){if(this.presenter&&this.presenter.__interface)return s.execute(this.presenter.__interface,e,t)},instanceOf:function(e){return this._interface.test(e)},runLifeCycle:function(e){var t=this,o=[t.getElement(),t.getModel()],n=[];return v[e].forEach(function(e){n.push({fn:t.presenter[e],args:o,scope:t.presenter,name:t.presenterId+":"+e})}),s.runSequence(n,"run presenter lifecycle")},destroy:function(){this.cssElement&&this.cssElement.remove(),this.runLifeCycle("destroy")},getZIndex:function(){return this["z-index"]}}},"class"),o.define("core.player.modulegroup",function(e,t,o,n){"use strict";var r=o("core.player.Module"),i=o("core.model.Collection"),s=o("core.utils.Log"),a=o("core.utils.function");t.type="class",t.exports={extend:"core.player.Component",initComponent:function(){o("core.player.ModuleGroup").prototype.superClass.initComponent.call(this),this.processPresenters=[],this.lazyInitModules={}},renderModel:function(e){var t=this;if(this.items=new i,this.items_state={},this.itemIds=[],e){var o=e.getAttribute("presenters")||{};e.getAttribute("modules").forEach(function(e){if(e=e.getValue(),e["lazy-init"]===!0)t.lazyInitModules[e.id]=e;else{var i=t.top.getPresenter(e.presenterId)||o[e.presenterId];i?(i.refPathParser=i.refPathParser||t.getRefPathParser(),t.items.add(e.id,new r(n.extend(e,i),t)),t.itemIds.push(e.id)):s.error("do not find ["+e.presenterId+"]presenter config")}})}},getModuleList:function(){return this.itemIds},getModule:function(e){var t;if(this.items){var o=this.items.getByKey(e);t=o&&o.getPresenter()}return t},getModulesByType:function(e){var t=[];return this.items.getArray().forEach(function(o){o.presenterId==e&&t.push(o.getPresenter())}),t},runModuleLifeCycle:function(e){var t=/^(run|show|afterRender)$/,o=[];return this.items.forEach(function(n){if(!t.test(e)||!n.isRequire){var r=n.getModel(),i=n.getElement();o.push(n.runLifeCycle(e,i,r))}}),n.when.apply(n,o)},_setModuleState:function(e){var t=this.top.getStateValue(e.getStateId());t&&e.setState([t,this.gotoConfig?this.gotoConfig.options||{}:{}])},requireModule:function(e){var t=this;this.items.add(e.id,e),this.items_state[e.id]=!1,this.itemIds.push(e.id),e.instanceOf("Processer")&&this.processPresenters.push(e),e.instanceOf("Processer")&&(this.processPresenters.push(e),this.items.forEach(function(o){e.runInterface("setCallbackList",o.top.getCallbackList()),e.runInterface("processBeforeRun",o.getPresenter()),t.gotoConfig&&t.gotoConfig.__extendConfig&&e.runInterface("setPageExtendConf",t.gotoConfig.__extendConfig)})),this.processPresenters.forEach(function(o){o!=e&&(o.runInterface("setCallbackList",e.top.getCallbackList()),o.runInterface("processBeforeRun",e.getPresenter()),t.gotoConfig&&t.gotoConfig.__extendConfig&&o.runInterface("setPageExtendConf",t.gotoConfig.__extendConfig))});var o=[];return["run",this._setModuleState,"show","afterRender"].forEach(function(r){n.isFunction(r)?o.push({fn:r,args:[e],scope:t,name:"setState"}):o.push({fn:e.runLifeCycle,args:[r],scope:e,name:r})}),a.runSequence(o).done(function(){t.items_state[e.id]=!0,e.instanceOf("Processer")&&t.items.forEach(function(o,n){t.items_state[n]&&e.runInterface("processAfterRun",o.getPresenter())}),t.processPresenters.forEach(function(t){t!=e&&t.runInterface("processAfterRun",e.getPresenter())})})},afterLayout:function(){var e=this;this.items.forEach(function(t){t.isRequire||(t.instanceOf("Processer")===!0&&e.processPresenters.push(t),t.events.length&&t.events.forEach(function(t,o){t.forEach(function(t){var n=e.items.getByKey(t.id);n&&t.name in n.getPresenter()&&n.getController().getEventBus().addEventListener(o,{onEventReceived:function(e,o){n.run(t.name,o)}})})}),delete t.events)}),this.processPresenters.forEach(function(t){e.items.forEach(function(o){t.runInterface("setCallbackList",e.top.getCallbackList()),t.runInterface("processBeforeRun",o.getPresenter()),e.gotoConfig&&e.gotoConfig.__extendConfig&&t.runInterface("setPageExtendConf",e.gotoConfig.__extendConfig)})});var t=[];return this.modulelifeCycles.forEach(function(o){n.isFunction(o)?t.push({fn:o,args:[],scope:e,name:o}):t.push({fn:e.runModuleLifeCycle,args:[o],scope:e,name:o})}),a.runSequence(t).done(function(){e.processPresenters.forEach(function(t){e.items.forEach(function(e){e.isRequire||t.runInterface("processAfterRun",e.getPresenter())})})})},destroy:function(){this.items&&this.items.forEach(function(e){e.release()})},modulelifeCycles:["run","show","afterRender"],layout:"core.layout.pageAbsoluteLayout"}},"class"),o.define("core.player.page",function(e,t,o,n){"use strict";var r=o("core.model.parser.pageXmlParser"),i=function(){var e=this;this.items.forEach(function(t){if(!t.isRequire){var o=e.top.getStateValue(t.getStateId());o&&t.setState([o,e.gotoConfig.options||{}])}})};t.type="class",t.exports={extend:"core.player.ModuleGroup",initComponent:function(){o("core.player.Page").prototype.superClass.initComponent.call(this),this.reportable=!1,this.gotoConfig=this.gotoConfig||{},this.addEvents("PageLoaded")},moduleGroupType:"page",pageChange:function(){this.runModuleLifeCycle("pageChange")},onRender:function(){this.element=n('<div class="ic_page"></div>'),this.container.append(this.element)},getState:function(){var e,t={};return this.items&&this.items.forEach(function(o){e=o.getState(),e&&(t[o.getStateId()]=e)}),t},setReportable:function(e){this.reportable=e},isReportable:function(){return this.reportable},modulelifeCycles:["run",i,"show","afterRender"],parser:r}},"class"),o.define("core.player.player",function(t,o,n,r){"use strict";var i=n("core.model.parser.mainXmlParser"),s=n("core.player.page"),a=n("core.utils.request"),l=n("core.common.refPathBuilder"),c=n("core.common.playerConfig"),u=n("core.eventbus.eventname"),d=n("core.utils.url"),p=n("core.model.table"),f=n("core.utils.Log"),h=n("core.state.SimpleState"),g=n("core.utils.function"),m=n("core.common.i18nLoader"),v=n("core.common.PlayerFlow"),y=n("core.common.tool.toolapi"),_=n("core.common.player.gotopage"),P=(n("core.common.createModel"),function(e){return new s(e,this)}),T={page:function(){return this.activePage.items?this.activePage.items.getArray():[]},tool:function(){var e=[];return this.toolList.all.forEach(function(t){t.items&&(e=e.concat(t.items.getArray()))}),e},common:function(){var e=[];return this.commonPages.forEach(function(t){t.items&&(e=e.concat(t.items.getArray()))}),e}},b=[];for(var x in T)b.push(x);o.type="class",o.exports={extend:"core.player.Component",initComponent:function(){n("core.player.Player").prototype.superClass.initComponent.call(this),this.waitDialog=this.waitDialog||n("core.common.defaultWaitDialog"),this.pages=[],this.state=new h(this.stateToken),this.currentPageIndex=0,this.refPathParser=l.build(this.refPath,this.url),this.oriRefPathParse=this.refPathParser;var t=this.getRefPathParser().getRefPath();icCreatePlayer.ref_path=t["ref-path"],icCreatePlayer.ref_path_addon=t["ref-path-addon"],icCreatePlayer.ref_path_tool=e.decodeURIComponent(n("core.utils.request")("ref-path-tool"))||this.playerCode;var o=this.location.default_lang;o=void 0===this.location.current||""===this.location.current?o:this.location.current,icCreatePlayer.lang=o,this.addEventListener("PageLoaded",function(){this.activePage.fireEvent("PageLoaded"),this.commonPages.forEach(function(e){e.fireEvent("PageLoaded")})},this),this.toolList={list:{top:[],bottom:[]},all:[],active:""},this.i18nModel={},m.setLocation(this.location),this.playerFlows={},this.TOOL.TOOLCONTROL=y.create(this),n("core.common.printscreen").printScreen(this._eventbus),console.log("player version : 11.7.3")},getI18nModel:function(e){var t,o=icCreatePlayer.lang;return t||this.i18nModel.player||(t=n("core.locations."+o+".lang"),t||(t=n("core.locations."+o.split("_")[0]+".lang")),t||(t=n("core.locations.zh_CN.lang")),this.i18nModel.player=t?t:e),this.i18nModel},getRefPathParser:function(e){return this.refPathParser[e||"courseware"]},getCallbackList:function(){return this.callbackList||{}},render:function(e){return this.container=r(e),this.renderPromise=n("core.player.Player").prototype.superClass.render.call(this,e)},load:function(){var e=this;return c.create(this.playerCode,this.refPathParser.playerConfig).then(function(){return e.element.addClass("typefaces_"+e.location.current),n("core.player.Player").prototype.superClass.load.call(e)})},onRender:function(){this.element=r('<div class="ic_player"></div>'),this.container.append(this.element)},setContainerFontSize:function(e){(this.adaptFlag||void 0==this.adaptFlag)&&(icCreatePlayer.fontSize=e,this.container.css("font-size",e+"px"))},getCurrentPageIndex:function(){return this.currentPageIndex},closeActivePage:function(){_.closeActivePage.apply(this)},gotoPageIndex:function(e,t){_.gotoPageIndex.apply(this,[e,t])},registerFlow:function(e,t){this.playerFlows[e]=new v(t,e,this)},startFlow:function(e,t,o,n){var r=this.playerFlows[e];r?r.start(t,t&&t.scope,o,n):f.log("not exist"+e+" flow")},destroy:function(){this.closeActivePage(),this.clearTool(),this.commonPages&&(this.commonPages.forEach(function(e){e.release()}),this.commonPages=null)},eachPresenter:function(e,t){t=t||b,r.isArray(t)||(t=[t]);var o=[],n=this;t.forEach(function(e){var t=T[e];t&&(o=o.concat(t.call(n)||[]))}),o.forEach(e)},getStateValue:function(e){return this.state.getState(e)},gotoPage:function(e,t){_.gotoPage.apply(this,[e,t])},gotoPageId:function(e,t){_.gotoPageId.apply(this,[e,t])},firstPage:function(){_.firstPage.apply(this)},lastPage:function(){_.lastPage.apply(this)},nextPage:function(){_.nextPage.apply(this)},prevPage:function(){_.prevPage.apply(this)},addExtendPage:function(t){var o=this;this.refPathParser=l.build(this.refPath,t["ref-path"]);var i=this.getRefPathParser().getRefPath();icCreatePlayer.ref_path=i["ref-path"],icCreatePlayer.ref_path_addon=i["ref-path-addon"],icCreatePlayer.ref_path_tool=e.decodeURIComponent(n("core.utils.request")("ref-path-tool"))||this.playerCode,this.top.layout.activePage(),this.closeActivePage(),t.url=t.url||t.href||"",t.hidePage&&t.hidePage.split(",").forEach(function(e){o.layout.switchCommonPage(e,!1)}),this.activePage=P.call(this,r.extend(t,{pageType:"extendPage"})),this.layout.renderPage()},getPageType:function(){if(this.activePage)switch(this.activePage.pageType){case"extendPage":return 1;default:return 0}return 0},closeExtendPage:function(){this.refPathParser=this.oriRefPathParse;var t=this.getRefPathParser().getRefPath();icCreatePlayer.ref_path=t["ref-path"],icCreatePlayer.ref_path_addon=t["ref-path-addon"],icCreatePlayer.ref_path_tool=e.decodeURIComponent(n("core.utils.request")("ref-path-tool"))||this.playerCode,this.gotoPageIndex(this.currentPageIndex)},mediaPause:function(){try{for(var e,t=["video","audio"],o=[document],n=document.getElementsByTagName("iframe"),r=0;e=n[r];r++)e.src&&o.push(e.contentWindow.document);t.forEach(function(e){o.forEach(function(t){var o,n=t.getElementsByTagName(e);for(r=0;o=n[r];r++)o.pause&&o.pause()})})}catch(i){console.log(i)}},renderModel:function(e,t){c.loadCss(e&&e.getAttribute("css"));var o={url:""};if(this.commonPages=new p,this.pageUrl)o={url:this.pageUrl};else if(e){var n=this;this.pages=e.getPages(),this.pages.forEach(function(e){e.preview=e.preview&&d.resolve(t,e.preview)}),this.startPageIndex?this.currentPageIndex=parseInt(this.startPageIndex,10):this.startPageId?this.currentPageIndex=this.pages.getIndexOfById(this.startPageId):this.startPageName&&(this.currentPageIndex=this.pages.getIndexOfByName(this.startPageName)),this.currentPageIndex>=0&&(o=this.pages.getByIndex(this.currentPageIndex)),this.commonPages=c.getCommons(this.commonPages,g.createDelegate(P,null,null,this)),this.hidePage&&this.hidePage.split(",").forEach(function(e){n.commonPages.removeItem(e)})}this.activePage=P.call(this,o)},createController:function(){return n("core.common.player.controller").createController.apply(this)},getPresenter:function(e){var t=c.getPresenter(e);return t&&(t.refPathParser=this.getRefPathParser("playerConfig")),t},getPaint:function(){return this.toolPaint},getEventName:function(){return u},getUtils:function(){return icCreatePlayer.utils},updateToolProperties:function(e,t){this.TOOL.TOOLCONTROL.updateToolProperties.apply(this,[e,t])},addTool:function(e,t,o,n){return this.TOOL.TOOLCONTROL.addTool.apply(this,[e,t,o,n])},getToolList:function(){return this.TOOL.TOOLCONTROL.getToolList.apply(this)},isMaxToolCount:function(e){return this.TOOL.TOOLCONTROL.isMaxToolCount.apply(this,[e])},clearTool:function(){this.TOOL.TOOLCONTROL.clearTool.apply(this)},removeTool:function(e,t,o){this.TOOL.TOOLCONTROL.removeTool.apply(this,[e,t,o])},parser:i,layout:"div",getPlayerServices:function(){return this.getController()},onPageLoaded:function(e){this.addEventListener("PageLoaded",e,this)},TOOL:{TOOLCONTROL:{},DATA:{bottom:{MAXLIMIT:a("bottomlimit")||3},top:{MAXLIMIT:a("toplimit")||1e4},PUSHING:!1,CURRENTPUSHTOOL:null,DIALOG:{STEPLEFT:0,STEPTOP:0}}}}},"class"),o.define("core.player.tool",function(t,o,n,r){"use strict";var i=n("core.model.parser.toolParser"),s=n("core.common.createModel"),a=(n("core.utils.Log"),n("core.layout.Layout")),l=(n("core.eventbus.eventname"),n("core.exception.playerException")),c=n("core.common.ispointinpath"),u=n("core.bridge.pptshell"),d=n("core.utils.string"),p=n("core.common.tool.tool"),f=n("core.common.layout.tool"),h=n("core.common.tool.tooldialog"),g=n("core.common.tool.toolpush"),m=(n("core.utils.throttle"),{}),v={},y={up:'<div class="ic_tool"><div class="com_tooldialog_pop dialog_${id}" style="display:none;z-index:9999;position:fixed"><div class="com_tooldialog_pop_box"><div class="com_tooldialog_pop_main"><p class="com_tooldialog_pop_txt">${tip_for_xp}</p></div></div></div></div>',down:'<div class="tooldialog_control ${id}" style="visibility: hidden"><div class="tooldialog_wrap"><div class="com_tooldialog_pop com_tooldialog_pop_tips hide_dom _icplayer_fullscreen_tip"><div class="com_tooldialog_pop_box"><div class="com_tooldialog_pop_main"><p class="com_tooldialog_pop_txt">${tip_full}</p></div></div></div><div class="tooldialog_head"><p class="tooldialog_title"><span class="tooldialog_title_icon"><img src="${smallIcon}"/></span><em class="title">${toolName}</em></p><div class="tooldialog_com_header_time" style="display:none"><div class="tooldialog_com_time"><div class="tooldialog_time_default "><span class="tooldialog_time_m"><em>00</em></span><i>:</i><span class="tooldialog_time_s"><em>00</em></span></div></div></div><div class="tooldialog_headleft"></div></div><div class="tooldialog_content"></div><div class="sidetool lefttool"><div class="tool_wrap"><a class="_icplayer_push_button btn_tool tool_push ${ispushing}" style="display: ${display}"><div class="tool_push_icon"><div class="tool_push_icon_main"><span class="tool_push_icon_nor"></span><span class="tool_push_icon_end"></span></div></div></a><a class="btn_tool tool_small"></a><div class="tool_ctrol"><a class="btn_tool tool_close"></a><div class="tool_tip tool_tip_small" style="display: none;"><div class="tool_tip_wrap"><p class="tip_text" style="display: none;" id="tip_next_push"><em class="text">${pushed_tip}</em></p><p class="tip_text"><em class="text">${tip}</em></p><a class="btn_tool_tip"><em class="btn_text">${sure}</em></a><a                                class="btn_tool_tip"><em class="btn_text">${cancel}</em></a></div></div></div><a class="btn_tool tool_full"></a><a class="btn_tool to_fullscreen _icplayer_tool_fullscreen"></a></div><div class="tool_wrap_mask hide_dom"></div></div><div class="sidetool righttool"><div class="tool_wrap"><a class="_icplayer_push_button btn_tool tool_push ${ispushing}" style="display: ${display}"><div class="tool_push_icon"><div class="tool_push_icon_main"><span class="tool_push_icon_nor"></span><span class="tool_push_icon_end"></span></div></div></a><a class="btn_tool tool_small"></a><div class="tool_ctrol"><a class="btn_tool tool_close"></a><div class="tool_tip tool_tip_small" style="display: none;"><div class="tool_tip_wrap"><p class="tip_text" id="tip_next_push" style="display: none;"><em class="text">${pushed_tip}</em></p><p class="tip_text"><em class="text">${tip}</em></p><a class="btn_tool_tip"><em class="btn_text">${sure}</em></a><a                                class="btn_tool_tip"><em class="btn_text">${cancel}</em></a></div></div></div><a class="btn_tool tool_full"></a><a class="btn_tool to_fullscreen _icplayer_tool_fullscreen"></a></div><div class="tool_wrap_mask hide_dom"></div></div><div class="com_tooldialog_pop dialog_${id}" style="display:none;z-index:9999"><div class="com_tooldialog_pop_box"><div class="com_tooldialog_pop_main"><p class="com_tooldialog_pop_txt">${tip_for_xp}</p></div><div class="com_tooldialog_pop_foot"><a class="com_tooldialog_pop_btn close_${id}">${close}</a></div></div></div></div></div>'},_={top:0,left:0,visibility:"visible"},P=0,T=0,b=[],x={right:"tooldialog_com_header_time",left:"tooldialog_headleft"},C=function(){var e=this;if(0===e.top.toolList.list.bottom.length&&(P=T=0),e.toolConfig.independent!==!0)if(e.top.TOOL.DATA.PUSHING||e.element.find(".tool_push").removeClass("on"),"pc"!==e.dialogModel.__type)e.element.css({visibility:"visible"});else{var t=Math.floor((r("body").width()-60*icCreatePlayer.fontSize)/2)+P,o=Math.floor((r("body").height()-33.75*icCreatePlayer.fontSize)/2)+T;e.top.TOOL.DATA.DIALOG.STEPLEFT=4*icCreatePlayer.fontSize*.75,e.top.TOOL.DATA.DIALOG.STEPTOP=2.66667*icCreatePlayer.fontSize*.75,0===b.length&&(b=[{used:!1,unqiueId:void 0,left:t,top:o},{used:!1,unqiueId:void 0,left:t+e.top.TOOL.DATA.DIALOG.STEPLEFT,top:o+e.top.TOOL.DATA.DIALOG.STEPTOP},{used:!1,unqiueId:void 0,left:t+2*e.top.TOOL.DATA.DIALOG.STEPLEFT,top:o+2*e.top.TOOL.DATA.DIALOG.STEPTOP}]);var n=p.getPositionIndex(b);e.element.css({left:b[n].left,top:b[n].top,visibility:"visible"}),p.updatePositionUsed(b,n,e.unqiueId)}},I=function(){var e=this;e.options;if(this.toolConfig){this.options.__sys.toolKey=this.toolKey;var t=w.apply(this,arguments);return r.when(t).then(function(){})}},L=function(e){setTimeout(function(){e.addClass("hide_dom")},2e3)},E=function(){var e=this;this.items.forEach(function(t){if(!t.isRequire&&e.state){e.state=JSON.parse(e.state);var o=e.state[e.toolKey+e.syncId];o&&t.setState([o,e.options||{}])}})},w=function(e){var t=jQuery.Deferred();if(this.toolConfig){var o=this.toolConfig.execute;if(o){this.top.toolList.active=this.toolConfig.independent===!0?"top":"bottom";var n=this.options;return this.mainModule.runInterface(o,e||this.options.executeArgs||n)}t.resolve()}else t.resolve()};o.type="class",o.exports={extend:"core.player.ModuleGroup","static":{getItemRender:function(e){return".tooldialog_head > ."+x[e]},getTool:function(e,t,o){var n=p.getToolKey(e,t);t&&t.toolKey&&(n=t.toolKey);var r=m[n];return r?(w.call(r.instance,t),r.instance):(r=o.filter(function(e){return n===p.getToolKey(e.key)&&e.syncId===t.__sys.syncId}),(r=r[0])?(w.call(r,t),r):void 0)},removeTool:function(e){var t=p.getToolKey(e),o=m[t];o&&(v[t]=void 0,m[t]=void 0)},toolLoadState:v,singleTools:m,bridgeClose:function(){u.tool.close()}},initComponent:function(){n("core.player.Tool").prototype.superClass.initComponent.call(this),this.syncId=this.unqiueId,this.dialogModel=p.getDialogModel(this.options),this.toolKey=p.getToolKey(this.key),this.options.__sys.syncId?this.syncId=this.options.__sys.syncId:this.options.__sys.syncId=this.syncId,this.addEvents("mousemove","mousedown","mouseup")},createController:function(){var e=this;return{getCommands:function(){return{closeTool:function(t){e.release(t)}}}}},show:function(e){e?this.element.css(e):this.element.show()},hide:function(e){e?this.element.css(e):this.element.hide()},getState:function(){var e,t={};return this.items.forEach(function(o){e=o.getState(),e&&(t[o.parent.toolKey+o.parent.syncId]=e)}),t},moduleGroupType:"tool",renderModel:function(t,o){n("core.player.Tool").prototype.superClass.renderModel.call(this,t),t=t.getValue();var i,c=this;return s(t.properties,o,this.getRefPathParser()).then(function(o){c.toolConfig=o,"true"===e.icCreatePlayer.request("hidepush")&&(o.push=!1),void 0===o.toolKey&&(o.toolKey=c.toolKey);var n=o.independent?"top":"bottom";if("top"===n&&icCreatePlayer.plugin.webglControl){var s=icCreatePlayer.plugin.webglControl.isToolsExcess(c.toolKey);if(s)return v[c.toolKey]=void 0,r.Deferred().reject(l.create("top tool exceed max",new Error("player 11.7.3: exceed max")))}else if(p.isOverMaxLimit(c.top,n)){v[c.toolKey]=void 0;var u="._icplayer_limit_tip",P=c.top.layout.$toolTarget.find(u).find(".com_tooldialog_pop_txt");return P.find("#maxlimit").html(c.top.TOOL.DATA[n].MAXLIMIT),P.find("#classtool").html(c.top.getI18nModel().player["Tool_"+n]),c.top.layout.$toolTarget.find(u).show(),e.setTimeout(function(){c.top.layout.$toolTarget.find(u).hide()},3e3),r.Deferred().reject(l.create("exceed max",new Error("player 11.7.3: exceed max")))}if("pageTool"===o.toolType)i=r(y.up),c.top.activePage.element.append(i),c.element=i;else if("bottom"===n){var T=c.dialogModel;"pc"==T.__type&&c.toolConfig.enableFull===!0?(T.disabledFull=!1,T.no_full=!1):"pc"==T.__type&&c.toolConfig.enableFull===!1?(T.disabledFull=!0,T.no_full=!1):(T.disabledFull=!0,T.no_full=!0),i=r(d.applyTemplate(y.down,{toolName:c.options.__sys.toolName||(o.toolKey?p.getToolNameI18n(c.top.getI18nModel().tool,o.toolKey):o.toolName),display:o.push?"block":"none",
smallIcon:o.smallIcon||"",ispushing:g.pushDomStatus.apply(c)?"on":"click_disabled",push:c.top.getI18nModel().player.Tool_Push,pushed_tip:c.top.getI18nModel().player.Tool_Pushed_Tip,tip:c.top.getI18nModel().player.Tool_Tip,cancel:c.top.getI18nModel().player.Tool_Cancel,sure:c.top.getI18nModel().player.Tool_Sure,id:c.unqiueId,tip_full:c.top.getI18nModel().player.Tool_full,tip_for_xp:c.top.getI18nModel().player.Tool_Not_Support,close:c.top.getI18nModel().player.Tool_See})),c.element.append(i),h.setDisplayMode.apply(c,[T,!1,i]),c.element=i,c.layoutTarget=c.element.find(".tooldialog_content"),h.initEvent.apply(c,[T]),o.supportXP===!1&&"xp"===icCreatePlayer.utils.getOS()&&(c.element.find(".dialog_"+c.unqiueId).css("display",""),c.dialogModel&&(c.dialogModel.disabledClose||"pre"===c.dialogModel.__type)&&c.element.find(".close_"+c.unqiueId).css("display","none"),c.element.find(".close_"+c.unqiueId).click(function(){c.container.find(".sideicon."+c.unqiueId).remove(),c.release()}))}else if(i=r(d.applyTemplate(y.up,{id:c.unqiueId,tip_for_xp:c.top.getI18nModel().player.Tool_Not_Support})),c.element.parent().append(i),c.element=i,o.supportXP===!1&&"xp"===icCreatePlayer.utils.getOS())return c.element.find(".dialog_"+c.unqiueId).css("display",""),L(c.element.find(".dialog_"+c.unqiueId)),v[c.toolKey]=void 0,r.Deferred().reject(l.create("top tool exceed max",new Error("player 11.7.3: exceed max")));C.apply(c),c.toolConfig.execute=c.toolConfig.execute||"execute",v[c.toolKey]="done",c.toolConfig.singleton&&(m[c.toolKey]={instance:c,count:1}),c.layoutConfig=r.extend({},_,a.createLayoutConfig(t.layout),a.createLayoutConfig(c.options,["visibility","display"])),o.independent===!0&&c.element.css(c.layoutConfig),c.mainModule=c.items.getByKey(t.mainModule),f.setToolZIndex.apply(c.top.layout,[c])})},getRefPathParser:function(){return this.top.getRefPathParser("tool")},getZIndex:function(){return this.element.css("z-index")},release:function(e){var t=this;v[t.toolKey]=void 0,p.delPositionUnqiueId(b,t.unqiueId),"hidden"!=r(t.top.layout.$toolTarget.find("._icplayer_limit_tip")).css("visibility")&&t.top.layout.$toolTarget.find("._icplayer_limit_tip").hide(),e||t.top.fireEvent(n("core.eventbus.eventname").tool.close,t),n("core.player.Tool").prototype.superClass.release.call(this)},push:function(){g.push.apply(this)},stopPush:function(){g.stopPush.apply(this)},isPointInPath:function(e,t){return c(this,e,t)},switchToolContainerBG:function(e){e?this.container.parent().css("background-color","rgba(0,0,0,0.6)"):this.container.parent().css("background-color","")},modulelifeCycles:["run",E,"show","afterRender",I],parser:i}},"class"),o.define("core.state.localstoragecontroller",function(e,t,o,n){"use strict";var r="$$icplayerState";t.exports={write:function(e){try{localStorage.setItem(r,JSON.stringify(e))}catch(t){}},read:function(){return JSON.parse(localStorage.getItem(r)||"{}")},clear:function(){try{localStorage.setItem(r,"")}catch(e){}}}},""),o.define("core.state.simplestate",function(e,t,o,n){"use strict";var r=o("core.state.localStorageController");t.type="class",t.exports={constructor:function(e){this.data={},this.stateToken=e,this.stateToken?this.read():r.clear()},addStates:function(e){n.extend(this.data,e)},getState:function(e){return this.data[e]},loadFromString:function(e){if(e){var t=JSON.parse(e);this.addStates(t)}},getAsString:function(){return JSON.stringify(this.data)},readState:function(){return r.read()[this.stateToken]||{}},writeState:function(e){var t={};t[this.stateToken]=e,r.write(t)},read:function(){if(this.stateToken){var e=this.readState();for(var t in e)this.loadFromString(e[t]);this.writeState(e)}},writePageState:function(e,t){if(this.stateToken){var o=this.readState();o[e]=t,this.writeState(o)}}}},"class"),o.define("core.utils.baseundo",function(e,t,o,n){"use strict";function r(e,t){for(;e.length>t;)e.shift()}t.type="class",t.exports={constructor:function(e){var t=e?e:{},o={provider:function(){throw new Error("player 11.7.3: No provider!")},maxLength:30,onUpdate:function(){}};this.provider="undefined"!=typeof t.provider?t.provider:o.provider,this.maxLength="undefined"!=typeof t.maxLength?t.maxLength:o.maxLength,this.onUpdate="undefined"!=typeof t.onUpdate?t.onUpdate:o.onUpdate,this.initialItem=null,this.clear()},initialize:function(e){this.stack[0]=e,this.initialItem=e},clear:function(){this.stack=[this.initialItem],this.position=0,this.onUpdate()},save:function(){this.provider(function(e){r(this.stack,this.maxLength),this.position=Math.min(this.position,this.stack.length-1),this.stack=this.stack.slice(0,this.position+1),this.stack.push(e),this.position++,this.onUpdate()}.bind(this))},undo:function(e){if(this.canUndo()){var t=this.stack[--this.position];this.onUpdate(),e&&e(t)}},redo:function(e){if(this.canRedo()){var t=this.stack[++this.position];this.onUpdate(),e&&e(t)}},canUndo:function(){return this.position>0},canRedo:function(){return this.position<this.count()},count:function(){return this.stack.length-1}}},"class"),o.define("core.utils.class",function(e,t,o,n){"use strict";var r=function(e){if(n.isArray(e)){var t="^("+e.join("|")+")$";return new RegExp(t)}},i=function(e,t,o){var r;for(var i in t){if(r=t[i],o&&i in e&&o.test(i)){var s=e[i];r=n.isArray(s)?e[i].concat(r):n.extend(s,r)}e[i]=r}},s={extend:function(e,t,o){2===arguments.length?(o=t,t=e,e=function(){t.apply(this,arguments)}):e&&e!==Object||(e=function(){t.apply(this,arguments)});var n=function(){},s=n.prototype=t.prototype;e.prototype=new n,e.prototype.constructor=e,e.prototype.superClass=s,o=o||{};var a=r(o.__extendAttribute);return delete o.__extendAttribute,i(e.prototype,o,a),t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t),e},create:function(e,t){var r=e.constructor;delete e.constructor;var i=e["static"];if(delete e["static"],e.extend){var a=o(e.extend);delete e.extend,r=s.extend(r,a,e)}else r===Object&&(r=function(){Object.prototype.constructor.apply(this,arguments)}),r.prototype=e;return r.prototype.className=t,n.extend(r,i),r}};t.exports=s},""),o.define("core.utils.detector",function(t,o,n,r){"use strict";var i=n("core.utils.transform"),s=[0,0,0,0],a=function(e,t,o){for(var n=!1,r=e.getImageData(t,o,1,1),i=0;i<s.length;i++)if(r.data[i]!==s[i]){n=!0;break}return n},l=function(e,t){try{var o,n,r=t.pageX||(t.changedTouches?t.changedTouches[0].pageX:0),s=t.pageY||(t.changedTouches?t.changedTouches[0].pageY:0),l=e.getContext("2d");return o=i.getRotateDeg(e),n=i.getRotateXY(r,s,o,e),a(l,n.x,n.y)}catch(c){return console.error(c),!1}},c={canvas:!!e.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!e.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(o){return console.error(o),!1}}(),workers:!!e.Worker,fileapi:e.File&&e.FileReader&&e.FileList&&e.Blob,websocket:!!e.WebSocket,isEnvLoaded:function(){try{return"undefined"!=typeof isApp&&"undefined"!=typeof Bridge&&"undefined"!=typeof Bridge.callNative&&!!Bridge.callNative("com.nd.pad.icr.ui.IcrJsBridge","isEnvLoaded",{}).result}catch(e){return console.error(e),!1}},isPointInPath:function(e,t){return l(e,t)},isOnline:function(){var e=Object.create(null);if("undefined"!=typeof CoursePlayer&&CoursePlayer.pptInvokeMethod){var t=CoursePlayer.pptInvokeMethod("getOnlineStatus","{}");e=JSON.parse(t)}return!!e.online_status&&e.online_status}};o.exports=c},""),o.define("core.utils.dom",function(t,o,n,r){"use strict";var i=n("core.utils.log"),s=document.head||document.getElementsByTagName("head")[0]||document.documentElement,a="ontouchstart"in e,l=a?{down:"touchstart",up:"touchend",move:"touchmove"}:{down:"mousedown",up:"mouseup",move:"mousemove"};o.exports={createMouseEvent:function(t,o){var n=document.createEvent("MouseEvents"),r=t.changedTouches,i=r?r[0]:null;return a?n.initMouseEvent(o||t.type,!0,!0,e,0,i.screenX,i.screenY,i.clientX,i.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget):n.initMouseEvent(o||t.type,!0,!0,e,0,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget),n},addStyle:function(e){if(e){var t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),s.appendChild(t),t}},addScript:function(e){var t=r.Deferred(),o=document.createElement("script");return o.async=!0,o.src=e,o.onerror=function(){i.error("js script load failure:"+e),t.resolve()},o.onload=o.onreadystatechange=function(n,r){(r||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,o=null,r?(t.resolve(),i.error("js script loading is Abort:"+e)):t.resolve())},s.insertBefore(o,s.firstChild),t.promise()},addStyleContent:function(e){r("<style type='text/css'>"+e+"</style>").appendTo("head")},addScriptContent:function(e){var t=document.createElement("script");t.setAttribute("language","JavaScript"),t.text=e,s.appendChild(t)},getEventXY:function(e){return"touchedn"!==e.type?{x:e.pageX||e.touches&&e.touches.length>0&&e.touches[0].pageX||-1,y:e.pageY||e.touches&&e.touches.length>0&&e.touches[0].pageY||-1}:{x:e.pageX||e.changedTouches&&e.changedTouches.length>0&&e.changedTouches[0].pageX||-1,y:e.pageY||e.changedTouches&&e.changedTouches.length>0&&e.changedTouches[0].pageY||-1}},eventName:l}},""),o.define("core.utils.function",function(t,o,n,r){"use strict";var i=n("core.utils.log"),s={createDelegate:function(t,o,n,i,s){return function(){var a=o||arguments;n===!0&&(a=Array.prototype.slice.call(arguments,0),a=a.concat(o));try{return t.apply(i||e,a)}catch(l){if(console.error(l),r.isFunction(s))return s(l);throw l}}},defer:function(t,o,n,r,i){var a=s.createDelegate(o,n,r,i);return t>0?e.setTimeout(a,t):(a(),0)},createPromiseThen:function(e,t,o,n,i){return r.isFunction(e.reject)||(i=n,n=o,o=t,t=e,e=r.Deferred()),this.createDelegate(t,o,n,i,function(t){return e.reject(t),e.promise()})},execute:function(e,t,o,n){var s="",a={};if("string"==typeof t&&(s=t,t={},t[s]=o||[]),e)for(var l in t){var c=e[l];if(r.isFunction(c)){var u=t[l],d=r.isArray(u)?"apply":"call";a[l]=Function.prototype[d].call(c,e,u)}else n===!0&&i.error("not exist ["+l+"] function")}return s?a[s]:a},runSequence:function(t,o){var n,s=r.Deferred().resolve();return t.forEach(function(t,o){r.isFunction(t.fn)&&(s=s.then(function(){try{n=o;var s=t.args||arguments;return t.isAppendArgs===!0&&(s=Array.prototype.slice.call(arguments,0),s=s.concat(t.args)),i.log(t.name),t.fn.apply(t.scope||e,s)}catch(a){return console.error(a),r.Deferred(function(e){e.reject(a)})}},function(e){return e}))}),s.fail(function(e){i.error("run %s,the %d is wrong : %o",o||" task ",++n,e||""),i.error(e)})}};o.exports=s},""),o.define("core.utils.log",function(e,t,o,n){"use strict";var r=function(e){e.cause&&r(e.cause),a.error(e)},i="error",s=function(e,t){t===i&&console[t](e)},a={log:function(e){s("player 11.7.3: "+e,"log")},error:function(e,t){s(t,"error"),t&&r(t)}};t.exports=a},""),o.define("core.utils.raf",function(t,o,n,r){for(var i=e.requestAnimationFrame,s=e.cancelAnimationFrame,a=["webkit","moz"],l=0;l<a.length&&!e.requestAnimationFrame;++l){var c=a[l];i=e[c+"RequestAnimationFrame"],s=e[c+"CancelAnimationFrame"]||e[c+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(e.navigator.userAgent)||!e.requestAnimationFrame||!e.cancelAnimationFrame){var u=0;i=function(t){var o=Date.now(),n=Math.max(u+16,o);return e.setTimeout(function(){t(u=n)},n-o)},s=e.clearTimeout}o.exports={raf:i,caf:s}},""),o.define("core.utils.request",function(e,t,o,n){"use strict";var r=location.search,i={};r=r.substr(1,r.length);var s=r.split("&");s.forEach(function(e){var t=e.split("="),o=t[0];if(o){var n=decodeURIComponent(t[1]);i[o]=n}});var a=function(e){return i[e]||""};a.get=function(){return i},t.exports=a},""),o.define("core.utils.string",function(e,t,o,n){"use strict";var r=/\$\{(.+?)\}/g;t.exports={applyTemplate:function(e,t){return e.replace(r,function(e,o){return t[o]||e})},createReg:function(e){return e.length?new RegExp("^("+e.join("|")+")$"):/^$/}}},""),o.define("core.utils.throttle",function(e,t,o,n){"use strict";t.exports={throttle:function(e,t,o,n){var r,i,s,a=+new Date,l=0,c=0,u=null,d=function(){c=a,e.apply(i,s)};return function(){a=+new Date,i=this,s=arguments,r=a-(n?l:c)-t,clearTimeout(u),n?o?u=setTimeout(d,t):r>=0&&d():r>=0?d():o&&(u=setTimeout(d,-r)),l=a}},debounce:function(e,t,o){return this.throttle(e,t,o,!0)}}},""),o.define("core.utils.transform",function(e,t,o,n){"use strict";var r=function(e){var t=0,o=0;if(e.offsetParent){do t+=e.offsetLeft,o+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:o}}return{x:0,y:0}};t.exports={getRotateDeg:function(e){var t,o=n(e),r=o.css("-webkit-transform")||o.css("-moz-transform")||o.css("-ms-transform")||o.css("-o-transform")||o.css("transform");if("string"==typeof r&&"none"!==r&&""!==r){var i=r.split("(")[1].split(")")[0].split(","),s=i[0],a=i[1];t=(Math.atan2(a,s)*(180/Math.PI)).toFixed(3)}else t=0;return t},getRotateOriginXY:function(e){var t=n(e).css("transform-origin");return t?{x:parseFloat(t.split(" ")[0],10),y:parseFloat(t.split(" ")[1],10)}:{x:0,y:0}},getRotateXY:function(e,t,o,n){var i=r(n),s=this.getRotateOriginXY(n);e=e-parseInt(i.x)-s.x,t=t-parseInt(i.y)-s.y,o<0?o=360+o%360:o%=360;var a=e*Math.cos(o*Math.PI/180)+t*Math.sin(o*Math.PI/180),l=t*Math.cos(o*Math.PI/180)-e*Math.sin(o*Math.PI/180);return{x:a+s.x,y:l+s.y}}}},""),o.define("core.utils.url",function(e,t,o,n){"use strict";var r=/^.*?(?=[^\/]*(\?|$))/,i=/^(\w+:\/\/|\/)/;t.exports={getBase:function(e){return e?r.exec(e)[0]:""},isAbsolute:function(e){return i.test(e)},resolve:function(e,t){return 1===arguments.length&&(t=e,e=this.getBaseLocationUrl()),this.isAbsolute(t)?t:e+t},getBaseLocationUrl:function(){var e=this.getBase(location.href);return this.getBaseLocationUrl=function(){return e},this.getBaseLocationUrl()}}},""),o.define("core.utils.uuid",function(e,t,o,n){"use strict";var r="0123456789abcdefghijklmnopqrstuvwxyz";t.exports=function(e){for(var t=[],o=0;o<e;o++)t[o]=r.substr(Math.floor(36*Math.random()),1);return t.join("")}},""),o.define("core.utils.when",function(t,o,n,r){"use strict";o.type="class";var i=function(){0===this._count&&this._done.call(e,this._results)};o.exports={constructor:function(e,t){this._count=e,this._done=t,e?this._results=[]:i.call(this)},each:function(e){this._count--,this._results.push(e),i.call(this)}}},"class"),o.define("core.utils.xml",function(e,t,o,n){"use strict";t.exports={toJsonByAttr:function(e,t,o,r){return n.isPlainObject(e)||(r=o,o=t,t=e,e={}),t&&o.forEach(function(o){var i;if("string"==typeof o)i=o;else for(var s in o)i=s,o=o[s];var a=(n.isFunction(o)?o(t.getAttribute(i)||""):t.getAttribute(o))||"";n.isFunction(r)&&(a=r(a,i)),e[i]=a}),e}}},""),o.define("core.common.layout.events",function(e,t,o,n){t.exports={downEvents:["mousedown","touchstart"],moveEvents:["mousemove","touchmove"],upEvents:["mouseup","touchend"],clickEvents:["click"],pageLeaveEvents:["mouseleave"]}},""),o.define("core.common.layout.tool",function(e,t,o,n){var r=o("core.common.layout.events"),i=o("core.utils.request"),s=o("core.common.ispointinpath"),a=o("core.common.pptshellpaint"),l=o("core.common.Paint"),c=o("core.utils.string"),u='<div class="ic_paint"><div class="ic_tool_container tooldialog_skin_wood"><div class="com_tooldialog"><div class="com_tooldialog_student_mask"></div><div class="sideicon_wrap leftwrap scrollbar_style_gray" ><ul class="sideicon_list"></ul></div><div class="sideicon_wrap rightwrap scrollbar_style_gray" ><ul class="sideicon_list"></ul></div></div><div class="com_tooldialog_pop _icplayer_limit_tip" style="display:none;z-index:9999" onclick="$(this).hide()"><div class="com_tooldialog_pop_box"><div class="com_tooldialog_pop_main" ><p class="com_tooldialog_pop_txt">${Tool_PopLimit}</p></div><div class="com_tooldialog_pop_foot"><a class="com_tooldialog_pop_btn" href="javascript:;">${Tool_See}</a></div></div></div></div></div>',d='<li class="sideicon ${id} min" style="display: none"><img src="${icon}" alt="" /></li>',p=r.downEvents,f=r.moveEvents,h=r.upEvents,g=r.clickEvents,m=r.pageLeaveEvents,v=!1,y={up:6e3,down:3e3},_=function(e,t){var o=n(e.srcElement||e.target).closest(".sideicon"),r=o.data("toolRef");r?(t.fireTool(r),o.length&&(o.is(":hidden")||(r.show(),t.$toolTarget.find(".sideicon."+r.unqiueId).hide()))):"btn_tool tool_close"!==(e.srcElement||e.target).className&&t.$toolTarget.find(".tool_tip").hide()},P=function(){var e,t,o,r,i;return function(){var a=this;p.forEach(function(l){var c=function(l){var c=n.event.fix(l);if(v=!(c.type.indexOf("touch")>=0),_(c,a),""!==a.component.toolList.active){var u=a.component.toolList.list[a.component.toolList.active][0],d=s.adjust(a.component.toolList,c);if(a.component.toolList=d.toolList,t=c.pageX||c.originalEvent.touches[0].pageX,o=c.pageY||c.originalEvent.touches[0].pageY,d.allFlase)i=0,u&&u.fireEvent("blur",c);else{r=!0,i=0;var p=a.component.toolList.list[d.toolList.active][i];a.setToolZIndex(p),e=new Date,p.fireEvent("mousedown",c),""!==a.component.toolList.active&&(p.fireEvent("focus",c),u&&u.unqiueId!==p.unqiueId&&u.fireEvent("blur",c)),a.minTool(c,p);var f=n(c.srcElement||c.target).closest(".tool_small");f&&f.length&&!p.dialogModel.disabledMin&&a.$toolTarget.find(".sideicon."+p.unqiueId).show()}}return!0};a.$toolTarget[0].addEventListener?a.$toolTarget[0].addEventListener(l,c,!0):a.$toolTarget[0].attachEvent(l,c)}),f.forEach(function(e){var t=function(e){var t=a.component.toolList.list[a.component.toolList.active];return r&&t.length>=(i||0)+1&&t[i].fireEvent("mousemove",e),!0};a.$toolTarget[0].addEventListener?a.$toolTarget[0].addEventListener(e,t,!0):a.$toolTarget[0].attachEvent(e,t)}),g.forEach(function(e){var t=function(t){var o=a.component.toolList.list[a.component.toolList.active];return r&&o.length>=(i||0)+1&&o[i].fireEvent(e,t),!0};a.$toolTarget[0].addEventListener?a.$toolTarget[0].addEventListener(e,t,!0):a.$toolTarget[0].attachEvent(e,t)}),h.forEach(function(s){var l=function(s){var l=n.event.fix(s);r=!1,""!==a.component.toolList.active&&a.component.toolList.list[a.component.toolList.active].length>i&&a.component.toolList.list[a.component.toolList.active][i].fireEvent("mouseup",l);var c=new Date-e,u=Math.abs((void 0===l.pageX?l.originalEvent.changedTouches[0].pageX:l.pageX)-t),d=Math.abs((void 0===l.pageY?l.originalEvent.changedTouches[0].pageY:l.pageY)-o);return""!==a.component.toolList.active&&!v&&c<180&&u<3&&d<3&&a.component.toolList.list[a.component.toolList.active].length>i&&a.component.toolList.list[a.component.toolList.active][i].fireEvent("click",l),!0};a.$toolTarget[0].addEventListener?a.$toolTarget[0].addEventListener(s,l,!0):a.$toolTarget[0].attachEvent(s,l)}),m.forEach(function(e){var t=function(e){return r=!1,""!==a.component.toolList.active&&a.component.toolList.list[a.component.toolList.active].length>i&&a.component.toolList.list[a.component.toolList.active][i].fireEvent("mouseup",e),!1};a.$toolTarget[0].addEventListener?a.$toolTarget[0].addEventListener(e,t,!1):a.$toolTarget[0].attachEvent("onclick",t)});var l=function(e){return""!==a.component.toolList.active&&v&&a.component.toolList.list[a.component.toolList.active].length>i&&a.component.toolList.list[a.component.toolList.active][i].fireEvent("click",e),!0};a.$toolTarget[0].addEventListener?a.$toolTarget[0].addEventListener("click",l):a.$toolTarget[0].attachEvent("onclick",l)}}();t.exports={renderTool:function(){this.$toolTarget=n(c.applyTemplate(u,{Tool_PopLimit:this.component.getI18nModel().player.Tool_PopLimit,Tool_See:this.component.getI18nModel().player.Tool_See})),P.call(this),this.pageTarget.append(this.$toolTarget),this.$toolContainer=this.$toolTarget.find(".com_tooldialog"),this.$toolIconList=this.$toolContainer.find(".sideicon_list");var e;return e="pptshell"===i("sys")?new a(this.$toolTarget):new l(this.$toolTarget)},activeTool:function(e){e&&e.toolConfig&&"pageTool"===e.toolConfig.toolType&&this.$toolTarget?this.$toolTarget.removeClass("ic_paint_active"):this.$toolTarget&&this.$toolTarget.addClass("ic_paint_active")},addTool:function(e){var t=this;return e.render(this.$toolContainer).done(function(){if(e.toolConfig.independent!==!0){var o=n(c.applyTemplate(d,{icon:e.toolConfig.icon,id:e.unqiueId}));o.data("toolRef",e),t.$toolIconList.prepend(o)}})},setToolZIndex:function(e){var t=this,o=e.toolConfig.independent!==!0?"down":"up",n=y[o]+this.getZIndex();void 0!==e.zIndex&&t.isLargeZIndex(e)||(e.zIndex=n,e.getElement(!0).css("z-index",n))},isLargeZIndex:function(e){var t=this,o=e.zIndex,n=!1;if(void 0===t.component.toolList.list[t.component.toolList.active])return n;for(var r=0;r<t.component.toolList.list[t.component.toolList.active].length;r++){if(o<t.component.toolList.list[t.component.toolList.active][r].zIndex){n=!1;break}n=!0}return n},fireTool:function(e){var t=this,n=t.component.toolList.list[t.component.toolList.active][0],r=s.adjust(t.component.toolList,null,e,"FIRETOOL");t.component.toolList=r.toolList;var i=e;t.setToolZIndex(i),i.fireEvent("mousedown",event),""!==t.component.toolList.active&&(i.fireEvent("focus",event),i.fireEvent(o("core.eventbus.eventname").tool.maximize),n.unqiueId!==i.unqiueId&&n.fireEvent("blur",event))},minTool:function(e,t){var n=e.srcElement||e.target;if("btn_tool tool_small"===n.className){var r=this;r.component.toolList=s.swapTool(r.component.toolList,r.component.toolList.active,t),t.fireEvent(o("core.eventbus.eventname").tool.minimize)}}}},""),o.define("core.common.player.command",function(e,t,o,n){var r=o("core.utils.Log");t.exports={getCommands:function(e){return{gotoPageIndex:function(t,o){e.gotoPageIndex(t,o)},gotoPage:function(t,o){r.log("gotoPage:pageName"+t+":config:"+o),e.gotoPage(t,o)},gotoPageId:function(t,o){e.gotoPageId(t,o)},gotoPageIndexByNative:function(t){e.gotoPageIndex(t,{isCallback:!1,isFromCache:!0})},firstPage:function(){e.firstPage()},lastPage:function(){e.lastPage()},nextPage:function(){e.nextPage()},prevPage:function(){e.prevPage()},mediaPause:function(){e.mediaPause()},closeActivePage:function(){e.closeActivePage(),e.commonPages.forEach(function(e){e.fireEvent("PageLoaded")})},addExtendPage:function(t){e.addExtendPage(t)},closeExtendPage:function(){e.closeExtendPage(),e.commonPages.forEach(function(e){e.fireEvent("PageLoaded")})}}}}},""),o.define("core.common.player.controller",function(e,t,o,n){var r=o("core.common.runtime");t.exports={createController:function(){var e=this;return{getPlayerEvent:function(){return e._eventbus},registerFlow:function(){e.registerFlow.apply(e,arguments)},startFlow:function(){e.startFlow.apply(e,arguments)},eachPresenter:function(){e.eachPresenter.apply(e,arguments)},updateTool:function(){e.updateToolProperties.apply(e,arguments)},getPresentation:function(){return o("core.common.player.presentation").getPresentation(e)},getCurrentPageIndex:function(){return e.getCurrentPageIndex()},getRuntime:r.getRuntime,getPaint:function(){return e.getPaint()},clearTool:function(){e.clearTool()},removeTool:function(t,o){e.removeTool(t,o)},addTool:function(t,o,n){return e.addTool(t,o,n)},getPlayerEventBus:function(){return this._eventbus},getEventBus:function(){return o("core.common.player.eventbus").getEventBus(e)},getCommands:function(){return o("core.common.player.command").getCommands(e)},getState:function(){return o("core.common.player.state").getState(e)},getModule:function(t){return e.activePage.getModule(t)},getModulesByType:function(t){return e.activePage.getModulesByType(t)},getCommonsModule:function(t,o){var n=e.commonPages.getItems(t);return n.length?n[0].getModule(o):null},getToolbarModule:function(e){return this.getCommonsModule("toolbar",e)},getHeaderModule:function(e){return this.getCommonsModule("header",e)},getFooterModule:function(e){return this.getCommonsModule("footer",e)},getCurrentPageView:function(){return e.activePage.getElement()}}}}},""),o.define("core.common.player.eventbus",function(e,t,o,n){t.exports={getEventBus:function(e){return{sendEvent:function(t,o){e.activePage&&e.activePage.fireEvent(t,o),e.commonPages.forEach(function(e){e.fireEvent(t,o)}),e.toolList.all.forEach(function(e){e.fireEvent(t,o)})}}}}},""),o.define("core.common.player.gotopage",function(e,t,o,n){var r=o("core.utils.Log"),i=(o("core.common.playerConfig"),o("core.player.page"));t.exports={getCurrentPageIndex:function(){return this.currentPageIndex},closeActivePage:function(){if(this.activePage&&this.activePage.isEmpty!==!0){var e=this;this.mediaPause(),"extendPage"!=this.activePage.pageType?this.activePage&&this.state.addStates(this.activePage.getState()):this.activePage.hidePage&&this.activePage.hidePage.split(",").forEach(function(t){e.layout.switchCommonPage(t,!0)}),this.activePage.release(),this.activePage={isEmpty:!0,isReportable:function(){return!1},getModuleList:function(){return[]},getState:function(){return{}},release:function(){},getModule:function(){return{}},getModules:function(){return[]},fireEvent:function(){}}}},gotoPageIndex:function(e,t){if(r.log("gotoPageIndex:"+e+":config:"+t),e=parseInt(e,10),!isNaN(e)&&e>=0&&e<this.pages.length){this.closeActivePage();var o=this.pages.getByIndex(e);if(t=t||{},t.isCallback!==!1&&n.isFunction(this.beforeSwitchToPage)&&this.beforeSwitchToPage({index:e,id:o.id,params:{}})===!1)return!1;delete t.isCallback,this.state.loadFromString(t.state),delete t.state,o.gotoConfig=t,this.activePage=new i(o,this),this.currentPageIndex=e,this.layout.renderPage()}else r.error("invalid code ["+e+"]")},gotoPage:function(e,t){var o=this.pages.getIndexOfByName(e);this.gotoPageIndex(o,t)},gotoPageId:function(e,t){var o=this.pages.getIndexOfById(e);this.gotoPageIndex(o,t)},firstPage:function(){this.gotoPageIndex(0)},lastPage:function(){this.gotoPageIndex(this.pages.length-1)},nextPage:function(){this.gotoPageIndex(this.currentPageIndex+1)},prevPage:function(){this.gotoPageIndex(this.currentPageIndex-1)}}},""),o.define("core.common.player.presentation",function(e,t,o,n){t.exports={getPresentation:function(e){return{getPageCount:function(){return e.pages.length},getPage:function(t){var o=e.pages.getByIndex(t);return{getName:function(){return o.name},getId:function(){return o.id},getBaseURL:function(){return o.href},getModules:function(){return e.activePage.getModuleList()||[]},isReportable:function(){return e.activePage.isReportable()}}},getCurrentPage:function(){return e.activePage?{getName:function(){return e.activePage.name},getId:function(){return e.activePage.id},getBaseURl:function(){return e.activePage.href},isReportable:function(){return e.activePage.isReportable()}}:{}},getTableOfContents:function(){return{size:function(){return e.pages.length},get:function(t){var o=e.pages.getByIndex(t);return{getName:function(){return o.name},getId:function(){return o.id},getBaseURL:function(){return o.href},getPreview:function(){return o.preview}}}}}}}}},""),o.define("core.common.player.state",function(e,t,o,n){t.exports={getState:function(e){return{getCurrentPageState:function(){return JSON.stringify(e.activePage.getState())},getAllToolState:function(){var t,o={};return e.getToolList().all.forEach(function(e){t=e.getState(),t&&n.each(t,function(e,t){o[e]=t})}),JSON.stringify(o)},getPlayerState:function(){return e.state.getAsString()},savePageState:function(t){if(t){var o=e.commonPages.getItems(t);o.length&&e.state.writePageState(t,JSON.stringify(o[0].getState()))}else e.state.writePageState("page",this.getCurrentPageState()),e.state.writePageState("tool",this.getAllToolState())}}}}},""),o.define("core.common.tool.tool",function(e,t,o,n){"use strict";var r=function(e){var t=e.__sys;if(t){var o="100%"===e.width,n=t.hide&&t.hide.indexOf("header")>=0,r=t.hide&&t.hide.indexOf("toolbar")>=0,i="100%"===t.width,s=t.disabled.indexOf("min")>=0,a=t.disabled.indexOf("close")>=0,l=t.disabled.indexOf("move")>=0,c=t.disabled.indexOf("full")>=0,u=t.selfBorder;return{widthFull:o,hideHead:n,hideToolBar:r,hideSYSWidth:i,disabledMin:s,disabledClose:a,disabledMove:l,disabledFull:c,selfBorder:u}}return{}};t.exports={getToolKey:function(e,t){try{if(t&&t.toolKey)return t.toolKey;var o=e.split("/")[e.split("/").length-2],n=o.indexOf(".")>=0?e.split("/")[e.split("/").length-3]:o;return n||e}catch(r){return e}},getPositionIndex:function(e){for(var t=0;t<e.length;t++)if(!e[t].used)return t;return 0},updatePositionUsed:function(e,t,o){t>=0&&(e[t].used=!0,e[t].unqiueId=o)},delPositionUnqiueId:function(e,t){for(var o=0;o<e.length;o++)e[o].unqiueId===t&&(void 0===e[o].unqiueId,e[o].used=!1)},getToolNameI18n:function(e,t){var o=t,n=icCreatePlayer.lang;"zh"===n&&(n="zh_CN");for(var r=n.split("_")[0],i=e.length-1;i>=0;i--)if(e[i].toolKey===t){o=e[i].i18n[n]||e[i].i18n[r]||e[i].i18n.zh_CN;break}return o},getDialogModel:function(e){var t=r(e);return!t.widthFull&&!t.hideToolBar||t.hideHead?t.hideHead&&t.hideToolBar?t.__type="pre":t.hideSYSWidth?t.__type="mobile":t.__type="pc":t.__type="stu",t},isOverMaxLimit:function(e,t){var o,n=!1;if(t)return o=e.toolList.list[t]||[],o.length>=e.TOOL.DATA[t].MAXLIMIT;t=["top","bottom"];for(var r=0;r<t.length&&(o=e.toolList.list[t[r]]||[],!(n=o.length>=e.TOOL.DATA[t[r]].MAXLIMIT));r++);return n}}},""),o.define("core.common.tool.toolapi",function(e,t,o,n){var r=o("core.player.Tool"),i=o("core.utils.log"),s=o("core.utils.string"),a=o("core.utils.url"),l=o("core.common.i18nLoader"),c=o("core.common.createModel"),u=o("core.common.refPathBuilder"),d=o("core.common.tool.toolpush"),i=o("core.utils.log"),p=o("core.common.tool.tool"),f={updateToolProperties:function(e,t){var o=this;if(o.toolList&&o.toolList.all&&o.i18nModel&&o.i18nModel.tool&&e&&t){var i=null,l="";o.toolList.all.forEach(function(t){t.toolKey===e&&(i=t.element)}),n.each(o.i18nModel.tool,function(e,o){o.toolKey==t&&(l=icCreatePlayer.ref_path_tool+"/"+o.url)}),l=s.applyTemplate(l,o.refPath),l=a.resolve(l);var u=new r({url:l,key:t,options:{__sys:{disabled:[],hide:[]}}},o);u.load().done(function(e){c(e.model.getValue().properties,e.baseUrl,u.getRefPathParser()).then(function(e){i&&(i.find(".tooldialog_head span img").attr("src",e.smallIcon),i.find(".tooldialog_head em.title").text(p.getToolNameI18n(o.i18nModel.tool,t)),e.push?i.find("._icplayer_push_button").css("display","block"):i.find("._icplayer_push_button").css("display","none"))})})}},addTool:function(e,t,c,d){var f=this;return f.waitI18nLoadDF&&f.waitToolAddDF&&"pending"===f.waitI18nLoadDF.promise().state()&&"pending"===f.waitToolAddDF.promise().state()?(i.error("you click too fast"),f.waitToolAddDF.promise()):(f.waitToolAddDF=n.Deferred(),f.waitI18nLoadDF=n.Deferred(),f.renderPromise.then(function(){f.toolPaint=f.layout.renderTool(),l.loadPlayer().done(function(e){f.i18nModel.tool=e,f.waitI18nLoadDF.resolve()}).fail(function(){f.waitI18nLoadDF.resolve()})}),f.waitI18nLoadDF.then(function(){f.addTool=function(e,t,l,c){return f.layout.activeTool(),f.waitI18nLoadDF.promise().then(function(){var c=p.getToolKey(e,t);e&&f.i18nModel&&f.i18nModel.tool&&0!==e.indexOf("file:")&&0!==e.indexOf("http:")&&0!==e.indexOf("https:")&&n.each(f.i18nModel.tool,function(o,r){r.toolKey==c&&(e=icCreatePlayer.ref_path_tool+"/"+r.url,void 0===t.__option&&(t.__option={}),t.__option=n.extend({},r.option,t.__option))}),e=s.applyTemplate(e,f.refPath),e=a.resolve(e),u.set(f,"tool",e);var d=n.Deferred();if("pending"===r.toolLoadState[c])return i.error("you click too fast"),d.promise();"done"!==r.toolLoadState[c]&&(r.toolLoadState[c]="pending"),t=n.extend(!0,{__sys:{syncId:"",hide:[""],disabled:[""]}},t);var h=r.getTool(e,t,f.toolList.all),g=f.toolList.active;if(h){try{f.layout.setToolZIndex(h),g&&h!=f.toolList.list[g][0]?f.toolList.list[g][0].fireEvent("blur",{}):f.layout.activeTool();var m="",v=-1;n.each(f.toolList.list,function(e,t){n.each(t,function(t,o){o==h&&(m=e,v=t)})}),m&&v!=-1&&(f.toolList.list[m]=o("core.common.ispointinpath").swapItems(f.toolList.list[m],v,"first"))}catch(y){console.error(y)}d.resolve(h)}else{var _={url:e,key:e,listeners:{destroy:function(){f.removeTool(this.unqiueId)}},options:t};l&&(_.state=l);var P=new r(_,f);f.layout.addTool(P,t).done(function(e){
try{g?f.toolList.list[g][0].fireEvent("blur",{}):f.layout.activeTool(e)}catch(t){console.error(t)}f.toolList.all.push(e);var n=e.toolConfig.independent===!0?"top":"bottom";f.toolList.active=n;f.toolList.list[n];f.toolList.list[n].unshift(e),e.options.__sys.NONEventFlag||f.fireEvent(o("core.eventbus.eventname").tool.finish,e),d.resolve(e)}).fail(function(){d.reject()})}return d.promise()})},f.addTool(e,t,c,d).then(function(e){f.waitToolAddDF.resolve(e)}).fail(function(){f.waitToolAddDF.reject()})}),f.waitToolAddDF.promise())},getToolList:function(){return this.toolList},isMaxToolCount:function(e){return o("core.common.tool").isOverMaxLimit(this,e)},clearTool:function(){for(var e=this;e.toolList.all.length;)e.toolList.all[0].release();e.toolList.active="",e.toolList.list={top:[],bottom:[]},r.toolLoadState={}},removeTool:function(e,t,o){var n,i=this,s="",a="";i.toolList.all=i.toolList.all.filter(function(t){return t.unqiueId!==e&&t.toolKey!==e||(s=t.toolKey,n=t,a=t.toolConfig.independent===!0?"top":"bottom",!1)}),""!==a&&(i.toolList.list[a]=i.toolList.list[a].filter(function(t){return!(t.unqiueId===e||t.toolKey===e)})),r.removeTool(s),n&&"player"===t&&n.getController().getCommands().closeTool(o),this.toolList.all.length||(i.toolList.active="",this.layout.activePage(),r.bridgeClose())},setPushDomEnable:function(e){var t=this.player||this;t.fireEvent(o("core.eventbus.eventname").play.push_status,{status:e}),e?d.setEnable():d.setDisable()},player:{}};t.exports={create:function(e){return f.player=e,f}}},""),o.define("core.common.tool.tooldialog",function(t,o,n,r){var i,s,a={},l=!1,c=n("core.eventbus.eventname"),u=n("core.utils.throttle"),d=n("core.utils.dom");o.exports={initEvent:function(e){var t=this;t.addEventListener("mousedown",{fn:function(){l=!("pc"!==e.__type||"pc"==e.__type&&e.disabledMove);var o=d.getEventXY(event),n=t.element.position();i=n.left-o.x,s=n.top-o.y,a.minLeft=0-t.element.width()+t.top.TOOL.DATA.DIALOG.STEPLEFT,a.maxLeft=t.top.getElement(!0).width()-t.top.TOOL.DATA.DIALOG.STEPLEFT,a.minTop=0,a.maxTop=t.top.getElement(!0).height()-t.top.TOOL.DATA.DIALOG.STEPTOP},selector:[".tooldialog_head",".btn_tool.tool_full"]}),t.addEventListener("mousedown",{fn:function(){var o=t.container.find(".tooldialog_control."+t.unqiueId);if("pc"!=e.__type||e.disabledFull){if("pc"==e.__type&&e.no_full){var n=o.find("._icplayer_fullscreen_tip");n.removeClass("hide_dom"),t.deTip(n)}}else{var i=o.find(".btn_tool.tool_full"),s=o.find("._icplayer_tool_fullscreen"),a=s.hasClass("exit_fullscreen"),l=icCreatePlayer.utils.getFontSize();if(a?(e.disabledMove=!1,i.removeClass("click_disabled"),s.removeClass("exit_fullscreen").addClass("to_fullscreen"),o.css("font-size",""),o.removeClass("go_to_fullscreen")):(e.disabledMove=!0,i.addClass("click_disabled"),s.addClass("exit_fullscreen").removeClass("to_fullscreen"),o.css("font-size",l+"px"),o.addClass("go_to_fullscreen")),t.mainModule&&t.mainModule.presenter&&t.mainModule.presenter.__interface){var c=t.mainModule.presenter.__interface.resizeScreen;r.isFunction(c)&&c({ratio:a?icCreatePlayer.fontSize/l*3/4:l/icCreatePlayer.fontSize*4/3})}}},selector:"._icplayer_tool_fullscreen"}),t.deTip=u.debounce(function(e){e.addClass("hide_dom"),console.log("hide")},2e3,!0),t.addEventListener("mousedown",{fn:function(){if(!e.disabledMin){t.element.hide();var o=t.container.find(".sideicon."+t.unqiueId);t.top.TOOL.DATA.CURRENTPUSHTOOL===t.unqiueId?o.addClass("on"):o.removeClass("on")}},selector:".btn_tool.tool_small"}),t.addEventListener("mousedown",{fn:function(){e.disabledClose||(t.top.TOOL.DATA.PUSHING&&t.top.TOOL.DATA.CURRENTPUSHTOOL===t.unqiueId?(t.element.find(".tool_tip").removeClass("tool_tip_small"),t.element.find(".tool_tip").find("#tip_next_push").show()):(t.element.find(".tool_tip").addClass("tool_tip_small"),t.element.find(".tool_tip").find("#tip_next_push").hide()),t.element.find(".tool_tip").hide(),r(event.srcElement||event.target).next(".tool_tip").show())},selector:".btn_tool.tool_close"}),t.addEventListener("mousedown",{fn:function(){event.stopPropagation(),event.preventDefault(),t.element.find(".tool_tip").hide();var e=r(event.srcElement||event.target);e.find(".btn_text").text()!==t.top.getI18nModel().player.Tool_Sure&&e.text()!==t.top.getI18nModel().player.Tool_Sure||(t.container.find(".sideicon."+t.unqiueId).remove(),t.top.TOOL.DATA.PUSHING&&t.top.TOOL.DATA.CURRENTPUSHTOOL===t.unqiueId&&t.stopPush(),t.release())},selector:".tool_tip_wrap"}),t.addEventListener("mousedown",{fn:function(){if(event.stopPropagation(),"mousedown"==event.type){var e=r(event.srcElement||event.target);!e.hasClass("_icplayer_push_button")&&!e.parent().parent().parent().hasClass("_icplayer_push_button")||t.top.TOOL.DATA.PUSHING?(e.hasClass("on")&&e.hasClass("_icplayer_push_button")||e.parent().parent().parent().hasClass("on")&&e.parent().parent().parent().hasClass("_icplayer_push_button"))&&t.top.TOOL.DATA.PUSHING&&t.top.TOOL.DATA.CURRENTPUSHTOOL===t.unqiueId&&t.stopPush():t.push()}},selector:".btn_tool.tool_push"}),t.addEventListener(c.tool.push_action,{fn:function(e,o){if(o){var n=t.mainModule.getPresenter()&&t.mainModule.getPresenter().__model?t.mainModule.getPresenter().__model.$.unqiueId:0;"push"==o.action?t.top.TOOL.DATA.PUSHING||o.toolKey!=t.toolKey||o.uniqueId!=n||t.push():"stop_push"==o.action&&t.top.TOOL.DATA.PUSHING&&o.toolKey==t.toolKey&&o.uniqueId==n&&t.stopPush()}}}),t.addEventListener(c.tool.forbide_full,{fn:function(o,n){if("pc"==e.__type&&n&&n.id&&n.id===t.toolKey+"@"+t.id){var r=t.container.find(".tooldialog_control."+t.unqiueId),i=r.find("._icplayer_tool_fullscreen");e.disabledFull=n.isForbide===!0,n.isForbide?i.addClass("click_disabled"):i.removeClass("click_disabled")}}}),t.addEventListener("mousedown",{fn:function(){var e=event.srcElement||event.target;"btn_tool tool_close"!==e.className&&t.element.find(".tool_tip").hide()}}),t.addEventListener("mousemove",{fn:function(){if(l){var e=d.getEventXY(event),o=e.x+i,n=e.y+s;o>a.minLeft&&o<a.maxLeft&&n>a.minTop&&n<a.maxTop&&t.element.css({left:o,top:n})}}}),t.addEventListener("mouseup",function(){l=!1})},setDisplayMode:function(t,o,n){var r=this,i=r.element.parent(),s=(n||r.element).find(".sidetool"),a=(n||r.element).find(".tooldialog_head");switch(r.element.removeClass("com_tooldialog_student"),r.element.removeClass("com_tooldialog_board"),i.removeClass("tool_to_edit"),i.removeClass("tool_to_phone"),i.removeClass("tool_outline"),s.find(".tool_small").removeClass("click_disabled"),s.find(".tool_close").removeClass("click_disabled"),s.find(".tool_full").removeClass("click_disabled"),a.css("display",""),t.__type){case"stu":r.element.addClass("com_tooldialog_student"),r.toolConfig&&r.toolConfig.autoFull&&a.css("display","none");break;case"pre":r.element.addClass("com_tooldialog_student"),i.addClass("tool_to_edit");break;case"mobile":r.element.addClass("com_tooldialog_board"),i.addClass("tool_to_phone");break;case"pc":r.top.container.css("font-size",(e.screen.width<1280?16:icCreatePlayer.fontSize)+"px"),e.screen.width<1280&&(icCreatePlayer.fontSize=16),r.element.addClass("com_tooldialog_board")}t.selfBorder&&i.addClass("tool_outline"),t.disabledMin&&s.find(".tool_small").addClass("click_disabled"),t.disabledClose&&s.find(".tool_close").addClass("click_disabled"),t.disabledMove&&s.find(".tool_full").addClass("click_disabled"),t.disabledFull&&s.find("._icplayer_tool_fullscreen").addClass("click_disabled"),o&&("pc"!==t.__type?(r.preLeft=r.element.css("left"),r.preTop=r.element.css("top"),r.element.css({left:0,top:0,width:"100%",height:"100%"})):(r.preLeft&&r.preTop&&r.element.css({left:r.preLeft,top:r.preTop}),r.element.css({width:"",height:""})))}}},""),o.define("core.common.tool.toolpush",function(e,t,o,n){var r=o("core.eventbus.eventname"),i=o("core.utils.detector"),s=o("core.common.tool.tooldialog"),a=o("core.utils.Log");t.exports={push:function(){var e=this,t=o("core.common.timer"),l=".btn_tool.tool_push",c=".tool_wrap_mask",u=e.mainModule.getPresenter()&&e.mainModule.getPresenter().__model?e.mainModule.getPresenter().__model.$.unqiueId:0;e.element.find(c).removeClass("hide_dom"),e.element.find(l).addClass("tool_push_ing"),e.top.startFlow("exerciseStart",{scope:["tool","common"],sourcePresenterUnqiueId:u},function(){e.top.TOOL.DATA.PUSHING=!0,e.top.TOOL.DATA.CURRENTPUSHTOOL=e.unqiueId,e.switchToolContainerBG(!0),n(l).removeClass("on").removeClass("tool_push_ing").addClass("click_disabled"),e.element.find(c).addClass("hide_dom"),e.element.find(l).addClass("on"),i.isOnline()&&e.element.find(l).removeClass("click_disabled"),t.start(e),e.fireEvent(r.tool.push_data,{toolKey:e.toolKey,uniqueId:u,action:"push",result:"success"}),e.toolConfig&&e.toolConfig.autoFull&&(s.setDisplayMode.apply(e,[{__type:"stu"},!0]),e.fireEvent(r.tool.adjust_layout,{toolKey:e.toolKey,uniqueId:u}))},function(){a.error("push fail"),n(l).removeClass("on").removeClass("tool_push_ing"),i.isOnline()&&n(l).removeClass("click_disabled"),e.element.find(c).addClass("hide_dom"),e.fireEvent(r.tool.push_data,{toolKey:e.toolKey,uniqueId:u,action:"push",result:"fail"})})},stopPush:function(){var e=this,t=o("core.common.timer"),i=".btn_tool.tool_push",a=".tool_wrap_mask";e.element.find(a).removeClass("hide_dom");var l=e.mainModule.getPresenter()&&e.mainModule.getPresenter().__model?e.mainModule.getPresenter().__model.$.unqiueId:0;e.top.startFlow("exerciseExit",{scope:["tool","common"],sourcePresenterUnqiueId:l},function(){e.fireEvent(r.tool.push_data,{toolKey:e.toolKey,uniqueId:l,action:"stop_push",result:"success"}),e.toolConfig&&e.toolConfig.autoFull&&(s.setDisplayMode.apply(e,[{__type:"pc"},!0]),e.fireEvent(r.tool.adjust_layout,{toolKey:e.toolKey,uniqueId:l})),setTimeout(function(){e.element.find(a).addClass("hide_dom")},1e3)},function(){e.fireEvent(r.tool.push_data,{toolKey:e.toolKey,uniqueId:l,action:"stop_push",result:"success"})}),e.top.TOOL.DATA.PUSHING=!1,e.top.TOOL.DATA.CURRENTPUSHTOOL=void 0,e.switchToolContainerBG(!1),t.reset(e),setTimeout(function(){e.element.find(a).addClass("hide_dom")},1e3),n(i).removeClass("on").removeClass("click_disabled")},setEnable:function(){n(".ic_tool_container").find("._icplayer_push_button").removeClass("click_disabled")},setDisable:function(){n(".ic_tool_container").find("._icplayer_push_button").addClass("click_disabled")},pushDomStatus:function(){var e=this;return!(e.top.TOOL.DATA.PUSHING||!i.isOnline())}}},""),o.define("core.model.parser.mainxmlparser",function(e,t,o,n){"use strict";var r=o("core.utils.xml"),i=o("core.model.mainModel");t.exports={parse:function(e){var t,o=n(n.parseXML(e)),s=new i,a=s.getAttribute("commons"),l=0;return o.find("page").each(function(e,o){var n=r.toJsonByAttr(o,["id","name","href","preview"]);if(n.id=n.id||"page_"+l,t=o.parentNode.tagName.toLowerCase(),"folder"===t)n.name&&a.addItem(n.name,n);else{if("coursewareobject"===t){var i=o.parentNode.getAttribute("rootPath");n.href=i+n.href}s.addPage(n)}l++}),o.find("style").each(function(e,t){s.setAttribute("css",t.getAttribute("href")),s.setAttribute("style",n(t).text())}),s}}},""),o.define("core.model.parser.moduleparse",function(e,t,o,n){"use strict";var r=o("core.model.ModuleModel"),i=o("core.utils.xml"),s=o("core.model.parser.propertiesParse"),a=o("core.layout.Layout"),l={style:function(e,t){e.setAttribute("css",n(t).attr("href"));var o=n(t).text();o&&e.setAttribute("style",o)},events:function(e,t){n(t).children("event").each(function(t,o){var r=n(o),s=r.attr("name");if(s){var a=[];r.children("handler").each(function(e,t){a.push(i.toJsonByAttr(t,[{id:"targetId"},{name:"handlerName"}]))}),a.length&&e.addEvent(s,a)}})},properties:s};t.exports=function(e,t){var o=0;n(t).children("module,addonModule").each(function(t,s){var c=new r,u=i.toJsonByAttr(s,["addonId","moduleId","presenterId","id","isVisible","isLocked","style",{"lazy-init":function(e){return"true"===e.toLowerCase()}}]);!u.presenterId&&u.addonId&&(u.presenterId=u.addonId),u.id=u.id||"module_"+o;var d=i.toJsonByAttr(s,a.attrName);c.setAttributes(u),c.setAttribute("layout",d),n(s).children().each(function(e,t){var o=l[t.tagName];n.isFunction(o)&&o(c,t)}),e.addModule(c),o++})}},""),o.define("core.model.parser.pagexmlparser",function(e,t,o,n){"use strict";var r=o("core.model.pageModel"),i=o("core.model.parser.moduleParse"),s=o("core.utils.xml"),a=o("core.layout.Layout"),l=o("core.model.parser.presenterDecalareParse"),c={modules:i,addons:l,presenters:l};t.exports={parse:function(e){var t=n.parseXML(e),o=new r,i=t.documentElement,l=s.toJsonByAttr(i,a.attrName);o.setAttribute("layout",l);var u=n(t).find("page");return u.children().each(function(e,t){var n=c[t.tagName];n&&n(o,t)}),o}}},""),o.define("core.model.parser.presenterdecalareparse",function(e,t,o,n){"use strict";var r={presenter:"id","addon-descriptor":"addonId"};t.exports=function(e,t){n(t).children("presenter,addon-descriptor").each(function(t,o){var n=o.getAttribute("href");n&&e.addPresenter(o.getAttribute(r[o.tagName]),n)})}},""),o.define("core.model.parser.presenterxmlparser",function(e,t,o,n){"use strict";var r=o("core.model.PresenterModel"),i=o("core.utils.xml"),s={jsDependency:function(e,t){n(e).children("javascript").each(function(e,o){var n=i.toJsonByAttr(o,["name","version"]);t.push(n)})},moduleDependency:function(e,t){n(e).children("module").each(function(e,o){var n=i.toJsonByAttr(o,["addonId","href"]);t[n.addonId]=n})}},a={presenter:"script"};e.parse=function(e){var t=new r,o=n(n.parseXML(e));return o.find("dependencies").children().each(function(e,o){var r=s[o.tagName];n.isFunction(r)&&r(o,t.getAttribute(o.tagName))}),o.children("presenter,addon").children("css,view,script,presenter").each(function(e,o){var r=o.tagName;r in a&&(r=a[r]),t.setAttribute(r,n.trim(n(o).text()))}),t}},""),o.define("core.model.parser.propertiesparse",function(e,t,o,n){"use strict";var r=o("core.utils.xml"),i=function(e,t){n(e).children("property").each(function(e,o){var s;if("list"===o.getAttribute("type"))s=r.toJsonByAttr(o,["name","type"]),s.value=[],n(o).find("items>item").each(function(e,t){var o=[];i(t,function(e){o.push(e)}),s.value.push(o)});else{s=r.toJsonByAttr(o,["name","type","value"]);var a=n.trim(n(o).text());a&&(s.text=a)}t(s)})};t.exports=function(e,t){i(t,function(t){e.addProperty(t)})}},""),o.define("core.model.parser.simplejsonparser",function(e,t,o,n){"use strict";e.parse=function(e){return JSON.parse(e)}},""),o.define("core.model.parser.toolparser",function(e,t,o,n){"use strict";var r=o("core.model.parser.moduleParse"),i=o("core.model.parser.propertiesParse"),s=o("core.model.parser.presenterDecalareParse"),a=o("core.model.ToolModel"),l=o("core.utils.xml"),c=o("core.layout.Layout"),u={presenters:s,properties:i,modules:r};t.exports={parse:function(e){var t=new a,o=n.parseXML(e),r=n(o).children("tool"),i=l.toJsonByAttr(r[0],c.attrName);return t.setAttribute("layout",i),r.children().each(function(e,o){var n=o.tagName,r=u[n];r&&r(t,o),"modules"===n&&t.setAttribute("mainModule",o.getAttribute("main")||"main")}),t}}},""),o.define("core.model.proxy.ajaxproxy",function(e,t,o,n){"use strict";e.getData=function(e,t){return n.ajax({url:e,cache:t!==!1,dataType:"text"})}},""),o.define("core.locations.en.lang",function(e,t,o,n){t.exports={Tool_ToolName:"Tool Name",Tool_Sure:"Confirm",Tool_Push:"Send",Tool_Pushing:"Sending",Tool_Finish:"End",Tool_Pushed_Tip:"The tool has already been sent to student(s). It will close for student(s) if you close now",Tool_Tip:"Close?",Tool_Cancel:"Cancel",Tool_PopLimit:"You have already opened <span id='maxlimit'></span> <span id='classtool'></span>.<br/>Please close 1 before you open another.",Tool_See:"Got It",Tool_bottom:"class tools",Tool_top:"common tools",Tool_full:"This function is coming soon.",Tool_Not_Support:"Sorry，this tool does not support Windows XP, please experience in Windows 7 and above."}},""),o.define("core.locations.en_us.lang",function(e,t,o,n){t.exports={Tool_ToolName:"Tool Name",Tool_Sure:"Confirm",Tool_Push:"Send",Tool_Pushing:"Sending",Tool_Finish:"End",Tool_Pushed_Tip:"The tool has already been sent to student(s). It will close for student(s) if you close now",Tool_Tip:"Close?",Tool_Cancel:"Cancel",Tool_PopLimit:"You have already opened <span id='maxlimit'></span> <span id='classtool'></span>.<br/>Please close 1 before you open another.",Tool_See:"Got It",Tool_bottom:"class tools",Tool_top:"common tools",Tool_full:"This function is coming soon.",Tool_Not_Support:"Sorry，this tool does not support Windows XP, please experience in Windows 7 and above."}},""),o.define("core.locations.ja.lang",function(e,t,o,n){t.exports={Tool_ToolName:"工具名称",Tool_Sure:"OK",Tool_Push:"送信",Tool_Pushing:"送信中",Tool_Finish:"終了",Tool_Pushed_Tip:"ツールは生徒端末に送信されました。今閉じると生徒端末の使用が終了となりますが。",Tool_Tip:"ツールを閉じますか？",Tool_Cancel:"キャンセル",Tool_PopLimit:"既に<span id='maxlimit'></span>つの<span id='classtool'></span>が開かれました，<br/>新たなツールを開く前に、開かれたツールを閉じてください。",Tool_See:"了解です...",Tool_bottom:"教科ツール",Tool_top:"一般ツール",Tool_full:"機能開発中、乞うご期待!"}},""),o.define("core.locations.ja_jp.lang",function(e,t,o,n){t.exports={Tool_ToolName:"工具名称",Tool_Sure:"OK",Tool_Push:"送信",Tool_Pushing:"送信中",Tool_Finish:"終了",Tool_Pushed_Tip:"ツールは生徒端末に送信されました。今閉じると生徒端末の使用が終了となりますが。",Tool_Tip:"ツールを閉じますか？",Tool_Cancel:"キャンセル",Tool_PopLimit:"既に<span id='maxlimit'></span>つの<span id='classtool'></span>が開かれました，<br/>新たなツールを開く前に、開かれたツールを閉じてください。",Tool_See:"了解です...",Tool_bottom:"教科ツール",Tool_top:"一般ツール",Tool_full:"機能開発中、乞うご期待!"}},""),o.define("core.locations.zh.lang",function(e,t,o,n){t.exports={Tool_ToolName:"工具名称",Tool_Sure:"确定",Tool_Push:"推送",Tool_Pushing:"推送中",Tool_Finish:"结束",Tool_Pushed_Tip:"工具已推送至学生端，此时关闭将同时结束学生端使用。",Tool_Tip:"确认关闭当前工具吗？",Tool_Cancel:"取消",Tool_PopLimit:"老师，已经打开<span id='maxlimit'></span>个<span id='classtool'></span>，<br/>请先关闭已有的工具，再新开工具。",Tool_See:"知道了...",Tool_bottom:"课时工具",Tool_top:"常用工具",Tool_full:"该功能程序哥哥正在加班加点的开发中哦，<br>敬请期待！",Tool_Not_Support:"抱歉，该工具不支持XP系统，请在win7及以上的操作系统中体验。"}},""),o.define("core.locations.zh_cn.lang",function(e,t,o,n){t.exports={Tool_ToolName:"工具名称",Tool_Sure:"确定",Tool_Push:"推送",Tool_Pushing:"推送中",Tool_Finish:"结束",Tool_Pushed_Tip:"工具已推送至学生端，此时关闭将同时结束学生端使用。",Tool_Tip:"确认关闭当前工具吗？",Tool_Cancel:"取消",Tool_PopLimit:"老师，已经打开<span id='maxlimit'></span>个<span id='classtool'></span>，<br/>请先关闭已有的工具，再新开工具。",Tool_See:"知道了...",Tool_bottom:"课时工具",Tool_top:"常用工具",Tool_full:"该功能程序哥哥正在加班加点的开发中哦，<br>敬请期待！",Tool_Not_Support:"抱歉，该工具不支持XP系统，请在win7及以上的操作系统中体验。"}},""),o.define("core.locations.zh_hk.lang",function(e,t,o,n){t.exports={Tool_ToolName:"工具名稱",Tool_Sure:"確定",Tool_Push:"推送",Tool_Pushing:"推送中",Tool_Finish:"結束",Tool_Pushed_Tip:"工具已推送至學生端，此時關閉將同時結束學生端使用。",Tool_Tip:"確認關閉當前工具嗎？",Tool_Cancel:"取消",Tool_PopLimit:"老師，已經打開<span id='maxlimit'></span>個<span id='classtool'></span>，<br/>請先關閉已有的工具，再新開工具。",Tool_See:"知道了...",Tool_bottom:"課時工具",Tool_top:"常用工具",Tool_full:"該功能程序哥哥正在加班加點的開發中哦，<br>敬請期待！",Tool_Not_Support:"抱歉，該工具不支持XP系統，請在win7及以上的操作系統中體驗。"}},""),o.define("core.utils.drawingboard.board",function(t,o,n,r){"use strict";var i=n("core.utils.drawingboard.utils"),s=n("core.utils.baseundo"),a=n("core.utils.drawingboard.microevent"),l=n("core.utils.uuid"),c=function(e,t){if(this.opts=this.mergeOptions(t),this.ev=new a,r.data(e,"id",l(8)),this.$el=e,!this.$el.length)return!1;var o='<div class="ic_page_tool_drawing-board-canvas-wrapper"><canvas class="ic_page_tool_drawing-board-canvas"></canvas><div class="ic_page_tool_drawing-board-cursor ic_page_tool_drawing-board-utils-hidden"></div></div>';return this.$el.addClass("ic_page_tool_drawing-board").append(o),this.dom={$canvasWrapper:this.$el.find(".ic_page_tool_drawing-board-canvas-wrapper"),$canvas:this.$el.find(".ic_page_tool_drawing-board-canvas"),$cursor:this.$el.find(".ic_page_tool_drawing-board-cursor"),$controls:this.$el.find(".ic_page_tool_drawing-board-controls")},r.each(["left","right","center"],r.proxy(function(e,t){if(this.opts.controlsPosition.indexOf(t)>-1)return this.dom.$controls.attr("data-align",t),!1},this)),this.canvas=this.dom.$canvas.get(0),this.ctx=this.canvas&&this.canvas.getContext&&this.canvas.getContext("2d")?this.canvas.getContext("2d"):null,this.color=this.opts.color,this.ctx?(this.storage=this._getStorage(),this.initHistory(),this.reset({webStorage:!1,history:!1,background:!1}),this.resize(),this.reset({webStorage:!1,history:!1,background:!0}),this.restoreWebStorage(),void this.initDropEvents()):(this.opts.errorMessage&&this.$el.html(this.opts.errorMessage),!1)};c.defaultOpts={controls:["Color","DrawingMode","Size","Navigation"],controlsPosition:"top left",color:"#000000",size:1,background:!1,eraserColor:"background",fillTolerance:100,fillHack:!0,webStorage:"session",droppable:!1,enlargeYourContainer:!1,errorMessage:'<p>Your Broswer version is too older. <a href="http://browsehappy.com/" target="_blank">please update the browser to the latest.</a></p>',stretchImg:!1},c.prototype={mergeOptions:function(e){return e=r.extend({},c.defaultOpts,e),e.background||"background"!==e.eraserColor||(e.eraserColor="transparent"),e},reset:function(e){e=r.extend({color:this.opts.color,size:this.opts.size,webStorage:!0,history:!0,background:!1},e),this.setMode("pencil"),e.background&&this.resetBackground(this.opts.background,r.proxy(function(){e.history&&this.saveHistory()},this)),e.color&&this.setColor(e.color),e.size&&(this.ctx.lineWidth=e.size),this.ctx.lineCap="round",this.ctx.lineJoin="round",e.webStorage&&this.saveWebStorage(),e.history&&!e.background&&this.saveHistory(),this.blankCanvas=this.getImg(),this.ev.trigger("board:reset",e)},resetBackground:function(e,t){e=e||this.opts.background;var o=i.isColor(e),n=this.getMode();this.setMode("pencil"),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),o?(this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.history.initialize(this.getImg()),t&&t()):e&&this.setImg(e,{callback:r.proxy(function(){this.history.initialize(this.getImg()),t&&t()},this)}),this.setMode(n)},resize:function(){this.dom.$controls.toggleClass("ic_page_tool_drawing-board-controls-hidden",!this.controls||!this.controls.length);var e,t,o=[this.$el.width(),i.boxBorderWidth(this.$el),i.boxBorderWidth(this.dom.$canvasWrapper,!0,!0)],n=[this.$el.height(),i.boxBorderHeight(this.$el),this.dom.$controls.height(),i.boxBorderHeight(this.dom.$controls,!1,!0),i.boxBorderHeight(this.dom.$canvasWrapper,!0,!0)],r=function(e,t){t=t||1;for(var o=e[0],n=1;n<e.length;n++)o+=e[n]*t;return o},s=function(e){return r(e,-1)};this.opts.enlargeYourContainer?(e=this.$el.width(),t=this.$el.height(),this.$el.width(r(o)),this.$el.height(r(n))):(e=s(o),t=s(n)),this.dom.$canvasWrapper.css("width",e+"px"),this.dom.$canvasWrapper.css("height",t+"px"),this.dom.$canvas.css("width",e+"px"),this.dom.$canvas.css("height",t+"px"),this.canvas.width=e,this.canvas.height=t},initControls:function(){},addControl:function(){},initHistory:function(){this.history=new s({maxLength:30,provider:r.proxy(function(e){e(this.getImg())},this),onUpdate:r.proxy(function(){this.ev.trigger("historyNavigation")},this)})},saveHistory:function(){this.history.save()},restoreHistory:function(e){this.setImg(e,{callback:r.proxy(function(){this.saveWebStorage()},this)})},goBackInHistory:function(){this.history.undo(r.proxy(this.restoreHistory,this))},goForthInHistory:function(){this.history.redo(r.proxy(this.restoreHistory,this))},setImg:function(e,t){t=r.extend({stretch:this.opts.stretchImg,callback:null},t);var o=this.ctx,n=new Image,i=o.globalCompositeOperation;n.onload=function(){o.globalCompositeOperation="source-over",o.clearRect(0,0,o.canvas.width,o.canvas.height),t.stretch?o.drawImage(n,0,0,o.canvas.width,o.canvas.height):o.drawImage(n,0,0),o.globalCompositeOperation=i,t.callback&&t.callback()},n.src=e},getImg:function(){return this.canvas.toDataURL("image/png")},downloadImg:function(){var t=this.getImg();t=t.replace("image/png","image/octet-stream"),e.location.href=t},saveWebStorage:function(){e[this.storage]&&(e[this.storage].setItem("drawing-board-"+r.data(this,"id"),this.getImg()),this.ev.trigger("board:save"+this.storage.charAt(0).toUpperCase()+this.storage.slice(1),this.getImg()))},restoreWebStorage:function(){e[this.storage]&&null!==e[this.storage].getItem("drawing-board-"+r.data(this,"id"))&&(this.setImg(e[this.storage].getItem("drawing-board-"+r.data(this,"id"))),this.ev.trigger("board:restore"+this.storage.charAt(0).toUpperCase()+this.storage.slice(1),e[this.storage].getItem("drawing-board-"+r.data(this,"id"))))},clearWebStorage:function(){e[this.storage]&&null!==e[this.storage].getItem("drawing-board-"+r.data(this,"id"))&&(e[this.storage].removeItem("drawing-board-"+r.data(this,"id")),this.ev.trigger("board:clear"+this.storage.charAt(0).toUpperCase()+this.storage.slice(1)))},_getStorage:function(){return!(!this.opts.webStorage||"session"!==this.opts.webStorage&&"local"!==this.opts.webStorage)&&this.opts.webStorage+"Storage"},initDropEvents:function(){return!!this.opts.droppable&&(this.dom.$canvas.on("dragover dragenter drop",function(e){e.stopPropagation(),e.preventDefault()}),void this.dom.$canvas.on("drop",r.proxy(this._onCanvasDrop,this)))},_onCanvasDrop:function(t){t=t.originalEvent?t.originalEvent:t;var o=t.dataTransfer.files;if(!o||!o.length||o[0].type.indexOf("image")==-1||!e.FileReader)return!1;var n=new FileReader;n.readAsDataURL(o[0]),n.onload=r.proxy(function(e){this.setImg(e.target.result,{callback:r.proxy(function(){this.saveHistory()},this)}),this.ev.trigger("board:imageDropped",e.target.result),this.ev.trigger("board:userAction")},this)},setMode:function(e,t){t=t||!1,e=e||"pencil",this.ev.unbind("board:startDrawing",r.proxy(this.fill,this)),"transparent"===this.opts.eraserColor?this.ctx.globalCompositeOperation="eraser"===e?"destination-out":"source-over":("eraser"===e?"background"===this.opts.eraserColor&&i.isColor(this.opts.background)?this.ctx.strokeStyle=this.opts.background:i.isColor(this.opts.eraserColor)&&(this.ctx.strokeStyle=this.opts.eraserColor):this.mode&&"eraser"!==this.mode||(this.ctx.strokeStyle=this.color),"filler"===e&&this.ev.bind("board:startDrawing",r.proxy(this.fill,this))),this.mode=e,t||this.ev.trigger("board:mode",this.mode)},getMode:function(){return this.mode||"pencil"},setColor:function(e){var t=this;if(e=e||this.color,!i.isColor(e))return!1;if(this.color=e,"transparent"!==this.opts.eraserColor&&"eraser"===this.mode){var o=function(e){"eraser"!==e&&(t.strokeStyle=t.color),t.ev.unbind("board:mode",o)};this.ev.bind("board:mode",o)}else this.ctx.strokeStyle=this.color},fill:function(e){function t(e){o.data[e[n]]=c,o.data[e[n]+1]=u,o.data[e[n]+2]=d}if(this.getImg()===this.blankCanvas)return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=this.color,void this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);var o=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),n=0,r=1,s=2,a=3,l=this.ctx.strokeStyle,c=parseInt(l.substr(1,2),16),u=parseInt(l.substr(3,2),16),d=parseInt(l.substr(5,2),16),p=i.pixelAt(o,parseInt(e.coords.x,10),parseInt(e.coords.y,10)),f=p[a],h=this.opts.fillTolerance,g=this.opts.fillHack;if(!i.compareColors(f,i.RGBToInt(c,u,d),h)){for(var m,v=[p],y=o.width-1,_=o.height-1;m=v.pop();)g&&t(m),i.compareColors(m[a],f,h)&&(g||t(m),m[r]>0&&v.push(i.pixelAt(o,m[r]-1,m[s])),m[r]<y&&v.push(i.pixelAt(o,m[r]+1,m[s])),m[s]>0&&v.push(i.pixelAt(o,m[r],m[s]-1)),m[s]<_&&v.push(i.pixelAt(o,m[r],m[s]+1)));this.ctx.putImageData(o,0,0)}},initDrawEvents:function(){this.isDrawing=!1,this.isMouseHovering=!1,this.coords={},this.coords.old=this.coords.current=this.coords.oldMid={x:0,y:0},this.dom.$canvas.on("mousedown touchstart",r.proxy(function(e){this._onInputStart(e,this._getInputCoords(e))},this)),this.dom.$canvas.on("mousemove touchmove",r.proxy(function(e){this._onInputMove(e,this._getInputCoords(e))},this)),this.dom.$canvas.on("mouseup touchend",r.proxy(function(e){this._onInputStop(e,this._getInputCoords(e))},this)),this.dom.$canvas.on("mouseover",r.proxy(function(e){this._onMouseOver(e,this._getInputCoords(e))},this)),this.dom.$canvas.on("mouseout",r.proxy(function(e){this._onMouseOut(e,this._getInputCoords(e))},this)),r("body").on("mouseup touchend",r.proxy(function(){this.isDrawing=!1},this)),e.requestAnimationFrame&&requestAnimationFrame(r.proxy(this.draw,this))},draw:function(){if(e.requestAnimationFrame&&this.ctx.lineWidth>10&&this.isMouseHovering){this.dom.$cursor.css({width:this.ctx.lineWidth+"px",height:this.ctx.lineWidth+"px"});var t=i.tpl("translateX({{x}}px) translateY({{y}}px)",{x:this.coords.current.x-this.ctx.lineWidth/2,y:this.coords.current.y-this.ctx.lineWidth/2});this.dom.$cursor.css({transform:t,"-webkit-transform":t,"-ms-transform":t}),this.dom.$cursor.removeClass("ic_page_tool_drawing-board-utils-hidden")}else this.dom.$cursor.addClass("ic_page_tool_drawing-board-utils-hidden");if(this.isDrawing){var o=this._getMidInputCoords(this.coords.current);this.ctx.beginPath(),this.ctx.moveTo(o.x,o.y),this.ctx.quadraticCurveTo(this.coords.old.x,this.coords.old.y,this.coords.oldMid.x,this.coords.oldMid.y),this.ctx.stroke(),this.coords.old=this.coords.current,this.coords.oldMid=o}e.requestAnimationFrame&&requestAnimationFrame(r.proxy(function(){this.draw()},this))},_onInputStart:function(t,o){this.coords.current=this.coords.old=o,this.coords.oldMid=this._getMidInputCoords(o),this.isDrawing=!0,e.requestAnimationFrame||this.draw(),this.ev.trigger("board:startDrawing",{e:t,coords:o}),t.stopPropagation(),t.preventDefault()},_onInputMove:function(t,o){this.coords.current=o,this.ev.trigger("board:drawing",{e:t,coords:o}),e.requestAnimationFrame||this.draw(),t.stopPropagation(),t.preventDefault()},_onInputStop:function(e,t){!this.isDrawing||e.touches&&0!==e.touches.length||(this.isDrawing=!1,this.saveWebStorage(),this.saveHistory(),this.ev.trigger("board:stopDrawing",{e:e,coords:t}),this.ev.trigger("board:userAction"),e.stopPropagation(),e.preventDefault())},_onMouseOver:function(e,t){this.isMouseHovering=!0,this.coords.old=this._getInputCoords(e),this.coords.oldMid=this._getMidInputCoords(this.coords.old),this.ev.trigger("board:mouseOver",{e:e,coords:t})},_onMouseOut:function(e,t){this.isMouseHovering=!1,this.ev.trigger("board:mouseOut",{e:e,coords:t})},_getInputCoords:function(e){e=e.originalEvent?e.originalEvent:e;var t,o,n=this.canvas.getBoundingClientRect(),r=this.dom.$canvas.width(),i=this.dom.$canvas.height();return e.touches&&1==e.touches.length?(t=e.touches[0].pageX,o=e.touches[0].pageY):(t=e.pageX,o=e.pageY),t-=this.dom.$canvas.offset().left,o-=this.dom.$canvas.offset().top,t*=r/n.width,o*=i/n.height,{x:t,y:o}},_getMidInputCoords:function(e){return{x:this.coords.old.x+e.x>>1,y:this.coords.old.y+e.y>>1}}},o.exports=c},""),o.define("core.utils.drawingboard.microevent",function(e,t,o,n){"use strict";var r=function(){};r.prototype={bind:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},unbind:function(e,t){this._events=this._events||{},e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},t.exports=r},""),o.define("core.utils.drawingboard.utils",function(t,o,n,r){"use strict";function i(e,t,o,n){if(e.length<=0)return 0;t=!!t||!0,o=!!o||!1;var r,i=0;"width"==n?(r=["border-left-width","border-right-width"],t&&r.push("padding-left","padding-right"),o&&r.push("margin-left","margin-right")):(r=["border-top-width","border-bottom-width"],t&&r.push("padding-top","padding-bottom"),o&&r.push("margin-top","margin-bottom"));for(var s=r.length-1;s>=0;s--)i+=parseInt(e.css(r[s]).replace("px",""),10);return i}!function(){for(var t=["ms","moz","webkit","o"],o=0;o<t.length&&!e.requestAnimationFrame;++o)e.requestAnimationFrame=e[t[o]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[t[o]+"CancelAnimationFrame"]||e[t[o]+"CancelRequestAnimationFrame"]}(),o.exports={tpl:function(){var e,t="{{",o="}}",n="[a-z0-9_][\\.a-z0-9_]*",r=new RegExp(t+"\\s*("+n+")\\s*"+o,"gi");
return function(t,o){return t.replace(r,function(t,n){for(var r=n.split("."),i=r.length,s=o,a=0;a<i;a++){if(s=s[r[a]],s===e)throw"tim: '"+r[a]+"' not found in "+t;if(a===i-1)return s}})}}(),boxBorderWidth:function(e,t,o){return i(e,t,o,"width")},boxBorderHeight:function(e,t,o){return i(e,t,o,"height")},isColor:function(e){return!(!e||!e.length)&&(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)||r.inArray(e.substring(0,3),["rgb","hsl"])!==-1)},RGBToInt:function(e,t,o){var n=0;return n|=(255&e)<<16,n|=(255&t)<<8,n|=255&o},pixelAt:function(e,t,o){var n=4*(o*e.width+t),r=this.RGBToInt(e.data[n],e.data[n+1],e.data[n+2]);return[n,t,o,r]},compareColors:function(e,t,o){if(0===o)return e===t;var n=e>>16&255,r=t>>16&255,i=e>>8&255,s=t>>8&255,a=255&e,l=255&t;return Math.abs(n-r)<=o&&Math.abs(i-s)<=o&&Math.abs(a-l)<=o}}},""),function(e,t,n){"use strict";var r=n("core.utils.request"),i=n("core.player.Player"),s=n("core.utils.detector"),a=n("core.plugin.sync"),l=n("core.eventbus.eventbus"),c={refPath:{"ref-path":r("ref-path"),"ref-path-addon":r("ref-path-addon"),"ref-path-online":r("ref-path-online"),"ref-path-tool":r("ref-path-tool")||"../tools/"},url:r("main")||r("main-url"),pageUrl:r("page-url"),playerCode:r("player-code"),hidePage:r("hidePage"),stateToken:r("ls_token"),location:{current:r("_lang_"),default_lang:"zh"},startPageIndex:r("startPageIndex"),startPageId:r("startPageId"),startPageName:r("startPageName"),toolClose:function(){}},u=function(e,o){var n,r;for(var i in o)n=o[i],r=e[i],t.isPlainObject(r)?u(r,n):i in e||(e[i]=o[i])},d=function(){var e=0,t=0;document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight);var o={width:e,height:t},n=1920,r=1080,i=24;0===o.width&&0===o.height&&(o.width=icCreatePlayer.request("docWidth"),o.height=icCreatePlayer.request("docHeight"));var s=0;return s=o.width/o.height<=n/r?o.width/n*i:o.height/r*i},p=function(){if(e.navigator&&e.navigator.userAgent){var t=e.navigator.userAgent.toLowerCase(),o=/windows nt \d+\.+\d+/,n=t.match(o);if(n&&n[0])switch(n[0]){case"windows nt 5.1":return"xp"}}return"UnKnown"};e.icCreatePlayer={create:function(e){e=e||{},u(e,c);var t=new i(e);return t},request:r,detector:s,coursePlayer:n("core.bridge.courseplayer"),utils:{throttle:n("core.utils.throttle"),raf:n("core.utils.raf"),EventBus:l,getFontSize:d,getOS:p},RUNTIME:n("core.common.runtime").RUNTIME,setDefaultPlayerConfig:function(e){u(e,c),c=e},PAGETYPE:{PAGE:0,EXTEND_PAGE:1},fontSize:"",sync:a,plugin:Object.create(null),version:"11.7.3"},o.initialize()}(e,jQuery,o.require)}(window,jQuery);
//# sourceMappingURL=ndplayer.min.js.map
