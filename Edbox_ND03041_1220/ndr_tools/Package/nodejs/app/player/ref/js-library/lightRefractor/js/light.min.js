!function(e,t,i){var n,s;!function(){var e={},t={},i=function(n){if(n&&(n=n.toLowerCase()),t[n]){var s=t[n];delete t[n];for(var a=[],r=0;r<s.deps.length;r++){var o=s.deps[r];a[r]=i(o)}var l=s.callback.apply(s.callback,a);e[n]=l}return e[n]};s=function(e,i,n){if(e&&(e=e.toLowerCase()),i instanceof Array||(n=i,i=[]),t[e])throw new Error("the key already has been  used");t[e]={deps:i,callback:n,module:null}},n=function(e){return i(e)}}(),s("js/base/base",[],function(){var e=n("js/utils/logger"),t=function(t,i){for(var n in i)"undefined"!=typeof t[n]&&"__base"!==n&&(!t.__overwrite||t.__overwrite.indexOf(n)<0)&&e.debug("有重复的成员",n),t[n]=i[n];return t},i=function(e,t){return function(){return t.apply(e,arguments)}},s={___eventBus:null,___eventsInfo:[{key:"",callback:"",params:[]}],__base:function(e,t){this.___eventsInfo=null,this.___eventBus=null;var i=Array.prototype.slice.apply(arguments,[0]);if(i.length>2)throw new Error("参数长度有误");for(var n=0;n<i.length;n++){var s=i[n];s instanceof Array?this.___eventsInfo=s:"object"==typeof s&&(this.___eventBus=e)}this.___eventBus=this.___eventBus||{},this.___eventsInfo=this.___eventsInfo||[];for(var n=0;n<this.___eventsInfo.length;n++){var a=this.___eventsInfo[n],r=a.key;"string"==typeof a.callback?this.___eventBus.on(r,this[a.callback],this):this.___eventBus.on(r,a.callback,this)}},__include:function(e){return t(this,e)},__proxyAll:function(e){for(var t=0;t<e.length;t++)"string"==typeof e[t]&&(this[e[t]]=i(this,this[e[t]]))},__on:function(e,t,i){this.___eventsInfo.push({key:e,callback:t,params:i}),"string"==typeof t?this.___eventBus.on(e,this[t],this):this.___eventBus.on(e,t,this)},__triggerEvent:function(e){var t=Array.prototype.slice.apply(arguments,[0]);this.___eventBus.trigger.apply(this.___eventBus,t)},__getEventBus:function(){return this.___eventBus},__destroy:function(){for(var e=this.___eventsInfo,t=0;t<e.length;t++){var i=e[t],n=i.key;"string"==typeof i.callback?this.___eventBus.off(n,this[i.callback],this):this.___eventBus.off(n,i.callback,this)}}};return function(e){return Object.create(s).__include(e)}}),s("js/config/color",[],function(){var e={};return e.transparent=kity.Color.createRGBA(0,0,0,0),e.node_stroke_normal=kity.Color.createRGB(115,161,191),e.node_stroke_active=kity.Color.createRGB(57,80,96),e.backgroud_color=kity.Color.parse("#C0D3E2"),e.line_color=kity.Color.parse("#666564"),e}),s("js/config/eventKey",[],function(){var e={Blur:"Blur",DomEvent:"DomEvent",SurfaceAngleVisible:"SurfaceAngleVisible",NormalAngleVisible:"NormalAngleVisible",NameVisible:"NameVisible",ZIndexChange:"ZIndexChange",LightLineVisible:"LightLineVisible",MoveBtn:"MoveBtn",BtnMove:"BtnMove"};return e}),s("js/config/lang",[],function(){var e={rf_incidence_line_name:"入射光线",rf_incidence_angle:"入射角",rf_incidence_point:"入射点O",rf_normal_name:"法线N",rf_reflection_line_name:"反射光线",rf_reflection_angle:"反射角",rf_reflection_surface:"反射面",rf_equal_angle_name:"反射角=入射角=0°"};return e}),s("js/config/style",["js/config/color"],function(){var e={black:"svg_text color_black",green:"svg_text color_green",blue:"svg_text color_blue",red:"svg_text color_red",orange:"svg_text color_orange",purple:"svg_text color_purple"},t={};return t.LineStyle={strokeStyle:{"stroke-width":2.5,stroke:kity.Color.parse("#ffffff")},rectHeight:8,btnRotate:{width:64,height:64},arrow:{width:34,height:45},on:"on",commonLineFill:kity.Color.parse("#794F78"),commonArrowCls:"arrow_purple",IncidenceLine:{fill:kity.Color.parse("#005798"),fontClass:e.blue,arrowClass:"arrow_blue"},ReflectionLine:{fill:kity.Color.parse("#CB1F1F"),fontClass:e.red,arrowClass:"arrow_red"},RefractionLine:{fill:kity.Color.parse("#CB1F1F"),fontClass:e.red,arrowClass:"arrow_red"}},t.Sector={strokeStyle:{"stroke-width":1,stroke:kity.Color.parse("#7595AC")},surfaceFill:kity.Color.createRGBA(213,139,34,.35),incidence_normalFill:kity.Color.createRGBA(204,131,255,.35),normalFill:kity.Color.createRGBA(60,143,65,.35),incidence_normalFontClass:e.purple,normalFontClass:e.green,surfaceFontClass:e.orange},t.NormalLine={strokeStyle:{"stroke-width":4,stroke:kity.Color.parse("#4D4D4D")},fontClass:e.black,pointWidth:5,pointFill:kity.Color.parse("#CB1F1F")},t.InverseRefractionLine={strokeStyle:{"stroke-width":4,stroke:kity.Color.parse("#FF0000")},fontClass:e.black,pointWidth:5,name:"",incidencePointName:"",pointFill:kity.Color.parse("#CB1F1F")},t.IncidencePoint={width:9,fill:kity.Color.parse("#FFE012")},t.Surface={height:19,surfaceClass:"wall_tl",fontClass:e.black,btnRotate:{width:64,height:64}},t.Pedal={strokeStyle:{"stroke-width":5,stroke:kity.Color.parse("#04740b")},width:35},t.EqualAngleName={fontClass:e.green},t});var a=function(){var e="ontouchend"in t,n=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),s={};e&&n?(s.mouseDown="touchstart",s.mouseUp="touchend",s.mouseWheel="touchmove",s.getEventX=function(e){return e.originalEvent.changedTouches[0].clientX},s.getEventY=function(e){return e.originalEvent.changedTouches[0].clientY}):(s.mouseDown="mousedown",s.mouseUp="mouseup",s.mouseWheel="mousewheel",s.getEventX=function(e){return e.clientX},s.getEventY=function(e){return e.clientY}),i.event.special.lrTap={setup:function(){var t=i(this);if(e&&n){var a=s.mouseDown,r=s.mouseUp,o=0,l=0,c=0;t.bind(a,function(e){0===e.which&&1===e.which||(o=(new Date).getTime(),l=s.getEventX(e),c=s.getEventY(e))}),t.bind(r,function(e){if(0!==e.which||1!==e.which){var n=(new Date).getTime(),a=s.getEventX(e),r=s.getEventY(e),h=n-o,u=Math.abs(a-l),g=Math.abs(r-c);h<=550&&u<8&&g<8&&(e=i.event.fix(e),e.type="lrTap",e.tapEventSource="touchclick",e.tapFireTouch=!0,t.triggerHandler(e))}})}else t.bind("click",function(e){e=i.event.fix(e),e.type="lrTap",e.tapEventSource="mouseclick",e.tapFireTouch=!1,e.originalEvent&&e.originalEvent.sourceCapabilities&&e.originalEvent.sourceCapabilities.firesTouchEvents&&(e.tapFireTouch=!0),t.triggerHandler(e)})},teardown:function(){var e=s.mouseDown,t=s.mouseUp,n=i(this);n.unbind(t).unbind(e)}}};a(),s("js/reflector/baseReflector",["js/base/base","js/utils/utils"],function(e,t){var i={_lightComplexArray:null,_uuid:null,__overwrite:["createView","drawAll","drawNext","getData"],__base:function(i,n){var s=Array.prototype.slice.apply(arguments,[0]);e({}).__base.apply(this,s),this._uuid=t.getUuid()},createView:function(){},drawAll:function(){this._lightComplexArray.drawAll()},drawNext:function(){this._lightComplexArray.drawNext()},hasNext:function(){return this._lightComplexArray.hasNext()},getData:function(){},getType:function(){return this._TYPE},getNameVisible:function(){return this._option.nameVisible},pushEvent:function(e){this._event.push(e),this.__proxyAll([e.callback])},getUuid:function(){return this._uuid}};return function(t){return e(i).__include(t)}}),s("js/reflector/domEvent",["js/base/Base","js/config/EventKey","js/utils/eventUtils"],function(e,t,s){var a=(n("js/utils/logger"),e({_$$paper:null,_$$paperItems:[],_option:null,_eventInfo:[],create:function(e,t,i){var n=Object.create(this);return n.__base(t,[]),n._option=i,n._$$paper=e,n},bindDomEvent:function(){this._domEvents(),i(this._$$paper.node).on(" lrTap  mousedown  mouseup mousemove mouseleave touchstart touchmove touchend touchcancel",this._domEvents)},_getEventInfo:function(e){var t=[];e=e.originalEvent||e;var n=i(e.srcElement);for(n.hasClass("_lr_event")||(n=n.closest("._lr_event"));n.length>0&&(t.push({uuid:n.data("event-identifier"),eventType:n.data("event-type"),triggerBlur:n.data("event-triggerblur")}),n.data("event-stoppropagation")===!1||"false"===n.data("event-stoppropagation"));){var s=n.parent();n=s.hasClass("_lr_event")?s:s.closest("._lr_event")}return t},_initEventInfo:function(e){this._eventInfo=this._getEventInfo(e)},_clearEventInfo:function(e){this._eventInfo=null},_events:function(e){var i=this,n=e.mType;switch(e.mType){case"lrTap":this._initEventInfo(e),null==this._eventInfo||this._eventInfo.length<=0?this.__triggerEvent(t.Blur):this._eventInfo[0].triggerBlur&&this.__triggerEvent(t.Blur,this._eventInfo[0].uuid);break;case"down":this._initEventInfo(e);break;case"beforemove":break;case"move":break;case"aftermove":}switch(this._eventInfo&&this._eventInfo.forEach(function(t){t.eventType.indexOf(n)>-1&&i.__triggerEvent(t.uuid,n,t.uuid,{moveAbs:e.mMoveAbs,currentPos:e.mCurrentPos,lastPos:e.mLastPos})}),e.mType){case"up":this._clearEventInfo(e)}},_domEvents:function(){var e=this,t=!1,n=!1,a=!1,r=0,o={},l={},c=function(c){if(!e._option.lock){var h=c.type||"";switch(h){case"mousedown":case"touchstart":r=(new Date).getTime(),"mousedown"===h&&(o=s.getPagePos(c)),t=!0,a=!1,"touchstart"===h&&(n=!0),c.mType="down";var u=i(e._$$paper.node)[0].getBoundingClientRect();e.startX=u.left,e.endX=u.right,e.startY=u.top,e.endY=u.bottom;break;case"mousemove":case"touchmove":if(!t)return;c.preventDefault();var g=s.getPagePos(c);c.mLastPos=l,c.mCurrentPos=g;var f=g.x-l.x,_=g.y-l.y;if(c.mMoveAbs={x:f,y:_},c.mxj=parseFloat(l.x*g.y)-parseFloat(g.x*l.y),0===f&&0===_||(a||(c.mType="beforemove",e._events(c)),c.mType="move",a=!0),g.x<=e.startX||g.x>=e.endX||g.y<=e.startY||g.y>=e.endY)return i(e._$$paper.node).closest(".refraction_main").trigger("mouseup"),void i(e._$$paper.node).closest(".refraction_main").trigger("touchend");break;case"touchend":case"touchcancel":case"mouseup":case"mouseleave":a&&(c.mType="aftermove",e._events(c)),c.mMoveTrigger=a,a=!1,t=!1,c.mType="up";break;case"lrTap":if(c.mType=h,"touchclick"===c.tapEventSource||"mouseclick"===c.tapEventSource&&n?c.mTouchTrigger=!0:c.mTouchTrigger=!1,n=!1,"mouseclick"===c.tapEventSource){var d=s.fixPcClick(o,s.getPagePos(c),r,(new Date).getTime());if(!d)return}break;default:c.mType=h}e._events(c),(s.isMove(h)||s.isDown(h))&&(l=s.getPagePos(c))}};e._domEvents=c}}));return a.addDomEvent=function(e,t,n,s,a){t&&t.length>0&&("undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=!0),i(e).attr("class","_lr_event"),i(e).data("event-type",t),i(e).data("event-identifier",n),i(e).data("event-stoppropagation",s),i(e).data("event-triggerblur",a))},a}),s("js/refractor/btn",["js/base/Base","js/utils/string","js/utils/utils","js/config/eventKey","js/utils/view"],function(e,t,s,a,r){var o=n("js/view/foreignview"),l=n("js/utils/svg"),c=n("js/reflector/domEvent"),h=n("js/config/style").LineStyle,u=e({_fwRotate:null,_id:"",_lineUuid:"",_refractorMain:null,create:function(e,t){var i=Object.create(this),n=[];return i._id=s.getUuid(),i._refractorMain=t,n.push({key:a.MoveBtn,callback:"moveBtnEventHandler",params:[]}),i.__base(e,n),i.addRotateBtn(),i},addRotateBtn:function(){var e=this;this._fwRotate=o.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwTranslate=o.create("btn_translate",h.btnRotate.width,h.btnRotate.height),this._fwRotate.setVisibility(!1),this._fwTranslate.setVisibility(!1);var t=new kity.Group;this._refractorMain._paper.addShape(t),i(t.node).append(this._fwRotate.getView()),i(t.node).append(this._fwTranslate.getView()),c.addDomEvent(this._fwRotate.getView()[0],["down","beforemove","move","aftermove","up"],this._fwRotate.getUuid(),!1,!1),c.addDomEvent(this._fwTranslate.getView()[0],["down","beforemove","move","aftermove","up"],this._fwTranslate.getUuid(),!1,!1),this.__on(this._fwRotate.getUuid(),function(t,i,n){"down"===t?this._fwRotate.addClass("on"):"aftermove"!==t&&"up"!==t||(this._fwRotate.removeClass("on"),this._fwRotate.getView().blur()),e.__triggerEvent(a.BtnMove+e._lineUuid,t,this._lineUuid,n)},""),this.__on(this._fwTranslate.getUuid(),function(t,i,n){"down"===t?this._fwTranslate.addClass("on"):"aftermove"!==t&&"up"!==t||this._fwTranslate.removeClass("on"),e.__triggerEvent(a.BtnMove+e._tranlineUuid,t,this._tranlineUuid,n)},"")},moveBtnEventHandler:function(e,t,i,n,s,a){this._lineUuid=n,this._tranlineUuid=s;var r=t.left+t.width/2,o=t.top+t.height/2,c=this._fwRotate.getView()[0].getBoundingClientRect(),h=c.left+c.width/2,u=c.top+c.height/2,g=l.getAttrTranslate(this._fwRotate.getView().attr("transform"));g&&2==g.length?this._fwRotate.setTranslate(g[0]+(r-h)/e,g[1]+(o-u)/e):this._fwRotate.setTranslate((r-h)/e,(o-u)/e);var f=i.left+i.width/2,_=i.top+i.height/2,c=this._fwTranslate.getView()[0].getBoundingClientRect(),d=c.left+c.width/2,p=c.top+c.height/2,g=l.getAttrTranslate(this._fwTranslate.getView().attr("transform"));g&&2==g.length?this._fwTranslate.setTranslate(g[0]+(f-d)/e,g[1]+(_-p)/e):this._fwTranslate.setTranslate((f-d)/e,(_-p)/e),void 0!=a&&(this._fwRotate.setVisibility(a),this._fwTranslate.setVisibility(a))}});return u}),s("js/refractor/LightComplexArrayRef",["js/base/base","js/utils/utils"],function(e,t){var i=n("js/refractor/LightComplexRef/main"),s=(n("js/view/LightLine"),e({_lightArray:[],_lightEnable:[],_lightDrawBefore:[],_chainMode:!1,_currentHighZIndex:0,create:function(e,i,n,s,a,r,o){var l=Object.create(this);return l._uuid=t.getUuid(),l.__base(e,[]),l._config=i,l._lightArray=[],l._lightDrawBefore=[],l._lightEnable=[],l._chainMode=o||!1,l.createView(s,a,r,n),l.initZIndexEvent(),l},createView:function(e,t,n,s){var a=this;this._config.forEach(function(r,o){var l=i.create(a.__getEventBus(),r,e,t,n,s);a._lightArray.push(l),l.setVisibility(r.Visible),a._lightEnable[o]=!0,a._lightDrawBefore[o]=!0})},appendToView:function(e){this.each(function(){e.addShape(this.getView())})},prependToView:function(e){this.each(function(){e.prependItem(this.getView())})},gtIndexAppendToView:function(e){this.each(function(){this.gtIndexAppendToView(e)})},each:function(e,t){var i=this;this._lightArray.forEach(function(n,s){var a=!0;i.indexValidate(t)&&(a=t===s),a&&e.apply(n,[s])})},indexValidate:function(e){return"undefined"!=typeof e&&e<this._lightArray.length},getCommandLength:function(e){return this._lightArray[e||0].getCommandLength()},pushDrawCommand:function(e,t,i){this.each(function(i){this.pushDrawCommand(e,t)},i)},setPedalDrawIndex:function(e,t){this.each(function(t){this.setPedalDrawIndex(e)},t)},setDrawIndex:function(e,t){this.each(function(t){this.setDrawIndex(e)},t)},resetAngle:function(e,t,i){this.each(function(i){this.resetAngle(e,t)},i)},changeChainLineCommonFill:function(){if(this._chainMode){var e=this;this.each(function(t){var i=!0;t+1>=e._lightArray.length&&(i=!1),i?0===t?this.setRefractionLineCommonFill(e.isEnableAndDraw(t+1)):(this.setIncidenceLineCommonFill(e.isEnableAndDraw(t-1)),this.setRefractionLineCommonFill(e.isEnableAndDraw(t+1))):0!==t&&this.setIncidenceLineCommonFill(e.isEnableAndDraw(t))})}},drawAll:function(e){var t=this;this.each(function(e){t.hasNextEnable(e)&&(t._lightArray[e+1].setVisibility(!0),t._lightDrawBefore[e+1]=!0),this.drawAll()},e)},drawNext:function(e){var t=this,i=!1;this.each(function(e){this.hasNext()&&!i&&t._lightEnable[e]===!0&&(i=!0,this.drawNext()),!i&&t.hasNextEnable(e)&&(i=!0,t._lightArray[e+1].setVisibility(!0),t._lightDrawBefore[e+1]=!0)},e)},hasNextEnable:function(e){var t=this;return!!(e+1<t._lightArray.length&&t._lightEnable[e+1]===!0&&t._lightArray[e+1].isVisibilityHidden())},hasDrawNext:function(e){var t=!1;return this.each(function(e){t||(t=this.hasNext())},e),t},hasNext:function(e){var t=!1,i=this;return this.each(function(e){t||(t=this.hasNext()),t||(t=i.hasNextEnable(e))},e),t},setAllEnable:function(e){var t=this;this.each(function(i){t._lightEnable[i]=e,e||this.setVisibility(!1),t._lightDrawBefore[i]&&t._lightEnable[i]&&this.setVisibility(!0)})},setEnable:function(e,t){this._lightEnable[e]=t,this._lightDrawBefore[e]&&this._lightEnable[e]&&this._lightArray[e].setVisibility(!0),t===!1&&this._lightArray[e].setVisibility(!1),this.__triggerEvent("insidechange","enablechange")},setSectorEnable:function(e){this.each(function(){this.setSectorEnable(e)})},isEnableAndDraw:function(e){return this._lightEnable[e]&&this._lightDrawBefore[e]},getData:function(e){var t={LightComplex:[]};return this.each(function(){t.LightComplex.push(this.getData())},e),t},rotateAble:function(e,t){var i=this,n=!0;return this.each(function(s){n&&(e=t&&i._config[s].IncidenceLine.rotateFixed?-e:e,n=this.complexRotateAble(e))}),n},around:function(e,t){this.each(function(i){this.around(e,t)})},adsorptionPedal:function(){this.each(function(){this.adsorptionPedal()})},isPedalExcludeDisable:function(e){var t=!0;return this.each(function(){this.isVisibilityHidden()||t&&(t=this.isPedal())},e),t},isPedal:function(e){var t=!0;return this.each(function(){t&&(t=this.isPedal())},e),t},initZIndexEvent:function(){var e=this;this.each(function(t){var i=this;!function(t){i.setViewTapListener(function(){e._currentHighZIndex=t,e.each(function(e){this.changeTransparent(t===e)})})}(t)})},getCurrentHighZIndex:function(){return this._currentHighZIndex},showFirstIndex:function(){this.each(function(e){this.changeTransparent(0===e)})},setIncidenceNameEnable:function(e){this.each(function(t){this.setIncidenceNameEnable(e)})},setIncidenceNameVisible:function(e){this.each(function(t){this.setIncidenceNameVisible(e)})},get:function(e){return this._lightArray[e]},getDrawBegin:function(){return this._lightArray[0].getDrawBegin()},setNameVisible:function(e){this.each(function(){this.setNameVisible(e)})},setLinePedalChangeLock:function(e){this.each(function(t){this.setLinePedalChangeLock(e)})},getCount:function(){return this._lightArray.length},drawAllNext:function(e){this.each(function(){this.hasNext()&&this.drawNext(e)})},drawAllAll:function(e){var t=this;this.each(function(i){t.hasNextEnable(i)&&(t._lightArray[i+1].setVisibility(!0),t._lightDrawBefore[i+1]=!0),this.drawAll(e)})},getFirRefAngle:function(){return this._lightArray[0].getRefAngle()},getFirIncidenceAngle:function(){return this._lightArray[0].getIncidenceLineXAngle()},getHasdrawMaterialObjectImagingGroup4:function(){return this._lightArray[0].getHasdrawMaterialObjectImagingGroup4()},getHasdrawMaterialObjectImagingGroup5:function(){return this._lightArray[0].getHasdrawMaterialObjectImagingGroup5()}}));return s}),s("js/refractor/refractor1",["js/reflector/baseReflector","js/utils/utils","js/utils/graphMath","js/utils/svg"],function(e,t,s,a){var r=n("js/view/surface"),o=n("js/refractor/LightComplexArrayRef"),l=n("js/view/EqualAngleName"),c=n("js/view/ForeignView"),h=(n("js/config/eventKey"),e({_CONFIG:{LightComplex:[{IncidenceLine:{defaultAngle:45,rotateFixed:!0,clickAble:!0,rotateFixedAfterDraw:!0},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1,PedalWidth:290},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,refractionVisible:!1},IncidencePosX:710,IncidencePosY:432,DrawIndex:[[0,1,3],[4,5,6],[7,11],[8]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:20,y:435},bPoint:{x:1400,y:435},degree:0,range:[{x:710,y:435},{x:710,y:435}],refractivity1:1,refractivity2:1.333,transAble:!0,pedalLineAngle:90}],_curLineIndex:0}],Surface:{width:1420,defaultAngle:0,rotatePosX:710,rotatePosY:4,visible:!1,clickAble:!0,type:r.Type.tl},ForeignSurf:{cls:"bg_water",width:1420,height:396,translateX:0,translateY:435}},_TYPE:1,_Event:[],_event:null,_$$container:null,_incidencePointPos:null,_surfacePagePos:null,_option:null,_equalAngleNameHasShowBefore:!1,resetState:!1,create:function(e,n,s,a){var r=Object.create(this);return r._uuid=t.getUuid(),r._event=i.extend(!0,[],this._Event),r.initEvent(),r.__base(e,r._event),r.__proxyAll(["onSurfaceMove","onLineMove","onLineTrans","onLightFocusBlur","nameVisibleHandler"]),r._$$container=n,r._config=i.extend(!0,{},this._CONFIG,a&&a.configData||{}),r._option=s,r.createView(),r.afterCreateView(),r.initExtrasDrawCommand(),r.resetState=a&&a.resetState?a.resetState:this.resetState,r},initEvent:function(){},createView:function(){var e=this;this._surface=r.create(this.__getEventBus(),this._config.Surface,this.onSurfaceMove,this._option.langData),this._lightComplexArray=o.create(this.__getEventBus(),this._config.LightComplex,this._option,this.onLineMove,this.onLineTrans,this.onLightFocusBlur),this._lightComplexArray.appendToView(this._$$container),this._equalAngleName=l.create(this._option.langData);var t=this._config.ForeignSurf.translateX,n=(t+this._config.ForeignSurf.width,this._config.ForeignSurf.translateY),s=(n+this._config.ForeignSurf.height,e._option.langData),a=s.refraction_air||"空气",h=s.refraction_water||"水",u=new kity.Group,g=(new kity.Text).setContent(a).setAttr("x",0).setAttr("y",40).addClass("svg_text_l").addClass("color_black");u.addShape(g),this._$$container.prependItem(u);var f=i(g.node).width();u.setTranslate(1350-f,170),this._foreignSurf=new kity.Group;var _=new kity.Path("M 0 0 L 1420 0");_.setStyle({"stroke-width":4,stroke:"#898989"}),this.lineG=new kity.Group,this.lineG.addClass("hide_dom"),this.lineG.addShape(_);var d=c.create(this._config.ForeignSurf.cls,this._config.ForeignSurf.width,this._config.ForeignSurf.height);this._foreignSurf.addShape(this.lineG),i(this._foreignSurf.node).prepend(d.getView());var p=(new kity.Text).setContent(h);p.addClass("svg_text_l").addClass("color_white"),this._foreignSurf.addShape(p),this._$$container.prependItem(this._foreignSurf);var y=i(p.node).width();p.setAttr("x",1300-y).setAttr("y",146),this._foreignSurf.setTranslate(this._config.ForeignSurf.translateX,this._config.ForeignSurf.translateY),this._$$container.addShape(this._surface.getView()),this._$$container.addShape(this._equalAngleName.getView()),this._lightComplexArray.gtIndexAppendToView(this._$$container),this._surface.setTranslate(0,this._config.LightComplex[0].IncidencePosY),this._surface.setNameVisible(this._option.nameVisible),this._config.EqualAngleName?(e._equalAngleNameHasShowBefore=this._config.EqualAngleName.visible,this._equalAngleName.setVisibility(this._config.EqualAngleName.visible)):this._equalAngleName.setVisibility(!1),this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree,!0),this.initEqualAngleNamePos()},initExtrasDrawCommand:function(){},afterCreateView:function(){},initEqualAngleNamePos:function(){var e=this._$$container.getTransform().m,t=this._equalAngleName.getView().getWidth(),i=this._equalAngleName.getView().getHeight();this._equalAngleName.setTranslate(this._option.viewPortWidth-e.e-t-135,-(this._option.viewPortHeight-e.f-i)+20)},toCenter:function(){this._$$container.setTranslate(this._option.viewPortWidth/2-this.getWidth()/2,this._option.viewPortHeight/2+10)},resetAngle:function(e,t){this._surface.rotate(e);var i=this._surface.getRotateAngle()||0;this._lightComplexArray.resetAngle(i,t)},getData:function(){var e={};return e.type=this._TYPE,e.configData=this._lightComplexArray.getData(),e.configData.Surface={defaultAngle:this._surface.getRotateAngle(),visible:!this._surface.isVisibilityHidden()},e.configData.EqualAngleName={visible:!this._equalAngleName.isVisibilityHidden()},e.resetState=this.resetState,e},getMoveRotateAngle:function(e){var t=e.currentPos,i=e.lastPos;return s.getRotateAngle(this._surface.getRotateOffsetPos(),i,t)},onSurfaceMove:function(e,t){if("move"===t){var i=this.getMoveRotateAngle(e);this._lightComplexArray.rotateAble(i)&&(this.resetAngle(i),this._lightComplexArray.around(this._surface.getRotateAngle(),this._config.Surface.rotatePosX))}else"aftermove"===t&&this._lightComplexArray.adsorptionPedal();this.initEqualAngleVisibility(),this.resetState=!0},onLineMove:function(e,t,i){this.resetState=!0,this.initEqualAngleVisibility(),this.afterLineMove(i)},onLineTrans:function(e,t,i,n){this.resetState=!0,this.afterLineMove(n)},onLightFocusBlur:function(e){this.lineG&&("focus"==e?this.lineG.removeClass("hide_dom"):this.lineG.addClass("hide_dom"))},afterLineMove:function(e){var t=this._lightComplexArray.get(0),n=a.getAttrTranslate(i(t._$$incidencePoint.node).attr("transform")),r={x:n[0],y:n[1]},o=this._config.LightComplex[0].Lines,l=e?e:0,c=t.getIncidenceRotateAngle(),h={degree:c,aPoint:r};if(l>=0){var u=s.pointInLine(h,o,l),g=t._configData.IncidenceLine.width;if(u){var f=s.getTwoPointDistance(u.acrossPoint,r);f<g?t.setIncidenceLineWidth(f):t.setIncidenceLineWidth(g)}else t.setIncidenceLineWidth(g)}var _=t.getRefractionRotateAngle(),d={degree:_,aPoint:r};if(l>=0){var p=s.pointInLine(d,o,l),y=t._configData.RefractionLine.width;if(p){var w=p.acrossPoint,v=(p.index,s.getTwoPointDistance(r,w));v>y?t.setRefractionLineWidth(y):t.setRefractionLineWidth(v)}else t.setRefractionLineWidth(y)}},initEqualAngleVisibility:function(){this._lightComplexArray.isPedal()?(this._equalAngleNameHasShowBefore||this._lightComplexArray.get(0).getTwoLineVisible())&&this._equalAngleName.setVisibility(!0):this._equalAngleName.setVisibility(!1)},getWidth:function(){return this._config.Surface.width},drawAll:function(){this.resetState=!0,this._lightComplexArray.drawAll()},drawNext:function(){this.resetState=!0,this._lightComplexArray.drawNext()},setResetState:function(e){this.resetState=e}}));return h.Extend=function(e){return Object.create(h).__include(e)},h}),s("js/refractor/refractor2",["js/refractor/refractor1","js/utils/utils","js/utils/graphMath","js/utils/svg"],function(e,t,s,a){var r=n("js/view/surface"),o=n("js/refractor/LightComplexArrayRef"),l=n("js/view/EqualAngleName"),c=n("js/view/ForeignView"),h=(n("js/config/eventKey"),n("js/view/sector"),e.Extend({_CONFIG:{LightComplex:[{IncidenceLine:{defaultAngle:45,rotateFixed:!0,clickAble:!0},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,refractionVisible:!1},IncidencePosX:802,IncidencePosY:313,DrawIndex:[[0,1,3],[4,5,6],[7,11],[8]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:420,y:316},bPoint:{x:1184,y:316},degree:0,range:[{x:802,y:316},{x:802,y:316}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:90},{aPoint:{x:420,y:625},bPoint:{x:1184,y:625},degree:0,range:[{x:802,y:625},{x:802,y:625}],refractivity1:1.5,refractivity2:1,transAble:!0,pedalLineAngle:90},{aPoint:{x:420,y:316},bPoint:{x:420,y:625},degree:90,range:[{x:420,y:470.5},{x:420,y:470.5}],refractivity1:1.5,refractivity2:1,transAble:!0,pedalLineAngle:90},{aPoint:{x:1184,y:316},bPoint:{x:1184,y:625},degree:90,range:[{x:1184,y:470.5},{x:1184,y:470.5}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:90}],_curLineIndex:0},{IncidenceLine:{defaultAngle:30,rotateFixed:!0,clickAble:!0,visible:!1},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,refractionVisible:!1},IncidencePosX:300,IncidencePosY:200,DrawIndex:[[0,1],[4,5,6],[7,11],[8]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:420,y:316},bPoint:{x:1184,y:316},degree:0,range:[{x:802,y:316},{x:802,y:316}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:90},{aPoint:{x:420,y:625},bPoint:{x:1184,y:625},degree:0,range:[{x:802,y:625},{x:802,y:625}],refractivity1:1.5,refractivity2:1,transAble:!0,pedalLineAngle:90},{aPoint:{x:420,y:316},bPoint:{x:420,y:625},degree:90,range:[{x:420,y:470.5},{x:420,y:470.5}],refractivity1:1.5,refractivity2:1,transAble:!0,pedalLineAngle:90},{aPoint:{x:1184,y:316},bPoint:{x:1184,y:625},degree:90,range:[{x:1184,y:470.5},{x:1184,y:470.5}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:90}],_curLineIndex:0}],Surface:{width:764,defaultAngle:0,rotatePosX:382,rotatePosY:316,visible:!1,clickAble:!0,aPoint:{x:420,y:316},bPoint:{x:1184,y:316}},ForeignSurf:{cls:"bg_glassrect",width:905,height:453,translateX:420,translateY:316}},_TYPE:2,resetState:!1,create:function(e,n,s,a){var r=Object.create(this);return r._uuid=t.getUuid(),r._event=i.extend(!0,[],this._Event),r.initEvent(),r.__base(e,r._event),r.__proxyAll(["onSurfaceMove","onLineMove","onLineTrans","onLightFocusBlur","nameVisibleHandler"]),r._$$container=n,r._config=i.extend(!0,{},this._CONFIG,a&&a.configData||{}),r._option=s,r.createView(),r.afterCreateView(),r.initExtrasDrawCommand(),r.resetState=a&&a.resetState?a.resetState:this.resetState,r},createView:function(){var e=this;this._surface=r.create(this.__getEventBus(),this._config.Surface,this.onSurfaceMove,this._option.langData),this._lightComplexArray=o.create(this.__getEventBus(),this._config.LightComplex,this._option,this.onLineMove,this.onLineTrans,this.onLightFocusBlur),this._lightComplexArray.prependToView(this._$$container),this._equalAngleName=l.create(this._option.langData);var t=this._config.ForeignSurf.translateX,n=(t+this._config.ForeignSurf.width,this._config.ForeignSurf.translateY),s=(n+this._config.ForeignSurf.height,e._option.langData),a=s.refraction_air||"空气",h=s.refraction_glass||"玻璃",u=new kity.Group,g=(new kity.Text).setContent(a).setAttr("x",0).setAttr("y",40).addClass("svg_text_l").addClass("color_black");u.addShape(g),this._$$container.prependItem(u);var f=i(g.node).width();u.setTranslate(1330-f,116),this._foreignSurf=new kity.Group;var _=new kity.Path("M 0 0 L 761 0 L764 309 L0 309Z");_.setStyle({"stroke-width":4,stroke:"#898989"});var d=c.create(this._config.ForeignSurf.cls,this._config.ForeignSurf.width,this._config.ForeignSurf.height);d.setTranslate(-41,-43),this.lineG=new kity.Group,this.lineG.addClass("hide_dom"),this.lineG.addShape(_),this._foreignSurf.addShape(this.lineG),i(this._foreignSurf.node).prepend(d.getView());var p=(new kity.Text).setContent(h).addClass("svg_text_l").addClass("color_glass");this._foreignSurf.addShape(p),this._foreignSurf.setTranslate(this._config.ForeignSurf.translateX,this._config.ForeignSurf.translateY),this._$$container.prependItem(this._foreignSurf);var y=i(p.node).width();p.setAttr("x",740-y).setAttr("y",90),this._$$container.addShape(this._surface.getView()),this._$$container.addShape(this._equalAngleName.getView()),this._lightComplexArray.gtIndexAppendToView(this._$$container),this._surface.setTranslate(420,this._config.LightComplex[0].IncidencePosY),this._surface.setNameVisible(this._option.nameVisible),this._config.EqualAngleName?(e._equalAngleNameHasShowBefore=this._config.EqualAngleName.visible,this._equalAngleName.setVisibility(this._config.EqualAngleName.visible)):this._equalAngleName.setVisibility(!1),this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree,!0),this.toCenter(),this.initEqualAngleNamePos()},afterCreateView:function(){this.afterLineMove(this._config.LightComplex[0]._curLineIndex)},toCenter:function(){},onLineMove:function(e,t,i){this.resetState=!0,this.initEqualAngleVisibility(),this.afterLineMove(i)},onLineTrans:function(e,t,i,n){this.resetState=!0,this.afterLineMove(n)},afterLineMove:function(e){var t=this._lightComplexArray.get(0),n=this._lightComplexArray.get(1),r=a.getAttrTranslate(i(t._$$incidencePoint.node).attr("transform")),o={x:r[0],y:r[1]},l=this._config.LightComplex[0].Lines,c=e?e:0,h=t.getIncidenceRotateAngle(),u={degree:h,aPoint:o};if(c>=0){var g=s.pointInLine(u,l,c),f=t._configData.IncidenceLine.width;if(g){var _=s.getTwoPointDistance(g.acrossPoint,o);_<f?t.setIncidenceLineWidth(_):t.setIncidenceLineWidth(f)}else t.setIncidenceLineWidth(f)}var d=t.getRefractionRotateAngle(),p={degree:d,aPoint:o};if(c>=0){var y=s.pointInLine(p,l,c);if(this._acrossPoint=y,y){var w=y.acrossPoint,v=y.index;n.setCurLineIndex(v);var m=s.getTwoPointDistance(o,w);t.setRefractionLineWidth(m),n.setIncidenceLineVisible(!1),n.setIncidenceLineWidth(m),n.setGroupTranslate(w.x,w.y);var b=s.getRotateAngle(w,l[v].aPoint,o);n.setIncidenceXAxisAngle(b+l[v].degree),n.resetAngle(l[v].degree),"no_refract"==t._curRefAngle||"no_refract"==n._curRefAngle?this._lightComplexArray.setEnable(1,!1):this._lightComplexArray.setEnable(1,!0)}else{this._lightComplexArray.setEnable(1,!1);var A=t._configData.RefractionLine.width;t.setRefractionLineWidth(A)}}t.isPedal()&&n.isPedal()&&(this._lightComplexArray.setEnable(1,!1),t.setRefractionLineWidth(m+100))}}));return h.Extend=function(e){return Object.create(h).__include(e)},h}),s("js/refractor/refractor3",["js/refractor/refractor2","js/utils/utils","js/utils/graphMath","js/utils/svg"],function(e,t,s,a){var r=n("js/view/surface"),o=n("js/refractor/LightComplexArrayRef"),l=n("js/view/EqualAngleName"),c=n("js/view/ForeignView"),h=(n("js/view/sector"),
e.Extend({_CONFIG:{LightComplex:[{IncidenceLine:{defaultAngle:-13,rotateFixed:!0,clickAble:!0},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,refractionVisible:!1},IncidencePosX:682.8,IncidencePosY:399.5,DrawIndex:[[0,1,3],[4,5,6],[7,11],[8]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:510,y:678},bPoint:{x:830,y:163},degree:302,range:[{x:682.8,y:402.5},{x:682.8,y:402.5}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:32},{aPoint:{x:830,y:163},bPoint:{x:1152,y:678},degree:58,range:[{x:980.4,y:402.5},{x:980.4,y:402.5}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:58},{aPoint:{x:510,y:678},bPoint:{x:1152,y:678},degree:0,range:[{x:831,y:678},{x:831,y:678}],refractivity1:1.5,refractivity2:1,transAble:!0,pedalLineAngle:90}],_curLineIndex:0},{IncidenceLine:{defaultAngle:30,rotateFixed:!0,clickAble:!0,visible:!1},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,refractionVisible:!1},IncidencePosX:672,IncidencePosY:418.74580629534967,DrawIndex:[[0,1],[4,5,6],[7,11],[8]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:510,y:678},bPoint:{x:830,y:163},degree:302,range:[{x:682.8,y:402.5},{x:682.8,y:402.5}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:32},{aPoint:{x:830,y:163},bPoint:{x:1152,y:678},degree:58,range:[{x:980.4,y:402.5},{x:980.4,y:402.5}],refractivity1:1,refractivity2:1.5,transAble:!0,pedalLineAngle:58},{aPoint:{x:510,y:678},bPoint:{x:1152,y:678},degree:0,range:[{x:831,y:678},{x:831,y:678}],refractivity1:1.5,refractivity2:1,transAble:!0,pedalLineAngle:90}],_curLineIndex:0}],Surface:{width:600,defaultAngle:-58,rotatePosX:300,rotatePosY:0,visible:!1,clickAble:!0,aPoint:{x:500,y:678},bPoint:{x:830,y:163}},ForeignSurf:{cls:"bg_glasstria",width:771,height:635,translateX:510,translateY:163}},_TYPE:3,resetState:!1,create:function(e,n,s,a){var r=Object.create(this);return r._uuid=t.getUuid(),r._event=i.extend(!0,[],this._Event),r.initEvent(),r.__base(e,r._event),r.__proxyAll(["onSurfaceMove","onLineMove","onLineTrans","onLightFocusBlur","nameVisibleHandler"]),r._$$container=n,r._config=i.extend(!0,{},this._CONFIG,a&&a.configData||{}),r._option=s,r.createView(),r.afterCreateView(),r.initExtrasDrawCommand(),r.resetState=a&&a.resetState?a.resetState:this.resetState,r},createView:function(){var e=this;this._surface=r.create(this.__getEventBus(),this._config.Surface,this.onSurfaceMove,this._option.langData),this._lightComplexArray=o.create(this.__getEventBus(),this._config.LightComplex,this._option,this.onLineMove,this.onLineTrans,this.onLightFocusBlur),this._lightComplexArray.prependToView(this._$$container),this._equalAngleName=l.create(this._option.langData);var t=this._config.ForeignSurf.translateX,n=(t+this._config.ForeignSurf.width,this._config.ForeignSurf.translateY),s=(n+this._config.ForeignSurf.height,e._option.langData),a=s.refraction_air||"空气",h=s.refraction_prism||"三棱镜",u=new kity.Group,g=(new kity.Text).setContent(a).setAttr("x",0).setAttr("y",40).addClass("svg_text_l").addClass("color_black");u.addShape(g),this._$$container.prependItem(u);var f=i(g.node).width();u.setTranslate(1330-f,116),this._foreignSurf=new kity.Group;var _=new kity.Path("M 320 0 L 644 515 L0 515 Z");_.setStyle({"stroke-width":4,stroke:"#898989"});var d=c.create(this._config.ForeignSurf.cls,this._config.ForeignSurf.width,this._config.ForeignSurf.height);d.setTranslate(-34,-24),this.lineG=new kity.Group,this.lineG.addClass("hide_dom"),this.lineG.addShape(_),this._foreignSurf.addShape(this.lineG),i(this._foreignSurf.node).prepend(d.getView());var p=(new kity.Text).setContent(h).addClass("svg_text_l").addClass("color_glass");this._foreignSurf.addShape(p),this._$$container.prependItem(this._foreignSurf);var y=i(p.node).width();p.setAttr("x",328-y/2).setAttr("y",498),this._foreignSurf.setTranslate(this._config.ForeignSurf.translateX,this._config.ForeignSurf.translateY),this._$$container.addShape(this._surface.getView()),this._$$container.addShape(this._equalAngleName.getView()),this._lightComplexArray.gtIndexAppendToView(this._$$container),this._surface.setTranslate(370,412),this._surface.setNameVisible(this._option.nameVisible),this._config.EqualAngleName?(e._equalAngleNameHasShowBefore=this._config.EqualAngleName.visible,this._equalAngleName.setVisibility(this._config.EqualAngleName.visible)):this._equalAngleName.setVisibility(!1),this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree,!0),this.toCenter(),this.initEqualAngleNamePos()}}));return h.Extend=function(e){return Object.create(h).__include(e)},h}),s("js/refractor/refractor4",["js/reflector/baseReflector","js/utils/utils","js/utils/graphMath","js/utils/svg","js/view/sector"],function(e,t,s,a,r){var o=n("js/view/surface"),l=n("js/refractor/LightComplexArrayRef"),c=n("js/view/EqualAngleName"),h=n("js/view/ForeignView"),u=(n("js/config/eventKey"),e({_CONFIG:{LightComplex:[{IncidenceLine:{width:425,arrowPos:200,defaultAngle:312,rotateFixed:!0,clickAble:!1,rotateFixedAfterDraw:!0},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1,width:440,arrowPos:170,PedalWidth:290},NormalLine:{width:460,lineVisible:!1,pointNameVisible:!1},InverseRefractionLine:{width:200,defaultAngle:333},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,refractionVisible:!1},IncidencePosX:370,IncidencePosY:-60,DrawIndex:[[0,1,3],[4,5,6],[7,11,8],[13],[14]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:0,y:435},bPoint:{x:1420,y:435},degree:0,range:[{x:710,y:435},{x:710,y:435}],refractivity1:1,refractivity2:1.333,transAble:!0,pedalLineAngle:0}],_curLineIndex:0},{IncidenceLine:{width:370,arrowPos:190,defaultAngle:302,rotateFixed:!0,clickAble:!1,rotateFixedAfterDraw:!0},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1,width:440,arrowPos:150,PedalWidth:290},NormalLine:{width:460,lineVisible:!1,pointNameVisible:!1},InverseRefractionLine:{width:125,defaultAngle:315},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,refractionVisible:!1},IncidencePosX:280,IncidencePosY:-60,DrawIndex:[[0,1,3],[4,5,6],[7,11,8],[13],[14]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:0,y:435},bPoint:{x:1420,y:435},degree:0,range:[{x:710,y:435},{x:710,y:435}],refractivity1:1,refractivity2:1.333,transAble:!0,pedalLineAngle:0}],_curLineIndex:0}],Surface:{width:1420,defaultAngle:0,rotatePosX:710,rotatePosY:4,visible:!1,clickAble:!0,type:o.Type.tl},ForeignSurf:{cls:"bg_water",width:1420,height:396,translateX:0,translateY:502}},_TYPE:4,_Event:[],_event:null,_$$container:null,_incidencePointPos:null,_surfacePagePos:null,_option:null,_equalAngleNameHasShowBefore:!1,resetState:!1,MaterialObjectVisibility:!1,create:function(e,n,s,a){var r=Object.create(this);return r._uuid=t.getUuid(),r._event=i.extend(!0,[],this._Event),r.initEvent(),r.__base(e,r._event),r.__proxyAll(["onSurfaceMove","onLineMove","onLineTrans","onLightFocusBlur","nameVisibleHandler"]),r._$$container=n,r._config=i.extend(!0,{},this._CONFIG,a&&a.configData||{}),r._option=s,r.MaterialObjectVisibility=a&&a.MaterialObjectVisibility?a.MaterialObjectVisibility:this.MaterialObjectVisibility,r.createView(),r.afterCreateView(),r.initExtrasDrawCommand(),r.resetState=a&&a.resetState?a.resetState:this.resetState,r},initEvent:function(){},createView:function(){var e=this;this._surface=o.create(this.__getEventBus(),this._config.Surface,this.onSurfaceMove,this._option.langData),this._lightComplexArray=l.create(this.__getEventBus(),this._config.LightComplex,this._option,this.onLineMove,this.onLineTrans,this.onLightFocusBlur),this._lightComplexArray.appendToView(this._$$container),this._equalAngleName=c.create(this._option.langData);var t=this._config.ForeignSurf.translateX,n=(t+this._config.ForeignSurf.width,this._config.ForeignSurf.translateY),s=(n+this._config.ForeignSurf.height,e._option.langData),a=s.refraction_air||"空气",r=s.refraction_water||"水",u=new kity.Group;u.setId("waterBgGroup");var g=new kity.Text(r);g.addClass("svg_text_l").addClass("color_white"),u.appendItem(g);var f=h.create("bg_water",1420,396);f.setTranslate(0,-64),i(u.node).prepend(f.getView()),this._$$container.prependItem(u);var _=i(g.node).width();g.setX(1339-_).setY(80),u.setTranslate(-450,2);var d=new kity.Group;d.setId("airGroup4");var p=new kity.Text(a);p.addClass("svg_text_l").addClass("color_black"),d.appendItem(p),this._$$container.addItem(d,1);var y=i(p.node).width();d.setTranslate(944-y,-180);var w=new kity.Group;w.setId("eyeGroup"),w.setTranslate(630,-350);var v=h.create("icon_eye","64","44");i(w.node).append(v.getView()),this._$$container.addItem(w,2);var m=new kity.Group;m.setId("materialObjectGroup4"),m.setTranslate(-8,200);var b=new kity.Group;b.setId("realFishGroup");var A=h.create("real_fish","90","78");i(b.node).append(A.getView()),m.addItem(b);var x=new kity.Group;x.setId("realGoldCoinGroup"),x.setStyle({display:"none"});var V=h.create("real_coin","85","82");i(x.node).append(V.getView()),m.addItem(x);var L=new kity.Group;L.setId("realChopsticksGroup"),L.setStyle({display:"none"}),L.setRotate(-102,50,5),L.setTranslate(12,0);var $=h.create("real_chopsticks","558","27");i(L.node).append($.getView()),m.addItem(L);var I=new kity.Group;I.setId("arrowButtonGroup4"),I.setTranslate(-70,18),I.setRotate(180,28,28);var S=h.create("btn_openlist","64","64");i(I.node).append(S.getView()),m.addItem(I),this._$$container.addItem(m,4);var T=new kity.Group;this.MaterialObjectImagingGroup=T,T.setId("materialObjectImagingGroup4"),T.setStyle({display:this.MaterialObjectVisibility?"inline-block":"none"}),T.setTranslate(100,-20);var P=new kity.Group;P.setId("imagingFishGroup");var R=h.create("real_fish","90","78");i(P.node).append(R.getView()),P.addClass("fake_fish"),T.addItem(P);var C=new kity.Group;C.setId("imagingGoldCoinGroup"),C.setStyle({display:"none"});var D=h.create("real_coin","85","82");i(C.node).append(D.getView()),C.addClass("fake_coin"),T.addItem(C);var N=new kity.Group;N.setId("imagingChopsticksGroup"),N.setRotate(-154,30,23),N.setTranslate(25,0),N.setStyle({display:"none"});var B=h.create("real_chopsticks","558","27");i(B.getView()).css({width:190,height:27,overflow:"hidden"}),B.setForeignWidth(190),i(N.node).append(B.getView()),N.addClass("fake_chopsticks"),T.addItem(N),this._$$container.addItem(T,3),this._$$container.addShape(this._surface.getView()),this._$$container.addShape(this._equalAngleName.getView()),this._lightComplexArray.gtIndexAppendToView(this._$$container),this._surface.setTranslate(0,this._config.LightComplex[0].IncidencePosY),this._surface.setNameVisible(this._option.nameVisible),this._config.EqualAngleName?(e._equalAngleNameHasShowBefore=this._config.EqualAngleName.visible,this._equalAngleName.setVisibility(this._config.EqualAngleName.visible)):this._equalAngleName.setVisibility(!1),this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree,!0),this.toCenter();var j=i(I.node).parents("#Refraction");i(I.node).off("click"),j.find("._refraction_tab_container4 ._tab_content li").removeClass("on"),j.find("._refraction_tab_container4 ._tab_content li").first().addClass("on"),i(I.node).click(function(e){e.preventDefault(),e.stopPropagation(),j.find("._refraction_tab_container4").removeClass("hide_dom"),j.find("#arrowButtonGroup4").hide()})},initExtrasDrawCommand:function(){},afterCreateView:function(){},initEqualAngleNamePos:function(){var e=this._$$container.getTransform().m,t=this._equalAngleName.getView().getWidth(),i=this._equalAngleName.getView().getHeight();this._equalAngleName.setTranslate(this._option.viewPortWidth-e.e-t-135,-(this._option.viewPortHeight-e.f-i)+20)},toCenter:function(){this._$$container.setTranslate(this._option.viewPortWidth/2-this.getWidth()/2,this._option.viewPortHeight/2+10)},resetAngle:function(e,t){this._surface.rotate(e);var i=this._surface.getRotateAngle()||0;this._lightComplexArray.resetAngle(i,t)},getData:function(){var e={};return e.type=this._TYPE,e.configData=this._lightComplexArray.getData(),e.configData.Surface={defaultAngle:this._surface.getRotateAngle(),visible:!this._surface.isVisibilityHidden()},e.configData.EqualAngleName={visible:!this._equalAngleName.isVisibilityHidden()},e.resetState=this.resetState,e.MaterialObjectVisibility=this._lightComplexArray.getHasdrawMaterialObjectImagingGroup4(),e},getMoveRotateAngle:function(e){var t=e.currentPos,i=e.lastPos;return s.getRotateAngle(this._surface.getRotateOffsetPos(),i,t)},onSurfaceMove:function(e,t){if("move"===t){var i=this.getMoveRotateAngle(e);this._lightComplexArray.rotateAble(i)&&(this.resetAngle(i),this._lightComplexArray.around(this._surface.getRotateAngle(),this._config.Surface.rotatePosX))}else"aftermove"===t&&this._lightComplexArray.adsorptionPedal();this.initEqualAngleVisibility(),this.resetState=!0},onLineMove:function(e,t,i){this.resetState=!0,this.initEqualAngleVisibility(),this.afterLineMove(i)},onLineTrans:function(e,t,i,n){this.resetState=!0,this.afterLineMove(n)},onLightFocusBlur:function(e){this.lineG&&("focus"==e?this.lineG.removeClass("hide_dom"):this.lineG.addClass("hide_dom"))},afterLineMove:function(e){},initEqualAngleVisibility:function(){this._lightComplexArray.isPedal()?(this._equalAngleNameHasShowBefore||this._lightComplexArray.get(0).getTwoLineVisible())&&this._equalAngleName.setVisibility(!0):this._equalAngleName.setVisibility(!1)},getWidth:function(){return this._config.Surface.width},drawAll:function(){var e=this;this.resetState=!0,this._lightComplexArray.drawAllAll(function(){e.setNamePos()})},drawNext:function(){var e=this;this.resetState=!0,this._lightComplexArray.drawAllNext(function(){e.setNamePos()})},toCenter:function(){this._$$container.setTranslate(450,500)},setNamePos:function(){var e=this,t=e._lightComplexArray.get(0),i=e._lightComplexArray.get(1);t.setNamePosByType(r.Type.Incidence,-60,120),i.setNamePosByType(r.Type.Incidence,-55,120),t.setNamePosByType(r.Type.Refraction,30,-80),i.setNamePosByType(r.Type.Refraction,0,-90)},setMaterialObjectVisibility:function(e){this.MaterialObjectImagingGroup.setStyle({display:e?"inline-block":"none"})},setResetState:function(e){this.resetState=e}}));return u.Extend=function(e){return Object.create(u).__include(e)},u}),s("js/refractor/refractor5",["js/refractor/refractor4","js/utils/utils","js/utils/graphMath","js/utils/svg","js/view/sector"],function(e,t,s,a,r){var o=n("js/view/surface"),l=n("js/refractor/LightComplexArrayRef"),c=n("js/view/EqualAngleName"),h=n("js/view/ForeignView"),u=(n("js/config/eventKey"),e.Extend({_CONFIG:{LightComplex:[{IncidenceLine:{width:145,arrowPos:50,defaultAngle:135,rotateFixed:!0,clickAble:!1,rotateFixedAfterDraw:!0},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1},NormalLine:{width:300,lineVisible:!1,pointNameVisible:!1},InverseRefractionLine:{width:420,defaultAngle:132},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,refractionVisible:!1},IncidencePosX:550,IncidencePosY:0,DrawIndex:[[0,1,3],[4,5,6],[7,11,8],[13],[15]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:0,y:435},bPoint:{x:1420,y:435},degree:0,range:[{x:710,y:435},{x:710,y:435}],refractivity1:1,refractivity2:1.333,transAble:!0,pedalLineAngle:0}],_curLineIndex:0},{IncidenceLine:{width:225,arrowPos:100,defaultAngle:153,rotateFixed:!0,clickAble:!1,rotateFixedAfterDraw:!0},RefractionLine:{visible:!1,rotateFixed:!0,clickAble:!1,width:200},NormalLine:{width:300,lineVisible:!1,pointNameVisible:!1},InverseRefractionLine:{width:480,defaultAngle:120},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,refractionVisible:!1},IncidencePosX:450,IncidencePosY:0,DrawIndex:[[0,1,3],[4,5,6],[7,11,8],[13],[15]],PedalDrawIndex:[[1,5,6,8,10]],NoRefracDrawIndex:[],Visible:!0,Lines:[{aPoint:{x:0,y:435},bPoint:{x:1420,y:435},degree:0,range:[{x:710,y:435},{x:710,y:435}],refractivity1:1,refractivity2:1.333,transAble:!0,pedalLineAngle:0}],_curLineIndex:0}],Surface:{width:1420,defaultAngle:0,rotatePosX:710,rotatePosY:4,visible:!1,clickAble:!0,type:o.Type.tl},ForeignSurf:{cls:"bg_water",width:1520,height:396,translateX:0,translateY:502}},_TYPE:5,_Event:[],_event:null,_$$container:null,_incidencePointPos:null,_surfacePagePos:null,_option:null,_equalAngleNameHasShowBefore:!1,resetState:!1,MaterialObjectVisibility:!1,create:function(e,n,s,a){var r=Object.create(this);return r._uuid=t.getUuid(),r._event=i.extend(!0,[],this._Event),r.initEvent(),r.__base(e,r._event),r.__proxyAll(["onSurfaceMove","onLineMove","onLineTrans","onLightFocusBlur","nameVisibleHandler"]),r._$$container=n,r._config=i.extend(!0,{},this._CONFIG,a&&a.configData||{}),r._option=s,r.MaterialObjectVisibility=a&&a.MaterialObjectVisibility?a.MaterialObjectVisibility:this.MaterialObjectVisibility,r.createView(),r.afterCreateView(),r.initExtrasDrawCommand(),r.resetState=a&&a.resetState?a.resetState:this.resetState,r},initEvent:function(){},createView:function(){var e=this;this._surface=o.create(this.__getEventBus(),this._config.Surface,this.onSurfaceMove,this._option.langData),this._lightComplexArray=l.create(this.__getEventBus(),this._config.LightComplex,this._option,this.onLineMove,this.onLineTrans,this.onLightFocusBlur),this._lightComplexArray.appendToView(this._$$container),this._equalAngleName=c.create(this._option.langData);var t=this._config.ForeignSurf.translateX,n=(t+this._config.ForeignSurf.width,this._config.ForeignSurf.translateY),s=(n+this._config.ForeignSurf.height,e._option.langData),a=s.refraction_air||"空气",r=s.refraction_water||"水",u=new kity.Group;u.setId("waterGroup");var g=new kity.Text(r);g.addClass("svg_text_l").addClass("color_white"),u.appendItem(g);var f=h.create("bg_waterground",1520,396);f.setTranslate(0,-64),i(u.node).prepend(f.getView()),this._$$container.prependItem(u),u.setTranslate(-450,2);i(g.node).width();g.setX(120).setY(190);var _=new kity.Group;_.setId("airGroup");var d=new kity.Text(a);d.addClass("svg_text_l").addClass("color_black").setX(0).setY(40),_.appendItem(d),this._$$container.addItem(_,1);var p=i(d.node).width();_.setTranslate(1050-p,-360);var y=new kity.Group;y.setId("eyeGroup"),y.setTranslate(306,172);var w=h.create("icon_eye","64","44");i(y.node).append(w.getView()),this._$$container.addItem(y,2);var v=new kity.Group;v.setId("materialObjectGroup5"),v.setTranslate(378,-250);var m=new kity.Group;m.setId("realTreeGroup");var b=h.create("real_tree","383","252");i(m.node).append(b.getView()),v.addItem(m);var A=new kity.Group;A.setId("realLightHouseGroup"),A.setStyle({display:"none"});var x=h.create("real_lighthouse","383","252");i(A.node).append(x.getView()),v.addItem(A);var V=new kity.Group;V.setId("realHumanGroup"),V.setStyle({display:"none"});var L=h.create("real_human","383","252");i(V.node).append(L.getView()),v.addItem(V);var $=new kity.Group;$.setId("arrowButtonGroup5"),$.setTranslate(350,180);var I=h.create("btn_openlist","64","64");i($.node).append(I.getView()),v.addItem($),this._$$container.addItem(v,3);var S=new kity.Group;this.MaterialObjectImagingGroup=S,S.setId("materialObjectImagingGroup5"),S.setStyle({display:this.MaterialObjectVisibility?"inline-block":"none"}),S.setTranslate(500,-500);var T=new kity.Group;T.setId("imagingTreeGroup");var P=h.create("real_tree","383","252");i(T.node).append(P.getView()),T.addClass("fake_tree"),S.addItem(T);var R=new kity.Group;R.setId("imagingLightHouseGroup"),R.setStyle({display:"none"});var C=h.create("real_lighthouse","383","252");i(R.node).append(C.getView()),R.addClass("fake_lighthouse"),S.addItem(R);var D=new kity.Group;D.setId("imagingHumanGroup"),D.setStyle({display:"none"});var N=h.create("real_human","383","252");i(D.node).append(N.getView()),D.addClass("fake_human"),S.addItem(D),this._$$container.addShape(S),this._$$container.addShape(this._surface.getView()),this._$$container.addShape(this._equalAngleName.getView()),this._lightComplexArray.gtIndexAppendToView(this._$$container),this._surface.setTranslate(0,this._config.LightComplex[0].IncidencePosY),this._surface.setNameVisible(this._option.nameVisible),this._config.EqualAngleName?(e._equalAngleNameHasShowBefore=this._config.EqualAngleName.visible,this._equalAngleName.setVisibility(this._config.EqualAngleName.visible)):this._equalAngleName.setVisibility(!1),this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree,!0),this.toCenter();var B=i($.node).parents("#Refraction");i($.node).off("click"),B.find("._refraction_tab_container5 ._tab_content li").removeClass("on"),B.find("._refraction_tab_container5 ._tab_content li").first().addClass("on"),i($.node).click(function(e){e.preventDefault(),e.stopPropagation(),B.find("._refraction_tab_container5").removeClass("hide_dom"),B.find("#arrowButtonGroup5").hide()})},toCenter:function(){this._$$container.setTranslate(380,500)},getData:function(){var e={};return e.type=this._TYPE,e.configData=this._lightComplexArray.getData(),e.configData.Surface={defaultAngle:this._surface.getRotateAngle(),visible:!this._surface.isVisibilityHidden()},e.configData.EqualAngleName={visible:!this._equalAngleName.isVisibilityHidden()},e.resetState=this.resetState,e.MaterialObjectVisibility=this._lightComplexArray.getHasdrawMaterialObjectImagingGroup5(),e},setNamePos:function(){var e=this,t=e._lightComplexArray.get(0),i=e._lightComplexArray.get(1);t.setNamePosByType(r.Type.Incidence,5,-80),i.setNamePosByType(r.Type.Incidence,15,-80),t.setNamePosByType(r.Type.Refraction,-55,130),i.setNamePosByType(r.Type.Refraction,-90,130)}}));return u.Extend=function(e){return Object.create(u).__include(e)},u}),s("js/refractor/refractorFactory",["js/base/base","js/refractor/refractor1","js/refractor/refractor2","js/refractor/refractor3","js/refractor/refractor4","js/refractor/refractor5"],function(e,t,i,n,s,a){var r={getRefractor:function(e,r,o,l,c){return 1===e?t.create(r,o,l,c):2===e?i.create(r,o,l,c):3===e?n.create(r,o,l,c):4===e?s.create(r,o,l,c):5===e?a.create(r,o,l,c):void 0}};return r}),s("js/refractor/refractorMain",["js/base/Base","js/utils/eventBus","js/utils/string","js/utils/utils","js/config/eventKey","js/refractor/refractorFactory","js/utils/view"],function(e,s,a,r,o,l,c){var h=n("js/reflector/domEvent"),u=n("js/refractor/btn"),g=n("js/config/lang"),f="1.0.0",_='<div class="${cls}" id="${id}"></div>',d={x:0,y:0,width:1420,height:900},p={create:function(e){var t=Object.create(this);for(var n in e)"langData"===n?t[n]=i.extend(!0,{},g,e.langData):t[n]=e[n];return t},viewPortWidth:d.width,viewPortHeight:d.height,refractorType:[1,2,3,4,5],nameVisible:!0,surfaceAngleVisible:!0,normalAngleVisible:!0,reflector5NameEnable:!1,lock:!1,langData:g},y=e({_$$paper:null,_$$paperItems:[],_refractors:[],_currentIndex:0,_id:null,_init:!1,create:function(e){var t=s.create(),i=Object.create(this);return i._option=p.create(e),i._id=r.getUuid(),i._$$paper=[],i._$$paperItems=[],i._refractors=[],i.__base(t,[]),i.__on("insidechange",function(e){i._init&&i.__triggerEvent("change",e)}),i},render:function(e){this._init=!1;var n=typeof e;"string"===n?e=t.getElementById(e):"object"===n&&e instanceof jQuery&&(e=e[0]);var s=i(a.template(_,{cls:"fm",id:this._id}));i(e).html(s),this._paper=new kity.Paper(s[0]),this._paper.setViewBox(0,0,this._option.viewPortWidth,this._option.viewPortHeight);var r=h.create(this._paper,this.__getEventBus(),this._option);r.bindDomEvent(),this.createRefractor(),this._init=!0,this._btn=u.create(this.__getEventBus(),this),this.__triggerEvent("insidechange","init")},_createRefractor:function(e,t,i){var n=this,s=(new kity.Group).setId("item_"+e);s.setAttr("class","_lr_item"),n._$$paperItems.push(s),n._paper.addShape(s);var a=l.getRefractor(t,n.__getEventBus(),s,n._option,i);return a&&a.afterInit(),c.setVisibility(s,e===n._currentIndex),n._refractors.push(a),a},createRefractor:function(){var e=this;this._refractors=[],this._$$paperItems=[];var t=function(t,i,n){var s=(new kity.Group).setId("item_"+t);s.setAttr("class","_lr_item"),e._$$paperItems.push(s),e._paper.addShape(s);var a=l.getRefractor(i,e.__getEventBus(),s,e._option,n);return c.setVisibility(s,t===e._currentIndex),e._refractors.push(a),a};if(this._data&&this._data.data&&this._data.data.length>0){var i=this._data.data;this._currentIndex=this._data.currentIndex;for(var n,s,a=0;a<i.length;a++){var r=i[a],o=t(a,r.type,r);4==r.type&&(n=o),5==r.type&&(s=o)}this.setNormalAngleVisible(this._data.option.normalAngleVisible),this.setSurfaceAngleVisible(this._data.option.surfaceAngleVisible),this.setNameVisible(this._data.option.nameVisible),n&&n.setNamePos(),s&&s.setNamePos()}else for(var a=0;a<this._option.refractorType.length;a++){var h=this._option.refractorType[a];t(a,h)}},setData:function(e){e.version&&e.data&&(this._data=e)},getData:function(){var e={};return e.version=f,e.data=[],e.currentIndex=this._currentIndex,this._refractors.forEach(function(t){t&&e.data.push(t.getData())}),e.option={nameVisible:this._option.nameVisible,surfaceAngleVisible:this._option.surfaceAngleVisible,normalAngleVisible:this._option.normalAngleVisible},e},on:function(e,t,i){this.__getEventBus().on(e,t,i)},off:function(e,t,i){this.__getEventBus().off(e,t,i)},show:function(e){this.__triggerEvent(o.Blur),this._currentIndex=e,this._$$paperItems.forEach(function(t,i){c.setVisibility(t,e===i)}),this.__triggerEvent("insidechange","showChange")},getCurrentIndex:function(){return this._currentIndex},setSurfaceAngleVisible:function(e){this._option.surfaceAngleVisible=e,this.__triggerEvent(o.SurfaceAngleVisible,e)},getSurfaceAngleVisible:function(){return this._option.surfaceAngleVisible},setNormalAngleVisible:function(e){this._option.normalAngleVisible=e,this.__triggerEvent(o.NormalAngleVisible,e),this._refractors[3].setNamePos(),this._refractors[4].setNamePos()},getNormalAngleVisible:function(){return this._option.normalAngleVisible},setNameVisible:function(e){this._option.nameVisible=e,this.__triggerEvent(o.NameVisible,e),this._refractors[3].setNamePos(),this._refractors[4].setNamePos()},getNameVisible:function(){return this._option.nameVisible},getCurrentRefractor:function(){return this._refractors[this._currentIndex]},drawAll:function(){this.__triggerEvent(o.Blur),this.getCurrentRefractor().drawAll()},drawNext:function(){this.__triggerEvent(o.Blur),this.getCurrentRefractor().drawNext()},hasNext:function(){return this.getCurrentRefractor().hasNext()},reset:function(e){i.extend(this._option,e),this._$$paperItems[this._currentIndex].clear();var t=l.getRefractor(this._refractors[this._currentIndex].getType(),this.__getEventBus(),this._$$paperItems[this._currentIndex],this._option,{});this._refractors[this._currentIndex]=t,this.__triggerEvent("insidechange","reset")},getCurRefResetState:function(){return this.getCurrentRefractor().resetState},setCurRefResetState:function(e){this.getCurrentRefractor().setResetState(e),this.__triggerEvent("insidechange","reset")},getFirRefAngle:function(){return this.getCurrentRefractor()._lightComplexArray.getFirRefAngle()},getFirIncidenceAngle:function(){return this.getCurrentRefractor()._lightComplexArray.getFirIncidenceAngle()},destroy:function(){}});return y}),s("js/refractor/lightComplexRef/draw",["js/view/sector","js/utils/utils","js/utils/view"],function(e,t,n){var s={_hasDrawBegin:!1,_hasDrawNext:!0,setDrawBegin:function(e){this._hasDrawBegin=e,this._configData.IncidenceLine.rotateFixedAfterDraw&&(this._configData.IncidenceLine.rotateFixed=!0),this._configData.RefractionLine.rotateFixedAfterDraw&&(this._configData.RefractionLine.rotateFixed=!0)},getDrawBegin:function(){return this._hasDrawBegin},drawAll:function(e){if(!this.isVisibilityHidden()){this.setSectorInsideDrawStatus(!0),this.setDrawBegin(!0);var t=this;this._drawCommand.stop(function(){t._drawCommand.drawAll(null,!1),t.adsorptionPedal(),t.__triggerEvent("insidechange","drawAll"),e&&e()}),this._hasDrawNext=!1}},drawNext:function(e){if(!this.isVisibilityHidden()){this.setDrawBegin(!0);var t=this;this._drawCommand.drawNext(function(){t._hasDrawNext=t._drawCommand.hasNext(),t.adsorptionPedal(),t.__triggerEvent("insidechange","drawNext"),e&&e()},!0)}},hasNext:function(){return!this.isVisibilityHidden()&&this._drawCommand.hasNext()},hasNextWidthOutVisibilityStatus:function(){return this._hasDrawNext},initDrawCommand:function(){var t=this;t._hsdrawIncidencePoint=!1,t._hsdrawSectorRefraction=!1,t._hsDrawRefractionLine=!1,t._hsdrawInverseRefractionLine=!1,t._hsdrawMaterialObjectImagingGroup4=!1,t._hsdrawMaterialObjectImagingGroup5=!1,this._drawCommand.push(function(e,s){t._hsdrawIncidencePoint=!0,s?(n.setVisibility(t._$$incidencePoint,!0),i(t._$$incidencePoint.node).fadeIn(300).fadeOut(300).fadeIn(300,function(){n.setVisibility(t._$$incidencePoint,!1),e.resolve()})):e.resolve()},function(){return t._hsdrawIncidencePoint}),this._drawCommand.push(function(e,i){t._normalLine.setPointNameVisibility(t._option.nameVisible,!0),e.resolve()},function(){return t._normalLine.getPointNameVisible()}),this._drawCommand.push(function(i,n){t._option.surfaceAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.SurfaceIn,!0),t.setSectorInsideDrawStatus(!0,e.Type.SurfaceIn),i.resolve()},function(){return!(t._option.surfaceAngleVisible===!0&&!t.isPedal())||!t._surfaceInSector.isVisibilityHidden()}),this._drawCommand.push(function(e,i){t._incidenceLine.setVisibility(!0),e.resolve()},function(){return!t._incidenceLine.isVisibilityHidden()}),this._drawCommand.push(function(i,n){t._option.normalAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.Incidence,!0),t.setSectorInsideDrawStatus(!0,e.Type.Incidence),i.resolve()},function(){return!(t._option.normalAngleVisible===!0&&!t.isPedal()&&90!=Math.round(t.getSectorAngle(e.Type.Incidence)))||!t._incidenceSector.isVisibilityHidden()}),this._drawCommand.push(function(e){t._normalLine.setLineVisibility(t._option.nameVisible,!0),e.resolve()},function(){return t._normalLine.getLineVisible()}),this._drawCommand.push(function(e){t._pedalLine.setVisibility(!0),e.resolve()},function(){return!t._pedalLine.isVisibilityHidden()}),this._drawCommand.push(function(i,n){t._option.normalAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.Refraction,!0),t._hsdrawSectorRefraction=!0,"no_refract"==t._curRefAngle&&t.setSectorVisibilityByType(e.Type.Refraction,!1),i.resolve()},function(){return!(t._option.normalAngleVisible===!0&&!t.isPedal())||!t._refractionSector.isVisibilityHidden()}),this._drawCommand.push(function(e){t._refractionLine.setVisibility(!0),t._hsDrawRefractionLine=!0,"no_refract"==t._curRefAngle&&t._refractionLine.setVisibility(!1),e.resolve()},function(){return t._hsDrawRefractionLine}),this._drawCommand.push(function(i){t._option.surfaceAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.SurfaceOut,!0),t.setSectorInsideDrawStatus(!0,e.Type.SurfaceOut),i.resolve()},function(){return!(t._option.surfaceAngleVisible===!0&&!t.isPedal()&&90!=Math.round(t.getSectorAngle(e.Type.Incidence)))||!t._surfaceOutSector.isVisibilityHidden()}),this._drawCommand.push(function(i){t._incidenceLine.setVisibility(!0),t._option.normalAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.Incidence,!0),t.setSectorInsideDrawStatus(!0,e.Type.Incidence),t._refractionLine.setVisibility(!0),t._option.normalAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.Refraction,!0),t.setSectorInsideDrawStatus(!0,e.Type.Refraction),t._hsdrawSectorRefraction=!0,t._pedalLine.setVisibility(!0),t._hsdrawIncidencePoint=!0,t._hsDrawRefractionLine=!0,t._draw11=!0,i.resolve()},function(){return!t._refractionLine.isVisibilityHidden()&&!t._incidenceLine.isVisibilityHidden()}),t._draw11=!1,this._drawCommand.push(function(e,i){t._draw11=!0,t._option.normalAngleVisible===!1&&i?t.sectorAnimateDisappear(function(){e.resolve()}):e.resolve();
},function(){return!!t._draw11}),this._drawCommand.push(function(e){e.resolve()},function(){return!0}),this._drawCommand.push(function(e){t._hsdrawInverseRefractionLine=!0,t._inverseRefractionLine.setLineVisibility(!1,!0),e.resolve()},function(){return t._hsdrawInverseRefractionLine}),this._drawCommand.push(function(e){t._hsdrawMaterialObjectImagingGroup4=!0,i("#materialObjectImagingGroup4").show(),e.resolve()},function(){return t._hsdrawMaterialObjectImagingGroup4}),this._drawCommand.push(function(e){t._hsdrawMaterialObjectImagingGroup5=!0,i("#materialObjectImagingGroup5").show(),e.resolve()},function(){return t._hsdrawMaterialObjectImagingGroup5}),this.initDrawStatus()},getCommandLength:function(){return this._drawCommand.getCommandLength()},pushDrawCommand:function(e,t){this._drawCommand.push(e,t)},setDrawIndex:function(e){this._configData.DrawIndex=e,this.isPedal()||this._drawCommand.setDrawIndex(e)},setPedalDrawIndex:function(e){this._configData.PedalDrawIndex=e,this.isPedal()&&this._drawCommand.setDrawIndex(e)},setIncidenceShortPedalView:function(e){this._incidenceLine.setVisibility(!0),this._refractionLine.setVisibility(!0),this._incidenceLine.setWidth(e||this._configData.IncidenceLine.PedalWidth),e===this._configData.IncidenceLine.PedalWidth&&this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos),this._refractionLine.setWidth(this._configData.RefractionLine.PedalWidth),this._refractionLine.setArrowPos(this._configData.RefractionLine.PedalArrowPos),this.resetLinePos()},isDrawIncidenceShortPedalView:function(e){return!this._refractionLine.isVisibilityHidden()&&!this._incidenceLine.isVisibilityHidden()&&this._incidenceLine.getWidth()===(e||this._configData.IncidenceLine.PedalWidth)},getHasDrawIncidencePoint:function(){return this._hsdrawIncidencePoint},getHasDrawSectorAnimateDisappear:function(){return this._draw11},getHasDrawSectorRefraction:function(){return this._hsdrawSectorRefraction},getHasDrawRefractionLine:function(){return this._hsDrawRefractionLine},getHasdrawInverseRefractionLine:function(){return this._hsdrawInverseRefractionLine},getHasdrawMaterialObjectImagingGroup4:function(){return this._hsdrawMaterialObjectImagingGroup4},getHasdrawMaterialObjectImagingGroup5:function(){return this._hsdrawMaterialObjectImagingGroup5},initDrawStatus:function(){var e=this._configData.Draw;e&&(this._hsdrawIncidencePoint=e.incidencePoint,this._draw11=e.sectorAnimateDisappear,this._hsdrawSectorRefraction=e.sectorRefraction,this._hsDrawRefractionLine=e.refractionLine,this._hsdrawInverseRefractionLine=e.inverserefractionline,this._hsdrawMaterialObjectImagingGroup4=e.materialObjectImagingGroup4,this._hsdrawMaterialObjectImagingGroup5=e.materialObjectImagingGroup5,"undefined"!=typeof e.hasNext&&(this._hasDrawNext=e.hasNext))}};return s}),s("js/refractor/lightComplexRef/event",["js/view/sector"],function(e){var t={surfaceAngleVisibleHandler:function(t){this.setSectorVisibilityByOutSideLogic(e.Type.SurfaceIn,t),this.setSectorVisibilityByOutSideLogic(e.Type.SurfaceOut,t)},normalAngleVisibleHandler:function(t){this.setSectorVisibilityByOutSideLogic(e.Type.Incidence,t),"no_refract"!=this._curRefAngle&&this.setSectorVisibilityByOutSideLogic(e.Type.Refraction,t)},setNameVisible:function(e){this._incidenceLine.setNameVisible(e),this._refractionLine.setNameVisible(e),this.getNameGroup().setNameVisible(e),this._normalLine.setNameVisible(e)},nameVisibleHandler:function(e){this.setNameVisible(e)}};return t}),s("js/refractor/lightComplexRef/main",["js/reflector/baseReflector","js/utils/utils","js/utils/graphMath","js/config/style","js/config/eventKey","js/utils/view","js/utils/svg"],function(e,t,s,a,r,o,l){var c=n("js/view/BaseView"),h=n("js/view/sector"),u=n("js/view/LightLine"),g=n("js/view/NormalLine"),f=n("js/view/InverseRefractionLine"),_=(n("js/view/NameGroup"),n("js/view/PedalLine")),d=n("js/utils/DrawCommand"),p=a.IncidencePoint,y={onLightMove:null,onLightTrans:null,IncidenceLine:{width:250,arrowPos:145,defaultAngle:50,visible:!0,clickAble:!0,rotateFixed:!0,PedalWidth:250,PedalArrowPos:150,rotateFixedAfterDraw:!1,highLineZIndex:!1,nameEnable:!0,arrowVisible:!0},RefractionLine:{width:250,arrowPos:73,visible:!0,clickAble:!0,rotateFixed:!1,PedalWidth:250,PedalArrowPos:150,rotateFixedAfterDraw:!1,nameEnable:!0,arrowVisible:!0},NormalLine:{width:470,lineVisible:!1,pointNameVisible:!1,visible:!0},InverseRefractionLine:{width:310,lineVisible:!1,pointNameVisible:!1,visible:!0},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!0,refractionVisible:!0,incidenceR:70,refractionR:70,surfaceR:60},IncidencePointVisible:!1,PedalLineVisible:!1,IncidencePosX:0,IncidencePosY:0,DrawIndex:[0,1,2,3],PedalDrawIndex:[[0,1],[5,6],[10]],NoRefracDrawIndex:[[0,1,3],[4,5,6]],Visible:!0,view90PedalLineVisible:!0,nameEventEnable:!0,Lines:[{aPoint:{x:0,y:435},bPoint:{x:1420,y:435},degree:0,range:[{x:710,y:435},{x:710,y:435}],refractivity1:1,refractivity2:1.333,transAble:!0,pedalLineAngle:90}],_curLineIndex:0},w=c({_data:null,_configData:null,_onLightMove:null,_onLightTrans:null,_onLightFocusBlur:null,_option:null,_linePedalChangeLock:!1,_hasDrawNext:!0,_surfaceLines:[],_surfacelinesKb:[],_curLineIndex:0,create:function(e,n,s,a,o,l){var c=Object.create(this);c._uuid=t.getUuid(),c._configData=i.extend(!0,{},y,n),c._configData.DrawIndex=i.extend(!0,[],n.DrawIndex||y.DrawIndex),c._configData.PedalDrawIndex=i.extend(!0,[],n.PedalDrawIndex||y.PedalDrawIndex),c._configData.NoRefracDrawIndex=i.extend(!0,[],n.NoRefracDrawIndex||y.NoRefracDrawIndex);var h=[];return h.push({key:r.SurfaceAngleVisible,callback:"surfaceAngleVisibleHandler",params:[]}),h.push({key:r.NormalAngleVisible,callback:"normalAngleVisibleHandler",params:[]}),c._configData.nameEventEnable&&h.push({key:r.NameVisible,callback:"nameVisibleHandler",params:[]}),h.push({key:r.ZIndexChange,callback:"zIndexChangeHandler",params:[]}),c.__base(e,h),c.__proxyAll(["onLightMove","onLightTrans","onLightFocusBlur"]),c._surfacelinesKb=[],c._surfaceLines=[],c._sectorState={incidenceSector:!1,refractionSector:!1},c._option=l,c._onLightMove=s,c._onLightTrans=a,c._onLightFocusBlur=o,c._drawCommand=d.create(),c._drawCommand.setDrawIndex(c._configData.DrawIndex),c.createView(),c.initVisibleState(),c.initDrawCommand(),c.initDomEvent(),c._surfaceLines=c._configData.Lines,c._curLineIndex=c._configData._curLineIndex,c},createView:function(){var e=this._configData,t=0;this.createSector(t),this._refractionLine=u.create(this.__getEventBus(),u.Type.RefractionLine,e.RefractionLine,this.onLightMove,this.onLightTrans,this.onLightFocusBlur,this._option.langData),this._incidenceLine=u.create(this.__getEventBus(),u.Type.IncidenceLine,e.IncidenceLine,this.onLightMove,this.onLightTrans,this.onLightFocusBlur,this._option.langData),this._normalLine=g.create(e.NormalLine.width,this._option.langData),this._inverseRefractionLine=f.create(e.InverseRefractionLine.width),this._pedalLine=_.create(),this.appendSector(),this.addShape(this._normalLine.getView()),this.addShape(this._inverseRefractionLine.getView()),e.IncidenceLine.highLineZIndex?(this.addShape(this._refractionLine.getView()),this.addShape(this._incidenceLine.getView())):(this.addShape(this._incidenceLine.getView()),this.addShape(this._refractionLine.getView())),this.addShape(this._pedalLine.getView());var i=-Math.abs(t-e.IncidenceLine.width),n=-Math.abs(t-e.RefractionLine.width),a=-1,r=-Math.abs(t-e.NormalLine.width),o=-Math.abs(t-e.InverseRefractionLine.width);this._incidenceLine.setTranslate(i,a),this._incidenceLine.setRotate(e.IncidenceLine.defaultAngle),this._normalLine.setTranslate(r/2,1),this._refractionLine.setTranslate(n,a),this._inverseRefractionLine.setTranslate(o,0),this.setTranslate(this._configData.IncidencePosX,this._configData.IncidencePosY),this._$$incidencePoint=new kity.Circle(p.width).fill(p.fill),this._$$incidencePoint.setTranslate(this._configData.IncidencePosX,this._configData.IncidencePosY),this._surfaceLines=this._configData.Lines;for(var l=0;l<this._surfaceLines.length;l++)this._surfaceLines[l].degree=(this._surfaceLines[l].degree+360)%360,this._surfacelinesKb[l]=s.getLineKb(this._surfaceLines[l].degree,this._surfaceLines[l].aPoint);this._curLineIndex=this._configData._curLineIndex},initVisibleState:function(){var e=this._configData;this.initSectorVisibleState(),this.surfaceAngleVisibleHandler(this._option.surfaceAngleVisible),this.normalAngleVisibleHandler(this._option.normalAngleVisible),this.nameVisibleHandler(this._option.nameVisible),this._normalLine.setVisibility(e.NormalLine.visible),this._pedalLine.setVisibility(e.PedalLineVisible),this._inverseRefractionLine.setLineVisibility(!1,e.InverseRefractionLine.lineVisible),o.setVisibility(this._$$incidencePoint,e.IncidencePointVisible),this._normalLine.setPointNameVisibility(this._option.nameVisible,e.NormalLine.pointNameVisible),this._normalLine.setLineVisibility(this._option.nameVisible,e.NormalLine.lineVisible)},gtIndexAppendToView:function(e){e.addShape(this._$$incidencePoint),this.gtIndexSectorAppendToView(e)},resetAngle:function(e,t){e=e<0?(e+360)%360:e%360,this._surfaceAngle=e,this._surfaceAngle%=360;var i=this._incidenceLine.getRotateAngle()?this._incidenceLine.getRotateAngle():0,n=i-e>360?i%360:i-e<0?i+360:i;n<=180+this._surfaceLines[this._curLineIndex].degree?this.refractivity=parseFloat(this._surfaceLines[this._curLineIndex].refractivity2/this._surfaceLines[this._curLineIndex].refractivity1):this.refractivity=parseFloat(this._surfaceLines[this._curLineIndex].refractivity1/this._surfaceLines[this._curLineIndex].refractivity2);var a=[],r=!1,o=n-e,l=e,c=90+e,u=180+e,g=270+e,f=540+e;this._incidenceLine.setRotate(n),this._normalLine.setRotate(c,this._configData.NormalLine.width/2,0),this._pedalLine.setRotate(this._surfaceLines[this._curLineIndex].pedalLineAngle);var _=s.getRefractAngle(o,this.refractivity),d=this._normalLine.getRotateAngle();90!==Math.abs(Math.round(i-d))&&270!==Math.abs(Math.round(i-d))||(_="no_refract",n=Math.round(n));var p;"no_refract"!==_?o<=90?(a=[l,n,c,g-_,g],p=a[3]):o>90&&o<=180?(a=[l,c,n,g,g+_],p=a[4]):o>180&&o<=270?(a=[l,n,g,c-_,c],p=a[3]):o>270&&o<=360&&(a=[l,g,n,c,c+_],p=a[4]):o<=90?(a=[l,n,c,c,u-o],p=a[4]):o>90&&o<=180?(a=[l,c,n,u-o,c],p=a[3]):o>180&&o<=270?(a=[l,n,g,g,f-o],p=a[4]):o>270&&o<=360&&(a=[l,g,n,f-o,g],p=a[3]),this._inverseRefractionLine.setRotate((p+180)%360),this._curRefAngle=_,this._configData.IncidenceLine.rotateFixed&&this._refractionLine.setRotate(p),this.resetSectorAngle(this._normalLine.getRotateAngle(),r,a),this.isPedal()&&!this._incidenceLine.isVisibilityHidden()?(this._drawCommand.setDrawIndex(this._configData.PedalDrawIndex),o>180&&this._pedalLine.setRotate(180+e),this._configData.view90PedalLineVisible&&this._pedalLine.setVisibility(!0)):("no_refract"==this._curRefAngle?this._drawCommand.setDrawIndex(this._configData.NoRefracDrawIndex):this._drawCommand.setDrawIndex(this._configData.DrawIndex),this._pedalLine.setVisibility(this._normalLine.getLineVisible())),"no_refract"!=this._curRefAngle?(this._option.normalAngleVisible&&this._hsdrawSectorRefraction&&(this.setSectorVisibilityByType(h.Type.Refraction,!0),this.syncSectorVisibilityByName()),this._hsDrawRefractionLine&&this._refractionLine.setVisibility(!0)):"no_refract"==this._curRefAngle&&this.setRefractionPartVisibility(!1),this.resetLinePos(),this.resetPedalRotateAngle()},resetPedalRotateAngle:function(){var e=this,t=l.getAttrTranslate(i(e._$$incidencePoint.node).attr("transform"));0==t.length&&(t=[0,0]);var n={x:t[0],y:t[1]},a=s.getTwoPointDistance(n,e._surfaceLines[e._curLineIndex].aPoint),r=s.getTwoPointDistance(n,e._surfaceLines[e._curLineIndex].bPoint),o=this._pedalLine.getRotateAngle()[0]-this._surfaceAngle<0?this._pedalLine.getRotateAngle()[0]-this._surfaceAngle+360:this._pedalLine.getRotateAngle()[0]-this._surfaceAngle;a<=40?0==o?this._pedalLine.setRotate(90+this._surfaceAngle):270==o&&this._pedalLine.setRotate(180+this._surfaceAngle):r<=40&&(90==o?this._pedalLine.setRotate(0+this._surfaceAngle):180==o&&this._pedalLine.setRotate(270+this._surfaceAngle))},getMoveRotateAngle:function(e){var t,n=e.currentPos,a=e.lastPos,r=i(this._$$incidencePoint.node).offset();return t={x:r.left,y:r.top},s.getRotateAngle(t,a,n)},onLightMove:function(e,t,i){if("beforemove"===i);else if("aftermove"===i)this.adsorptionPedal();else if("move"===i){var n=this.getMoveRotateAngle(t);this.lineRotateAble(n)&&(this._configData.IncidenceLine.rotateFixed?this._incidenceLine.rotate(n):this._incidenceLine.rotate(n),this.resetAngle(this._surfaceAngle),this._onLightMove(this.getUuid(),n,this._curLineIndex))}},countLineXY:function(e,t,i){var n=this;return n._surfacelinesKb[e].degree<=45||n._surfacelinesKb[e].degree>=315?i=t*n._surfacelinesKb[e].k:t="no_exist"!=n._surfacelinesKb[e].k?i/n._surfacelinesKb[e].k:0,{xDis:t,yDis:i}},onLightTrans:function(e,t,n){var a=this,r=this._incidenceLine.getScale();if("beforemove"===n);else if("aftermove"===n){var o=l.getAttrTranslate(i(a._$$incidencePoint.node).attr("transform"));0==o.length&&(o=[0,0]);var c={x:o[0],y:o[1]};if(s.isInSegment(c,a._surfaceLines[a._curLineIndex].range[0],a._surfaceLines[a._curLineIndex].range[1]));else{var h=s.getTwoPointDistance(c,a._surfaceLines[a._curLineIndex].range[0]),u=s.getTwoPointDistance(c,a._surfaceLines[a._curLineIndex].range[1]);c=h<=u?a._surfaceLines[a._curLineIndex].range[0]:a._surfaceLines[a._curLineIndex].range[1],a.setGroupTranslate(c.x,c.y),a.resetAngle(a._surfaceLines[a._curLineIndex].degree),a._onLightTrans(a.getUuid(),y,w,a._curLineIndex)}}else if("move"===n){var o=l.getAttrTranslate(i(a._$$incidencePoint.node).attr("transform"));0==o.length&&(o=[0,0]);var g=t.lastPos,f=t.currentPos,_=f.x-g.x,d=f.y-g.y;_/=r,d/=r;var p,y,w;p=a.countLineXY(a._curLineIndex,_,d),y=o[0]+1420*p.xDis/1600,w=o[1]+9*p.yDis/10;var h,u,c={x:y,y:w};if(h=s.getTwoPointDistance(c,a._surfaceLines[a._curLineIndex].aPoint),u=s.getTwoPointDistance(c,a._surfaceLines[a._curLineIndex].bPoint),s.isInSegment(c,a._surfaceLines[a._curLineIndex].aPoint,a._surfaceLines[a._curLineIndex].bPoint))a.setGroupTranslate(y,w),a.resetAngle(a._surfaceLines[a._curLineIndex].degree),a._onLightTrans(a.getUuid(),y,w,a._curLineIndex);else{var v;if(v=h<=u?s.inWhichLine(a._surfaceLines[a._curLineIndex].aPoint,a._surfaceLines,a._curLineIndex):s.inWhichLine(a._surfaceLines[a._curLineIndex].bPoint,a._surfaceLines,a._curLineIndex),v!=-1){a._curLineIndex=v;var m=s.getTwoPointDistance(c,a._surfaceLines[v].range[0]),b=s.getTwoPointDistance(c,a._surfaceLines[v].range[1]);m<=b?(y=a._surfaceLines[v].range[0].x,w=a._surfaceLines[v].range[0].y):(y=a._surfaceLines[v].range[1].x,w=a._surfaceLines[v].range[1].y),a.setGroupTranslate(y,w),a.resetAngle(a._surfaceLines[a._curLineIndex].degree),a._onLightTrans(a.getUuid(),y,w,a._curLineIndex)}else y=a._surfaceLines[a._curLineIndex].range[0].x,w=a._surfaceLines[a._curLineIndex].range[0].y}}},onLightFocusBlur:function(e){this._onLightFocusBlur(e)},setIncidence0180View:function(){var e=Math.round(this.getSectorAngle(h.Type.Incidence));0===e||90===e?(this.setSectorVisibility(!1),this._configData.view90PedalLineVisible&&(0===e?this._pedalLine.setVisibility(!0):this._pedalLine.setVisibility(this._normalLine.getLineVisible())),this._incidenceLine.isVisibilityHidden()||this._refractionLine.isVisibilityHidden()||this._linePedalChangeLock||(this._incidenceLine.setWidth(this._configData.IncidenceLine.PedalWidth),this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos),this._refractionLine.setWidth(this._configData.RefractionLine.PedalWidth),this._refractionLine.setArrowPos(this._configData.RefractionLine.PedalArrowPos))):(this.syncSectorVisibilityByName(),this._configData.view90PedalLineVisible&&this._pedalLine.setVisibility(this._normalLine.getLineVisible()),this._incidenceLine.isVisibilityHidden()||this._refractionLine.isVisibilityHidden()||this._linePedalChangeLock||(this._incidenceLine.setWidth(this._configData.IncidenceLine.width),this._incidenceLine.setArrowPos(this._configData.IncidenceLine.arrowPos),this._refractionLine.setWidth(this._configData.RefractionLine.width),this._refractionLine.setArrowPos(this._configData.RefractionLine.arrowPos)))},setIncidencePos:function(e,t){this._configData.IncidencePosX=e,this.setTranslate(this._configData.IncidencePosX,this._configData.IncidencePosY),this._$$incidencePoint.setTranslate(this._configData.IncidencePosX,this._configData.IncidencePosY),this.getNameGroup().setTranslate(this._configData.IncidencePosX,this._configData.IncidencePosY)},getIncidencePosX:function(){return this._configData.IncidencePosX},lineRotateAble:function(e){this._incidenceLine.getRotateAngle()>this._normalLine.getRotateAngle()&&(e=-e);this.getSectorAngle(h.Type.SurfaceIn);return!0},complexRotateAble:function(e){if(!this._configData.IncidenceLine.rotateFixed&&!this._configData.RefractionLine.rotateFixed)return!0;this._incidenceLine.getRotateAngle()>this._normalLine.getRotateAngle()?this._configData.IncidenceLine.rotateFixed?e=e:this._configData.RefractionLine.rotateFixed&&(e=-e):this._configData.IncidenceLine.rotateFixed?e=-e:this._configData.RefractionLine.rotateFixed&&(e=e);var t=this.getSectorAngle(h.Type.SurfaceIn);return!(t+e<MinAngle)},around:function(e,t,i){i=i||0;var n,a,r=Math.abs(t-this._configData.IncidencePosX),o=s.getSpherePos(e||0,r);t>this._configData.IncidencePosX?(n=t+-o.x,a=o.y):(n=o.x+t,a=-o.y),this.setTranslate(n+i,-a),this._$$incidencePoint.setTranslate(n+i,-a),this.getNameGroup().setTranslate(n+i,-a)},getData:function(){var e=this,t=l.getAttrTranslate(i(e._$$incidencePoint.node).attr("transform")),n=e.getSectorAngle(h.Type.SurfaceIn);this._normalLine.getRotateAngle()<this._incidenceLine.getRotateAngle()&&(n=180-n);var s={IncidenceLine:{defaultAngle:e._incidenceLine.getRotateAngle(),visible:!e._incidenceLine.isVisibilityHidden()},RefractionLine:{visible:!e._refractionLine.isVisibilityHidden()},NormalLine:{pointNameVisible:e._normalLine.getPointNameVisible(),lineVisible:e._normalLine.getLineVisible()},InverseRefractionLine:{pointNameVisible:e._inverseRefractionLine.getPointNameVisible(),lineVisible:!e._inverseRefractionLine.isVisibilityHidden()&&e.getHasdrawInverseRefractionLine()},Sector:{sectorInVisible:e.getSectorOutSideVisibilityByType(h.Type.SurfaceIn),sectorOutVisible:e.getSectorOutSideVisibilityByType(h.Type.SurfaceOut),incidenceVisible:e.getSectorOutSideVisibilityByType(h.Type.Incidence),refractionVisible:e.getSectorOutSideVisibilityByType(h.Type.Refraction),hasDraw:e.getSectorHasDraw()},Draw:{hasNext:e.hasNextWidthOutVisibilityStatus(),incidencePoint:e.getHasDrawIncidencePoint(),sectorAnimateDisappear:e.getHasDrawSectorAnimateDisappear(),sectorRefraction:e.getHasDrawSectorRefraction(),refractionLine:e.getHasDrawRefractionLine(),inverserefractionline:e.getHasdrawInverseRefractionLine(),materialObjectImagingGroup4:e.getHasdrawMaterialObjectImagingGroup4(),materialObjectImagingGroup5:e.getHasdrawMaterialObjectImagingGroup5()},PedalLineVisible:!e._pedalLine.isVisibilityHidden(),IncidencePosX:t[0],IncidencePosY:t[1],Visible:!e.isVisibilityHidden(),_curLineIndex:e._curLineIndex};return s},adsorptionPedal:function(){if(this.isPedal()){var e=this._normalLine.getRotateAngle(),t=this._incidenceLine.getRotateAngle();Math.abs(e%360-t%360)>90?(this._refractionLine.setRotate(e),this._incidenceLine.setRotate(e+180)):(this._incidenceLine.setRotate(e),this._refractionLine.setRotate(e+180)),this.resetAngle(e-90)}else if(90===Math.round(this.getSectorAngle(h.Type.Incidence))){var t=this._incidenceLine.getRotateAngle()%360,e=this._normalLine.getRotateAngle()%360;Math.abs(t-e-90)<=2?this._incidenceLine.setRotate(e+90):this._incidenceLine.setRotate(e-90)}},isPedal:function(){return 0===Math.round(this.getSectorAngle(h.Type.Incidence))},initDomEvent:function(){this.bindDomEvent(this.getView().node,["lrTap"],this.getUuid(),this.domEventHandler)},setViewTapListener:function(e){this._onViewClickListener=e},domEventHandler:function(e){this._onViewClickListener&&this._onViewClickListener(e)},changeTransparent:function(e){},setVisibility:function(e){o.setVisibility(this.getView(),e),this.getNameGroup().setVisibility(e)},setLinePedalChangeLock:function(e){this._linePedalChangeLock=e},getTwoLineVisible:function(){return!this._incidenceLine.isVisibilityHidden()&&!this._refractionLine.isVisibilityHidden()},setRefractionPartVisibility:function(e){this.setRefractionLineVisible(e),this.setSectorVisibilityByType(h.Type.Refraction,e),this.syncSectorVisibilityByName()}}),v=n("js/refractor/lightComplexRef/draw"),m=n("js/refractor/lightComplexRef/event"),b=n("js/refractor/lightComplexRef/proxyApi"),A=n("js/refractor/lightComplexRef/sector"),x=n("js/refractor/lightComplexRef/namePos");return w.__include(v),w.__include(m),w.__include(b),w.__include(A),w.__include(x),w}),s("js/refractor/lightComplexRef/namePos",["js/view/sector","js/utils/utils","js/utils/view","js/utils/graphmath","js/utils/svg","js/view/lightLine"],function(e,t,i,n,s,a){var r={_lastMinLine:null,resetLinePos:function(){this.initLineNamePos(this._incidenceLine),this.initLineNamePos(this._refractionLine)},initLineNamePos:function(e){var t=new Number(e.getRotateAngle());e.makeNameViewAround(t.toFixed(5))}};return r}),s("js/refractor/lightComplexRef/proxyApi",["js/view/sector","js/utils/utils","js/utils/view","js/view/LightLine"],function(e,t,i,n){var s=function(e){return e%=360,e<0?360+e:e},a=function(e){var t=(180-e%360)%360;return t<0&&(t=360+t),t},r={setIncidenceXAxisAngle:function(e){this._incidenceLine.setRotate(e)},getIncidenceRotateAngle:function(){return this._incidenceLine.getRotateAngle()},getRefractionRotateAngle:function(){return this._refractionLine.getRotateAngle()},setIncidenceLineWidth:function(e){this._incidenceLine.setWidth(e)},setRefractionLineWidth:function(e){this._refractionLine.setWidth(e)},setIncidenceLineArrowPos:function(e){this._incidenceLine.setArrowPos(e)},setRefractionLineArrowPos:function(e){this._refractionLine.setArrowPos(e)},setIncidenceLineCommonFill:function(e){e?this._incidenceLine.setCommonFill():this._incidenceLine.restoreFill()},setRefractionLineCommonFill:function(e){e?this._refractionLine.setCommonFill():this._refractionLine.restoreFill()},setIncidenceLineVisible:function(e){this._incidenceLine.setVisibility(e)},setRefractionLineVisible:function(e){this._refractionLine.setVisibility(e)},getIncidenceLineVisible:function(){return!this._incidenceLine.isVisibilityHidden()},getReflectionLineVisible:function(){return!this._reflectionLine.isVisibilityHidden()},getIncidenceSurfaceAngle:function(){return this.getSectorAngle(e.Type.Incidence)},setIncidenceNameEnable:function(e){this._incidenceLine.setNameEnable(e)},setIncidenceNameVisible:function(e){this._incidenceLine.setNameVisible(e),this.resetLinePos()},getNormalLineRotateAngle:function(){return this._normalLine.getRotateAngle()},getIncidenceLineXAngle:function(){return(360-this._incidenceLine.getRotateAngle()%360)%180},getRefractionLineXAngle:function(){return(360-this._refractionLine.getRotateAngle()%360)%180},getNormalLineXAngle:function(){return(360-this._normalLine.getRotateAngle()%360)%180},getSectorInLineXAngle:function(){var t=0,i=this._incidenceLine.getRotateAngle(),n=this._normalLine.getRotateAngle();return t=i>n?i+this.getSectorAngle(e.Type.SurfaceIn):i-this.getSectorAngle(e.Type.SurfaceIn),(360-t%360)%180},getSectorOutLineXAngle:function(){var t=0,i=this._refractionLine.getRotateAngle(),n=this._normalLine.getRotateAngle();return t=i>n?i+this.getSectorAngle(e.Type.SurfaceOut):i-this.getSectorAngle(e.Type.SurfaceOut),(360-t%360)%180},getIncidenceLineSphereAngle:function(){return a(this._incidenceLine.getRotateAngle())},getRefractionLineSphereAngle:function(){return a(this._refractionLine.getRotateAngle())},getNormalLineSphereAngle:function(){return a(this._normalLine.getRotateAngle())},getLineXAngle:function(e){return e===n.Type.IncidenceLine?this.getIncidenceLineXAngle():e===n.Type.RefractionLine?this.getRefractionLineXAngle():void 0},getLine0To360RotateAngle:function(e){var t;return e===n.Type.IncidenceLine?t=this._incidenceLine:e===n.Type.RefractionLine&&(t=this._refractionLine),s(t.getRotateAngle())},getLineQuad:function(t){var i,a;if(t===n.Type.IncidenceLine)i=this._incidenceLine;else if(t===n.Type.RefractionLine)i=this._refractionLine;else if(t===n.Type.NormalLine)i=this._normalLine;else if(t===n.Type.SurfaceIn){var r=this.getNormalLineRotateAngle(),o=this.getIncidenceRotateAngle();o<r?(a=s(o)-this.getSectorAngle(e.Type.SurfaceIn),a<0&&(a=360+a)):(a=s(o)+this.getSectorAngle(e.Type.SurfaceIn),a<0&&(a=360+a))}else if(t===n.Type.SurfaceOut){var r=this.getNormalLineRotateAngle(),l=this.getRefractionRotateAngle();l<r?(a=s(l)-this.getSectorAngle(e.Type.SurfaceOut),a<0&&(a=360+a)):(a=s(l)+this.getSectorAngle(e.Type.SurfaceOut),a<0&&(a=360+a))}return i&&(a=s(i.getRotateAngle())),a>=0&&a<=90?2:a>=90&&a<=180?1:a>=180&&a<=270?4:a>=270&&a<=360?3:0},setLineVisibility:function(e,t){e===n.Type.IncidenceLine?this._incidenceLine.setVisibility(t):e===n.Type.RefractionLine&&this._refractionLine.setVisibility(t)},setLineEnable:function(e,t){e===n.Type.IncidenceLine?this._incidenceLine.setLineEnable(t):e===n.Type.RefractionLine&&this._refractionLine.setLineEnable(t)},setCurLineIndex:function(e){this._curLineIndex=e},setGroupTranslate:function(e,t){this.setTranslate(e,t),this._nameGroup.setTranslate(e,t),this._$$incidencePoint.setTranslate(e,t)},getRefAngle:function(){return this._curRefAngle},getNameByType:function(e){return this._nameGroup.getNameByType(e)},setNamePosByType:function(e,t,i){this.getNameByType(e).setTranslate(t,i)}};return r}),s("js/refractor/lightComplexRef/sector",["js/view/sector","js/utils/utils","js/utils/view","js/view/NameGroup","js/view/LightLine"],function(e,t,s,a,r){var o=n("js/utils/graphMath"),l={_sector:null,_sectorEnable:!0,_currentVisibleStatus:null,_sectorHasDraw:null,createSector:function(t){var i=this._configData;this._sector={},this._currentVisibleStatus={},this._sector[e.Type.Incidence]=this._incidenceSector=e.create(e.Type.Incidence,t,0,i.Sector.incidenceR,this._option.langData),this._sector[e.Type.Refraction]=this._refractionSector=e.create(e.Type.Refraction,t,0,i.Sector.refractionR,this._option.langData),this._sector[e.Type.SurfaceIn]=this._surfaceInSector=e.create(e.Type.SurfaceIn,t,0,i.Sector.surfaceR,this._option.langData),this._sector[e.Type.SurfaceOut]=this._surfaceOutSector=e.create(e.Type.SurfaceOut,t,0,i.Sector.surfaceR,this._option.langData);var n={};n[e.Type.Incidence]={cx:t,cy:0,r:i.Sector.refractionR},n[e.Type.Refraction]={cx:t,cy:0,r:i.Sector.refractionR},n[e.Type.SurfaceIn]={cx:t,cy:0,r:i.Sector.surfaceR},n[e.Type.SurfaceOut]={cx:t,cy:0,r:i.Sector.surfaceR},this._nameGroup=a.create(n,this._option.langData,this._option),this._nameGroup.setTranslate(this._configData.IncidencePosX,this._configData.IncidencePosY)},sectorEach:function(e){for(var t in this._sector)e.apply(this._sector[t],[t])},appendSector:function(){var e=this;this.sectorEach(function(t){e.addShape(this.getView())})},gtIndexSectorAppendToView:function(e){e.addShape(this._nameGroup.getView())},setAngleVisibleByType:function(e,t){return this._currentVisibleStatus[e]=t,this._sectorEnable?void this._nameGroup.setAngleVisibleByType(e,t):void(t===!0&&this._nameGroup.setHasDrawStatusByType(e,t))},resetSectorAngle:function(e,t,i){this._surfaceInSector.rotate(i[0],i[1]),this._incidenceSector.rotate(i[1],i[2]),this._refractionSector.rotate(i[3],i[4]),this._surfaceOutSector.rotate(i[2],i[3]),this._nameGroup.setNormalAngle(e),this._nameGroup.rotate(i,t)},initSectorVisibleState:function(){var t=this._configData;this.setAngleVisibleByType(e.Type.SurfaceIn,t.Sector.sectorInVisible),this.setAngleVisibleByType(e.Type.SurfaceOut,t.Sector.sectorOutVisible),this.setAngleVisibleByType(e.Type.Incidence,t.Sector.incidenceVisible),this.setAngleVisibleByType(e.Type.Refraction,t.Sector.refractionVisible),this._configData.Sector.hasDraw&&this._nameGroup.setHasDrawStatus(this._configData.Sector.hasDraw),this.syncSectorVisibilityByName()},getSectorHasDraw:function(){return this._nameGroup.getHasDrawStatus()},setSectorInsideDrawStatus:function(e,t){this._nameGroup.setHasDrawStatusByType(e,t)},setSectorVisibilityByType:function(e,t){this.setAngleVisibleByType(e,t),this._sector[e].setVisibility(this._nameGroup.getAngleIsValidByType(e))},setSectorVisibilityByOutSideLogic:function(e,t){this._nameGroup.getHasDrawStatusByType(e)&&this.setAngleVisibleByType(e,t),this._sector[e].setVisibility(this._nameGroup.getAngleIsValidByType(e))},setSectorVisibility:function(e){this.sectorEach(function(){this.setVisibility(e)})},syncSectorVisibilityByName:function(){var e=this;this.sectorEach(function(t){this.setVisibility(e._nameGroup.getAngleIsValidByType(t))})},sectorAnimateDisappear:function(t){var n=this;n.setAngleVisibleByType(e.Type.Incidence,!0),n.setAngleVisibleByType(e.Type.Refraction,!0),n.syncSectorVisibilityByName(),n.setAngleVisibleByType(e.Type.Incidence,!1),n.setAngleVisibleByType(e.Type.Refraction,!1),n.setSectorInsideDrawStatus(!0,e.Type.Incidence),n.setSectorInsideDrawStatus(!0,e.Type.Reflection),i(n._refractionSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300,function(){n.syncSectorVisibilityByName(),i(n._refractionSector.getView().node).css("display",""),t&&t()}),i(n._incidenceSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300,function(){n.syncSectorVisibilityByName(),i(n._incidenceSector.getView().node).css("display",""),t&&t()})},getSectorOutSideVisibilityByType:function(e){return this._nameGroup.getAngleVisibilityByType(e)},getNameGroup:function(){return this._nameGroup},getSectorAngle:function(e){return this._nameGroup.getAngle(e)},getSectorRoundAngle:function(e){return this._nameGroup.getRoundAngle(e)},getSectorLinesPos:function(t,i){var n,s,a,l,c=this;t==e.Type.Incidence?(n=this.getIncidenceLineXAngle(),s=this.getNormalLineXAngle(),a=r.Type.IncidenceLine,l=r.Type.NormalLine):t==e.Type.Refraction?(n=this.getNormalLineXAngle(),s=this.getRefractionLineXAngle(),a=r.Type.NormalLine,l=r.Type.RefractionLine):t==e.Type.SurfaceIn?(n=this.getIncidenceLineXAngle(),s=this.getSectorInLineXAngle(),a=r.Type.IncidenceLine,l=r.Type.SurfaceIn):t==e.Type.SurfaceOut&&(n=this.getRefractionLineXAngle(),s=this.getSectorOutLineXAngle(),a=r.Type.RefractionLine,l=r.Type.SurfaceOut);var h=function(n,s){n>90&&(n=180-n);var a=c.getLineQuad(s),r=c._configData.Sector.surfaceR;t==e.Type.Incidence?r=c._configData.Sector.incidenceR:t==e.Type.Refraction&&(r=c._configData.Sector.refractionR);var l={y:Math.sin(o.getRadian(n))*r,x:Math.cos(o.getRadian(n))*r},h={};return 1===a?(h.x=i.x+l.x,h.y=i.y+l.y):2===a?(h.x=i.x-l.x,h.y=i.y+l.y):3===a?(h.x=i.x-l.x,h.y=i.y-l.y):(h.x=i.x+l.x,h.y=i.y-l.y),{a:i,b:h}},u=[h(n,a),h(s,l)];return u},setSectorEnable:function(e){var t=this;this._sectorEnable=e,e?(this.sectorEach(function(e){t._nameGroup.setAngleVisibleByType(e,t._currentVisibleStatus[e])}),this.syncSectorVisibilityByName()):this.sectorEach(function(e){this.setVisibility(!1),t._nameGroup.setAngleVisibleByType(e,!1)})},setSectorOpacity:function(e){this.getNameGroup().setOpacity(e),this.sectorEach(function(){this.setOpacity(e)})}};return l}),s("js/utils/drawCommand",["js/utils/logger"],function(e){var t={_queue:[],_hasDrawQueue:[],_drawIndex:[],_currentIndex:0,_maxLength:100,_stopCallback:null,_stopFlag:!1,_drawing:!1,create:function(){var e=Object.create(this);return e._queue=[],e._drawIndex=[],e._hasDrawQueue=[],e},push:function(e,t){this._queue.push(this.makeAsPromise(e)),this._hasDrawQueue.push(t)},setCurrentIndex:function(e){this._currentIndex=e},drawNext:function(t,n,s){var a=this;if(this._drawing&&s!==!0)return e.debug("draw","正在绘制中，不能提交新的绘制命令"),void(t&&t(a._currentIndex));if(this.hasNext()){this._drawing=!0;var r=this.hasDraw(this._currentIndex);if(r)return this._currentIndex++,this.drawNext(t,n,!0),void(this._drawing=!1);var o=this.getTask(this._currentIndex);this._currentIndex++;var l=function(){a._drawing=!1,a._stopCallback&&a._stopCallback(),t&&t(a._currentIndex)};
return 1===o.length?i.when([o[0](n)]).done(l):2===o.length?i.when([o[0](n),o[1](n)]).done(l):3===o.length?i.when([o[0](n),o[1](n),o[2](n)]).done(l):4===o.length?i.when([o[0](n),o[1](n),o[2](n),o[3](n)]).done(l):5===o.length&&i.when([o[0](n),o[1](n),o[2](n),o[3](n),o[4](n)]).done(l),!0}return e.debug("draw","已经没有更多命令需要绘制"),t&&t(a._currentIndex),!1},getTask:function(e){var t=this,i=this._drawIndex[e],n=[];return i instanceof Array?i.forEach(function(e){n.push(t._queue[e])}):n.push(t._queue[i]),n},hasNext:function(){for(var e=!1,t=0;t<this._drawIndex.length;t++){var i=this.hasDraw(t);i||(e=!0)}return e},hasNotDrawNext:function(){return this._drawIndex.length>0?this._currentIndex<=this._drawIndex.length-1:this._currentIndex<=this._queue.length-1},drawAll:function(e,t){for(var i=0;i<this._drawIndex.length;i++){var n=this.getTask(i);n.forEach(function(e){e(t)})}e&&e()},setDrawIndex:function(e){this._drawing||(this._drawIndex=e,this._currentIndex=0)},stop:function(e){return this._drawing?(this._stopFlag=!0,void(this._stopCallback=e)):(this._stopFlag=!0,void(e&&e()))},hasDraw:function(e){var t=this,i=this._drawIndex[e],n=!0;return i instanceof Array?i.forEach(function(e){n&&(n=t._hasDrawQueue[e]())}):n=t._hasDrawQueue[i](),n},makeAsPromise:function(e){return function(){var t=i.Deferred(),n=Array.prototype.slice.apply(arguments,[0]);return n.unshift(t),e.apply(this,n),t.promise()}},getCommandLength:function(){return this._queue.length}};return t}),s("js/utils/eventBus",["js/utils/logger"],function(e){var t={_eventHandler:null,create:function(){var e=Object.create(this);return e._eventHandler={},e},trigger:function(){var t=Array.prototype.slice.apply(arguments,[0]),i=t.shift();if(!this._eventHandler||!this._eventHandler[i])return!1;var n=this._eventHandler[i];return n.forEach(function(n){n.cb.apply(n.domain||this,t),e.debug("event-trigger",i,t.toString())}),!0},on:function(e,t,i){return this._eventHandler[e]||(this._eventHandler[e]=[]),this._eventHandler[e].push({cb:t,domain:i}),!0},off:function(e,t,i){var n=this._eventHandler[e];if(n&&n.length>0)for(var s,a=n.length,r=0;r<a;r++)if(s=n[r],s&&t===s.cb){if(i&&i!==s.domain)continue;n.splice(r,1),r--,a--}n&&0===n.length&&delete this._eventHandler[e]}};return t}),s("js/utils/eventUtils",function(){var e={isDown:function(e){return"touchstart"===e||"mousedown"===e},isUp:function(e){return/^(touchend|touchcancel|mouseup|mouseleave)$/.test(e)},isMove:function(e){return"mousemove"===e||"touchmove"===e},isTouch:function(e){return/^(touchend|touchcancel|touchstart|touchmove)$/.test(e)},getPagePos:function(e){var e=e.originalEvent?e.originalEvent:e,t={};switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return t.x=e.changedTouches[0].pageX,t.y=e.changedTouches[0].pageY,t;default:return t.x=e.pageX,t.y=e.pageY,t}return t},fixPcClick:function(e,t,i,n){var s=n-i,a=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return!(s>800||a>=4||r>=4)}};return e}),s("js/utils/graphMath",function(){var e={getTwoLineIntersection:function(e,t,i,n){var s=(t.y-e.y)*(n.x-i.x)-(e.x-t.x)*(i.y-n.y);if(0==s)return!1;var a=((t.x-e.x)*(n.x-i.x)*(i.y-e.y)+(t.y-e.y)*(n.x-i.x)*e.x-(n.y-i.y)*(t.x-e.x)*i.x)/s,r=-((t.y-e.y)*(n.y-i.y)*(i.x-e.x)+(t.x-e.x)*(n.y-i.y)*e.y-(n.x-i.x)*(t.y-e.y)*i.y)/s;return Math.round((a-e.x)*(a-t.x))<=0&&Math.round((r-e.y)*(r-t.y))<=0&&Math.round((a-i.x)*(a-n.x))<=0&&Math.round((r-i.y)*(r-n.y))<=0&&{x:a,y:r}},getRadian:function(e){return 2*Math.PI/360*e},getDegree:function(e){return 360*e/(2*Math.PI)},getLineKb:function(e,t){var i={};return e=e<0?(e+360)%360:e%360,i.degree=e,90!=e&&270!=e&&0!=e&&180!=e?(i.k=Math.tan(this.getRadian(e)),i.b=t.y-i.k*t.x,i):90==e||270==e?(i.k="no_exist",i.x=t.x,i):0==e||180==e?(i.k=0,i.b=t.y,i):void 0},getArc:function(e,t){return 2*Math.PI*t*e/360},getDifferent:function(e,t,i){var n={x:t.x-e.x,y:t.y-e.y},s={x:i.x-e.x,y:i.y-e.y};return parseFloat(n.x*s.y)-parseFloat(s.x*n.y)},getCosineAngle:function(e,t,i){var n=(Math.pow(t,2)+Math.pow(i,2)-Math.pow(e,2))/(2*t*i);if(n>=-1&&n<=1)var s=Math.acos(n);else s=0;return parseFloat(s*(180/Math.PI))},getCosineAngleByPos:function(e,t,i){var n,s,a;return n=parseFloat(Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))),s=parseFloat(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))),a=parseFloat(Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))),this.getCosineAngle(n,s,a)},getPythagoreanLineC:function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},getLinePosByAngle:function(e,t){e>90&&(e=180-e);var i=Math.cos(this.getRadian(e))*t,n=Math.sin(this.getRadian(e))*t;return{x:i,y:n}},getSvgSectorPoint:function(e,t,i,n,s){var a=Math.PI/180,r=e+i*Math.cos(-n*a),o=t+i*Math.sin(-n*a),l=e+i*Math.cos(-s*a),c=t+i*Math.sin(-s*a),h=[];return h.push("M"),h.push(e),h.push(t),h.push("L"),h.push(r),h.push(o),h.push("A"),h.push(i),h.push(i),h.push(0),h.push(+(s-n>180)),h.push(0),h.push(l),h.push(c),h.push("z"),h.join(" ")},getTwoPointDistance:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},getSpherePos:function(e,t){var i=0+t*Math.cos(e*Math.PI/180),n=0+t*Math.sin(e*Math.PI/180);return{x:i,y:n}},getShortestDistanceAndPoint:function(e,t,i){var n=this.getTwoPointDistance(e,t),s=this.getTwoPointDistance(e,i),a=this.getTwoPointDistance(t,i),r=(n+s+a)/2,o=Math.sqrt(r*(r-n)*(r-s)*(r-a)),l=2*o/a,c=Math.max(n,s),h=Math.sqrt(c*c-l*l),u=0,g={};return h>a?(u=Math.min(s,n),s>n?(u=n,g=t):(u=s,g=i)):(u=l,g=this.getRectVerticalPos(e,t,i,l)),{d:u,pos:g,h:l,minSide:Math.min(n,s)}},getRectVerticalPos:function(e,t,i,n){var s=0,a=0;return t.x===i.x?(s=t.x,a=e.y):(t.y=i.y)&&(a=t.y,s=e.x),{x:s,y:a}},getRectShortestDistance:function(e,t){var i=this.getShortestDistanceAndPoint(e,{x:t.left,y:t.top},{x:t.right,y:t.top}),n=this.getShortestDistanceAndPoint(e,{x:t.right,y:t.top},{x:t.right,y:t.bottom}),s=this.getShortestDistanceAndPoint(e,{x:t.left,y:t.bottom},{x:t.right,y:t.bottom}),a=this.getShortestDistanceAndPoint(e,{x:t.left,y:t.top},{x:t.left,y:t.bottom}),r=i,o=Math.min(i.d,n.d,s.d,a.d);return o===i.d&&(r=i,r.vertical=!0,r.direction="top"),o===n.d&&(r=n,r.vertical=!1,r.direction="right"),o===s.d&&(r=s,r.vertical=!0,r.direction="bottom"),o===a.d&&(r=a,r.vertical=!1,r.direction="left"),r},getLightPos:function(e,t,i){var n,s,a=i,r=e.x,o=e.y,l=t.x,c=t.y,h=(this.getTwoPointDistance(e,t),a/(Math.sqrt(Math.pow(r-l,2)+Math.pow(o-c,2))-a));return n=(r+h*l)/(1+h),s=(o+h*c)/(1+h),{x:n,y:s}},getRotateAngle:function(e,t,i){var n;n=e.x==t.x&&t.x==i.x||e.y==t.y&&t.y==i.y?0:this.getCosineAngleByPos(e,t,i);var s=this.getDifferent(e,t,i);return s<0&&(n=-n),n},getPedalHeight:function(e,t,i){var n=(e.y-t.y)/(e.x-t.x),s=e.y-n*e.y;return Math.abs(n*i.x+s-i.y)/Math.sqrt(n*n+1)},getLineCircleIntersectionPos:function(e,t,i,n){var s=1e-5,a={},r={},o=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),l={};l.x=(t.x-e.x)/o,l.y=(t.y-e.y)/o;var c={};c.x=i.x-e.x,c.y=i.y-e.y;var h=c.x*l.x+c.y*l.y,u=h*h,g=c.x*c.x+c.y*c.y,f=n*n;if(f-g+u<0)return!1;var _=Math.sqrt(f-g+u),d=h-_;return d-0>-s&&d-o<s&&(a.x=e.x+d*l.x,a.y=e.y+d*l.y),d=h+_,d-0>-s&&d-o<s&&(r.x=e.x+d*l.x,r.y=e.y+d*l.y),[a,r]},getRefractAngle:function(e,t){e=e<0?e+360:e;var i;i=e<=90?90-e:e>90&&e<=180?e-90:e>180&&e<=270?270-e:e-270;var n=this.getRadian(i),s=Math.sin(n)/t;if(s>=-1&&s<=1){s=Math.asin(s);var a=this.getDegree(s);return a}return"no_refract"},inWhichLine:function(t,i,n){for(var s=-1,a=0;a<i.length;a++)if(void 0==n||a!=n){var r=!1,o=e.getLineKb(i[a].degree,i[a].aPoint);if("no_exist"!=o.k?o.k*t.x+o.b-5<=t.y&&o.k*t.x+o.b+5>=t.y&&(r=!0):o.x==t.x&&(r=!0),1==r){if(e.isInSegment(t,i[a].aPoint,i[a].bPoint)){s=a;break}s=-1}else s=-1}return s},pointInLine:function(t,i,n){var s,a=e.getLineKb(t.degree,t.aPoint);"no_exist"!=a.k&&0!=a.k?s=a.degree>0&&a.degree<180?{x:(-1e4-a.b)/a.k,y:-1e4}:{x:(1e4-a.b)/a.k,y:1e4}:"no_exist"==a.k?s=90==a.degree?{x:a.x,y:-1e3}:{x:a.x,y:1e3}:0==a.k&&(s=0==a.degree?{x:-1e4,y:a.b}:{x:1e4,y:a.b});var r,o,l=!1;if(n>=0&&"number"==typeof n){for(var c=0;c<i.length;c++)if(c!=n){o=e.getLineKb(i[c].degree,i[c].aPoint),r=e.getApointBytwoLine(a,o);var h=e.getTwoLineIntersection(t.aPoint,s,i[c].aPoint,i[c].bPoint);if((r||h)&&(r=e.isInSegment(r,i[c].aPoint,i[c].bPoint)&&e.isInSegment(r,t.aPoint,s),r||h)){l=r||h,n=c;break}}return!!l&&{acrossPoint:l,index:n}}return!1},getApointBytwoLine:function(e,t){var i={};if(e.k==t.k)return!1;if("no_exist"==e.k||"no_exist"==t.k)i="no_exist"==e.k?{x:e.x,y:t.k*e.x+t.b}:{x:t.x,y:e.k*t.x+e.b};else{var n=parseFloat((t.b-e.b)/(e.k-t.k)),s=e.k*n+e.b;i={x:n,y:s}}return i},isInSegment:function(e,t,i){var n=e.x,s=e.y;return(n-t.x)*(n-i.x)<=0&&(s-t.y)*(s-i.y)<=0&&{x:n,y:s}}};return e}),s("js/utils/logger",function(){"use strict";for(var t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],i=t.length,n=e.console=e.console||{},s=null,a=function(){};i--;)s=t[i],n[s]||(n[s]=a);var r={_level:0,_console:n,setLevel:function(e){switch(e){case"debug":this._level=3;break;case"info":this._level=2;break;case"warn":this._level=1;break;case"error":this._level=0;break;default:this._level=-1}},debug:function(){this._level>=3&&this._console.log.apply(this._console,arguments)},info:function(e){this._level>=2&&this._console.info.apply(this._console,arguments)},warn:function(e){this._level>=1&&this._console.warn.apply(this._console,arguments)},error:function(e){this._level>=0&&this._console.error.apply(this._console,arguments)}};return r}),s("js/utils/string",function(){var e={_templateRegExp:/\$\{(.+?)(?:\:(.+?))?\}/g,template:function(e,t){return e.replace(this._templateRegExp,function(e,i,n){return t[i]||e})},getTemplateValue:function(e,t){var i=this.templateRegex(t),n=i.regExp.exec(e);if(!n)return null;for(var s=Object.keys(i.attrs),a=null,r=1;r<n.length;r++)if(a||(a={}),s.length>r-1){var o=s[r-1];"number"===i.attrs[o]?a[o]=parseInt(n[r]):a[o]=n[r]}return a},templateRegex:function(e){var t={},i=e.replace(this._templateRegExp,function(e,i,n){return t[i]=n,n?"number"===n?"(\\d+?)":"string"===n?"(.+?)":void 0:"(.+?)"});return i="^"+i+"$",{regExp:new RegExp(i),attrs:t}}};return e}),s("js/utils/svg",function(){var e={translate:/translate\(\s*?([\-0-9.]*)\s*?([\-0-9.]*)\s*?\)/,rotate:/rotate\(\s*?([\-0-9.]*)\s*?([\-0-9.]*)?\s*?([\-0-9.]*)?\s*?\)/},n={getRotateMatrix:function(e,i,n){var s=t.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("transform","rotate("+e+" "+i+" "+n+")");var a=s.getCTM();return a},getRotateKityMatrix:function(e,t,i){var n=this.getRotateMatrix(e,t,i),s=new kity.Matrix(n.a,n.b,n.c,n.d,n.e,n.f);return s},rotate:function(e,t,n,s){n="undefined"==typeof n?0:n,s="undefined"==typeof s?0:s,i(e).attr("transform","rotate("+t+","+n+","+s+")")},setTranslate:function(e,t,n){t="undefined"==typeof t?0:t,n="undefined"==typeof n?0:n,i(e).attr("transform","translate("+t+","+n+")")},getAttrRotate:function(t){var i=e.rotate.exec(t);return i?(i.shift(),i.forEach(function(e,t){"undefined"!=typeof e?i[t]=parseFloat(e):i[t]=0}),i):[]},getAttrTranslate:function(t){var i=e.translate.exec(t);return i?(i.shift(),i.forEach(function(e,t){i[t]=parseFloat(e)}),i):[]},createJqForeignObject:function(e){var n=t.createElementNS("http://www.w3.org/2000/svg","foreignObject"),s=i('<div class="'+e+'"></div>');return i(n).html(s),i(n)}};return n}),s("js/utils/utils",function(){var e={getFixedFloat:function(e,t){var i=e.toString(),n=i.split(".");if(2!==n.length)return e;""===n[0]&&(n[0]="0");var s=n[1].length;if(0===s||0===t)return parseInt(n[0]);var a=n[0]+"."+n[1].substring(0,t>=s?s:t);return parseFloat(a)},getValue:function(e,t,i){var n="",s=e.match(t);return"number"==typeof i&&s&&s.length>i?n=s[i]:s&&2===s.length&&(n=s[1]),n},getUuid:function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},isMobile:!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),supportTouch:"ontouchend"in t};return e}),s("js/utils/View",["js/utils/GraphMath","js/utils/svg","js/utils/logger"],function(e,t,n){var s={setVisibility:function(e,t){e.setStyle({visibility:t?"":"hidden"})},isVisibilityHidden:function(e){var t=i(e.node).attr("style"),n=/visibility:[\s]*?hidden/.test(t||"");return n},makeAbsViewHorizontal:function(t,i,n,s,a,r,o,l){r=r?r:0,o=o?o:0;var c,h,u=e.getSpherePos(i||0,n);l?(c=s+u.x,h=a+u.y):(c=s-u.x,h=a-u.y),t.setTranslate(c+" "+h);var g=t.getRenderBox();c=c+(c-g.cx)+r,h=h+(h-g.cy)+o,t.setTranslate(c+" "+h)},makeViewAround:function(i,s,a,r,o,l,c,h,u){var g;g="object"==typeof s?t.getAttrRotate(s.getAttr("transform"))[0]:s;var a=a;this.makeAbsViewHorizontal(i,g,a,o,l,c,h,u);var f=i.getRenderBox(),_=e.getRectShortestDistance({x:o,y:l},f),d=e.getLightPos({x:o,y:l},_.pos,r),p=d.x-_.pos.x,y=d.y-_.pos.y,w=t.getAttrTranslate(i.getAttr("transform"));isNaN(w[0]+p)?n.warn(i,"makeViewAround error  isNAN"):i.setTranslate(w[0]+p,w[1]+y)}};return s}),s("js/view/arrow",["js/view/BaseView","js/config/style","js/utils/view"],function(e,t,i){var n={activeFill:kity.Color.parse("#fff"),bgCls:{0:"bg_blue ",1:"bg_red",2:"bg_purple"}},s=e({_$$path:null,_$$activePath:null,_type:null,_width:42,_contraryDirection:!1,create:function(e,t){var i=Object.create(this);return i.__base([]),i._type=e,i._contraryDirection=t,i.createView(),i},createView:function(){this._$$activePath=new kity.Path("M6.913,46c-0.136,0-0.273-0.011-0.41-0.034c-1.06-0.176-1.889-1.01-2.059-2.071    c-1.172-7.314,4.579-15.533,7.306-18.948C3.348,13.541,4.311,6.795,4.456,6.033C4.632,5.102,5.32,4.352,6.232,4.094    C6.456,4.031,6.685,4,6.912,4C7.605,4,8.279,4.288,8.76,4.816c12.288,13.49,24.683,17.681,24.806,17.722    c0.993,0.327,1.677,1.236,1.716,2.281c0.04,1.044-0.575,2.002-1.54,2.403C14.267,35.3,9.17,44.578,9.12,44.671    C8.682,45.498,7.826,46,6.913,46z"),this._$$path=new kity.Path("M6.912,43.5c0,0,5.342-10.071,25.873-18.588c0,0-13-4.281-25.873-18.412    c0,0-1.268,6.674,8.038,18.526C14.95,25.026,5.593,35.268,6.912,43.5z"),this._$$activePath.fill(n.activeFill),this._$$path.fill(n.activeFill),this._$$path.setAttr("class",n.bgCls[this._type]),this._$$clickArea=(new kity.Rect).fill(kity.Color.createRGBA(0,0,0,0)),this._$$clickArea.setSize(36,60),this._$$clickArea.setTranslate(0,-5),this._contraryDirection&&this.getView().setRotate(180,16,0),this.addShape(this._$$activePath),this.addShape(this._$$path),this.addShape(this._$$clickArea)},getHeight:function(){return 42},getWidth:function(){return 32},active:function(e){i.setVisibility(this._$$activePath,e)},isActive:function(){return!i.isVisibilityHidden(this._$$activePath)},changeType:function(e){this._$$path.setAttr("class",n.bgCls[e])},restoreType:function(){this._$$path.setAttr("class",n.bgCls[this._type])}});return s.Type={Blue:"0",Red:"1",Purple:"2"},s}),s("js/view/baseView",["js/base/base","js/utils/utils","js/reflector/domevent","js/utils/svg","js/utils/graphMath","js/utils/view"],function(e,t,n,s,a,r){var o={__overwrite:["domEventHandler","setVisibility"],_uuid:null,_$$view:null,__base:function(i,n){e({}).__base.apply(this,[i,n]),this._uuid||(this._uuid=t.getUuid()),this._$$view=new kity.Group},bindDomEvent:function(e,t,i,s,a){e instanceof jQuery&&(e=e[0]),n.addDomEvent(e,t,i,a),this.__on(i,s,"")},domEventHandler:function(e,t,i){},getUuid:function(){return this._uuid},getView:function(){return this._$$view},addShape:function(e){this._$$view.addShape(e)},setTranslate:function(e,t){1===arguments.length&&"string"==typeof e?this._$$view.setTranslate(e):this._$$view.setTranslate(e+" "+t)},setTranslateX:function(e){var t=s.getAttrTranslate(i(this._$$view.node).attr("transform"));t.length>0&&this.setTranslate(e,t[1])},setOpacity:function(e){this._$$view.setStyle({opacity:e})},translate:function(e,t){this._$$view.translate(e,t)},setVisible:function(e){this._$$view.setVisible(e)},isVisible:function(){return!this.isVisibilityHidden()&&this.getVisible()},setVisibility:function(e){r.setVisibility(this._$$view,e)},isVisibilityHidden:function(){return r.isVisibilityHidden(this._$$view)},makeAbsViewHorizontal:function(e,t,i,n,s,a,o,l){r.makeAbsViewHorizontal(e,t,i,n,s,a,o,l)},makeViewAround:function(e,t,i,n,s,a,o,l,c){r.makeViewAround(e,t,i,n,s,a,o,l,c)}};return function(t){return e(o).__include(t)}}),s("js/view/EqualAngleName",["js/view/BaseView","js/config/style"],function(e,t){var i=t.EqualAngleName,n=e({create:function(e){var t=Object.create(this);return t.__base([]),t._lang=e,t.createView(),t},createView:function(){this._$$name=new kity.Text,this._$$name.setContent(this._lang.rf_equal_angle_name).setAttr("class",i.fontClass),this.addShape(this._$$name)}});return n}),s("js/view/ForeignView",["js/base/base","js/utils/utils","js/utils/svg"],function(e,t,i){var n=e({_uuid:null,_$view:null,_$insideView:null,_width:0,_height:0,_cls:"",create:function(e,n,s){var a=Object.create(this);return a.__base(null,[]),a._cls=e,a._uuid=t.getUuid(),a._$view=i.createJqForeignObject(e),a._$insideView=a._$view.find("div"),a.setWidth(n),a.setHeight(s),a},setDomEvent:function(e){e&&e.length>0&&(this._$view.attr("class","_lr_event"),this._$view.data("event-type",e),this._$view.data("event-identifier",this._uuid))},getUuid:function(){return this._uuid},setWidth:function(e){return this._width=e,this._$view.css({width:e}),this._$view.attr("width",e),this._$insideView.css({width:e}),this},setHeight:function(e){return this._height=e,this._$view.css({height:e}),this._$view.attr("height",e),this._$insideView.css({height:e}),this},setForeignWidth:function(e){this._$view.attr("width",e)},setForeignHeight:function(e){this._$view.attr("height",e)},setInsideWidth:function(e){this._$insideView.css({width:e})},setInsideHeight:function(e){this._$insideView.css({height:e})},getView:function(){return this._$view},appendHtml:function(e){this._$insideView.append(e)},setTranslate:function(e,t){var n=i.getAttrRotate(this._$view.attr("transform")),s=[e,t];this.applyTransform(s,n)},setRotate:function(e,t,n){var s=i.getAttrTranslate(this._$view.attr("transform")),a=[e];"undefined"!=typeof t&&"undefined"!=typeof n&&(a.push(t),a.push(n)),this.applyTransform(s,a)},applyTransform:function(e,t){var i="";e.length>1&&(i="translate("+e[0]+" "+e[1]+")"),1===t.length?i+=" rotate("+t[0]+")":3===t.length&&(i+=" rotate("+t[0]+" "+t[1]+" "+t[2]+")"),this._$view.attr("transform",i)},setVisible:function(e){e?this._$view.show():this._$view.hide()},setVisibility:function(e){this._$view.css({visibility:e?"":"hidden"})},setOpacity:function(e){this._$view.css({opacity:e})},setAttr:function(e,t){this._$view.attr(e,t)},addClass:function(e){this._$insideView.addClass(e)},removeClass:function(e){this._$insideView.removeClass(e)},hasClass:function(e){return this._$insideView.hasClass(e)}});return n}),s("js/view/IncidencePoint",["js/view/BaseView","js/config/style","js/utils/view"],function(e,t){var i=t.IncidencePoint,n=e({_$$line:null,create:function(e){var t=Object.create(this);return t.__base([]),t._data=e,t.createView(),t},createView:function(){this._$$incidencePoint=new kity.Circle(i.width).fill(i.fill),this._$$incidencePoint=new kity.Circle(i.width).fill(i.fill),this.addShape(this._$$incidencePoint)},setRotate:function(e,t,i){t="undefined"==typeof t?0:t,i="undefined"==typeof i?0:i,this._$$line.setRotate(e+" "+t+" "+i)}});return n}),s("js/view/Inverserefractionline",["js/view/BaseView","js/config/style","js/utils/view","js/utils/svg"],function(e,t,i,n){var s=t.InverseRefractionLine,a=e({_$$line:null,_domEvent:null,_width:200,_$$name:null,_pointVisible:!1,_lineVisible:!1,create:function(e){var t=Object.create(this);return t.__base([]),t._width=e,t.createView(),t},createView:function(){this._$$line=new kity.Path("").setStyle(s.strokeStyle),this._$$line.setAttr("d","M0 0 "+this._width+" 0"),this._$$line.setAttr("stroke-dasharray","15,12"),this.addShape(this._$$line),this._$$name=new kity.Text,this._$$name.setContent(s.name).setAttr("class",s.fontClass),this.addShape(this._$$name),this._$$nameDown=new kity.Text,this._$$nameDown.setContent(s.incidencePointName).setAttr("class",s.fontClass),this.addShape(this._$$nameDown)},setRotate:function(e,t,i){t="undefined"==typeof t?this._width:t,i="undefined"==typeof i?0:i,this._$$line.setRotate(e+" "+t+" "+i),this.initNamePos(t,i)},getRotateAngle:function(){var e=n.getAttrRotate(this._$$line.getAttr("transform"));return e[0]},initNamePos:function(e,t){e="undefined"==typeof e?this._width:e,t="undefined"==typeof t?0:t;var i=this._$$nameDown.getWidth(),n=this._$$name.getWidth();this.makeViewAround(this._$$name,this._$$line,this._width,this._width+25,e,t,-n/2+5,0,!1),this.makeViewAround(this._$$nameDown,this._$$line,150,25,e,t,-i/2+5,0,!0)},setNameVisible:function(e){this._$$nameDown.setContent(e===!0?s.incidencePointName:""),this._$$name.setContent(e===!0?s.name:""),this.initNamePos()},setPointNameVisibility:function(e,t){this._pointVisible=t,this._$$nameDown.setContent(e===!0?s.incidencePointName:""),i.setVisibility(this._$$nameDown,t),i.setVisibility(this._$$name,this._lineVisible),i.setVisibility(this._$$line,this._lineVisible),this.setVisibility(!0),this.initNamePos()},setLineVisibility:function(e,t){this._lineVisible=t,this._$$name.setContent(e===!0?s.name:""),i.setVisibility(this._$$name,t),i.setVisibility(this._$$nameDown,this._pointVisible),i.setVisibility(this._$$line,t),this.setVisibility(!0),this.initNamePos()},showAll:function(){this.setVisibility(!0),i.setVisibility(this._$$name,!0),i.setVisibility(this._$$nameDown,!0),i.setVisibility(this._$$line,!0),this.initNamePos()},getLineVisible:function(){return this._lineVisible},getPointNameVisible:function(){return this._pointVisible}});return a}),s("js/view/LightLine",["js/view/BaseView","js/config/style","js/utils/utils","js/utils/graphmath","js/utils/svg","js/view/ForeignView","js/config/eventKey","js/utils/view"],function(e,t,s,a,r,o,l,c){var h=t.LineStyle,u=h.strokeStyle["stroke-width"],g=n("js/view/arrow"),f={width:290,arrowPos:145,visible:!0,clickAble:!0,nameEnable:!0},_=e({_$$lineGroup:null,_lineGroupUuid:"",_$$lintWhite:null,_arrow:null,_fwBtn:null,_fwTranBtn:null,_config:null,_lightType:null,_$$name:null,_onLightMove:null,_onLightTrans:null,_onLightFocusBlur:null,_lang:null,create:function(e,t,n,a,r,o,c){var h=Object.create(this),u=[];return u.push({key:l.Blur,callback:h.blur,params:[]}),h.__base(e,u),h._lightType=t,h._config=i.extend(!0,{},f,n),h._onLightMove=a,h._onLightTrans=r,h._onLightFocusBlur=o,h._lineGroupUuid=s.getUuid(),h._lang=c,h.createView(),h.__on(l.BtnMove+h._fwBtn.getUuid(),h.domEventHandler,[]),h.__on(l.BtnMove+h._fwTranBtn.getUuid(),h.domEventHandler,[]),h},createView:function(){this._$$offsetPoint=new kity.Circle(10).fill(kity.Color.createRGBA(0,0,0,0)),this.addShape(this._$$offsetPoint),this._$$name=new kity.Text;var e=this._lightType===_.Type.IncidenceLine?this._lang.rf_incidence_line_name:this._lang.rf_refraction_line_name;this._$$name.setContent(e).setAttr("class",h[this._lightType].fontClass),this.addShape(this._$$name),this._$$lineGroup=new kity.Group,this._$$lintWhite=(new kity.Rect).setStyle(h.strokeStyle),this._$$lintWhite.setSize(this.getWidth()+u,h.rectHeight+u),this._$$lintWhite.translate(-u/2,-u/2),this._$$lineGroup.addShape(this._$$lintWhite),this._arrow=g.create(this._lightType===_.Type.IncidenceLine?g.Type.Blue:g.Type.Red,this._lightType===_.Type.RefractionLine),this._$$lineGroup.addShape(this._arrow.getView()),this.initArrowPos(),this._$$lintClick=(new kity.Rect).fill(kity.Color.createRGBA(0,0,0,0));var t=h.arrow.height/5;this._$$lintClick.setSize(this.getWidth()+u,t),this._$$lintClick.translate(0,-(t-h.rectHeight)/2),this._$$lineGroup.addShape(this._$$lintClick),this._$$whiteRect=new kity.Rect,this._$$whiteRect.setSize(this.getWidth(),h.rectHeight),this._$$whiteRect.fill(h[this._lightType].fill),this._$$lineGroup.addShape(this._$$whiteRect),this._fwBtn=o.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtn.setTranslate(0,-h.btnRotate.height-10),this._fwBtnInvisible=o.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtnInvisible.setTranslate(0,-h.btnRotate.height-10),this._fwBtnInvisible.setVisibility(!1),this._fwBtn.setVisibility(!1),i(this._$$lineGroup.node).append(this._fwBtn.getView()),i(this._$$lineGroup.node).append(this._fwBtnInvisible.getView()),this._fwTranBtn=o.create("btn_translate",h.btnRotate.width,h.btnRotate.height),this._fwTranBtn.setTranslate(0,h.btnRotate.height-45),this._fwTranBtnInvisible=o.create("btn_translate",h.btnRotate.width,h.btnRotate.height),this._fwTranBtnInvisible.setTranslate(0,h.btnRotate.height-45),this._fwTranBtnInvisible.setVisibility(!1),this._fwTranBtn.setVisibility(!1),i(this._$$lineGroup.node).append(this._fwTranBtn.getView()),i(this._$$lineGroup.node).append(this._fwTranBtnInvisible.getView()),this.addShape(this._$$lineGroup),this.bindDomEvent(this._$$lineGroup.node,["lrTap"],this._lineGroupUuid,this.domEventHandler,!1),this.initView()},getWidth:function(){return this._config.width},setWidth:function(e){this._config.width=e=isNaN(e)?this._config.width:e,this._lightType===_.Type.RefractionLine?this._config.arrowPos=(e-this._arrow.getWidth())/3:this._config.arrowPos=e-this._arrow.getWidth()-(e-this._arrow.getWidth())/3,this._config.width<=this._arrow.getWidth()+10?this._arrow.setVisibility(!1):this._arrow.setVisibility(!0),this._$$lintWhite.setSize(this.getWidth()+u,h.rectHeight+u);var t=h.arrow.height/3;this._$$lintClick.setSize(this.getWidth()+u,t),this._$$whiteRect.setSize(this.getWidth(),h.rectHeight),this.initArrowPos(),this.setTranslate(-this.getWidth(),-1);var i=r.getAttrRotate(this._$$lineGroup.getAttr("transform"));i&&i.length>0&&this._$$lineGroup.setRotate(i[0]+" "+this.getWidth()+" "+i[2]),this._tranBtnTranslate(),this.initNamePos()},setArrowPos:function(e){this._config.arrowPos=isNaN(e)?this._config.arrowPos:e,this.initArrowPos()},initArrowPos:function(){this._lightType===_.Type.RefractionLine?this._arrow.setTranslate(this.getArrowPos(),(h.rectHeight+this._arrow.getHeight())/2+3.5):this._arrow.setTranslate(this.getArrowPos(),(-this._arrow.getHeight()-h.rectHeight)/2+1+3)},getArrowPos:function(){return this._config.arrowPos},blur:function(e){e!==this._lineGroupUuid&&(this.setFwBtnVisible(!1),this._$$lintWhite.setVisible(!1),this._arrow.active(!1),this._fwTranBtn.setVisible(!1),this._onLightFocusBlur("blur"))},setClickAble:function(e){this._config.clickAble=e},domEventHandler:function(e,t,i){if(this._config.clickAble){if(t===this._fwBtn.getUuid())this._onLightMove(this._lightType,i,e),"aftermove"===e&&this.__triggerEvent("insidechange",this._lightType+"-move");else if(t===this._fwTranBtn.getUuid())this._onLightTrans(this._lightType,i,e),"aftermove"===e&&this.__triggerEvent("insidechange",this._lightType+"-move");else if(t===this._lineGroupUuid&&"lrTap"===e){if(this._arrow.isActive())return void this.blur();this.setFwBtnVisible(!0),this._$$lintWhite.setVisible(!0),this._arrow.active(!0),this._fwTranBtn.setVisible(!0),this._onLightFocusBlur("focus")}this.btnStillInBox(),this._tranBtnTranslate()}},initView:function(){this.setFwBtnVisible(!1),this._fwTranBtn.setVisible(!1),this._$$lintWhite.setVisible(!1),this._arrow.active(!1),this._config.nameEnable===!1&&c.setVisibility(this._$$name,!1),this.setVisibility(this._config.visible)},setRotate:function(e,t,i){t="undefined"==typeof t?this.getWidth():t,i="undefined"==typeof i?h.rectHeight/2:i,this._$$lineGroup.setRotate(e+" "+t+" "+i),this.initNamePos(t,i),this.fwBtnMove()},rotate:function(e,t,i){t="undefined"==typeof t?this.getWidth():t,i="undefined"==typeof i?h.rectHeight/2:i;var n=r.getAttrRotate(this._$$lineGroup.getAttr("transform"));n&&n.length>0?this._$$lineGroup.setRotate(n[0]+e+" "+t+" "+i):this._$$lineGroup.setRotate(e+" "+t+" "+i),this.initNamePos(t,i),this.fwBtnMove()},getRotateAngle:function(){var e=r.getAttrRotate(this._$$lineGroup.getAttr("transform"));return e[0]},initNamePos:function(e,t){return!1},getRotatePos:function(){return{x:this.getWidth(),y:h.rectHeight/2}},setNameVisible:function(e){this._config.nameEnable&&c.setVisibility(this._$$name,e)},setCommonFill:function(){this._$$whiteRect.fill(h.commonLineFill),this._arrow.changeType(g.Type.Purple)},restoreFill:function(){this._$$whiteRect.fill(h[this._lightType].fill),this._arrow.restoreType()},setNameEnable:function(e){this._config.nameEnable=e,c.setVisibility(this._$$name,e)},getNameEnable:function(){return this._config.nameEnable},setOpacityIgnoreName:function(e){i(this._$$lineGroup.node).css({opacity:e}),i(this._arrow.getView()).css({opacity:e}),i(this._$$lineGroup.node).css({opacity:e})},setVisibility:function(t){e({}).setVisibility.apply(this,[t]),this.__triggerEvent(l.LightLineVisible,this._lightType,t)},makeNameViewAround:function(e,t,i){t="undefined"==typeof t?this.getWidth():t,i="undefined"==typeof i?h.rectHeight/2:i,e="undefined"==typeof e?this._$$lineGroup:e,this.makeViewAround(this._$$name,e,this.getWidth(),this.getWidth()+10,t,i,0,0,!1)},getLightType:function(){return this._lightType},_tranBtnTranslate:function(){var e=r.getAttrTranslate(this._fwBtn.getView().attr("transform")),t=r.getAttrTranslate(this._fwTranBtn.getView().attr("transform")),i=e[0];this._fwTranBtn.setTranslate(i,t[1]),this.fwBtnMove()},btnStillInBox:function(){var e=(this._fwBtn.getView().closest("svg"),this._fwBtnInvisible.getView()[0].getBoundingClientRect()),t=this._fwBtn.getView().closest("svg")[0].getBoundingClientRect(),i=this._fwTranBtnInvisible.getView()[0].getBoundingClientRect();this.originalRect=e,this.svgRect=t;var n=Math.abs(this.getRotateAngle()%180);n<=0&&(n=-n),n>90&&(n=180-n);var s=r.getAttrTranslate(this._fwBtnInvisible.getView().attr("transform"));if(!(s.length<=0))if(e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&i.bottom<=t.bottom&&i.left>=t.left&&i.right<=t.right&&i.top>=t.top)this.fwBtnTranslate(0,s[1]);else{var o=0,l=this.getScale();if(e.left<=t.left||i.left<=t.left){var c=0;o=s[0]- -c,this.fwBtnTranslate(o,s[1])}if(e.right>=t.right||i.right>=t.right){var c=0;o=s[0]- -c,this.fwBtnTranslate(o,s[1])}if(e.bottom>=t.bottom){var h=e.bottom-t.bottom,c=0;0!=n&&(c=h/Math.sin(a.getRadian(n))/l),(0==o||o<s[0]+c)&&(o=s[0]+c),this.fwBtnTranslate(o,s[1])}if(i.bottom>=t.bottom){var h=i.bottom-t.bottom,c=0;0!=n&&(c=h/Math.sin(a.getRadian(n))/l),(0==o||o<s[0]+c)&&(o=s[0]+c),this.fwBtnTranslate(o,s[1])}if(e.top<=t.top){var h=t.top-e.top,c=0;0!=n&&(c=h/Math.sin(a.getRadian(n))/l),(0==o||o<s[0]+c)&&(o=s[0]+c),this.fwBtnTranslate(o,s[1])}}},fwBtnTranslate:function(e,t){e>this.getWidth()-h.btnRotate.width&&(e=this.getWidth()-h.btnRotate.width),this._fwBtn.setTranslate(e,t)},fwBtnMove:function(){this.isVisibilityHidden()||this.__triggerEvent(l.MoveBtn,this.getScale(),this._fwBtn.getView()[0].getBoundingClientRect(),this._fwTranBtn.getView()[0].getBoundingClientRect(),this._fwBtn.getUuid(),this._fwTranBtn.getUuid())},setFwBtnVisible:function(e){this.__triggerEvent(l.MoveBtn,this.getScale(),this._fwBtn.getView()[0].getBoundingClientRect(),this._fwTranBtn.getView()[0].getBoundingClientRect(),this._fwBtn.getUuid(),this._fwTranBtn.getUuid(),e)},getScale:function(){var e=this._$$offsetPoint.node.getBoundingClientRect().width/20||1;return e},setNameDisplay:function(e){i(this._$$name.node).css("display",e)}});return _.Type={IncidenceLine:"IncidenceLine",ReflectionLine:"ReflectionLine",RefractionLine:"RefractionLine",NormalLine:"NormalLine",SurfaceIn:"SurfaceIn",SurfaceOut:"SurfaceOut"},_}),s("js/view/multipleText",["js/view/BaseView","js/utils/view"],function(e,t){var i=e({_lineHeight:18,_$$texts:[],create:function(e){var t=Object.create(this);return t._$$texts=[],t._lineHeight=e,t.__base([]),t.createView(),t},createView:function(){},setContent:function(e){this.clear();var t=this;"string"==typeof e?t.appendLine(e):e.forEach(function(e){t.appendLine(e)}),this.center()},center:function(){var e=0;if(this._$$texts.length>1){var t=!1;this._$$texts.forEach(function(i){var n=i.getWidth();if(n>e){
e=n;var s=i.getContent();t="°"===s.substring(s.length-1,s.length)}}),this._$$texts.forEach(function(t){var i=t.getWidth();i<e&&t.setAttr("x",Math.abs((e-i)/2))})}},getRenderBox:function(){return this._$$view.getRenderBox()},getAttr:function(e){return this._$$view.getAttr(e)},appendLine:function(e){var t=this._$$texts.length*this._lineHeight,i=(new kity.Text).setContent(e).setAttr("x",0).setAttr("y",t>=0?t:0).setAttr("class","nd_NewRoman");this._$$texts.push(i),this._$$view.addShape(i)},getWidth:function(){var e=0;return this._$$texts.forEach(function(t){t.getWidth()>e&&(e=t.getWidth())}),e},getContent:function(){},getHeight:function(){return this._lineHeight*this._$$texts.length},clear:function(){this._$$texts.forEach(function(e){e.remove()}),this._$$texts=[]}});return i}),s("js/view/NameGroup",["js/view/BaseView","js/config/style","js/utils/graphmath","js/utils/svg","js/view/MultipleText","js/view/sector","js/utils/view"],function(e,t,n,s,a,r,o){var l=t.Sector,c=5,h=e({_data:"",_nameVisible:!0,_$$incidencePoint:null,_lang:null,_lightHeight:50,_option:null,_status:null,create:function(e,t,i){var n=Object.create(this);n.__base([]),n._data=e,n._lang=t,n._option=i,n._status={};for(var s in r.Type)n._status[r.Type[s]]=!1;return n.createView(),n},createView:function(){var e=this;for(var t in this._data){var i=this._data[t];i.mtAngle=a.create(e._lightHeight),i.mtName=a.create(e._lightHeight),t==r.Type.SurfaceIn||t==r.Type.SurfaceOut?(i.name="",i.mtAngle.getView().setAttr("class",l.surfaceFontClass)):t==r.Type.Incidence?(i.name=this._lang.rf_incidence_angle,i.mtAngle.getView().setAttr("class",l.incidence_normalFontClass),i.mtInvisibleAngle=a.create(e._lightHeight),i.mtInvisibleAngle.getView().setAttr("class",l.normalFontClass),i.mtName=a.create(e._lightHeight),i.mtName.getView().setAttr("class",l.normalFontClass),e.addShape(i.mtInvisibleAngle.getView()),o.setVisibility(i.mtInvisibleAngle.getView(),!1)):t==r.Type.Refraction&&(i.name=this._lang.rf_refraction_angle,i.mtAngle.getView().setAttr("class",l.normalFontClass),i.mtInvisibleAngle=a.create(e._lightHeight),i.mtInvisibleAngle.getView().setAttr("class",l.normalFontClass),i.mtName=a.create(e._lightHeight),i.mtName.getView().setAttr("class",l.normalFontClass),e.addShape(i.mtInvisibleAngle.getView()),o.setVisibility(i.mtInvisibleAngle.getView(),!1)),i.angleStr="",i.angle=0,e.addShape(i.mtAngle.getView()),e.addShape(i.mtName.getView()),i.mtName.setVisibility(!1)}},getAngle:function(e){return this._data[e].actualAngle},getRoundAngle:function(e){return this._data[e].angle},setNormalAngle:function(e){this._normalAngle=e},rotate:function(e,t){var i=function(e,t,i){return t?i-e:e};this._rotate(r.Type.SurfaceIn,e[i(0,t,3)],e[i(1,t,5)]),this._rotate(r.Type.Incidence,e[i(1,t,3)],e[i(2,t,5)]),this._rotate(r.Type.Refraction,e[i(3,t,3)],e[i(4,t,5)]),this._rotate(r.Type.SurfaceOut,e[i(3,t,3)],e[i(4,t,5)])},_rotate:function(e,t,i){var n=this._data[e],s=Math.abs((t-i).toFixed(1));n.angle=s,n.actualAngle=Math.abs(t-i),n.angleStr=s+"°";var a=t+(i-t)/2;n.sphereAngle=a,this.updatePosByType(e)},isNameVertical:function(){var e=this._normalAngle%360;return!(e>-40&&e<=0)&&(!(e<=360&&e>=310)&&(!(e>=0&&e<=40)&&!(e>=130&&e<=230)))},setNameVisible:function(e){this._nameVisible=e;for(var t in this._data)this._status[t]===!0&&(this._data[t].mtName&&o.setVisibility(this._data[t].mtName.getView(),e),this.updatePosByType(t))},setNameStatusAndVisible:function(e,t){this._data[e].mtName&&(this._data[e].mtName&&o.setVisibility(this._data[e].mtName.getView(),t),this._status[e]=!0,this.updatePosByType(e))},updatePosByType:function(e){var t=this._data[e],i=!t.mtName.isVisibilityHidden();if(0===t.angle||90===t.angle)t.mtName.setContent(""),t.mtAngle.setContent(""),e!=r.Type.Incidence&&e!=r.Type.Reflection||t.mtInvisibleAngle.setContent("");else{var n=this.isNameVertical();i?t.mtName.setContent(n?t.name.split(""):t.name):t.mtName.setContent(""),t.mtAngle.setContent(t.angleStr);var a=t.r+this._lightHeight;if(n||!i||this.isSurfaceAngle(e)||(a+=t.mtAngle.getWidth()/2+t.mtName.getWidth()/2),this.isSurfaceAngle(e)||(a+=5),this.isSurfaceAngle(e)||!i)this.makeAbsViewHorizontal(t.mtAngle,t.sphereAngle,a,t.cx,t.cy,0,0,!1);else if(i){n?t.mtInvisibleAngle.setContent(t.angleStr):t.mtInvisibleAngle.setContent(t.name+t.angleStr),this.makeAbsViewHorizontal(t.mtInvisibleAngle,t.sphereAngle,a,t.cx,t.cy,0,0,!1);var o=s.getAttrTranslate(t.mtInvisibleAngle.getAttr("transform"));n?o[1]<0?(t.mtAngle.setTranslate(o[0],o[1]-t.mtAngle.getHeight()+this._lightHeight),t.mtName.setTranslate(o[0]+c,o[1]-t.mtAngle.getHeight()-t.mtName.getHeight()+this._lightHeight)):(t.mtName.setTranslate(o[0]+c,o[1]),t.mtAngle.setTranslate(o[0],o[1]-t.mtAngle.getHeight()+t.mtName.getHeight()+this._lightHeight)):(t.mtAngle.setTranslate(o[0]+t.mtName.getWidth(),o[1]),t.mtName.setTranslate(o[0],o[1]))}}},isSurfaceAngle:function(e){return e==r.Type.SurfaceIn||e==r.Type.SurfaceOut},setAngleVisibleByType:function(e,t){t&&(this._status[e]=!0);var i=this._data[e];o.setVisibility(i.mtAngle.getView(),t),this._status[e]===!0&&o.setVisibility(i.mtName.getView(),this._nameVisible),this.updatePosByType(e)},getAngleIsValidByType:function(e){var t=this._data[e];return 0!==t.angle&&90!==t.angle&&!o.isVisibilityHidden(t.mtAngle.getView())},getHasDrawStatus:function(){return this._status},setHasDrawStatus:function(e,t){this._status=e},setHasDrawStatusByType:function(e,t){if("undefined"!=typeof t)this._status[t]=e;else for(var i in this._status)this._status[i]=e},getHasDrawStatusByType:function(e){return this._status[e]},getAngleVisibilityByType:function(e){var t=this._data[e];return!o.isVisibilityHidden(t.mtAngle.getView())},setEnable:function(e){for(var t in this._data)this._status[t]===!0&&(this._data[t].mtName&&o.setVisibility(this._data[t].mtName.getView(),visible),this.updatePosByType(t))},setNameDisplay:function(e){for(var t in this._data)i(this._data[t].mtName._$$view.node).css("display",e),i(this._data[t].mtAngle._$$view.node).css("display",e)},getNameByType:function(e){var t=this._data[e];return t.mtAngle.getView()}});return h}),s("js/view/normalLine",["js/view/BaseView","js/config/style","js/utils/view","js/utils/svg"],function(e,t,i,n){var s=t.NormalLine,a=e({_$$line:null,_domEvent:null,_width:200,_$$name:null,_pointVisible:!1,_lineVisible:!1,_lang:!1,create:function(e,t){var i=Object.create(this);return i.__base([]),i._width=e,i._lang=t,i.createView(),i},createView:function(){this._$$line=new kity.Path("").setStyle(s.strokeStyle),this._$$line.setAttr("d","M0 0 "+this._width+" 0"),this._$$line.setAttr("stroke-dasharray","15,12"),this.addShape(this._$$line),this._$$name=new kity.Text,this._$$name.setContent(this._lang.rf_normal_name).setAttr("class",s.fontClass),this.addShape(this._$$name),this._$$nameDown=new kity.Text,this._$$nameDown.setContent(this._lang.rf_incidence_point).setAttr("class",s.fontClass),this.addShape(this._$$nameDown)},setRotate:function(e,t,i){t="undefined"==typeof t?this._width:t,i="undefined"==typeof i?0:i,this._$$line.setRotate(e+" "+t+" "+i),this.initNamePos(t,i)},getRotateAngle:function(){var e=n.getAttrRotate(this._$$line.getAttr("transform"));return e[0]},initNamePos:function(e,t){e="undefined"==typeof e?this._width/2:e,t="undefined"==typeof t?0:t;var i=this._$$nameDown.getWidth(),n=this._$$name.getWidth();this.makeViewAround(this._$$name,this._$$line,this._width,this._width/2+25,e,t,-n/2+5,0,!1),this.makeViewAround(this._$$nameDown,this._$$line,150,25,e,t,-i/2-10,0,!0)},setNameVisible:function(e){this._$$nameDown.setContent(e===!0?this._lang.rf_incidence_point:""),this._$$name.setContent(e===!0?this._lang.rf_normal_name:""),this.initNamePos()},setPointNameVisibility:function(e,t){this._pointVisible=t,i.setVisibility(this._$$nameDown,t),i.setVisibility(this._$$name,this._lineVisible),i.setVisibility(this._$$line,this._lineVisible),this.setVisibility(!0),this.initNamePos()},setLineVisibility:function(e,t){this._lineVisible=t,i.setVisibility(this._$$name,t),i.setVisibility(this._$$nameDown,this._pointVisible),i.setVisibility(this._$$line,t),this.setVisibility(!0),this.initNamePos()},showAll:function(){this.setVisibility(!0),i.setVisibility(this._$$name,!0),i.setVisibility(this._$$nameDown,!0),i.setVisibility(this._$$line,!0),this.initNamePos()},getLineVisible:function(){return this._lineVisible},getPointNameVisible:function(){return this._pointVisible}});return a}),s("js/view/PedalLine",["js/view/BaseView","js/config/style","js/utils/svg","js/utils/view"],function(e,t,i){var n=t.Pedal,s=e({_$$line:null,create:function(e){var t=Object.create(this);return t.__base([]),t._data=e,t.createView(),t},createView:function(){var e=this._$$line=(new kity.Path).setId("dd").setStyle(n.strokeStyle),t=e.getDrawer();t.moveTo(-n.width,0),t.lineTo(-n.width,-n.width),t.lineTo(0,-n.width),this.addShape(e)},setRotate:function(e,t,i){t="undefined"==typeof t?0:t,i="undefined"==typeof i?0:i,this._$$line.setRotate(e+" "+t+" "+i)},getRotateAngle:function(){var e=i.getAttrRotate(this._$$line.getAttr("transform"));return e}});return s}),s("js/view/sector",["js/view/BaseView","js/config/style","js/utils/graphmath","js/utils/svg","js/view/MultipleText"],function(e,t,i,n,s){var a=t.Sector,r=e({_$$sector:null,_$$sectorBorder:null,_type:1,_startAngle:0,_endAngle:0,_cx:0,_cy:0,_lang:0,_$$incidencePoint:null,create:function(e,t,i,n,s){var a=Object.create(this);return a.__base([]),a._type=e,a._cx=t,a._cy=i,a._r=n,a._lang=s,a.createView(),a},createView:function(){this._$$sector=new kity.Path(""),this._$$sectorBorder=new kity.Path(""),this._$$sectorBorder.setStyle(a.strokeStyle),this._type===r.Type.SurfaceIn||this._type===r.Type.SurfaceOut?this._$$sector.fill(a.surfaceFill):this._type===r.Type.Incidence?this._$$sector.fill(a.incidence_normalFill):this._type!==r.Type.Reflection&&this._type!==r.Type.Refraction||this._$$sector.fill(a.normalFill),this.addShape(this._$$sector),this.addShape(this._$$sectorBorder)},rotate:function(e,t){this._startAngle=e,this._endAngle=t;var n=180-e,s=180-t,a=i.getSvgSectorPoint(this._cx,this._cy,this._r,s,n);this._$$sector.setAttr("d",a),this._$$sectorBorder.setAttr("d",a)}});return r.Type={Incidence:1,Reflection:2,SurfaceIn:3,SurfaceOut:4,Refraction:5},r}),s("js/view/surface",["js/view/BaseView","js/config/style","js/utils/utils","js/utils/svg","js/view/ForeignView","js/config/eventKey","js/utils/view"],function(e,t,s,a,r,o,l){var c=n("js/utils/graphmath"),h=t.Surface,u={width:520,defaultAngle:0,rotatePosX:5,rotatePosY:4,visible:!0,clickAble:!0,nameEnable:!0,nameEventEnable:!0,type:""},g=e({_config:null,_$$surface:null,_$$name:null,_onSurfaceMove:null,_lang:null,_$$incidencePoint:null,create:function(e,t,n,s){var a=Object.create(this);a._config=i.extend(!0,{},u,t);var r=[];return a._config.nameEventEnable&&r.push({key:o.NameVisible,callback:"nameVisibleHandler",params:[]}),r.push({key:o.Blur,callback:a.blur,params:[]}),a.__base(e,r),a._type=t.type,a._onSurfaceMove=n,a._lang=s,a.createView(),a},createView:function(){this._$$surface=new kity.Group;var e="wall_tl";g.Type.tl===this._type?e="wall_tl":g.Type.tr===this._type?e="wall_tr":g.Type.tl_Large===this._type&&(e="wall_tl_large"),this._fwSurface=r.create(e,this._config.width,h.height),i(this._$$surface.node).append(this._fwSurface.getView()),this.addShape(this._$$surface),this._$$offsetPoint=new kity.Circle(10).fill(kity.Color.createRGBA(0,0,0,0)),this._$$offsetPoint.setTranslate(this._config.rotatePosX,this._config.rotatePosY),this.addShape(this._$$offsetPoint),this._$$name=new kity.Text,this._$$name.setContent(this._lang.rf_refraction_surface).setAttr("class",h.fontClass),this._config.nameEnable||l.setVisibility(this._$$name,!1),this.addShape(this._$$name),this._fwBtn=r.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtnInvisible=r.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtnInvisible.setVisibility(!1),i(this._$$surface.node).append(this._fwBtn.getView()),i(this._$$surface.node).append(this._fwBtnInvisible.getView()),this.intOriginalFwBtnPos(),this.setTranslate(0,-3),this.bindDomEvent(this._$$surface.node,["lrTap"],this.getUuid(),this.domEventHandler),this.bindDomEvent(this._fwBtn.getView(),["move","aftermove"],this._fwBtn.getUuid(),this.domEventHandler),this._fwBtn.setVisible(!1),i(this.getView().node).attr("class","_lr_surface"),this.setVisibility(this._config.visible)},intOriginalFwBtnPos:function(){this._type===g.Type.tl?(this._fwBtn.setTranslate(this._config.width+10,(h.height-h.btnRotate.height)/2),this._fwBtnInvisible.setTranslate(this._config.width+10,(h.height-h.btnRotate.height)/2)):(this._fwBtn.setTranslate(-h.btnRotate.width-10,(h.height-h.btnRotate.height)/2),this._fwBtnInvisible.setTranslate(-h.btnRotate.width-10,(h.height-h.btnRotate.height)/2))},blur:function(e){e!==this.getUuid()&&(this._fwBtn.setVisible(!1),this._fwSurface.removeClass("on"))},domEventHandler:function(e,t,i){if(this._config.clickAble){if(t===this.getUuid()){if("lrTap"===e){if(this._fwSurface.hasClass("on"))return void this.blur();this._fwBtn.setVisible(!0),this._fwSurface.addClass("on")}}else t===this._fwBtn.getUuid()&&(this._onSurfaceMove(i,e),"aftermove"===e&&this.__triggerEvent("insidechange","surface-move"));this.btnStillInBox()}},getSurfaceXAxisDegree:function(e){var t=e.getRotateAngle()%180;return t=t<=0?-t:180-t},btnStillInBox:function(){var e=this._fwBtnInvisible.getView()[0].getBoundingClientRect(),t=this._fwBtn.getView().closest("svg")[0].getBoundingClientRect(),i=Math.abs(this.getRotateAngle()%180);i<=0&&(i=-i),i>90&&(i=180-i);var n=a.getAttrTranslate(this._fwBtnInvisible.getView().attr("transform"));if(!(n.length<=0)){if(e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right&&e.top>=t.top)this._type===g.Type.tl?this._fwBtn.setTranslate(this._config.width+10,n[1]):this._fwBtn.setTranslate(-h.btnRotate.width-10,n[1]);else{var s=0,r=this.getScale(),o=this._type===g.Type.tl;if(e.left<=t.left){var l=t.left-e.left,u=l/Math.cos(c.getRadian(i))/r;s=n[0]-(o?u:-u),this._fwBtn.setTranslate(s,n[1])}if(e.bottom>=t.bottom){var l=e.bottom-t.bottom,u=l/Math.sin(c.getRadian(i))/r;o?(0==s||s>n[0]-u)&&(s=n[0]-u):(0==s||s<n[0]+u)&&(s=n[0]+u),this._fwBtn.setTranslate(s,n[1])}if(e.top<=t.top){var l=t.top-e.top,u=l/Math.sin(c.getRadian(i))/r;o?(0==s||s>n[0]-u)&&(s=n[0]-u):(0==s||s<n[0]+u)&&(s=n[0]+u),this._fwBtn.setTranslate(s,n[1])}}}},rotate:function(e,t,i){t="undefined"==typeof t?this._config.rotatePosX:t,i="undefined"==typeof i?this._config.rotatePosY:i;var n=a.getAttrRotate(this._$$surface.getAttr("transform"));n&&n.length>0?this._$$surface.setRotate(n[0]+e+" "+t+" "+i):this._$$surface.setRotate(e+" "+t+" "+i),this.initNamePos(t,i)},getRotateOffsetPos:function(){var e=i(this._$$offsetPoint.node).offset();return{x:e.left,y:e.top}},getRotateAngle:function(){var e=a.getAttrRotate(this._$$surface.getAttr("transform"));return e[0]||0},initNamePos:function(e,t){var i=this._config.rotatePosX+100,n=this._config.rotatePosX+20;this.makeViewAround(this._$$name,this._$$surface,i,n,this._config.rotatePosX,t,0,-(h.height-this._$$name.getHeight())/2,!1)},setNameVisible:function(e){this._config.nameEnable&&l.setVisibility(this._$$name,e)},nameVisibleHandler:function(e){this.setNameVisible(e)},setClickAble:function(e){this._config.clickAble=e},getScale:function(){var e=this._$$offsetPoint.node.getBoundingClientRect().width/20||1;return e},get0To360RotateAngle:function(){var e=this.getRotateAngle()%360;return e<0&&(e=360+e),e}});return g.Type={tl:"tl",tr:"tr",tl_Large:"wall_tl_large"},g}),s("js/mainRefraction",["js/refractor/refractorMain","js/utils/logger"],function(t,i){e.LightRefractor={create:function(e){return t.create(e)},setLogLevel:function(e){i.setLevel(e)},setLang:function(e){},getLang:function(){}}}),n("js/mainRefraction")}(window,document,jQuery);
//# sourceMappingURL=light.min.js.map
