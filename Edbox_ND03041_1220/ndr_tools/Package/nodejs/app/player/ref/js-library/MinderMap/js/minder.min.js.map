{"version":3,"sources":["minder.min.js"],"names":["window","document","$","undefined","loopy","timeout_id","str_setTimeout","time_count","elems","forEach","elem","width","height","data","str_data","w","h","trigger","str_resize","get","str_resize_key","attr","length","removeItem","removeData","unbind","clearTimeout","jq_resize","str_delay","resize","extend","str_throttle","getRandomId","name","Math","random","Date","getMilliseconds","toString","replace","arry","item","i","temp","isNaN","j","event","special","setup","this","push","teardown","add","handleObj","new_handler","e","old_handler","apply","arguments","isFunction","handler","jQuery","support","touch","mobile","navigator","userAgent","match","vEventHandler","getEventX","originalEvent","changedTouches","clientX","getEventY","clientY","mDblclick","$that","_start","_end","_startPos","_endPos","_clickTrigger","bind","which","getTime","x","y","holdTime","abs","dx","dy","fix","type","tapEventSource","tapFireTouch","triggerHandler","utils","PinchIntensity","getDistance","pos1","pos2","sqrt","getFingers","ev","touches","calScale","pstart","pmove","intensity","disStart","disEnd","scale","isTouchEnd","isTouchMove","getPosOfEvent","posi","src","t","len","pageX","pageY","mPinch","_intensity","intensityAttr","parseFloat","_touchStart","startPinch","pos","start","move","end","reset","pinch","eventObj","originEvent","fingersCount","fingerStatus","fn","callback","mPinchSetIntensity","mouseDown","mouseUp","mouseWheel","fixed","bodys","getElementsByTagName","addEventListener","mTap","vMouseDown","vMouseUp","_startX","_startY","_target","target","endX","endY","upTarget","sourceCapabilities","firesTouchEvents","getEventPos","mTouchLong","_tid","_touchTrigger","setTimeout","getVerticalScrollbarWidth","autogrow","options","horizontal","vertical","debugx","debugy","addWidth","debugcolor","flickering","postGrowCallback","verticalScrollbarWidth","filter","each","$e","$shadow","heightPadding","minHeight","minWidth","update","maxWidth","cssMaxWidth","parseInt","css","hasVerticalScrollBar","clientHeight","scrollHeight","position","display","background-color","top","left","max-width","padding","fontSize","fontFamily","fontWeight","lineHeight","word-wrap","word-break","box-sizing","appendTo","body","_this","val","value","space","Array","join","html","max","outerWidth","on","inner","outer","w1","w2","createElement","style","visibility","overflow","appendChild","offsetWidth","clientWidth","removeChild","call","__M","kity","View","DefaultLang","mdnode_centralname","mdnode_branchname","mdnode_addchildtip","mdmenu_edit","mdmenu_visible","mdmenu_invisible","mdmenu_copy","mdmenu_cut","mdmenu_paste","mdmenu_delete","mindConfig","palette","Palette","Color","createRGBA","createRGB","parse","nodeStyle","paddingX","paddingY","strokeStyle","stroke-width","stroke","opacity","cursor","activeStrokeStyle","moveCoverStyle","moveStyle","placeholderStyle","fill","requireCompletedFill","radius","textStyle","font-size","dominant-baseline","groupColor","groupTransform","lineStyle","triangleStyle","lineWidth","circleStrokeStyle","clickCircleStrokeStyle","clickCircleFill","circleFill","circleWidth","triangleWidth","triangleHeight","triangleStroke","triangleFill","plusStyle","circleStroke","plusSroke","plusWidth","plusStokeWidth","clickFill","clickStyle","EVENT_KEY","EDITTEXT_CHANGE_NODE","EDITTEXT_SHOW","NODE_DRAWING","NODE_TRIANGLE_CLICK","NODE_TEXT_CHANGE","NODE_CLICK","NODE_DOWN","NODE_UP","NODE_BEFORE_MOVE","NODE_MOVE","NODE_AFTER_MOVE","NODE_COVER","NODE_DBLCLICK","NODE_BLUR","NODE_RIGHT_CLICK","NODE_EXPAND","NODE_DELETE","NODE_SHOW_CONTENT","MENU_CLICK","MENU_SHOW","REMARK_SHOW","DOM_HIDE","NODE_CENTER","NODE_RESTORE","DOM_EVENT_TYPE","TOUCH","MOUSE","MENU_TYPE_KEY","EDIT","VISIBLE","COPY","CUT","PASTE","DELETE","DRAW_TYPE_KEY","MOVE","ACTIVE","ACTIVE_EDIT_DISABLE","REVERT","TEXT","INIT","CLASS_NAME","MIND_BODY_CLASS","MIND_BODY_PPT_SHELL_CLASS","MIND_PLACEHOLDER_CLASS","CHANGE_REASON","MINDER_MOVE","MINDER_SCALE","BRO_RELATION","PARENT_CHANGE","TEXT_CONTENT","TEXT_VISIBLE","EXPAND","ORIENTATION_CHANGE","ADD","RENDER","UNDO_REDO","CLEAR","Config","methods","_console","console","method","emptyFuc","_logger","_level","setLevel","level","debug","log","info","msg","warn","error","Logger","Class","include","baseCls","cls","key","proxy","thisobj","Base","___eventDispatch","___nodeId","___eventsInfo","nodeEvent","fucs","params","__base","eventDispatch","eventsInfo","nodeId","args","prototype","slice","Error","arg","__addEvent","__include","__proxyAll","__triggerEvent","__triggerNodeEvent","shift","unshift","__triggerNodeEventByNodeId","id","__setNodeId","__getNodeId","__getEventDispatch","__destroy","remove","BaseView","___viewNode","node","obj","__KityClassName","splice","__getShape","__addShape","shape","addShape","__getWidth","getWidth","__getHeight","getHeight","__show","setAttr","__hide","__on","__stopPropagation","events","that","stop","stopPropagation","__remove","__animator","startVal","finishVal","drawCallback","draw","finishCallback","finish","duration","a","Animator","timeLine","__animateFinish","off","BaseForeignObject","___$view","__$","__setMatrix","matrix","m","b","c","d","f","__setWidth","__setHeight","__setVisible","visible","show","hide","__isVisible","is","Object","create","Utils","getFixedFloat","floatNum","digitalCount","num","numAry","split","result","substring","getValue","str","regex","index","arr","getUuid","s","hexDigits","substr","floor","uuid","getItemInArrayById","proName","l","tempId","isPointInsidePoly","point","poly","checkRectsCross","rectA","rectB","p1","p2","isMobile","supportTouch","getEventPagePos","String","_templateRegExp","template","tpl","attrs","$0","$1","$2","getTemplateValue","text","tempRegExp","templateRegex","regExp","exec","keys","values","regexStr","RegExp","getTextLfToBr","getTextBrToLf","OutClick","instances","containerEle","ins","instance","outside","element","invoke","ignoreEle","register","enable","disable","has","mOutclick","outClickInstance","Clipboard","_data","setData","cut","getData","isEmpty","Command","TYPE","MODIFY_TEXT","Queue","_queue","_currentIndex","_maxLength","undo","redo","command","redoAble","undoAble","Event","_eventHandler","handlers","cb","domain","Svg","addForeignObject","parentSvg","svgdoc","ownerDocument","foreignObject","createElementNS","setAttribute","div","addTitle","txt","title","innerHTML","ID","_nodeId","_textBorderId","_textGroupId","_textId","_visibleImageId","_expandGroupId","_expandTriangleId","_createPlusId","_delBtnId","getNodeId","nodeIndex","getDelBtnId","getTextBorderId","getTextGroupId","getTextId","getVisibleImageId","getExpandGroupId","orientation","getExpandTriangleId","getCreatePlusId","getTargetValue","isNode","test","getTextIdByNodeId","isRoot","escapePathComponent","indexOf","deepClone","JSON","stringify","_generate","mirror","patches","path","newKeys","_objectKeys","oldKeys","changed","deleted","oldVal","hasOwnProperty","newVal","op","compare","tree1","tree2","o","JsonDiff","Plus","_orientation","_clickWidth","_clickHeight","option","Group","setId","_option","_createNode","lang","langData","setStyle","circle","Circle","plus","Path","plusDrawer","getDrawer","moveTo","lineTo","clickRect","Rect","translate","getVisibleWidth","destroy","_triangleStyle","ExpandTriangle","_triangleNode","_circleNode","_circleGroupNode","_leftLineNode","_halfLineNode","_rightLineNode","_nodeLevel","nodeIdIndex","nodeLevel","_create","leftHorizontalLine","halfLine","lineDrawer","halfLineDrawer","rightHorizontalLine","_createTriangleGroup","leftLineDrawer","rightLineDrawer","lineHalfWidth","group","clickWidth","clickHeight","clickPaddingLeft","polyline","Polyline","_createTriangle","Matrix","setMatrix","expand","_updateTriangle","setVisible","updateHalfLine","focus","clear","addPoint","ShapePoint","getFullWidth","_lineStyle","ConnectLine","_mindNodeCore","_type","mindNodeCore","getOption","_init","box","getLayoutBox","pBox","getParent","childCount","getChildrenCount","getOrientation","vector","pathData","side","Point","right","cy","Vector","fromPoints","setPathData","_getLayoutBox","contentBox","getRenderBox","gloMatrix","transformBox","setParentShape","FornVisibleImage","_width","_height","parentSvgNode","active","find","addClass","revert","removeClass","_nodeStyle","middle","br","MultipleText","_lineHeight","_$$texts","setText","_createText","$$text","Text","setContent","getText","getContent","lines","_getTextSpan","SvgDelBtn","_$delBtn","_eventDispatch","_append","isVisible","KEY","menuRegex","Menu","_$menu","_clipboard","_nodeText","_scale","_eventInfos","$parent","clipboard","_bindEvent","$target","menuHtml","append","_showHandler","rectPath","getRectPath","$mindBody","mindBodyId","mindBodyClientRect","getBoundingClientRect","mindWidth","bodyScale","curElementClientRect","subHeight","bottom","getTextVisible","getContentEditAble","getDeleteAble","hideMenuItem","menuWidth","menuHeight","$spes","menuSpesHeight","_domHideHandler","preventDefault","srcElement","closest","targetCls","hasClass","eventType","triggerMenuClick","nodeText","setScale","Placeholder","_$$rect","rect","setWidth","setHeight","getRectShape","_linePadding","_delBtnPadding","_plusPadding","MindNode","_rectPathNode","_leftPlus","_rightPlus","_leftExpandTriangle","_rightExpandTriangle","_fornVisibleImage","_expand","_multipleText","_delBtn","_minWidth","_minHeight","_paddingX","_paddingY","g","getLevel","rootVertical","rootMinWidth","rootPaddingX","rootPaddingY","bringTop","_createTextNode","_createExpandNode","_createPlusNode","_createInvisibleImage","getRequireChildren","_createRequireStarText","remarkVisible","remarkEditAble","_getMindNode","rtGetRemark","cx","_starText","nodeWidth","nodeHeight","setSize","setRadius","setVisibleImageActive","getTextNode","getRectPathWidth","getRectPathHeight","updateRectPathFill","showRequireFill","getChildren","_expandTriangle","reLayout","isActive","toRGB","dataOrientation","isExpand","isLeaf","getChildOrientation","getTriangleFullWidth","getOrientationFullWidth","animateToPos","drawing","getTransform","targetMatrix","moveToPos","subWidth","requireChildren","starBox","showStar","showRequireStar","rectBox","imageWidth","imageHeight","textMatrix","startMatrix","leftPlusMatrix","EditTextArea","_text","_html","_$receiver","_$shadow","_eventsInfo","_changePositionHandler","blur","svgScale","offset","parent","offsetParent","parentWidth","needSelectAll","select","_toLastWord","receiver","selection","sel","createTextRange","moveStart","collapse","selectionStart","selectionEnd","animateLayout","Remark","_$view","_$input","_$parent","$view","$container","containerRect","containerScale","paddingLeft","paddingRight","_node","forceHide","trim","rtSetRemark","class","NodePosition","identifierCountId","MindNodeCore","_containParentsId","_minder","_mindNode","_connectGroup","_connectLine","_parent","_children","_root","_remove","_textVisibleState","_rootRemark","_lastTextRectPathWidth","_identifier","minder","connectGroup","textVisible","paper","getRoot","_paper","positionRecord","_makeContainParentsId","setRequireChildren","innerRectX","innerRectY","innerRectWidth","innerRectHeight","containParentId","getMindNodeShape","layoutBox","getCurNodePosition","curRectPath","curRectPathMatrix","getContainParentsId","getAttribute","trvDrawInit","child","drawBeforeMove","trvHide","drawMove","drawAfterMove","drawAndChangeBroRelation","coverId","coverDirection","resetRootChildrenSort","flag","changeBroRelation","getLastOrientation","layout","global","reason","relationChange","drawChildAppend","oldParent","setExpand","trvShow","drawDelete","gloDraw","children","getChildByOrientation","getCenterSub","getChildHeight","drawTextChange","animate","current","rectPathWidth","rectPathHeight","_lastTextRectPathHeight","includeSelf","onChange","drawExpandChange","drawUp","hasDraw","hasMove","lastOrientation","_lastOrientation","setToPosition","drawAddChildren","addNode","drawFocusEditDisable","_preDraw","_drawing","_afterDraw","rtSetPosRecord","appendNode","absOrientation","autoRideCount","leftCount","rightCount","setIdentifier","ignoreAttrTextVisible","setExtendProperties","identifier","insertChild","setTextVisible","toggleTextVisible","excludeSelf","_trvRemoveShape","trvRemove","_destroy","isRemove","MindNodeAnimate","_paddingBottom","_lineXToParentX","_heightChild","_centerSub","_toX","_toY","setChildHeight","heightChild","setCenterSub","centerSub","getToPosition","renderBox","_mathChildPos","getRectPathRenderBox","parentPos","orientationWidth","isLeft","positionInfo","totalHeight","triangleLineWidth","trvMathChildPosition","topSpace","bottomSpace","childPathBox","infos","exSpace","childHeight","halfPadding","lastInfo","lastTop","trvMathChildHeight","childCenterSub","childPos","param","mathPos","onComplete","_gloDraw","_childDraw","trvAnimate","trvMoveChildrenPos","mathSelfPosition","moveNode","consume","complex","getComplex","trvAnimateChildren","animateNode","_layoutTimeline","MindNodeEventHandler","_moveSubX","_moveSubY","_showContentHandler","_nodeCoverHandler","_nodeRestoreHandler","_startMatrix","_deleteHandler","_clickHandler","contentClickViewAble","_expandHandler","_rightClickHandler","_menuClickHandler","_getEditTextPos","_triangleClickHandler","_blurHandler","_downHandler","_beforeMoveHandler","getMoveAble","_moveHandler","_afterMoveHandler","_upHandler","_dbClickHandler","_textChangeHandler","ExtendProperties","_exContentEditAble","_exDeleteAble","_exMoveAble","_exRequireChildren","_exRequireContent","_exChangeParentAble","_exChangeBroAble","setChangeBroAble","changeBroAble","setChangeParentAble","changeParentAble","setContentEditAble","contentEditAble","setDeleteAble","deleteAble","setMoveAble","moveAble","setRequireContent","requireContent","getChangeBroAble","getRequireContent","getChangeParentAble","MindNodeRelation","childs","setContainParentsId","traverse","includeThis","getMinder","ignoreRemark","remark","ignoreOffset","round","re","trvRenderData","nodeData","matrixAt","_trvRenderDataOffset","renderDataAutoLayout","offsetAt","removed","getIndex","getChild","getMinderNodeById","targetBroId","direction","bro","tempNode","tempIndex","curIndex","rtGetPosRecords","sortChildren","leftChildren","concat","order","preOrder","postOrder","VERSION","EditText","OPTION","maxScale","baseScale","minScale","connectGroupId","minderIdIndex","onScale","_templateHtml","matchPadding","remarkHeight","MindCore","_editText","_menu","_$mindBody","_tempLastId","render","containerElement","minBodyHtml","showMenu","_remark","Paper","viewPort","setViewBox","_addMinder","bindDomEvent","_createRoot","rootCenter","editAble","lock","focusRoot","root","changePosition","onResize","mathTotalScale","getTotalScale","_getCenterPoint","_placeholder","getShapeById","version","setLock","getLock","getEditAble","notifyChange","getEditTextVisible","setEditAble","able","_nodeToCenter","minderNode","leftCenter","nodeMatrix","getScale","rectWidth","rectHeight","focusCenter","getCurMinderNode","triggerChange","focusIn","pathBbox","nodeBbox","getCTM","minderBbox","paperWidth","paperHeight","marginX","marginY","getRelativeScale","container","nodeBlur","minderCTM","_totalScale","matchParent","minderBox","pageWidth","pageHeight","scaleTemp","viewboxScale","matchPaddingX","matchPaddingY","p","hasChange","diff","removeDomEvent","resizeRemark","EventUtils","isDown","isUp","isMove","isTouch","getClientPos","DomEvent","_nodeData","_plusOperate","_editShowTimeOutId","_nodeCenterId","_dblClickTrigger","_isDrawing","_outClickInstance","_curMinderNode","_isRootFocus","setCurMinderNode","focusNode","focusEditDisableRoot","_nodeCenterHandler","_drawingHandler","status","_getTargetNode","parentNode","_delBtnEvent","_plusEvent","_expandEvent","_nodeEvent","mType","getAttr","mTouchTrigger","_isActiveBeforeDown","nodeCoverMoveDown","mMoveAbs","nodeCoverMove","nodeCoverMoveUp","mMoveTrigger","_events","_minderCTM","disableKeyMap","pinchIntensity","_domEvents","_docKeyListener","triggerBlurContainer","__fixClick","_startTime","_endTime","_holdTime","_downTrigger","_moveTrigger","_pinchTrigger","_moveLastPos","__domEvents","_keyDown","_keyCode","_ctrlKey","__event","keyCode","ctrlKey","deltaY","MoveCover","_coverType","_coverTargetRectPath","_coverPlaceholderRectPath","_mouseRateNum","_curMoveMinderNode","_getCurMoveMinderNode","_recoveryRectPathStyle","$rectPath","_isCoverOtherRect","curNodePos","nodesPos","paddingSpaceX","paddingSpaceY","nPos","success","coverNodeId","_isCoverPlaceholderRect","curParentId","tempParentId","topRect","bottomRect","_coverReset","coverType","curMinderNode","curNodeId","curNodPos","coverResult","$$phRect","$$coverRectPath","$$innerRect","heightRate","innerMatrix","setExtentProperties","dataPath","Patch","patchData","matrixAr","insertNode","childInfo","patch","content","pop","dataIndex","segment","express","MAX_HISTORY","History","_undoDiffs","_redoDiffs","_lastSnap","_patchLock","makeUndoDiff","headSnap","makeRedoDiff","revertSnap","undoDiff","_mindCore","_eventBus","redoDiff","hasUndo","hasRedo","Lang","MinderMap","_commandQueue","_history","_lang","getElementById","setLogLevel","getLang","isValid","valid"],"mappings":"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","file":"minder.min.js","sourcesContent":["//version=1.0\r\n(function(window,document,$){\r\n/*!\r\n *  修复内存泄漏问题，修改为使用普通数组代替$([])  modify by ylf 2015/11/20\r\n * jQuery resize event - v1.1 - 3/14/2010\r\n * http://benalman.com/projects/jquery-resize-plugin/\r\n *\r\n * Copyright (c) 2010 \"Cowboy\" Ben Alman\r\n * Dual licensed under the MIT and GPL licenses.\r\n * http://benalman.com/about/license/\r\n */\r\n\r\n// Script: jQuery resize event\r\n//\r\n// *Version: 1.1, Last updated: 3/14/2010*\r\n//\r\n// Project Home - http://benalman.com/projects/jquery-resize-plugin/\r\n// GitHub       - http://github.com/cowboy/jquery-resize/\r\n// Source       - http://github.com/cowboy/jquery-resize/raw/master/jquery.ba-resize.js\r\n// (Minified)   - http://github.com/cowboy/jquery-resize/raw/master/jquery.ba-resize.min.js (1.0kb)\r\n//\r\n// About: License\r\n//\r\n// Copyright (c) 2010 \"Cowboy\" Ben Alman,\r\n// Dual licensed under the MIT and GPL licenses.\r\n// http://benalman.com/about/license/\r\n//\r\n// About: Examples\r\n//\r\n// This working example, complete with fully commented code, illustrates a few\r\n// ways in which this plugin can be used.\r\n//\r\n// resize event - http://benalman.com/code/projects/jquery-resize/examples/resize/\r\n//\r\n// About: Support and Testing\r\n//\r\n// Information about what version or versions of jQuery this plugin has been\r\n// tested with, what browsers it has been tested in, and where the unit tests\r\n// reside (so you can test it yourself).\r\n//\r\n// jQuery Versions - 1.3.2, 1.4.1, 1.4.2\r\n// Browsers Tested - Internet Explorer 6-8, Firefox 2-3.6, Safari 3-4, Chrome, Opera 9.6-10.1.\r\n// Unit Tests      - http://benalman.com/code/projects/jquery-resize/unit/\r\n//\r\n// About: Release History\r\n//\r\n// 1.1 - (3/14/2010) Fixed a minor bug that was causing the event to trigger\r\n//       immediately after bind in some circumstances. Also changed $.fn.data\r\n//       to $.data to improve performance.\r\n// 1.0 - (2/10/2010) Initial release\r\n\r\n(function ($, window, undefined) {\r\n    '$:nomunge'; // Used by YUI compressor.\r\n\r\n    // A jQuery object containing all non-window elements to which the resize\r\n    // event is bound.\r\n    var elems = [],\r\n\r\n    // Extend $.resize if it already exists, otherwise create it.\r\n        jq_resize = $.resize = $.extend($.resize, {}),\r\n\r\n        timeout_id,\r\n    // Reused strings.\r\n        str_setTimeout = 'setTimeout',\r\n        str_resize = 'resize',\r\n        str_data = str_resize + '-special-event',\r\n        str_delay = 'delay',\r\n        str_resize_key = 'data-resize',\r\n        str_throttle = 'throttleWindow',\r\n        time_count = 0;\r\n\r\n    // Property: jQuery.resize.delay\r\n    //\r\n    // The numeric interval (in milliseconds) at which the resize event polling\r\n    // loop executes. Defaults to 250.\r\n\r\n    jq_resize[str_delay] = 250;\r\n\r\n    // Property: jQuery.resize.throttleWindow\r\n    //\r\n    // Throttle the native window object resize event to fire no more than once\r\n    // every <jQuery.resize.delay> milliseconds. Defaults to true.\r\n    //\r\n    // Because the window object has its own resize event, it doesn't need to be\r\n    // provided by this plugin, and its execution can be left entirely up to the\r\n    // browser. However, since certain browsers fire the resize event continuously\r\n    // while others do not, enabling this will throttle the window resize event,\r\n    // making event behavior consistent across all elements in all browsers.\r\n    //\r\n    // While setting this property to false will disable window object resize\r\n    // event throttling, please note that this property must be changed before any\r\n    // window object resize event callbacks are bound.\r\n\r\n    jq_resize[str_throttle] = true;\r\n\r\n    // Event: resize event\r\n    //\r\n    // Fired when an element's width or height changes. Because browsers only\r\n    // provide this event for the window element, for other elements a polling\r\n    // loop is initialized, running every <jQuery.resize.delay> milliseconds\r\n    // to see if elements' dimensions have changed. You may bind with either\r\n    // .resize( fn ) or .bind( \"resize\", fn ), and unbind with .unbind( \"resize\" ).\r\n    //\r\n    // Usage:\r\n    //\r\n    // > jQuery('selector').bind( 'resize', function(e) {\r\n    // >   // element's width or height has changed!\r\n    // >   ...\r\n    // > });\r\n    //\r\n    // Additional Notes:\r\n    //\r\n    // * The polling loop is not created until at least one callback is actually\r\n    //   bound to the 'resize' event, and this single polling loop is shared\r\n    //   across all elements.\r\n    //\r\n    // Double firing issue in jQuery 1.3.2:\r\n    //\r\n    // While this plugin works in jQuery 1.3.2, if an element's event callbacks\r\n    // are manually triggered via .trigger( 'resize' ) or .resize() those\r\n    // callbacks may double-fire, due to limitations in the jQuery 1.3.2 special\r\n    // events system. This is not an issue when using jQuery 1.4+.\r\n    //\r\n    // > // While this works in jQuery 1.4+\r\n    // > $(elem).css({ width: new_w, height: new_h }).resize();\r\n    // >\r\n    // > // In jQuery 1.3.2, you need to do this:\r\n    // > var elem = $(elem);\r\n    // > elem.css({ width: new_w, height: new_h });\r\n    // > elem.data( 'resize-special-event', { width: elem.width(), height: elem.height() } );\r\n    // > elem.resize();\r\n    var getRandomId = function (name) {\r\n        return name + (Math.random() * 10 + new Date().getMilliseconds()).toString().replace(\".\", \"\")\r\n    };\r\n\r\n    var removeItem = function (arry, item) {\r\n        for (var i = 0; i < arry.length; i++) {\r\n            var temp = arry[i];\r\n            if (!isNaN(item)) {\r\n                temp = i;\r\n            }\r\n            if (temp[0] == item[0]) {\r\n                for (var j = i; j < arry.length; j++) {\r\n                    arry[j] = arry[j + 1];\r\n                }\r\n                arry.length = arry.length - 1;\r\n            }\r\n        }\r\n    }\r\n    $.event.special[str_resize] = {\r\n\r\n        // Called only when the first 'resize' event callback is bound per element.\r\n        setup: function () {\r\n            // Since window has its own native 'resize' event, return false so that\r\n            // jQuery will bind the event using DOM methods. Since only 'window'\r\n            // objects have a .setTimeout method, this should be a sufficient test.\r\n            // Unless, of course, we're throttling the 'resize' event for window.\r\n            if (!jq_resize[str_throttle] && this[str_setTimeout]) {\r\n                return false;\r\n            }\r\n\r\n            var elem = $(this);\r\n            elem.attr(str_resize_key, getRandomId(str_resize_key));\r\n            // Add this element to the list of internal elements to monitor.\r\n            elems.push(elem);\r\n\r\n            // Initialize data store on the element.\r\n            elem.data(str_data, {w: elem.width(), h: elem.height()});\r\n\r\n            // If this is the first element added, start the polling loop.\r\n            if (elems.length === 1) {\r\n                loopy();\r\n            }\r\n        },\r\n\r\n        // Called only when the last 'resize' event callback is unbound per element.\r\n        teardown: function () {\r\n            // Since window has its own native 'resize' event, return false so that\r\n            // jQuery will unbind the event using DOM methods. Since only 'window'\r\n            // objects have a .setTimeout method, this should be a sufficient test.\r\n            // Unless, of course, we're throttling the 'resize' event for window.\r\n            if (!jq_resize[str_throttle] && this[str_setTimeout]) {\r\n                return false;\r\n            }\r\n\r\n\r\n            var elem = $(this);\r\n\r\n            // Remove this element from the list of internal elements to monitor.\r\n            removeItem(elems, elem);\r\n            // Remove any data stored on the element.\r\n            elem.removeData(str_data);\r\n\r\n            // If this is the last element removed, stop the polling loop.\r\n            if (!elems.length) {\r\n                clearTimeout(timeout_id);\r\n            }\r\n        },\r\n\r\n        // Called every time a 'resize' event callback is bound per element (new in\r\n        // jQuery 1.4).\r\n        add: function (handleObj) {\r\n            // Since window has its own native 'resize' event, return false so that\r\n            // jQuery doesn't modify the event object. Unless, of course, we're\r\n            // throttling the 'resize' event for window.\r\n            if (!jq_resize[str_throttle] && this[str_setTimeout]) {\r\n                return false;\r\n            }\r\n\r\n            var old_handler;\r\n\r\n            // The new_handler function is executed every time the event is triggered.\r\n            // This is used to update the internal element data store with the width\r\n            // and height when the event is triggered manually, to avoid double-firing\r\n            // of the event callback. See the \"Double firing issue in jQuery 1.3.2\"\r\n            // comments above for more information.\r\n\r\n            function new_handler(e, w, h) {\r\n                var elem = $(this),\r\n                    data = elem.data(str_data);\r\n\r\n                // If called from the polling loop, w and h will be passed in as\r\n                // arguments. If called manually, via .trigger( 'resize' ) or .resize(),\r\n                // those values will need to be computed.\r\n                if (data) {\r\n                    data.w = w !== undefined ? w : elem.width();\r\n                    data.h = h !== undefined ? h : elem.height();\r\n                    old_handler.apply(this, arguments);\r\n                }\r\n            };\r\n\r\n            // This may seem a little complicated, but it normalizes the special event\r\n            // .add method between jQuery 1.4/1.4.1 and 1.4.2+\r\n            if ($.isFunction(handleObj)) {\r\n                // 1.4, 1.4.1\r\n                old_handler = handleObj;\r\n                return new_handler;\r\n            } else {\r\n                // 1.4.2+\r\n                old_handler = handleObj.handler;\r\n                handleObj.handler = new_handler;\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    function loopy() {\r\n        // Start the polling loop, asynchronously.\r\n        timeout_id = window[str_setTimeout](function () {\r\n            time_count++;\r\n            // Iterate over all elements to which the 'resize' event is bound.\r\n            elems.forEach(function (elem) {\r\n                var width = elem.width(),\r\n                    height = elem.height(),\r\n                    data = elem.data(str_data);\r\n\r\n                // If element size has changed since the last time, update the element\r\n                // data store and trigger the 'resize' event.\r\n                if (width !== data.w || height !== data.h) {\r\n                    elem.trigger(str_resize, [data.w = width, data.h = height]);\r\n                }\r\n\r\n                if (time_count % 50 === 0) {\r\n                    if (elem.get(0) !== window && $('[' + str_resize_key + '=\"' + elem.attr(str_resize_key) + '\"]').length === 0) {\r\n                        removeItem(elems, elem);\r\n                        elem.removeData(str_data);\r\n                        elem.unbind(str_resize);\r\n                    }\r\n                }\r\n\r\n            });\r\n            if (!elems.length) {\r\n                clearTimeout(timeout_id);\r\n            } else {\r\n                // Loop.\r\n                loopy();\r\n            }\r\n\r\n        }, jq_resize[str_delay]);\r\n\r\n\r\n    };\r\n\r\n\r\n})(jQuery, this);\n/**\r\n * Created by ylf on 2016/5/20.\r\n */\r\n(function ($) {\r\n\r\n    $.support.touch = 'ontouchend' in document;\r\n    $.support.mobile = navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false;\r\n    var vEventHandler = {};\r\n    if ($.support.touch && $.support.mobile) {\r\n        //拥有触屏事件\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientY;\r\n        };\r\n    } else {\r\n        //没有触屏幕事件\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.clientY;\r\n        };\r\n    }\r\n    //点击事件\r\n    $.event.special.mDblclick = {\r\n        setup: function () {\r\n            var $that = $(this);\r\n            if ($.support.touch && $.support.mobile) {\r\n                var _start = 0;\r\n                var _end = 0;\r\n                var _startPos = {};\r\n                var _endPos = {};\r\n                var _clickTrigger = false;\r\n                $that.bind('touchstart', function (event) {\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        _start = new Date().getTime();\r\n                        _startPos.x = vEventHandler.getEventX(event);\r\n                        _startPos.y = vEventHandler.getEventY(event);\r\n                        if (_clickTrigger) {\r\n                            var holdTime = Math.abs(_start - _end);\r\n                            var dx = Math.abs(_endPos.x - _startPos.x);\r\n                            var dy = Math.abs(_endPos.y - _startPos.y);\r\n                            //第一次点击和第二次点击可以有30px便宜\r\n                            if (holdTime >= 400 || dx >= 30 || dy >= 30) {\r\n                                _clickTrigger = false;\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                $that.bind('touchend touchcancel', function (event) {\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        _end = new Date().getTime();\r\n                        _endPos.x = vEventHandler.getEventX(event);\r\n                        _endPos.y = vEventHandler.getEventY(event);\r\n                        var holdTime = _end - _start;\r\n                        var dx = Math.abs(_endPos.x - _startPos.x);\r\n                        var dy = Math.abs(_endPos.y - _startPos.y);\r\n                        if (holdTime <= 500 && dx < 7 && dy < 7) {\r\n                            if (!_clickTrigger) {\r\n                                _clickTrigger = true;\r\n                            } else {\r\n                                //触发tap事件\r\n                                event = $.event.fix(event);\r\n                                event.type = 'mDblclick';\r\n                                event.tapEventSource = 'touchclick';\r\n                                event.tapFireTouch = true;\r\n                                $that.triggerHandler(event);\r\n                            }\r\n                        } else {\r\n                            _clickTrigger = false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                $that.bind('dblclick', function (event) {\r\n                    //触发tap事件\r\n                    event = $.event.fix(event);\r\n                    event.type = 'mDblclick';\r\n                    event.tapEventSource = 'mouseclick';\r\n                    event.tapFireTouch = false;\r\n                    $that.triggerHandler(event);\r\n                });\r\n            }\r\n        },\r\n        teardown: function () {\r\n            var $that = $(this);\r\n            $that.unbind('touchend').unbind('touchcancel').unbind('touchstart');\r\n        }\r\n    };\r\n\r\n})(jQuery);\n/**\r\n * Created by ylf on 2016/4/8.\r\n */\r\n\r\n(function ($) {\r\n\r\n\r\n    var utils = {};\r\n\r\n    //默认参数\r\n    var PinchIntensity = 0.8;\r\n\r\n    utils.getDistance = function (pos1, pos2) {\r\n        var x = pos2.x - pos1.x,\r\n            y = pos2.y - pos1.y;\r\n        return Math.sqrt((x * x) + (y * y));\r\n    };\r\n\r\n    utils.getFingers = function (ev) {\r\n\r\n        return ev.touches ? ev.touches.length : 1;\r\n    };\r\n\r\n    utils.calScale = function (pstart, pmove, intensity) {\r\n        if (pstart.length >= 2 && pmove.length >= 2) {\r\n            var disStart = this.getDistance(pstart[1], pstart[0]);\r\n            var disEnd = this.getDistance(pmove[1], pmove[0]);\r\n            var scale = (disEnd - disStart) * intensity;\r\n            return (disEnd - scale) / disStart;\r\n        }\r\n        return 1;\r\n    };\r\n\r\n    utils.isTouchEnd = function (ev) {\r\n        return (ev.type === 'touchend' || ev.type === 'touchcancel');\r\n    };\r\n\r\n    utils.isTouchMove = function (ev) {\r\n        return (ev.type === 'touchmove');\r\n    };\r\n\r\n\r\n    utils.getPosOfEvent = function (ev) {\r\n        var posi = [];\r\n        var src = null;\r\n\r\n        for (var t = 0, len = ev.touches.length; t < len; t++) {\r\n            src = ev.touches[t];\r\n            posi.push({\r\n                x: src.pageX,\r\n                y: src.pageY\r\n            });\r\n        }\r\n        return posi;\r\n    };\r\n\r\n\r\n    $.event.special.mPinch = {\r\n        setup: function () {\r\n            var $that = $(this);\r\n\r\n            var _intensity = PinchIntensity;\r\n            //优先去属性里配置的强度\r\n            var intensityAttr = $that.attr('data-pinch-intensity');\r\n            if (intensityAttr) {\r\n                intensityAttr = parseFloat(intensityAttr);\r\n                if (intensityAttr > 0 && intensityAttr <= 1) {\r\n                    _intensity = intensityAttr;\r\n                }\r\n            }\r\n            var _touchStart = false;\r\n            var startPinch = false;\r\n\r\n            var pos = {\r\n                start: null,\r\n                move: null,\r\n                end: null\r\n            };\r\n\r\n            var reset = function () {\r\n                _touchStart = startPinch = false;\r\n                pos = {};\r\n            };\r\n\r\n            var pinch = function (ev) {\r\n                if (!_touchStart) return;\r\n                if (utils.getFingers(ev) < 2) {\r\n                    if (!utils.isTouchEnd(ev)) return;\r\n                }\r\n                var scale = utils.calScale(pos.start, pos.move, _intensity);\r\n                var eventObj = {\r\n                    type: 'mPinch',\r\n                    originEvent: ev,\r\n                    scale: scale,\r\n                    fingersCount: utils.getFingers(ev)\r\n                };\r\n\r\n                if (!startPinch) {\r\n                    startPinch = true;\r\n                    eventObj.fingerStatus = \"start\";\r\n                    $that.triggerHandler(eventObj);\r\n                } else if (utils.isTouchMove(ev)) {\r\n                    eventObj.fingerStatus = \"move\";\r\n                    $that.triggerHandler(eventObj);\r\n                } else if (utils.isTouchEnd(ev)) {\r\n                    eventObj.fingerStatus = \"end\";\r\n                    $that.triggerHandler(eventObj);\r\n                    reset();\r\n                }\r\n                return ev;\r\n            };\r\n\r\n\r\n            $that.bind('touchstart', function (ev) {\r\n                _touchStart = true;\r\n                if (!pos.start || pos.start.length < 2) {\r\n                    pos.start = utils.getPosOfEvent(ev.originalEvent);\r\n                }\r\n            });\r\n\r\n            $that.bind('touchmove', function (ev) {\r\n                if (!_touchStart || !pos.start) return;\r\n                pos.move = utils.getPosOfEvent(ev.originalEvent);\r\n                if (utils.getFingers(ev.originalEvent) >= 2) {\r\n                    pinch(ev.originalEvent);\r\n                }\r\n            });\r\n\r\n            $that.bind('touchend touchcancel', function (ev) {\r\n                if (!_touchStart) return;\r\n                if (startPinch) {\r\n                    pinch(ev.originalEvent);\r\n                }\r\n                //重置\r\n                reset();\r\n                if (ev.touches && ev.touches.length === 1) {\r\n                    _touchStart = true;\r\n                }\r\n\r\n            });\r\n\r\n        },\r\n        teardown: function () {\r\n            var $that = $(this);\r\n            $that.unbind('touchstart').unbind('touchmove').unbind('touchend').unbind('touchcancel');\r\n        }\r\n    };\r\n    $.fn.mPinch = function (callback) {\r\n        return this.bind('mPinch', callback);\r\n    };\r\n\r\n    $.fn.mPinchSetIntensity = function (intensity) {\r\n        PinchIntensity = intensity;\r\n    }\r\n})(jQuery);\n(function ($) {\r\n\r\n    $.support.touch = 'ontouchend' in document;\r\n    $.support.mobile = navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false;\r\n    var vEventHandler = {};\r\n    if ($.support.touch && $.support.mobile) {\r\n        //拥有触屏事件\r\n        vEventHandler.mouseDown = 'touchstart';\r\n        vEventHandler.mouseUp = 'touchend';\r\n        vEventHandler.mouseWheel = 'touchmove';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientY;\r\n        };\r\n    } else {\r\n        //没有触屏幕事件\r\n        vEventHandler.mouseDown = 'mousedown';\r\n        vEventHandler.mouseUp = 'mouseup';\r\n        vEventHandler.mouseWheel = 'mousewheel';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.clientY;\r\n        };\r\n    }\r\n    $.support.fixed = function () {\r\n        var bodys = document.getElementsByTagName(\"body\");\r\n        if (bodys && bodys.length > 0) {\r\n            bodys[0].addEventListener(\"touchstart\", function () {\r\n            });\r\n        }\r\n        $.support.fixed = true;\r\n    };\r\n    $.support.fixed();\r\n    //点击事件\r\n    $.event.special.mTap = {\r\n        setup: function () {\r\n            var $that = $(this);\r\n            if ($.support.touch && $.support.mobile) {\r\n                if ($.support.fixed !== true) {\r\n                    $.support.fixed();\r\n                }\r\n                var vMouseDown = vEventHandler.mouseDown;\r\n                var vMouseUp = vEventHandler.mouseUp;\r\n                var _start = 0;\r\n                var _startX = 0;\r\n                var _startY = 0;\r\n                var _target = null;\r\n                $that.bind(vMouseDown, function (event) {\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        _start = new Date().getTime();\r\n                        _startX = vEventHandler.getEventX(event);\r\n                        _startY = vEventHandler.getEventY(event);\r\n                        _target = event.originalEvent.target;\r\n                    }\r\n                });\r\n                $that.bind(vMouseUp, function (event) {\r\n\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        var end = new Date().getTime();\r\n                        var endX = vEventHandler.getEventX(event);\r\n                        var endY = vEventHandler.getEventY(event);\r\n                        var upTarget = event.originalEvent.target;\r\n                        var holdTime = end - _start;\r\n                        var dx = Math.abs(endX - _startX);\r\n                        var dy = Math.abs(endY - _startY);\r\n                        if (holdTime <= 550 && dx < 8 && dy < 8 && upTarget === _target) {\r\n                            //触发tap事件\r\n                            event = $.event.fix(event);\r\n                            event.type = 'mTap';\r\n                            event.tapEventSource = 'touchclick';\r\n                            event.tapFireTouch = true;\r\n                            $that.triggerHandler(event);\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                $that.bind('click', function (event) {\r\n                    //触发tap事件\r\n                    event = $.event.fix(event);\r\n                    event.type = 'mTap';\r\n                    event.tapEventSource = 'mouseclick';\r\n                    event.tapFireTouch = false;\r\n                    //白板手写笔点击触发touch事件\r\n                    if (event.originalEvent && event.originalEvent.sourceCapabilities && event.originalEvent.sourceCapabilities.firesTouchEvents) {\r\n                        event.tapFireTouch = true;\r\n                    }\r\n                    $that.triggerHandler(event);\r\n                });\r\n            }\r\n        },\r\n        teardown: function () {\r\n            var vMouseDown = vEventHandler.mouseDown;\r\n            var vMouseUp = vEventHandler.mouseUp;\r\n            var $that = $(this);\r\n            $that.unbind(vMouseUp).unbind(vMouseDown);\r\n        }\r\n    };\r\n\r\n})(jQuery);\n(function ($) {\r\n\r\n    var getEventPos = function (e) {\r\n        switch (e.type) {\r\n            case 'touchstart':\r\n            case 'touchend':\r\n            case 'touchmove':\r\n            case 'touchcancel':\r\n                return {\r\n                    x: e.originalEvent.changedTouches[0].clientX,\r\n                    y: e.originalEvent.changedTouches[0].clientY\r\n                };\r\n                break;\r\n        }\r\n        return {\r\n            x: e.clientX,\r\n            y: e.clientY\r\n        }\r\n    };\r\n    //点击事件\r\n    $.event.special.mTouchLong= {\r\n        setup: function () {\r\n            var $that = $(this);\r\n            var _tid = 0;\r\n            var _start = 0;\r\n            var _startX = 0;\r\n            var _startY = 0;\r\n            var _touchTrigger = false;\r\n            $that.bind('touchstart', function (event) {\r\n                if (event.which !== 0 || event.which !== 1) {\r\n                    if (event.type === 'touchstart') {\r\n                        _touchTrigger = true;\r\n                    }\r\n                    if (event.originalEvent.touches.length > 1) {\r\n                        clearTimeout(_tid);\r\n                        return;\r\n                    }\r\n                    _start = new Date().getTime();\r\n                    var pos = getEventPos(event);\r\n                    _startX = pos.x;\r\n                    _startY = pos.y;\r\n                    clearTimeout(_tid);\r\n                    _tid = setTimeout(function () {\r\n                        event.type = 'mTouchLong';\r\n                        $that.triggerHandler(event);\r\n                    }, 1200);\r\n                }\r\n            });\r\n            $that.bind('touchend touchmove touchcancel', function (event) {\r\n                var pos = getEventPos(event);\r\n                var endX = pos.x;\r\n                var endY = pos.y;\r\n                //var holdTime = end - _start;\r\n                var dx = Math.abs(endX - _startX);\r\n                var dy = Math.abs(endY - _startY);\r\n                if (dx > 2 || dy > 2) {\r\n                    clearTimeout(_tid);\r\n                    _touchTrigger = false;\r\n                }\r\n                if (event.type === 'touchend' || event.type === 'touchcancel') {\r\n                    clearTimeout(_tid);\r\n                    _touchTrigger = false;\r\n                }\r\n            });\r\n\r\n        },\r\n        teardown: function () {\r\n            var $that = $(this);\r\n            $that.unbind('touchstart  touchend touchmove touchcancel');\r\n        }\r\n    };\r\n\r\n})(jQuery);\n/*!\n Non-Sucking Autogrow 1.1.1\n license: MIT\n author: Roman Pushkin\n https://github.com/ro31337/jquery.ns-autogrow\n modify by ylf 2016/6/29\n */\n(function () {\n    var getVerticalScrollbarWidth;\n\n    (function ($, window) {\n        return $.fn.autogrow = function (options) {\n            if (options == null) {\n                options = {};\n            }\n            if (options.horizontal == null) {\n                options.horizontal = true;\n            }\n            if (options.vertical == null) {\n                options.vertical = true;\n            }\n            if (options.debugx == null) {\n                options.debugx = -10000;\n            }\n            if (options.debugy == null) {\n                options.debugy = -10000;\n            }\n            if (!options.addWidth) {\n                options.addWidth = 0;\n            }\n            if (options.debugcolor == null) {\n                options.debugcolor = 'yellow';\n            }\n            if (options.flickering == null) {\n                options.flickering = true;\n            }\n            if (options.postGrowCallback == null) {\n                options.postGrowCallback = function () {\n                };\n            }\n            if (options.verticalScrollbarWidth == null) {\n                options.verticalScrollbarWidth = getVerticalScrollbarWidth();\n            }\n            if (options.horizontal === false && options.vertical === false) {\n                return;\n            }\n            options.class = options.class || 'autogrow-shadow';\n            return this.filter('textarea,input').each(function () {\n                var $e, $shadow, heightPadding, minHeight, minWidth, update, maxWidth, cssMaxWidth;\n                $e = $(this);\n                if ($e.data('autogrow-enabled')) {\n                    return;\n                }\n                minHeight = parseInt($e.attr('data-minHeight')) || $e.height();\n                minWidth = parseInt($e.attr('data-minWidth')) || $e.width();\n                heightPadding = $e.css('lineHeight') * 1 || 0;\n                $e.hasVerticalScrollBar = function () {\n                    return $e[0].clientHeight < $e[0].scrollHeight;\n                };\n                cssMaxWidth = maxWidth = parseInt($e.css('max-width'));\n                $shadow = $('<div class=\"' + options.class + '\"></div>').css({\n                    position: 'absolute',\n                    display: 'inline-block',\n                    'background-color': options.debugcolor,\n                    top: options.debugy,\n                    left: options.debugx,\n                    'max-width': $e.css('max-width'),\n                    'padding': $e.css('padding'),\n                    fontSize: $e.css('fontSize'),\n                    fontFamily: $e.css('fontFamily'),\n                    fontWeight: $e.css('fontWeight'),\n                    lineHeight: $e.css('lineHeight'),\n                    resize: 'none',\n                    'word-wrap': 'break-word',\n                    'word-break': 'break-all',\n                    'box-sizing': 'content-box'\n                }).appendTo(options.body || document.body);\n                if (options.horizontal === false) {\n                    $shadow.css({\n                        'width': $e.width()\n                    });\n                }\n                update = (function (_this) {\n                    return function (event) {\n                        var height, val, width, scale;\n                        val = _this.value.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\n /g, '<br/>&nbsp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;').replace(/\\n$/, '<br/>&nbsp;').replace(/\\n/g, '<br/>').replace(/ {2,}/g, function (space) {\n                            return Array(space.length - 1).join('&nbsp;') + ' ';\n                        });\n\n                        $shadow.html(val);\n                        maxWidth = parseInt($e.attr('data-maxwidth'))\n                        scale = parseFloat($e.attr('data-scale'))\n                        $shadow.css('transform', 'scale(' + scale + ')');\n                        if (maxWidth) {\n                            $shadow.css('maxWidth', maxWidth);\n                        } else {\n                            $shadow.css('maxWidth', cssMaxWidth);\n                        }\n                        if (options.vertical === true) {\n                            minHeight = parseInt($e.attr('data-minheight')) || $e.height();\n                            height = Math.max($shadow.height() + heightPadding, minHeight);\n                            $e.height(height);\n                        }\n                        if (options.horizontal === true) {\n                            minWidth = parseInt($e.attr('data-minwidth')) || $e.width();\n                            width = Math.max($shadow.outerWidth(), minWidth);\n                            width += options.addWidth;\n                            if (maxWidth > 0 && maxWidth < width) {\n                                $e.width(maxWidth);\n                            } else {\n                                $e.width(width);\n                            }\n                        }\n\n                        return options.postGrowCallback($e);\n                    };\n                })(this);\n                $e.on('input', update);\n                $(window).resize(update);\n                return update();\n            });\n        };\n    })(window.jQuery, window);\n\n    getVerticalScrollbarWidth = function () {\n        var inner, outer, w1, w2;\n        inner = document.createElement('p');\n        inner.style.width = \"100%\";\n        inner.style.height = \"200px\";\n        outer = document.createElement('div');\n        outer.style.position = \"absolute\";\n        outer.style.top = \"0px\";\n        outer.style.left = \"0px\";\n        outer.style.visibility = \"hidden\";\n        outer.style.width = \"200px\";\n        outer.style.height = \"150px\";\n        outer.style.overflow = \"hidden\";\n        outer.appendChild(inner);\n        document.body.appendChild(outer);\n        w1 = inner.offsetWidth;\n        outer.style.overflow = 'scroll';\n        w2 = inner.offsetWidth;\n        if (w1 === w2) {\n            w2 = outer.clientWidth;\n        }\n        document.body.removeChild(outer);\n        return w1 - w2;\n    };\n\n}).call(this);\n\nvar __M = {};\r\n\r\n(function (window, $, kity, __M) {\r\n    __M.View = {};\r\n\r\n\r\n    var DefaultLang = {\r\n        'mdnode_centralname': '中心主题',\r\n        'mdnode_branchname': '分支主题',\r\n        'mdnode_addchildtip': '添加下级主题',\r\n        'mdmenu_edit': '编辑内容',\r\n        'mdmenu_visible': '显示内容',\r\n        'mdmenu_invisible': '隐藏内容',\r\n        'mdmenu_copy': '复制',\r\n        'mdmenu_cut': '剪切',\r\n        'mdmenu_paste': '粘贴',\r\n        'mdmenu_delete': '删除'\r\n    };\r\n\r\n\r\n    var mindConfig = {};\r\n\r\n    //全局颜色配置\r\n    mindConfig.palette = new kity.Palette();\r\n    mindConfig.palette.add('transparent', kity.Color.createRGBA(0, 0, 0, 0));\r\n    mindConfig.palette.add('node_stroke_normal', kity.Color.createRGB(115, 161, 191));\r\n    mindConfig.palette.add('node_stroke_active', kity.Color.createRGB(57, 80, 96));\r\n    mindConfig.palette.add('backgroud_color', kity.Color.parse('#C0D3E2'));\r\n    mindConfig.palette.add('line_color', kity.Color.parse('#666564'));\r\n\r\n    //节点样式配置\r\n    mindConfig.nodeStyle = {\r\n        width: 110,//文本宽\r\n        height: 42,//文本高\r\n        y: -11,//文本节点初始y\r\n        paddingX: 15,//文本相对边框padding值\r\n        paddingY: 7,//文本相对边框padding值\r\n        strokeStyle: {'stroke-width': 2, 'stroke': kity.Color.parse('#9CB2C1'), opacity: 1, 'cursor': 'pointer'},//常态\r\n        activeStrokeStyle: {'stroke-width': 2.5, 'stroke': kity.Color.parse('#F61D1B'), opacity: 1, 'cursor': 'pointer'},//激活状态\r\n\r\n        moveCoverStyle: {'stroke-width': 5.0, 'stroke': kity.Color.parse('#9CB2C1')},///覆盖高亮显示\r\n        moveStyle: {opacity: 0.5, 'stroke': kity.Color.parse('#9CB2C1')},//移动样式\r\n        placeholderStyle: {'fill': '#74A3BE', 'stroke': kity.Color.parse('#74A3BE')},//占位符样式\r\n        fill: kity.Color.parse('#FFFFFF'),//填充\r\n        requireCompletedFill: kity.Color.parse('#F9EED7'),\r\n        radius: 23,\r\n        //defaultText: '中心主题',\r\n        //level2DefaultText: '分支主题',\r\n        textStyle: {'font-size': 20, 'dominant-baseline': 'text-before-edge', 'cursor': 'pointer'},//文本字体、大小'text-rendering': 'inherit',\r\n        groupColor: 'black',//文本颜色\r\n        groupTransform: 'translate( 0 -2.4 )'//文本初始便宜距离\r\n    };\r\n\r\n    mindConfig.lineStyle = {\r\n        strokeStyle: {'stroke-width': 2, 'stroke': mindConfig.palette.get('line_color')}\r\n    };\r\n\r\n    mindConfig.triangleStyle = {\r\n        lineWidth: 110,\r\n        lineStyle: mindConfig.lineStyle.strokeStyle,\r\n        circleStrokeStyle: mindConfig.lineStyle.strokeStyle,\r\n        clickCircleStrokeStyle: {'stroke-width': 2, 'stroke': mindConfig.palette.get('transparent')},\r\n        clickCircleFill: mindConfig.palette.get('transparent'),\r\n        circleFill: mindConfig.palette.get('node_stroke_normal'),\r\n        circleWidth: 11,\r\n        triangleWidth: 6.5,\r\n        triangleHeight: 12.5,\r\n        triangleStroke: mindConfig.palette.get('line_color'),\r\n        triangleFill: mindConfig.palette.get('line_color'),\r\n        style: {'cursor': 'pointer'}\r\n    };\r\n\r\n    mindConfig.plusStyle = {\r\n        circleFill: kity.Color.parse('#4A5157'),//圆圈填充\r\n        circleStroke: kity.Color.parse('#4A5157'),//圆圈边框\r\n        plusSroke: kity.Color.parse('#FBFBFB'),//加号边框\r\n        circleWidth: 12,//圆圈半径\r\n        plusWidth: 5.5,//加号半径\r\n        plusStokeWidth: 1.5,//加号线条宽度\r\n        clickFill: mindConfig.palette.get('transparent'),\r\n        clickStyle: {'stroke-width': 2, 'stroke': mindConfig.palette.get('transparent')}\r\n    };\r\n\r\n    mindConfig.EVENT_KEY = {\r\n        EDITTEXT_CHANGE_NODE: 'edittext_change_node',//文本重新定位\r\n        EDITTEXT_SHOW: 'edittext_show',//显示文本\r\n        NODE_DRAWING: 'node_drawing',  //节点绘制事件\r\n        NODE_TRIANGLE_CLICK: 'node_triangle_click',//左右两侧三角按钮点击事件\r\n        NODE_TEXT_CHANGE: 'node_text_change', //文本框内容变化监听\r\n        NODE_CLICK: 'node_click',\r\n        NODE_DOWN: 'node_down',  //按钮按下触发\r\n        NODE_UP: 'node_up',  //按钮结束触发\r\n        NODE_BEFORE_MOVE: 'node_before_move',\r\n        NODE_MOVE: 'node_move', //节点移动事件\r\n        NODE_AFTER_MOVE: 'node_after_move',\r\n        NODE_COVER: 'node_cover',//节点移动是覆盖事件\r\n        NODE_DBLCLICK: 'node_dblclick', //节点双击事件\r\n        NODE_BLUR: 'node_blur', //全局的失去焦点\r\n        NODE_RIGHT_CLICK: 'node_right_click',//鼠标右键点击事件\r\n        NODE_EXPAND: 'node_expand',//鼠标右键点击事件\r\n        NODE_DELETE: 'node_delete',//节点删除事件\r\n        NODE_SHOW_CONTENT: 'node_show_content',//显示隐藏的文本内容\r\n        MENU_CLICK: 'menu_click',//菜单点击事件\r\n        MENU_SHOW: 'menu_show',//菜单点击事件\r\n        REMARK_SHOW: 'remark_show',//显示备注信息\r\n        DOM_HIDE: 'dom_hide',//dom隐藏事件NODE_SHOW_CONTENT\r\n        NODE_CENTER: 'node_center',////菜单点击事件\r\n        NODE_RESTORE: 'node_restore'//节点移动是覆盖事件\r\n    };\r\n\r\n    mindConfig.DOM_EVENT_TYPE = {\r\n        TOUCH: 'touch',\r\n        MOUSE: 'mouse'\r\n    };\r\n\r\n    mindConfig.MENU_TYPE_KEY = {\r\n        EDIT: 'edit',\r\n        VISIBLE: 'visible',\r\n        COPY: 'copy',\r\n        CUT: 'cut',\r\n        PASTE: 'paste',\r\n        DELETE: 'delete'\r\n    };\r\n\r\n    mindConfig.DRAW_TYPE_KEY = {\r\n        MOVE: 'move',//移动\r\n        ACTIVE: 'active',//获取焦点\r\n        ACTIVE_EDIT_DISABLE: 'active_edit_disable',//获取焦点,不可编辑状态下\r\n        REVERT: 'revert',//失去焦点\r\n        TEXT: 'text',//文本发生变化\r\n        INIT: 'init'//初始化节点控件\r\n    };\r\n    mindConfig.CLASS_NAME = {\r\n        MIND_BODY_CLASS: 'mindMap_body mindMap_guardian',\r\n        MIND_BODY_PPT_SHELL_CLASS: 'mindMap_ppt_shell',\r\n        MIND_PLACEHOLDER_CLASS: 'mindMap_placeholder'\r\n    };\r\n\r\n    mindConfig.CHANGE_REASON = {\r\n        MOVE: 'move',//节点移动\r\n        MINDER_MOVE: 'minder_move',//整体移动\r\n        MINDER_SCALE: 'minder_scale',//整体移动\r\n        BRO_RELATION: 'bro_relation',//兄弟节点关系变化\r\n        PARENT_CHANGE: 'parent_change',//父节点关系变化\r\n        DELETE: 'delete',//删除节点\r\n        TEXT_CONTENT: 'text_content',//文本内容变化\r\n        TEXT_VISIBLE: 'text_visible',\r\n        EXPAND: 'expand',//展开收起\r\n        ORIENTATION_CHANGE: 'orientation_change',//节点左右方向变化\r\n        ADD: 'add',//添加节点\r\n        RENDER: 'render',//初始化render\r\n        UNDO_REDO: 'undo_redo',//撤销还原\r\n        CLEAR: 'clear'//清楚内容\r\n    };\r\n\r\n    __M.Config = mindConfig;\r\n    __M.Config.DefaultLang = DefaultLang;\r\n    // __M.Config.Lang = {};//在main里初始化\r\n\r\n}(window, jQuery, kity, __M));\n/**\r\n * Created by ylf on 2015/12/13.\r\n */\r\n\r\n(function (__M) {\r\n    'use strict';\r\n\r\n    var methods = [\r\n        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',\r\n        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',\r\n        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',\r\n        'timeline', 'timelineEnd', 'timeStamp', 'trace', 'warn'\r\n    ];\r\n    var length = methods.length;\r\n    var _console = (window.console = window.console || {});\r\n    var method = null;\r\n\r\n    var emptyFuc = function () {\r\n    };\r\n\r\n    while (length--) {\r\n        method = methods[length];\r\n        // Only stub undefined methods.\r\n        if (!_console[method]) {\r\n            _console[method] = emptyFuc;\r\n        }\r\n    }\r\n\r\n    //logger level值(debug:3, info:2, warn:1, error: 0, close: -1)\r\n    var _logger = {\r\n        _level: 0,\r\n        _console: _console,\r\n        setLevel: function (level) {\r\n            switch (level) {\r\n                case 'debug':\r\n                    this._level = 3;\r\n                    break;\r\n                case 'info':\r\n                    this._level = 2;\r\n                    break;\r\n                case 'warn':\r\n                    this._level = 1;\r\n                    break;\r\n                case 'error':\r\n                    this._level = 0;\r\n                    break;\r\n                default:\r\n                    this._level = -1;\r\n            }\r\n        },\r\n        debug: function () {\r\n            if (this._level >= 3) {\r\n                this._console.log.apply(this._console, arguments);\r\n            }\r\n        },\r\n        info: function (msg) {\r\n            if (this._level >= 2) {\r\n                this._console.info.apply(this._console, arguments);\r\n            }\r\n        },\r\n        warn: function (msg) {\r\n            if (this._level >= 1) {\r\n                this._console.warn.apply(this._console, arguments);\r\n            }\r\n        },\r\n        error: function (msg) {\r\n            if (this._level >= 0) {\r\n                this._console.error.apply(this._console, arguments);\r\n            }\r\n        }\r\n    };\r\n\r\n    __M.Logger = _logger;\r\n})(__M);\n/**\r\n * Created by ylf on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n    __M.Class = {};\r\n\r\n    var _logger = __M.Logger;\r\n\r\n    var include = function (baseCls, cls) {\r\n        for (var key in cls) {\r\n            if (typeof baseCls[key] !== \"undefined\" && key !== '__base') {\r\n                _logger.error('有重复的成员');\r\n            }\r\n            baseCls[key] = cls[key];\r\n        }\r\n        return baseCls;\r\n    };\r\n\r\n    var proxy = function (thisobj, fn) {\r\n        return function () {\r\n            return fn.apply(thisobj, arguments);\r\n        };\r\n    };\r\n\r\n    /**\r\n     * {\r\n                nodeEvent: true,//是否绑定在节点上\r\n                key: '',//key\r\n                fucs: '',//方法名\r\n                params: []//参数说明\r\n            }\r\n     */\r\n\r\n    var Base = {\r\n        ___eventDispatch: null,\r\n        ___nodeId: '',\r\n        ___eventsInfo: [{\r\n            nodeEvent: true,//是否绑定在节点上\r\n            key: '',//key\r\n            fucs: '',//方法名\r\n            params: []//参数说明\r\n        }],\r\n        __base: function (eventDispatch, eventsInfo, nodeId) {\r\n            this.___eventsInfo = null;\r\n            this.___eventDispatch = null;\r\n\r\n            var args = Array.prototype.slice.apply(arguments, [0]);\r\n            if (args.length > 3) {\r\n                throw  new Error('参数长度有误');\r\n            }\r\n            for (var i = 0; i < args.length; i++) {\r\n                var arg = args[i];\r\n                if (arg instanceof Array) {\r\n                    this.___eventsInfo = arg;\r\n                } else if (typeof  arg === 'string') {\r\n                    this.___nodeId = arg;\r\n                } else if (typeof  arg === 'object') {\r\n                    this.___eventDispatch = eventDispatch;\r\n                }\r\n            }\r\n\r\n            this.___eventDispatch = this.___eventDispatch || {};\r\n            this.___eventsInfo = this.___eventsInfo || [];\r\n            this.___nodeId = this.___nodeId || '';\r\n            this.__addEvent();\r\n        },\r\n        __include: function (cls) {\r\n            return include(this, cls);\r\n        },\r\n        __proxyAll: function (fucs) {\r\n            for (var i = 0; i < fucs.length; i++) {\r\n                this[fucs[i]] = proxy(this, this[fucs[i]]);\r\n            }\r\n        },\r\n        __addEvent: function () {\r\n            var eventsInfo = this.___eventsInfo;\r\n            var nodeId = this.___nodeId;\r\n            for (var i = 0; i < eventsInfo.length; i++) {\r\n                var event = eventsInfo[i];\r\n                var type = event.nodeEvent ? nodeId + '_' + event.key : event.key;\r\n                this.___eventDispatch.add(type, this[event.fucs], this);\r\n            }\r\n        },\r\n        __triggerEvent: function (type) {\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            this.___eventDispatch.trigger.apply(this.___eventDispatch, arg);\r\n        },\r\n        __triggerNodeEvent: function (type) {\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            var type = arg.shift();\r\n            arg.unshift(this.___nodeId + '_' + type);\r\n            this.___eventDispatch.trigger.apply(this.___eventDispatch, arg);\r\n        },\r\n        __triggerNodeEventByNodeId: function (type, id) {\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            var type = arg.shift();\r\n            var id = arg.shift();\r\n            arg.unshift(id + '_' + type);\r\n            this.___eventDispatch.trigger.apply(this.___eventDispatch, arg);\r\n        },\r\n        __setNodeId: function (nodeId) {\r\n            this.___nodeId = nodeId;\r\n        },\r\n        __getNodeId: function () {\r\n            return this.___nodeId;\r\n        },\r\n        __getEventDispatch: function () {\r\n            return this.___eventDispatch;\r\n        },\r\n        __destroy: function () {\r\n            var eventsInfo = this.___eventsInfo;\r\n            var nodeId = this.___nodeId;\r\n            for (var i = 0; i < eventsInfo.length; i++) {\r\n                var event = eventsInfo[i];\r\n                var type = event.nodeEvent ? nodeId + '_' + event.key : event.key;\r\n                this.___eventDispatch.remove(type, this[event.fucs], this);\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    var BaseView = {\r\n        ___viewNode: null,//当前视图节点\r\n        __base: function (eventDispatch, eventsInfo, nodeId, node) {\r\n            var args = Array.prototype.slice.apply(arguments, [0]);\r\n            for (var i = 0; i < args.length; i++) {\r\n                var obj = args[i];\r\n                //将node对象取出\r\n                if (obj && typeof obj.__KityClassName !== 'undefined') {\r\n                    this.___viewNode = obj;\r\n                    args.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            Base.__base.apply(this, args);\r\n        },\r\n        __getShape: function () {\r\n            return this.___viewNode;\r\n        },\r\n        __addShape: function (shape) {\r\n            this.___viewNode.addShape(shape);\r\n        },\r\n        __getWidth: function () {\r\n            return this.___viewNode.getWidth();\r\n        },\r\n        __getHeight: function () {\r\n            return this.___viewNode.getHeight();\r\n        },\r\n        __show: function () {\r\n            this.___viewNode.setAttr('display', 'block');\r\n        },\r\n        __hide: function () {\r\n            this.___viewNode.setAttr('display', 'none');\r\n        },\r\n        __on: function (key, callback) {\r\n            this.___viewNode.on(key, callback);\r\n        },\r\n        __stopPropagation: function (events) {\r\n            var that = this;\r\n            var stop = function (e) {\r\n                e.stopPropagation();\r\n            };\r\n            events.forEach(function (event) {\r\n                that.__on(event, stop);\r\n            });\r\n        },\r\n        __remove: function () {\r\n            this.___viewNode.remove();\r\n        },\r\n        __animator: function (obj) {\r\n            var target = obj.node || this.___viewNode;\r\n            var startVal = obj.startVal || 0;\r\n            var finishVal = obj.finishVal || 0;\r\n            var drawCallback = obj.draw;\r\n            var finishCallback = obj.finish;\r\n            var duration = obj.duration || 200;\r\n\r\n\r\n            var a = new kity.Animator(startVal, finishVal, function (target, value, timeLine) {\r\n                drawCallback(target, value);\r\n            });\r\n            var timeLine = a.start(target, duration);\r\n\r\n            var __animateFinish = function () {\r\n                finishCallback && finishCallback();\r\n                timeLine.off('finish', __animateFinish);\r\n            };\r\n\r\n            timeLine.on('finish', __animateFinish);//console.log('the ' + e.target.getId() + ' has move right');\r\n            return timeLine;\r\n        }\r\n\r\n    };\r\n\r\n\r\n    var BaseForeignObject = {\r\n        ___$view: null,//当前视图节点\r\n        __base: function (eventDispatch, eventsInfo, nodeId, node) {\r\n            var args = Array.prototype.slice.apply(arguments, [0]);\r\n            for (var i = 0; i < args.length; i++) {\r\n                var obj = args[i];\r\n                //将node对象取出\r\n                if (obj && obj instanceof jQuery) {\r\n                    this.___$view = obj;\r\n                    args.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            Base.__base.apply(this, args);\r\n        },\r\n        __$: function () {\r\n            return this.___$view;\r\n        },\r\n        __setMatrix: function (matrix) {\r\n            this.___$view.attr('transform', 'matrix(' + matrix.m.a + ' ' + matrix.m.b + ' ' + matrix.m.c + ' ' + matrix.m.d + ' ' + matrix.m.e + ' ' + matrix.m.f + ')');\r\n        },\r\n        __getWidth: function () {\r\n            return this.___$view.width();\r\n        },\r\n        __getHeight: function () {\r\n            return this.___$view.height();\r\n        },\r\n        __setWidth: function (width) {\r\n            this.___$view.css('width', width + 'px');\r\n            return this;\r\n        },\r\n        __setHeight: function () {\r\n            this.___$view.css('height', width + 'px');\r\n            return this;\r\n        },\r\n        __setVisible: function (visible) {\r\n            if (visible) {\r\n                this.___$view.show();\r\n            } else {\r\n                this.___$view.hide();\r\n            }\r\n        },\r\n        __isVisible: function () {\r\n            return this.___$view.is(':visible');\r\n        },\r\n        __remove: function () {\r\n            this.___$view.remove();\r\n        }\r\n    };\r\n\r\n    //创建基类\r\n    __M.Class.Base = function (cls) {\r\n        return Object.create(Base).__include(cls);\r\n    };\r\n\r\n    //svg节点基类\r\n    __M.Class.BaseView = function (cls) {\r\n        return Object.create(Base).__include(Object.create(BaseView)).__include(cls);\r\n    };\r\n\r\n    //自建的外部svg节点基类\r\n    __M.Class.BaseForeignObject = function (cls) {\r\n        return Object.create(Base).__include(Object.create(BaseForeignObject)).__include(cls);\r\n    };\r\n}(window, jQuery, __M));\n(function (window, $, kity, __M) {\r\n\r\n\r\n    __M.Utils = {\r\n        getFixedFloat: function (floatNum, digitalCount) {\r\n            var num = floatNum.toString();\r\n            var numAry = num.split('.');\r\n            if (numAry.length !== 2) {\r\n                return floatNum;\r\n            }\r\n            if (numAry[0] === '') {\r\n                numAry[0] = '0';\r\n            }\r\n            var len = numAry[1].length;\r\n            if (len === 0 || digitalCount === 0) {\r\n                return parseInt(numAry[0]);\r\n            }\r\n            var result = numAry[0] + '.' + numAry[1].substring(0, (digitalCount >= len ? len : digitalCount));\r\n            return parseFloat(result);\r\n        },\r\n        getValue: function (str, regex, index) {\r\n            var result = '';\r\n            var arr = str.match(regex);\r\n            if (typeof  index === 'number' && arr && arr.length > index) {\r\n                result = arr[index];\r\n            } else if (arr && arr.length === 2) {\r\n                result = arr[1];\r\n            }\r\n            return result;\r\n        },\r\n        getUuid: function () {\r\n            var s = [];\r\n            var hexDigits = \"0123456789abcdef\";\r\n            for (var i = 0; i < 36; i++) {\r\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n            }\r\n            s[14] = \"4\";  // bits 12-15 of the time_hi_and_version field to 0010\r\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01\r\n            s[8] = s[13] = s[18] = s[23] = \"-\";\r\n\r\n            var uuid = s.join(\"\");\r\n            return uuid;\r\n        },\r\n        /**\r\n         * @param arr\r\n         * @param id\r\n         * @param proName\r\n         * @returns {*}\r\n         */\r\n        getItemInArrayById: function (arr, id, proName) {\r\n            if (!proName) {\r\n                proName = 'id';\r\n            }\r\n            for (var i = 0, l = arr.length; i < l; i++) {\r\n                var tempId = ( typeof arr[i][proName] === \"function\" ) ? (arr[i][proName]()) : arr[i][proName];\r\n                if (tempId === id) {\r\n                    return arr[i];\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        //判断一个点是否在多边形内\r\n        isPointInsidePoly: function (point, poly) {\r\n            var length = poly.length;\r\n            for (var c = false, i = -1, j = length - 1; ++i < length; j = i) {\r\n                ((poly[i].y <= point.y && point.y < poly[j].y) || (poly[j].y <= point.y && point.y < poly[i].y))\r\n                && (point.x < (poly[j].x - poly[i].x) * (point.y - poly[i].y) / (poly[j].y - poly[i].y) + poly[i].x)\r\n                && (c = !c);\r\n            }\r\n            return c;\r\n        },\r\n        //检查两个矩形框是否交叉\r\n        checkRectsCross: function (rectA, rectB) {\r\n            /**\r\n             * 矩形A的宽 Wa = Xa2-Xa1 高 Ha = Ya2-Ya1\r\n             * 矩形B的宽 Wb = Xb2-Xb1 高 Hb = Yb2-Yb1\r\n             * 矩形A的中心坐标 (Xa3,Ya3) = （ (Xa2+Xa1)/2 ，(Ya2+Ya1)/2 ）\r\n             * 矩形B的中心坐标 (Xb3,Yb3) = （ (Xb2+Xb1)/2 ，(Yb2+Yb1)/2 ）\r\n             * 所以只要同时满足下面两个式子，就可以说明两个矩形相交。\r\n             *   1) | Xb3-Xa3 | <= Wa/2 + Wb/2\r\n             *   2) | Yb3-Ya3 | <= Ha/2 + Hb/2\r\n             *   即:\r\n             *   1) | Xb2+Xb1-Xa2-Xa1 | <= Xa2-Xa1 + Xb2-Xb1\r\n             *   2) | Yb2+Yb1-Ya2-Ya1 | <= Ya2-Ya1 + Yb2-Yb1\r\n             */\r\n            return Math.abs(rectB.p1.x + rectB.p2.x - rectA.p1.x - rectA.p2.x) <= ( Math.abs(rectA.p1.x - rectA.p2.x) + Math.abs(rectB.p1.x - rectB.p2.x))\r\n                &&\r\n                Math.abs(rectB.p2.y + rectB.p1.y - rectA.p2.y - rectA.p1.y) <= ( Math.abs(rectA.p2.y - rectA.p1.y) + Math.abs(rectB.p2.y - rectB.p1.y));\r\n        },\r\n        isMobile: navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false,\r\n        supportTouch: 'ontouchend' in document,\r\n        getEventPagePos: function (e) {\r\n            var ev = e.originalEvent ? e.originalEvent : e;\r\n            var point = {};\r\n            switch (ev.type) {\r\n                case 'touchstart':\r\n                case 'touchmove':\r\n                case 'touchend':\r\n                case 'touchcancel':\r\n                    point.x = ev.changedTouches[0].pageX;\r\n                    point.y = ev.changedTouches[0].pageY;\r\n                    return point;\r\n                default:\r\n                    point.x = e.pageX;\r\n                    point.y = e.pageY;\r\n                    return point;\r\n            }\r\n            return point;\r\n        }\r\n    };\r\n\r\n}(window, jQuery, kity, __M));\n/**\r\n * Created by ylf on 2016/4/9.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    __M.Utils.String = {\r\n        _templateRegExp: /\\$\\{(.+?)(?:\\:(.+?))?\\}/g,\r\n        //替换字符串\r\n        template: function (tpl, attrs) {\r\n            return tpl.replace(this._templateRegExp, function ($0, $1, $2) {\r\n                return attrs[$1] || $0;\r\n            });\r\n        },\r\n        /**\r\n         * 获取膜拜对应值\r\n         * @param text  minder_node_121_dasdfs\r\n         * @param tpl  minder_node_${id:number}_${name:string}\r\n         * @return {id:121,name:'dasdfs'}\r\n         */\r\n        getTemplateValue: function (text, tpl) {\r\n            //获取到数据类型\r\n            var tempRegExp = this.templateRegex(tpl);\r\n            var result = tempRegExp.regExp.exec(text);\r\n            if (!result) {\r\n                return null;\r\n            }\r\n\r\n            //获取所有key\r\n            var keys = Object.keys(tempRegExp.attrs);\r\n            var values = null;\r\n\r\n            //从1开始，略过匹配的全局字符串\r\n            for (var i = 1; i < result.length; i++) {\r\n                if (!values) {\r\n                    values = {};\r\n                }\r\n                if (keys.length > i - 1) {\r\n                    var key = keys[i - 1];\r\n                    if (tempRegExp.attrs[key] === 'number') {\r\n                        values[key] = parseInt(result[i]);\r\n                    } else {\r\n                        values[key] = result[i];\r\n                    }\r\n                }\r\n            }\r\n            return values;\r\n        },\r\n        //生成正则表达式\r\n        templateRegex: function (tpl) {\r\n            var attrs = {};\r\n            var regexStr = tpl.replace(this._templateRegExp, function ($0, $1, $2) {\r\n                attrs[$1] = $2;\r\n                if ($2) {\r\n                    if ($2 === 'number') {\r\n                        return '(\\\\d+?)';\r\n                    } else if ($2 === 'string') {\r\n                        return '(.+?)';\r\n                    }\r\n                }\r\n                else {\r\n                    return '(.+?)';\r\n                }\r\n            });\r\n            regexStr = '^' + regexStr + '$';\r\n            return {\r\n                regExp: new RegExp(regexStr),\r\n                attrs: attrs\r\n            };\r\n        },\r\n        getTextLfToBr: function (text) {\r\n            //统一替换\r\n            text = text.replace(/<br\\/>/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n            //div 在行末和行首插入换行\r\n            text = text.replace(/<div>([\\s\\S]*?)<\\/div>/g, function ($1, $2) {\r\n                return '<br/>' + $2 + '<br/>';\r\n            });\r\n            //</div><div>这种情况只处理一个换行\r\n            text = text.replace(/<br\\/><br\\/>/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n            //统一替换\r\n            text = text.replace(/<br\\/>/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n            //统一替换\\r\\n\r\n            text = text.replace(/\\r\\n/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n            //统一替换\\r\\n\r\n            text = text.replace(/(\\r|\\n)/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n\r\n            return text;\r\n        },\r\n        getTextBrToLf: function (text) {\r\n            text = text.replace(/<br([^<>]*?)\\/?>/g, function ($1, $2) {\r\n                return '\\r\\n';\r\n            });\r\n            return text;\r\n        }\r\n    };\r\n\r\n}(window, jQuery, __M));\n//参考：https://github.com/kticka/jquery-outclick/blob/master/outclick.js\r\n\r\n\r\n(function (window, $, __M) {\r\n    __M.Utils.OutClick = {\r\n        uuid: '',\r\n        instances: [],//{containerEle:'',listener:[]}\r\n        containerEle: document,\r\n        getUuid: function () {\r\n            var s = [];\r\n            var hexDigits = \"0123456789abcdef\";\r\n            for (var i = 0; i < 36; i++) {\r\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n            }\r\n            s[14] = \"4\";  // bits 12-15 of the time_hi_and_version field to 0010\r\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01\r\n            s[8] = s[13] = s[18] = s[23] = \"-\";\r\n\r\n            var uuid = s.join(\"\");\r\n            return uuid;\r\n        },\r\n        create: function (containerEle) {\r\n            var ins = Object.create(this);\r\n            ins.instances = [];\r\n            ins.uuid = this.getUuid();\r\n            ins.containerEle = containerEle;\r\n            return ins;\r\n        },\r\n        trigger: function (event) {\r\n            var that = this;\r\n            return $.each(this.instances, function (index, instance) {\r\n                if (that.outside(instance.element, event.target)) {\r\n                    var invoke = true;\r\n                    if (instance.ignoreEle && !that.outside($(instance.ignoreEle), event.target)) {\r\n                        invoke = false;\r\n                    }\r\n                    if (invoke && typeof instance.callback === 'function') {\r\n                        return instance.callback.call(instance.element);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        register: function (element, ignoreEle, callback) {\r\n            return this.instances.push({\r\n                element: element,\r\n                ignoreEle: ignoreEle,\r\n                options: [],\r\n                callback: callback\r\n            });\r\n        },\r\n        enable: function () {\r\n            var that = this;\r\n            return $(this.containerEle).on('mousedown.outclick' + this.uuid, function (e) {\r\n                that.trigger(e);\r\n            });\r\n        },\r\n        disable: function () {\r\n            return $(this.containerEle).off('mousedown.outclick' + this.uuid);\r\n        },\r\n        reset: function () {\r\n            this.disable();\r\n            return this.enable();\r\n        },\r\n        outside: function (element, target) {\r\n            return !element.is(target) && element.has(target).length === 0;\r\n        }\r\n    };\r\n\r\n    $.fn.mOutclick = function (callback, ignoreEle, outClickInstance) {\r\n        outClickInstance.reset();\r\n        outClickInstance.register(this, ignoreEle, callback);\r\n        return this;\r\n    };\r\n})(window, $, __M);\r\n\r\n\n/**\r\n * Created by ylf on 2016/4/9.\r\n */\r\n(function (window, __M) {\r\n\r\n    __M.Utils.Clipboard = {\r\n        _data: null,\r\n        create: function () {\r\n            var instance = Object.create(this);\r\n            return instance;\r\n        },\r\n        setData: function (data, cut) {\r\n            this._data = {\r\n                text: data,\r\n                cut: cut\r\n            };\r\n        },\r\n        getData: function () {\r\n            if (!this._data) {\r\n                return '';\r\n            }\r\n            var text = this._data.text;\r\n            if (this._data.cut) {\r\n                this._data = null;\r\n            }\r\n            return text;\r\n        },\r\n        isEmpty: function () {\r\n            if (this._data && this._data.text.length > 0) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    };\r\n\r\n}(window, __M));\n(function (window, $, __M) {\r\n\r\n\r\n    var Command = __M.Command = {};\r\n\r\n    Command.TYPE = {\r\n        ADD: 1,\r\n        DELETE: 2,\r\n        EXPAND: 3,\r\n        MOVE: 4,\r\n        MODIFY_TEXT: 5\r\n    };\r\n\r\n    Command.Queue = {\r\n        _queue: [],\r\n        _currentIndex: 0,\r\n        _maxLength: 10,\r\n        create: function () {\r\n            var instance = Object.create(this);\r\n            instance._queue = [];\r\n            return instance;\r\n        },\r\n        undo: function () {\r\n            if (this._currentIndex < 0) {\r\n                return;\r\n            }\r\n            this._queue[this._currentIndex--].undo();\r\n        },\r\n        redo: function () {\r\n            if (this._currentIndex >= this._queue.length - 1) {\r\n                return;\r\n            }\r\n            this._queue[this._currentIndex++].do();\r\n        },\r\n        push: function (command) {\r\n            //有新命令，移除当前索引之后的命令，这些命令将不能被redo\r\n            this._queue = this._queue.slice(0, this._currentIndex + 1);\r\n            this._queue.push(command);\r\n            //不超过最大限制\r\n            if (this._queue.length > this._maxLength) {\r\n                this._queue.shift();\r\n            }\r\n            //重新指定索引为最后一个\r\n            this._currentIndex = this._queue.length - 1;\r\n        },\r\n        redoAble: function () {\r\n            return (this._queue.length - 1) > this._currentIndex;\r\n        },\r\n        undoAble: function () {\r\n            return this._currentIndex >= 0 && this._queue.length > 0;\r\n        }\r\n    };\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2015/12/9.\r\n */\r\n//事件管理对象\r\n(function (window, $, __M) {\r\n\r\n    var Logger = __M.Logger;\r\n\r\n    __M.Event = {\r\n        _eventHandler: null,\r\n        create: function () {\r\n            var instance = Object.create(this);\r\n            instance._eventHandler = {};\r\n            return instance;\r\n        },\r\n        trigger: function () {\r\n            //将参数转换为数组\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            //取第一个，并从数组中删除，事件key\r\n            var type = arg.shift();\r\n            if (!this._eventHandler || !this._eventHandler[type]) {\r\n                return false;\r\n            }\r\n            var handlers = this._eventHandler[type];\r\n            handlers.forEach(function (handler) {\r\n                handler.cb.apply(handler.domain || this, arg);\r\n                Logger.debug('event-trigger', type, arg.toString());\r\n            });\r\n            return true;\r\n        },\r\n        add: function (type, callback, domain) {\r\n            if (!this._eventHandler[type]) {\r\n                this._eventHandler[type] = [];\r\n            }\r\n            this._eventHandler[type].push({cb: callback, domain: domain});\r\n            return true;\r\n        },\r\n        remove: function (type, callback,domain) {\r\n            var handlers = this._eventHandler[type];\r\n            if (handlers && handlers.length > 0) {\r\n                var len = handlers.length;\r\n                var handler;\r\n                for (var i = 0; i < len; i++) {\r\n                    handler = handlers[i];\r\n                    if (handler && callback === handler.cb) {\r\n                        if (domain && domain !== handler.domain) {\r\n                            continue;\r\n                        }\r\n                        handlers.splice(i, 1);\r\n                        i--;\r\n                        len--;\r\n                    }\r\n                }\r\n            }\r\n            if (handlers && handlers.length === 0) {\r\n                delete  this._eventHandler[type];\r\n            }\r\n        }\r\n    };\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n\r\n\r\n    __M.Utils.Svg = {\r\n        //添加外部对象\r\n        addForeignObject: function (parentSvg, id, cls, x, y, width, height) {\r\n            var svgdoc = parentSvg.ownerDocument;\r\n            var foreignObject = svgdoc.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');\r\n            foreignObject.setAttribute(\"x\", x);\r\n            foreignObject.setAttribute(\"y\", y);\r\n            foreignObject.setAttribute(\"id\", id);\r\n            foreignObject.setAttribute(\"height\", height + \"px\");\r\n            foreignObject.setAttribute(\"width\", width + \"px\");\r\n            var div = svgdoc.createElement('div');\r\n            if (cls) {\r\n                div.setAttribute(\"class\", cls);\r\n            }\r\n            foreignObject.appendChild(div);\r\n            parentSvg.appendChild(foreignObject);\r\n            return foreignObject;\r\n        },\r\n        //添加title\r\n        addTitle: function (parentSvg, txt) {\r\n            var svgdoc = parentSvg.ownerDocument;\r\n            var title = svgdoc.createElementNS('http://www.w3.org/2000/svg', 'title');\r\n            title.innerHTML = txt;\r\n            parentSvg.appendChild(title);\r\n            return title;\r\n        }\r\n    };\r\n\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n\r\n    var Utils = __M.Utils;\r\n\r\n    __M.ID = {\r\n        _nodeId: 'minder_node_${i:number}',\r\n        _textBorderId: 'node_text_border_${i:number}',\r\n        _textGroupId: 'node_text_g_${i:number}',\r\n        _textId: 'node_text_${i:number}',\r\n        _visibleImageId: 'node_image_visible_${i:number}',\r\n        _expandGroupId: 'node_expand_${orientation:string}_${i:number}',\r\n        _expandTriangleId: 'node_expand_triangle_${orientation:string}_${i:number}',\r\n        _createPlusId: 'node_plus_${orientation:string}_${i:number}',\r\n        _delBtnId: 'node_del_${i:number}',\r\n        getNodeId: function (nodeIndex) {\r\n            return Utils.String.template(this._nodeId, {i: nodeIndex});\r\n        },\r\n        getDelBtnId: function (nodeIndex) {\r\n            return Utils.String.template(this._delBtnId, {i: nodeIndex});\r\n        },\r\n        getTextBorderId: function (nodeIndex) {\r\n            return Utils.String.template(this._textBorderId, {i: nodeIndex});\r\n        },\r\n        getTextGroupId: function (nodeIndex) {\r\n            return Utils.String.template(this._textGroupId, {i: nodeIndex});\r\n        },\r\n        getTextId: function (nodeIndex) {\r\n            return Utils.String.template(this._textId, {i: nodeIndex});\r\n        },\r\n        getVisibleImageId: function (nodeIndex) {\r\n            return Utils.String.template(this._visibleImageId, {i: nodeIndex});\r\n        },\r\n        getExpandGroupId: function (nodeIndex, orientation) {\r\n            return Utils.String.template(this._expandGroupId, {i: nodeIndex, orientation: orientation});\r\n        },\r\n        getExpandTriangleId: function (nodeIndex, orientation) {\r\n            return Utils.String.template(this._expandTriangleId, {i: nodeIndex, orientation: orientation});\r\n        },\r\n        getCreatePlusId: function (nodeIndex, orientation) {\r\n            return Utils.String.template(this._createPlusId, {i: nodeIndex, orientation: orientation});\r\n        },\r\n        getTargetValue: function (id) {\r\n            var that = this;\r\n            var value = Utils.String.getTemplateValue(id, that._createPlusId);\r\n            if (value) {\r\n                value.type = 'plus';\r\n                return value;\r\n            }\r\n\r\n            value = Utils.String.getTemplateValue(id, that._expandTriangleId);\r\n            if (value) {\r\n                value.type = 'expand';\r\n                return value;\r\n            }\r\n\r\n            value = Utils.String.getTemplateValue(id, that._delBtnId);\r\n            if (value) {\r\n                value.type = 'del';\r\n                return value;\r\n            }\r\n\r\n            //TODO:这个写法要优化，否则容易遗留bug\r\n            //文本节点或边框时才是节点事件\r\n            value = Utils.String.getTemplateValue(id, that._textGroupId);\r\n            if (value) {\r\n                value.type = 'node';\r\n                return value;\r\n            }\r\n            value = Utils.String.getTemplateValue(id, that._textBorderId);\r\n            if (value) {\r\n                value.type = 'node';\r\n                return value;\r\n            }\r\n            value = Utils.String.getTemplateValue(id, that._visibleImageId);\r\n            if (value) {\r\n                value.type = 'node';\r\n            }\r\n            return value;\r\n        },\r\n        isNode: function (id) {\r\n            return /^minder_node_\\d+$/.test(id);\r\n        },\r\n        getTextIdByNodeId: function (id) {\r\n            var val = Utils.String.getTemplateValue(id, this._nodeId);\r\n            if (val && typeof  val.i !== 'undefined' && val.i !== '') {\r\n                return this.getTextId(val.i);\r\n            }\r\n            return null;\r\n        },\r\n        isRoot: function (id) {\r\n            return id === 'minder_node_1';\r\n        }\r\n    };\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/5/24.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    /*!\r\n     * https://github.com/Starcounter-Jack/Fast-JSON-Patch\r\n     * json-patch-duplex.js 0.5.0\r\n     * (c) 2013 Joachim Wester\r\n     * MIT license\r\n     */\r\n    var _objectKeys = function () {\r\n        if (Object.keys) return Object.keys;\r\n        return function (o) {\r\n            var keys = [];\r\n            for (var i in o) {\r\n                if (o.hasOwnProperty(i)) {\r\n                    keys.push(i);\r\n                }\r\n            }\r\n            return keys;\r\n        };\r\n    }();\r\n\r\n    function escapePathComponent(str) {\r\n        if (str.indexOf(\"/\") === -1 && str.indexOf(\"~\") === -1) return str;\r\n        return str.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\r\n    }\r\n\r\n    function deepClone(obj) {\r\n        if (typeof obj === \"object\") {\r\n            return JSON.parse(JSON.stringify(obj));\r\n        } else {\r\n            return obj;\r\n        }\r\n    }\r\n\r\n    // Dirty check if obj is different from mirror, generate patches and update mirror\r\n    function _generate(mirror, obj, patches, path) {\r\n        var newKeys = _objectKeys(obj);\r\n        var oldKeys = _objectKeys(mirror);\r\n        var changed = false;\r\n        var deleted = false;\r\n        for (var t = oldKeys.length - 1; t >= 0; t--) {\r\n            var key = oldKeys[t];\r\n            var oldVal = mirror[key];\r\n            if (obj.hasOwnProperty(key)) {\r\n                var newVal = obj[key];\r\n                if (typeof oldVal == \"object\" && oldVal != null && typeof newVal == \"object\" && newVal != null) {\r\n                    _generate(oldVal, newVal, patches, path + \"/\" + escapePathComponent(key));\r\n                } else {\r\n                    if (oldVal != newVal) {\r\n                        changed = true;\r\n                        patches.push({\r\n                            op: \"replace\",\r\n                            path: path + \"/\" + escapePathComponent(key),\r\n                            value: deepClone(newVal)\r\n                        });\r\n                    }\r\n                }\r\n            } else {\r\n                patches.push({\r\n                    op: \"remove\",\r\n                    path: path + \"/\" + escapePathComponent(key)\r\n                });\r\n                deleted = true;\r\n            }\r\n        }\r\n        if (!deleted && newKeys.length == oldKeys.length) {\r\n            return;\r\n        }\r\n        for (var t = 0; t < newKeys.length; t++) {\r\n            var key = newKeys[t];\r\n            if (!mirror.hasOwnProperty(key)) {\r\n                patches.push({\r\n                    op: \"add\",\r\n                    path: path + \"/\" + escapePathComponent(key),\r\n                    value: deepClone(obj[key])\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function compare(tree1, tree2) {\r\n        var patches = [];\r\n        _generate(tree1, tree2, patches, \"\");\r\n        return patches;\r\n    }\r\n\r\n    __M.Utils.JsonDiff = {\r\n        compare: compare\r\n    };\r\n}(window, jQuery, __M));\n/**\r\n * Created by Administrator on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var ID = __M.ID;\r\n    var BaseView = __M.Class.BaseView;\r\n    var Svg = __M.Utils.Svg;\r\n    var Utils = __M.Utils;\r\n    var Config = __M.Config;\r\n\r\n    var plusStyle = Config.plusStyle;\r\n\r\n    __M.View.Plus = BaseView({\r\n        _orientation: null,\r\n        _clickWidth: plusStyle.circleWidth + 20,\r\n        _clickHeight: plusStyle.circleWidth + 28,\r\n        create: function (nodeIndex, eventDispatch, orientation, option) {\r\n            var instance = Object.create(this);\r\n            instance.__base(eventDispatch, ID.getNodeId(nodeIndex), new kity.Group().setId(ID.getCreatePlusId(nodeIndex, orientation)));\r\n            instance._option = option;\r\n            instance._orientation = orientation;\r\n            instance._createNode();\r\n\r\n            return instance;\r\n        },\r\n        _createNode: function () {\r\n            var that = this;\r\n            //添加提示\r\n            var lang = this._option.langData;\r\n            Svg.addTitle(this.__getShape().node, lang['mdnode_addchildtip']);\r\n            this.__getShape().setStyle({cursor: 'pointer'});\r\n\r\n            var circle = new kity.Circle(plusStyle.circleWidth, 0, 0).fill(plusStyle.circleFill).stroke(plusStyle.circleStroke);\r\n            this.__addShape(circle);\r\n            var plus = new kity.Path().stroke(plusStyle.plusSroke).setAttr('stroke-width', plusStyle.plusStokeWidth);\r\n            var plusDrawer = plus.getDrawer();\r\n            plusDrawer.moveTo(-plusStyle.plusWidth, 0);//左\r\n            plusDrawer.lineTo(plusStyle.plusWidth, 0);//右\r\n            plusDrawer.moveTo(0, -plusStyle.plusWidth);//上\r\n            plusDrawer.lineTo(0, plusStyle.plusWidth);//下\r\n            this.__addShape(plus);\r\n\r\n            //新建隐藏的节点，扩大点击作用域\r\n            if (!Utils.isMobile) {\r\n                this._clickWidth = plusStyle.circleWidth + 17;\r\n                this._clickHeight = plusStyle.circleWidth + 20;\r\n            }\r\n            var clickRect = new kity.Rect(this._clickWidth, this._clickHeight, 0, 0).fill(plusStyle.clickFill).setStyle(plusStyle.clickStyle);\r\n            clickRect.translate(-this._clickWidth / 2, -this._clickHeight / 2);\r\n            this.__addShape(clickRect);\r\n        },\r\n        getVisibleWidth: function () {\r\n            return plusStyle.circleWidth * 2;\r\n        },\r\n        destroy: function () {\r\n\r\n        }\r\n    });\r\n\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var ID = __M.ID;\r\n    var BaseView = __M.Class.BaseView;\r\n    var Utils = __M.Utils;\r\n\r\n    //样式\r\n    var _triangleStyle = __M.Config.triangleStyle;\r\n    var Config = __M.Config;\r\n\r\n    var plusWidth = Config.plusStyle.circleWidth * 2 + 5;\r\n\r\n    __M.View.ExpandTriangle = BaseView({\r\n        _orientation: null,\r\n        _triangleNode: null,//三角按钮\r\n        _circleNode: null,//圆圈\r\n        _circleGroupNode: null,//圆圈父节点\r\n        _leftLineNode: null,//左边线条\r\n        _halfLineNode: null,\r\n        _rightLineNode: null,//右边线条\r\n        _nodeLevel: null,//\r\n        create: function (nodeIdIndex, nodeLevel, eventDispatch, orientation) {\r\n            var instance = Object.create(this);\r\n            instance.__base(eventDispatch, ID.getNodeId(nodeIdIndex), new kity.Group().setId(ID.getExpandGroupId(nodeIdIndex, orientation)));\r\n            instance._orientation = orientation;\r\n            instance._nodeLevel = nodeLevel;\r\n            instance._create(nodeLevel, nodeIdIndex, orientation);\r\n            return instance;\r\n        },\r\n        _create: function (nodeLevel, nodeIdIndex, orientation) {\r\n            if (nodeLevel === 1) {\r\n                var leftHorizontalLine = this._leftLineNode = new kity.Path().setStyle(_triangleStyle.lineStyle);\r\n                var halfLine = this._halfLineNode = new kity.Path().setStyle(_triangleStyle.lineStyle);\r\n                this.__addShape(leftHorizontalLine);\r\n                this.__addShape(halfLine);\r\n\r\n                var lineDrawer = leftHorizontalLine.getDrawer();\r\n                var halfLineDrawer = halfLine.getDrawer();\r\n                var lineWidth = (_triangleStyle.lineWidth * 2) / 3;\r\n\r\n                if (orientation === 'left') {\r\n                    lineDrawer.moveTo(0, 0);\r\n                    lineDrawer.lineTo(lineWidth - plusWidth, 0);\r\n\r\n                    halfLineDrawer.moveTo(plusWidth, 0);\r\n                    halfLineDrawer.lineTo(lineWidth, 0);\r\n                } else {\r\n                    halfLineDrawer.moveTo(0, 0);\r\n                    halfLineDrawer.lineTo(plusWidth + 0.5, 0);\r\n\r\n                    lineDrawer.moveTo(plusWidth, 0);\r\n                    lineDrawer.lineTo(lineWidth, 0);\r\n                }\r\n\r\n\r\n            } else {\r\n                //创建中间的线\r\n                var leftHorizontalLine = this._leftLineNode = new kity.Path().setStyle(_triangleStyle.lineStyle);\r\n                this.__addShape(leftHorizontalLine);\r\n                var rightHorizontalLine = this._rightLineNode = new kity.Path().setStyle(_triangleStyle.lineStyle);\r\n                this.__addShape(rightHorizontalLine);\r\n                //新建两段被加号覆盖隐藏的线段\r\n                var halfLine = this._halfLineNode = new kity.Path().setStyle(_triangleStyle.lineStyle);\r\n                this.__addShape(halfLine);\r\n\r\n                this._createTriangleGroup(nodeIdIndex, orientation);\r\n\r\n                var leftLineDrawer = leftHorizontalLine.getDrawer();\r\n                var rightLineDrawer = rightHorizontalLine.getDrawer();\r\n                var halfLineDrawer = halfLine.getDrawer();\r\n\r\n                var lineHalfWidth = _triangleStyle.lineWidth / 2;\r\n                var circleWidth = _triangleStyle.circleWidth;\r\n\r\n                if (orientation === 'left') {\r\n\r\n                    leftLineDrawer.moveTo(0, 0);\r\n                    leftLineDrawer.lineTo(lineHalfWidth - circleWidth, 0);\r\n\r\n                    //rightLineDrawer.moveTo(0, 0);\r\n                    //rightLineDrawer.lineTo((lineHalfWidth - circleWidth - plusWidth), 0);\r\n                    rightLineDrawer.moveTo(lineHalfWidth + circleWidth, 0);\r\n                    rightLineDrawer.lineTo(lineHalfWidth + circleWidth + (lineHalfWidth - circleWidth - plusWidth), 0);\r\n                    //rightHorizontalLine.translate(lineHalfWidth + circleWidth ,0);\r\n\r\n                    halfLineDrawer.moveTo(lineHalfWidth + circleWidth + (lineHalfWidth - circleWidth - plusWidth) + plusWidth, 0);\r\n                    halfLineDrawer.lineTo(lineHalfWidth + circleWidth, 0);\r\n\r\n                } else {\r\n                    rightLineDrawer.moveTo(0, 0);\r\n                    rightLineDrawer.lineTo(lineHalfWidth - circleWidth, 0);\r\n                    //移动到右侧\r\n                    rightHorizontalLine.translate(lineHalfWidth + circleWidth, 0);\r\n\r\n                    halfLineDrawer.moveTo(0, 0);\r\n                    halfLineDrawer.lineTo(plusWidth + 0.5, 0);\r\n\r\n                    leftLineDrawer.moveTo(plusWidth, 0);\r\n                    leftLineDrawer.lineTo(lineHalfWidth - circleWidth, 0);\r\n                }\r\n\r\n            }\r\n        },\r\n        _createTriangleGroup: function (nodeIdIndex, orientation) {\r\n\r\n            var group = this._circleGroupNode = new kity.Group().setId(ID.getExpandTriangleId(nodeIdIndex, orientation)).setStyle(_triangleStyle.style).fill(_triangleStyle.clickCircleFill);\r\n            //新建圆圈节点\r\n            var circle = this._circleNode = new kity.Circle(_triangleStyle.circleWidth, 0, 0).setStyle(_triangleStyle.circleStrokeStyle);\r\n            group.addShape(circle);\r\n\r\n\r\n            //新建隐藏的节点，扩大点击作用域\r\n            var clickWidth = 20;\r\n            var clickHeight = 22;\r\n            var clickPaddingLeft = 0;\r\n            if (Utils.isMobile) {\r\n                clickWidth = 30;\r\n                clickHeight =34;\r\n                clickPaddingLeft = 4;\r\n            }\r\n\r\n            var clickWidth = _triangleStyle.circleWidth + clickWidth;\r\n            var clickHeight = _triangleStyle.circleWidth + clickHeight;\r\n            var clickRect = new kity.Rect(clickWidth, clickHeight, 0, 0).fill(_triangleStyle.clickCircleFill).setStyle(_triangleStyle.clickCircleStrokeStyle);\r\n            clickRect.translate(-clickWidth / 2, -clickHeight / 2);\r\n            group.addShape(clickRect);\r\n\r\n\r\n            //新建三角形\r\n            var polyline = this._triangleNode = new kity.Polyline();\r\n            this._createTriangle(polyline, orientation);\r\n            polyline.fill(_triangleStyle.triangleFill).stroke(_triangleStyle.triangleStroke);\r\n            //三角形居中显示\r\n            var matrix = new kity.Matrix(1, 0, 0, 1, -_triangleStyle.triangleWidth / 2, -_triangleStyle.triangleHeight / 2);\r\n            polyline.setMatrix(matrix);\r\n            group.addShape(polyline);\r\n\r\n            group.translate(_triangleStyle.lineWidth / 2);\r\n\r\n            this.__addShape(group);\r\n        },\r\n        update: function (expand) {\r\n            var that = this;\r\n            if (expand) {\r\n                //展开全部显示\r\n                that._updateTriangle(that._orientation === 'left' ? 'left' : 'right');\r\n                that._leftLineNode.setVisible(true);\r\n                that._rightLineNode.setVisible(true);\r\n            } else {\r\n                if (that._orientation === 'left') {\r\n                    //左侧收起\r\n                    that._updateTriangle('right');\r\n                    that._leftLineNode.setVisible(false);\r\n                    that._rightLineNode.setVisible(true);\r\n                } else {\r\n                    //右侧收起\r\n                    that._updateTriangle('left');\r\n                    that._leftLineNode.setVisible(true);\r\n                    that._rightLineNode.setVisible(false);\r\n                }\r\n            }\r\n        },\r\n        updateHalfLine: function (focus) {\r\n            if (focus) {\r\n                $(this._halfLineNode.node).css('visibility', 'hidden');\r\n            } else {\r\n                $(this._halfLineNode.node).css('visibility', 'visible');\r\n            }\r\n        },\r\n        _createTriangle: function (polyline, orientation) {\r\n            polyline.clear();\r\n            if (orientation === 'left') {\r\n                polyline.addPoint(new kity.ShapePoint(0, 0));//左上\r\n                polyline.addPoint(new kity.ShapePoint(_triangleStyle.triangleWidth, _triangleStyle.triangleHeight / 2));//右中\r\n                polyline.addPoint(new kity.ShapePoint(0, _triangleStyle.triangleHeight));//坐下\r\n                polyline.addPoint(new kity.ShapePoint(0, 0));//闭合\r\n                var matrix = new kity.Matrix(1, 0, 0, 1, -_triangleStyle.triangleWidth / 2 + 2, -_triangleStyle.triangleHeight / 2);\r\n                polyline.setMatrix(matrix);\r\n            } else if (orientation === 'right') {\r\n                polyline.addPoint(new kity.ShapePoint(_triangleStyle.triangleWidth, 0));//右上\r\n                polyline.addPoint(new kity.ShapePoint(_triangleStyle.triangleWidth, _triangleStyle.triangleHeight));//右下\r\n                polyline.addPoint(new kity.ShapePoint(0, _triangleStyle.triangleHeight / 2));//左中\r\n                polyline.addPoint(new kity.ShapePoint(_triangleStyle.triangleWidth, 0));//闭合\r\n                var matrix = new kity.Matrix(1, 0, 0, 1, -_triangleStyle.triangleWidth / 2 - 2, -_triangleStyle.triangleHeight / 2);\r\n                polyline.setMatrix(matrix);\r\n            }\r\n        },\r\n        _updateTriangle: function (orientation) {\r\n            this._createTriangle(this._triangleNode, orientation);\r\n        },\r\n        //获取到完整的宽度\r\n        getFullWidth: function () {\r\n            if (this._nodeLevel === 1) {\r\n                return (_triangleStyle.lineWidth * 2) / 3;\r\n            } else {\r\n                return _triangleStyle.lineWidth;\r\n            }\r\n        },\r\n        destroy: function () {\r\n\r\n        }\r\n    });\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by Administrator on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var _lineStyle = __M.Config.lineStyle;\r\n    var BaseView = __M.Class.BaseView;\r\n    var Utils = __M.Utils;\r\n\r\n\r\n    __M.View.ConnectLine = BaseView({\r\n        _mindNodeCore: null,\r\n        _type: 'both',\r\n        create: function (mindNodeCore) {\r\n            var instance = Object.create(this);\r\n            instance.__base(new kity.Path());\r\n            instance._mindNodeCore = mindNodeCore;\r\n            instance._type = mindNodeCore.getOption().type;\r\n            instance._init();\r\n            return instance;\r\n        },\r\n        _init: function () {\r\n            this.draw();\r\n        },\r\n        draw: function (type, data) {\r\n            //https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial/Paths\r\n            //重新根据父节点位置计算线\r\n            var box = this._mindNodeCore.getLayoutBox(), pBox = this._mindNodeCore.getParent().getLayoutBox();\r\n            var childCount = this._mindNodeCore.getParent().getChildrenCount();\r\n            var orientation;\r\n            var type = this._type;\r\n            //非二级节点取父节点方向\r\n            if (type !== 'both') {\r\n                orientation = type;\r\n            } else if (!this._mindNodeCore.getParent().isRoot()) {\r\n                orientation = this._mindNodeCore.getParent().getOrientation();\r\n            } else {\r\n                //二级节点取最新的方向\r\n                orientation = this._mindNodeCore.getOrientation();\r\n            }\r\n            var start, end, vector;\r\n\r\n            var abs = Math.abs;\r\n            var pathData = [];\r\n            var side = box.x > pBox.x ? \"right\" : \"left\";\r\n            //修正方向\r\n            if (orientation) {\r\n                side = orientation;\r\n            }\r\n            start = new kity.Point(side === 'left' ? pBox.left : pBox.right, pBox.cy);\r\n\r\n            end = side == \"left\" ? new kity.Point(box.right, box.cy) : new kity.Point(box.left, box.cy);\r\n\r\n\r\n            //解决：x坐标相同时，线条长度计算异常\r\n\r\n            if (Math.abs(start.x - end.x) <= 2) {\r\n                start.x = end.x;\r\n            }\r\n\r\n            vector = kity.Vector.fromPoints(start, end);\r\n            //保留五位小数点  \"1.4489043564935855e-7\"  防止出现这种计数法时，svg线条解析e-7时显示异常\r\n            vector.x = Utils.getFixedFloat(vector.x, 5);\r\n            vector.y = Utils.getFixedFloat(vector.y, 5);\r\n\r\n            //解决：x，线条长度计算异常\r\n            if (Math.abs(vector.x) <= 2.5) {\r\n                vector.x = 0;\r\n            }\r\n\r\n            //if(this._mindNodeCore.getNodeId()==='minder_node_8'){\r\n            //    console.log('line-ok',start,end,vector);\r\n            //}\r\n\r\n            pathData.push(\"M\", start);\r\n            //解决：x坐标相同时，线条长度计算异常\r\n            if (type === 'animate'\r\n                && childCount === 1\r\n                && (Math.abs(Math.floor(start.x) - Math.floor(end.x)) <= 2)\r\n                && (Math.abs(start.y - end.y) < 40)\r\n            ) {\r\n                pathData.push(\"A\", 0, 0, 0, 0, 0, start);\r\n            } else {\r\n                pathData.push(\"A\", abs(vector.x), abs(vector.y), 0, 0, vector.x * vector.y > 0 ? 0 : 1, end);\r\n            }\r\n            this.__getShape().setPathData(pathData);\r\n            this.__getShape().setStyle(_lineStyle.strokeStyle);\r\n\r\n\r\n            //if (strokeWidth % 2 === 0) {\r\n            //    connection.setTranslate(.5, .5);\r\n            //} else {\r\n            //    connection.setTranslate(0, 0);\r\n            //}\r\n        },\r\n        _getLayoutBox: function (node) {\r\n            var contentBox = node.getRenderBox();\r\n            var gloMatrix = new kity.Matrix();\r\n            return gloMatrix.transformBox(contentBox);\r\n        },\r\n        setParentShape: function () {\r\n\r\n        },\r\n        destroy: function () {\r\n\r\n        }\r\n    });\r\n\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var Utils = __M.Utils;\r\n    var Class = __M.Class;\r\n    var ID = __M.ID;\r\n\r\n    __M.View.FornVisibleImage = Class.BaseForeignObject({\r\n        _width: 50,\r\n        _height: 28,\r\n        create: function (parentSvgNode, nodeIndex) {\r\n            var instance = Object.create(this);\r\n            instance.__base($(Utils.Svg.addForeignObject(parentSvgNode, ID.getVisibleImageId(nodeIndex), 'mindMap_visible_img', 0, 0, this._width, this._height)));\r\n            instance.__setVisible(false);\r\n            return instance;\r\n        },\r\n        active:function(){\r\n            this.__$().find('.mindMap_visible_img').addClass('mindMap_visible_img_active');\r\n        },\r\n        revert:function(){\r\n            this.__$().find('.mindMap_visible_img').removeClass('mindMap_visible_img_active');\r\n        }\r\n    });\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/4/14.\r\n */\r\n(function (window, $, __M) {\r\n\r\n\r\n    var _nodeStyle = __M.Config.nodeStyle;\r\n    var Utils = __M.Utils;\r\n\r\n    var BaseView = __M.Class.BaseView;\r\n    var ID = __M.ID;\r\n\r\n    var regex = {\r\n        start: /^([\\s\\S]*?)<div>/,\r\n        middle: /<div>([\\s\\S]*?)<\\/div>/g,\r\n        end: /<\\/div>([\\s\\S]*)/,\r\n        br: /(.*?)<br\\/?>(.*)/\r\n    };\r\n\r\n    __M.View.MultipleText = BaseView({\r\n        _lineHeight: 22,\r\n        _$$texts: [],\r\n        create: function (nodeIdIndex, text) {\r\n            var instance = Object.create(this);\r\n            instance._$$texts = [];\r\n            instance.__base(new kity.Group().setId(ID.getTextGroupId(nodeIdIndex)).fill(_nodeStyle.groupColor).setAttr('transform', _nodeStyle.groupTransform));\r\n            //创建节点容器\r\n            instance._createNode(nodeIdIndex, text);\r\n            return instance;\r\n        },\r\n        _createNode: function (nodeIdIndex, text) {\r\n            //if (nodeIdIndex == 1) {\r\n            //    text = \"&lt;title&gt; - SVG | MDN<div>查看此网页的中文<br>翻译，请点击 翻译此页<\\/div>asdfasdf\";\r\n            //}\r\n            //添加此节点文本框,设置样式并居中处理\r\n            this.setText(text);\r\n        },\r\n        _createText: function (text, x, y) {\r\n            var $$text = new kity.Text().setStyle(_nodeStyle.textStyle).setContent(text).setAttr('x', 0).setAttr('y', y);\r\n            return $$text;\r\n        },\r\n        getText: function () {\r\n            var that = this;\r\n            var text = '';\r\n            that._$$texts.forEach(function ($$text, i) {\r\n                if (i === that._$$texts.length - 1) {\r\n                    text += $$text.getContent();\r\n                } else {\r\n                    text += $$text.getContent() + '<br>';\r\n                }\r\n            });\r\n            return text;\r\n        },\r\n        setText: function (text) {\r\n            this._$$texts.forEach(function ($$text) {\r\n                $$text.remove();\r\n            });\r\n            this._$$texts = [];\r\n            var lines = this._getTextSpan(text);\r\n            for (var i = 0; i < lines.length; i++) {\r\n                var $$text = this._createText(lines[i], 0, i * this._lineHeight);\r\n                this._$$texts.push($$text);\r\n                this.__addShape($$text);\r\n            }\r\n        },\r\n        _getTextSpan: function (text) {\r\n            //统一替换\r\n            text = text.replace(/<br\\/>/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n            //div 在行末和行首插入换行\r\n            text = text.replace(regex.middle, function ($1, $2) {\r\n                return '<br/>' + $2 + '<br/>';\r\n            });\r\n            //</div><div>这种情况只处理一个换行\r\n            text = text.replace(/<br\\/><br\\/>/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n            //统一替换\r\n            text = text.replace(/<br\\/>/g, function ($1, $2) {\r\n                return '<br>';\r\n            });\r\n            //替换掉末尾的换行\r\n            text = text.replace(/(<br>)*$/, function ($1, $2) {\r\n                return '';\r\n            });\r\n\r\n            var lines = text.split('<br>');\r\n\r\n            return lines;\r\n        },\r\n        getWidth: function () {\r\n            var width = 0;\r\n            this._$$texts.forEach(function ($$text) {\r\n                if ($$text.getWidth() > width) {\r\n                    width = $$text.getWidth();\r\n                }\r\n            });\r\n            return width;\r\n        },\r\n        getHeight: function () {\r\n            return this._lineHeight * this._$$texts.length;\r\n        },\r\n        destroy: function () {\r\n            this.__destroy();\r\n        }\r\n    });\r\n\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var Utils = __M.Utils;\r\n    var Base = __M.Class.Base;\r\n    var ID = __M.ID;\r\n\r\n    __M.View.SvgDelBtn = Base({\r\n        _$delBtn: null,\r\n        _eventDispatch: null,\r\n        _width: 40,\r\n        _height: 40,\r\n        create: function (parentSvgNode, nodeIdIndex) {\r\n            var instance = Object.create(this);\r\n            instance._append(parentSvgNode, nodeIdIndex);\r\n            return instance;\r\n        },\r\n        _append: function (parentSvgNode, nodeIdIndex) {\r\n            this._$delBtn = $(Utils.Svg.addForeignObject(parentSvgNode, ID.getDelBtnId(nodeIdIndex), 'mindMap_del', 0, 0, this._width, this._height));\r\n            this._$delBtn.hide();\r\n        },\r\n        setMatrix: function (matrix) {\r\n            this._$delBtn.attr('transform', 'matrix(' + matrix.m.a + ' ' + matrix.m.b + ' ' + matrix.m.c + ' ' + matrix.m.d + ' ' + matrix.m.e + ' ' + matrix.m.f + ')');\r\n        },\r\n        setVisible: function (visible) {\r\n            if (visible) {\r\n                this._$delBtn.show();\r\n            } else {\r\n                this._$delBtn.hide();\r\n            }\r\n        },\r\n        isVisible: function () {\r\n            return this._$delBtn.css('display') !== 'none';\r\n            //return this._$delBtn.is(':visible');\r\n        },\r\n        getWidth: function () {\r\n            return this._width;\r\n        },\r\n        getHeight: function () {\r\n            return this._height;\r\n        },\r\n        destroy: function () {\r\n\r\n        }\r\n    });\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var MENU_TYPE_KEY = __M.Config.MENU_TYPE_KEY;\r\n    var Utils = __M.Utils;\r\n    var Base = __M.Class.Base;\r\n\r\n\r\n    var menuRegex = /mindMap_menu_btn_([a-z]+)/;\r\n\r\n    __M.View.Menu = Base({\r\n        _$menu: null,\r\n        _clipboard: null,\r\n        _nodeText: null,\r\n        _option: null,\r\n        _scale: 1,\r\n        _eventInfos: [\r\n            {nodeEvent: false, key: KEY.MENU_SHOW, fucs: '_showHandler', params: ['触发显示的节点对象']},\r\n            {nodeEvent: false, key: KEY.DOM_HIDE, fucs: '_domHideHandler', params: []}\r\n        ],\r\n        _eventDispatch: null,\r\n        create: function (eventDispatch, $parent, clipboard, option) {\r\n            var instance = Object.create(this);\r\n            instance.__base(eventDispatch, instance._eventInfos);\r\n            instance._clipboard = clipboard;\r\n            instance._option = option;\r\n            instance._append($parent);\r\n            instance._bindEvent();\r\n            return instance;\r\n        },\r\n        _append: function ($target) {\r\n            var lang = this._option.langData;\r\n            var menuHtml = '';\r\n            menuHtml += '<div class=\"mindMap_rightkey_table mindMap_menu\">';\r\n            menuHtml += '<ul> <b class=\"mindMap_pf_spes\"><i></i></b>';\r\n            menuHtml += '<li class=\"mindMap_rightkey_tab_edit mindMap_menu_btn_edit\">';\r\n            menuHtml += '<a href=\"javascript:;\"> <i></i><em>' + lang['mdmenu_edit'] + '</em></a>';\r\n            menuHtml += '</li>';\r\n            menuHtml += '<li class=\"mindMap_rightkey_tab_hidecon mindMap_menu_btn_visible\">';\r\n            menuHtml += '<a href=\"javascript:;\"> <i></i><em>' + lang['mdmenu_invisible'] + '</em></a>';\r\n            menuHtml += '</li>';\r\n            menuHtml += '<li class=\"mindMap_rightkey_tab_copy mindMap_menu_btn_copy\">';\r\n            menuHtml += '<a href=\"javascript:;\"> <i></i><em>' + lang['mdmenu_copy'] + '</em></a>';\r\n            menuHtml += '</li>';\r\n            menuHtml += '<li class=\"mindMap_rightkey_tab_cut mindMap_menu_btn_cut\">';\r\n            menuHtml += '<a href=\"javascript:;\"> <i></i><em>' + lang['mdmenu_cut'] + '</em></a>';\r\n            menuHtml += '</li>';\r\n            menuHtml += '<li class=\"mindMap_rightkey_tab_paste mindMap_menu_btn_paste\">';\r\n            menuHtml += '<a href=\"javascript:;\"> <i></i><em>' + lang['mdmenu_paste'] + '</em></a>';\r\n            menuHtml += '</li>';\r\n            menuHtml += '<li class=\"mindMap_rightkey_tab_del mindMap_menu_btn_delete\">';\r\n            menuHtml += '<a href=\"javascript:;\"> <i></i><em>' + lang['mdmenu_delete'] + '</em></a>';\r\n            menuHtml += '</li>';\r\n            menuHtml += '</ul>';\r\n            menuHtml += '</div>';\r\n            $target.append(menuHtml);\r\n            this._$menu = $target.find('.mindMap_menu');\r\n        },\r\n        _showHandler: function (node) {\r\n            var that = this;\r\n            var lang = this._option.langData;\r\n            //缓存节点文本\r\n            that._nodeText = node.getText();\r\n            //获取节点线框\r\n            var rectPath = node.getRectPath();\r\n\r\n            //获取参照物为client的mindBody元素位置信息\r\n            var $mindBody = $('#' + that._option.mindBodyId)\r\n            var mindBodyClientRect = $mindBody[0].getBoundingClientRect();\r\n            var mindWidth = $mindBody.width();\r\n            var bodyScale = mindBodyClientRect.width / mindWidth;\r\n            var curElementClientRect = rectPath.node.getBoundingClientRect();\r\n            var pos = {\r\n                left: (curElementClientRect.left - mindBodyClientRect.left) / bodyScale,\r\n                top: ( curElementClientRect.top - mindBodyClientRect.top) / bodyScale,\r\n                subHeight: (mindBodyClientRect.bottom - curElementClientRect.bottom) / bodyScale\r\n            };\r\n\r\n            that.__setNodeId(node.getNodeId());\r\n\r\n            that._$menu.find('li').show();\r\n\r\n            //根节点不允许删除、隐藏\r\n            if (!node.getParent()) {\r\n                that._$menu.find('.mindMap_menu_btn_delete').hide();\r\n                that._$menu.find('.mindMap_menu_btn_visible').hide();\r\n            } else {\r\n                that._$menu.find('.mindMap_menu_btn_delete').show();\r\n                that._$menu.find('.mindMap_menu_btn_visible').show();\r\n            }\r\n\r\n\r\n            //不可编辑或者不可视时，不显示编辑按钮\r\n            if (node.getTextVisible()) {\r\n                that._$menu.find('.mindMap_menu_btn_visible em').text(lang['mdmenu_invisible']);\r\n                that._$menu.find('.mindMap_menu_btn_edit').show();\r\n\r\n                if (that._clipboard.isEmpty()) {\r\n                    that._$menu.find('.mindMap_menu_btn_paste').addClass('mindMap_click_disabled');\r\n                } else {\r\n                    that._$menu.find('.mindMap_menu_btn_paste').removeClass('mindMap_click_disabled');\r\n                }\r\n                if (that._nodeText === '') {\r\n                    that._$menu.find('.mindMap_menu_btn_copy').addClass('mindMap_click_disabled');\r\n                    that._$menu.find('.mindMap_menu_btn_cut').addClass('mindMap_click_disabled');\r\n                } else {\r\n                    that._$menu.find('.mindMap_menu_btn_copy').removeClass('mindMap_click_disabled');\r\n                    that._$menu.find('.mindMap_menu_btn_cut').removeClass('mindMap_click_disabled');\r\n                }\r\n            } else {\r\n                that._$menu.find('.mindMap_menu_btn_visible em').text(lang['mdmenu_visible']);\r\n                that._$menu.find('.mindMap_menu_btn_edit').hide();\r\n                that._$menu.find('.mindMap_menu_btn_copy').addClass('mindMap_click_disabled');\r\n                that._$menu.find('.mindMap_menu_btn_cut').addClass('mindMap_click_disabled');\r\n                that._$menu.find('.mindMap_menu_btn_paste').addClass('mindMap_click_disabled');\r\n            }\r\n            //内容为空,不可隐藏\r\n            if (that._nodeText === '') {\r\n                that._$menu.find('.mindMap_menu_btn_visible').addClass('mindMap_click_disabled');\r\n            } else {\r\n                that._$menu.find('.mindMap_menu_btn_visible').removeClass('mindMap_click_disabled');\r\n            }\r\n\r\n            //不可编辑，则不显示可视切换、编辑、剪切、黏贴按钮\r\n            if (!node.getContentEditAble()) {\r\n                that._$menu.find('.mindMap_menu_btn_edit').hide();\r\n                that._$menu.find('.mindMap_menu_btn_visible').hide();\r\n                that._$menu.find('.mindMap_menu_btn_cut').hide();\r\n                that._$menu.find('.mindMap_menu_btn_paste').hide();\r\n            }\r\n\r\n            //不可删除时，删除按钮无效\r\n            if (!node.getDeleteAble()) {\r\n                that._$menu.find('.mindMap_menu_btn_delete').hide();\r\n            }\r\n\r\n            //隐藏禁用的按钮\r\n            that._option.hideMenuItem.forEach(function (item) {\r\n                that._$menu.find('.mindMap_menu_btn_' + item).hide();\r\n            });\r\n\r\n            //菜单元素最终偏移的坐标（position：absolute)\r\n            var menuWidth = that._$menu.width();\r\n            var menuHeight = that._$menu.height();\r\n            var $spes = that._$menu.find('.mindMap_pf_spes');\r\n            var menuSpesHeight = $spes[0].getBoundingClientRect().height;\r\n            if (menuSpesHeight <= 0) {\r\n                menuSpesHeight = $spes.height();\r\n            }\r\n            var x = pos.left + ( curElementClientRect.width / bodyScale) / 2 - (menuWidth * that._scale) / 2;\r\n            var y = pos.top + (curElementClientRect.height / bodyScale) + Math.abs(menuSpesHeight * that._scale);\r\n\r\n            if (menuHeight > pos.subHeight && pos.top > pos.subHeight) {\r\n                $spes.addClass('top')\r\n                y = y - menuHeight * that._scale - curElementClientRect.height / bodyScale - Math.abs(menuSpesHeight * that._scale) * 2;\r\n            } else {\r\n                $spes.removeClass('top')\r\n            }\r\n\r\n            //设置居中显示\r\n            that._$menu.css({left: x + 'px', top: y + 'px'});\r\n            that._$menu.css('transform', 'scale(' + (this._scale >= 1 ? this._scale : 1) + ')');\r\n            that._$menu.show();\r\n        },\r\n        _domHideHandler: function () {\r\n            this._$menu.hide();\r\n        },\r\n        _bindEvent: function () {\r\n\r\n            var that = this;\r\n            //点击菜单项，发布菜单命令\r\n            this._$menu.on('mTap', function (e) {\r\n                e.preventDefault();\r\n                var srcElement = e.originalEvent.srcElement;\r\n                var $target = $(srcElement).closest('li');\r\n                var targetCls = $target.attr('class');\r\n                //置灰不能操作\r\n                if ($target.hasClass('mindMap_click_disabled')) {\r\n                    return;\r\n                }\r\n                var eventType = Utils.getValue(targetCls, menuRegex);\r\n                that._$menu.hide();\r\n                if (eventType === MENU_TYPE_KEY.DELETE) {\r\n                    that.__triggerEvent(KEY.DOM_HIDE);\r\n                }\r\n\r\n                that.triggerMenuClick(eventType, that._nodeText);\r\n            });\r\n\r\n            this._$menu.on('touchstart mousedown', function (e) {\r\n                var srcElement = e.originalEvent.srcElement;\r\n                var $target = $(srcElement).closest('li');\r\n                $target.addClass('active');\r\n            });\r\n\r\n            this._$menu.on('touchend touchcancel mouseup mouseleave', function () {\r\n                that._$menu.find('li').removeClass('active');\r\n            });\r\n\r\n            //阻止默认的弹出右键行为\r\n            this._$menu.on('contextmenu', function (e) {\r\n                e.preventDefault();\r\n            });\r\n\r\n\r\n        },\r\n        triggerMenuClick: function (eventType, nodeText) {\r\n            var that = this;\r\n\r\n            //复制内容到剪贴板\r\n            if (eventType === MENU_TYPE_KEY.COPY) {\r\n                that._clipboard.setData(nodeText, false);\r\n            }\r\n            if (eventType === MENU_TYPE_KEY.CUT) {\r\n                that._clipboard.setData(nodeText, true);\r\n            }\r\n\r\n            var text;\r\n            if (eventType === MENU_TYPE_KEY.PASTE) {\r\n                //复制\r\n                text = that._clipboard.getData();\r\n                if (text.length > 0) {\r\n                    that.__triggerNodeEvent(KEY.MENU_CLICK, eventType, text);\r\n                }\r\n            }\r\n            else if (eventType === MENU_TYPE_KEY.CUT) {\r\n                //剪切\r\n                that.__triggerNodeEvent(KEY.MENU_CLICK, eventType, '');\r\n            } else {\r\n                that.__triggerNodeEvent(KEY.MENU_CLICK, eventType);\r\n            }\r\n\r\n        },\r\n        setScale: function (scale) {\r\n            this._scale = scale;\r\n            if (this._scale < 1) {\r\n                this._scale = 1;\r\n            }\r\n            this._$menu.css('transform', 'scale(' + (this._scale >= 1 ? this._scale : 1) + ')');\r\n        },\r\n        setVisible: function (visible) {\r\n            if (visible) {\r\n                this._$menu.show();\r\n            } else {\r\n                this._$menu.hide();\r\n            }\r\n        },\r\n        destroy: function () {\r\n            this.__destroy();\r\n        }\r\n    });\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var CLASS_NAME = __M.Config.CLASS_NAME;\r\n    var _nodeStyle = __M.Config.nodeStyle;\r\n    var BaseView = __M.Class.BaseView;\r\n\r\n    __M.View.Placeholder = BaseView({\r\n        _$$rect: null,\r\n        _eventDispatch: null,\r\n        create: function ($parent, mindBodyId) {\r\n            var instance = Object.create(this);\r\n            var group = new kity.Group().setId(CLASS_NAME.MIND_PLACEHOLDER_CLASS + mindBodyId);\r\n            instance.__base(group);\r\n            var rect = new kity.Rect().setStyle(_nodeStyle.placeholderStyle);\r\n            instance._$$rect = rect;\r\n            rect.setWidth(100);\r\n            rect.setHeight(100);\r\n            group.addShape(rect);\r\n            instance.__base(group);\r\n            $parent.addShape(group);\r\n            instance.__hide();\r\n            return instance;\r\n        },\r\n        setVisible: function (visible) {\r\n            this.__getShape().setVisible(visible);\r\n        },\r\n        getRectShape: function () {\r\n            return this._$$rect;\r\n        },\r\n        setMatrix:function(matrix){\r\n            this.__getShape().setMatrix(matrix);\r\n        },\r\n        destroy: function () {\r\n            this.__remove();\r\n        }\r\n    });\r\n\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by Administrator on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var Logger = __M.Logger;\r\n    var DRAW_TYPE_KEY = __M.Config.DRAW_TYPE_KEY;\r\n\r\n    var _nodeStyle = __M.Config.nodeStyle;\r\n    var DOM_EVENT_TYPE = __M.Config.DOM_EVENT_TYPE;\r\n\r\n    var BaseView = __M.Class.BaseView;\r\n    var Plus = __M.View.Plus;\r\n    var ExpandTriangle = __M.View.ExpandTriangle;\r\n    var ID = __M.ID;\r\n    var MultipleText = __M.View.MultipleText;\r\n    var SvgDelBtn = __M.View.SvgDelBtn;\r\n    var FornVisibleImage = __M.View.FornVisibleImage;\r\n    var Utils = __M.Utils;\r\n\r\n    var _linePadding = 0;\r\n    var _delBtnPadding = 2.5;\r\n    var _plusPadding = 3;\r\n\r\n    __M.View.MindNode = BaseView({\r\n        _nodeStyle: null,\r\n        _rectPathNode: null,\r\n        _leftPlus: null,//左方向键\r\n        _rightPlus: null,//右方向键\r\n        _leftExpandTriangle: null,\r\n        _rightExpandTriangle: null,\r\n        _fornVisibleImage: null,\r\n        _nodeLevel: null,\r\n        _expand: null,//收起展开\r\n        _mindNodeCore: null,//mindnodecore\r\n        _multipleText: null,//多行文本\r\n        _delBtn: null,//删除按钮\r\n        _minWidth: _nodeStyle.width,\r\n        _minHeight: _nodeStyle.height,\r\n        _paddingX: _nodeStyle.paddingX,\r\n        _paddingY: _nodeStyle.paddingY,\r\n        _option: null,\r\n        create: function (nodeId, nodeIdIndex, eventDispatch, mindNodeCore, text) {\r\n            var ins = Object.create(this);\r\n            //创建节点容器\r\n            var g = new kity.Group().setId(nodeId);\r\n            if (!mindNodeCore.isRoot()) {\r\n                g.setAttr('status', 'creating');\r\n            }\r\n            ins.__base(eventDispatch, nodeId, g);\r\n            ins._nodeLevel = mindNodeCore.getLevel();\r\n            ins._mindNodeCore = mindNodeCore;\r\n            ins._option = mindNodeCore.getOption();\r\n            if (mindNodeCore.isRoot()) {\r\n                if (ins._option.rootVertical) {\r\n                    ins._minWidth = ins._option.rootMinWidth;\r\n                    ins._paddingX = ins._option.rootPaddingX;\r\n                    ins._paddingY = ins._option.rootPaddingY;\r\n                }\r\n            }\r\n            ins._createNode(ins._nodeLevel, nodeIdIndex, text);\r\n            return ins;\r\n        },\r\n        bringTop: function () {\r\n            this.__getShape().bringTop();\r\n        },\r\n        _createNode: function (nodeLevel, nodeIdIndex, text) {\r\n            //创建文本框\r\n            this._createTextNode(nodeLevel, nodeIdIndex, text);\r\n\r\n            //创建左右两侧扩展\r\n            this._createExpandNode(nodeIdIndex, nodeLevel);\r\n\r\n            //创建左右两侧加号\r\n            this._createPlusNode(nodeIdIndex, nodeLevel);\r\n\r\n            //创建隐藏图标\r\n            this._createInvisibleImage(nodeIdIndex);\r\n\r\n            //创建删除按钮\r\n            this._delBtn = SvgDelBtn.create(this.__getShape().node, nodeIdIndex);\r\n\r\n            //创建星号\r\n            if (this._mindNodeCore.getRequireChildren()) {\r\n                this._createRequireStarText();\r\n            }\r\n        },\r\n        getLayoutBox: function () {\r\n            var contentBox = this.__getShape().getRenderBox();\r\n            //修正盒子信息，移除删除按钮的影响\r\n            if (this._delBtn.isVisible()) {\r\n                contentBox.cy = contentBox.cy + this._delBtn.getHeight() / 2 + _delBtnPadding / 2;\r\n                contentBox.height = contentBox.height - this._delBtn.getHeight() - _delBtnPadding;\r\n                contentBox.top = contentBox.top + this._delBtn.getHeight() + _delBtnPadding;\r\n                contentBox.y = contentBox.y + this._delBtn.getHeight() + _delBtnPadding;\r\n                if (this._option.remarkVisible && (this._option.remarkEditAble || this._getMindNode().rtGetRemark() !== '')) {\r\n                    contentBox.width = contentBox.width - this._delBtn.getHeight();\r\n                    contentBox.cx = contentBox.width - this._delBtn.getHeight();\r\n                    contentBox.x = contentBox.x + this._delBtn.getHeight();\r\n                }\r\n\r\n            }\r\n            var gloMatrix = new kity.Matrix();\r\n            return gloMatrix.transformBox(contentBox);\r\n        },\r\n        _createRequireStarText: function () {\r\n            this._starText = new kity.Text('*').fill('red').setStyle({fontSize: '20px'});\r\n            this.__addShape(this._starText);\r\n        },\r\n        _createExpandNode: function (nodeIdIndex, nodeLevel) {\r\n            this._leftExpandTriangle = ExpandTriangle.create(nodeIdIndex, nodeLevel, this.__getEventDispatch(), 'left');\r\n            this._rightExpandTriangle = ExpandTriangle.create(nodeIdIndex, nodeLevel, this.__getEventDispatch(), 'right');\r\n            this.__addShape(this._leftExpandTriangle.__getShape());\r\n            this.__addShape(this._rightExpandTriangle.__getShape());\r\n            this._leftExpandTriangle.__hide();\r\n            this._rightExpandTriangle.__hide();\r\n        },\r\n        _createPlusNode: function (nodeIdIndex) {\r\n            this._leftPlus = Plus.create(nodeIdIndex, this.__getEventDispatch(), 'left', this._option);\r\n            this._rightPlus = Plus.create(nodeIdIndex, this.__getEventDispatch(), 'right', this._option);\r\n            this.__addShape(this._leftPlus.__getShape());\r\n            this.__addShape(this._rightPlus.__getShape());\r\n            this._leftPlus.__hide();\r\n            this._rightPlus.__hide();\r\n        },\r\n        _createTextNode: function (nodeLevel, nodeIdIndex, text) {\r\n            //获取该节点的样式\r\n            var nodeStyle = this._nodeStyle = _nodeStyle,\r\n                nodeWidth = this._minWidth,\r\n                lang = this._option.langData,\r\n                nodeHeight = this._minHeight;\r\n\r\n            //添加此节点外框\r\n            var rect = this._rectPathNode = new kity.Rect().setId(ID.getTextBorderId(nodeIdIndex));\r\n\r\n            rect.setSize(nodeWidth, nodeHeight)\r\n                .setRadius(nodeStyle.radius)\r\n                .fill(nodeStyle.fill)\r\n                .setStyle(nodeStyle.strokeStyle);\r\n            this.__addShape(rect);\r\n\r\n            var txt = nodeLevel > 1 ? lang['mdnode_branchname'] : lang['mdnode_centralname'];\r\n            if (typeof text != 'undefined') {\r\n                txt = text;\r\n            }\r\n\r\n            this._multipleText = MultipleText.create(nodeIdIndex, txt);\r\n            this.__addShape(this._multipleText.__getShape());\r\n\r\n        },\r\n        _createInvisibleImage: function (nodeIdIndex) {\r\n            this._fornVisibleImage = FornVisibleImage.create(this.__getShape().node, nodeIdIndex);\r\n            this._fornVisibleImage.__setVisible(!this._mindNodeCore.getTextVisible());\r\n        },\r\n        setVisibleImageActive: function (active) {\r\n            if (active) {\r\n                this._fornVisibleImage.active();\r\n            } else {\r\n                this._fornVisibleImage.revert();\r\n            }\r\n        },\r\n        getText: function () {\r\n            return this._multipleText.getText();\r\n        },\r\n        setText: function (text) {\r\n            this._multipleText.setText(text);\r\n        },\r\n        getTextNode: function () {\r\n            return this._multipleText.__getShape();\r\n        },\r\n        getRectPathWidth: function () {\r\n            return this._rectPathNode.getWidth();\r\n        },\r\n        getRectPathHeight: function () {\r\n            return this._rectPathNode.getHeight();\r\n        },\r\n        getRectPath: function () {\r\n            return this._rectPathNode;\r\n        },\r\n        updateRectPathFill: function () {\r\n            if (this._mindNodeCore.getRequireChildren() && this._option.showRequireFill) {\r\n                if (this._mindNodeCore.getChildren().length > 0) {\r\n                    this._rectPathNode.fill(this._nodeStyle.requireCompletedFill);\r\n                } else {\r\n                    this._rectPathNode.fill(this._nodeStyle.fill);\r\n                }\r\n            }\r\n        },\r\n        draw: function (type, data) {\r\n            var type = type || '';\r\n            var node = this._getMindNode();\r\n            switch (type) {\r\n                case DRAW_TYPE_KEY.INIT:\r\n                    //重新计算布局左右两侧三角按钮\r\n                    this._expandTriangle(data && data.orientation);\r\n                    break;\r\n                case DRAW_TYPE_KEY.MOVE:\r\n                    this.__getShape().translate(data.x, data.y);\r\n                    this._leftPlus.__hide();\r\n                    this._rightPlus.__hide();\r\n                    if (!node.isRoot()) {\r\n                        this._leftExpandTriangle.__hide();\r\n                        this._rightExpandTriangle.__hide();\r\n                        this._delBtn.setVisible(false);\r\n                    }\r\n                    break;\r\n                case DRAW_TYPE_KEY.ACTIVE_EDIT_DISABLE:\r\n                    //显示激活状态\r\n                    this._rectPathNode.setStyle(this._nodeStyle.activeStrokeStyle);\r\n                    this._leftPlus.__hide();\r\n                    this._rightPlus.__hide();\r\n                    this._leftExpandTriangle.updateHalfLine(false);\r\n                    this._rightExpandTriangle.updateHalfLine(false);\r\n                    this._delBtn.setVisible(false);\r\n                    break;\r\n                case DRAW_TYPE_KEY.ACTIVE:\r\n                    //显示激活状态\r\n                    this._rectPathNode.setStyle(this._nodeStyle.activeStrokeStyle);\r\n                    if (node.isRoot()) {\r\n                        var option = node.getOption();\r\n                        if (option.type === 'both' || option.type === 'left') {\r\n                            this._leftPlus.__show();\r\n                        }\r\n                        if (option.type === 'both' || option.type === 'right') {\r\n                            this._rightPlus.__show();\r\n                        }\r\n                        this._leftExpandTriangle.updateHalfLine(true);\r\n                        this._rightExpandTriangle.updateHalfLine(true);\r\n                    } else {\r\n                        if (data.eventType === DOM_EVENT_TYPE.TOUCH && node.getDeleteAble()) {\r\n                            this._delBtn.setVisible(true);\r\n                        }\r\n\r\n                        var orientation = node.getOrientation();\r\n                        if (data && data.orientation) {\r\n                            orientation = data.orientation;\r\n                        }\r\n\r\n                        if (orientation === 'left') {\r\n                            this._leftPlus.__show();\r\n                            this._rightPlus.__hide();\r\n                            this._leftExpandTriangle.updateHalfLine(true);\r\n                            this._rightExpandTriangle.updateHalfLine(false);\r\n                        } else {\r\n                            this._leftPlus.__hide();\r\n                            this._rightPlus.__show();\r\n                            this._leftExpandTriangle.updateHalfLine(false);\r\n                            this._rightExpandTriangle.updateHalfLine(true);\r\n                        }\r\n                    }\r\n                    break;\r\n                case DRAW_TYPE_KEY.REVERT:\r\n                    //恢复非激活状态\r\n                    this._rectPathNode.setStyle(this._nodeStyle.strokeStyle);\r\n                    this._leftPlus.__hide();\r\n                    this._rightPlus.__hide();\r\n                    this._leftExpandTriangle.updateHalfLine(false);\r\n                    this._rightExpandTriangle.updateHalfLine(false);\r\n                    this._delBtn.setVisible(false);\r\n                    break;\r\n                case DRAW_TYPE_KEY.TEXT:\r\n                    //文本变化，重新布局\r\n                    if (typeof data.text !== 'undefined') {\r\n                        this.setText(data.text);\r\n                    }\r\n                    if (node.getTextVisible()) {\r\n                        this._fornVisibleImage.__setVisible(false);\r\n                        this._multipleText.__show();\r\n                    } else {\r\n                        this._fornVisibleImage.__setVisible(true);\r\n                        this._multipleText.__hide();\r\n                    }\r\n                    this.reLayout();\r\n                    break;\r\n            }\r\n        },\r\n        isActive: function () {\r\n            return this._rectPathNode.node.style.stroke === this._nodeStyle.activeStrokeStyle.stroke.toRGB();\r\n        },\r\n        _expandTriangle: function (dataOrientation) {\r\n            var node = this._getMindNode();\r\n            var isRoot = node.isRoot();\r\n            var isExpand = node.isExpand();\r\n            var orientation = node.getOrientation();\r\n            var isLeaf = node.isLeaf();\r\n\r\n\r\n            //优先使用外部传入参数\r\n            if (dataOrientation) {\r\n                orientation = dataOrientation;\r\n            }\r\n\r\n            if (node.getLevel() === 2) {\r\n                orientation = node.getOrientation();\r\n            }\r\n\r\n            //根节点优先使用自身\r\n            if (isRoot) {\r\n                orientation = node.getChildOrientation();\r\n            }\r\n\r\n            //左右两侧三角按钮是否显示\r\n            if (!isLeaf) {\r\n\r\n                if (orientation === 'both') {\r\n                    this._leftExpandTriangle.__show();\r\n                    this._rightExpandTriangle.__show();\r\n                } else if (orientation === 'left') {\r\n                    this._leftExpandTriangle.__show();\r\n                    this._rightExpandTriangle.__hide();\r\n                } else if (orientation === 'right') {\r\n                    this._leftExpandTriangle.__hide();\r\n                    this._rightExpandTriangle.__show();\r\n                }\r\n            } else {\r\n                //叶子节点，隐藏两侧\r\n                this._leftExpandTriangle.__hide();\r\n                this._rightExpandTriangle.__hide();\r\n            }\r\n\r\n            //非根节点左右两侧内三角按钮朝向\r\n            if (!isRoot) {\r\n                if (orientation === 'left') {\r\n                    this._leftExpandTriangle.update(isExpand);\r\n                } else if (orientation === 'right') {\r\n                    this._rightExpandTriangle.update(isExpand);\r\n                }\r\n                if (node.getTextVisible()) {\r\n                    this._fornVisibleImage.__setVisible(false);\r\n                    this._multipleText.__show();\r\n                } else {\r\n                    this._fornVisibleImage.__setVisible(true);\r\n                    this._multipleText.__hide();\r\n                }\r\n            }\r\n\r\n        },\r\n        getTriangleFullWidth: function () {\r\n            return this._leftExpandTriangle.getFullWidth() + _linePadding * 2;\r\n        },\r\n        //根节点，获取单个方向上的宽\r\n        getOrientationFullWidth: function () {\r\n            return this._rightExpandTriangle.getFullWidth() + this._rectPathNode.getWidth() + _linePadding * 2;\r\n        },\r\n        animateToPos: function (x, y, drawing, finish) {\r\n            var that = this;\r\n            var matrix = this.__getShape().getTransform();\r\n            var targetMatrix = new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, x, y);\r\n            return this.__animator({\r\n                startVal: this.__getShape().getTransform(),\r\n                finishVal: targetMatrix,\r\n                draw: function (target, value) {\r\n                    target.setMatrix(value);\r\n                    drawing && drawing();\r\n                },\r\n                finish: function () {\r\n                    that.__getShape().setAttr('status', 'init');\r\n                    finish && finish();\r\n                }\r\n            });\r\n        },\r\n        setMatrix: function (matrix) {\r\n            this.__getShape().setMatrix(matrix);\r\n            this.__getShape().setAttr('status', 'init');\r\n        },\r\n        moveToPos: function (x, y) {\r\n            var matrix = this.__getShape().getTransform();\r\n            var targetMatrix = new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, x, y);\r\n            this.__getShape().setMatrix(targetMatrix);\r\n            this.__getShape().setAttr('status', 'init');\r\n        },\r\n        //文本的居中处理\r\n        reLayout: function () {\r\n            //获取文本实际大小\r\n            var subWidth = 0,//文字不满一个空格时，居中处理\r\n                minWidth = this._minWidth,\r\n                paddingX = this._paddingX,\r\n                paddingY = this._paddingY,\r\n                requireChildren = this._mindNodeCore.getRequireChildren(),\r\n                textStyle = this._multipleText.__getShape().getRenderBox(),\r\n                //重置节点大小\r\n                width = textStyle.width + paddingX * 2,\r\n                height = textStyle.height + paddingY * 2,\r\n                starBox = null,\r\n                node = this._getMindNode(),\r\n                showStar = (requireChildren && this._option.showRequireStar) && !node.isRoot();\r\n\r\n            //限制最小宽度为60\r\n            if (width < minWidth) {\r\n                width = minWidth;\r\n                subWidth = (width - textStyle.width - paddingX * 2) / 2\r\n            }\r\n\r\n            //限制最小高度\r\n            if (height < _nodeStyle.height) {\r\n                height = _nodeStyle.height;\r\n            }\r\n\r\n            if (showStar && !this._starText) {\r\n                this._createRequireStarText();\r\n            }\r\n\r\n            if (this._starText) {\r\n                this._starText.setVisible(showStar);\r\n                if (showStar) {\r\n                    starBox = this._starText.getRenderBox();\r\n                }\r\n            }\r\n\r\n            //获取最新大小\r\n            var rectBox;\r\n            var matrix;\r\n            if (this._getMindNode().getTextVisible()) {\r\n\r\n                this._rectPathNode.setWidth(width);\r\n\r\n                this._rectPathNode.setHeight(height);\r\n                rectBox = this._rectPathNode.getRenderBox();\r\n                matrix = this._rectPathNode.getTransform();\r\n            } else {\r\n                //图片处理\r\n                var imageWidth = this._fornVisibleImage.__getWidth(), imageHeight = this._fornVisibleImage.__getHeight();\r\n                //恢复初始宽高\r\n                this._rectPathNode.setWidth(minWidth);\r\n                this._rectPathNode.setHeight(_nodeStyle.height);\r\n                rectBox = this._rectPathNode.getRenderBox();\r\n                matrix = this._rectPathNode.getTransform();\r\n                this._fornVisibleImage.__setMatrix(new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, rectBox.cx - imageWidth / 2, rectBox.cy - imageHeight / 2));\r\n            }\r\n            var textMatrix;\r\n            if (Utils.isMobile) {\r\n                //计算文本框大小 +1.5处理上下居中问题\r\n                textMatrix = new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, matrix.m.e + paddingX + subWidth, matrix.m.f + paddingY + 2.5);\r\n                this._multipleText.__getShape().setMatrix(textMatrix);\r\n            } else {\r\n                //计算文本框大小 +1.5处理上下居中问题\r\n                textMatrix = new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, matrix.m.e + paddingX + subWidth, matrix.m.f + paddingY + 1);\r\n                this._multipleText.__getShape().setMatrix(textMatrix);\r\n            }\r\n\r\n\r\n            //星号处理\r\n            if (this._starText && showStar) {\r\n                var startMatrix = new kity.Matrix(1, 0, 0, 1, textMatrix.m.e - starBox.width, textMatrix.m.f + starBox.height / 2 + 7);\r\n                this._starText.setMatrix(startMatrix)\r\n            }\r\n\r\n            //左右两侧加号位置处理\r\n            var leftPlusMatrix = new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, rectBox.left - this._leftPlus.getVisibleWidth() / 2 - _plusPadding, rectBox.cy);\r\n            this._leftPlus.__getShape().setMatrix(leftPlusMatrix);\r\n            this._rightPlus.__getShape().setMatrix(new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, rectBox.right + this._rightPlus.getVisibleWidth() / 2 + _plusPadding, rectBox.cy));\r\n\r\n            //重新定位左右两侧的三角和线\r\n            this._leftExpandTriangle.__getShape().setMatrix(new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, rectBox.left - this._leftExpandTriangle.getFullWidth() - _linePadding, rectBox.cy));\r\n            this._rightExpandTriangle.__getShape().setMatrix(new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, rectBox.right + _linePadding, rectBox.cy));\r\n\r\n            //删除按钮位置处理\r\n            if (this._option.remarkVisible && (this._option.remarkEditAble || node.rtGetRemark() !== '')) {\r\n                this._delBtn.setMatrix(new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, rectBox.left - this._delBtn.getWidth(), rectBox.top - this._delBtn.getHeight() - _delBtnPadding));\r\n            } else {\r\n                this._delBtn.setMatrix(new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, rectBox.cx - this._delBtn.getWidth() / 2, rectBox.top - this._delBtn.getHeight() - _delBtnPadding));\r\n            }\r\n        },\r\n        _getMindNode: function () {\r\n            return this._mindNodeCore;\r\n        },\r\n        destroy: function () {\r\n            this.__destroy();\r\n        }\r\n    });\r\n\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/6/28.\r\n */\r\n\r\n(function (window, $, __M) {\r\n\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var Base = __M.Class.Base;\r\n    var Logger = __M.Logger;\r\n    var Utils = __M.Utils;\r\n\r\n\r\n    __M.View.EditTextArea = Base({\r\n        _text: '',\r\n        _minWidth: 8,\r\n        _html: '<textarea  class=\"mindMap_receiver mindMap_input\" data-maxwidth=\"\" data-minwidth=\"\" data-minheight=\"\" Keyboard-Offset-Y=\"75\" style=\"\" maxlength=\"160\"></textarea><div class=\" mindMap_receiver_shadow\" contenteditable=\"plaintext-only\"></div>',\r\n        _$receiver: null,\r\n        _$shadow: null,\r\n        _clipboard: null,\r\n        _scale: 1,\r\n        _eventsInfo: [\r\n            {nodeEvent: false, key: KEY.EDITTEXT_CHANGE_NODE, fucs: '_changePositionHandler', params: ['触发节点id', '显示x坐标', '显示y坐标', 'node']},\r\n            {nodeEvent: false, key: KEY.EDITTEXT_SHOW, fucs: '_showHandler', params: ['触发节点id', '显示x坐标', '显示y坐标']},\r\n            {nodeEvent: false, key: KEY.DOM_HIDE, fucs: '_domHideHandler', params: [ '是否需要动画绘制、默认true,除非传入false']}\r\n        ],\r\n        create: function (eventDispatch, $parent, clipboard, option) {\r\n            var instance = Object.create(this);\r\n            instance.__base(eventDispatch, instance._eventsInfo);\r\n            instance._option = option;\r\n            //添加到节点\r\n            instance._append($parent);\r\n            //绑定事件监听\r\n            instance._bindEvent();\r\n            instance._clipboard = clipboard;\r\n            return instance;\r\n        },\r\n        _bindEvent: function () {\r\n            var that = this;\r\n            that._$receiver.autogrow({\r\n                vertical: true,\r\n                horizontal: true,\r\n                flickering: true,\r\n                body: $('#' + that._option.mindBodyId)[0]\r\n                // , debugx: 10\r\n                // , debugy: 20\r\n            });\r\n        },\r\n        isVisible: function () {\r\n            return this._$receiver.css('display') !== 'none';\r\n        },\r\n        _changePositionHandler: function (nodeId, x, y) {\r\n\r\n            //当前显示并隐藏时，触发更新上一个节点文本事件\r\n            if (this.isVisible()) {\r\n                this.__triggerNodeEvent(KEY.NODE_TEXT_CHANGE, this.getText());\r\n            }\r\n            //设置基类当前新节点id\r\n            this.__setNodeId(nodeId);\r\n            //失去焦点\r\n            this._$receiver.hide();\r\n            this._$receiver.css({left: x + 2 + 'px', top: y + 4 + 'px'});\r\n            this._$receiver.blur();\r\n        },\r\n        _showHandler: function (text, nodeId, x, y) {\r\n            //获取一行的高度\r\n            if (!this._minHeight) {\r\n                this._$shadow.html('shadow');\r\n                this._minHeight = this._$shadow.height();\r\n                this._$receiver.attr('data-minheight', this._minHeight + 'px');\r\n            }\r\n\r\n\r\n            //获取完整的宽高信息\r\n            var text = Utils.String.getTextLfToBr(text).replace(/&nbsp;/g, ' ');\r\n            this._$shadow.html(text);\r\n            var width = (this._$shadow.width() || 10) + 3.5;\r\n            var height = this._$shadow.height();\r\n\r\n            //居中处理\r\n            var top = Utils.isMobile ? (y + 2) : (y + 4);\r\n            this._$receiver.css({left: x + 2 + 'px', top: top + 'px', width: width + 'px', height: height + 'px'});\r\n\r\n\r\n            var svgScale = (this._scale >= 1 ? this._scale : 1)\r\n\r\n            this._$receiver.attr('data-minwidth', width + 'px');\r\n            this._$receiver.css('transform', 'scale(' + svgScale + ')');\r\n            this._$shadow.css('transform', 'scale(' + svgScale + ')');\r\n\r\n            this._$receiver.show();\r\n            var offset = this._$receiver.offset();\r\n            var parent = this._$receiver.parent();\r\n            var offsetParent = parent.offset();\r\n            var parentWidth = parent.width();\r\n\r\n            var cssMaxWidth = parseInt(this._$receiver.css('maxWidth'));\r\n            var scale = this._$receiver[0].getBoundingClientRect().width / (this._$receiver.outerWidth() * svgScale);\r\n            //计算出原始坐标系的宽度\r\n            var maxWidth = (parentWidth - ( (offset.left - offsetParent.left) / scale ) - 15 * svgScale) / svgScale;\r\n            this._$receiver.attr('data-scale', svgScale);\r\n            if (maxWidth < cssMaxWidth) {\r\n                this._$receiver.attr('data-maxwidth', maxWidth);\r\n            } else {\r\n                this._$receiver.attr('data-maxwidth', '');\r\n            }\r\n            this.setText(text);\r\n            this._$receiver.trigger('input')\r\n            //默认文本时需要全选\r\n            var lang = this._option.langData;\r\n            var needSelectAll = lang['mdnode_centralname'] === text || lang['mdnode_branchname'] === text;\r\n\r\n            if (needSelectAll) {\r\n                this._$receiver.select();\r\n            } else {\r\n                this._toLastWord(this._$receiver);\r\n            }\r\n        },\r\n        _toLastWord: function (receiver) {\r\n            receiver.focus();\r\n            var len = receiver.val().length;\r\n            if (document.selection) {\r\n                var sel = receiver[0].createTextRange();\r\n                sel.moveStart('character', len);\r\n                sel.collapse();\r\n                sel.select();\r\n            } else if (typeof receiver[0].selectionStart == 'number' && typeof receiver[0].selectionEnd == 'number') {\r\n                receiver[0].selectionStart = receiver[0].selectionEnd = len;\r\n            }\r\n        },\r\n        setScale: function (scale) {\r\n            this._scale = scale;\r\n            if (this._scale < 1) {\r\n                this._scale = 1;\r\n            }\r\n            this._$receiver.css('transform', 'scale(' + (this._scale >= 1 ? this._scale : 1) + ')');\r\n        },\r\n        _domHideHandler: function (animateLayout) {\r\n            animateLayout = typeof  animateLayout === 'undefined' ? true : animateLayout;\r\n            //触发节点失去焦点事件\r\n            //当前显示并隐藏时，触发更新节点文本事件\r\n            if (this.isVisible()) {\r\n                this.__triggerNodeEvent(KEY.NODE_TEXT_CHANGE, this.getText(), animateLayout);\r\n            }\r\n            this._$receiver.blur();\r\n            this._$receiver.hide();\r\n        },\r\n        _append: function ($target) {\r\n            $target.append(this._html);\r\n            this._$shadow = $target.find('.mindMap_receiver_shadow');\r\n            this._$receiver = $target.find('.mindMap_receiver');\r\n        },\r\n        setText: function (text) {\r\n            text = Utils.String.getTextBrToLf(text);\r\n            text = text.replace(/&nbsp;/g, ' ');\r\n            this._$receiver.val(text);\r\n            return this;\r\n        },\r\n        getText: function () {\r\n            var text = this._$receiver.val();\r\n            text = Utils.String.getTextLfToBr(text);\r\n            //移除空格\r\n            text = text.replace(/&nbsp;/g, ' ');\r\n            return text;\r\n        },\r\n        setVisible: function (visible) {\r\n            if (visible) {\r\n                this._$receiver.show();\r\n            } else {\r\n                this._$receiver.hide();\r\n            }\r\n        },\r\n        destroy: function () {\r\n            this.__destroy();\r\n        }\r\n    });\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/30.\r\n */\r\n(function (window, $, __M) {\r\n\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var Base = __M.Class.Base;\r\n\r\n    __M.View.Remark = Base({\r\n        _$view: null,\r\n        _$input: null,\r\n        _$parent: null,\r\n        _clipboard: null,\r\n        _nodeText: null,\r\n        _option: null,\r\n        _scale: 1,\r\n        _eventInfos: [\r\n            {nodeEvent: false, key: KEY.REMARK_SHOW, fucs: '_showHandler', params: ['触发显示的节点对象', 'visible']},\r\n            {nodeEvent: false, key: KEY.DOM_HIDE, fucs: '_domHideHandler', params: []}\r\n        ],\r\n        _eventDispatch: null,\r\n        create: function (eventDispatch, $parent, option) {\r\n            var instance = Object.create(this);\r\n            instance.__base(eventDispatch, instance._eventInfos);\r\n            instance._option = option;\r\n            instance._$parent = $parent;\r\n            instance._append($parent);\r\n            instance._bindEvent();\r\n            return instance;\r\n        },\r\n        _append: function ($target) {\r\n            var html = '<div class=\"mindMap_remark mindmap-tips-edit\"><input data-minwidth=\"80\" class=\"tip-txt\" type=\"text\" maxlength=\"300\" value=\"\"></div>';\r\n            $target.append(html);\r\n            this._$view = $target.find('.mindMap_remark');\r\n            this._$input = this._$view.find('input');\r\n        },\r\n        _showHandler: function (node, visible) {\r\n            if (!visible || (node && this._option.remarkEditAble === false && node.rtGetRemark() === '')) {\r\n                this._domHideHandler(undefined, true)\r\n                return;\r\n            }\r\n            if (!node || node.isRoot()) {\r\n                return;\r\n            }\r\n            var that = this,\r\n                $view = this._$view,\r\n                $container = this._$parent,\r\n                containerRect = $container[0].getBoundingClientRect(),\r\n                containerScale = containerRect.width / $container.outerWidth(),\r\n                curElementClientRect = node.getRectPath().node.getBoundingClientRect(),\r\n                x,\r\n                y,\r\n                svgScale = this._scale,\r\n                paddingLeft = parseInt($view.css('paddingLeft')),\r\n                paddingRight = parseInt($view.css('paddingRight'))\r\n\r\n            this._node = node;\r\n\r\n\r\n            //求出容器内坐标距离\r\n            var pos = {\r\n                left: (curElementClientRect.left - containerRect.left) / containerScale,\r\n                top: parseInt(( curElementClientRect.top - containerRect.top) / containerScale)\r\n            };\r\n\r\n            var maxWidth = (containerRect.width - (curElementClientRect.left - containerRect.left) - 15  );\r\n            this._$input.attr('data-scale', svgScale);\r\n            this._$input.attr('data-maxwidth', maxWidth / ( svgScale * containerScale) - paddingLeft - paddingRight);\r\n            x = pos.left;\r\n            y = parseInt(pos.top - this._$view.height() * svgScale - 10 * svgScale);\r\n            that.__setNodeId(node.getNodeId());\r\n\r\n            //设置居中显示\r\n            that._$view.css({left: x + 'px', top: y + 'px'});\r\n            that._$view.css('transform', 'scale(' + this._scale + ')');\r\n            this._$input.val(node.rtGetRemark());\r\n            this._$input.trigger('input');\r\n            that._$view.show();\r\n        },\r\n        _domHideHandler: function (animateLayout, forceHide) {\r\n            if (!this._node || !this._node.isActive() || forceHide) {\r\n                this._$view.hide();\r\n                this._$view.blur();\r\n            }\r\n        },\r\n        getText: function () {\r\n            return this._$input.val().trim();\r\n        },\r\n        _changePositionHandler: function (nodeId, x, y, node) {\r\n            if (this.isVisible() && this._node) {\r\n                this._node.rtSetRemark(this.getText())\r\n                this._node = null\r\n            }\r\n        },\r\n        _bindEvent: function () {\r\n            var that = this;\r\n            this._$input.autogrow({\r\n                class: 'remark_auto',\r\n                vertical: false,\r\n                horizontal: true,\r\n                flickering: true,\r\n                addWidth: 1,\r\n                body: $('#' + that._option.mindBodyId)[0]\r\n                // , debugx: 10\r\n                // , debugy: 20\r\n            });\r\n            //点击菜单项，发布菜单命令\r\n            this._$view.on('mousedown touchstart', function (e) {\r\n                // e.preventDefault();\r\n                that.__triggerEvent(KEY.EDITTEXT_CHANGE_NODE, that._node.getNodeId(), 0, 0, this);\r\n            });\r\n            this._$input.on('input', function (e) {\r\n                if (that._node) {\r\n                    that._node.rtSetRemark(that.getText());\r\n                }\r\n            })\r\n            if (!that._option.remarkEditAble) {\r\n                that._$input.attr('disabled', 'disabled');\r\n            }\r\n        },\r\n        isVisible: function () {\r\n            return this._$view.css('display') !== 'none';\r\n        },\r\n        setScale: function (scale) {\r\n            this._scale = scale;\r\n            this._$view.css('transform', 'scale(' + this._scale + ')');\r\n        },\r\n        setVisible: function (visible) {\r\n            if (visible) {\r\n                this._$view.show();\r\n            } else {\r\n                this._$view.hide();\r\n            }\r\n        },\r\n        destroy: function () {\r\n            this.__destroy();\r\n        }\r\n    });\r\n\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n    'use strict';\r\n\r\n    var Base = __M.Class.Base;\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var Utils = __M.Utils;\r\n    var DRAW_TYPE_KEY = __M.Config.DRAW_TYPE_KEY;\r\n    var CHANGE_REASON = __M.Config.CHANGE_REASON;\r\n    var ID = __M.ID;\r\n\r\n    //连线\r\n    var ConnectLine = __M.View.ConnectLine;\r\n    var MindNode = __M.View.MindNode;\r\n    var Logger = __M.Logger;\r\n    var _nodeStyle = __M.Config.nodeStyle;\r\n\r\n    var NodePosition = {\r\n        create: function (option) {\r\n            var instance = Object.create(this);\r\n            for (var key in option) {\r\n                instance[key] = option[key];\r\n            }\r\n            return instance;\r\n        },\r\n        nodeId: null,//节点Id\r\n        x: null,\r\n        y: null\r\n    };\r\n\r\n    var identifierCountId = 1;\r\n\r\n    __M.MindNodeCore = Base({\r\n        _nodeId: '',\r\n        _containParentsId: '',\r\n        _level: 1,\r\n        _minder: null,//根节点\r\n        _mindNode: null,//中间编辑框\r\n        _connectGroup: null,//连线容器\r\n        _connectLine: null,//连接到父节点的线\r\n        _parent: null,//父节点\r\n        _children: null,//子节点\r\n        _root: null,//根节点\r\n        _option: null,\r\n        _remove: false,\r\n        _textVisibleState: true,\r\n        _rootRemark: null,\r\n        _lastTextRectPathWidth: 0,//上次的文本框宽度\r\n        _expand: true,//是否展开，默认是展开状态\r\n        _identifier: '',//节点内部唯一标识\r\n        create: function (option, minder, eventDispatch, connectGroup, parent, text, textVisible, paper, requireChildren) {\r\n            option.nodeIndex++;//自动添加索引\r\n            var nodeId = ID.getNodeId(option.nodeIndex);\r\n            var instance = Object.create(this);\r\n            //调用基类方法\r\n            instance.__base(eventDispatch, instance._eventsInfo, nodeId);\r\n\r\n            instance._nodeId = nodeId;\r\n            instance._minder = minder;\r\n            instance._rootRemark = {};\r\n            instance._connectGroup = connectGroup;\r\n            instance._parent = parent;\r\n            //根节点与其他节点赋值逻辑分开处理\r\n            if (parent) {\r\n                instance._root = parent.getRoot();\r\n                instance._level = parent.getLevel() + 1;\r\n            } else {\r\n                instance._paper = paper;\r\n                instance._root = instance;\r\n                instance._level = 1;\r\n                //根节点特有的对象属性，记录所有节点的位置信息\r\n                instance.positionRecord = {};\r\n            }\r\n            instance._makeContainParentsId();\r\n            instance._textVisibleState = typeof textVisible !== 'undefined' ? textVisible : true;\r\n            instance.setRequireChildren(!!requireChildren);\r\n            instance._children = [];\r\n            instance._option = option;\r\n\r\n            instance._mindNode = MindNode.create(instance._nodeId, option.nodeIndex, eventDispatch, instance, text);\r\n\r\n            if (instance.isRoot()) {\r\n                instance.positionRecord[nodeId] = NodePosition.create({\r\n                    x: 0,\r\n                    y: 0,\r\n                    innerRectX: 0,\r\n                    innerRectY: 0,\r\n                    innerRectWidth: instance.getRectPath().getWidth(),\r\n                    innerRectHeight: instance.getRectPath().getHeight(),\r\n                    containParentId: null,\r\n                    visible: true\r\n                });\r\n            }\r\n\r\n            return instance;\r\n        },\r\n        getMindNodeShape: function () {\r\n            return this._mindNode.__getShape();\r\n        },\r\n        layoutBox: function () {\r\n            return this._mindNode.reLayout();\r\n        },\r\n        getLayoutBox: function () {\r\n            return this._mindNode.getLayoutBox();\r\n        },\r\n        getRectPath: function () {\r\n            return this._mindNode.getRectPath();\r\n        },\r\n        bringTop: function () {\r\n            return this._mindNode.bringTop();\r\n        },\r\n        getCurNodePosition: function () {\r\n            var that = this;\r\n            var matrix = that.getTransform();\r\n            var curRectPath = that.getRectPath();\r\n            var curRectPathMatrix = curRectPath.getTransform();\r\n            return {\r\n                x: matrix.m.e,\r\n                y: matrix.m.f,\r\n                innerRectX: matrix.m.e - curRectPathMatrix.m.e,\r\n                innerRectY: matrix.m.f - curRectPathMatrix.m.f,\r\n                innerRectWidth: curRectPath.getWidth(),\r\n                innerRectHeight: curRectPath.getHeight(),\r\n                containParentId: that.getContainParentsId(),\r\n                nodeId: that.getNodeId(),\r\n                visible: that.getMindNodeShape().node.getAttribute(\"display\") !== 'none'\r\n            };\r\n        },\r\n        //递归初始化节点宽高、线条显示信息\r\n        trvDrawInit: function (orientation) {\r\n            var that = this;\r\n            if (!orientation || orientation === 'both') {\r\n                var level = that.getLevel();\r\n                //二级节点需要判断渲染方向\r\n                if (level === 2) {\r\n                    orientation = that.getOrientation();\r\n                }\r\n            }\r\n            that.draw(DRAW_TYPE_KEY.INIT, {orientation: orientation});\r\n            this.getChildren().forEach(function (child) {\r\n                child.trvDrawInit(orientation);\r\n            });\r\n        },\r\n        drawBeforeMove: function () {\r\n            this.trvHide(true);\r\n        },\r\n        drawMove: function (x, y) {\r\n            var that = this;\r\n            that.draw(DRAW_TYPE_KEY.MOVE, {x: x, y: y});\r\n        },\r\n        drawAfterMove: function (x, y) {\r\n            this.getChildren().forEach(function (child) {\r\n                child.draw(DRAW_TYPE_KEY.MOVE, {x: x, y: y});\r\n                child.drawAfterMove(x, y);\r\n            });\r\n        },\r\n        //更改兄弟关系\r\n        drawAndChangeBroRelation: function (coverId, coverDirection) {\r\n            var orientation = '';\r\n            //节点方向改变，更新数据结构。确保更改兄弟关系：上下移动时，不改变到结构\r\n            if (this.getLevel() === 2) {\r\n                this.resetRootChildrenSort();\r\n            }\r\n            var flag = this.changeBroRelation(coverId, coverDirection);\r\n            if (this.getOrientation() !== this.getLastOrientation()) {\r\n                orientation = 'both';\r\n            }\r\n\r\n            if (flag.flag) {\r\n                //初始化节点\r\n                this.layout({global: true, orientation: orientation, reason: flag.relationChange ? CHANGE_REASON.BRO_RELATION : CHANGE_REASON.MOVE});\r\n            }\r\n            return flag;\r\n        },\r\n        //更改节点父子关系\r\n        drawChildAppend: function (node) {\r\n            var that = this;\r\n            var oldParent = node.getParent();\r\n            that.appendChild(node);\r\n            if (!that.isExpand()) {\r\n                //展开当前节点\r\n                that.setExpand(true);\r\n                //显示节点\r\n                that.trvShow();\r\n            }\r\n            var orientation = '';\r\n            if (node.getOrientation() !== node.getLastOrientation()) {\r\n                orientation = 'both';\r\n            }\r\n            //节点方向改变，更新数据结构。确保更改兄弟关系：上下移动时，不改变到结构\r\n            if (this.isRoot()) {\r\n                this.resetRootChildrenSort();\r\n            }\r\n            //初始化当前节点状态\r\n            that.draw(DRAW_TYPE_KEY.INIT);\r\n            //更新旧父节点样式\r\n            oldParent.draw(DRAW_TYPE_KEY.INIT);\r\n            this.layout({global: true, orientation: orientation, reason: CHANGE_REASON.PARENT_CHANGE});\r\n        },\r\n        //删除重绘新增\r\n        drawDelete: function () {\r\n            var that = this;\r\n\r\n            var orientation = that.getOrientation();\r\n            var gloDraw = true;\r\n            if (that.getParent().isRoot()) {\r\n                var children = that.getParent().getChildByOrientation(orientation);\r\n                if (children.length === 1) {\r\n                    gloDraw = false;\r\n                }\r\n            } else {\r\n                if (that.getCenterSub() === 0\r\n                    && that.getChildHeight() <= _nodeStyle.height\r\n                    && that._mindNode.getRectPathHeight() <= _nodeStyle.height\r\n                    && that.getParent().getChildrenCount() <= 1) {\r\n                    gloDraw = false;\r\n                }\r\n            }\r\n            var parent = this.getParent();\r\n            this.destroy();\r\n            if (gloDraw) {\r\n                this.layout({global: true, orientation: orientation, reason: CHANGE_REASON.DELETE});\r\n            } else {\r\n                parent.draw(DRAW_TYPE_KEY.INIT);\r\n                parent.layout({reason: CHANGE_REASON.DELETE});\r\n            }\r\n        },\r\n        //文本显示隐藏、内容变化\r\n        drawTextChange: function (text, animate) {\r\n            var that = this;\r\n            var current = this.getText();\r\n            that.draw(DRAW_TYPE_KEY.TEXT, {text: text});\r\n            var rectPathWidth = that._mindNode.getRectPathWidth();\r\n            var rectPathHeight = that._mindNode.getRectPathHeight();\r\n            //大小发生变化，重绘节点\r\n            var reason = '';\r\n            if (current !== text) {\r\n                reason = CHANGE_REASON.TEXT_CONTENT;\r\n            }\r\n            if (that._lastTextRectPathWidth !== rectPathWidth && that._lastTextRectPathHeight === rectPathHeight) {\r\n                this.layout({reason: reason, includeSelf: true, animate: (animate === false ? animate : that._option.animate)});\r\n            } else if (that._lastTextRectPathHeight !== that._mindNode.getRectPathHeight()) {\r\n                //高度变化重绘所有节点\r\n                //重绘时导致当前节点移除了可视范围，重绘后进行居中处理\r\n                if (Utils.isMobile) {\r\n                    this.__triggerEvent(KEY.NODE_CENTER, this.getNodeId());\r\n                }\r\n                //移动端键盘不需要动画\r\n                if (Utils.isMobile) {\r\n                    animate = false;\r\n                }\r\n                this.layout({global: true, reason: reason, animate: animate});\r\n            } else {\r\n                if (reason) {\r\n                    this.onChange(reason);\r\n                }\r\n            }\r\n\r\n        },\r\n        //节点展开、收起\r\n        drawExpandChange: function () {\r\n            var that = this;\r\n            this.setExpand(!this._expand);\r\n            that.trvShow();\r\n            //初始化当前节点\r\n            that.draw(DRAW_TYPE_KEY.INIT);\r\n            //只有一个节点不需要全局绘制\r\n            var children = that.getChildren();\r\n            var global = true;\r\n            if (children.length === 1 && children[0].isLeaf()) {\r\n                global = false;\r\n            }\r\n            this.layout({global: global, reason: CHANGE_REASON.EXPAND});\r\n        },\r\n        //mouseup/touchend触发\r\n        drawUp: function (eventType, hasDraw, hasMove) {\r\n            var that = this;\r\n            var lastOrientation = that._lastOrientation;\r\n            //与上次方向不一致，重新计算并绘制\r\n            if (that.getOrientation() !== lastOrientation && !that.isRoot() && !hasDraw) {\r\n                var type = this._option.type;\r\n\r\n                //单侧模式下，不处理绘制\r\n                if (type === 'left' || type === 'right') {\r\n                    this.draw(DRAW_TYPE_KEY.ACTIVE, {eventType: eventType});\r\n                    //触发绘制结束\r\n                    that.__triggerEvent(KEY.NODE_DRAWING, 'end');\r\n                    return;\r\n                }\r\n                if (that.getLevel() === 2) {\r\n                    this.draw(DRAW_TYPE_KEY.ACTIVE, {eventType: eventType});\r\n                    that.getRoot().trvDrawInit();\r\n                    this.layout({global: true, orientation: 'both', reason: CHANGE_REASON.ORIENTATION_CHANGE});\r\n                } else {\r\n                    //非二级节点归回原位\r\n                    this.draw(DRAW_TYPE_KEY.ACTIVE, {eventType: eventType, orientation: lastOrientation});\r\n                    that.trvDrawInit(lastOrientation);\r\n                    this.layout({global: true, orientation: lastOrientation, reason: CHANGE_REASON.MOVE});\r\n                }\r\n            } else {\r\n                this.draw(DRAW_TYPE_KEY.ACTIVE, {eventType: eventType});\r\n                //初始化状态\r\n                that.trvDrawInit();\r\n                var matrix = that.getTransform();\r\n                //位置有变化，重新设置该节点的位置\r\n                that.setToPosition(matrix.m.e, matrix.m.f);\r\n                if (!hasDraw && hasMove) {\r\n                    if (that.isRoot()) {\r\n                        this.onChange(CHANGE_REASON.MINDER_MOVE);\r\n                    } else {\r\n                        this.onChange(CHANGE_REASON.MOVE);\r\n                    }\r\n                }\r\n                if (!hasDraw) {\r\n                    //触发绘制结束\r\n                    that.__triggerEvent(KEY.NODE_DRAWING, 'end');\r\n                }\r\n            }\r\n            //移动结束时，显示所有节点\r\n            that.trvShow();\r\n        },\r\n        //子节点新增\r\n        drawAddChildren: function (orientation) {\r\n            var that = this;\r\n            var node = that.addNode({orientation: orientation});\r\n            if (!that.isExpand()) {\r\n                //展开当前节点\r\n                that.setExpand(true);\r\n                //显示节点\r\n                that.trvShow();\r\n            }\r\n            //初始化当前节点状态\r\n            that.draw(DRAW_TYPE_KEY.INIT);\r\n            //只有一个节点，不需要全局绘制\r\n            if (that.getChildrenCount() === 1) {\r\n                this.layout({reason: CHANGE_REASON.ADD});\r\n            } else {\r\n                //根据新增节点的方向，绘制某一侧即可\r\n                orientation = node.getOrientation();\r\n                this.layout({global: true, orientation: orientation, reason: CHANGE_REASON.ADD});\r\n            }\r\n        },\r\n        drawFocusEditDisable: function () {\r\n            this.draw(DRAW_TYPE_KEY.ACTIVE_EDIT_DISABLE, {});\r\n        },\r\n        draw: function (type, data) {\r\n            var that = this;\r\n            data = data || {};\r\n            type = type || '';\r\n            that._preDraw(type, data);\r\n            that._drawing(type, data);\r\n            that._afterDraw(type, data);\r\n        },\r\n        _preDraw: function (type, data) {\r\n            var that = this;\r\n            switch (type) {\r\n                case DRAW_TYPE_KEY.ACTIVE:\r\n                    //获取上一次的位置\r\n                    this._lastOrientation = that.getOrientation();\r\n                    break;\r\n                case DRAW_TYPE_KEY.TEXT:\r\n                    that._lastTextRectPathWidth = that._mindNode.getRectPathWidth();\r\n                    that._lastTextRectPathHeight = that._mindNode.getRectPathHeight();\r\n                    break;\r\n                case DRAW_TYPE_KEY.INIT:\r\n\r\n                    break;\r\n            }\r\n        },\r\n        _drawing: function (type, data) {\r\n            var that = this;\r\n            this._mindNode.draw(type, data);\r\n            //处理子节点绘制\r\n            switch (type) {\r\n                case DRAW_TYPE_KEY.INIT:\r\n                    //维护最新id关系字符串\r\n                    if (that.isRoot() === false) {\r\n                        that._makeContainParentsId();\r\n                    }\r\n                    that.getRoot().rtSetPosRecord(that.getNodeId(), that.getCurNodePosition());\r\n                    //重新计算是否需要显示\r\n                    if (data.orientation) {\r\n                        this._lastOrientation = data.orientation;\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n        _afterDraw: function (type, data) {\r\n            var that = this;\r\n            if (type === DRAW_TYPE_KEY.MOVE) {\r\n                //移动后重新计算是否显示根节点左右两侧的线条\r\n                if (this.getLevel() === 2) {\r\n                    this.getRoot().draw(DRAW_TYPE_KEY.INIT);\r\n                }\r\n            }\r\n            if (that._connectLine) {\r\n                that._connectLine.draw(type, data);\r\n            }\r\n        },\r\n        onChange: function (type) {\r\n            if (this._option.onChange) {\r\n                this._option.onChange(type);\r\n            }\r\n        },\r\n        getLastOrientation: function () {\r\n            return this._lastOrientation;\r\n        },\r\n        isExpand: function () {\r\n            return this._expand;\r\n        },\r\n        setExpand: function (expand) {\r\n            this._expand = expand;\r\n        },\r\n        appendNode: function (orientation, absOrientation) {\r\n            var that = this;\r\n\r\n            absOrientation = typeof absOrientation === typeof undefined ? false : absOrientation;\r\n            that._minder.addShape(that._mindNode.__getShape());\r\n            //添加到节点后重新布局、文本居中显示\r\n            that._mindNode.reLayout();\r\n\r\n            var autoRideCount = this._option.autoRideCount;\r\n\r\n            //先初始化位置\r\n            if (!that.isRoot()) {\r\n                var matrix = this.getParent().getTransform();\r\n                //加减50来标记左右方向\r\n                var cy = matrix.m.f + this.getParent()._mindNode.getRectPathHeight() / 2 - this._mindNode.getRectPathHeight() / 2;\r\n                var targetMatrix = new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, orientation === 'left' ? matrix.m.e - 50 : matrix.m.e + 50, cy);\r\n                //统一使用matrix来进行位置偏移\r\n                this.getMindNodeShape().setMatrix(targetMatrix);\r\n\r\n\r\n                //根节点自动排版算法，左右数量平衡\r\n                if (that.getParent().isRoot() && !absOrientation) {\r\n                    var leftCount = that.getRoot().getChildByOrientation('left').length;\r\n                    var rightCount = that.getRoot().getChildByOrientation('right').length;\r\n                    if (orientation === 'left' && leftCount > autoRideCount && (leftCount - 1) > rightCount) {\r\n                        orientation = 'right';\r\n                    } else if (orientation === 'right' && rightCount > autoRideCount && (rightCount - 1) > leftCount) {\r\n                        orientation = 'left';\r\n                    }\r\n                    //再次设置初始位置\r\n                    var matrix = this.getParent().getTransform();\r\n                    //加减50来标记左右方向\r\n                    var cy = matrix.m.f + this.getParent()._mindNode.getRectPathHeight() / 2 - this._mindNode.getRectPathHeight() / 2;\r\n                    var targetMatrix = new kity.Matrix(matrix.m.a, matrix.m.b, matrix.m.c, matrix.m.d, orientation === 'left' ? matrix.m.e - 50 : matrix.m.e + 50, cy);\r\n                    //统一使用matrix来进行位置偏移\r\n                    this.getMindNodeShape().setMatrix(targetMatrix);\r\n                }\r\n\r\n                this._connectLine = ConnectLine.create(that);\r\n                this._connectGroup.addShape(this._connectLine.__getShape());\r\n            }\r\n\r\n        },\r\n        setIdentifier: function (_identifier) {\r\n            this._identifier = _identifier;\r\n        },\r\n        addNode: function (data, index, absOrientation) {\r\n            var that = this;\r\n            var textVisible = that._option.ignoreAttrTextVisible ? true : data.textVisible;\r\n            absOrientation = absOrientation || false;\r\n            //创建节点O\r\n            var node = __M.MindNodeCore.create(this._option, this._minder, this.___eventDispatch, this._connectGroup, this, data.text, textVisible, null, data.requireChildren);\r\n            node.setExtendProperties(data);\r\n            //防止出现重复id\r\n            if (data.identifier && data.identifier > identifierCountId) {\r\n                identifierCountId = data.identifier + 100;\r\n            }\r\n            node.setIdentifier(data.identifier || identifierCountId++);\r\n            //添加到子节点队列\r\n            that.insertChild(node, index);\r\n            //添加到svg\r\n            node.appendNode(data.orientation, absOrientation);\r\n\r\n            return node;\r\n        },\r\n        setMatrix: function (matrix) {\r\n            this._mindNode.setMatrix(matrix);\r\n        },\r\n        setText: function (text) {\r\n            this._mindNode.setText(text);\r\n        },\r\n        getText: function () {\r\n            var text = this._mindNode.getText();\r\n            return text;\r\n        },\r\n        setTextVisible: function (visible) {\r\n            this._textVisibleState = visible;\r\n        },\r\n        toggleTextVisible: function () {\r\n            this.setTextVisible(!this._textVisibleState);\r\n        },\r\n        getTextVisible: function () {\r\n            return this._textVisibleState;\r\n        },\r\n        isActive: function () {\r\n            return this._mindNode.isActive();\r\n        },\r\n        getOption: function () {\r\n            return this._option;\r\n        },\r\n        trvHide: function (excludeSelf) {\r\n            //隐藏当前结点和所有子节点\r\n            if (excludeSelf !== true) {\r\n                this.hide();\r\n            }\r\n            this.getChildren().forEach(function (child) {\r\n                child.trvHide();\r\n            });\r\n        },\r\n        hide: function () {\r\n            this._mindNode.__hide();\r\n            if (this._connectLine) {\r\n                this._connectLine.__hide();\r\n            }\r\n        },\r\n        show: function () {\r\n            //显示当前结点\r\n            this._mindNode.__show();\r\n            if (this._connectLine) {\r\n                this._connectLine.__show();\r\n                //重绘线条\r\n                this._connectLine.draw();\r\n            }\r\n        },\r\n        trvShow: function () {\r\n            //显示当前结点\r\n            this.show();\r\n            //重新计算线条位置\r\n            this.getChildren().forEach(function (child) {\r\n                //展开状态下才显示子节点\r\n                if (child.getParent().isExpand()) {\r\n                    child.trvShow();\r\n                } else {\r\n                    child.trvHide();\r\n                }\r\n            });\r\n        },\r\n\r\n        _trvRemoveShape: function () {\r\n            this.getMindNodeShape().remove();\r\n            if (this._connectLine) {\r\n                this._connectLine.__getShape().remove();\r\n            }\r\n            this.getChildren().forEach(function (child) {\r\n                child._trvRemoveShape();\r\n            });\r\n        },\r\n        trvRemove: function () {\r\n            var parent = this.getParent();\r\n            this._trvRemoveShape();\r\n            parent.removeChild(this);\r\n        },\r\n        _destroy: function () {\r\n            //移除节点\r\n            this.getMindNodeShape().remove();\r\n            this._mindNode.destroy();\r\n            if (this._connectLine) {\r\n                this._connectLine.__getShape().remove();\r\n                this._connectLine.destroy();\r\n            }\r\n            //销毁子节点\r\n            this.getChildren().forEach(function (child) {\r\n                child._destroy();\r\n            });\r\n            //移除事件绑定\r\n            this.__destroy();\r\n        },\r\n        destroy: function () {\r\n            //递归销毁\r\n            this._destroy();\r\n\r\n            //从父节点移除\r\n            if (!this.isRoot()) {\r\n                this.getParent().removeChild(this);\r\n                this._remove = true;\r\n            }\r\n            // delete this.getRoot()._rootRemark[this._identifier]\r\n        },\r\n        isRemove: function () {\r\n            return this._remove;\r\n        }\r\n    });\r\n\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n    'use strict';\r\n\r\n\r\n    var _nodeStyle = __M.Config.nodeStyle;\r\n    var Logger = __M.Logger;\r\n    var KEY = __M.Config.EVENT_KEY;\r\n\r\n    //根节点相关方法\r\n    var MindNodeAnimate = {\r\n        _paddingBottom: _nodeStyle.height + 4,\r\n        _lineXToParentX: 70,//线离父节点的x轴距离\r\n        _heightChild: 0,//子节点总高度\r\n        _centerSub: 0,//子节点相对父节点的中心点便宜值，+向上便宜，-向下偏移\r\n        _toX: 0,\r\n        _toY: 0,\r\n        getChildHeight: function () {\r\n            return this._heightChild;\r\n        },\r\n        setChildHeight: function (heightChild) {\r\n            this._heightChild = heightChild;\r\n        },\r\n        getCenterSub: function () {\r\n            return this._centerSub;\r\n        },\r\n        setCenterSub: function (centerSub) {\r\n            this._centerSub = centerSub;\r\n        },\r\n        getToPosition: function () {\r\n            var that = this;\r\n            //指定根节点位置，位置不变\r\n            if (this.isRoot()) {\r\n                var renderBox = this._mindNode.__getShape().getTransform();\r\n                return {\r\n                    cx: renderBox.m.e,\r\n                    cy: renderBox.m.f\r\n                };\r\n            }\r\n            return {\r\n                cx: that._toX,\r\n                cy: that._toY\r\n            };\r\n        },\r\n        setToPosition: function (x, y) {\r\n            this._toX = x;\r\n            this._toY = y;\r\n        },\r\n        _mathChildPos: function (children, orientation) {\r\n            var that = this;\r\n            var isRoot = that.isRoot();\r\n\r\n\r\n            //获取父节点位置\r\n            var renderBox = that.getRectPathRenderBox();\r\n            var parentPos = that.getToPosition();\r\n            parentPos.cy = parentPos.cy + (renderBox.height / 2);\r\n            //单个方向上的宽度\r\n            var orientationWidth = that._mindNode.getOrientationFullWidth();\r\n\r\n            //左侧或右侧\r\n            var isLeft = that.getOrientation() === 'left';\r\n            //优先使用传入的方向\r\n            if (orientation) {\r\n                isLeft = orientation === 'left';\r\n            }\r\n            var positionInfo = [];\r\n            var totalHeight = 0;\r\n            //单个节点\r\n            if (children.length === 1) {\r\n                var cx = parentPos.cx;\r\n\r\n                if (isRoot) {\r\n                    isLeft = children[0].getOrientation() === 'left';\r\n                }\r\n                var x;\r\n                var y;\r\n                if (isLeft) {\r\n                    //子节点文本矩形宽\r\n                    var rectPathWidth = children[0]._mindNode.getRectPathWidth();\r\n                    //左侧线宽\r\n                    var triangleLineWidth = that.getTriangleFullWidth();\r\n                    x = cx - rectPathWidth - triangleLineWidth;\r\n                    //y居中\r\n                    y = parentPos.cy - children[0]._mindNode.getRectPathHeight() / 2;\r\n                } else {\r\n                    x = cx + orientationWidth;\r\n                    //y居中\r\n                    y = parentPos.cy - children[0]._mindNode.getRectPathHeight() / 2;\r\n                }\r\n                children[0].setToPosition(x, y);\r\n                children[0].trvMathChildPosition(orientation);\r\n            } else if (children.length > 1) {\r\n                //计算子节点总高度\r\n                children.forEach(function (child, i) {\r\n                    var childPathBox = child.getRectPathRenderBox();\r\n                    var infos = {\r\n                        exSpace: false,\r\n                        height: childPathBox.height,//节点高度\r\n                        space: 0,//距离下面节点的高度\r\n                        x: 0,\r\n                        y: 0\r\n                    };\r\n\r\n                    //子节点中心偏移\r\n                    var centerSub = child.getCenterSub();\r\n                    //获取节点高度\r\n                    var childHeight = child.getChildHeight();\r\n\r\n                    var halfPadding = that._paddingBottom / 2;\r\n\r\n                    //计算上下间距\r\n                    var topSpace, bottomSpace;\r\n                    if (i === 0) {\r\n                        //最上面节点，下间距：（子节点高度-中心点便宜-节点高度）/2\r\n                        topSpace = bottomSpace = (childHeight - centerSub - childPathBox.height) / 2;\r\n                    } else if (i === children.length - 1) {\r\n                        //最下面节点，上间距：（子节点高度-节点高度+中心点便宜）/2\r\n                        topSpace = bottomSpace = (childHeight + centerSub - childPathBox.height) / 2;\r\n                    } else {\r\n                        //居于内部节点\r\n                        //上间距：\r\n                        topSpace = (childHeight - childPathBox.height + centerSub) / 2;\r\n                        //下间距\r\n                        bottomSpace = (childHeight - childPathBox.height - centerSub ) / 2.;\r\n                    }\r\n\r\n                    //没有子节点，使用默认间距\r\n                    bottomSpace = bottomSpace < halfPadding ? halfPadding : bottomSpace;\r\n                    topSpace = topSpace < halfPadding ? halfPadding : topSpace;\r\n\r\n                    //由子节点计算出的间距，需要加上默认间距\r\n                    if (bottomSpace > halfPadding) {\r\n                        bottomSpace += halfPadding;\r\n                    }\r\n                    if (topSpace > halfPadding) {\r\n                        topSpace += halfPadding;\r\n                    }\r\n\r\n                    //重新计算上一个节点的space空间\r\n                    if (i > 0) {\r\n                        //分给上一个节点的空间，重新计算总高度\r\n                        positionInfo[i - 1].space += topSpace;\r\n                        totalHeight += topSpace;\r\n                    }\r\n\r\n                    //计算总大小\r\n                    if (i < children.length - 1) {\r\n                        totalHeight += childPathBox.height + bottomSpace;\r\n                    }\r\n                    else {\r\n                        totalHeight += childPathBox.height;\r\n                    }\r\n                    var x;\r\n                    if (isLeft) {\r\n                        //子节点文本矩形宽\r\n                        var rectPathWidth = child._mindNode.getRectPathWidth();\r\n                        //左侧线宽\r\n                        var triangleLineWidth = that.getTriangleFullWidth();\r\n                        x = parentPos.cx - rectPathWidth - triangleLineWidth - that._lineXToParentX;\r\n                    } else {\r\n                        x = parentPos.cx + orientationWidth + that._lineXToParentX;\r\n                    }\r\n\r\n                    infos.space = bottomSpace;\r\n                    infos.x = x;\r\n                    positionInfo.push(infos);\r\n                });\r\n                //计算每个节点相对根节点的坐标位置\r\n                var lastTop = parentPos.cy - totalHeight / 2;\r\n                var lastInfo;\r\n                positionInfo.forEach(function (info, index) {\r\n                    if (lastInfo) {\r\n                        info.y = lastInfo.y + lastInfo.space + lastInfo.height;\r\n                        lastInfo = info;\r\n                    } else {\r\n                        info.y = lastTop;\r\n                        lastInfo = info;\r\n                    }\r\n                    //设置子节点位置\r\n                    children[index].setToPosition(info.x, info.y);\r\n                    //触发递归计算\r\n                    children[index].trvMathChildPosition(orientation);\r\n                });\r\n            }\r\n        },\r\n        //计算新建的坐标位置\r\n        trvMathChildPosition: function (orientation) {\r\n            var that = this;\r\n            if (this.isLeaf()) {\r\n                return 0;\r\n            }\r\n            var isRoot = that.isRoot();\r\n            if (isRoot) {\r\n                if (orientation === 'left' || orientation === 'right') {\r\n                    that._mathChildPos(that.getChildByOrientation(orientation), orientation);\r\n                } else {\r\n                    that._mathChildPos(that.getChildByOrientation('left'), 'left');\r\n                    that._mathChildPos(that.getChildByOrientation('right'), 'right');\r\n                }\r\n            } else {\r\n                var children = that.getChildren();\r\n                that._mathChildPos(children, orientation);\r\n            }\r\n        },\r\n        //计算当前节点高度、位置\r\n        trvMathChildHeight: function (orientation) {\r\n            var that = this;\r\n            var height = 0;\r\n            var centerSub = 0;\r\n            var children;\r\n            if (that.isRoot() && (orientation === 'left' || orientation === 'right')) {\r\n                children = this.getChildByOrientation(orientation);\r\n            } else {\r\n                children = that.getChildren();\r\n            }\r\n            //子节点数大于0且展开状态才计算高度\r\n            if (children.length > 0 && that.isExpand()) {\r\n                children.forEach(function (child, i) {\r\n                    var childPos = {\r\n                        height: 0\r\n                    };\r\n                    var childHeight;\r\n                    var childCenterSub;\r\n\r\n                    var box = child.getRectPathRenderBox();\r\n                    //叶子节点不计算高度\r\n                    if (child.isLeaf()) {\r\n                        childHeight = box.height;\r\n                        //重置节点高度\r\n                        child.setChildHeight(0);\r\n                        childCenterSub = 0;\r\n                    } else if (!child.isExpand()) {\r\n                        //未展开，当成是叶子节点处理\r\n                        childHeight = box.height;\r\n                        //重置节点高度\r\n                        child.setChildHeight(0);\r\n                        childCenterSub = 0;\r\n                    } else {\r\n                        childPos = child.trvMathChildHeight();\r\n\r\n                        childHeight = childPos.height;\r\n                        childCenterSub = childPos.centerSub;\r\n                        ////子节点高度小于节点高度，父节点取该节点高度\r\n                        if (box.height > childPos.height) {\r\n                            childHeight = box.height;\r\n                            //childCenterSub = box.height / 2;\r\n                        }\r\n                    }\r\n\r\n\r\n                    //计算偏差值,公式：偏移=第一个节点子节点高度/2-最后一个节点子节点高度/2\r\n                    if (children.length > 1) {\r\n                        if (i === 0) {\r\n                            //节点高度大于子节点高度，中心偏移值取第一个子节点偏移\r\n                            if (box.height > childPos.height) {\r\n                                centerSub = childCenterSub;\r\n                            } else {\r\n                                //高度比子节点小：平均偏移值+左右一个子节点偏移值\r\n                                centerSub = childCenterSub + (childHeight - box.height) / 2;\r\n                            }\r\n                        } else if (i === children.length - 1) {\r\n                            if (box.height > childPos.height) {\r\n                                centerSub = centerSub - childCenterSub;\r\n                            } else {\r\n                                centerSub = centerSub - childCenterSub - (childHeight - box.height) / 2;\r\n                            }\r\n\r\n                        }\r\n                    }\r\n\r\n                    //每个节点间默认间隔\r\n                    if (i > 0) {\r\n                        childHeight += that._paddingBottom;\r\n                    }\r\n                    height += childHeight;\r\n\r\n                });\r\n            }\r\n            that.setChildHeight(height);//本节点高度\r\n            that.setCenterSub(centerSub);\r\n            Logger.debug('child-height:', this.getNodeId(), height, centerSub);\r\n            return {\r\n                height: height,\r\n                centerSub: centerSub\r\n            };\r\n        },\r\n        layout: function (param) {\r\n            param = param || {};\r\n            var global = param.global || false;\r\n            //方向\r\n            var orientation = param.orientation || this.getOrientation();\r\n            //优先取外部传入的动画配置\r\n            var animate = ( param.animate === true || param.animate === false) ? param.animate : this._option.animate;\r\n            //默认需要计算\r\n            var mathPos = ( param.mathPos === true || param.mathPos === false) ? param.mathPos : true;\r\n            //是否绘制本节点\r\n            var includeSelf = param.includeSelf || false;\r\n            //是否绘制本节点\r\n            var reason = param.reason || '';\r\n            //触发原因\r\n            var onComplete = param.onComplete || function () {\r\n                };\r\n            if (global === true) {\r\n                this._gloDraw(orientation, animate, mathPos, reason, onComplete);\r\n            } else {\r\n                this._childDraw(includeSelf, reason, onComplete,animate);\r\n            }\r\n        },\r\n        _gloDraw: function (orientation, animate, mathPos, reason, onComplete) {\r\n            var that = this;\r\n            if (mathPos) {\r\n                //计算所有节点的高度\r\n                that.getRoot().trvMathChildHeight(orientation);\r\n                //计算所有节点位置\r\n                that.getRoot().trvMathChildPosition(orientation);\r\n            }\r\n            //重新排版\r\n            that.__triggerEvent(KEY.NODE_DRAWING, 'start');\r\n            if (animate === true) {\r\n                that.getRoot().trvAnimate(function () {\r\n                    //初始化所有节点控件\r\n                    that.getRoot().trvDrawInit();\r\n                    onComplete();\r\n                    that.__triggerEvent(KEY.NODE_DRAWING, 'end');\r\n                    that.onChange(reason);\r\n                }, orientation);\r\n            } else {\r\n                that.getRoot().trvMoveChildrenPos(orientation);\r\n                that.getRoot().trvDrawInit();\r\n                onComplete();\r\n                that.__triggerEvent(KEY.NODE_DRAWING, 'end');\r\n                that.onChange(reason);\r\n            }\r\n        },\r\n        _childDraw: function (includeSelf, reason, onComplete,animate) {\r\n            var that = this;\r\n            var orientation = that.getOrientation();\r\n\r\n            //计算所有节点的高度\r\n            that.trvMathChildHeight();\r\n            that.__triggerEvent(KEY.NODE_DRAWING, 'start', reason);\r\n            //重新计算自身位置\r\n            //获取目前的位置\r\n            var matrix = that.getTransform();\r\n            that.setToPosition(matrix.m.e, matrix.m.f);\r\n            //左侧节点，绘制自身。右侧会自动计算坐标，不需要重绘\r\n            if (includeSelf && orientation === 'left') {\r\n                that.mathSelfPosition();\r\n                that.moveNode();\r\n                that._connectLine.draw();\r\n            }\r\n\r\n            //计算所有节点位置\r\n            that.trvMathChildPosition(orientation);\r\n            if (animate) {\r\n                //重新排版\r\n                that.trvAnimate(function () {\r\n                    //初始化节点控件\r\n                    that.trvDrawInit(orientation);\r\n                    that.__triggerEvent(KEY.NODE_DRAWING, 'end', reason);\r\n                    onComplete();\r\n                    that.onChange(reason);\r\n                });\r\n            } else {\r\n                that.trvMoveChildrenPos();\r\n                that.trvDrawInit(orientation);\r\n                that.__triggerEvent(KEY.NODE_DRAWING, 'end', reason);\r\n                onComplete();\r\n                that.onChange(reason);\r\n            }\r\n        },\r\n        trvAnimate: function (finish, orientation) {\r\n            var complex = this.getComplex(orientation);\r\n\r\n            //所有动画都结束后回调\r\n            function consume() {\r\n                if (!--complex) {\r\n                    if (finish) {\r\n                        finish();\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.trvAnimateChildren(function () {\r\n                //处理性能较差的情况\r\n                consume();\r\n            }, orientation);\r\n\r\n            if (complex === 0) {\r\n                if (finish) {\r\n                    finish();\r\n                }\r\n            }\r\n        },\r\n        trvAnimateChildren: function (finish, orientation) {\r\n            var that = this;\r\n            var children;\r\n            if (that.isRoot() && (orientation === 'left' || orientation === 'right')) {\r\n                children = that.getChildByOrientation(orientation);\r\n            } else {\r\n                children = that.getChildren();\r\n            }\r\n\r\n            //触发父节点进行子节点绘制\r\n            children.forEach(function (child, i) {\r\n                //只需要添加一个回调\r\n                //if (child.getMindNodeShape().node.getAttribute(\"display\") !== 'none') {\r\n                    child.animateNode(finish);\r\n                //} else {\r\n                //    child.moveNode();\r\n                //    if (finish) {\r\n                //        finish();\r\n                //    }\r\n                //}\r\n                child.trvAnimateChildren(finish);\r\n            });\r\n        },\r\n        trvMoveChildrenPos: function (orientation) {\r\n            var that = this;\r\n            //触发父节点进行子节点绘制\r\n            var children;\r\n            if (that.isRoot() && (orientation === 'left' || orientation === 'right')) {\r\n                children = that.getChildByOrientation(orientation);\r\n            } else {\r\n                children = that.getChildren();\r\n            }\r\n            children.forEach(function (child, i) {\r\n                var pos = child.getToPosition();\r\n                //只需要添加一个回调\r\n                child._mindNode.moveToPos(pos.cx, pos.cy);\r\n                child.trvMoveChildrenPos();\r\n            });\r\n        },\r\n        moveNode: function () {\r\n            var pos = this.getToPosition();\r\n            //只需要添加一个回调\r\n            this._mindNode.moveToPos(pos.cx, pos.cy);\r\n        },\r\n        animateNode: function (finish) {\r\n            var that = this;\r\n            var pos = that.getToPosition();\r\n            if (that._layoutTimeline) {\r\n                that._layoutTimeline.stop();\r\n                that._layoutTimeline = null;\r\n            }\r\n            that._layoutTimeline = that._mindNode.animateToPos(pos.cx, pos.cy, function () {\r\n                that._connectLine.draw('animate');\r\n            }, function () {\r\n                that._layoutTimeline = null;\r\n                //兼容性能问题\r\n                setTimeout(function () {\r\n                    that._connectLine.draw();\r\n                    if (finish) {\r\n                        finish();\r\n                    }\r\n                }, 100);\r\n            });\r\n        },\r\n        mathSelfPosition: function () {\r\n            var that = this;\r\n            //子节点文本矩形宽\r\n            var rectPathWidth = that._mindNode.getRectPathWidth();\r\n\r\n            //左侧线宽\r\n            var x = that._toX - ( rectPathWidth - that._lastTextRectPathWidth );\r\n            that.setToPosition(x, that._toY);\r\n        }\r\n    };\r\n\r\n\r\n    //扩展类\r\n    __M.MindNodeCore.__include(MindNodeAnimate);\r\n\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n    'use strict';\r\n\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var MENU_TYPE_KEY = __M.Config.MENU_TYPE_KEY;\r\n    var DRAW_TYPE_KEY = __M.Config.DRAW_TYPE_KEY;\r\n    var Logger = __M.Logger;\r\n\r\n\r\n    //事件处理\r\n    var MindNodeEventHandler = {\r\n        _eventsInfo: [\r\n            {nodeEvent: true, key: KEY.NODE_DOWN, fucs: '_downHandler', params: ['触发的事件类型']},\r\n            {nodeEvent: true, key: KEY.NODE_MOVE, fucs: '_moveHandler', params: ['x轴偏移', 'y轴偏移']},\r\n            {nodeEvent: true, key: KEY.NODE_DBLCLICK, fucs: '_dbClickHandler', params: []},\r\n            {nodeEvent: true, key: KEY.NODE_CLICK, fucs: '_clickHandler', params: []},\r\n            {nodeEvent: true, key: KEY.NODE_TEXT_CHANGE, fucs: '_textChangeHandler', params: ['是否需要动画']},\r\n            {nodeEvent: true, key: KEY.NODE_TRIANGLE_CLICK, fucs: '_triangleClickHandler', params: ['创建的方向 left/right']},\r\n            {nodeEvent: true, key: KEY.NODE_RIGHT_CLICK, fucs: '_rightClickHandler', params: []},\r\n            {nodeEvent: true, key: KEY.MENU_CLICK, fucs: '_menuClickHandler', params: ['type 触发的按钮类型', '传入的文本值']},\r\n            {nodeEvent: true, key: KEY.NODE_BLUR, fucs: '_blurHandler', params: ['当前获取到的节点id']},\r\n            {nodeEvent: true, key: KEY.NODE_EXPAND, fucs: '_expandHandler', params: ['是否收起']},\r\n            {nodeEvent: true, key: KEY.NODE_DELETE, fucs: '_deleteHandler', params: []},\r\n            {nodeEvent: true, key: KEY.NODE_UP, fucs: '_upHandler', params: ['触发的事件类型', '是否已经进行过绘制', '是否触发过move事件']},\r\n            {nodeEvent: true, key: KEY.NODE_COVER, fucs: '_nodeCoverHandler', params: ['node']},\r\n            {nodeEvent: true, key: KEY.NODE_RESTORE, fucs: '_nodeRestoreHandler', params: ['']},\r\n            {nodeEvent: true, key: KEY.NODE_SHOW_CONTENT, fucs: '_showContentHandler', params: []},\r\n            {nodeEvent: true, key: KEY.NODE_BEFORE_MOVE, fucs: '_beforeMoveHandler', params: []},\r\n            {nodeEvent: true, key: KEY.NODE_AFTER_MOVE, fucs: '_afterMoveHandler', params: []}\r\n        ],\r\n        _moveSubX: 0,\r\n        _moveSubY: 0,\r\n        _showContentHandler: function () {\r\n            if (!this.getTextVisible()) {\r\n                this.setTextVisible(true);\r\n                this.drawTextChange();\r\n            }\r\n        },\r\n        _nodeCoverHandler: function (node) {\r\n            this.drawChildAppend(node);\r\n        },\r\n        _nodeRestoreHandler: function () {\r\n            var startMatrix = this._startMatrix;\r\n            if (startMatrix) {\r\n                this._mindNode.moveToPos(startMatrix.m.e, startMatrix.m.f);\r\n            }\r\n            this._startMatrix = null\r\n        },\r\n        _deleteHandler: function () {\r\n            this.drawDelete();\r\n            if (this._option.remarkVisible) {\r\n                this.__triggerEvent(KEY.REMARK_SHOW, this, false);\r\n            }\r\n        },\r\n        _clickHandler: function () {\r\n            if (this._option.contentClickViewAble) {\r\n                if (!this.getTextVisible()) {\r\n                    this.toggleTextVisible();\r\n                    this.drawTextChange();\r\n                }\r\n            }\r\n        },\r\n        _expandHandler: function () {\r\n            this.drawExpandChange();\r\n        },\r\n        _rightClickHandler: function () {\r\n            //触发菜单显示\r\n            this.__triggerEvent(KEY.MENU_SHOW, this);\r\n        },\r\n        _menuClickHandler: function (type, text) {\r\n            switch (type) {\r\n                case MENU_TYPE_KEY.EDIT:\r\n                    var rect = this._getEditTextPos();\r\n                    this.__triggerEvent(KEY.EDITTEXT_CHANGE_NODE, this._nodeId, rect.left, rect.top, this);\r\n                    this.__triggerEvent(KEY.EDITTEXT_SHOW, this.getText(), this._nodeId, rect.left, rect.top);\r\n                    break;\r\n                case MENU_TYPE_KEY.VISIBLE:\r\n                    this.toggleTextVisible();\r\n                    this.drawTextChange();\r\n                    break;\r\n                case MENU_TYPE_KEY.COPY:\r\n                    break;\r\n                case MENU_TYPE_KEY.CUT:\r\n                case MENU_TYPE_KEY.PASTE:\r\n                    this.drawTextChange(text);\r\n                    break;\r\n                case MENU_TYPE_KEY.DELETE:\r\n                    this.drawDelete();\r\n                    if (this._option.remarkVisible) {\r\n                        this.__triggerEvent(KEY.REMARK_SHOW, this, false);\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n        _triangleClickHandler: function (orientation) {\r\n            this.drawAddChildren(orientation);\r\n        },\r\n        _blurHandler: function (id) {\r\n            //恢复非激活样式\r\n            if (this._nodeId !== id) {\r\n                this.draw(DRAW_TYPE_KEY.REVERT);\r\n                if (this._option.remarkVisible) {\r\n                    this.__triggerEvent(KEY.REMARK_SHOW, this, false);\r\n                }\r\n            }\r\n        },\r\n        _downHandler: function (eventType) {\r\n            //添加激活样式\r\n            this.draw(DRAW_TYPE_KEY.ACTIVE, {eventType: eventType});\r\n            //触发文本框跟随最新节点\r\n            var rect = this._getEditTextPos();\r\n            this.__triggerEvent(KEY.EDITTEXT_CHANGE_NODE, this._nodeId, rect.left, rect.top, this);\r\n            this._mindNode.setVisibleImageActive(true);\r\n            if (this._option.remarkVisible) {\r\n                this.__triggerEvent(KEY.REMARK_SHOW, this, true);\r\n            }\r\n        },\r\n        _beforeMoveHandler: function () {\r\n            if (!this.getMoveAble()) {\r\n                return;\r\n            }\r\n            this._mindNode.bringTop();\r\n            this._moveSubX = 0;\r\n            this._moveSubY = 0;\r\n            this._startMatrix = this._mindNode.__getShape().getTransform();\r\n            this._mindNode.setVisibleImageActive(false);\r\n            this.drawBeforeMove();\r\n            if (this._option.remarkVisible) {\r\n                this.__triggerEvent(KEY.REMARK_SHOW, this, false);\r\n            }\r\n        },\r\n        _moveHandler: function (x, y) {\r\n            if (!this.getMoveAble()) {\r\n                return;\r\n            }\r\n            this._moveSubX += x;\r\n            this._moveSubY += y;\r\n            this.drawMove(x, y);\r\n        },\r\n        _afterMoveHandler: function () {\r\n            if (!this.getMoveAble()) {\r\n                return;\r\n            }\r\n            this.drawAfterMove(this._moveSubX, this._moveSubY);\r\n            this._moveSubX = 0;\r\n            this._moveSubY = 0;\r\n        },\r\n        _upHandler: function (eventType, hasDraw, hasMove) {\r\n            this._mindNode.setVisibleImageActive(false);\r\n            this.drawUp(eventType, hasDraw, hasMove);\r\n            if (this._option.remarkVisible && !this._option.animate) {\r\n                this.__triggerEvent(KEY.REMARK_SHOW, this, true);\r\n            }\r\n        },\r\n        _dbClickHandler: function () {\r\n            //可见且可编辑\r\n            if (this.getTextVisible() && this.getContentEditAble()) {\r\n                //触发文本框显示文本\r\n                var rect = this._getEditTextPos();\r\n                this.__triggerEvent(KEY.EDITTEXT_SHOW, this.getText(), this._nodeId, rect.left, rect.top);\r\n            }\r\n        },\r\n        //文本变化监听\r\n        _textChangeHandler: function (text, animate) {\r\n            this.drawTextChange(text, animate);\r\n        },\r\n        _getEditTextPos: function () {\r\n            var that = this;\r\n            //获取参照物为client的mindBody元素位置信息\r\n            var $mindBody = $('#' + that._option.mindBodyId)\r\n            var mindBodyClientRect = $mindBody[0].getBoundingClientRect();\r\n            var mindWidth = $mindBody.width();\r\n            var scale = mindBodyClientRect.width / mindWidth;\r\n            var curElementClientRect = this._mindNode.getTextNode().node.getBoundingClientRect();\r\n            var pos = {\r\n                left: (curElementClientRect.left - mindBodyClientRect.left) / scale,\r\n                top: ( curElementClientRect.top - mindBodyClientRect.top) / scale\r\n            };\r\n            return pos;\r\n        }\r\n    };\r\n\r\n\r\n    //扩展类\r\n    __M.MindNodeCore.__include(MindNodeEventHandler);\r\n\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n    'use strict';\r\n\r\n    var Utils = __M.Utils;\r\n\r\n    //node节点关系处理\r\n    var ExtendProperties = {\r\n        _exContentEditAble: true,//是否可编辑文本内容\r\n        _exDeleteAble: true,//是否可删除\r\n        _exMoveAble: true,//是否可移动\r\n        _exRequireChildren: false,//是否必须要有子节点\r\n        _exRequireContent: false,//节点内容是否必填\r\n        _exChangeParentAble: true,//是否可以变更父节点\r\n        _exChangeBroAble: true,//是否可以变更兄弟关系\r\n        setExtendProperties: function (data) {\r\n            this.setChangeBroAble(data.changeBroAble);\r\n            this.setChangeParentAble(data.changeParentAble);\r\n            this.setContentEditAble(data.contentEditAble);\r\n            this.setDeleteAble(data.deleteAble);\r\n            this.setMoveAble(data.moveAble);\r\n            this.setRequireChildren(data.requireChildren);\r\n            this.setRequireContent(data.requireContent);\r\n            // this.setRemark(data.remark || '');\r\n        },\r\n\r\n        getChangeBroAble: function () {\r\n            return this._exChangeBroAble;\r\n        },\r\n        setChangeBroAble: function (val) {\r\n            if (val !== true && val !== false) {\r\n                this._exChangeBroAble = true;\r\n            } else {\r\n                this._exChangeBroAble = val;\r\n            }\r\n        },\r\n        getContentEditAble: function () {\r\n            return this._exContentEditAble;\r\n        },\r\n        setContentEditAble: function (val) {\r\n            if (val !== true && val !== false) {\r\n                this._exContentEditAble = true;\r\n            } else {\r\n                this._exContentEditAble = val;\r\n            }\r\n        },\r\n        getDeleteAble: function () {\r\n            return this._exDeleteAble;\r\n        },\r\n        setDeleteAble: function (val) {\r\n            if (val !== true && val !== false) {\r\n                this._exDeleteAble = true;\r\n            } else {\r\n                this._exDeleteAble = val;\r\n            }\r\n        },\r\n        getMoveAble: function () {\r\n            return this._exMoveAble;\r\n        },\r\n        setMoveAble: function (val) {\r\n            if (val !== true && val !== false) {\r\n                this._exMoveAble = true;\r\n            } else {\r\n                this._exMoveAble = val;\r\n            }\r\n        },\r\n        getRequireChildren: function () {\r\n            return this._exRequireChildren;\r\n        },\r\n        setRequireChildren: function (val) {\r\n            if (val !== true && val !== false) {\r\n                this._exRequireChildren = false;\r\n            } else {\r\n                this._exRequireChildren = val;\r\n            }\r\n        },\r\n        getRequireContent: function () {\r\n            return this._exRequireContent;\r\n        },\r\n        setRequireContent: function (val) {\r\n            if (val !== true && val !== false) {\r\n                this._exRequireContent = false;\r\n            } else {\r\n                this._exRequireContent = val;\r\n            }\r\n        },\r\n        getChangeParentAble: function () {\r\n            return this._exChangeParentAble;\r\n        },\r\n        setChangeParentAble: function (val) {\r\n            if (val !== true && val !== false) {\r\n                this._exChangeParentAble = true;\r\n            } else {\r\n                this._exChangeParentAble = val;\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    //扩展类\r\n    __M.MindNodeCore.__include(ExtendProperties);\r\n\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n    'use strict';\r\n\r\n    var Utils = __M.Utils;\r\n    var CHANGE_REASON = __M.Config.CHANGE_REASON;\r\n\r\n    //node节点关系处理\r\n    var MindNodeRelation = {\r\n        getTriangleFullWidth: function () {\r\n            return this._mindNode.getTriangleFullWidth();\r\n        },\r\n        getChildByOrientation: function (orientation) {\r\n            var childs = [];\r\n            if (!orientation) {\r\n                return this._children;\r\n            }\r\n            this.getChildren().forEach(function (child) {\r\n                if (child.getOrientation() === orientation) {\r\n                    childs.push(child);\r\n                }\r\n            });\r\n            return childs;\r\n        },\r\n        getNodeId: function () {\r\n            return this._nodeId;\r\n        },\r\n        _makeContainParentsId: function () {\r\n            if (this.getParent()) {\r\n                this._containParentsId = this.getParent().getContainParentsId() + this._nodeId + '|';\r\n            } else {\r\n                this._containParentsId = this._nodeId + '|';\r\n            }\r\n        },\r\n        setContainParentsId: function (id) {\r\n            this._containParentsId = id;\r\n        },\r\n        getContainParentsId: function () {\r\n            return this._containParentsId;\r\n        },\r\n        getRenderBox: function () {\r\n            return this.getMindNodeShape().getRenderBox();\r\n        },\r\n        getRectPathRenderBox: function () {\r\n            return this._mindNode.getRectPath().getRenderBox();\r\n        },\r\n        getTransform: function () {\r\n            return this.getMindNodeShape().getTransform();\r\n        },\r\n        getChildrenCount: function () {\r\n            return this._children.length;\r\n        },\r\n        //遍历当前及、子节点\r\n        traverse: function (fn, includeThis, orientation) {\r\n            if (includeThis) {\r\n                fn(this);\r\n            }\r\n            var children = this.getChildren();\r\n            if (this.isRoot() && (orientation === 'left' || orientation === 'right')) {\r\n                children = this.getChildByOrientation(orientation);\r\n            }\r\n\r\n            for (var i = 0; i < children.length; i++) {\r\n                children[i].traverse(fn, true, orientation);\r\n            }\r\n        },\r\n        //当前节点所在位置\r\n        getOrientation: function () {\r\n            if (this.isRoot()) {\r\n                return 'both';\r\n            } else if (this._option.type !== 'both') {\r\n                return this._option.type;\r\n            }\r\n            var box = this.getTransform();\r\n            return box.m.e < 0 ? 'left' : 'right';\r\n        },\r\n        //获取子节点朝向\r\n        getChildOrientation: function () {\r\n            var orientation = 'none';\r\n            var left, right;\r\n            this._children.forEach(function (child) {\r\n                var box = child.getOrientation();\r\n                box === 'left' ? left = true : right = true;\r\n            });\r\n            if (left && right) {\r\n                return 'both';\r\n            }\r\n            if (left) {\r\n                return 'left';\r\n            }\r\n            if (right) {\r\n                return 'right';\r\n            }\r\n            return orientation;\r\n        },\r\n        getChildren: function () {\r\n            return this._children;\r\n        },\r\n        getParent: function () {\r\n            return this._parent;\r\n        },\r\n        getLevel: function () {\r\n            return this._level;\r\n        },\r\n        isLeaf: function () {\r\n            return this._children.length === 0;\r\n        },\r\n        getRoot: function () {\r\n            return this._root || this;\r\n        },\r\n        getMinder: function () {\r\n            return this._minder;\r\n        },\r\n\r\n        /**\r\n         * 获取数据(ignore用于内部撤销还原使用)\r\n         * @param ignoreRemark 忽略备注\r\n         * @param remark 备注内容，这个递归时自动添加\r\n         * @param ignoreOffset 忽略位置偏移\r\n         * @returns {{data: {identifier: (string|*), text: (*|String), orientation: *, textVisible: *, matrix: string, isExpand}, children: Array}}\r\n         */\r\n        getData: function (ignoreRemark, remark, ignoreOffset) {\r\n            var that = this;\r\n            if (this.isRoot()) {\r\n                //重新计算所有默认坐标\r\n                if (!ignoreOffset) {\r\n                    this.trvMathChildPosition();\r\n                }\r\n                this.resetRootChildrenSort();\r\n            }\r\n\r\n            var matrix = that._mindNode.__getShape().getTransform();\r\n            matrix.m.e = Math.round(matrix.m.e);\r\n            matrix.m.f = Math.round(matrix.m.f);\r\n            var data = {\r\n                data: {\r\n                    identifier: this._identifier,\r\n                    text: that.getText(),\r\n                    orientation: that.getOrientation(),\r\n                    textVisible: that.getTextVisible(),\r\n                    matrix: matrix.m.e + ' ' + matrix.m.f,\r\n                    isExpand: that.isExpand()\r\n                },\r\n                children: []\r\n            };\r\n\r\n            if (!ignoreOffset) {\r\n                var x = Math.round((this._toX - matrix.m.e)),\r\n                    y = Math.round((this._toY - matrix.m.f));\r\n                if (x !== y && x !== 0) {\r\n                    data.data.offset = x + ' ' + y;\r\n                }\r\n                delete data.data.matrix;\r\n            }\r\n\r\n            if (this.isRoot() && !ignoreRemark) {\r\n                data.remark = remark = {};\r\n            }\r\n            if (remark) {\r\n                var re = this.getRoot()._rootRemark[this._identifier]\r\n                if (re !== undefined && re !== '') {\r\n                    remark[this._identifier] = re;\r\n                }\r\n            }\r\n\r\n            //一下几个属性，如果和默认值一致 ，则不写入数据中\r\n            if (that.getRequireChildren() === true) {\r\n                data.data.requireChildren = true;\r\n            }\r\n            if (that.getRequireContent() === true) {\r\n                data.data.requireContent = true;\r\n            }\r\n            if (that.getContentEditAble() === false) {\r\n                data.data.contentEditAble = false;\r\n            }\r\n            if (that.getDeleteAble() === false) {\r\n                data.data.deleteAble = false;\r\n            }\r\n            if (that.getMoveAble() === false) {\r\n                data.data.moveAble = false;\r\n            }\r\n            if (that.getChangeParentAble() === false) {\r\n                data.data.changeParentAble = false;\r\n            }\r\n            if (that.getChangeBroAble() === false) {\r\n                data.data.changeBroAble = false;\r\n            }\r\n\r\n\r\n            this.getChildren().forEach(function (child) {\r\n                data.children.push(child.getData(ignoreRemark, remark, ignoreOffset));\r\n            });\r\n\r\n            return data;\r\n        },\r\n        trvRenderData: function (data) {\r\n            var that = this;\r\n            var nodeData = data.data;\r\n            if (typeof nodeData.isExpand !== 'undefined') {\r\n                that.setExpand(nodeData.isExpand);\r\n            }\r\n\r\n            that.setExtendProperties(nodeData);\r\n\r\n            if (data.children) {\r\n                data.children.forEach(function (child) {\r\n                    var data = child.data;\r\n                    that.addNode(data, undefined, true);\r\n                });\r\n            }\r\n\r\n\r\n            that.getChildren().forEach(function (child, i) {\r\n                child.trvRenderData(data.children[i]);\r\n                //设置节点初始化位置\r\n                if (data.children[i].data.matrix) {\r\n                    var matrixAt = data.children[i].data.matrix.split(' ');\r\n                    if (matrixAt.length === 2) {\r\n                        child.setToPosition(parseInt(matrixAt[0]), parseInt(matrixAt[1]));\r\n                    } else if (matrixAt.length === 6) {\r\n                        child.setToPosition(parseInt(matrixAt[4]), parseInt(matrixAt[5]));\r\n                    }\r\n                }\r\n            });\r\n            if (that.isRoot()) {\r\n                //计算所有节点的高度\r\n                this.trvMathChildHeight();\r\n                //重新计算所有默认坐标\r\n                this.trvMathChildPosition();\r\n\r\n                this._trvRenderDataOffset(data);\r\n\r\n                this._rootRemark = data.remark || {};\r\n                this.layout({global: true, animate: false, mathPos: this._option.renderDataAutoLayout, reason: CHANGE_REASON.RENDER});\r\n                this.resetRootChildrenSort();\r\n                this.trvShow();\r\n            }\r\n        },\r\n        _trvRenderDataOffset: function (data) {\r\n            this.getChildren().forEach(function (child, i) {\r\n                child._trvRenderDataOffset(data.children[i]);\r\n                //设置节点初始化位置\r\n                if (data.children[i].data.offset) {\r\n\r\n                    var offsetAt = data.children[i].data.offset.split(' ');\r\n                    if (offsetAt.length === 2) {\r\n                        child.setToPosition(child._toX - parseInt(offsetAt[0]), child._toY - parseInt(offsetAt[1]));\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        rtSetRemark: function (remark) {\r\n            this.getRoot()._rootRemark[this._identifier] = remark;\r\n        },\r\n        rtGetRemark: function () {\r\n            return this.getRoot()._rootRemark[this._identifier] || '';\r\n        },\r\n        removeChild: function (node) {\r\n            var index, removed;\r\n            index = this._children.indexOf(node);\r\n            if (index >= 0) {\r\n                removed = this._children.splice(index, 1)[0];\r\n                removed._parent = null;\r\n                //removed._root = removed;\r\n            }\r\n            this._mindNode.updateRectPathFill();\r\n        },\r\n\r\n        insertChild: function (node, index) {\r\n            if (index === undefined) {\r\n                index = this._children.length;\r\n            }\r\n            if (node._parent) {\r\n                node._parent.removeChild(node);\r\n            }\r\n            node._parent = this;\r\n            node._root = this._root;\r\n            node._level = this._level + 1;\r\n            this._children.splice(index, 0, node);\r\n            this._mindNode.updateRectPathFill();\r\n        },\r\n        appendChild: function (node) {\r\n            return this.insertChild(node);\r\n        },\r\n        getIndex: function () {\r\n            return this._parent ? this._parent.getChildren().indexOf(this) : -1;\r\n        },\r\n        getChild: function (index) {\r\n            return this._children[index];\r\n        },\r\n        isRoot: function () {\r\n            return this._root === this;\r\n        },\r\n        getMinderNodeById: function (id) {\r\n            var node = this.getNodeId() === id ? this : null;\r\n            if (!node) {\r\n                var children = this.getChildren();\r\n                for (var i = 0; i < children.length; i++) {\r\n                    node = children[i].getMinderNodeById(id);\r\n                    if (node) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n            return node;\r\n        },\r\n        //改变兄弟节点顺序 direction:'bottom/top'\r\n        changeBroRelation: function (targetBroId, direction) {\r\n            if (this.isRoot()) {\r\n                return {\r\n                    flag: false\r\n                };\r\n            }\r\n            var bro = this.getParent().getChildren();\r\n            var tempNode = Utils.getItemInArrayById(bro, targetBroId, 'getNodeId');\r\n            if (tempNode) {\r\n                var tempIndex = bro.indexOf(tempNode);\r\n                var curIndex = bro.indexOf(this);\r\n                if (tempIndex > curIndex) {\r\n                    tempIndex--;\r\n                }\r\n                if (direction === 'bottom') {\r\n                    tempIndex++;\r\n                }\r\n                this.getParent().insertChild(this, tempIndex);\r\n                return {\r\n                    flag: true,\r\n                    relationChange: tempIndex !== curIndex\r\n                };\r\n            }\r\n            return {\r\n                flag: false\r\n            };\r\n        },\r\n        rtGetPosRecords: function () {\r\n            return this.getRoot().positionRecord;\r\n        },\r\n        rtSetPosRecord: function (id, pos) {\r\n            this.getRoot().positionRecord[id] = pos;\r\n        },\r\n        getComplex: function (orientation) {\r\n            var complex = 0;\r\n            this.traverse(function () {\r\n                complex++;\r\n            }, false, orientation);\r\n            return complex;\r\n        },\r\n        resetRootChildrenSort: function () {\r\n            var children = this.getRoot().getChildren();\r\n            var sortChildren = [];\r\n            var leftChildren = [];\r\n            children.forEach(function (child) {\r\n                if (child.getOrientation() === 'left') {\r\n                    leftChildren.push(child);\r\n                } else {\r\n                    sortChildren.push(child);\r\n                }\r\n            });\r\n            this.getRoot()._children = sortChildren.concat(leftChildren);\r\n        }\r\n    };\r\n\r\n\r\n    //扩展类\r\n    __M.MindNodeCore.__include(MindNodeRelation);\r\n\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n    'use strict';\r\n\r\n\r\n    var order = {\r\n        //前序遍历\r\n        preOrder: function (fn) {\r\n            var children = this.getChildren();\r\n            fn(this);\r\n            children.forEach(function (child) {\r\n                child.preOrder(fn);\r\n            });\r\n        },\r\n        //后序遍历\r\n        postOrder: function (fn) {\r\n            var children = this.getChildren();\r\n            children.forEach(function (child) {\r\n                child.preOrder(fn);\r\n            });\r\n            fn(this)\r\n        }\r\n    };\r\n\r\n\r\n    //扩展类\r\n    __M.MindNodeCore.__include(order);\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/29.\r\n */\r\n\r\n(function (window, $, __M) {\r\n    //1.0.1 根节点增加minder位置信息,路径：/minder/\r\n    //1.0.2  1.节点新增extendProperties里的参数，2.修改matrix属性a b c d e f 为e f 3.移除属性priority\r\n    //1.0.3  1.新增offset属性，记录偏移默认位置。解决bug：字体在不同平台渲染大小不一致导致的布局异常（matrix固定）\r\n    var VERSION = '1.0.3';\r\n    var Logger = __M.Logger;\r\n    var Utils = __M.Utils;\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var CLASS_NAME = __M.Config.CLASS_NAME;\r\n    var CHANGE_REASON = __M.Config.CHANGE_REASON;\r\n    var plusStyle = __M.Config.plusStyle;\r\n    var EditText = __M.View.EditTextArea;\r\n    var Menu = __M.View.Menu;\r\n    var Remark = __M.View.Remark;\r\n    var Placeholder = __M.View.Placeholder;\r\n    var MindNodeCore = __M.MindNodeCore;\r\n    var Base = __M.Class.Base;\r\n    var Clipboard = __M.Utils.Clipboard;\r\n\r\n    var OPTION = {\r\n        create: function (option) {\r\n            var instance = Object.create(this);\r\n            for (var key in option) {\r\n                instance[key] = option[key];\r\n            }\r\n            instance.mindBodyId = Utils.getUuid();\r\n            //计算基于基准缩放的缩放限制\r\n            instance.maxScale = instance.maxScale * instance.baseScale;\r\n            instance.minScale = instance.minScale * instance.baseScale;\r\n            return instance;\r\n        },\r\n        nodeIndex: 0,//节点索引\r\n        connectGroupId: 'minder_connect_group_1',//线组id\r\n        minderIdIndex: 0,//线组id\r\n        mindBodyId: Utils.getUuid(),\r\n        onScale: null,\r\n        onChange: null\r\n    };\r\n\r\n    var _templateHtml = '<div class=\"${cls}\" id=\"${id}\"><input id=\"btn_focus\" class=\"btn-focus\" type=\"button\" style=\"position: absolute\"/></div>';\r\n\r\n    var matchPadding = {\r\n        x: (plusStyle.circleWidth * 2) + 5,\r\n        y: 20,\r\n        remarkHeight: 30\r\n    }\r\n\r\n    __M.MindCore = Base({\r\n        _paper: null,//根页容器节点\r\n        _minder: null,//每个导图视图根节点\r\n        _connectGroup: null,//导图视图线根节点\r\n        _root: null,\r\n        _data: null,\r\n        _editText: null,\r\n        _menu: null,\r\n        _option: null,\r\n        _scale: 1,\r\n        _clipboard: null,\r\n        _$mindBody: null,\r\n        _tempLastId: null,//最后一次操作的id\r\n        create: function (option) {\r\n            var instance = Object.create(this);\r\n\r\n            //创建事件分发器\r\n            var eventDispatch = __M.Event.create();\r\n            //初始化基类\r\n            instance.__base(eventDispatch, instance._eventsInfo);\r\n            //创建配置\r\n            instance._option = OPTION.create(option);\r\n            //创建内部剪切板\r\n            instance._clipboard = Clipboard.create();\r\n\r\n            return instance;\r\n        },\r\n        getOption: function () {\r\n            return this._option;\r\n        },\r\n        render: function (containerElement) {\r\n            var that = this;\r\n            var data = {cls: CLASS_NAME.MIND_BODY_CLASS + ' ' + CLASS_NAME.MIND_BODY_PPT_SHELL_CLASS, id: that._option.mindBodyId};\r\n            if (Utils.isMobile) {\r\n                data = {cls: CLASS_NAME.MIND_BODY_CLASS, id: that._option.mindBodyId}\r\n            }\r\n            var minBodyHtml = Utils.String.template(_templateHtml, data);\r\n            var $mindBody = this._$mindBody = $(minBodyHtml);\r\n            $mindBody.on('contextmenu', function (e) {\r\n                e.preventDefault();\r\n            });\r\n\r\n            $(containerElement).html($mindBody);\r\n\r\n            if (!that._editText) {\r\n                //创建文本节点\r\n                that._editText = EditText.create(that.__getEventDispatch(), $mindBody, that._clipboard, that._option);\r\n                if (that._option.showMenu) {\r\n                    //创建菜单\r\n                    that._menu = Menu.create(that.__getEventDispatch(), $mindBody, that._clipboard, that._option);\r\n                    that._menu.setScale(that._option.baseScale);\r\n                }\r\n                if (that._option.remarkVisible) {\r\n                    that._remark = Remark.create(that.__getEventDispatch(), $mindBody, that._option);\r\n                }\r\n                //创建当前页\r\n                that._paper = new kity.Paper($mindBody[0]);\r\n                if (that._option.viewPort && that._option.viewPort.length == 2) {\r\n                    that._paper.setViewBox(0, 0, that._option.viewPort[0], that._option.viewPort[1]);\r\n                }\r\n                //新增容器\r\n                that._addMinder();\r\n                //绑定事件\r\n                that.bindDomEvent();\r\n            }\r\n\r\n\r\n            //增加第一个文本节点\r\n            that._createRoot();\r\n\r\n            //缩放到基准值\r\n            that.scale(1);\r\n\r\n            //根节点居中\r\n            that.rootCenter();\r\n\r\n            //移动端激活根节点\r\n            if (Utils.isMobile && this._option.editAble && !this._option.lock) {\r\n                this.focusRoot();\r\n            }\r\n\r\n            //渲染导入的数据\r\n            if (that._data) {\r\n                //初始节点\r\n                that._root.trvRenderData(that._data.root);\r\n            }\r\n\r\n            if (this._option.position.length > 0) {\r\n                that.changePosition(this._option.position);\r\n            }\r\n\r\n\r\n            $(this._paper.node).on('resize', function () {\r\n                that.onResize();\r\n            })\r\n\r\n        },\r\n        onResize: function () {\r\n            this._editText.setVisible(false);\r\n            if (this._menu) {\r\n                this._menu.setVisible(false);\r\n            }\r\n            this.mathTotalScale();\r\n            this._editText.setScale(this.getTotalScale());\r\n        },\r\n        _createRoot: function () {\r\n            //二级节点及其子节点全部移除\r\n            if (this._root) {\r\n                this._root.destroy();\r\n                this._root = null;\r\n            }\r\n            //初始化数据\r\n            var text;\r\n            if (this._data && this._data.root) {\r\n                text = this._data.root.data.text;\r\n            }\r\n            //生成一个节点容器\r\n            var node = this._root = MindNodeCore.create(this._option, this._minder, this.__getEventDispatch(), this._connectGroup, null, text, true, this._paper);\r\n            //往当前思维导图中添加节点\r\n            node.appendNode();\r\n        },\r\n        //允许存在多个思维导图，paper:[minder1,minder2...]\r\n        _addMinder: function () {\r\n            //创建一个导图实例根节点\r\n            var position = this._getCenterPoint();\r\n            this._minder = new kity.Group().setId('minder_' + this._option.minderIdIndex++).translate(position.x, position.y);\r\n            this._paper.addShape(this._minder);\r\n            //创建拖动时的矩形占位符\r\n            this._placeholder = Placeholder.create(this._minder, this._option.mindBodyId);\r\n            //创建线根节点\r\n            this._connectGroup = new kity.Group().setId(this._option.connectGroupId);\r\n            this._minder.addShape(this._connectGroup);\r\n        },\r\n        _getCenterPoint: function () {\r\n            if (this._option.viewPort && this._option.viewPort.length === 2) {\r\n                return {x: this._option.viewPort[0] / 2, y: this._option.viewPort[1] / 2};\r\n            } else {\r\n                return {x: this._paper.getWidth() / 2, y: this._paper.getHeight() / 2};\r\n            }\r\n        },\r\n        getMinderNodeById: function (id) {\r\n            return this.getRoot().getMinderNodeById(id);\r\n        },\r\n        getShapeById: function (id) {\r\n            try {\r\n                return this._paper.getShapeById(id);\r\n            } catch (e) {\r\n                Logger.debug(e);\r\n            }\r\n            return null;\r\n        },\r\n        getRoot: function () {\r\n            return this._root;\r\n        },\r\n        getData: function (ignoreRemark, ignoreOffset) {\r\n            var that = this;\r\n            var data = {\r\n                root: {},\r\n                minder: '',\r\n                version: VERSION\r\n            };\r\n            if (that._minder) {\r\n                //data.minder = that._minder.getTransform().toString();\r\n            }\r\n            if (that._root) {\r\n                data.root = that._root.getData(ignoreRemark, null, ignoreOffset);\r\n            }\r\n            return data;\r\n        },\r\n        setData: function (data) {\r\n            if (data && data.root && data.root.data && data.version) {\r\n                this._data = data;\r\n            } else {\r\n                this._data = null;\r\n                Logger.warn('MinderMap', '传入数据不合法');\r\n            }\r\n        },\r\n        setLock: function (lock) {\r\n            var that = this;\r\n            that._option.lock = lock;\r\n            if (lock) {\r\n                //触发失去焦点事件\r\n                this.blur();\r\n            }\r\n        },\r\n        getLock: function () {\r\n            return this._option.lock;\r\n        },\r\n        getEditAble: function () {\r\n            return this._option.editAble;\r\n        },\r\n        blur: function (notifyChange) {\r\n            notifyChange = typeof notifyChange === typeof undefined ? true : false;\r\n            if (!notifyChange) {\r\n                this._editText.setVisible(false);\r\n                if (this._menu) {\r\n                    this._menu.setVisible(false);\r\n                }\r\n            } else {\r\n                this.__triggerEvent(KEY.DOM_HIDE);\r\n            }\r\n            this.__triggerNodeEvent(KEY.NODE_BLUR);\r\n        },\r\n        getEditTextVisible: function () {\r\n            return this._editText.isVisible();\r\n        },\r\n        setEditAble: function (able) {\r\n            var that = this;\r\n            that._option.editAble = able;\r\n            if (!able) {\r\n                //触发失去焦点事件\r\n                this.blur();\r\n            }\r\n        },\r\n        _nodeToCenter: function (minderNode, leftCenter) {\r\n            if (minderNode) {\r\n                leftCenter === typeof leftCenter === typeof undefined ? false : leftCenter;\r\n                var nodeMatrix = minderNode.getMindNodeShape().getTransform();\r\n                var scale = this.getScale();\r\n                var rectWidth = minderNode.getRectPath().getWidth() * scale;\r\n                var rectHeight = minderNode.getRectPath().getHeight() * scale;\r\n                var position = this._getCenterPoint();\r\n                var matrix = this._minder.getTransform();\r\n                if (leftCenter) {\r\n                    matrix.m.e = position.x - nodeMatrix.m.e * scale;\r\n                } else {\r\n                    matrix.m.e = position.x - nodeMatrix.m.e * scale - rectWidth / 2;\r\n                }\r\n                matrix.m.f = position.y - nodeMatrix.m.f * scale - rectHeight / 2;\r\n                this._minder.setMatrix(matrix);\r\n                //隐藏全局的节点\r\n                this.__triggerEvent(KEY.DOM_HIDE);\r\n                this._option.onChange(CHANGE_REASON.MINDER_MOVE);\r\n            }\r\n        },\r\n        focusCenter: function (leftCenter) {\r\n            var minderNode = this.getCurMinderNode();\r\n            this._nodeToCenter(minderNode, leftCenter);\r\n        },\r\n        rootCenter: function (triggerChange) {\r\n            var that = this;\r\n            var matrix = that._minder.getTransform();\r\n            var position = that._getCenterPoint();\r\n            var minderNode = this.getRoot();\r\n            var scale = this.getScale();\r\n            var rectWidth = minderNode.getRectPath().getWidth() * scale;\r\n            var rectHeight = minderNode.getRectPath().getHeight() * scale;\r\n            matrix.m.e = position.x - rectWidth / 2;\r\n            matrix.m.f = position.y - rectHeight / 2;\r\n            that._minder.setMatrix(matrix);\r\n            //隐藏全局的节点\r\n            that.__triggerEvent(KEY.DOM_HIDE);\r\n            if (triggerChange !== false) {\r\n                this._option.onChange(CHANGE_REASON.MINDER_MOVE);\r\n            }\r\n        },\r\n        focusIn: function (minderNode) {\r\n            if (!minderNode || minderNode.isRemove()) {\r\n                return;\r\n            }\r\n            var pathBbox = minderNode.getRectPath().getRenderBox(),\r\n                nodeBbox = minderNode.getMindNodeShape().getRenderBox(),\r\n                matrix = minderNode.getMindNodeShape().node.getCTM(),\r\n                scale = matrix.a,\r\n                minderBbox = this._minder.getTransform(),\r\n                nodeWidth = pathBbox.width * scale,\r\n                nodeHeight = nodeBbox.height * scale,\r\n                paperWidth = this._paper.getWidth(),\r\n                paperHeight = this._paper.getHeight(),\r\n                marginX = matchPadding.x * scale,\r\n                marginY = matchPadding.y * scale + 2,\r\n                remarkHeight = matchPadding.remarkHeight * scale\r\n\r\n\r\n            matrix.f = matrix.f - (nodeBbox.height - pathBbox.height) * scale\r\n\r\n            //left\r\n            if (matrix.e < marginX) {\r\n                minderBbox.m.e += ( marginX - matrix.e) / matrix.a * this.getScale();\r\n            }\r\n            if (this._option.remarkVisible && this.getCurMinderNode() && this.getCurMinderNode().isActive() && this._remark.isVisible()) {\r\n                //top\r\n                if (matrix.f < (remarkHeight + marginY)) {\r\n                    minderBbox.m.f -= ((matrix.f - marginY) - remarkHeight) / matrix.a * this.getScale();\r\n                }\r\n            } else {\r\n                if (matrix.f < 0) {\r\n                    minderBbox.m.f -= (matrix.f - marginY) / matrix.a * this.getScale();\r\n                }\r\n            }\r\n            //right\r\n            if (matrix.e + nodeWidth + marginX > paperWidth) {\r\n                minderBbox.m.e -= ( (matrix.e + nodeWidth ) - paperWidth + marginX) / matrix.a * this.getScale();\r\n            }\r\n            //bottom\r\n            if (matrix.f + nodeHeight > paperHeight) {\r\n                minderBbox.m.f -= ((matrix.f + nodeHeight ) - paperHeight + marginY) / matrix.a * this.getScale();\r\n            }\r\n\r\n            this._minder.setMatrix(minderBbox);\r\n\r\n            this._option.onChange(CHANGE_REASON.MINDER_MOVE);\r\n\r\n\r\n        },\r\n        scale: function (scale) {\r\n            var that = this;\r\n            scale = that._option.baseScale * scale;\r\n            if (scale > that._option.maxScale) {\r\n                scale = that._option.maxScale;\r\n            }\r\n            if (scale < that._option.minScale) {\r\n                scale = that._option.minScale;\r\n            }\r\n            var matrix = that._minder.getTransform();\r\n            matrix.m.a = scale;\r\n            matrix.m.d = scale;\r\n            that._minder.setMatrix(matrix);\r\n            that._scale = scale;\r\n            //触发缩放回调\r\n            that._option.onScale(that.getRelativeScale());\r\n            var minderCTM = this._minder.container.node.getCTM();\r\n            this.mathTotalScale();\r\n            that._editText.setScale(this.getTotalScale());\r\n            if (that._remark) {\r\n                that._remark.setScale(this.getTotalScale());\r\n            }\r\n            //隐藏全局的节点\r\n            this.__triggerEvent(KEY.DOM_HIDE);\r\n            if (this._option.remarkVisible) {\r\n                that.nodeBlur();\r\n            }\r\n            this._option.onChange(CHANGE_REASON.MINDER_SCALE);\r\n        },\r\n        getScale: function () {\r\n            return this._scale;\r\n        },\r\n        getRelativeScale: function () {\r\n            return this._scale / this._option.baseScale;\r\n        },\r\n        mathTotalScale: function () {\r\n            var mindBodyClientRect = this._$mindBody[0].getBoundingClientRect();\r\n            var mindWidth = this._$mindBody.width();\r\n            var scale = mindBodyClientRect.width / mindWidth;\r\n            var minderCTM = this._minder.container.node.getCTM();\r\n            this._totalScale = scale * this.getScale() * minderCTM.a;\r\n        },\r\n        getTotalScale: function () {\r\n            return this._totalScale;\r\n        },\r\n        matchParent: function () {\r\n            var that = this,\r\n                minderBox = that._minder.getRenderBox(),\r\n                minderCTM = this._minder.container.node.getCTM(),\r\n                pageWidth = that._paper.getWidth(),\r\n                pageHeight = that._paper.getHeight(),\r\n                width = minderBox.width * minderCTM.a,\r\n                height = minderBox.height * minderCTM.a,\r\n                scale = 1;\r\n\r\n\r\n            //先对padding值进行缩放\r\n            if ((width >= pageWidth || height >= pageHeight) && width !== 0 && height !== 0) {\r\n                scale = pageWidth / width < pageHeight / height ? pageWidth / width : pageHeight / height;\r\n                pageWidth -= ( matchPadding.x * 2 * scale);\r\n                pageHeight -= ( matchPadding.y * 2 * scale);\r\n                if (this._remark && this._remark.isVisible() && !this._option.lock) {\r\n                    pageHeight = pageHeight - matchPadding.remarkHeight * scale;\r\n                }\r\n            }\r\n\r\n            scale = 1;\r\n            //计算宽高缩放\r\n            if (width > pageWidth) {\r\n                scale = pageWidth / width;\r\n                width = pageWidth;\r\n                height = height * scale;\r\n            }\r\n            if (height > pageHeight) {\r\n                var scaleTemp = pageHeight / height;\r\n                height = pageHeight;\r\n                width = width * scaleTemp;\r\n                scale *= scaleTemp\r\n            }\r\n\r\n            var matrix = this._minder.getTransform();\r\n            //先缩放\r\n            that.scale(matrix.m.a / that._option.baseScale * scale);\r\n            //居中处理\r\n            that.rootCenter(false);\r\n\r\n            //重新获取坐标\r\n            matrix = this._minder.getTransform();\r\n            minderBox = that._minder.getRenderBox();\r\n\r\n            // this.mathTotalScale();\r\n            var scale = this.getScale();\r\n            var minderNode = this.getRoot();\r\n            var rectWidth = minderNode.getRectPath().getWidth() * scale;\r\n            var rectHeight = minderNode.getRectPath().getHeight() * scale;\r\n\r\n            //计算pager中心与minder中心的差:minder偏移+(根节点中心离左边界的坐标-minder中心点坐标)\r\n            matrix.m.e = matrix.m.e + (rectWidth / 2 + matrix.m.e - minderBox.cx);\r\n            matrix.m.f = matrix.m.f + (rectHeight / 2 + matrix.m.f - minderBox.cy);\r\n\r\n            this._minder.setMatrix(matrix);\r\n\r\n            this._option.onChange(CHANGE_REASON.MINDER_MOVE);\r\n        },\r\n        changePosition: function (pos) {\r\n            var matrix = this._minder.getTransform();\r\n            var minderCTM = this._minder.container.node.getCTM();\r\n            var viewboxScale = minderCTM.a;\r\n            var minderBox = this._minder.getRenderBox();\r\n            var scale = this.getScale();\r\n            var matchPaddingX = matchPadding.x * scale;\r\n            var matchPaddingY = matchPadding.y * scale;\r\n            var pageWidth = this._paper.getWidth() - matchPaddingX * 2;\r\n            var pageHeight = this._paper.getHeight() - matchPaddingY * 2;\r\n            pos.forEach(function (p) {\r\n                if (p === 'middle') {\r\n\r\n                    var minderNode = this.getRoot();\r\n                    var rectWidth = minderNode.getRectPath().getWidth() * scale * viewboxScale;\r\n                    var rectHeight = minderNode.getRectPath().getHeight() * scale * viewboxScale;\r\n                    matrix.m.e = matrix.m.e + ( rectWidth / 2 + matrix.m.e - minderBox.cx);\r\n                    matrix.m.f = matrix.m.f + (  rectHeight / 2 + matrix.m.f - minderBox.cy);\r\n                } else if (p === 'left') {\r\n                    //minder距离左侧相差值（负），极为left值\r\n                    matrix.m.e = -minderCTM.e / viewboxScale + matchPaddingX;\r\n                } else if (p === 'top') {\r\n                    matrix.m.f = matrix.m.f - minderBox.top + matchPaddingY;\r\n                } else if (p === 'right') {\r\n                    //整个坐标系宽度-内容思维导图宽度-思维导图距离左侧宽度\r\n                    matrix.m.e = pageWidth / viewboxScale - minderBox.width - minderCTM.e / viewboxScale;\r\n                } else if (p === 'bottom') {\r\n                    matrix.m.f = matrix.m.f + pageHeight / viewboxScale - minderBox.bottom;\r\n                }\r\n            });\r\n            this._minder.setMatrix(matrix);\r\n            this._option.onChange(CHANGE_REASON.MINDER_MOVE);\r\n            this.focusIn(this.getCurMinderNode());\r\n            //隐藏全局的节点\r\n            this.__triggerEvent(KEY.DOM_HIDE);\r\n        },\r\n        hasChange: function () {\r\n            var data = this._data;\r\n            if (data === null) {\r\n                return true;\r\n            }\r\n            var diff = Utils.JsonDiff.compare(data, this.getData());\r\n            return diff.length > 0;\r\n        },\r\n        clear: function () {\r\n            //清楚外部传入的数据\r\n            this._data = {};\r\n            //二级节点及其子节点全部移除\r\n            if (this._root) {\r\n                this._root.destroy();\r\n                this._root = null;\r\n            }\r\n            this._option.nodeIndex = 0;\r\n            //取消缩放\r\n            var matrix = this._minder.getTransform();\r\n            matrix.m.a = this._option.baseScale;\r\n            matrix.m.d = this._option.baseScale;\r\n            this._minder.setMatrix(matrix);\r\n            //创建根节点\r\n            this._createRoot();\r\n            //根节点居中\r\n            this.rootCenter();\r\n            //隐藏全局的节点\r\n            this.__triggerEvent(KEY.DOM_HIDE);\r\n            this._option.onChange(CHANGE_REASON.CLEAR);\r\n        },\r\n        destroy: function () {\r\n            this.__destroy();\r\n            //移除全局事件\r\n            this.removeDomEvent();\r\n            //\r\n            if (this._placeholder) {\r\n                this._placeholder = null;\r\n            }\r\n            //清楚外部传入的数据\r\n            this._data = {};\r\n            //二级节点及其子节点全部移除\r\n            if (this._root) {\r\n                this._root.destroy();\r\n                this._root = null;\r\n            }\r\n            if (this._editText) {\r\n                this._editText.destroy();\r\n                this._editText = null;\r\n            }\r\n            if (this._menu) {\r\n                this._menu.destroy();\r\n                this._menu = null;\r\n            }\r\n            if (this._connectGroup) {\r\n                this._connectGroup.remove();\r\n                this._connectGroup = null;\r\n            }\r\n\r\n            this._paper = null;\r\n            this._minder = null;\r\n\r\n        },\r\n        resizeRemark: function () {\r\n            var node = this.getCurMinderNode(),\r\n                show = node && node.isActive();\r\n            if (this._option.remarkVisible) {\r\n                this.__triggerEvent(KEY.REMARK_SHOW, node, show);\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/29.\r\n */\r\n\r\n(function (window, $, __M) {\r\n    var Logger = __M.Logger;\r\n    var Utils = __M.Utils;\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var MENU_TYPE_KEY = __M.Config.MENU_TYPE_KEY;\r\n    var ID = __M.ID;\r\n    var DOM_EVENT_TYPE = __M.Config.DOM_EVENT_TYPE;\r\n    var CHANGE_REASON = __M.Config.CHANGE_REASON;\r\n\r\n    var EventUtils = {\r\n        isDown: function (type) {\r\n            return type === 'touchstart' || type === 'mousedown';\r\n        },\r\n        isUp: function (type) {\r\n            return /^(touchend|touchcancel|mouseup|mouseleave)$/.test(type);\r\n        },\r\n        isMove: function (type) {\r\n            return type === 'mousemove' || type === 'touchmove';\r\n        },\r\n        isTouch: function (type) {\r\n            return /^(touchend|touchcancel|touchstart|touchmove)$/.test(type);\r\n        },\r\n        getClientPos: function (ev) {\r\n            var ev = ev.originalEvent ? ev.originalEvent : ev;\r\n            var point = {};\r\n            switch (ev.type) {\r\n                case 'touchstart':\r\n                case 'touchmove':\r\n                case 'touchend':\r\n                case 'touchcancel':\r\n                    point.x = ev.changedTouches[0].pageX;\r\n                    point.y = ev.changedTouches[0].pageY;\r\n                    return point;\r\n                default:\r\n                    point.x = ev.pageX;\r\n                    point.y = ev.pageY;\r\n                    return point;\r\n            }\r\n            return point;\r\n        }\r\n    };\r\n\r\n    var DomEvent = {\r\n        _eventsInfo: [\r\n            {nodeEvent: false, key: KEY.NODE_DRAWING, fucs: '_drawingHandler', params: ['start/end']},\r\n            {nodeEvent: false, key: KEY.NODE_CENTER, fucs: '_nodeCenterHandler', params: ['nodeId']}\r\n        ],\r\n        _nodeData: null,//当前触发的节点信息\r\n        _plusOperate: false,//刚操作过添加\r\n        _editShowTimeOutId: 0,//\r\n        _nodeCenterId: '',\r\n        _dblClickTrigger: false,\r\n        _isDrawing: false,//是否在绘制\r\n        _outClickInstance: null,\r\n        _curMinderNode: null,//当前获取到焦点的节点\r\n        _isRootFocus: false,//当前获取到焦点的节点\r\n        _totalScale: 1,//总缩放比例\r\n        getCurMinderNode: function () {\r\n            return this._curMinderNode;\r\n        },\r\n        setCurMinderNode: function (minderNode) {\r\n            this._curMinderNode = minderNode;\r\n        },\r\n        focusNode: function (nodeId, minderNode) {\r\n            //触发其他节点失去焦点事件\r\n            if (this.getCurMinderNode() || this._isRootFocus) {\r\n                this._isRootFocus = false;\r\n                this.__triggerNodeEvent(KEY.NODE_BLUR);\r\n            }\r\n            //重新设置当前节点id\r\n            this.__setNodeId(nodeId);\r\n            //触发节点获取焦点事件\r\n            this.__triggerNodeEvent(KEY.NODE_DOWN, Utils.isMobile ? DOM_EVENT_TYPE.TOUCH : '');\r\n            //设置获取到的焦点\r\n            this.setCurMinderNode(minderNode);\r\n        },\r\n        focusRoot: function () {\r\n            this.focusNode(this._root.getNodeId(), this._root);\r\n        },\r\n        focusEditDisableRoot: function () {\r\n            this._isRootFocus = true;\r\n            this._root.drawFocusEditDisable();\r\n        },\r\n        nodeBlur: function () {\r\n            this.__triggerNodeEvent(KEY.NODE_BLUR);\r\n            this._nodeData = null;\r\n        },\r\n        _nodeCenterHandler: function (id) {\r\n            this._nodeCenterId = id;\r\n        },\r\n        _drawingHandler: function (status) {\r\n            var that = this;\r\n            if (status === 'start') {\r\n                that._isDrawing = true;\r\n                //触发其他节点失去焦点事件\r\n                if (this._plusOperate) {\r\n                    var id = $('#' + that._option.mindBodyId + ' #minder_0 > g:last').attr('id');\r\n                    var node = that.getMinderNodeById(id);\r\n                    if (this.getCurMinderNode() || this._isRootFocus) {\r\n                        this._isRootFocus = false;\r\n                        this.__triggerNodeEvent(KEY.NODE_BLUR);\r\n                    }\r\n                    //重新设置当前节点id\r\n                    this.__setNodeId(id);\r\n                    //设置获取到的焦点\r\n                    this.setCurMinderNode(node);\r\n                }\r\n                if (this._option.remarkVisible) {\r\n                    this.__triggerEvent(KEY.REMARK_SHOW, this.getCurMinderNode(), false);\r\n                }\r\n            } else if (status === 'end') {\r\n\r\n                that._isDrawing = false;\r\n                //pc端直接显示文本框\r\n                if (this._plusOperate && !Utils.isMobile) {\r\n\r\n                    if (this.getCurMinderNode() && this.getCurMinderNode().getMindNodeShape) {\r\n                        that.focusIn(this.getCurMinderNode())\r\n                    }\r\n                    //延迟执行，防止性能问题导致的绘制延迟\r\n                    that._editShowTimeOutId = setTimeout(function () {\r\n                        that.__triggerNodeEvent(KEY.NODE_DBLCLICK);\r\n                    }, 100);\r\n\r\n                } else if (this._nodeCenterId && Utils.isMobile) {\r\n                    //触发居中显示\r\n                    this._nodeToCenter(this.getMinderNodeById(this._nodeCenterId));\r\n                    this._nodeCenterId = '';\r\n                } else {\r\n                    if (this.getCurMinderNode() && this.getCurMinderNode().getMindNodeShape) {\r\n                        that.focusIn(this.getCurMinderNode())\r\n                    }\r\n                }\r\n                if (this._plusOperate) {\r\n                    //获取添加的节点id\r\n                    //触发节点获取焦点事件\r\n                    this.__triggerNodeEvent(KEY.NODE_DOWN, Utils.isMobile ? DOM_EVENT_TYPE.TOUCH : '');\r\n                }\r\n                if (this.getCurMinderNode() && this.getCurMinderNode().isActive()) {\r\n                    if (this._option.remarkVisible) {\r\n                        this.__triggerEvent(KEY.REMARK_SHOW, this.getCurMinderNode(), true);\r\n                    }\r\n                    //重新计算定位\r\n                    that.focusIn(this.getCurMinderNode());\r\n                }\r\n                this._plusOperate = false;\r\n            }\r\n        },\r\n        _init: function (e) {\r\n            var that = this;\r\n            //再次点击时，移除新建的焦点\r\n            this._plusOperate = false;\r\n            clearTimeout(that._editShowTimeOutId);\r\n            that._nodeData = that._getTargetNode(e);\r\n            that.__setNodeId(that._nodeData.id);\r\n            if (that.getCurMinderNode() && that.getCurMinderNode().getNodeId() !== that._nodeData.id) {\r\n                //触发旧节点失去焦点，样式还原\r\n                that.getCurMinderNode().__triggerNodeEvent(KEY.NODE_BLUR);\r\n                //触发隐藏其他菜单、文本框\r\n                that.__triggerEvent(KEY.DOM_HIDE, true);\r\n            } else {\r\n                if (this._menu) {\r\n                    this._menu.setVisible(false);\r\n                }\r\n            }\r\n            //设置当前获取焦点的节点\r\n            that.setCurMinderNode(that.getMinderNodeById(this._nodeData.id));\r\n        },\r\n        _getTargetNode: function (e) {\r\n            var that = this;\r\n            e = e.originalEvent || e;\r\n            if (e.srcElement) {\r\n                var node = e.srcElement;\r\n                var value;\r\n                while (node) {\r\n                    if (!value) {\r\n                        value = ID.getTargetValue(node.id);\r\n                    }\r\n                    if (ID.isNode(node.id)) {\r\n                        break;\r\n                    }\r\n                    node = node.parentNode;\r\n                }\r\n                if (node) {\r\n                    return {\r\n                        node: that._paper.getShapeById(node.id),\r\n                        id: node.id,\r\n                        value: value\r\n                    };\r\n                }\r\n            }\r\n            return {\r\n                node: that._minder,\r\n                id: that._minder.node.id\r\n            };\r\n        },\r\n        _delBtnEvent: function (e) {\r\n            var that = this;\r\n            var type = e.type || '';\r\n            if (type === 'mTap') {\r\n                that.__triggerEvent(KEY.DOM_HIDE, false);\r\n                //var nodeId = this.getCurMinderNode().getNodeId();\r\n                var minderNode = this.getCurMinderNode();\r\n                this.setCurMinderNode(null);\r\n                minderNode.__triggerNodeEvent(KEY.NODE_DELETE);\r\n            }\r\n        },\r\n        _plusEvent: function (e) {\r\n            var that = this;\r\n            var type = e.type || '';\r\n            if (type === 'mTap') {\r\n                that.__triggerEvent(KEY.DOM_HIDE, false);\r\n                this._plusOperate = true;\r\n                that.__triggerNodeEvent(KEY.NODE_TRIANGLE_CLICK, that._nodeData.value.orientation);\r\n            }\r\n\r\n        },\r\n        _expandEvent: function (e) {\r\n            var that = this;\r\n            var type = e.type || '';\r\n            if (type === 'mTap') {\r\n                that.__triggerEvent(KEY.DOM_HIDE, false);\r\n                that.__triggerNodeEvent(KEY.NODE_EXPAND);\r\n                that.__triggerNodeEvent(KEY.NODE_BLUR);\r\n            }\r\n        },\r\n        _nodeEvent: function (e) {\r\n            var that = this;\r\n            var type = e.mType || '';\r\n            var isRoot = ID.isRoot(that._nodeData.id);\r\n            //创建中的节点不允许操作\r\n            if (that._nodeData.node.getAttr('status') === 'creating') {\r\n                return;\r\n            }\r\n            switch (type) {\r\n                case 'mDblclick':\r\n                    //移动端交给mTap处理\r\n                    if (!Utils.isMobile) {\r\n                        that.__triggerNodeEvent(KEY.NODE_DBLCLICK);\r\n                    }\r\n                    break;\r\n                case 'mTap':\r\n                    that.__triggerNodeEvent(KEY.NODE_CLICK);\r\n                    //移动端、白板手写笔触发\r\n                    if (e.mTouchTrigger && that._isActiveBeforeDown) {\r\n                        //该节点文本框隐藏状态下才触发双击事件\r\n                        if (that.getCurMinderNode().isActive()) {\r\n                            //阻止触发双击事件\r\n                            e.preventDefault();\r\n                            if (Utils.isMobile && that.getCurMinderNode().getContentEditAble()) {\r\n                                that._dblClickTrigger = true;\r\n                                that.focusCenter(true);\r\n                            }\r\n                            that.__triggerNodeEvent(KEY.NODE_DBLCLICK);\r\n                            if (Utils.isMobile) {\r\n                                setTimeout(function () {\r\n                                    that._dblClickTrigger = false;\r\n                                }, 500);\r\n                            }\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'mTouchLong':\r\n                case 'contextmenu':\r\n                    //取消默认的菜单\r\n                    that.__triggerNodeEvent(KEY.NODE_RIGHT_CLICK);\r\n                    break;\r\n                case 'down':\r\n\r\n                    if (e.type === 'touchstart') {\r\n                        that._isActiveBeforeDown = that.getCurMinderNode().isActive() && that.getCurMinderNode().getTextVisible() && !that._editText.isVisible();\r\n                    }\r\n                    //触发移动覆盖事件\r\n                    that.nodeCoverMoveDown(that._nodeData.id);\r\n                    //触发节点获取焦点事件\r\n                    that.__triggerNodeEvent(KEY.NODE_DOWN, EventUtils.isTouch(e.type) ? DOM_EVENT_TYPE.TOUCH : DOM_EVENT_TYPE.MOUSE);\r\n                    //触发居中显示\r\n                    that.focusIn(that.getCurMinderNode())\r\n                    break;\r\n                case 'beforemove':\r\n                    if (!isRoot) {\r\n                        that.__triggerNodeEvent(KEY.NODE_BEFORE_MOVE);\r\n                    }\r\n                    this.mathTotalScale();\r\n                    break;\r\n                case 'move':\r\n                    if (!isRoot) {\r\n                        that.__triggerNodeEvent(KEY.NODE_MOVE, e.mMoveAbs.x / that.getTotalScale(), e.mMoveAbs.y / that.getTotalScale());\r\n                        //有移动才出发该事件\r\n                        that.nodeCoverMove();\r\n                    }\r\n                    break;\r\n                case 'aftermove':\r\n                    if (!isRoot) {\r\n                        that.__triggerNodeEvent(KEY.NODE_AFTER_MOVE);\r\n                    }\r\n                    break;\r\n                case 'up':\r\n                    var hasDraw = that.nodeCoverMoveUp();\r\n                    that.__triggerNodeEvent(KEY.NODE_UP, EventUtils.isTouch(e.type) ? DOM_EVENT_TYPE.TOUCH : DOM_EVENT_TYPE.MOUSE, hasDraw, e.mMoveTrigger);\r\n                    break;\r\n            }\r\n\r\n        },\r\n        _events: function (e) {\r\n            var that = this;\r\n            var type = e.mType;\r\n            if (type !== 'move') {\r\n                Logger.debug('dommevent', type);\r\n            }\r\n            //绘制中，不允许操作\r\n            if (that._isDrawing) {\r\n                //初始化节点，防止up时，节点信息还是旧的\r\n                if (e.mType === 'down') {\r\n                    that._init(e);\r\n                }\r\n                return;\r\n            }\r\n\r\n            //初始化\r\n            switch (e.mType) {\r\n                case 'down':\r\n                    //初始化节点\r\n                    that._init(e);\r\n                    break;\r\n                case 'mPinch':\r\n                    if (e.fingerStatus === 'move') {\r\n                        var scale = e.scale * that.getRelativeScale();\r\n                        that.scale(scale);\r\n                    }\r\n                    break;\r\n                case 'beforemove':\r\n                    that._minderCTM = that._minder.container.node.getCTM();\r\n                    that.__triggerEvent(KEY.DOM_HIDE, false);\r\n                    break;\r\n                case 'move':\r\n                    if (!that._option.editAble || ID.isRoot(that._nodeData.id) || that._nodeData.node === that._minder) {\r\n                        var x = e.mMoveAbs.x,\r\n                            y = e.mMoveAbs.y;\r\n                        if (that._minderCTM) {\r\n                            x /= that._minderCTM.a;\r\n                            y /= that._minderCTM.a;\r\n                        }\r\n                        that._minder.translate(x, y);\r\n                    }\r\n                    break;\r\n                case 'aftermove':\r\n                    if (!that._option.editAble || that._nodeData.node === that._minder) {\r\n                        that._option.onChange(CHANGE_REASON.MINDER_MOVE);\r\n                    }\r\n                    break;\r\n                case 'mDblclick':\r\n                    //移动端交给mTap处理\r\n                    if (that._nodeData.node === that._minder) {\r\n                        if (that._option.disableKeyMap.indexOf('mpdblclick') < 0) {\r\n                            that.matchParent();\r\n                            if (that._option.position.length > 0) {\r\n                                that.changePosition(that._option.position);\r\n                            }\r\n                        }\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            //交给各自职责的事件处理\r\n            if (that._nodeData && that._nodeData.value) {\r\n                var value = that._nodeData.value;\r\n                if (that._option.editAble) {\r\n                    if (value.type === 'expand') {\r\n                        that._expandEvent(e);\r\n                    } else if (value.type === 'plus') {\r\n                        that._plusEvent(e);\r\n                    } else if (value.type === 'node') {\r\n                        that._nodeEvent(e);\r\n                    } else if (value.type === 'del') {\r\n                        that._delBtnEvent(e);\r\n                    }\r\n                } else {\r\n                    //不可操作，但是可查看隐藏视图内容时触发\r\n                    if (value.type === 'node' && type === 'mTap' && that._option.contentClickViewAble) {\r\n                        that.__triggerNodeEvent(KEY.NODE_SHOW_CONTENT);\r\n                    } else if (value.type === 'expand') {\r\n                        that._expandEvent(e);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        bindDomEvent: function () {\r\n            var that = this;\r\n            that.__proxyAll(['_events', '_docKeyListener']);\r\n            //mTap一定要放在touch事件之后、切记（否则会调用两次）！！！ mPinch 放在touch之前！！！ 切记。先触发，先屏蔽移动move事件(jquery 1.7.1的问题)\r\n            //设置初始双指缩放强度\r\n            $(that._paper.node).attr('data-pinch-intensity', this._option.pinchIntensity);\r\n            //初始化\r\n            that._domEvents();\r\n            that._docKeyListener();\r\n            if (Utils.isMobile) {\r\n                $(that._paper.node).on(' mTap mDblclick contextmenu  touchstart touchmove touchend touchcancel  mPinch  mTouchLong', that._domEvents);\r\n            } else {\r\n                $(that._paper.node).on(' mTap mDblclick mousedown  mouseup mousemove contextmenu  mouseleave touchstart touchmove touchend touchcancel  mPinch mTouchLong ', that._domEvents);\r\n                //监听快捷键\r\n                $(document.body).on('keydown keyup mousewheel', that._docKeyListener);\r\n                //$(that._paper.node).on('keydown keyup mousewheel', that._docKeyListener);\r\n            }\r\n            var container = that._option.triggerBlurContainer || document.body;\r\n            that._outClickInstance = __M.Utils.OutClick.create(container);\r\n            $(that._paper.node).mOutclick(function () {\r\n                //触发旧节点失去焦点，样式还原\r\n                //that.__triggerNodeEvent(KEY.NODE_BLUR);\r\n                //触发隐藏其他菜单、文本框\r\n                that.__triggerEvent(KEY.DOM_HIDE, true);\r\n            }, $('#' + that._option.mindBodyId)[0], that._outClickInstance);\r\n        },\r\n        //处理内部事件调用逻辑\r\n        _domEvents: function () {\r\n            var that = this;\r\n\r\n            //修复pc端点击事件移动后还触发的问题\r\n            var __fixClick = function (_startPos, _endPos, _startTime, _endTime) {\r\n                var _holdTime = _endTime - _startTime;\r\n                var dx = Math.abs(_endPos.x - _startPos.x);\r\n                var dy = Math.abs(_endPos.y - _startPos.y);\r\n                if (_holdTime > 800 || dx >= 4 || dy >= 4) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            }\r\n\r\n            var _downTrigger = false;\r\n            var _touchTrigger = false;\r\n            var _moveTrigger = false;\r\n            var _pinchTrigger = false;\r\n            var _startTime = 0;\r\n            var _holdTime = 0;\r\n            var _startPos = {};\r\n            var _moveLastPos = {};\r\n            var __domEvents = function (e) {\r\n                if (that._option.lock) {\r\n                    return;\r\n                }\r\n                var type = e.type || '';\r\n\r\n                //双击事件触发事件,移动端键盘弹出的过程不处理其他事件，否则键盘会收起\r\n                if (Utils.isMobile && that._dblClickTrigger) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    return;\r\n                }\r\n\r\n                if (type !== 'mousemove' && type !== 'touchmove') {\r\n                    Logger.debug('domevent', type);\r\n                }\r\n\r\n                switch (type) {\r\n                    case 'contextmenu':\r\n                        //取消默认的菜单\r\n                        e.preventDefault();\r\n                        e.mType = type;\r\n                        break;\r\n                    case 'mousedown':\r\n                    case 'touchstart':\r\n                        _startTime = new Date().getTime();\r\n                        if (type === 'mousedown') {\r\n                            _startPos = EventUtils.getClientPos(e);\r\n                        }\r\n                        //多指触动时，不在触发该down事件。\r\n                        if (_downTrigger && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length > 1) {\r\n                            break;\r\n                        }\r\n\r\n                        _downTrigger = true;\r\n                        _moveTrigger = false;\r\n                        if (type === 'touchstart') {\r\n                            _touchTrigger = true;\r\n                        }\r\n\r\n                        e.mType = 'down';\r\n                        break;\r\n                    case 'mousemove':\r\n                    case 'touchmove':\r\n                        if (!_downTrigger) {\r\n                            return;\r\n                        }\r\n                        //缩放时不处理move事件\r\n                        e.preventDefault();\r\n                        if (_pinchTrigger) {\r\n                            return;\r\n                        }\r\n                        var p = Utils.getEventPagePos(e);\r\n                        var x = p.x - _moveLastPos.x;\r\n                        var y = p.y - _moveLastPos.y;\r\n                        e.mMoveAbs = {\r\n                            x: x,\r\n                            y: y\r\n                        };\r\n                        if (x !== 0 || y !== 0) {\r\n                            if (!_moveTrigger) {\r\n                                e.mType = 'beforemove';\r\n                                that._events(e);\r\n                            }\r\n                            e.mType = 'move';\r\n                            _moveTrigger = true;\r\n                        }\r\n                        break;\r\n                    case 'touchend':\r\n                    case 'touchcancel':\r\n                    case 'mouseup':\r\n                    case 'mouseleave':\r\n                        if (_moveTrigger) {\r\n                            e.mType = 'aftermove';\r\n                            that._events(e);\r\n                        }\r\n                        e.mMoveTrigger = _moveTrigger;\r\n                        _moveTrigger = false;\r\n                        _downTrigger = false;\r\n\r\n                        e.mType = 'up';\r\n                        break;\r\n                    case 'mTap':\r\n                        e.mType = type;\r\n\r\n                        //是否有touch事件触发\r\n                        if (e.tapEventSource === 'touchclick' || (e.tapEventSource === 'mouseclick' && _touchTrigger)) {\r\n                            e.mTouchTrigger = true;\r\n                        } else {\r\n                            e.mTouchTrigger = false;\r\n                        }\r\n                        _touchTrigger = false;\r\n                        //修复点击事件，超过时间和坐标不触发点击事件\r\n                        if (e.tapEventSource === 'mouseclick') {\r\n                            var fixed = __fixClick(_startPos, EventUtils.getClientPos(e), _startTime, new Date().getTime());\r\n                            if (!fixed) {\r\n                                return;\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'mDblclick':\r\n                        if (e.tapEventSource === 'mouseclick') {\r\n                            var fixed = __fixClick(_startPos, EventUtils.getClientPos(e), _startTime, new Date().getTime());\r\n                            if (!fixed) {\r\n                                return;\r\n                            }\r\n                        }\r\n                        e.mType = 'mDblclick';\r\n                        break;\r\n                    case 'mPinch':\r\n                        e.mType = type;\r\n\r\n                        if (e.fingerStatus === 'start') {\r\n                            _pinchTrigger = true;\r\n                        } else if (e.fingerStatus === 'move') {\r\n\r\n                        } else if (e.fingerStatus === 'end') {\r\n                            _pinchTrigger = false;\r\n                        }\r\n                        break;\r\n                    default:\r\n                        e.mType = type;\r\n                        break;\r\n                }\r\n                that._events(e);\r\n\r\n                if (EventUtils.isMove(type) || EventUtils.isDown(type)) {\r\n                    _moveLastPos = Utils.getEventPagePos(e);\r\n                }\r\n            };\r\n            that._domEvents = __domEvents;\r\n        },\r\n        removeDomEvent: function () {\r\n            $(document.body).off('keydown', this._docKeyListener);\r\n            $(document.body).off('keyup', this._docKeyListener);\r\n            $(document.body).off('mousewheel', this._docKeyListener);\r\n            if (this._outClickInstance) {\r\n                this._outClickInstance.disable();\r\n            }\r\n        },\r\n        _docKeyListener: function (e) {\r\n\r\n            var that = this;\r\n            var _keyDown = false;\r\n            var _keyCode = 0;\r\n            var _ctrlKey = false;\r\n\r\n            var __event = function (e) {\r\n                if (that._option.lock) {\r\n                    return;\r\n                }\r\n                switch (e.type) {\r\n                    case 'keydown':\r\n                        _keyDown = true;\r\n                        _keyCode = e.keyCode;\r\n                        _ctrlKey = e.ctrlKey;\r\n                        if (_ctrlKey) {\r\n                            if (that._option.disableKeyMap.indexOf('ctrl++/') < 0) {\r\n                                if (_keyCode === 187 || _keyCode === 107) {\r\n                                    e.preventDefault();\r\n                                    that.scale(that.getRelativeScale() + that.getRelativeScale() * 0.15);\r\n                                } else if (_keyCode === 189 || _keyCode === 109) {\r\n                                    e.preventDefault();\r\n                                    that.scale(that.getRelativeScale() - that.getRelativeScale() * 0.15);\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'keyup':\r\n                        _keyDown = false;\r\n                        _ctrlKey = false;\r\n                        _keyCode = 0;\r\n                        break;\r\n                    case 'mousewheel':\r\n                        //滚轮缩放\r\n                        if (that._option.disableKeyMap.indexOf('space+wheel') < 0) {\r\n                            if (_keyDown && _keyCode === 32) {\r\n                                e.preventDefault();\r\n                                //获取焦点，防止空格点击触发其他按钮点击事件\r\n                                $('#' + that._option.mindBodyId).find('#btn_focus').focus();\r\n                                that.scale(that.getRelativeScale() + (e.originalEvent.deltaY < 0 ? 1 : -1) * that.getRelativeScale() * 0.15);\r\n                            }\r\n                        }\r\n                        break;\r\n                }\r\n            };\r\n\r\n            that._docKeyListener = __event;\r\n\r\n            return;//二期处理快捷键 \r\n\r\n\r\n            Logger.debug('keycode', e.ctrlKey, e.keyCode);\r\n            if (that._paper) {\r\n                //刷新\r\n                if (!e.ctrlKey) {\r\n                    return;\r\n                }\r\n                var $$text;\r\n                try {\r\n                    $$text = that._paper.getShapeById(ID.getTextIdByNodeId(that._tempLastId));\r\n                } catch (e) {\r\n                }\r\n                if (!$$text) {\r\n                    return;\r\n                }\r\n                var text = $$text.getContent();\r\n                if (that._option.showMenu) {\r\n                    that._menu.__setNodeId(that._tempLastId);\r\n                    //复制\r\n                    if (e.ctrlKey && e.keyCode === 67) {\r\n                        that._menu.triggerMenuClick(MENU_TYPE_KEY.COPY, text);\r\n                    }\r\n                    //黏贴\r\n                    if (e.ctrlKey && e.keyCode === 86) {\r\n                        if (!that._clipboard.isEmpty()) {\r\n                            that._menu.triggerMenuClick(MENU_TYPE_KEY.PASTE, text);\r\n                        }\r\n                    }\r\n                    //剪切\r\n                    if (e.ctrlKey && e.keyCode === 88) {\r\n                        that._menu.triggerMenuClick(MENU_TYPE_KEY.CUT, text);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    __M.MindCore.__include(DomEvent);\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/29.\r\n */\r\n\r\n(function (window, $, __M) {\r\n    var Logger = __M.Logger;\r\n    var Utils = __M.Utils;\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var MENU_TYPE_KEY = __M.Config.MENU_TYPE_KEY;\r\n\r\n\r\n    var HotKeys = {\r\n        _hotKeys: [],\r\n        _register: function (name, key, callback, ctrl, shift) {\r\n            this._hotKeys.push({\r\n                name: name,\r\n                key: key,\r\n                callback: callback,\r\n                ctrl: ctrl,\r\n                shift: shift\r\n            });\r\n        },\r\n        _initHotKey: function () {\r\n            this._register('enter', [13, 108], this._enter);//增加统计节点\r\n            this._register('space+wheel', [32], this._spaceWheel);//缩放\r\n            this._register('ctrl+plus', [187, 107], this._ctrlPlus, true);//放大\r\n            this._register('ctrl+subtract', [109, 189], this._ctrlSubtract, true);//缩小\r\n            this._register('ctrl+a', [65], this._ctrlA, true);//全选\r\n            this._register('ctrl+c', [67], this._ctrlC, true);//复制\r\n            this._register('ctrl+v', [86], this._ctrlV, true);//黏贴\r\n            this._register('ctrl+x', [88], this._ctrlX, true);//剪切\r\n            this._register('ctrl+click', [88], this._ctrlClick, true);//多选 TODO:\r\n            this._register('ctrl+move', [88], this._ctrlMove, true);//框选 TODO:\r\n            this._register('tab', [9], this._tab);//增加子节点\r\n            this._register('delete', [46], this._delete);//删除节点\r\n            this._register('arrows', [37, 38, 39, 40], this._arrows);//上下左右移动选中的节点\r\n          },\r\n        _ctrlSubtract: function () {\r\n\r\n        },\r\n        _ctrlPlus: function () {\r\n\r\n        },\r\n        _ctrlMove: function () {\r\n\r\n        },\r\n        _ctrlClick: function () {\r\n\r\n        },\r\n        _arrows: function () {\r\n\r\n        },\r\n        _delete: function () {\r\n\r\n        },\r\n        _enter: function () {\r\n\r\n        },\r\n        _spaceWheel: function () {\r\n\r\n        },\r\n        _ctrlA: function () {\r\n\r\n        },\r\n        _ctrlC: function () {\r\n\r\n        },\r\n        _ctrlV: function () {\r\n\r\n        },\r\n        _ctrlX: function () {\r\n\r\n        },\r\n        _tab: function () {\r\n\r\n        },\r\n        removeDomEvent: function () {\r\n            $(document.body).off('keydown', this._docKeyListener);\r\n            $(document.body).off('keyup', this._docKeyListener);\r\n            $(document.body).off('mousewheel', this._docKeyListener);\r\n        },\r\n        _docKeyListener: function (e) {\r\n        }\r\n    };\r\n\r\n    __M.MindCore.__include({});\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/29.\r\n */\r\n\r\n(function (window, $, __M) {\r\n    var Logger = __M.Logger;\r\n    var Utils = __M.Utils;\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var ID = __M.ID;\r\n    var _nodeStyle = __M.Config.nodeStyle;\r\n\r\n    //当前作用域变量\r\n    var MoveCover = {\r\n        _coverType: '',//覆盖类型\r\n        _coverTargetRectPath: null,//父子节点：覆盖的节点\r\n        _coverPlaceholderRectPath: null,//兄弟节点：覆盖节点\r\n        _mouseRateNum: 0,//移动计算频率\r\n        _curMoveMinderNode: null,\r\n        _getCurMoveMinderNode: function () {\r\n            return this._curMoveMinderNode;\r\n        },\r\n        //还原覆盖的节点样式\r\n        _recoveryRectPathStyle: function () {\r\n            if (this._coverTargetRectPath.nodeId) {\r\n                var $rectPath = $('#' + this._option.mindBodyId + ' #' + this._coverTargetRectPath.nodeId + '>path');\r\n                $rectPath.css(_nodeStyle.strokeStyle);\r\n            }\r\n        },\r\n        //是否覆盖其他非子节点\r\n        _isCoverOtherRect: function (curNodePos) {\r\n            var rectA = {};\r\n            rectA.p1 = {\r\n                x: curNodePos.innerRectX,\r\n                y: curNodePos.innerRectY\r\n            };\r\n            rectA.p2 = {\r\n                x: curNodePos.innerRectX + curNodePos.innerRectWidth,\r\n                y: curNodePos.innerRectY + curNodePos.innerRectHeight\r\n            };\r\n            var nodesPos = this.getRoot().rtGetPosRecords();\r\n            var paddingSpaceX = _nodeStyle.width / 10;\r\n            var paddingSpaceY = _nodeStyle.height / 8;\r\n            for (var key in nodesPos) {\r\n                var nPos = nodesPos[key];\r\n                if (!nPos.visible) {\r\n                    continue;\r\n                }\r\n                if (nPos.containParentId.indexOf(curNodePos.containParentId) >= 0) {\r\n                    continue;\r\n                }\r\n                var rectB = {};\r\n                //取目标矩形的三分之一中心位置去比较是否覆盖\r\n                rectB.p1 = {\r\n                    x: nPos.innerRectX + paddingSpaceX,\r\n                    y: nPos.innerRectY + paddingSpaceY\r\n                };\r\n                rectB.p2 = {\r\n                    x: nPos.innerRectX + nPos.innerRectWidth - paddingSpaceX,\r\n                    y: nPos.innerRectY + nPos.innerRectHeight - paddingSpaceY\r\n                };\r\n                //根据两矩形坐标判断是否相交\r\n                if (Utils.checkRectsCross(rectA, rectB)) {\r\n                    return {\r\n                        success: true,\r\n                        coverNodeId: key\r\n                    };\r\n                }\r\n            }\r\n            return {success: false};\r\n        },\r\n        //是否覆盖同级节点顺序变化区域\r\n        _isCoverPlaceholderRect: function (curNodePos) {\r\n            var rectA = {};\r\n            rectA.p1 = {\r\n                x: curNodePos.innerRectX,\r\n                y: curNodePos.innerRectY\r\n            };\r\n            rectA.p2 = {\r\n                x: curNodePos.innerRectX + curNodePos.innerRectWidth,\r\n                y: curNodePos.innerRectY + curNodePos.innerRectHeight\r\n            };\r\n            var nodesPos = this.getRoot().rtGetPosRecords();\r\n            var paddingSpaceX = _nodeStyle.width / 10;\r\n            var paddingSpaceY = _nodeStyle.height / 8;\r\n            for (var key in nodesPos) {\r\n\r\n                var nPos = nodesPos[key];\r\n                if (!nPos.visible) {\r\n                    continue;\r\n                }\r\n                //如果是当前移动节点子节点则无需要判断\r\n                if (nPos.containParentId.indexOf(curNodePos.containParentId) >= 0) {\r\n                    continue;\r\n                }\r\n\r\n                var curParentId = curNodePos.containParentId.substring(0, curNodePos.containParentId.length - curNodePos.nodeId.length);\r\n                var tempParentId = nPos.containParentId.substring(0, nPos.containParentId.length - key.length);\r\n\r\n                //父节点相同的同级节点才做顺序改变\r\n                if (curParentId !== tempParentId) {\r\n                    continue;\r\n                }\r\n\r\n                var rectB = {};\r\n                //取目标矩形的三分之一中心位置去比较是否覆盖\r\n                rectB.p1 = {\r\n                    x: nPos.innerRectX + paddingSpaceX,\r\n                    y: nPos.innerRectY + paddingSpaceY\r\n                };\r\n                rectB.p2 = {\r\n                    x: nPos.innerRectX + nPos.innerRectWidth - paddingSpaceX,\r\n                    y: nPos.innerRectY + _nodeStyle.height - paddingSpaceY\r\n                };\r\n                //取目标矩形上方同等矩形的三分之一中心位置去比较是否覆盖\r\n                var topRect = {\r\n                    p1: {\r\n                        x: rectB.p1.x,\r\n                        y: rectB.p1.y - _nodeStyle.height\r\n                    },\r\n                    p2: {\r\n                        x: rectB.p2.x,\r\n                        y: rectB.p2.y - _nodeStyle.height\r\n                    }\r\n                };\r\n                //取目标矩形下方同等矩形的三分之一中心位置去比较是否覆盖\r\n                var bottomRect = {\r\n                    p1: {\r\n                        x: rectB.p1.x,\r\n                        y: rectB.p1.y + nPos.innerRectHeight\r\n                    },\r\n                    p2: {\r\n                        x: rectB.p2.x,\r\n                        y: rectB.p2.y + nPos.innerRectHeight\r\n                    }\r\n                };\r\n                //根据两矩形坐标判断是否相交\r\n                if (Utils.checkRectsCross(rectA, topRect)) {\r\n                    return {\r\n                        success: true,\r\n                        nodeId: key,\r\n                        direction: 'top'\r\n                    };\r\n                } else if (Utils.checkRectsCross(rectA, bottomRect)) {\r\n                    return {\r\n                        success: true,\r\n                        nodeId: key,\r\n                        direction: 'bottom'\r\n                    };\r\n                }\r\n            }\r\n            return {success: false};\r\n        },\r\n        _coverReset: function () {\r\n            this._curMoveMinderNode = null;\r\n            this._mouseRateNum = 0;\r\n            this._coverTargetRectPath = {};\r\n            this._coverPlaceholderRectPath = {};\r\n            this._coverType = '';\r\n        },\r\n        nodeCoverMoveUp: function () {\r\n            if (!this._getCurMoveMinderNode()) {\r\n                return;\r\n            }\r\n            //恢复当前节点样式\r\n            var coverType = this._coverType,\r\n                coverId = this._coverTargetRectPath.nodeId,\r\n                curMinderNode = this._getCurMoveMinderNode(),\r\n                curNodeId = curMinderNode.getNodeId(),\r\n                hasDraw = false;\r\n\r\n            //隐藏占位符\r\n            this._placeholder.setVisible(false);\r\n            //恢复样式\r\n            this._recoveryRectPathStyle();\r\n\r\n            if (curMinderNode) {\r\n                if (coverType === 'cover') {\r\n                    //父子节点关系变化\r\n                    if (coverId !== null\r\n                        && coverId !== curNodeId) {\r\n                        //不能修改父节点，直接还原\r\n                        if (!this._curMoveMinderNode.getChangeParentAble()) {\r\n                            //&& curMinderNode.getParent().getNodeId() !== coverId) {\r\n                            this.__triggerNodeEventByNodeId(KEY.NODE_RESTORE, curNodeId);\r\n                        } else {\r\n                            this.__triggerNodeEventByNodeId(KEY.NODE_COVER, coverId, curMinderNode);\r\n                        }\r\n                        hasDraw = true;\r\n                    }\r\n                } else if (coverType === 'coverPlaceholder') {\r\n                    //兄弟节点关系变化\r\n                    var coverDirection = this._coverPlaceholderRectPath.direction;\r\n                    coverId = this._coverPlaceholderRectPath.nodeId;\r\n                    if (!this._curMoveMinderNode.getChangeBroAble()) {\r\n                        //this.__triggerNodeEventByNodeId(KEY.NODE_RESTORE, curNodeId);\r\n                        hasDraw = true;\r\n                    } else {\r\n                        hasDraw = curMinderNode.drawAndChangeBroRelation(coverId, coverDirection);\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._coverReset();\r\n            return hasDraw;\r\n        },\r\n        nodeCoverMove: function () {\r\n            var that = this;\r\n            if (!this._getCurMoveMinderNode()) {\r\n                return;\r\n            }\r\n            that._mouseRateNum++;\r\n            //设置移动时节点样式\r\n            this._getCurMoveMinderNode().getRectPath().setStyle(_nodeStyle.moveStyle);\r\n\r\n            //拖动执行平率为0.25\r\n            if (that._mouseRateNum % 2 !== 0) {\r\n                return;\r\n            }\r\n            var curNodPos = that._getCurMoveMinderNode().getCurNodePosition();\r\n\r\n            //是否覆盖其他节点\r\n            var coverResult = that._isCoverOtherRect(curNodPos);\r\n            //第一个分支：当前节点是否与其它节点覆盖\r\n            if (coverResult.success === true) {\r\n                if (!this._coverTargetRectPath.nodeId || this._coverTargetRectPath.nodeId !== coverResult.coverNodeId) {\r\n\r\n                    //还原被覆盖的旧节点样式\r\n                    that._recoveryRectPathStyle();\r\n\r\n                    //设置被覆盖的节点样式\r\n                    this._coverTargetRectPath = {\r\n                        nodeId: coverResult.coverNodeId\r\n                    };\r\n\r\n                    this._coverType = 'cover';\r\n                    Logger.info(' TargetRect is cover at moving! ');\r\n\r\n                    //不能修改父节点\r\n                    if (!this._curMoveMinderNode.getChangeParentAble()) {\r\n                        //&& this._getCurMoveMinderNode().getParent().getNodeId() !== coverResult.coverNodeId) {\r\n                        return\r\n                    }\r\n\r\n                    var $rectPath = $('#' + that._option.mindBodyId + ' #' + coverResult.coverNodeId + '>path');\r\n                    $rectPath.css(_nodeStyle.moveCoverStyle);\r\n                }\r\n                this._placeholder.setVisible(false);\r\n            } else {\r\n                //是否移动到同级节点占位符\r\n                coverResult = this._isCoverPlaceholderRect(curNodPos);\r\n\r\n                if (coverResult.success === true) {\r\n                    this._coverPlaceholderRectPath = coverResult;\r\n\r\n                    var $$phRect = this._placeholder.getRectShape();\r\n                    var $$coverRectPath = this.getShapeById(coverResult.nodeId);\r\n                    var tempIndex = Utils.String.getTemplateValue(coverResult.nodeId, ID._nodeId).i;\r\n                    var $$innerRect = this.getShapeById(ID.getTextBorderId(tempIndex));\r\n                    var heightRate = 0.7;\r\n                    //设置占位宽高\r\n                    $$phRect.setWidth($$innerRect.getWidth());\r\n                    $$phRect.setHeight(_nodeStyle.height * heightRate);\r\n                    //获取覆盖的节点位置信息\r\n                    var matrix = $$coverRectPath.getTransform();\r\n                    var innerMatrix = $$innerRect.getTransform();\r\n                    matrix.m.e += innerMatrix.m.e;\r\n                    matrix.m.f += innerMatrix.m.f;\r\n\r\n                    if (coverResult.direction === 'top') {\r\n                        matrix.m.f -= (_nodeStyle.height * heightRate + 5);\r\n                    } else {\r\n                        matrix.m.f += $$innerRect.getHeight() + 5;\r\n                    }\r\n                    this._placeholder.setMatrix(matrix);\r\n                    if (this._curMoveMinderNode.getChangeBroAble()) {\r\n                        this._placeholder.setVisible(true);\r\n                    }\r\n                    this._coverType = 'coverPlaceholder';\r\n                } else {\r\n                    this._placeholder.setVisible(false);\r\n                    this._coverType = '';\r\n                }\r\n                //还原之前被覆盖的节点样式\r\n                this._recoveryRectPathStyle();\r\n                this._coverTargetRectPath = {};\r\n            }\r\n        },\r\n        nodeCoverMoveDown: function (nodeId) {\r\n            //获取当前移动的节点\r\n            this._curMoveMinderNode = this.getMinderNodeById(nodeId);\r\n            if (this._curMoveMinderNode.isRoot() || !this._curMoveMinderNode.getMoveAble()) {\r\n                this._curMoveMinderNode = null;\r\n                return;\r\n            }\r\n\r\n            //初始化数据\r\n            this._mouseRateNum = 0;\r\n            this._coverTargetRectPath = {};\r\n            this._coverPlaceholderRectPath = {};\r\n            this._coverType = '';\r\n            //清除不存在的节点\r\n            var positionRecord = this.getRoot().rtGetPosRecords();\r\n            for (var key in positionRecord) {\r\n                var shape = this.getShapeById(key);\r\n                if (!shape) {\r\n                    delete positionRecord[key];\r\n                } else {\r\n                    positionRecord[key].visible = shape.node.getAttribute(\"display\") !== 'none';\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    __M.MindCore.__include(MoveCover);\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/5/24.\r\n */\r\n\r\n(function (window, $, __M) {\r\n    var Logger = __M.Logger;\r\n    var CHANGE_REASON = __M.Config.CHANGE_REASON;\r\n\r\n    var setExtentProperties = function (dataPath, node, value) {\r\n        if (dataPath === 'requireChildren') {\r\n            node.setRequireChildren(value);\r\n        }\r\n        if (dataPath === 'requireContent') {\r\n            node.setRequireContent(value);\r\n        }\r\n        if (dataPath === 'contentEditAble') {\r\n            node.setContentEditAble(value);\r\n        }\r\n        if (dataPath === 'deleteAble') {\r\n            node.setDeleteAble(value);\r\n        }\r\n        if (dataPath === 'moveAble') {\r\n            node.setMoveAble(value);\r\n        }\r\n        if (dataPath === 'changeParentAble') {\r\n            node.setChangeParentAble(value);\r\n        }\r\n        if (dataPath === 'changeBroAble') {\r\n            node.setChangeBroAble(value);\r\n        }\r\n    }\r\n\r\n    // patch.op - 操作，包括 remove, add, replace\r\n    // patch.path - 路径，如 '/root/children/1/data'\r\n    // patch.value - 数据，如 { text: \"思路\" }\r\n    var Patch = {\r\n        _createNode: function (patchData, parentNode, index) {\r\n            var node = parentNode.addNode(patchData, index, true);\r\n            node.setExpand(patchData.isExpand);\r\n            if (patchData.matrix) {\r\n                var matrixAr = patchData.matrix.split(' '),\r\n                    targetMatrix;\r\n                if (matrixAr.length === 6) {\r\n                    targetMatrix = new kity.Matrix(matrixAr[0], matrixAr[1], matrixAr[2], scale, matrixAr[4], matrixAr[5]);\r\n                } else {\r\n                    targetMatrix = new kity.Matrix(1, 0, 0, 1, matrixAr[0], matrixAr[1]);\r\n                }\r\n                node.setMatrix(targetMatrix);\r\n            }\r\n\r\n            return node;\r\n        },\r\n        insertNode: function (info, parent, index) {\r\n            var that = this;\r\n            parent = this._createNode(info.data, parent, index);\r\n            info.children.forEach(function (childInfo, index) {\r\n                that.insertNode(childInfo, parent, index);\r\n            });\r\n            return parent;\r\n        },\r\n        patches: function (patches) {\r\n            var reason = '';\r\n            for (var i = 0; i < patches.length; i++) {\r\n                this.patch(patches[i]);\r\n                var path = patches[i].path.split('/');\r\n                var content = path.pop();\r\n                var op = patches[i].op;\r\n                if (op === 'add') {\r\n                    reason = CHANGE_REASON.ADD;\r\n                } else if (op === 'remove') {\r\n                    reason = CHANGE_REASON.DELETE;\r\n                } else if (op === 'replace') {\r\n                    if (content === 'text') {\r\n                        reason = CHANGE_REASON.TEXT_CONTENT;\r\n                    }\r\n                    if (content === 'orientation') {\r\n                        reason = CHANGE_REASON.ORIENTATION_CHANGE;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.getRoot().trvShow();\r\n            this.getRoot().trvDrawInit();\r\n            if (reason) {\r\n                this._option.onChange(reason);\r\n            }\r\n            return this;\r\n        },\r\n        patch: function (patch) {\r\n            var path = patch.path.split('/');\r\n            path.shift();\r\n            var changed = path.shift();\r\n            var node;\r\n            if (changed == 'root') {\r\n                var dataIndex = path.indexOf('data');\r\n                if (dataIndex > -1) {\r\n                    changed = 'data';\r\n                    var dataPath = path.splice(dataIndex + 1);\r\n                    patch.dataPath = dataPath;\r\n                } else {\r\n                    changed = 'node';\r\n                }\r\n                node = this.getRoot();\r\n                var segment, index;\r\n                while (segment = path.shift()) {\r\n                    if (segment == 'children') continue;\r\n                    if (typeof index != 'undefined') node = node.getChild(index);\r\n                    index = +segment;\r\n                }\r\n                patch.index = index;\r\n                patch.node = node;\r\n\r\n            }\r\n\r\n            var express = patch.express = [changed, patch.op].join(\".\");\r\n            Logger.debug('diff-patch', patch);\r\n            //if (express !== 'minder.replace' && !patch.node) {\r\n            //    return;\r\n            //}\r\n            switch (express) {\r\n                case \"minder.replace\":\r\n                    var matrixAr = patch.value.split(' '),\r\n                        scale = this._minder.getTransform().m.a,\r\n                        targetMatrix;\r\n                    //不改变缩放值\r\n                    if (matrixAr.length === 6) {\r\n                        targetMatrix = new kity.Matrix(scale, matrixAr[1], matrixAr[2], scale, matrixAr[4], matrixAr[5]);\r\n                    } else {\r\n                        targetMatrix = new kity.Matrix(scale, 0, 0, scale, matrixAr[0], matrixAr[1]);\r\n                    }\r\n                    this._minder.setMatrix(targetMatrix);\r\n                    break;\r\n                case \"node.add\":\r\n                    this.insertNode(patch.value, patch.node, patch.index);\r\n                    break;\r\n                case \"node.remove\":\r\n                    //if (patch.node && patch.node.getChild(patch.index)) {\r\n                    patch.node.getChild(patch.index).destroy();\r\n                    //} else {\r\n                    //    Logger.debug('diff-patch-node.remove-null', patch);\r\n                    //}\r\n                    break;\r\n                case \"data.replace\":\r\n                    var dataPath = patch.dataPath.shift();\r\n                    if (dataPath === 'text') {\r\n                        patch.node.setText(patch.value);\r\n                        patch.node.layoutBox();\r\n                    }\r\n                    if (dataPath === 'matrix') {\r\n                        var matrixAr = patch.value.split(' '),\r\n                            targetMatrix;\r\n\r\n                        if (matrixAr.length === 6) {\r\n                            targetMatrix = new kity.Matrix(matrixAr[0], matrixAr[1], matrixAr[2], scale, matrixAr[4], matrixAr[5]);\r\n                        } else {\r\n                            targetMatrix = new kity.Matrix(1, 0, 0, 1, matrixAr[0], matrixAr[1]);\r\n                        }\r\n                        patch.node.setMatrix(targetMatrix);\r\n                    }\r\n                    if (dataPath === 'textVisible') {\r\n                        patch.node.setTextVisible(patch.value);\r\n                        patch.node.layoutBox();\r\n                    }\r\n                    if (dataPath === 'isExpand') {\r\n                        patch.node.setExpand(patch.value);\r\n                        patch.node.trvShow();\r\n                    }\r\n                    if (dataPath === 'identifier') {\r\n                        patch.node.setIdentifier(patch.value);\r\n                    }\r\n                    setExtentProperties(dataPath, patch.node, patch.value);\r\n                    if (dataPath === 'requireChildren') {\r\n                        patch.node.layoutBox();\r\n                    }\r\n                    break;\r\n                case 'data.remove':\r\n                    var dataPath = patch.dataPath.shift();\r\n                    setExtentProperties(dataPath, patch.node, undefined);\r\n                    if (dataPath === 'requireChildren') {\r\n                        patch.node.layoutBox();\r\n                    }\r\n                    break;\r\n                case 'data.add':\r\n                    var dataPath = patch.dataPath.shift();\r\n                    setExtentProperties(dataPath, patch.node, patch.value);\r\n                    if (dataPath === 'requireChildren') {\r\n                        patch.node.layoutBox();\r\n                    }\r\n                    break;\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n\r\n    __M.MindCore.__include(Patch);\r\n}(window, jQuery, __M));\n(function (window, $, __M) {\r\n\r\n    var Utils = __M.Utils;\r\n    var Logger = __M.Logger;\r\n    var CHANGE_REASON = __M.Config.CHANGE_REASON;\r\n\r\n    var MAX_HISTORY = 20;\r\n\r\n\r\n    __M.History = {\r\n        _undoDiffs: null,\r\n        _redoDiffs: null,\r\n        _minder: null,\r\n        _lastSnap: null,\r\n        _patchLock: null,\r\n        create: function (minder) {\r\n            var instance = Object.create(this);\r\n            instance._undoDiffs = [];\r\n            instance._redoDiffs = [];\r\n            instance._minder = minder;\r\n            instance._lastSnap = instance.getData();\r\n\r\n            instance._minder.on(\"change\", instance.changed, instance);\r\n            instance._minder.on(\"rendered\", instance.reset, instance);\r\n            return instance;\r\n        },\r\n        reset: function () {\r\n            this._undoDiffs = [];\r\n            this._redoDiffs = [];\r\n            this._lastSnap = this.getData();\r\n        },\r\n        getData: function () {\r\n            return this._minder.getData(true, true);\r\n        },\r\n        makeUndoDiff: function () {\r\n            var headSnap = this.getData();\r\n            var diff = Utils.JsonDiff.compare(headSnap, this._lastSnap);\r\n            Logger.debug('diff-undo', JSON.stringify(diff));\r\n            Logger.debug('diff-undo', JSON.stringify(diff), this._undoDiffs, headSnap, this._lastSnap);\r\n            if (diff.length) {\r\n                this._undoDiffs.push(diff);\r\n                while (this._undoDiffs.length > MAX_HISTORY) {\r\n                    this._undoDiffs.shift();\r\n                }\r\n                this._lastSnap = headSnap;\r\n                return true;\r\n            }\r\n        },\r\n        makeRedoDiff: function () {\r\n            var revertSnap = this.getData();\r\n            var diff = Utils.JsonDiff.compare(revertSnap, this._lastSnap);\r\n            this._redoDiffs.push(diff);\r\n            Logger.debug('diff-redo', JSON.stringify(diff));\r\n            Logger.debug('diff-redo', diff, this._redoDiffs);\r\n            this._lastSnap = revertSnap;\r\n        },\r\n        undo: function () {\r\n            this._patchLock = true;\r\n            var undoDiff = this._undoDiffs.pop();\r\n            if (undoDiff) {\r\n                this._minder._mindCore.patches(undoDiff);\r\n                this.makeRedoDiff();\r\n            }\r\n            this._minder._eventBus.trigger('change', CHANGE_REASON.UNDO_REDO);\r\n            this._patchLock = false;\r\n        },\r\n        redo: function () {\r\n            this._patchLock = true;\r\n            var redoDiff = this._redoDiffs.pop();\r\n            if (redoDiff) {\r\n                this._minder._mindCore.patches(redoDiff);\r\n                this.makeUndoDiff();\r\n            }\r\n            this._minder._eventBus.trigger('change', CHANGE_REASON.UNDO_REDO);\r\n            this._patchLock = false;\r\n        },\r\n        changed: function (type) {\r\n            if (type === CHANGE_REASON.RENDER) {\r\n                this.reset();\r\n                return;\r\n            }\r\n            if (this._patchLock) return;\r\n            if (this.makeUndoDiff()) this._redoDiffs = [];\r\n        },\r\n        hasUndo: function () {\r\n            return !!this._undoDiffs.length;\r\n        },\r\n        hasRedo: function () {\r\n            return !!this._redoDiffs.length;\r\n        }\r\n    }\r\n\r\n}(window, jQuery, __M));\n/**\r\n * Created by ylf on 2016/3/31.\r\n */\r\n\r\n(function (window, $, __M) {\r\n    var MindCore = __M.MindCore;\r\n    var Event = __M.Event;\r\n    var Logger = __M.Logger;\r\n    var Utils = __M.Utils;\r\n    var Lang = __M.Config.DefaultLang;\r\n    var KEY = __M.Config.EVENT_KEY;\r\n    var CHANGE_REASON = __M.Config.CHANGE_REASON;\r\n\r\n    //对外抛出的参数\r\n    var OPTION = {\r\n        create: function (option) {\r\n            var instance = Object.create(this);\r\n            if (option) {\r\n                for (var key in option) {\r\n                    instance[key] = option[key];\r\n                    if (key === 'langData') {\r\n                        instance[key] = $.extend(true, {}, Lang, option.langData);\r\n                    } else {\r\n                        if (option[key] !== null) {\r\n                            instance[key] = option[key];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            //TODO:先强制移除移动端的动画效果，后续如果性能跟的上再打开\r\n            if (Utils.isMobile) {\r\n                instance.animate = false;\r\n                //instance.baseScale=1.4\r\n            } else {\r\n                //instance.baseScale=1.5\r\n            }\r\n\r\n            if (instance.rootVertical) {\r\n                instance.rootPaddingX = 10;\r\n                instance.rootPaddingY = 15;\r\n                instance.rootMinWidth = 43;\r\n            }\r\n            if (instance.type !== 'both') {\r\n                instance.autoRideCount = 10000;\r\n            }\r\n\r\n            return instance;\r\n        },\r\n        lock: false,//是否锁定\r\n        maxScale: 2.5,\r\n        minScale: 0.1,\r\n        editAble: true,//是否可编辑，设置为false,则只能整体移动、展开收起\r\n        animate: true,//是否显示动画\r\n        showMenu: true,//是否显示菜单\r\n        ignoreAttrTextVisible: false,//使数据中textVisible无效\r\n        contentClickViewAble: false,//是否可点击查看隐藏内容\r\n        renderDataAutoLayout: true,//初始化数据时是否进行自动布局，默认自动布局\r\n        pinchIntensity: 0.8,//缩放灵敏度，值越大越快,\r\n        baseScale: 1.0,//默认缩放尺寸，对外部透明，所有的缩放值都是以这个为基准\r\n        disableKeyMap: [],//已经使用的keymap: 缩放： ctrl++/  space+wheel  、 自动缩放布局(matchparent)：mpdblclick\r\n        hideMenuItem: [],//copy edit visible cut paste delete\r\n        langData: Lang,\r\n        triggerBlurContainer: null,//触发失去节点\r\n        autoRideCount: 4,//左右自动排版的触发值\r\n        type: 'both',//思维导图类型： left  right both\r\n        rootVertical: false,//根节点垂直样式\r\n        showRequireStar: false,//显示星号\r\n        showRequireFill: true,//是否显示必填项，填写之后的颜色\r\n        remarkVisible: false,//显示备注\r\n        remarkEditAble: false,//备注可编辑\r\n        viewPort: [],\r\n        position: []// left top bottom right\r\n    };\r\n\r\n    window.MinderMap = {\r\n        _mindCore: null,\r\n        _eventBus: null,\r\n        _commandQueue: null,\r\n        _history: null,\r\n        _lang: null,\r\n        create: function (option) {\r\n            var instance = Object.create(this);\r\n            option = OPTION.create(option);\r\n\r\n            //instance._lang = option.langData;\r\n            //初始化语言包\r\n            // __M.Config.Lang = option.langData;\r\n            //绑定缩放事件\r\n            option.onScale = function (scale) {\r\n                instance._eventBus.trigger('scale', scale);\r\n            };\r\n\r\n            option.onChange = function (type) {\r\n                if (type === CHANGE_REASON.MINDER_MOVE || type === CHANGE_REASON.MINDER_SCALE) {\r\n                    instance._mindCore.resizeRemark();\r\n                    return;\r\n                }\r\n                instance._eventBus.trigger('change', type);\r\n                //内容有变化才触发\r\n                if (type === CHANGE_REASON.BRO_RELATION\r\n                    || type === CHANGE_REASON.PARENT_CHANGE\r\n                    || type === CHANGE_REASON.DELETE\r\n                    || type === CHANGE_REASON.TEXT_CONTENT\r\n                    || type === CHANGE_REASON.ORIENTATION_CHANGE\r\n                    || type === CHANGE_REASON.ADD\r\n                    || type === CHANGE_REASON.CLEAR\r\n                ) {\r\n                    instance._eventBus.trigger('contentChange', type);\r\n                }\r\n            };\r\n            instance._eventBus = Event.create();\r\n            instance._mindCore = MindCore.create(option);\r\n\r\n            //创建命令队列\r\n            instance._history = __M.History.create(instance);\r\n            return instance;\r\n        },\r\n        render: function (obj) {\r\n            var type = typeof  obj;\r\n            if (type === 'string') {\r\n                obj = document.getElementById(obj);\r\n            } else if (type === 'object') {\r\n                if (obj instanceof jQuery) {\r\n                    obj = obj[0];\r\n                }\r\n            }\r\n            this._mindCore.render(obj);\r\n            this._eventBus.trigger('rendered', '');\r\n            //发送change事件，更新undo/redo\r\n            this._eventBus.trigger('change', CHANGE_REASON.RENDER);\r\n        },\r\n        setData: function (data) {\r\n            this._mindCore.setData(data);\r\n        },\r\n        getData: function (ignoreRemark, ignoreOffset) {\r\n            return this._mindCore.getData(ignoreRemark, ignoreOffset);\r\n        },\r\n        rootCenter: function () {\r\n            this._mindCore.rootCenter();\r\n            if (!this._mindCore.getEditAble()) {\r\n                this._mindCore.focusEditDisableRoot();\r\n            } else if (!this._mindCore.getLock()) {\r\n                this._mindCore.focusRoot();\r\n            }\r\n        },\r\n        focusRoot: function () {\r\n            this._mindCore.focusRoot();\r\n        },\r\n        focusCenter: function () {\r\n            this._mindCore.focusCenter();\r\n        },\r\n        blur: function () {\r\n            this._mindCore.blur();\r\n        },\r\n        matchParent: function () {\r\n            this._mindCore.matchParent();\r\n        },\r\n        changePosition: function (val) {\r\n            this._mindCore.changePosition(val);\r\n        },\r\n        hasChange: function () {\r\n            return this._mindCore.hasChange();\r\n        },\r\n        setLock: function (lock) {\r\n            this._mindCore.setLock(lock);\r\n        },\r\n        setEditAble: function (able) {\r\n            this._mindCore.setEditAble(able);\r\n        },\r\n        clear: function () {\r\n            this._mindCore.clear();\r\n        },\r\n        scale: function (scale) {\r\n            this._mindCore.scale(scale);\r\n        },\r\n        onResize: function () {\r\n            this._mindCore.onResize();\r\n        },\r\n        undo: function () {\r\n            if (this._mindCore.getEditTextVisible()) {\r\n                this._mindCore.blur(false);\r\n            } else {\r\n                this.blur();\r\n                this._history.undo();\r\n            }\r\n        },\r\n        redo: function () {\r\n            if (this._mindCore.getEditTextVisible()) {\r\n                this._mindCore.blur(false);\r\n            } else {\r\n                this.blur();\r\n                this._history.redo();\r\n            }\r\n        },\r\n        hasUndo: function () {\r\n            //return this._mindCore.hasChange();\r\n            return this._history.hasUndo();\r\n        },\r\n        hasRedo: function () {\r\n            return this._history.hasRedo();\r\n        },\r\n        on: function (type, callback, domain) {\r\n            this._eventBus.add(type, callback, domain || this);\r\n        },\r\n        off: function (type, callback) {\r\n            this._eventBus.remove(type, callback);\r\n        },\r\n        setLogLevel: function (level) {\r\n            Logger.setLevel(level);\r\n        },\r\n        getLang: function (key) {\r\n            return this._lang[key];\r\n        },\r\n        isValid: function () {\r\n            var data = this.getData(true, true);\r\n            var valid = function (nodeData) {\r\n                var flag = true;\r\n                var data = nodeData.data;\r\n                var children = nodeData.children;\r\n                if (data.requireChildren && children.length <= 0) {\r\n                    return false;\r\n                }\r\n                if (data.requireContent && data.text.trim() === '') {\r\n                    return false;\r\n                }\r\n\r\n                for (var i = 0; i < children.length; i++) {\r\n                    if (!valid(children[i])) {\r\n                        flag = false;\r\n                        return flag;\r\n                    }\r\n                }\r\n\r\n                return flag;\r\n            }\r\n            return valid(data.root);\r\n        },\r\n        destroy: function () {\r\n            if (this._mindCore) {\r\n                this._mindCore.destroy();\r\n            }\r\n            this._eventBus = null;\r\n            this._mindCore = null;\r\n        }\r\n    };\r\n}(window, jQuery, __M));\r\n})(window,document,jQuery)"]}