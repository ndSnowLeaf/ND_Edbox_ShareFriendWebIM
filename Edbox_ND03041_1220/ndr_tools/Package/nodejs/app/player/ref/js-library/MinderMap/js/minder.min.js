!function(e,t,i){!function(e,t,i){"$:nomunge";function n(){r=t[s](function(){u++,o.forEach(function(i){var n=i.width(),r=i.height(),a=i.data(d);n===a.w&&r===a.h||i.trigger(h,[a.w=n,a.h=r]),u%50===0&&i.get(0)!==t&&0===e("["+_+'="'+i.attr(_)+'"]').length&&(f(o,i),i.removeData(d),i.unbind(h))}),o.length?n():clearTimeout(r)},a[l])}var r,o=[],a=e.resize=e.extend(e.resize,{}),s="setTimeout",h="resize",d=h+"-special-event",l="delay",_="data-resize",c="throttleWindow",u=0;a[l]=250,a[c]=!0;var g=function(e){return e+(10*Math.random()+(new Date).getMilliseconds()).toString().replace(".","")},f=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(isNaN(t)||(n=i),n[0]==t[0]){for(var r=i;r<e.length;r++)e[r]=e[r+1];e.length=e.length-1}}};e.event.special[h]={setup:function(){if(!a[c]&&this[s])return!1;var t=e(this);t.attr(_,g(_)),o.push(t),t.data(d,{w:t.width(),h:t.height()}),1===o.length&&n()},teardown:function(){if(!a[c]&&this[s])return!1;var t=e(this);f(o,t),t.removeData(d),o.length||clearTimeout(r)},add:function(t){function n(t,n,o){var a=e(this),s=a.data(d);s&&(s.w=n!==i?n:a.width(),s.h=o!==i?o:a.height(),r.apply(this,arguments))}if(!a[c]&&this[s])return!1;var r;return e.isFunction(t)?(r=t,n):(r=t.handler,void(t.handler=n))}}}(jQuery,this),function(e){e.support.touch="ontouchend"in t,e.support.mobile=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);var i={};e.support.touch&&e.support.mobile?(i.getEventX=function(e){return e.originalEvent.changedTouches[0].clientX},i.getEventY=function(e){return e.originalEvent.changedTouches[0].clientY}):(i.getEventX=function(e){return e.clientX},i.getEventY=function(e){return e.clientY}),e.event.special.mDblclick={setup:function(){var t=e(this);if(e.support.touch&&e.support.mobile){var n=0,r=0,o={},a={},s=!1;t.bind("touchstart",function(e){if((0!==e.which||1!==e.which)&&(n=(new Date).getTime(),o.x=i.getEventX(e),o.y=i.getEventY(e),s)){var t=Math.abs(n-r),h=Math.abs(a.x-o.x),d=Math.abs(a.y-o.y);(t>=400||h>=30||d>=30)&&(s=!1)}}),t.bind("touchend touchcancel",function(h){if(0!==h.which||1!==h.which){r=(new Date).getTime(),a.x=i.getEventX(h),a.y=i.getEventY(h);var d=r-n,l=Math.abs(a.x-o.x),_=Math.abs(a.y-o.y);d<=500&&l<7&&_<7?s?(h=e.event.fix(h),h.type="mDblclick",h.tapEventSource="touchclick",h.tapFireTouch=!0,t.triggerHandler(h)):s=!0:s=!1}})}else t.bind("dblclick",function(i){i=e.event.fix(i),i.type="mDblclick",i.tapEventSource="mouseclick",i.tapFireTouch=!1,t.triggerHandler(i)})},teardown:function(){var t=e(this);t.unbind("touchend").unbind("touchcancel").unbind("touchstart")}}}(jQuery),function(e){var t={},i=.8;t.getDistance=function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},t.getFingers=function(e){return e.touches?e.touches.length:1},t.calScale=function(e,t,i){if(e.length>=2&&t.length>=2){var n=this.getDistance(e[1],e[0]),r=this.getDistance(t[1],t[0]),o=(r-n)*i;return(r-o)/n}return 1},t.isTouchEnd=function(e){return"touchend"===e.type||"touchcancel"===e.type},t.isTouchMove=function(e){return"touchmove"===e.type},t.getPosOfEvent=function(e){for(var t=[],i=null,n=0,r=e.touches.length;n<r;n++)i=e.touches[n],t.push({x:i.pageX,y:i.pageY});return t},e.event.special.mPinch={setup:function(){var n=e(this),r=i,o=n.attr("data-pinch-intensity");o&&(o=parseFloat(o),o>0&&o<=1&&(r=o));var a=!1,s=!1,h={start:null,move:null,end:null},d=function(){a=s=!1,h={}},l=function(e){if(a&&(!(t.getFingers(e)<2)||t.isTouchEnd(e))){var i=t.calScale(h.start,h.move,r),o={type:"mPinch",originEvent:e,scale:i,fingersCount:t.getFingers(e)};return s?t.isTouchMove(e)?(o.fingerStatus="move",n.triggerHandler(o)):t.isTouchEnd(e)&&(o.fingerStatus="end",n.triggerHandler(o),d()):(s=!0,o.fingerStatus="start",n.triggerHandler(o)),e}};n.bind("touchstart",function(e){a=!0,(!h.start||h.start.length<2)&&(h.start=t.getPosOfEvent(e.originalEvent))}),n.bind("touchmove",function(e){a&&h.start&&(h.move=t.getPosOfEvent(e.originalEvent),t.getFingers(e.originalEvent)>=2&&l(e.originalEvent))}),n.bind("touchend touchcancel",function(e){a&&(s&&l(e.originalEvent),d(),e.touches&&1===e.touches.length&&(a=!0))})},teardown:function(){var t=e(this);t.unbind("touchstart").unbind("touchmove").unbind("touchend").unbind("touchcancel")}},e.fn.mPinch=function(e){return this.bind("mPinch",e)},e.fn.mPinchSetIntensity=function(e){i=e}}(jQuery),function(e){e.support.touch="ontouchend"in t,e.support.mobile=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);var i={};e.support.touch&&e.support.mobile?(i.mouseDown="touchstart",i.mouseUp="touchend",i.mouseWheel="touchmove",i.getEventX=function(e){return e.originalEvent.changedTouches[0].clientX},i.getEventY=function(e){return e.originalEvent.changedTouches[0].clientY}):(i.mouseDown="mousedown",i.mouseUp="mouseup",i.mouseWheel="mousewheel",i.getEventX=function(e){return e.clientX},i.getEventY=function(e){return e.clientY}),e.support.fixed=function(){var i=t.getElementsByTagName("body");i&&i.length>0&&i[0].addEventListener("touchstart",function(){}),e.support.fixed=!0},e.support.fixed(),e.event.special.mTap={setup:function(){var t=e(this);if(e.support.touch&&e.support.mobile){e.support.fixed!==!0&&e.support.fixed();var n=i.mouseDown,r=i.mouseUp,o=0,a=0,s=0,h=null;t.bind(n,function(e){0===e.which&&1===e.which||(o=(new Date).getTime(),a=i.getEventX(e),s=i.getEventY(e),h=e.originalEvent.target)}),t.bind(r,function(n){if(0!==n.which||1!==n.which){var r=(new Date).getTime(),d=i.getEventX(n),l=i.getEventY(n),_=n.originalEvent.target,c=r-o,u=Math.abs(d-a),g=Math.abs(l-s);c<=550&&u<8&&g<8&&_===h&&(n=e.event.fix(n),n.type="mTap",n.tapEventSource="touchclick",n.tapFireTouch=!0,t.triggerHandler(n))}})}else t.bind("click",function(i){i=e.event.fix(i),i.type="mTap",i.tapEventSource="mouseclick",i.tapFireTouch=!1,i.originalEvent&&i.originalEvent.sourceCapabilities&&i.originalEvent.sourceCapabilities.firesTouchEvents&&(i.tapFireTouch=!0),t.triggerHandler(i)})},teardown:function(){var t=i.mouseDown,n=i.mouseUp,r=e(this);r.unbind(n).unbind(t)}}}(jQuery),function(e){var t=function(e){switch(e.type){case"touchstart":case"touchend":case"touchmove":case"touchcancel":return{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}}return{x:e.clientX,y:e.clientY}};e.event.special.mTouchLong={setup:function(){var i=e(this),n=0,r=0,o=0,a=0,s=!1;i.bind("touchstart",function(e){if(0!==e.which||1!==e.which){if("touchstart"===e.type&&(s=!0),e.originalEvent.touches.length>1)return void clearTimeout(n);r=(new Date).getTime();var h=t(e);o=h.x,a=h.y,clearTimeout(n),n=setTimeout(function(){e.type="mTouchLong",i.triggerHandler(e)},1200)}}),i.bind("touchend touchmove touchcancel",function(e){var i=t(e),r=i.x,h=i.y,d=Math.abs(r-o),l=Math.abs(h-a);(d>2||l>2)&&(clearTimeout(n),s=!1),"touchend"!==e.type&&"touchcancel"!==e.type||(clearTimeout(n),s=!1)})},teardown:function(){var t=e(this);t.unbind("touchstart  touchend touchmove touchcancel")}}}(jQuery),function(){var i;!function(e,n){return e.fn.autogrow=function(r){if(null==r&&(r={}),null==r.horizontal&&(r.horizontal=!0),null==r.vertical&&(r.vertical=!0),null==r.debugx&&(r.debugx=-1e4),null==r.debugy&&(r.debugy=-1e4),r.addWidth||(r.addWidth=0),null==r.debugcolor&&(r.debugcolor="yellow"),null==r.flickering&&(r.flickering=!0),null==r.postGrowCallback&&(r.postGrowCallback=function(){}),null==r.verticalScrollbarWidth&&(r.verticalScrollbarWidth=i()),r.horizontal!==!1||r.vertical!==!1)return r["class"]=r["class"]||"autogrow-shadow",this.filter("textarea,input").each(function(){var i,o,a,s,h,d,l,_;if(i=e(this),!i.data("autogrow-enabled"))return s=parseInt(i.attr("data-minHeight"))||i.height(),h=parseInt(i.attr("data-minWidth"))||i.width(),a=1*i.css("lineHeight")||0,i.hasVerticalScrollBar=function(){return i[0].clientHeight<i[0].scrollHeight},_=l=parseInt(i.css("max-width")),o=e('<div class="'+r["class"]+'"></div>').css({position:"absolute",display:"inline-block","background-color":r.debugcolor,top:r.debugy,left:r.debugx,"max-width":i.css("max-width"),padding:i.css("padding"),fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),lineHeight:i.css("lineHeight"),resize:"none","word-wrap":"break-word","word-break":"break-all","box-sizing":"content-box"}).appendTo(r.body||t.body),r.horizontal===!1&&o.css({width:i.width()}),d=function(e){return function(t){var n,d,c,u;return d=e.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n /g,"<br/>&nbsp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(e){return Array(e.length-1).join("&nbsp;")+" "}),o.html(d),l=parseInt(i.attr("data-maxwidth")),u=parseFloat(i.attr("data-scale")),o.css("transform","scale("+u+")"),l?o.css("maxWidth",l):o.css("maxWidth",_),r.vertical===!0&&(s=parseInt(i.attr("data-minheight"))||i.height(),n=Math.max(o.height()+a,s),i.height(n)),r.horizontal===!0&&(h=parseInt(i.attr("data-minwidth"))||i.width(),c=Math.max(o.outerWidth(),h),c+=r.addWidth,l>0&&l<c?i.width(l):i.width(c)),r.postGrowCallback(i)}}(this),i.on("input",d),e(n).resize(d),d()})}}(e.jQuery,e),i=function(){var e,i,n,r;return e=t.createElement("p"),e.style.width="100%",e.style.height="200px",i=t.createElement("div"),i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.visibility="hidden",i.style.width="200px",i.style.height="150px",i.style.overflow="hidden",i.appendChild(e),t.body.appendChild(i),n=e.offsetWidth,i.style.overflow="scroll",r=e.offsetWidth,n===r&&(r=i.clientWidth),t.body.removeChild(i),n-r}}.call(this);var n={};!function(e,t,i,n){n.View={};var r={mdnode_centralname:"中心主题",mdnode_branchname:"分支主题",mdnode_addchildtip:"添加下级主题",mdmenu_edit:"编辑内容",mdmenu_visible:"显示内容",mdmenu_invisible:"隐藏内容",mdmenu_copy:"复制",mdmenu_cut:"剪切",mdmenu_paste:"粘贴",mdmenu_delete:"删除"},o={};o.palette=new i.Palette,o.palette.add("transparent",i.Color.createRGBA(0,0,0,0)),o.palette.add("node_stroke_normal",i.Color.createRGB(115,161,191)),o.palette.add("node_stroke_active",i.Color.createRGB(57,80,96)),o.palette.add("backgroud_color",i.Color.parse("#C0D3E2")),o.palette.add("line_color",i.Color.parse("#666564")),o.nodeStyle={width:110,height:42,y:-11,paddingX:15,paddingY:7,strokeStyle:{"stroke-width":2,stroke:i.Color.parse("#9CB2C1"),opacity:1,cursor:"pointer"},activeStrokeStyle:{"stroke-width":2.5,stroke:i.Color.parse("#F61D1B"),opacity:1,cursor:"pointer"},moveCoverStyle:{"stroke-width":5,stroke:i.Color.parse("#9CB2C1")},moveStyle:{opacity:.5,stroke:i.Color.parse("#9CB2C1")},placeholderStyle:{fill:"#74A3BE",stroke:i.Color.parse("#74A3BE")},fill:i.Color.parse("#FFFFFF"),requireCompletedFill:i.Color.parse("#F9EED7"),radius:23,textStyle:{"font-size":20,"dominant-baseline":"text-before-edge",cursor:"pointer"},groupColor:"black",groupTransform:"translate( 0 -2.4 )"},o.lineStyle={strokeStyle:{"stroke-width":2,stroke:o.palette.get("line_color")}},o.triangleStyle={lineWidth:110,lineStyle:o.lineStyle.strokeStyle,circleStrokeStyle:o.lineStyle.strokeStyle,clickCircleStrokeStyle:{"stroke-width":2,stroke:o.palette.get("transparent")},clickCircleFill:o.palette.get("transparent"),circleFill:o.palette.get("node_stroke_normal"),circleWidth:11,triangleWidth:6.5,triangleHeight:12.5,triangleStroke:o.palette.get("line_color"),triangleFill:o.palette.get("line_color"),style:{cursor:"pointer"}},o.plusStyle={circleFill:i.Color.parse("#4A5157"),circleStroke:i.Color.parse("#4A5157"),plusSroke:i.Color.parse("#FBFBFB"),circleWidth:12,plusWidth:5.5,plusStokeWidth:1.5,clickFill:o.palette.get("transparent"),clickStyle:{"stroke-width":2,stroke:o.palette.get("transparent")}},o.EVENT_KEY={EDITTEXT_CHANGE_NODE:"edittext_change_node",EDITTEXT_SHOW:"edittext_show",NODE_DRAWING:"node_drawing",NODE_TRIANGLE_CLICK:"node_triangle_click",NODE_TEXT_CHANGE:"node_text_change",NODE_CLICK:"node_click",NODE_DOWN:"node_down",NODE_UP:"node_up",NODE_BEFORE_MOVE:"node_before_move",NODE_MOVE:"node_move",NODE_AFTER_MOVE:"node_after_move",NODE_COVER:"node_cover",NODE_DBLCLICK:"node_dblclick",NODE_BLUR:"node_blur",NODE_RIGHT_CLICK:"node_right_click",NODE_EXPAND:"node_expand",NODE_DELETE:"node_delete",NODE_SHOW_CONTENT:"node_show_content",MENU_CLICK:"menu_click",MENU_SHOW:"menu_show",REMARK_SHOW:"remark_show",DOM_HIDE:"dom_hide",NODE_CENTER:"node_center",NODE_RESTORE:"node_restore"},o.DOM_EVENT_TYPE={TOUCH:"touch",MOUSE:"mouse"},o.MENU_TYPE_KEY={EDIT:"edit",VISIBLE:"visible",COPY:"copy",CUT:"cut",PASTE:"paste",DELETE:"delete"},o.DRAW_TYPE_KEY={MOVE:"move",ACTIVE:"active",ACTIVE_EDIT_DISABLE:"active_edit_disable",REVERT:"revert",TEXT:"text",INIT:"init"},o.CLASS_NAME={MIND_BODY_CLASS:"mindMap_body mindMap_guardian",MIND_BODY_PPT_SHELL_CLASS:"mindMap_ppt_shell",MIND_PLACEHOLDER_CLASS:"mindMap_placeholder"},o.CHANGE_REASON={MOVE:"move",MINDER_MOVE:"minder_move",MINDER_SCALE:"minder_scale",BRO_RELATION:"bro_relation",PARENT_CHANGE:"parent_change",DELETE:"delete",TEXT_CONTENT:"text_content",TEXT_VISIBLE:"text_visible",EXPAND:"expand",ORIENTATION_CHANGE:"orientation_change",ADD:"add",RENDER:"render",UNDO_REDO:"undo_redo",CLEAR:"clear"},n.Config=o,n.Config.DefaultLang=r}(e,jQuery,kity,n),function(t){"use strict";for(var i=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],n=i.length,r=e.console=e.console||{},o=null,a=function(){};n--;)o=i[n],r[o]||(r[o]=a);var s={_level:0,_console:r,setLevel:function(e){switch(e){case"debug":this._level=3;break;case"info":this._level=2;break;case"warn":this._level=1;break;case"error":this._level=0;break;default:this._level=-1}},debug:function(){this._level>=3&&this._console.log.apply(this._console,arguments)},info:function(e){this._level>=2&&this._console.info.apply(this._console,arguments)},warn:function(e){this._level>=1&&this._console.warn.apply(this._console,arguments)},error:function(e){this._level>=0&&this._console.error.apply(this._console,arguments)}};t.Logger=s}(n),function(e,t,i){i.Class={};var n=i.Logger,r=function(e,t){for(var i in t)"undefined"!=typeof e[i]&&"__base"!==i&&n.error("有重复的成员"),e[i]=t[i];return e},o=function(e,t){return function(){return t.apply(e,arguments)}},a={___eventDispatch:null,___nodeId:"",___eventsInfo:[{nodeEvent:!0,key:"",fucs:"",params:[]}],__base:function(e,t,i){this.___eventsInfo=null,this.___eventDispatch=null;var n=Array.prototype.slice.apply(arguments,[0]);if(n.length>3)throw new Error("参数长度有误");for(var r=0;r<n.length;r++){var o=n[r];o instanceof Array?this.___eventsInfo=o:"string"==typeof o?this.___nodeId=o:"object"==typeof o&&(this.___eventDispatch=e)}this.___eventDispatch=this.___eventDispatch||{},this.___eventsInfo=this.___eventsInfo||[],this.___nodeId=this.___nodeId||"",this.__addEvent()},__include:function(e){return r(this,e)},__proxyAll:function(e){for(var t=0;t<e.length;t++)this[e[t]]=o(this,this[e[t]])},__addEvent:function(){for(var e=this.___eventsInfo,t=this.___nodeId,i=0;i<e.length;i++){var n=e[i],r=n.nodeEvent?t+"_"+n.key:n.key;this.___eventDispatch.add(r,this[n.fucs],this)}},__triggerEvent:function(e){var t=Array.prototype.slice.apply(arguments,[0]);this.___eventDispatch.trigger.apply(this.___eventDispatch,t)},__triggerNodeEvent:function(e){var t=Array.prototype.slice.apply(arguments,[0]),e=t.shift();t.unshift(this.___nodeId+"_"+e),this.___eventDispatch.trigger.apply(this.___eventDispatch,t)},__triggerNodeEventByNodeId:function(e,t){var i=Array.prototype.slice.apply(arguments,[0]),e=i.shift(),t=i.shift();i.unshift(t+"_"+e),this.___eventDispatch.trigger.apply(this.___eventDispatch,i)},__setNodeId:function(e){this.___nodeId=e},__getNodeId:function(){return this.___nodeId},__getEventDispatch:function(){return this.___eventDispatch},__destroy:function(){for(var e=this.___eventsInfo,t=this.___nodeId,i=0;i<e.length;i++){var n=e[i],r=n.nodeEvent?t+"_"+n.key:n.key;this.___eventDispatch.remove(r,this[n.fucs],this)}}},s={___viewNode:null,__base:function(e,t,i,n){for(var r=Array.prototype.slice.apply(arguments,[0]),o=0;o<r.length;o++){var s=r[o];if(s&&"undefined"!=typeof s.__KityClassName){this.___viewNode=s,r.splice(o,1);break}}a.__base.apply(this,r)},__getShape:function(){return this.___viewNode},__addShape:function(e){this.___viewNode.addShape(e)},__getWidth:function(){return this.___viewNode.getWidth()},__getHeight:function(){return this.___viewNode.getHeight()},__show:function(){this.___viewNode.setAttr("display","block")},__hide:function(){this.___viewNode.setAttr("display","none")},__on:function(e,t){this.___viewNode.on(e,t)},__stopPropagation:function(e){var t=this,i=function(e){e.stopPropagation()};e.forEach(function(e){t.__on(e,i)})},__remove:function(){this.___viewNode.remove()},__animator:function(e){var t=e.node||this.___viewNode,i=e.startVal||0,n=e.finishVal||0,r=e.draw,o=e.finish,a=e.duration||200,s=new kity.Animator(i,n,function(e,t,i){r(e,t)}),h=s.start(t,a),d=function(){o&&o(),h.off("finish",d)};return h.on("finish",d),h}},h={___$view:null,__base:function(e,t,i,n){for(var r=Array.prototype.slice.apply(arguments,[0]),o=0;o<r.length;o++){var s=r[o];if(s&&s instanceof jQuery){this.___$view=s,r.splice(o,1);break}}a.__base.apply(this,r)},__$:function(){return this.___$view},__setMatrix:function(e){this.___$view.attr("transform","matrix("+e.m.a+" "+e.m.b+" "+e.m.c+" "+e.m.d+" "+e.m.e+" "+e.m.f+")")},__getWidth:function(){return this.___$view.width()},__getHeight:function(){return this.___$view.height()},__setWidth:function(e){return this.___$view.css("width",e+"px"),this},__setHeight:function(){return this.___$view.css("height",width+"px"),this},__setVisible:function(e){e?this.___$view.show():this.___$view.hide()},__isVisible:function(){return this.___$view.is(":visible")},__remove:function(){this.___$view.remove()}};i.Class.Base=function(e){return Object.create(a).__include(e)},i.Class.BaseView=function(e){return Object.create(a).__include(Object.create(s)).__include(e)},i.Class.BaseForeignObject=function(e){return Object.create(a).__include(Object.create(h)).__include(e)}}(e,jQuery,n),function(e,i,n,r){r.Utils={getFixedFloat:function(e,t){var i=e.toString(),n=i.split(".");if(2!==n.length)return e;""===n[0]&&(n[0]="0");var r=n[1].length;if(0===r||0===t)return parseInt(n[0]);var o=n[0]+"."+n[1].substring(0,t>=r?r:t);return parseFloat(o)},getValue:function(e,t,i){var n="",r=e.match(t);return"number"==typeof i&&r&&r.length>i?n=r[i]:r&&2===r.length&&(n=r[1]),n},getUuid:function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},getItemInArrayById:function(e,t,i){i||(i="id");for(var n=0,r=e.length;n<r;n++){var o="function"==typeof e[n][i]?e[n][i]():e[n][i];if(o===t)return e[n]}return!1},isPointInsidePoly:function(e,t){for(var i=t.length,n=!1,r=-1,o=i-1;++r<i;o=r)(t[r].y<=e.y&&e.y<t[o].y||t[o].y<=e.y&&e.y<t[r].y)&&e.x<(t[o].x-t[r].x)*(e.y-t[r].y)/(t[o].y-t[r].y)+t[r].x&&(n=!n);return n},checkRectsCross:function(e,t){return Math.abs(t.p1.x+t.p2.x-e.p1.x-e.p2.x)<=Math.abs(e.p1.x-e.p2.x)+Math.abs(t.p1.x-t.p2.x)&&Math.abs(t.p2.y+t.p1.y-e.p2.y-e.p1.y)<=Math.abs(e.p2.y-e.p1.y)+Math.abs(t.p2.y-t.p1.y)},isMobile:!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),supportTouch:"ontouchend"in t,getEventPagePos:function(e){var t=e.originalEvent?e.originalEvent:e,i={};switch(t.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return i.x=t.changedTouches[0].pageX,i.y=t.changedTouches[0].pageY,i;default:return i.x=e.pageX,i.y=e.pageY,i}return i}}}(e,jQuery,kity,n),function(e,t,i){i.Utils.String={_templateRegExp:/\$\{(.+?)(?:\:(.+?))?\}/g,template:function(e,t){return e.replace(this._templateRegExp,function(e,i,n){return t[i]||e})},getTemplateValue:function(e,t){var i=this.templateRegex(t),n=i.regExp.exec(e);if(!n)return null;for(var r=Object.keys(i.attrs),o=null,a=1;a<n.length;a++)if(o||(o={}),r.length>a-1){var s=r[a-1];"number"===i.attrs[s]?o[s]=parseInt(n[a]):o[s]=n[a]}return o},templateRegex:function(e){var t={},i=e.replace(this._templateRegExp,function(e,i,n){return t[i]=n,n?"number"===n?"(\\d+?)":"string"===n?"(.+?)":void 0:"(.+?)"});return i="^"+i+"$",{regExp:new RegExp(i),attrs:t}},getTextLfToBr:function(e){return e=e.replace(/<br\/>/g,function(e,t){return"<br>"}),e=e.replace(/<div>([\s\S]*?)<\/div>/g,function(e,t){return"<br/>"+t+"<br/>"}),e=e.replace(/<br\/><br\/>/g,function(e,t){return"<br>"}),e=e.replace(/<br\/>/g,function(e,t){return"<br>"}),e=e.replace(/\r\n/g,function(e,t){return"<br>"}),e=e.replace(/(\r|\n)/g,function(e,t){return"<br>"})},getTextBrToLf:function(e){return e=e.replace(/<br([^<>]*?)\/?>/g,function(e,t){return"\r\n"})}}}(e,jQuery,n),function(e,i,n){n.Utils.OutClick={uuid:"",instances:[],containerEle:t,getUuid:function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},create:function(e){var t=Object.create(this);return t.instances=[],t.uuid=this.getUuid(),t.containerEle=e,t},trigger:function(e){var t=this;return i.each(this.instances,function(n,r){if(t.outside(r.element,e.target)){var o=!0;if(r.ignoreEle&&!t.outside(i(r.ignoreEle),e.target)&&(o=!1),o&&"function"==typeof r.callback)return r.callback.call(r.element)}})},register:function(e,t,i){return this.instances.push({element:e,ignoreEle:t,options:[],callback:i})},enable:function(){var e=this;return i(this.containerEle).on("mousedown.outclick"+this.uuid,function(t){e.trigger(t)})},disable:function(){return i(this.containerEle).off("mousedown.outclick"+this.uuid)},reset:function(){return this.disable(),this.enable()},outside:function(e,t){return!e.is(t)&&0===e.has(t).length}},i.fn.mOutclick=function(e,t,i){return i.reset(),i.register(this,t,e),this}}(e,i,n),function(e,t){t.Utils.Clipboard={_data:null,create:function(){var e=Object.create(this);return e},setData:function(e,t){this._data={text:e,cut:t}},getData:function(){if(!this._data)return"";var e=this._data.text;return this._data.cut&&(this._data=null),e},isEmpty:function(){return!(this._data&&this._data.text.length>0)}}}(e,n),function(e,t,i){var n=i.Command={};n.TYPE={ADD:1,DELETE:2,EXPAND:3,MOVE:4,MODIFY_TEXT:5},n.Queue={_queue:[],_currentIndex:0,_maxLength:10,create:function(){var e=Object.create(this);return e._queue=[],e},undo:function(){this._currentIndex<0||this._queue[this._currentIndex--].undo()},redo:function(){this._currentIndex>=this._queue.length-1||this._queue[this._currentIndex++]["do"]()},push:function(e){this._queue=this._queue.slice(0,this._currentIndex+1),this._queue.push(e),this._queue.length>this._maxLength&&this._queue.shift(),this._currentIndex=this._queue.length-1},redoAble:function(){return this._queue.length-1>this._currentIndex},undoAble:function(){return this._currentIndex>=0&&this._queue.length>0}}}(e,jQuery,n),function(e,t,i){var n=i.Logger;i.Event={_eventHandler:null,create:function(){var e=Object.create(this);return e._eventHandler={},e},trigger:function(){var e=Array.prototype.slice.apply(arguments,[0]),t=e.shift();if(!this._eventHandler||!this._eventHandler[t])return!1;var i=this._eventHandler[t];return i.forEach(function(i){i.cb.apply(i.domain||this,e),n.debug("event-trigger",t,e.toString())}),!0},add:function(e,t,i){return this._eventHandler[e]||(this._eventHandler[e]=[]),this._eventHandler[e].push({cb:t,domain:i}),!0},remove:function(e,t,i){var n=this._eventHandler[e];if(n&&n.length>0)for(var r,o=n.length,a=0;a<o;a++)if(r=n[a],r&&t===r.cb){if(i&&i!==r.domain)continue;n.splice(a,1),a--,o--}n&&0===n.length&&delete this._eventHandler[e]}}}(e,jQuery,n),function(e,t,i){i.Utils.Svg={addForeignObject:function(e,t,i,n,r,o,a){var s=e.ownerDocument,h=s.createElementNS("http://www.w3.org/2000/svg","foreignObject");h.setAttribute("x",n),h.setAttribute("y",r),h.setAttribute("id",t),h.setAttribute("height",a+"px"),h.setAttribute("width",o+"px");var d=s.createElement("div");return i&&d.setAttribute("class",i),h.appendChild(d),e.appendChild(h),h},addTitle:function(e,t){var i=e.ownerDocument,n=i.createElementNS("http://www.w3.org/2000/svg","title");return n.innerHTML=t,e.appendChild(n),n}}}(e,jQuery,n),function(e,t,i){var n=i.Utils;i.ID={_nodeId:"minder_node_${i:number}",_textBorderId:"node_text_border_${i:number}",_textGroupId:"node_text_g_${i:number}",_textId:"node_text_${i:number}",_visibleImageId:"node_image_visible_${i:number}",_expandGroupId:"node_expand_${orientation:string}_${i:number}",_expandTriangleId:"node_expand_triangle_${orientation:string}_${i:number}",_createPlusId:"node_plus_${orientation:string}_${i:number}",_delBtnId:"node_del_${i:number}",getNodeId:function(e){return n.String.template(this._nodeId,{i:e})},getDelBtnId:function(e){return n.String.template(this._delBtnId,{i:e})},getTextBorderId:function(e){return n.String.template(this._textBorderId,{i:e})},getTextGroupId:function(e){return n.String.template(this._textGroupId,{i:e})},getTextId:function(e){return n.String.template(this._textId,{i:e})},getVisibleImageId:function(e){return n.String.template(this._visibleImageId,{i:e})},getExpandGroupId:function(e,t){return n.String.template(this._expandGroupId,{i:e,orientation:t})},getExpandTriangleId:function(e,t){return n.String.template(this._expandTriangleId,{i:e,orientation:t})},getCreatePlusId:function(e,t){return n.String.template(this._createPlusId,{i:e,orientation:t})},getTargetValue:function(e){var t=this,i=n.String.getTemplateValue(e,t._createPlusId);return i?(i.type="plus",i):(i=n.String.getTemplateValue(e,t._expandTriangleId))?(i.type="expand",i):(i=n.String.getTemplateValue(e,t._delBtnId))?(i.type="del",i):(i=n.String.getTemplateValue(e,t._textGroupId))?(i.type="node",i):(i=n.String.getTemplateValue(e,t._textBorderId))?(i.type="node",i):(i=n.String.getTemplateValue(e,t._visibleImageId),i&&(i.type="node"),i)},isNode:function(e){return/^minder_node_\d+$/.test(e)},getTextIdByNodeId:function(e){var t=n.String.getTemplateValue(e,this._nodeId);return t&&"undefined"!=typeof t.i&&""!==t.i?this.getTextId(t.i):null},isRoot:function(e){return"minder_node_1"===e}}}(e,jQuery,n),function(e,t,i){function n(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function r(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function o(e,t,i,a){for(var h=s(t),d=s(e),l=!1,_=!1,c=d.length-1;c>=0;c--){var u=d[c],g=e[u];if(t.hasOwnProperty(u)){var f=t[u];"object"==typeof g&&null!=g&&"object"==typeof f&&null!=f?o(g,f,i,a+"/"+n(u)):g!=f&&(l=!0,i.push({op:"replace",path:a+"/"+n(u),value:r(f)}))}else i.push({op:"remove",path:a+"/"+n(u)}),_=!0}if(_||h.length!=d.length)for(var c=0;c<h.length;c++){var u=h[c];e.hasOwnProperty(u)||i.push({op:"add",path:a+"/"+n(u),value:r(t[u])})}}function a(e,t){var i=[];return o(e,t,i,""),i}var s=function(){return Object.keys?Object.keys:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}}();i.Utils.JsonDiff={compare:a}}(e,jQuery,n),function(e,t,i){var n=i.ID,r=i.Class.BaseView,o=i.Utils.Svg,a=i.Utils,s=i.Config,h=s.plusStyle;i.View.Plus=r({_orientation:null,_clickWidth:h.circleWidth+20,_clickHeight:h.circleWidth+28,create:function(e,t,i,r){var o=Object.create(this);return o.__base(t,n.getNodeId(e),(new kity.Group).setId(n.getCreatePlusId(e,i))),o._option=r,o._orientation=i,o._createNode(),o},_createNode:function(){var e=this._option.langData;o.addTitle(this.__getShape().node,e.mdnode_addchildtip),this.__getShape().setStyle({cursor:"pointer"});var t=new kity.Circle(h.circleWidth,0,0).fill(h.circleFill).stroke(h.circleStroke);this.__addShape(t);var i=(new kity.Path).stroke(h.plusSroke).setAttr("stroke-width",h.plusStokeWidth),n=i.getDrawer();n.moveTo(-h.plusWidth,0),n.lineTo(h.plusWidth,0),n.moveTo(0,-h.plusWidth),n.lineTo(0,h.plusWidth),this.__addShape(i),a.isMobile||(this._clickWidth=h.circleWidth+17,this._clickHeight=h.circleWidth+20);var r=new kity.Rect(this._clickWidth,this._clickHeight,0,0).fill(h.clickFill).setStyle(h.clickStyle);r.translate(-this._clickWidth/2,-this._clickHeight/2),this.__addShape(r)},getVisibleWidth:function(){return 2*h.circleWidth},destroy:function(){}})}(e,jQuery,n),function(e,t,i){var n=i.ID,r=i.Class.BaseView,o=i.Utils,a=i.Config.triangleStyle,s=i.Config,h=2*s.plusStyle.circleWidth+5;i.View.ExpandTriangle=r({_orientation:null,_triangleNode:null,_circleNode:null,_circleGroupNode:null,_leftLineNode:null,_halfLineNode:null,_rightLineNode:null,_nodeLevel:null,create:function(e,t,i,r){var o=Object.create(this);return o.__base(i,n.getNodeId(e),(new kity.Group).setId(n.getExpandGroupId(e,r))),o._orientation=r,o._nodeLevel=t,o._create(t,e,r),o},_create:function(e,t,i){if(1===e){var n=this._leftLineNode=(new kity.Path).setStyle(a.lineStyle),r=this._halfLineNode=(new kity.Path).setStyle(a.lineStyle);this.__addShape(n),this.__addShape(r);var o=n.getDrawer(),s=r.getDrawer(),d=2*a.lineWidth/3;"left"===i?(o.moveTo(0,0),o.lineTo(d-h,0),s.moveTo(h,0),s.lineTo(d,0)):(s.moveTo(0,0),s.lineTo(h+.5,0),o.moveTo(h,0),o.lineTo(d,0))}else{var n=this._leftLineNode=(new kity.Path).setStyle(a.lineStyle);this.__addShape(n);var l=this._rightLineNode=(new kity.Path).setStyle(a.lineStyle);this.__addShape(l);var r=this._halfLineNode=(new kity.Path).setStyle(a.lineStyle);this.__addShape(r),this._createTriangleGroup(t,i);var _=n.getDrawer(),c=l.getDrawer(),s=r.getDrawer(),u=a.lineWidth/2,g=a.circleWidth;"left"===i?(_.moveTo(0,0),_.lineTo(u-g,0),c.moveTo(u+g,0),c.lineTo(u+g+(u-g-h),0),s.moveTo(u+g+(u-g-h)+h,0),s.lineTo(u+g,0)):(c.moveTo(0,0),c.lineTo(u-g,0),l.translate(u+g,0),s.moveTo(0,0),s.lineTo(h+.5,0),_.moveTo(h,0),_.lineTo(u-g,0))}},_createTriangleGroup:function(e,t){var i=this._circleGroupNode=(new kity.Group).setId(n.getExpandTriangleId(e,t)).setStyle(a.style).fill(a.clickCircleFill),r=this._circleNode=new kity.Circle(a.circleWidth,0,0).setStyle(a.circleStrokeStyle);i.addShape(r);var s=20,h=22,d=0;o.isMobile&&(s=30,h=34,d=4);var s=a.circleWidth+s,h=a.circleWidth+h,l=new kity.Rect(s,h,0,0).fill(a.clickCircleFill).setStyle(a.clickCircleStrokeStyle);l.translate(-s/2,-h/2),i.addShape(l);var _=this._triangleNode=new kity.Polyline;this._createTriangle(_,t),_.fill(a.triangleFill).stroke(a.triangleStroke);var c=new kity.Matrix(1,0,0,1,-a.triangleWidth/2,-a.triangleHeight/2);_.setMatrix(c),i.addShape(_),i.translate(a.lineWidth/2),this.__addShape(i)},update:function(e){var t=this;e?(t._updateTriangle("left"===t._orientation?"left":"right"),t._leftLineNode.setVisible(!0),t._rightLineNode.setVisible(!0)):"left"===t._orientation?(t._updateTriangle("right"),t._leftLineNode.setVisible(!1),t._rightLineNode.setVisible(!0)):(t._updateTriangle("left"),t._leftLineNode.setVisible(!0),t._rightLineNode.setVisible(!1))},updateHalfLine:function(e){e?t(this._halfLineNode.node).css("visibility","hidden"):t(this._halfLineNode.node).css("visibility","visible")},_createTriangle:function(e,t){if(e.clear(),"left"===t){e.addPoint(new kity.ShapePoint(0,0)),e.addPoint(new kity.ShapePoint(a.triangleWidth,a.triangleHeight/2)),e.addPoint(new kity.ShapePoint(0,a.triangleHeight)),e.addPoint(new kity.ShapePoint(0,0));var i=new kity.Matrix(1,0,0,1,-a.triangleWidth/2+2,-a.triangleHeight/2);e.setMatrix(i)}else if("right"===t){e.addPoint(new kity.ShapePoint(a.triangleWidth,0)),e.addPoint(new kity.ShapePoint(a.triangleWidth,a.triangleHeight)),e.addPoint(new kity.ShapePoint(0,a.triangleHeight/2)),e.addPoint(new kity.ShapePoint(a.triangleWidth,0));var i=new kity.Matrix(1,0,0,1,-a.triangleWidth/2-2,-a.triangleHeight/2);e.setMatrix(i)}},_updateTriangle:function(e){this._createTriangle(this._triangleNode,e)},getFullWidth:function(){return 1===this._nodeLevel?2*a.lineWidth/3:a.lineWidth},destroy:function(){}})}(e,jQuery,n),function(e,t,i){var n=i.Config.lineStyle,r=i.Class.BaseView,o=i.Utils;i.View.ConnectLine=r({_mindNodeCore:null,_type:"both",create:function(e){var t=Object.create(this);return t.__base(new kity.Path),
t._mindNodeCore=e,t._type=e.getOption().type,t._init(),t},_init:function(){this.draw()},draw:function(e,t){var i,r=this._mindNodeCore.getLayoutBox(),a=this._mindNodeCore.getParent().getLayoutBox(),s=this._mindNodeCore.getParent().getChildrenCount(),e=this._type;i="both"!==e?e:this._mindNodeCore.getParent().isRoot()?this._mindNodeCore.getOrientation():this._mindNodeCore.getParent().getOrientation();var h,d,l,_=Math.abs,c=[],u=r.x>a.x?"right":"left";i&&(u=i),h=new kity.Point("left"===u?a.left:a.right,a.cy),d="left"==u?new kity.Point(r.right,r.cy):new kity.Point(r.left,r.cy),Math.abs(h.x-d.x)<=2&&(h.x=d.x),l=kity.Vector.fromPoints(h,d),l.x=o.getFixedFloat(l.x,5),l.y=o.getFixedFloat(l.y,5),Math.abs(l.x)<=2.5&&(l.x=0),c.push("M",h),"animate"===e&&1===s&&Math.abs(Math.floor(h.x)-Math.floor(d.x))<=2&&Math.abs(h.y-d.y)<40?c.push("A",0,0,0,0,0,h):c.push("A",_(l.x),_(l.y),0,0,l.x*l.y>0?0:1,d),this.__getShape().setPathData(c),this.__getShape().setStyle(n.strokeStyle)},_getLayoutBox:function(e){var t=e.getRenderBox(),i=new kity.Matrix;return i.transformBox(t)},setParentShape:function(){},destroy:function(){}})}(e,jQuery,n),function(e,t,i){var n=i.Utils,r=i.Class,o=i.ID;i.View.FornVisibleImage=r.BaseForeignObject({_width:50,_height:28,create:function(e,i){var r=Object.create(this);return r.__base(t(n.Svg.addForeignObject(e,o.getVisibleImageId(i),"mindMap_visible_img",0,0,this._width,this._height))),r.__setVisible(!1),r},active:function(){this.__$().find(".mindMap_visible_img").addClass("mindMap_visible_img_active")},revert:function(){this.__$().find(".mindMap_visible_img").removeClass("mindMap_visible_img_active")}})}(e,jQuery,n),function(e,t,i){var n=i.Config.nodeStyle,r=(i.Utils,i.Class.BaseView),o=i.ID,a={start:/^([\s\S]*?)<div>/,middle:/<div>([\s\S]*?)<\/div>/g,end:/<\/div>([\s\S]*)/,br:/(.*?)<br\/?>(.*)/};i.View.MultipleText=r({_lineHeight:22,_$$texts:[],create:function(e,t){var i=Object.create(this);return i._$$texts=[],i.__base((new kity.Group).setId(o.getTextGroupId(e)).fill(n.groupColor).setAttr("transform",n.groupTransform)),i._createNode(e,t),i},_createNode:function(e,t){this.setText(t)},_createText:function(e,t,i){var r=(new kity.Text).setStyle(n.textStyle).setContent(e).setAttr("x",0).setAttr("y",i);return r},getText:function(){var e=this,t="";return e._$$texts.forEach(function(i,n){t+=n===e._$$texts.length-1?i.getContent():i.getContent()+"<br>"}),t},setText:function(e){this._$$texts.forEach(function(e){e.remove()}),this._$$texts=[];for(var t=this._getTextSpan(e),i=0;i<t.length;i++){var n=this._createText(t[i],0,i*this._lineHeight);this._$$texts.push(n),this.__addShape(n)}},_getTextSpan:function(e){e=e.replace(/<br\/>/g,function(e,t){return"<br>"}),e=e.replace(a.middle,function(e,t){return"<br/>"+t+"<br/>"}),e=e.replace(/<br\/><br\/>/g,function(e,t){return"<br>"}),e=e.replace(/<br\/>/g,function(e,t){return"<br>"}),e=e.replace(/(<br>)*$/,function(e,t){return""});var t=e.split("<br>");return t},getWidth:function(){var e=0;return this._$$texts.forEach(function(t){t.getWidth()>e&&(e=t.getWidth())}),e},getHeight:function(){return this._lineHeight*this._$$texts.length},destroy:function(){this.__destroy()}})}(e,jQuery,n),function(e,t,i){var n=(i.Config.EVENT_KEY,i.Utils),r=i.Class.Base,o=i.ID;i.View.SvgDelBtn=r({_$delBtn:null,_eventDispatch:null,_width:40,_height:40,create:function(e,t){var i=Object.create(this);return i._append(e,t),i},_append:function(e,i){this._$delBtn=t(n.Svg.addForeignObject(e,o.getDelBtnId(i),"mindMap_del",0,0,this._width,this._height)),this._$delBtn.hide()},setMatrix:function(e){this._$delBtn.attr("transform","matrix("+e.m.a+" "+e.m.b+" "+e.m.c+" "+e.m.d+" "+e.m.e+" "+e.m.f+")")},setVisible:function(e){e?this._$delBtn.show():this._$delBtn.hide()},isVisible:function(){return"none"!==this._$delBtn.css("display")},getWidth:function(){return this._width},getHeight:function(){return this._height},destroy:function(){}})}(e,jQuery,n),function(e,t,i){var n=i.Config.EVENT_KEY,r=i.Config.MENU_TYPE_KEY,o=i.Utils,a=i.Class.Base,s=/mindMap_menu_btn_([a-z]+)/;i.View.Menu=a({_$menu:null,_clipboard:null,_nodeText:null,_option:null,_scale:1,_eventInfos:[{nodeEvent:!1,key:n.MENU_SHOW,fucs:"_showHandler",params:["触发显示的节点对象"]},{nodeEvent:!1,key:n.DOM_HIDE,fucs:"_domHideHandler",params:[]}],_eventDispatch:null,create:function(e,t,i,n){var r=Object.create(this);return r.__base(e,r._eventInfos),r._clipboard=i,r._option=n,r._append(t),r._bindEvent(),r},_append:function(e){var t=this._option.langData,i="";i+='<div class="mindMap_rightkey_table mindMap_menu">',i+='<ul> <b class="mindMap_pf_spes"><i></i></b>',i+='<li class="mindMap_rightkey_tab_edit mindMap_menu_btn_edit">',i+='<a href="javascript:;"> <i></i><em>'+t.mdmenu_edit+"</em></a>",i+="</li>",i+='<li class="mindMap_rightkey_tab_hidecon mindMap_menu_btn_visible">',i+='<a href="javascript:;"> <i></i><em>'+t.mdmenu_invisible+"</em></a>",i+="</li>",i+='<li class="mindMap_rightkey_tab_copy mindMap_menu_btn_copy">',i+='<a href="javascript:;"> <i></i><em>'+t.mdmenu_copy+"</em></a>",i+="</li>",i+='<li class="mindMap_rightkey_tab_cut mindMap_menu_btn_cut">',i+='<a href="javascript:;"> <i></i><em>'+t.mdmenu_cut+"</em></a>",i+="</li>",i+='<li class="mindMap_rightkey_tab_paste mindMap_menu_btn_paste">',i+='<a href="javascript:;"> <i></i><em>'+t.mdmenu_paste+"</em></a>",i+="</li>",i+='<li class="mindMap_rightkey_tab_del mindMap_menu_btn_delete">',i+='<a href="javascript:;"> <i></i><em>'+t.mdmenu_delete+"</em></a>",i+="</li>",i+="</ul>",i+="</div>",e.append(i),this._$menu=e.find(".mindMap_menu")},_showHandler:function(e){var i=this,n=this._option.langData;i._nodeText=e.getText();var r=e.getRectPath(),o=t("#"+i._option.mindBodyId),a=o[0].getBoundingClientRect(),s=o.width(),h=a.width/s,d=r.node.getBoundingClientRect(),l={left:(d.left-a.left)/h,top:(d.top-a.top)/h,subHeight:(a.bottom-d.bottom)/h};i.__setNodeId(e.getNodeId()),i._$menu.find("li").show(),e.getParent()?(i._$menu.find(".mindMap_menu_btn_delete").show(),i._$menu.find(".mindMap_menu_btn_visible").show()):(i._$menu.find(".mindMap_menu_btn_delete").hide(),i._$menu.find(".mindMap_menu_btn_visible").hide()),e.getTextVisible()?(i._$menu.find(".mindMap_menu_btn_visible em").text(n.mdmenu_invisible),i._$menu.find(".mindMap_menu_btn_edit").show(),i._clipboard.isEmpty()?i._$menu.find(".mindMap_menu_btn_paste").addClass("mindMap_click_disabled"):i._$menu.find(".mindMap_menu_btn_paste").removeClass("mindMap_click_disabled"),""===i._nodeText?(i._$menu.find(".mindMap_menu_btn_copy").addClass("mindMap_click_disabled"),i._$menu.find(".mindMap_menu_btn_cut").addClass("mindMap_click_disabled")):(i._$menu.find(".mindMap_menu_btn_copy").removeClass("mindMap_click_disabled"),i._$menu.find(".mindMap_menu_btn_cut").removeClass("mindMap_click_disabled"))):(i._$menu.find(".mindMap_menu_btn_visible em").text(n.mdmenu_visible),i._$menu.find(".mindMap_menu_btn_edit").hide(),i._$menu.find(".mindMap_menu_btn_copy").addClass("mindMap_click_disabled"),i._$menu.find(".mindMap_menu_btn_cut").addClass("mindMap_click_disabled"),i._$menu.find(".mindMap_menu_btn_paste").addClass("mindMap_click_disabled")),""===i._nodeText?i._$menu.find(".mindMap_menu_btn_visible").addClass("mindMap_click_disabled"):i._$menu.find(".mindMap_menu_btn_visible").removeClass("mindMap_click_disabled"),e.getContentEditAble()||(i._$menu.find(".mindMap_menu_btn_edit").hide(),i._$menu.find(".mindMap_menu_btn_visible").hide(),i._$menu.find(".mindMap_menu_btn_cut").hide(),i._$menu.find(".mindMap_menu_btn_paste").hide()),e.getDeleteAble()||i._$menu.find(".mindMap_menu_btn_delete").hide(),i._option.hideMenuItem.forEach(function(e){i._$menu.find(".mindMap_menu_btn_"+e).hide()});var _=i._$menu.width(),c=i._$menu.height(),u=i._$menu.find(".mindMap_pf_spes"),g=u[0].getBoundingClientRect().height;g<=0&&(g=u.height());var f=l.left+d.width/h/2-_*i._scale/2,p=l.top+d.height/h+Math.abs(g*i._scale);c>l.subHeight&&l.top>l.subHeight?(u.addClass("top"),p=p-c*i._scale-d.height/h-2*Math.abs(g*i._scale)):u.removeClass("top"),i._$menu.css({left:f+"px",top:p+"px"}),i._$menu.css("transform","scale("+(this._scale>=1?this._scale:1)+")"),i._$menu.show()},_domHideHandler:function(){this._$menu.hide()},_bindEvent:function(){var e=this;this._$menu.on("mTap",function(i){i.preventDefault();var a=i.originalEvent.srcElement,h=t(a).closest("li"),d=h.attr("class");if(!h.hasClass("mindMap_click_disabled")){var l=o.getValue(d,s);e._$menu.hide(),l===r.DELETE&&e.__triggerEvent(n.DOM_HIDE),e.triggerMenuClick(l,e._nodeText)}}),this._$menu.on("touchstart mousedown",function(e){var i=e.originalEvent.srcElement,n=t(i).closest("li");n.addClass("active")}),this._$menu.on("touchend touchcancel mouseup mouseleave",function(){e._$menu.find("li").removeClass("active")}),this._$menu.on("contextmenu",function(e){e.preventDefault()})},triggerMenuClick:function(e,t){var i=this;e===r.COPY&&i._clipboard.setData(t,!1),e===r.CUT&&i._clipboard.setData(t,!0);var o;e===r.PASTE?(o=i._clipboard.getData(),o.length>0&&i.__triggerNodeEvent(n.MENU_CLICK,e,o)):e===r.CUT?i.__triggerNodeEvent(n.MENU_CLICK,e,""):i.__triggerNodeEvent(n.MENU_CLICK,e)},setScale:function(e){this._scale=e,this._scale<1&&(this._scale=1),this._$menu.css("transform","scale("+(this._scale>=1?this._scale:1)+")")},setVisible:function(e){e?this._$menu.show():this._$menu.hide()},destroy:function(){this.__destroy()}})}(e,jQuery,n),function(e,t,i){var n=i.Config.CLASS_NAME,r=i.Config.nodeStyle,o=i.Class.BaseView;i.View.Placeholder=o({_$$rect:null,_eventDispatch:null,create:function(e,t){var i=Object.create(this),o=(new kity.Group).setId(n.MIND_PLACEHOLDER_CLASS+t);i.__base(o);var a=(new kity.Rect).setStyle(r.placeholderStyle);return i._$$rect=a,a.setWidth(100),a.setHeight(100),o.addShape(a),i.__base(o),e.addShape(o),i.__hide(),i},setVisible:function(e){this.__getShape().setVisible(e)},getRectShape:function(){return this._$$rect},setMatrix:function(e){this.__getShape().setMatrix(e)},destroy:function(){this.__remove()}})}(e,jQuery,n),function(e,t,i){var n=(i.Logger,i.Config.DRAW_TYPE_KEY),r=i.Config.nodeStyle,o=i.Config.DOM_EVENT_TYPE,a=i.Class.BaseView,s=i.View.Plus,h=i.View.ExpandTriangle,d=i.ID,l=i.View.MultipleText,_=i.View.SvgDelBtn,c=i.View.FornVisibleImage,u=i.Utils,g=0,f=2.5,p=3;i.View.MindNode=a({_nodeStyle:null,_rectPathNode:null,_leftPlus:null,_rightPlus:null,_leftExpandTriangle:null,_rightExpandTriangle:null,_fornVisibleImage:null,_nodeLevel:null,_expand:null,_mindNodeCore:null,_multipleText:null,_delBtn:null,_minWidth:r.width,_minHeight:r.height,_paddingX:r.paddingX,_paddingY:r.paddingY,_option:null,create:function(e,t,i,n,r){var o=Object.create(this),a=(new kity.Group).setId(e);return n.isRoot()||a.setAttr("status","creating"),o.__base(i,e,a),o._nodeLevel=n.getLevel(),o._mindNodeCore=n,o._option=n.getOption(),n.isRoot()&&o._option.rootVertical&&(o._minWidth=o._option.rootMinWidth,o._paddingX=o._option.rootPaddingX,o._paddingY=o._option.rootPaddingY),o._createNode(o._nodeLevel,t,r),o},bringTop:function(){this.__getShape().bringTop()},_createNode:function(e,t,i){this._createTextNode(e,t,i),this._createExpandNode(t,e),this._createPlusNode(t,e),this._createInvisibleImage(t),this._delBtn=_.create(this.__getShape().node,t),this._mindNodeCore.getRequireChildren()&&this._createRequireStarText()},getLayoutBox:function(){var e=this.__getShape().getRenderBox();this._delBtn.isVisible()&&(e.cy=e.cy+this._delBtn.getHeight()/2+f/2,e.height=e.height-this._delBtn.getHeight()-f,e.top=e.top+this._delBtn.getHeight()+f,e.y=e.y+this._delBtn.getHeight()+f,this._option.remarkVisible&&(this._option.remarkEditAble||""!==this._getMindNode().rtGetRemark())&&(e.width=e.width-this._delBtn.getHeight(),e.cx=e.width-this._delBtn.getHeight(),e.x=e.x+this._delBtn.getHeight()));var t=new kity.Matrix;return t.transformBox(e)},_createRequireStarText:function(){this._starText=new kity.Text("*").fill("red").setStyle({fontSize:"20px"}),this.__addShape(this._starText)},_createExpandNode:function(e,t){this._leftExpandTriangle=h.create(e,t,this.__getEventDispatch(),"left"),this._rightExpandTriangle=h.create(e,t,this.__getEventDispatch(),"right"),this.__addShape(this._leftExpandTriangle.__getShape()),this.__addShape(this._rightExpandTriangle.__getShape()),this._leftExpandTriangle.__hide(),this._rightExpandTriangle.__hide()},_createPlusNode:function(e){this._leftPlus=s.create(e,this.__getEventDispatch(),"left",this._option),this._rightPlus=s.create(e,this.__getEventDispatch(),"right",this._option),this.__addShape(this._leftPlus.__getShape()),this.__addShape(this._rightPlus.__getShape()),this._leftPlus.__hide(),this._rightPlus.__hide()},_createTextNode:function(e,t,i){var n=this._nodeStyle=r,o=this._minWidth,a=this._option.langData,s=this._minHeight,h=this._rectPathNode=(new kity.Rect).setId(d.getTextBorderId(t));h.setSize(o,s).setRadius(n.radius).fill(n.fill).setStyle(n.strokeStyle),this.__addShape(h);var _=e>1?a.mdnode_branchname:a.mdnode_centralname;"undefined"!=typeof i&&(_=i),this._multipleText=l.create(t,_),this.__addShape(this._multipleText.__getShape())},_createInvisibleImage:function(e){this._fornVisibleImage=c.create(this.__getShape().node,e),this._fornVisibleImage.__setVisible(!this._mindNodeCore.getTextVisible())},setVisibleImageActive:function(e){e?this._fornVisibleImage.active():this._fornVisibleImage.revert()},getText:function(){return this._multipleText.getText()},setText:function(e){this._multipleText.setText(e)},getTextNode:function(){return this._multipleText.__getShape()},getRectPathWidth:function(){return this._rectPathNode.getWidth()},getRectPathHeight:function(){return this._rectPathNode.getHeight()},getRectPath:function(){return this._rectPathNode},updateRectPathFill:function(){this._mindNodeCore.getRequireChildren()&&this._option.showRequireFill&&(this._mindNodeCore.getChildren().length>0?this._rectPathNode.fill(this._nodeStyle.requireCompletedFill):this._rectPathNode.fill(this._nodeStyle.fill))},draw:function(e,t){var e=e||"",i=this._getMindNode();switch(e){case n.INIT:this._expandTriangle(t&&t.orientation);break;case n.MOVE:this.__getShape().translate(t.x,t.y),this._leftPlus.__hide(),this._rightPlus.__hide(),i.isRoot()||(this._leftExpandTriangle.__hide(),this._rightExpandTriangle.__hide(),this._delBtn.setVisible(!1));break;case n.ACTIVE_EDIT_DISABLE:this._rectPathNode.setStyle(this._nodeStyle.activeStrokeStyle),this._leftPlus.__hide(),this._rightPlus.__hide(),this._leftExpandTriangle.updateHalfLine(!1),this._rightExpandTriangle.updateHalfLine(!1),this._delBtn.setVisible(!1);break;case n.ACTIVE:if(this._rectPathNode.setStyle(this._nodeStyle.activeStrokeStyle),i.isRoot()){var r=i.getOption();"both"!==r.type&&"left"!==r.type||this._leftPlus.__show(),"both"!==r.type&&"right"!==r.type||this._rightPlus.__show(),this._leftExpandTriangle.updateHalfLine(!0),this._rightExpandTriangle.updateHalfLine(!0)}else{t.eventType===o.TOUCH&&i.getDeleteAble()&&this._delBtn.setVisible(!0);var a=i.getOrientation();t&&t.orientation&&(a=t.orientation),"left"===a?(this._leftPlus.__show(),this._rightPlus.__hide(),this._leftExpandTriangle.updateHalfLine(!0),this._rightExpandTriangle.updateHalfLine(!1)):(this._leftPlus.__hide(),this._rightPlus.__show(),this._leftExpandTriangle.updateHalfLine(!1),this._rightExpandTriangle.updateHalfLine(!0))}break;case n.REVERT:this._rectPathNode.setStyle(this._nodeStyle.strokeStyle),this._leftPlus.__hide(),this._rightPlus.__hide(),this._leftExpandTriangle.updateHalfLine(!1),this._rightExpandTriangle.updateHalfLine(!1),this._delBtn.setVisible(!1);break;case n.TEXT:"undefined"!=typeof t.text&&this.setText(t.text),i.getTextVisible()?(this._fornVisibleImage.__setVisible(!1),this._multipleText.__show()):(this._fornVisibleImage.__setVisible(!0),this._multipleText.__hide()),this.reLayout()}},isActive:function(){return this._rectPathNode.node.style.stroke===this._nodeStyle.activeStrokeStyle.stroke.toRGB()},_expandTriangle:function(e){var t=this._getMindNode(),i=t.isRoot(),n=t.isExpand(),r=t.getOrientation(),o=t.isLeaf();e&&(r=e),2===t.getLevel()&&(r=t.getOrientation()),i&&(r=t.getChildOrientation()),o?(this._leftExpandTriangle.__hide(),this._rightExpandTriangle.__hide()):"both"===r?(this._leftExpandTriangle.__show(),this._rightExpandTriangle.__show()):"left"===r?(this._leftExpandTriangle.__show(),this._rightExpandTriangle.__hide()):"right"===r&&(this._leftExpandTriangle.__hide(),this._rightExpandTriangle.__show()),i||("left"===r?this._leftExpandTriangle.update(n):"right"===r&&this._rightExpandTriangle.update(n),t.getTextVisible()?(this._fornVisibleImage.__setVisible(!1),this._multipleText.__show()):(this._fornVisibleImage.__setVisible(!0),this._multipleText.__hide()))},getTriangleFullWidth:function(){return this._leftExpandTriangle.getFullWidth()+2*g},getOrientationFullWidth:function(){return this._rightExpandTriangle.getFullWidth()+this._rectPathNode.getWidth()+2*g},animateToPos:function(e,t,i,n){var r=this,o=this.__getShape().getTransform(),a=new kity.Matrix(o.m.a,o.m.b,o.m.c,o.m.d,e,t);return this.__animator({startVal:this.__getShape().getTransform(),finishVal:a,draw:function(e,t){e.setMatrix(t),i&&i()},finish:function(){r.__getShape().setAttr("status","init"),n&&n()}})},setMatrix:function(e){this.__getShape().setMatrix(e),this.__getShape().setAttr("status","init")},moveToPos:function(e,t){var i=this.__getShape().getTransform(),n=new kity.Matrix(i.m.a,i.m.b,i.m.c,i.m.d,e,t);this.__getShape().setMatrix(n),this.__getShape().setAttr("status","init")},reLayout:function(){var e=0,t=this._minWidth,i=this._paddingX,n=this._paddingY,o=this._mindNodeCore.getRequireChildren(),a=this._multipleText.__getShape().getRenderBox(),s=a.width+2*i,h=a.height+2*n,d=null,l=this._getMindNode(),_=o&&this._option.showRequireStar&&!l.isRoot();s<t&&(s=t,e=(s-a.width-2*i)/2),h<r.height&&(h=r.height),_&&!this._starText&&this._createRequireStarText(),this._starText&&(this._starText.setVisible(_),_&&(d=this._starText.getRenderBox()));var c,v;if(this._getMindNode().getTextVisible())this._rectPathNode.setWidth(s),this._rectPathNode.setHeight(h),c=this._rectPathNode.getRenderBox(),v=this._rectPathNode.getTransform();else{var m=this._fornVisibleImage.__getWidth(),E=this._fornVisibleImage.__getHeight();this._rectPathNode.setWidth(t),this._rectPathNode.setHeight(r.height),c=this._rectPathNode.getRenderBox(),v=this._rectPathNode.getTransform(),this._fornVisibleImage.__setMatrix(new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,c.cx-m/2,c.cy-E/2))}var b;if(u.isMobile?(b=new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,v.m.e+i+e,v.m.f+n+2.5),this._multipleText.__getShape().setMatrix(b)):(b=new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,v.m.e+i+e,v.m.f+n+1),this._multipleText.__getShape().setMatrix(b)),this._starText&&_){var y=new kity.Matrix(1,0,0,1,b.m.e-d.width,b.m.f+d.height/2+7);this._starText.setMatrix(y)}var C=new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,c.left-this._leftPlus.getVisibleWidth()/2-p,c.cy);this._leftPlus.__getShape().setMatrix(C),this._rightPlus.__getShape().setMatrix(new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,c.right+this._rightPlus.getVisibleWidth()/2+p,c.cy)),this._leftExpandTriangle.__getShape().setMatrix(new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,c.left-this._leftExpandTriangle.getFullWidth()-g,c.cy)),this._rightExpandTriangle.__getShape().setMatrix(new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,c.right+g,c.cy)),this._option.remarkVisible&&(this._option.remarkEditAble||""!==l.rtGetRemark())?this._delBtn.setMatrix(new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,c.left-this._delBtn.getWidth(),c.top-this._delBtn.getHeight()-f)):this._delBtn.setMatrix(new kity.Matrix(v.m.a,v.m.b,v.m.c,v.m.d,c.cx-this._delBtn.getWidth()/2,c.top-this._delBtn.getHeight()-f))},_getMindNode:function(){return this._mindNodeCore},destroy:function(){this.__destroy()}})}(e,jQuery,n),function(e,i,n){var r=n.Config.EVENT_KEY,o=n.Class.Base,a=(n.Logger,n.Utils);n.View.EditTextArea=o({_text:"",_minWidth:8,_html:'<textarea  class="mindMap_receiver mindMap_input" data-maxwidth="" data-minwidth="" data-minheight="" Keyboard-Offset-Y="75" style="" maxlength="160"></textarea><div class=" mindMap_receiver_shadow" contenteditable="plaintext-only"></div>',_$receiver:null,_$shadow:null,_clipboard:null,_scale:1,_eventsInfo:[{nodeEvent:!1,key:r.EDITTEXT_CHANGE_NODE,fucs:"_changePositionHandler",params:["触发节点id","显示x坐标","显示y坐标","node"]},{nodeEvent:!1,key:r.EDITTEXT_SHOW,fucs:"_showHandler",params:["触发节点id","显示x坐标","显示y坐标"]},{nodeEvent:!1,key:r.DOM_HIDE,fucs:"_domHideHandler",params:["是否需要动画绘制、默认true,除非传入false"]}],create:function(e,t,i,n){var r=Object.create(this);return r.__base(e,r._eventsInfo),r._option=n,r._append(t),r._bindEvent(),r._clipboard=i,r},_bindEvent:function(){var e=this;e._$receiver.autogrow({vertical:!0,horizontal:!0,flickering:!0,body:i("#"+e._option.mindBodyId)[0]})},isVisible:function(){return"none"!==this._$receiver.css("display")},_changePositionHandler:function(e,t,i){this.isVisible()&&this.__triggerNodeEvent(r.NODE_TEXT_CHANGE,this.getText()),this.__setNodeId(e),this._$receiver.hide(),this._$receiver.css({left:t+2+"px",top:i+4+"px"}),this._$receiver.blur()},_showHandler:function(e,t,i,n){this._minHeight||(this._$shadow.html("shadow"),this._minHeight=this._$shadow.height(),this._$receiver.attr("data-minheight",this._minHeight+"px"));var e=a.String.getTextLfToBr(e).replace(/&nbsp;/g," ");this._$shadow.html(e);var r=(this._$shadow.width()||10)+3.5,o=this._$shadow.height(),s=a.isMobile?n+2:n+4;this._$receiver.css({left:i+2+"px",top:s+"px",width:r+"px",height:o+"px"});var h=this._scale>=1?this._scale:1;this._$receiver.attr("data-minwidth",r+"px"),this._$receiver.css("transform","scale("+h+")"),this._$shadow.css("transform","scale("+h+")"),this._$receiver.show();var d=this._$receiver.offset(),l=this._$receiver.parent(),_=l.offset(),c=l.width(),u=parseInt(this._$receiver.css("maxWidth")),g=this._$receiver[0].getBoundingClientRect().width/(this._$receiver.outerWidth()*h),f=(c-(d.left-_.left)/g-15*h)/h;this._$receiver.attr("data-scale",h),f<u?this._$receiver.attr("data-maxwidth",f):this._$receiver.attr("data-maxwidth",""),this.setText(e),this._$receiver.trigger("input");var p=this._option.langData,v=p.mdnode_centralname===e||p.mdnode_branchname===e;v?this._$receiver.select():this._toLastWord(this._$receiver)},_toLastWord:function(e){e.focus();var i=e.val().length;if(t.selection){var n=e[0].createTextRange();n.moveStart("character",i),n.collapse(),n.select()}else"number"==typeof e[0].selectionStart&&"number"==typeof e[0].selectionEnd&&(e[0].selectionStart=e[0].selectionEnd=i)},setScale:function(e){this._scale=e,this._scale<1&&(this._scale=1),this._$receiver.css("transform","scale("+(this._scale>=1?this._scale:1)+")")},_domHideHandler:function(e){e="undefined"==typeof e||e,this.isVisible()&&this.__triggerNodeEvent(r.NODE_TEXT_CHANGE,this.getText(),e),this._$receiver.blur(),this._$receiver.hide()},_append:function(e){e.append(this._html),this._$shadow=e.find(".mindMap_receiver_shadow"),this._$receiver=e.find(".mindMap_receiver")},setText:function(e){return e=a.String.getTextBrToLf(e),e=e.replace(/&nbsp;/g," "),this._$receiver.val(e),this},getText:function(){var e=this._$receiver.val();return e=a.String.getTextLfToBr(e),e=e.replace(/&nbsp;/g," ")},setVisible:function(e){e?this._$receiver.show():this._$receiver.hide()},destroy:function(){this.__destroy()}})}(e,jQuery,n),function(e,t,i){var n=i.Config.EVENT_KEY,r=i.Class.Base;i.View.Remark=r({_$view:null,_$input:null,_$parent:null,_clipboard:null,_nodeText:null,_option:null,_scale:1,_eventInfos:[{nodeEvent:!1,key:n.REMARK_SHOW,fucs:"_showHandler",params:["触发显示的节点对象","visible"]},{nodeEvent:!1,key:n.DOM_HIDE,fucs:"_domHideHandler",params:[]}],_eventDispatch:null,create:function(e,t,i){var n=Object.create(this);return n.__base(e,n._eventInfos),n._option=i,n._$parent=t,n._append(t),n._bindEvent(),n},_append:function(e){var t='<div class="mindMap_remark mindmap-tips-edit"><input data-minwidth="80" class="tip-txt" type="text" maxlength="300" value=""></div>';e.append(t),this._$view=e.find(".mindMap_remark"),this._$input=this._$view.find("input")},_showHandler:function(e,t){if(!t||e&&this._option.remarkEditAble===!1&&""===e.rtGetRemark())return void this._domHideHandler(void 0,!0);if(e&&!e.isRoot()){var i,n,r=this,o=this._$view,a=this._$parent,s=a[0].getBoundingClientRect(),h=s.width/a.outerWidth(),d=e.getRectPath().node.getBoundingClientRect(),l=this._scale,_=parseInt(o.css("paddingLeft")),c=parseInt(o.css("paddingRight"));this._node=e;var u={left:(d.left-s.left)/h,top:parseInt((d.top-s.top)/h)},g=s.width-(d.left-s.left)-15;this._$input.attr("data-scale",l),this._$input.attr("data-maxwidth",g/(l*h)-_-c),i=u.left,n=parseInt(u.top-this._$view.height()*l-10*l),r.__setNodeId(e.getNodeId()),r._$view.css({left:i+"px",top:n+"px"}),r._$view.css("transform","scale("+this._scale+")"),this._$input.val(e.rtGetRemark()),this._$input.trigger("input"),r._$view.show()}},_domHideHandler:function(e,t){this._node&&this._node.isActive()&&!t||(this._$view.hide(),this._$view.blur())},getText:function(){return this._$input.val().trim()},_changePositionHandler:function(e,t,i,n){this.isVisible()&&this._node&&(this._node.rtSetRemark(this.getText()),this._node=null)},_bindEvent:function(){var e=this;this._$input.autogrow({"class":"remark_auto",vertical:!1,horizontal:!0,flickering:!0,addWidth:1,body:t("#"+e._option.mindBodyId)[0]}),this._$view.on("mousedown touchstart",function(t){e.__triggerEvent(n.EDITTEXT_CHANGE_NODE,e._node.getNodeId(),0,0,this)}),this._$input.on("input",function(t){e._node&&e._node.rtSetRemark(e.getText())}),e._option.remarkEditAble||e._$input.attr("disabled","disabled")},isVisible:function(){return"none"!==this._$view.css("display")},setScale:function(e){this._scale=e,this._$view.css("transform","scale("+this._scale+")")},setVisible:function(e){e?this._$view.show():this._$view.hide()},destroy:function(){this.__destroy()}})}(e,jQuery,n),function(e,t,i){"use strict";var n=i.Class.Base,r=i.Config.EVENT_KEY,o=i.Utils,a=i.Config.DRAW_TYPE_KEY,s=i.Config.CHANGE_REASON,h=i.ID,d=i.View.ConnectLine,l=i.View.MindNode,_=(i.Logger,i.Config.nodeStyle),c={create:function(e){var t=Object.create(this);for(var i in e)t[i]=e[i];return t},nodeId:null,x:null,y:null},u=1;i.MindNodeCore=n({_nodeId:"",_containParentsId:"",_level:1,_minder:null,_mindNode:null,_connectGroup:null,_connectLine:null,_parent:null,_children:null,_root:null,_option:null,_remove:!1,_textVisibleState:!0,_rootRemark:null,_lastTextRectPathWidth:0,_expand:!0,_identifier:"",create:function(e,t,i,n,r,o,a,s,d){e.nodeIndex++;var _=h.getNodeId(e.nodeIndex),u=Object.create(this);return u.__base(i,u._eventsInfo,_),u._nodeId=_,u._minder=t,u._rootRemark={},u._connectGroup=n,u._parent=r,r?(u._root=r.getRoot(),u._level=r.getLevel()+1):(u._paper=s,u._root=u,u._level=1,u.positionRecord={}),u._makeContainParentsId(),u._textVisibleState="undefined"==typeof a||a,u.setRequireChildren(!!d),u._children=[],u._option=e,u._mindNode=l.create(u._nodeId,e.nodeIndex,i,u,o),u.isRoot()&&(u.positionRecord[_]=c.create({x:0,y:0,innerRectX:0,innerRectY:0,innerRectWidth:u.getRectPath().getWidth(),innerRectHeight:u.getRectPath().getHeight(),containParentId:null,visible:!0})),u},getMindNodeShape:function(){return this._mindNode.__getShape()},layoutBox:function(){return this._mindNode.reLayout()},getLayoutBox:function(){return this._mindNode.getLayoutBox()},getRectPath:function(){return this._mindNode.getRectPath()},bringTop:function(){return this._mindNode.bringTop()},getCurNodePosition:function(){var e=this,t=e.getTransform(),i=e.getRectPath(),n=i.getTransform();return{x:t.m.e,y:t.m.f,innerRectX:t.m.e-n.m.e,innerRectY:t.m.f-n.m.f,innerRectWidth:i.getWidth(),innerRectHeight:i.getHeight(),containParentId:e.getContainParentsId(),nodeId:e.getNodeId(),visible:"none"!==e.getMindNodeShape().node.getAttribute("display")}},trvDrawInit:function(e){var t=this;if(!e||"both"===e){var i=t.getLevel();2===i&&(e=t.getOrientation())}t.draw(a.INIT,{orientation:e}),this.getChildren().forEach(function(t){t.trvDrawInit(e)})},drawBeforeMove:function(){this.trvHide(!0)},drawMove:function(e,t){var i=this;i.draw(a.MOVE,{x:e,y:t})},drawAfterMove:function(e,t){this.getChildren().forEach(function(i){i.draw(a.MOVE,{x:e,y:t}),i.drawAfterMove(e,t)})},drawAndChangeBroRelation:function(e,t){var i="";2===this.getLevel()&&this.resetRootChildrenSort();var n=this.changeBroRelation(e,t);return this.getOrientation()!==this.getLastOrientation()&&(i="both"),n.flag&&this.layout({global:!0,orientation:i,reason:n.relationChange?s.BRO_RELATION:s.MOVE}),n},drawChildAppend:function(e){var t=this,i=e.getParent();t.appendChild(e),t.isExpand()||(t.setExpand(!0),t.trvShow());var n="";e.getOrientation()!==e.getLastOrientation()&&(n="both"),this.isRoot()&&this.resetRootChildrenSort(),t.draw(a.INIT),i.draw(a.INIT),this.layout({global:!0,orientation:n,reason:s.PARENT_CHANGE})},drawDelete:function(){var e=this,t=e.getOrientation(),i=!0;if(e.getParent().isRoot()){var n=e.getParent().getChildByOrientation(t);1===n.length&&(i=!1)}else 0===e.getCenterSub()&&e.getChildHeight()<=_.height&&e._mindNode.getRectPathHeight()<=_.height&&e.getParent().getChildrenCount()<=1&&(i=!1);var r=this.getParent();this.destroy(),i?this.layout({global:!0,orientation:t,reason:s.DELETE}):(r.draw(a.INIT),r.layout({reason:s.DELETE}))},drawTextChange:function(e,t){var i=this,n=this.getText();i.draw(a.TEXT,{text:e});var h=i._mindNode.getRectPathWidth(),d=i._mindNode.getRectPathHeight(),l="";n!==e&&(l=s.TEXT_CONTENT),i._lastTextRectPathWidth!==h&&i._lastTextRectPathHeight===d?this.layout({reason:l,includeSelf:!0,animate:t===!1?t:i._option.animate}):i._lastTextRectPathHeight!==i._mindNode.getRectPathHeight()?(o.isMobile&&this.__triggerEvent(r.NODE_CENTER,this.getNodeId()),o.isMobile&&(t=!1),this.layout({global:!0,reason:l,animate:t})):l&&this.onChange(l)},drawExpandChange:function(){var e=this;this.setExpand(!this._expand),e.trvShow(),e.draw(a.INIT);var t=e.getChildren(),i=!0;1===t.length&&t[0].isLeaf()&&(i=!1),this.layout({global:i,reason:s.EXPAND})},drawUp:function(e,t,i){var n=this,o=n._lastOrientation;if(n.getOrientation()===o||n.isRoot()||t){this.draw(a.ACTIVE,{eventType:e}),n.trvDrawInit();var h=n.getTransform();n.setToPosition(h.m.e,h.m.f),!t&&i&&(n.isRoot()?this.onChange(s.MINDER_MOVE):this.onChange(s.MOVE)),t||n.__triggerEvent(r.NODE_DRAWING,"end")}else{var d=this._option.type;if("left"===d||"right"===d)return this.draw(a.ACTIVE,{eventType:e}),void n.__triggerEvent(r.NODE_DRAWING,"end");2===n.getLevel()?(this.draw(a.ACTIVE,{eventType:e}),n.getRoot().trvDrawInit(),this.layout({global:!0,orientation:"both",reason:s.ORIENTATION_CHANGE})):(this.draw(a.ACTIVE,{eventType:e,orientation:o}),n.trvDrawInit(o),this.layout({global:!0,orientation:o,reason:s.MOVE}))}n.trvShow()},drawAddChildren:function(e){var t=this,i=t.addNode({orientation:e});t.isExpand()||(t.setExpand(!0),t.trvShow()),t.draw(a.INIT),1===t.getChildrenCount()?this.layout({reason:s.ADD}):(e=i.getOrientation(),this.layout({global:!0,orientation:e,reason:s.ADD}))},drawFocusEditDisable:function(){this.draw(a.ACTIVE_EDIT_DISABLE,{})},draw:function(e,t){var i=this;t=t||{},e=e||"",i._preDraw(e,t),i._drawing(e,t),i._afterDraw(e,t)},_preDraw:function(e,t){var i=this;switch(e){case a.ACTIVE:this._lastOrientation=i.getOrientation();break;case a.TEXT:i._lastTextRectPathWidth=i._mindNode.getRectPathWidth(),i._lastTextRectPathHeight=i._mindNode.getRectPathHeight();break;case a.INIT:}},_drawing:function(e,t){var i=this;switch(this._mindNode.draw(e,t),e){case a.INIT:i.isRoot()===!1&&i._makeContainParentsId(),i.getRoot().rtSetPosRecord(i.getNodeId(),i.getCurNodePosition()),t.orientation&&(this._lastOrientation=t.orientation)}},_afterDraw:function(e,t){var i=this;e===a.MOVE&&2===this.getLevel()&&this.getRoot().draw(a.INIT),i._connectLine&&i._connectLine.draw(e,t)},onChange:function(e){this._option.onChange&&this._option.onChange(e)},getLastOrientation:function(){return this._lastOrientation},isExpand:function(){return this._expand},setExpand:function(e){this._expand=e},appendNode:function(e,t){var i=this;t="undefined"!=typeof t&&t,i._minder.addShape(i._mindNode.__getShape()),
i._mindNode.reLayout();var n=this._option.autoRideCount;if(!i.isRoot()){var r=this.getParent().getTransform(),o=r.m.f+this.getParent()._mindNode.getRectPathHeight()/2-this._mindNode.getRectPathHeight()/2,a=new kity.Matrix(r.m.a,r.m.b,r.m.c,r.m.d,"left"===e?r.m.e-50:r.m.e+50,o);if(this.getMindNodeShape().setMatrix(a),i.getParent().isRoot()&&!t){var s=i.getRoot().getChildByOrientation("left").length,h=i.getRoot().getChildByOrientation("right").length;"left"===e&&s>n&&s-1>h?e="right":"right"===e&&h>n&&h-1>s&&(e="left");var r=this.getParent().getTransform(),o=r.m.f+this.getParent()._mindNode.getRectPathHeight()/2-this._mindNode.getRectPathHeight()/2,a=new kity.Matrix(r.m.a,r.m.b,r.m.c,r.m.d,"left"===e?r.m.e-50:r.m.e+50,o);this.getMindNodeShape().setMatrix(a)}this._connectLine=d.create(i),this._connectGroup.addShape(this._connectLine.__getShape())}},setIdentifier:function(e){this._identifier=e},addNode:function(e,t,n){var r=this,o=!!r._option.ignoreAttrTextVisible||e.textVisible;n=n||!1;var a=i.MindNodeCore.create(this._option,this._minder,this.___eventDispatch,this._connectGroup,this,e.text,o,null,e.requireChildren);return a.setExtendProperties(e),e.identifier&&e.identifier>u&&(u=e.identifier+100),a.setIdentifier(e.identifier||u++),r.insertChild(a,t),a.appendNode(e.orientation,n),a},setMatrix:function(e){this._mindNode.setMatrix(e)},setText:function(e){this._mindNode.setText(e)},getText:function(){var e=this._mindNode.getText();return e},setTextVisible:function(e){this._textVisibleState=e},toggleTextVisible:function(){this.setTextVisible(!this._textVisibleState)},getTextVisible:function(){return this._textVisibleState},isActive:function(){return this._mindNode.isActive()},getOption:function(){return this._option},trvHide:function(e){e!==!0&&this.hide(),this.getChildren().forEach(function(e){e.trvHide()})},hide:function(){this._mindNode.__hide(),this._connectLine&&this._connectLine.__hide()},show:function(){this._mindNode.__show(),this._connectLine&&(this._connectLine.__show(),this._connectLine.draw())},trvShow:function(){this.show(),this.getChildren().forEach(function(e){e.getParent().isExpand()?e.trvShow():e.trvHide()})},_trvRemoveShape:function(){this.getMindNodeShape().remove(),this._connectLine&&this._connectLine.__getShape().remove(),this.getChildren().forEach(function(e){e._trvRemoveShape()})},trvRemove:function(){var e=this.getParent();this._trvRemoveShape(),e.removeChild(this)},_destroy:function(){this.getMindNodeShape().remove(),this._mindNode.destroy(),this._connectLine&&(this._connectLine.__getShape().remove(),this._connectLine.destroy()),this.getChildren().forEach(function(e){e._destroy()}),this.__destroy()},destroy:function(){this._destroy(),this.isRoot()||(this.getParent().removeChild(this),this._remove=!0)},isRemove:function(){return this._remove}})}(e,jQuery,n),function(e,t,i){"use strict";var n=i.Config.nodeStyle,r=i.Logger,o=i.Config.EVENT_KEY,a={_paddingBottom:n.height+4,_lineXToParentX:70,_heightChild:0,_centerSub:0,_toX:0,_toY:0,getChildHeight:function(){return this._heightChild},setChildHeight:function(e){this._heightChild=e},getCenterSub:function(){return this._centerSub},setCenterSub:function(e){this._centerSub=e},getToPosition:function(){var e=this;if(this.isRoot()){var t=this._mindNode.__getShape().getTransform();return{cx:t.m.e,cy:t.m.f}}return{cx:e._toX,cy:e._toY}},setToPosition:function(e,t){this._toX=e,this._toY=t},_mathChildPos:function(e,t){var i=this,n=i.isRoot(),r=i.getRectPathRenderBox(),o=i.getToPosition();o.cy=o.cy+r.height/2;var a=i._mindNode.getOrientationFullWidth(),s="left"===i.getOrientation();t&&(s="left"===t);var h=[],d=0;if(1===e.length){var l=o.cx;n&&(s="left"===e[0].getOrientation());var _,c;if(s){var u=e[0]._mindNode.getRectPathWidth(),g=i.getTriangleFullWidth();_=l-u-g,c=o.cy-e[0]._mindNode.getRectPathHeight()/2}else _=l+a,c=o.cy-e[0]._mindNode.getRectPathHeight()/2;e[0].setToPosition(_,c),e[0].trvMathChildPosition(t)}else if(e.length>1){e.forEach(function(t,n){var r,l,_=t.getRectPathRenderBox(),c={exSpace:!1,height:_.height,space:0,x:0,y:0},u=t.getCenterSub(),g=t.getChildHeight(),f=i._paddingBottom/2;0===n?r=l=(g-u-_.height)/2:n===e.length-1?r=l=(g+u-_.height)/2:(r=(g-_.height+u)/2,l=(g-_.height-u)/2),l=l<f?f:l,r=r<f?f:r,l>f&&(l+=f),r>f&&(r+=f),n>0&&(h[n-1].space+=r,d+=r),d+=n<e.length-1?_.height+l:_.height;var p;if(s){var v=t._mindNode.getRectPathWidth(),m=i.getTriangleFullWidth();p=o.cx-v-m-i._lineXToParentX}else p=o.cx+a+i._lineXToParentX;c.space=l,c.x=p,h.push(c)});var f,p=o.cy-d/2;h.forEach(function(i,n){f?(i.y=f.y+f.space+f.height,f=i):(i.y=p,f=i),e[n].setToPosition(i.x,i.y),e[n].trvMathChildPosition(t)})}},trvMathChildPosition:function(e){var t=this;if(this.isLeaf())return 0;var i=t.isRoot();if(i)"left"===e||"right"===e?t._mathChildPos(t.getChildByOrientation(e),e):(t._mathChildPos(t.getChildByOrientation("left"),"left"),t._mathChildPos(t.getChildByOrientation("right"),"right"));else{var n=t.getChildren();t._mathChildPos(n,e)}},trvMathChildHeight:function(e){var t,i=this,n=0,o=0;return t=!i.isRoot()||"left"!==e&&"right"!==e?i.getChildren():this.getChildByOrientation(e),t.length>0&&i.isExpand()&&t.forEach(function(e,r){var a,s,h={height:0},d=e.getRectPathRenderBox();e.isLeaf()?(a=d.height,e.setChildHeight(0),s=0):e.isExpand()?(h=e.trvMathChildHeight(),a=h.height,s=h.centerSub,d.height>h.height&&(a=d.height)):(a=d.height,e.setChildHeight(0),s=0),t.length>1&&(0===r?o=d.height>h.height?s:s+(a-d.height)/2:r===t.length-1&&(d.height>h.height?o-=s:o=o-s-(a-d.height)/2)),r>0&&(a+=i._paddingBottom),n+=a}),i.setChildHeight(n),i.setCenterSub(o),r.debug("child-height:",this.getNodeId(),n,o),{height:n,centerSub:o}},layout:function(e){e=e||{};var t=e.global||!1,i=e.orientation||this.getOrientation(),n=e.animate===!0||e.animate===!1?e.animate:this._option.animate,r=e.mathPos!==!0&&e.mathPos!==!1||e.mathPos,o=e.includeSelf||!1,a=e.reason||"",s=e.onComplete||function(){};t===!0?this._gloDraw(i,n,r,a,s):this._childDraw(o,a,s,n)},_gloDraw:function(e,t,i,n,r){var a=this;i&&(a.getRoot().trvMathChildHeight(e),a.getRoot().trvMathChildPosition(e)),a.__triggerEvent(o.NODE_DRAWING,"start"),t===!0?a.getRoot().trvAnimate(function(){a.getRoot().trvDrawInit(),r(),a.__triggerEvent(o.NODE_DRAWING,"end"),a.onChange(n)},e):(a.getRoot().trvMoveChildrenPos(e),a.getRoot().trvDrawInit(),r(),a.__triggerEvent(o.NODE_DRAWING,"end"),a.onChange(n))},_childDraw:function(e,t,i,n){var r=this,a=r.getOrientation();r.trvMathChildHeight(),r.__triggerEvent(o.NODE_DRAWING,"start",t);var s=r.getTransform();r.setToPosition(s.m.e,s.m.f),e&&"left"===a&&(r.mathSelfPosition(),r.moveNode(),r._connectLine.draw()),r.trvMathChildPosition(a),n?r.trvAnimate(function(){r.trvDrawInit(a),r.__triggerEvent(o.NODE_DRAWING,"end",t),i(),r.onChange(t)}):(r.trvMoveChildrenPos(),r.trvDrawInit(a),r.__triggerEvent(o.NODE_DRAWING,"end",t),i(),r.onChange(t))},trvAnimate:function(e,t){function i(){--n||e&&e()}var n=this.getComplex(t);this.trvAnimateChildren(function(){i()},t),0===n&&e&&e()},trvAnimateChildren:function(e,t){var i,n=this;i=!n.isRoot()||"left"!==t&&"right"!==t?n.getChildren():n.getChildByOrientation(t),i.forEach(function(t,i){t.animateNode(e),t.trvAnimateChildren(e)})},trvMoveChildrenPos:function(e){var t,i=this;t=!i.isRoot()||"left"!==e&&"right"!==e?i.getChildren():i.getChildByOrientation(e),t.forEach(function(e,t){var i=e.getToPosition();e._mindNode.moveToPos(i.cx,i.cy),e.trvMoveChildrenPos()})},moveNode:function(){var e=this.getToPosition();this._mindNode.moveToPos(e.cx,e.cy)},animateNode:function(e){var t=this,i=t.getToPosition();t._layoutTimeline&&(t._layoutTimeline.stop(),t._layoutTimeline=null),t._layoutTimeline=t._mindNode.animateToPos(i.cx,i.cy,function(){t._connectLine.draw("animate")},function(){t._layoutTimeline=null,setTimeout(function(){t._connectLine.draw(),e&&e()},100)})},mathSelfPosition:function(){var e=this,t=e._mindNode.getRectPathWidth(),i=e._toX-(t-e._lastTextRectPathWidth);e.setToPosition(i,e._toY)}};i.MindNodeCore.__include(a)}(e,jQuery,n),function(e,t,i){"use strict";var n=i.Config.EVENT_KEY,r=i.Config.MENU_TYPE_KEY,o=i.Config.DRAW_TYPE_KEY,a=(i.Logger,{_eventsInfo:[{nodeEvent:!0,key:n.NODE_DOWN,fucs:"_downHandler",params:["触发的事件类型"]},{nodeEvent:!0,key:n.NODE_MOVE,fucs:"_moveHandler",params:["x轴偏移","y轴偏移"]},{nodeEvent:!0,key:n.NODE_DBLCLICK,fucs:"_dbClickHandler",params:[]},{nodeEvent:!0,key:n.NODE_CLICK,fucs:"_clickHandler",params:[]},{nodeEvent:!0,key:n.NODE_TEXT_CHANGE,fucs:"_textChangeHandler",params:["是否需要动画"]},{nodeEvent:!0,key:n.NODE_TRIANGLE_CLICK,fucs:"_triangleClickHandler",params:["创建的方向 left/right"]},{nodeEvent:!0,key:n.NODE_RIGHT_CLICK,fucs:"_rightClickHandler",params:[]},{nodeEvent:!0,key:n.MENU_CLICK,fucs:"_menuClickHandler",params:["type 触发的按钮类型","传入的文本值"]},{nodeEvent:!0,key:n.NODE_BLUR,fucs:"_blurHandler",params:["当前获取到的节点id"]},{nodeEvent:!0,key:n.NODE_EXPAND,fucs:"_expandHandler",params:["是否收起"]},{nodeEvent:!0,key:n.NODE_DELETE,fucs:"_deleteHandler",params:[]},{nodeEvent:!0,key:n.NODE_UP,fucs:"_upHandler",params:["触发的事件类型","是否已经进行过绘制","是否触发过move事件"]},{nodeEvent:!0,key:n.NODE_COVER,fucs:"_nodeCoverHandler",params:["node"]},{nodeEvent:!0,key:n.NODE_RESTORE,fucs:"_nodeRestoreHandler",params:[""]},{nodeEvent:!0,key:n.NODE_SHOW_CONTENT,fucs:"_showContentHandler",params:[]},{nodeEvent:!0,key:n.NODE_BEFORE_MOVE,fucs:"_beforeMoveHandler",params:[]},{nodeEvent:!0,key:n.NODE_AFTER_MOVE,fucs:"_afterMoveHandler",params:[]}],_moveSubX:0,_moveSubY:0,_showContentHandler:function(){this.getTextVisible()||(this.setTextVisible(!0),this.drawTextChange())},_nodeCoverHandler:function(e){this.drawChildAppend(e)},_nodeRestoreHandler:function(){var e=this._startMatrix;e&&this._mindNode.moveToPos(e.m.e,e.m.f),this._startMatrix=null},_deleteHandler:function(){this.drawDelete(),this._option.remarkVisible&&this.__triggerEvent(n.REMARK_SHOW,this,!1)},_clickHandler:function(){this._option.contentClickViewAble&&(this.getTextVisible()||(this.toggleTextVisible(),this.drawTextChange()))},_expandHandler:function(){this.drawExpandChange()},_rightClickHandler:function(){this.__triggerEvent(n.MENU_SHOW,this)},_menuClickHandler:function(e,t){switch(e){case r.EDIT:var i=this._getEditTextPos();this.__triggerEvent(n.EDITTEXT_CHANGE_NODE,this._nodeId,i.left,i.top,this),this.__triggerEvent(n.EDITTEXT_SHOW,this.getText(),this._nodeId,i.left,i.top);break;case r.VISIBLE:this.toggleTextVisible(),this.drawTextChange();break;case r.COPY:break;case r.CUT:case r.PASTE:this.drawTextChange(t);break;case r.DELETE:this.drawDelete(),this._option.remarkVisible&&this.__triggerEvent(n.REMARK_SHOW,this,!1)}},_triangleClickHandler:function(e){this.drawAddChildren(e)},_blurHandler:function(e){this._nodeId!==e&&(this.draw(o.REVERT),this._option.remarkVisible&&this.__triggerEvent(n.REMARK_SHOW,this,!1))},_downHandler:function(e){this.draw(o.ACTIVE,{eventType:e});var t=this._getEditTextPos();this.__triggerEvent(n.EDITTEXT_CHANGE_NODE,this._nodeId,t.left,t.top,this),this._mindNode.setVisibleImageActive(!0),this._option.remarkVisible&&this.__triggerEvent(n.REMARK_SHOW,this,!0)},_beforeMoveHandler:function(){this.getMoveAble()&&(this._mindNode.bringTop(),this._moveSubX=0,this._moveSubY=0,this._startMatrix=this._mindNode.__getShape().getTransform(),this._mindNode.setVisibleImageActive(!1),this.drawBeforeMove(),this._option.remarkVisible&&this.__triggerEvent(n.REMARK_SHOW,this,!1))},_moveHandler:function(e,t){this.getMoveAble()&&(this._moveSubX+=e,this._moveSubY+=t,this.drawMove(e,t))},_afterMoveHandler:function(){this.getMoveAble()&&(this.drawAfterMove(this._moveSubX,this._moveSubY),this._moveSubX=0,this._moveSubY=0)},_upHandler:function(e,t,i){this._mindNode.setVisibleImageActive(!1),this.drawUp(e,t,i),this._option.remarkVisible&&!this._option.animate&&this.__triggerEvent(n.REMARK_SHOW,this,!0)},_dbClickHandler:function(){if(this.getTextVisible()&&this.getContentEditAble()){var e=this._getEditTextPos();this.__triggerEvent(n.EDITTEXT_SHOW,this.getText(),this._nodeId,e.left,e.top)}},_textChangeHandler:function(e,t){this.drawTextChange(e,t)},_getEditTextPos:function(){var e=this,i=t("#"+e._option.mindBodyId),n=i[0].getBoundingClientRect(),r=i.width(),o=n.width/r,a=this._mindNode.getTextNode().node.getBoundingClientRect(),s={left:(a.left-n.left)/o,top:(a.top-n.top)/o};return s}});i.MindNodeCore.__include(a)}(e,jQuery,n),function(e,t,i){"use strict";var n=(i.Utils,{_exContentEditAble:!0,_exDeleteAble:!0,_exMoveAble:!0,_exRequireChildren:!1,_exRequireContent:!1,_exChangeParentAble:!0,_exChangeBroAble:!0,setExtendProperties:function(e){this.setChangeBroAble(e.changeBroAble),this.setChangeParentAble(e.changeParentAble),this.setContentEditAble(e.contentEditAble),this.setDeleteAble(e.deleteAble),this.setMoveAble(e.moveAble),this.setRequireChildren(e.requireChildren),this.setRequireContent(e.requireContent)},getChangeBroAble:function(){return this._exChangeBroAble},setChangeBroAble:function(e){e!==!0&&e!==!1?this._exChangeBroAble=!0:this._exChangeBroAble=e},getContentEditAble:function(){return this._exContentEditAble},setContentEditAble:function(e){e!==!0&&e!==!1?this._exContentEditAble=!0:this._exContentEditAble=e},getDeleteAble:function(){return this._exDeleteAble},setDeleteAble:function(e){e!==!0&&e!==!1?this._exDeleteAble=!0:this._exDeleteAble=e},getMoveAble:function(){return this._exMoveAble},setMoveAble:function(e){e!==!0&&e!==!1?this._exMoveAble=!0:this._exMoveAble=e},getRequireChildren:function(){return this._exRequireChildren},setRequireChildren:function(e){e!==!0&&e!==!1?this._exRequireChildren=!1:this._exRequireChildren=e},getRequireContent:function(){return this._exRequireContent},setRequireContent:function(e){e!==!0&&e!==!1?this._exRequireContent=!1:this._exRequireContent=e},getChangeParentAble:function(){return this._exChangeParentAble},setChangeParentAble:function(e){e!==!0&&e!==!1?this._exChangeParentAble=!0:this._exChangeParentAble=e}});i.MindNodeCore.__include(n)}(e,jQuery,n),function(e,t,i){"use strict";var n=i.Utils,r=i.Config.CHANGE_REASON,o={getTriangleFullWidth:function(){return this._mindNode.getTriangleFullWidth()},getChildByOrientation:function(e){var t=[];return e?(this.getChildren().forEach(function(i){i.getOrientation()===e&&t.push(i)}),t):this._children},getNodeId:function(){return this._nodeId},_makeContainParentsId:function(){this.getParent()?this._containParentsId=this.getParent().getContainParentsId()+this._nodeId+"|":this._containParentsId=this._nodeId+"|"},setContainParentsId:function(e){this._containParentsId=e},getContainParentsId:function(){return this._containParentsId},getRenderBox:function(){return this.getMindNodeShape().getRenderBox()},getRectPathRenderBox:function(){return this._mindNode.getRectPath().getRenderBox()},getTransform:function(){return this.getMindNodeShape().getTransform()},getChildrenCount:function(){return this._children.length},traverse:function(e,t,i){t&&e(this);var n=this.getChildren();!this.isRoot()||"left"!==i&&"right"!==i||(n=this.getChildByOrientation(i));for(var r=0;r<n.length;r++)n[r].traverse(e,!0,i)},getOrientation:function(){if(this.isRoot())return"both";if("both"!==this._option.type)return this._option.type;var e=this.getTransform();return e.m.e<0?"left":"right"},getChildOrientation:function(){var e,t,i="none";return this._children.forEach(function(i){var n=i.getOrientation();"left"===n?e=!0:t=!0}),e&&t?"both":e?"left":t?"right":i},getChildren:function(){return this._children},getParent:function(){return this._parent},getLevel:function(){return this._level},isLeaf:function(){return 0===this._children.length},getRoot:function(){return this._root||this},getMinder:function(){return this._minder},getData:function(e,t,i){var n=this;this.isRoot()&&(i||this.trvMathChildPosition(),this.resetRootChildrenSort());var r=n._mindNode.__getShape().getTransform();r.m.e=Math.round(r.m.e),r.m.f=Math.round(r.m.f);var o={data:{identifier:this._identifier,text:n.getText(),orientation:n.getOrientation(),textVisible:n.getTextVisible(),matrix:r.m.e+" "+r.m.f,isExpand:n.isExpand()},children:[]};if(!i){var a=Math.round(this._toX-r.m.e),s=Math.round(this._toY-r.m.f);a!==s&&0!==a&&(o.data.offset=a+" "+s),delete o.data.matrix}if(this.isRoot()&&!e&&(o.remark=t={}),t){var h=this.getRoot()._rootRemark[this._identifier];void 0!==h&&""!==h&&(t[this._identifier]=h)}return n.getRequireChildren()===!0&&(o.data.requireChildren=!0),n.getRequireContent()===!0&&(o.data.requireContent=!0),n.getContentEditAble()===!1&&(o.data.contentEditAble=!1),n.getDeleteAble()===!1&&(o.data.deleteAble=!1),n.getMoveAble()===!1&&(o.data.moveAble=!1),n.getChangeParentAble()===!1&&(o.data.changeParentAble=!1),n.getChangeBroAble()===!1&&(o.data.changeBroAble=!1),this.getChildren().forEach(function(n){o.children.push(n.getData(e,t,i))}),o},trvRenderData:function(e){var t=this,i=e.data;"undefined"!=typeof i.isExpand&&t.setExpand(i.isExpand),t.setExtendProperties(i),e.children&&e.children.forEach(function(e){var i=e.data;t.addNode(i,void 0,!0)}),t.getChildren().forEach(function(t,i){if(t.trvRenderData(e.children[i]),e.children[i].data.matrix){var n=e.children[i].data.matrix.split(" ");2===n.length?t.setToPosition(parseInt(n[0]),parseInt(n[1])):6===n.length&&t.setToPosition(parseInt(n[4]),parseInt(n[5]))}}),t.isRoot()&&(this.trvMathChildHeight(),this.trvMathChildPosition(),this._trvRenderDataOffset(e),this._rootRemark=e.remark||{},this.layout({global:!0,animate:!1,mathPos:this._option.renderDataAutoLayout,reason:r.RENDER}),this.resetRootChildrenSort(),this.trvShow())},_trvRenderDataOffset:function(e){this.getChildren().forEach(function(t,i){if(t._trvRenderDataOffset(e.children[i]),e.children[i].data.offset){var n=e.children[i].data.offset.split(" ");2===n.length&&t.setToPosition(t._toX-parseInt(n[0]),t._toY-parseInt(n[1]))}})},rtSetRemark:function(e){this.getRoot()._rootRemark[this._identifier]=e},rtGetRemark:function(){return this.getRoot()._rootRemark[this._identifier]||""},removeChild:function(e){var t,i;t=this._children.indexOf(e),t>=0&&(i=this._children.splice(t,1)[0],i._parent=null),this._mindNode.updateRectPathFill()},insertChild:function(e,t){void 0===t&&(t=this._children.length),e._parent&&e._parent.removeChild(e),e._parent=this,e._root=this._root,e._level=this._level+1,this._children.splice(t,0,e),this._mindNode.updateRectPathFill()},appendChild:function(e){return this.insertChild(e)},getIndex:function(){return this._parent?this._parent.getChildren().indexOf(this):-1},getChild:function(e){return this._children[e]},isRoot:function(){return this._root===this},getMinderNodeById:function(e){var t=this.getNodeId()===e?this:null;if(!t)for(var i=this.getChildren(),n=0;n<i.length;n++)if(t=i[n].getMinderNodeById(e))return t;return t},changeBroRelation:function(e,t){if(this.isRoot())return{flag:!1};var i=this.getParent().getChildren(),r=n.getItemInArrayById(i,e,"getNodeId");if(r){var o=i.indexOf(r),a=i.indexOf(this);return o>a&&o--,"bottom"===t&&o++,this.getParent().insertChild(this,o),{flag:!0,relationChange:o!==a}}return{flag:!1}},rtGetPosRecords:function(){return this.getRoot().positionRecord},rtSetPosRecord:function(e,t){this.getRoot().positionRecord[e]=t},getComplex:function(e){var t=0;return this.traverse(function(){t++},!1,e),t},resetRootChildrenSort:function(){var e=this.getRoot().getChildren(),t=[],i=[];e.forEach(function(e){"left"===e.getOrientation()?i.push(e):t.push(e)}),this.getRoot()._children=t.concat(i)}};i.MindNodeCore.__include(o)}(e,jQuery,n),function(e,t,i){"use strict";var n={preOrder:function(e){var t=this.getChildren();e(this),t.forEach(function(t){t.preOrder(e)})},postOrder:function(e){var t=this.getChildren();t.forEach(function(t){t.preOrder(e)}),e(this)}};i.MindNodeCore.__include(n)}(e,jQuery,n),function(e,t,i){var n="1.0.3",r=i.Logger,o=i.Utils,a=i.Config.EVENT_KEY,s=i.Config.CLASS_NAME,h=i.Config.CHANGE_REASON,d=i.Config.plusStyle,l=i.View.EditTextArea,_=i.View.Menu,c=i.View.Remark,u=i.View.Placeholder,g=i.MindNodeCore,f=i.Class.Base,p=i.Utils.Clipboard,v={create:function(e){var t=Object.create(this);for(var i in e)t[i]=e[i];return t.mindBodyId=o.getUuid(),t.maxScale=t.maxScale*t.baseScale,t.minScale=t.minScale*t.baseScale,t},nodeIndex:0,connectGroupId:"minder_connect_group_1",minderIdIndex:0,mindBodyId:o.getUuid(),onScale:null,onChange:null},m='<div class="${cls}" id="${id}"><input id="btn_focus" class="btn-focus" type="button" style="position: absolute"/></div>',E={x:2*d.circleWidth+5,y:20,remarkHeight:30};i.MindCore=f({_paper:null,_minder:null,_connectGroup:null,_root:null,_data:null,_editText:null,_menu:null,_option:null,_scale:1,_clipboard:null,_$mindBody:null,_tempLastId:null,create:function(e){var t=Object.create(this),n=i.Event.create();return t.__base(n,t._eventsInfo),t._option=v.create(e),t._clipboard=p.create(),t},getOption:function(){return this._option},render:function(e){var i=this,n={cls:s.MIND_BODY_CLASS+" "+s.MIND_BODY_PPT_SHELL_CLASS,id:i._option.mindBodyId};o.isMobile&&(n={cls:s.MIND_BODY_CLASS,id:i._option.mindBodyId});var r=o.String.template(m,n),a=this._$mindBody=t(r);a.on("contextmenu",function(e){e.preventDefault()}),t(e).html(a),i._editText||(i._editText=l.create(i.__getEventDispatch(),a,i._clipboard,i._option),i._option.showMenu&&(i._menu=_.create(i.__getEventDispatch(),a,i._clipboard,i._option),i._menu.setScale(i._option.baseScale)),i._option.remarkVisible&&(i._remark=c.create(i.__getEventDispatch(),a,i._option)),i._paper=new kity.Paper(a[0]),i._option.viewPort&&2==i._option.viewPort.length&&i._paper.setViewBox(0,0,i._option.viewPort[0],i._option.viewPort[1]),i._addMinder(),i.bindDomEvent()),i._createRoot(),i.scale(1),i.rootCenter(),o.isMobile&&this._option.editAble&&!this._option.lock&&this.focusRoot(),i._data&&i._root.trvRenderData(i._data.root),this._option.position.length>0&&i.changePosition(this._option.position),t(this._paper.node).on("resize",function(){i.onResize()})},onResize:function(){this._editText.setVisible(!1),this._menu&&this._menu.setVisible(!1),this.mathTotalScale(),this._editText.setScale(this.getTotalScale())},_createRoot:function(){this._root&&(this._root.destroy(),this._root=null);var e;this._data&&this._data.root&&(e=this._data.root.data.text);var t=this._root=g.create(this._option,this._minder,this.__getEventDispatch(),this._connectGroup,null,e,!0,this._paper);t.appendNode()},_addMinder:function(){var e=this._getCenterPoint();this._minder=(new kity.Group).setId("minder_"+this._option.minderIdIndex++).translate(e.x,e.y),this._paper.addShape(this._minder),this._placeholder=u.create(this._minder,this._option.mindBodyId),this._connectGroup=(new kity.Group).setId(this._option.connectGroupId),this._minder.addShape(this._connectGroup)},_getCenterPoint:function(){return this._option.viewPort&&2===this._option.viewPort.length?{x:this._option.viewPort[0]/2,y:this._option.viewPort[1]/2}:{x:this._paper.getWidth()/2,y:this._paper.getHeight()/2}},getMinderNodeById:function(e){return this.getRoot().getMinderNodeById(e)},getShapeById:function(e){try{return this._paper.getShapeById(e)}catch(t){r.debug(t)}return null},getRoot:function(){return this._root},getData:function(e,t){var i=this,r={root:{},minder:"",version:n};return i._minder,i._root&&(r.root=i._root.getData(e,null,t)),r},setData:function(e){e&&e.root&&e.root.data&&e.version?this._data=e:(this._data=null,r.warn("MinderMap","传入数据不合法"))},setLock:function(e){var t=this;t._option.lock=e,e&&this.blur()},getLock:function(){return this._option.lock},getEditAble:function(){return this._option.editAble},blur:function(e){e="undefined"==typeof e,e?this.__triggerEvent(a.DOM_HIDE):(this._editText.setVisible(!1),this._menu&&this._menu.setVisible(!1)),this.__triggerNodeEvent(a.NODE_BLUR)},getEditTextVisible:function(){return this._editText.isVisible()},setEditAble:function(e){var t=this;t._option.editAble=e,e||this.blur()},_nodeToCenter:function(e,t){if(e){var i=e.getMindNodeShape().getTransform(),n=this.getScale(),r=e.getRectPath().getWidth()*n,o=e.getRectPath().getHeight()*n,s=this._getCenterPoint(),d=this._minder.getTransform();t?d.m.e=s.x-i.m.e*n:d.m.e=s.x-i.m.e*n-r/2,d.m.f=s.y-i.m.f*n-o/2,this._minder.setMatrix(d),this.__triggerEvent(a.DOM_HIDE),this._option.onChange(h.MINDER_MOVE)}},focusCenter:function(e){var t=this.getCurMinderNode();this._nodeToCenter(t,e)},rootCenter:function(e){var t=this,i=t._minder.getTransform(),n=t._getCenterPoint(),r=this.getRoot(),o=this.getScale(),s=r.getRectPath().getWidth()*o,d=r.getRectPath().getHeight()*o;i.m.e=n.x-s/2,i.m.f=n.y-d/2,t._minder.setMatrix(i),t.__triggerEvent(a.DOM_HIDE),e!==!1&&this._option.onChange(h.MINDER_MOVE)},focusIn:function(e){if(e&&!e.isRemove()){var t=e.getRectPath().getRenderBox(),i=e.getMindNodeShape().getRenderBox(),n=e.getMindNodeShape().node.getCTM(),r=n.a,o=this._minder.getTransform(),a=t.width*r,s=i.height*r,d=this._paper.getWidth(),l=this._paper.getHeight(),_=E.x*r,c=E.y*r+2,u=E.remarkHeight*r;n.f=n.f-(i.height-t.height)*r,n.e<_&&(o.m.e+=(_-n.e)/n.a*this.getScale()),this._option.remarkVisible&&this.getCurMinderNode()&&this.getCurMinderNode().isActive()&&this._remark.isVisible()?n.f<u+c&&(o.m.f-=(n.f-c-u)/n.a*this.getScale()):n.f<0&&(o.m.f-=(n.f-c)/n.a*this.getScale()),n.e+a+_>d&&(o.m.e-=(n.e+a-d+_)/n.a*this.getScale()),n.f+s>l&&(o.m.f-=(n.f+s-l+c)/n.a*this.getScale()),this._minder.setMatrix(o),this._option.onChange(h.MINDER_MOVE)}},scale:function(e){var t=this;e=t._option.baseScale*e,e>t._option.maxScale&&(e=t._option.maxScale),e<t._option.minScale&&(e=t._option.minScale);var i=t._minder.getTransform();i.m.a=e,i.m.d=e,t._minder.setMatrix(i),t._scale=e,t._option.onScale(t.getRelativeScale());this._minder.container.node.getCTM();this.mathTotalScale(),t._editText.setScale(this.getTotalScale()),t._remark&&t._remark.setScale(this.getTotalScale()),this.__triggerEvent(a.DOM_HIDE),this._option.remarkVisible&&t.nodeBlur(),this._option.onChange(h.MINDER_SCALE)},getScale:function(){return this._scale},getRelativeScale:function(){return this._scale/this._option.baseScale},mathTotalScale:function(){var e=this._$mindBody[0].getBoundingClientRect(),t=this._$mindBody.width(),i=e.width/t,n=this._minder.container.node.getCTM();this._totalScale=i*this.getScale()*n.a},getTotalScale:function(){return this._totalScale},matchParent:function(){var e=this,t=e._minder.getRenderBox(),i=this._minder.container.node.getCTM(),n=e._paper.getWidth(),r=e._paper.getHeight(),o=t.width*i.a,a=t.height*i.a,s=1;if((o>=n||a>=r)&&0!==o&&0!==a&&(s=n/o<r/a?n/o:r/a,n-=2*E.x*s,r-=2*E.y*s,this._remark&&this._remark.isVisible()&&!this._option.lock&&(r-=E.remarkHeight*s)),s=1,o>n&&(s=n/o,o=n,a*=s),a>r){var d=r/a;a=r,o*=d,s*=d}var l=this._minder.getTransform();e.scale(l.m.a/e._option.baseScale*s),e.rootCenter(!1),l=this._minder.getTransform(),t=e._minder.getRenderBox();var s=this.getScale(),_=this.getRoot(),c=_.getRectPath().getWidth()*s,u=_.getRectPath().getHeight()*s;l.m.e=l.m.e+(c/2+l.m.e-t.cx),l.m.f=l.m.f+(u/2+l.m.f-t.cy),this._minder.setMatrix(l),this._option.onChange(h.MINDER_MOVE)},changePosition:function(e){var t=this._minder.getTransform(),i=this._minder.container.node.getCTM(),n=i.a,r=this._minder.getRenderBox(),o=this.getScale(),s=E.x*o,d=E.y*o,l=this._paper.getWidth()-2*s,_=this._paper.getHeight()-2*d;e.forEach(function(e){if("middle"===e){var a=this.getRoot(),h=a.getRectPath().getWidth()*o*n,c=a.getRectPath().getHeight()*o*n;t.m.e=t.m.e+(h/2+t.m.e-r.cx),t.m.f=t.m.f+(c/2+t.m.f-r.cy)}else"left"===e?t.m.e=-i.e/n+s:"top"===e?t.m.f=t.m.f-r.top+d:"right"===e?t.m.e=l/n-r.width-i.e/n:"bottom"===e&&(t.m.f=t.m.f+_/n-r.bottom)}),this._minder.setMatrix(t),this._option.onChange(h.MINDER_MOVE),this.focusIn(this.getCurMinderNode()),this.__triggerEvent(a.DOM_HIDE)},hasChange:function(){var e=this._data;if(null===e)return!0;var t=o.JsonDiff.compare(e,this.getData());return t.length>0},clear:function(){this._data={},this._root&&(this._root.destroy(),this._root=null),this._option.nodeIndex=0;var e=this._minder.getTransform();e.m.a=this._option.baseScale,e.m.d=this._option.baseScale,this._minder.setMatrix(e),this._createRoot(),this.rootCenter(),this.__triggerEvent(a.DOM_HIDE),this._option.onChange(h.CLEAR)},destroy:function(){this.__destroy(),this.removeDomEvent(),this._placeholder&&(this._placeholder=null),this._data={},this._root&&(this._root.destroy(),this._root=null),this._editText&&(this._editText.destroy(),this._editText=null),this._menu&&(this._menu.destroy(),this._menu=null),this._connectGroup&&(this._connectGroup.remove(),this._connectGroup=null),this._paper=null,this._minder=null},resizeRemark:function(){var e=this.getCurMinderNode(),t=e&&e.isActive();this._option.remarkVisible&&this.__triggerEvent(a.REMARK_SHOW,e,t)}})}(e,jQuery,n),function(e,i,n){var r=n.Logger,o=n.Utils,a=n.Config.EVENT_KEY,s=(n.Config.MENU_TYPE_KEY,n.ID),h=n.Config.DOM_EVENT_TYPE,d=n.Config.CHANGE_REASON,l={isDown:function(e){return"touchstart"===e||"mousedown"===e},isUp:function(e){return/^(touchend|touchcancel|mouseup|mouseleave)$/.test(e)},isMove:function(e){return"mousemove"===e||"touchmove"===e},isTouch:function(e){return/^(touchend|touchcancel|touchstart|touchmove)$/.test(e)},getClientPos:function(e){var e=e.originalEvent?e.originalEvent:e,t={};switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return t.x=e.changedTouches[0].pageX,t.y=e.changedTouches[0].pageY,t;default:return t.x=e.pageX,t.y=e.pageY,t}return t}},_={_eventsInfo:[{nodeEvent:!1,key:a.NODE_DRAWING,fucs:"_drawingHandler",params:["start/end"]},{nodeEvent:!1,key:a.NODE_CENTER,fucs:"_nodeCenterHandler",params:["nodeId"]}],_nodeData:null,_plusOperate:!1,_editShowTimeOutId:0,_nodeCenterId:"",_dblClickTrigger:!1,_isDrawing:!1,_outClickInstance:null,_curMinderNode:null,_isRootFocus:!1,_totalScale:1,getCurMinderNode:function(){return this._curMinderNode},setCurMinderNode:function(e){this._curMinderNode=e},focusNode:function(e,t){(this.getCurMinderNode()||this._isRootFocus)&&(this._isRootFocus=!1,this.__triggerNodeEvent(a.NODE_BLUR)),this.__setNodeId(e),this.__triggerNodeEvent(a.NODE_DOWN,o.isMobile?h.TOUCH:""),this.setCurMinderNode(t)},focusRoot:function(){this.focusNode(this._root.getNodeId(),this._root)},focusEditDisableRoot:function(){this._isRootFocus=!0,this._root.drawFocusEditDisable()},nodeBlur:function(){this.__triggerNodeEvent(a.NODE_BLUR),this._nodeData=null},_nodeCenterHandler:function(e){this._nodeCenterId=e},_drawingHandler:function(e){var t=this;if("start"===e){if(t._isDrawing=!0,this._plusOperate){var n=i("#"+t._option.mindBodyId+" #minder_0 > g:last").attr("id"),r=t.getMinderNodeById(n);(this.getCurMinderNode()||this._isRootFocus)&&(this._isRootFocus=!1,this.__triggerNodeEvent(a.NODE_BLUR)),this.__setNodeId(n),this.setCurMinderNode(r)}this._option.remarkVisible&&this.__triggerEvent(a.REMARK_SHOW,this.getCurMinderNode(),!1)}else"end"===e&&(t._isDrawing=!1,this._plusOperate&&!o.isMobile?(this.getCurMinderNode()&&this.getCurMinderNode().getMindNodeShape&&t.focusIn(this.getCurMinderNode()),t._editShowTimeOutId=setTimeout(function(){t.__triggerNodeEvent(a.NODE_DBLCLICK)},100)):this._nodeCenterId&&o.isMobile?(this._nodeToCenter(this.getMinderNodeById(this._nodeCenterId)),this._nodeCenterId=""):this.getCurMinderNode()&&this.getCurMinderNode().getMindNodeShape&&t.focusIn(this.getCurMinderNode()),this._plusOperate&&this.__triggerNodeEvent(a.NODE_DOWN,o.isMobile?h.TOUCH:""),this.getCurMinderNode()&&this.getCurMinderNode().isActive()&&(this._option.remarkVisible&&this.__triggerEvent(a.REMARK_SHOW,this.getCurMinderNode(),!0),t.focusIn(this.getCurMinderNode())),this._plusOperate=!1)},_init:function(e){var t=this;this._plusOperate=!1,clearTimeout(t._editShowTimeOutId),t._nodeData=t._getTargetNode(e),t.__setNodeId(t._nodeData.id),t.getCurMinderNode()&&t.getCurMinderNode().getNodeId()!==t._nodeData.id?(t.getCurMinderNode().__triggerNodeEvent(a.NODE_BLUR),t.__triggerEvent(a.DOM_HIDE,!0)):this._menu&&this._menu.setVisible(!1),t.setCurMinderNode(t.getMinderNodeById(this._nodeData.id))},_getTargetNode:function(e){var t=this;if(e=e.originalEvent||e,e.srcElement){for(var i,n=e.srcElement;n&&(i||(i=s.getTargetValue(n.id)),!s.isNode(n.id));)n=n.parentNode;
if(n)return{node:t._paper.getShapeById(n.id),id:n.id,value:i}}return{node:t._minder,id:t._minder.node.id}},_delBtnEvent:function(e){var t=this,i=e.type||"";if("mTap"===i){t.__triggerEvent(a.DOM_HIDE,!1);var n=this.getCurMinderNode();this.setCurMinderNode(null),n.__triggerNodeEvent(a.NODE_DELETE)}},_plusEvent:function(e){var t=this,i=e.type||"";"mTap"===i&&(t.__triggerEvent(a.DOM_HIDE,!1),this._plusOperate=!0,t.__triggerNodeEvent(a.NODE_TRIANGLE_CLICK,t._nodeData.value.orientation))},_expandEvent:function(e){var t=this,i=e.type||"";"mTap"===i&&(t.__triggerEvent(a.DOM_HIDE,!1),t.__triggerNodeEvent(a.NODE_EXPAND),t.__triggerNodeEvent(a.NODE_BLUR))},_nodeEvent:function(e){var t=this,i=e.mType||"",n=s.isRoot(t._nodeData.id);if("creating"!==t._nodeData.node.getAttr("status"))switch(i){case"mDblclick":o.isMobile||t.__triggerNodeEvent(a.NODE_DBLCLICK);break;case"mTap":t.__triggerNodeEvent(a.NODE_CLICK),e.mTouchTrigger&&t._isActiveBeforeDown&&t.getCurMinderNode().isActive()&&(e.preventDefault(),o.isMobile&&t.getCurMinderNode().getContentEditAble()&&(t._dblClickTrigger=!0,t.focusCenter(!0)),t.__triggerNodeEvent(a.NODE_DBLCLICK),o.isMobile&&setTimeout(function(){t._dblClickTrigger=!1},500));break;case"mTouchLong":case"contextmenu":t.__triggerNodeEvent(a.NODE_RIGHT_CLICK);break;case"down":"touchstart"===e.type&&(t._isActiveBeforeDown=t.getCurMinderNode().isActive()&&t.getCurMinderNode().getTextVisible()&&!t._editText.isVisible()),t.nodeCoverMoveDown(t._nodeData.id),t.__triggerNodeEvent(a.NODE_DOWN,l.isTouch(e.type)?h.TOUCH:h.MOUSE),t.focusIn(t.getCurMinderNode());break;case"beforemove":n||t.__triggerNodeEvent(a.NODE_BEFORE_MOVE),this.mathTotalScale();break;case"move":n||(t.__triggerNodeEvent(a.NODE_MOVE,e.mMoveAbs.x/t.getTotalScale(),e.mMoveAbs.y/t.getTotalScale()),t.nodeCoverMove());break;case"aftermove":n||t.__triggerNodeEvent(a.NODE_AFTER_MOVE);break;case"up":var r=t.nodeCoverMoveUp();t.__triggerNodeEvent(a.NODE_UP,l.isTouch(e.type)?h.TOUCH:h.MOUSE,r,e.mMoveTrigger)}},_events:function(e){var t=this,i=e.mType;if("move"!==i&&r.debug("dommevent",i),t._isDrawing)return void("down"===e.mType&&t._init(e));switch(e.mType){case"down":t._init(e);break;case"mPinch":if("move"===e.fingerStatus){var n=e.scale*t.getRelativeScale();t.scale(n)}break;case"beforemove":t._minderCTM=t._minder.container.node.getCTM(),t.__triggerEvent(a.DOM_HIDE,!1);break;case"move":if(!t._option.editAble||s.isRoot(t._nodeData.id)||t._nodeData.node===t._minder){var o=e.mMoveAbs.x,h=e.mMoveAbs.y;t._minderCTM&&(o/=t._minderCTM.a,h/=t._minderCTM.a),t._minder.translate(o,h)}break;case"aftermove":t._option.editAble&&t._nodeData.node!==t._minder||t._option.onChange(d.MINDER_MOVE);break;case"mDblclick":t._nodeData.node===t._minder&&t._option.disableKeyMap.indexOf("mpdblclick")<0&&(t.matchParent(),t._option.position.length>0&&t.changePosition(t._option.position))}if(t._nodeData&&t._nodeData.value){var l=t._nodeData.value;t._option.editAble?"expand"===l.type?t._expandEvent(e):"plus"===l.type?t._plusEvent(e):"node"===l.type?t._nodeEvent(e):"del"===l.type&&t._delBtnEvent(e):"node"===l.type&&"mTap"===i&&t._option.contentClickViewAble?t.__triggerNodeEvent(a.NODE_SHOW_CONTENT):"expand"===l.type&&t._expandEvent(e)}},bindDomEvent:function(){var e=this;e.__proxyAll(["_events","_docKeyListener"]),i(e._paper.node).attr("data-pinch-intensity",this._option.pinchIntensity),e._domEvents(),e._docKeyListener(),o.isMobile?i(e._paper.node).on(" mTap mDblclick contextmenu  touchstart touchmove touchend touchcancel  mPinch  mTouchLong",e._domEvents):(i(e._paper.node).on(" mTap mDblclick mousedown  mouseup mousemove contextmenu  mouseleave touchstart touchmove touchend touchcancel  mPinch mTouchLong ",e._domEvents),i(t.body).on("keydown keyup mousewheel",e._docKeyListener));var r=e._option.triggerBlurContainer||t.body;e._outClickInstance=n.Utils.OutClick.create(r),i(e._paper.node).mOutclick(function(){e.__triggerEvent(a.DOM_HIDE,!0)},i("#"+e._option.mindBodyId)[0],e._outClickInstance)},_domEvents:function(){var e=this,t=function(e,t,i,n){var r=n-i,o=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return!(r>800||o>=4||a>=4)},i=!1,n=!1,a=!1,s=!1,h=0,d={},_={},c=function(c){if(!e._option.lock){var u=c.type||"";if(o.isMobile&&e._dblClickTrigger)return c.preventDefault(),void c.stopPropagation();switch("mousemove"!==u&&"touchmove"!==u&&r.debug("domevent",u),u){case"contextmenu":c.preventDefault(),c.mType=u;break;case"mousedown":case"touchstart":if(h=(new Date).getTime(),"mousedown"===u&&(d=l.getClientPos(c)),i&&c.originalEvent&&c.originalEvent.touches&&c.originalEvent.touches.length>1)break;i=!0,a=!1,"touchstart"===u&&(n=!0),c.mType="down";break;case"mousemove":case"touchmove":if(!i)return;if(c.preventDefault(),s)return;var g=o.getEventPagePos(c),f=g.x-_.x,p=g.y-_.y;c.mMoveAbs={x:f,y:p},0===f&&0===p||(a||(c.mType="beforemove",e._events(c)),c.mType="move",a=!0);break;case"touchend":case"touchcancel":case"mouseup":case"mouseleave":a&&(c.mType="aftermove",e._events(c)),c.mMoveTrigger=a,a=!1,i=!1,c.mType="up";break;case"mTap":if(c.mType=u,"touchclick"===c.tapEventSource||"mouseclick"===c.tapEventSource&&n?c.mTouchTrigger=!0:c.mTouchTrigger=!1,n=!1,"mouseclick"===c.tapEventSource){var v=t(d,l.getClientPos(c),h,(new Date).getTime());if(!v)return}break;case"mDblclick":if("mouseclick"===c.tapEventSource){var v=t(d,l.getClientPos(c),h,(new Date).getTime());if(!v)return}c.mType="mDblclick";break;case"mPinch":c.mType=u,"start"===c.fingerStatus?s=!0:"move"===c.fingerStatus||"end"===c.fingerStatus&&(s=!1);break;default:c.mType=u}e._events(c),(l.isMove(u)||l.isDown(u))&&(_=o.getEventPagePos(c))}};e._domEvents=c},removeDomEvent:function(){i(t.body).off("keydown",this._docKeyListener),i(t.body).off("keyup",this._docKeyListener),i(t.body).off("mousewheel",this._docKeyListener),this._outClickInstance&&this._outClickInstance.disable()},_docKeyListener:function(e){var t=this,n=!1,r=0,o=!1,a=function(e){if(!t._option.lock)switch(e.type){case"keydown":n=!0,r=e.keyCode,o=e.ctrlKey,o&&t._option.disableKeyMap.indexOf("ctrl++/")<0&&(187===r||107===r?(e.preventDefault(),t.scale(t.getRelativeScale()+.15*t.getRelativeScale())):189!==r&&109!==r||(e.preventDefault(),t.scale(t.getRelativeScale()-.15*t.getRelativeScale())));break;case"keyup":n=!1,o=!1,r=0;break;case"mousewheel":t._option.disableKeyMap.indexOf("space+wheel")<0&&n&&32===r&&(e.preventDefault(),i("#"+t._option.mindBodyId).find("#btn_focus").focus(),t.scale(t.getRelativeScale()+(e.originalEvent.deltaY<0?1:-1)*t.getRelativeScale()*.15))}};return void(t._docKeyListener=a)}};n.MindCore.__include(_)}(e,jQuery,n),function(e,t,i){i.Logger,i.Utils,i.Config.EVENT_KEY,i.Config.MENU_TYPE_KEY;i.MindCore.__include({})}(e,jQuery,n),function(e,t,i){var n=i.Logger,r=i.Utils,o=i.Config.EVENT_KEY,a=i.ID,s=i.Config.nodeStyle,h={_coverType:"",_coverTargetRectPath:null,_coverPlaceholderRectPath:null,_mouseRateNum:0,_curMoveMinderNode:null,_getCurMoveMinderNode:function(){return this._curMoveMinderNode},_recoveryRectPathStyle:function(){if(this._coverTargetRectPath.nodeId){var e=t("#"+this._option.mindBodyId+" #"+this._coverTargetRectPath.nodeId+">path");e.css(s.strokeStyle)}},_isCoverOtherRect:function(e){var t={};t.p1={x:e.innerRectX,y:e.innerRectY},t.p2={x:e.innerRectX+e.innerRectWidth,y:e.innerRectY+e.innerRectHeight};var i=this.getRoot().rtGetPosRecords(),n=s.width/10,o=s.height/8;for(var a in i){var h=i[a];if(h.visible&&!(h.containParentId.indexOf(e.containParentId)>=0)){var d={};if(d.p1={x:h.innerRectX+n,y:h.innerRectY+o},d.p2={x:h.innerRectX+h.innerRectWidth-n,y:h.innerRectY+h.innerRectHeight-o},r.checkRectsCross(t,d))return{success:!0,coverNodeId:a}}}return{success:!1}},_isCoverPlaceholderRect:function(e){var t={};t.p1={x:e.innerRectX,y:e.innerRectY},t.p2={x:e.innerRectX+e.innerRectWidth,y:e.innerRectY+e.innerRectHeight};var i=this.getRoot().rtGetPosRecords(),n=s.width/10,o=s.height/8;for(var a in i){var h=i[a];if(h.visible&&!(h.containParentId.indexOf(e.containParentId)>=0)){var d=e.containParentId.substring(0,e.containParentId.length-e.nodeId.length),l=h.containParentId.substring(0,h.containParentId.length-a.length);if(d===l){var _={};_.p1={x:h.innerRectX+n,y:h.innerRectY+o},_.p2={x:h.innerRectX+h.innerRectWidth-n,y:h.innerRectY+s.height-o};var c={p1:{x:_.p1.x,y:_.p1.y-s.height},p2:{x:_.p2.x,y:_.p2.y-s.height}},u={p1:{x:_.p1.x,y:_.p1.y+h.innerRectHeight},p2:{x:_.p2.x,y:_.p2.y+h.innerRectHeight}};if(r.checkRectsCross(t,c))return{success:!0,nodeId:a,direction:"top"};if(r.checkRectsCross(t,u))return{success:!0,nodeId:a,direction:"bottom"}}}}return{success:!1}},_coverReset:function(){this._curMoveMinderNode=null,this._mouseRateNum=0,this._coverTargetRectPath={},this._coverPlaceholderRectPath={},this._coverType=""},nodeCoverMoveUp:function(){if(this._getCurMoveMinderNode()){var e=this._coverType,t=this._coverTargetRectPath.nodeId,i=this._getCurMoveMinderNode(),n=i.getNodeId(),r=!1;if(this._placeholder.setVisible(!1),this._recoveryRectPathStyle(),i)if("cover"===e)null!==t&&t!==n&&(this._curMoveMinderNode.getChangeParentAble()?this.__triggerNodeEventByNodeId(o.NODE_COVER,t,i):this.__triggerNodeEventByNodeId(o.NODE_RESTORE,n),r=!0);else if("coverPlaceholder"===e){var a=this._coverPlaceholderRectPath.direction;t=this._coverPlaceholderRectPath.nodeId,r=!this._curMoveMinderNode.getChangeBroAble()||i.drawAndChangeBroRelation(t,a)}return this._coverReset(),r}},nodeCoverMove:function(){var e=this;if(this._getCurMoveMinderNode()&&(e._mouseRateNum++,this._getCurMoveMinderNode().getRectPath().setStyle(s.moveStyle),e._mouseRateNum%2===0)){var i=e._getCurMoveMinderNode().getCurNodePosition(),o=e._isCoverOtherRect(i);if(o.success===!0){if(!this._coverTargetRectPath.nodeId||this._coverTargetRectPath.nodeId!==o.coverNodeId){if(e._recoveryRectPathStyle(),this._coverTargetRectPath={nodeId:o.coverNodeId},this._coverType="cover",n.info(" TargetRect is cover at moving! "),!this._curMoveMinderNode.getChangeParentAble())return;var h=t("#"+e._option.mindBodyId+" #"+o.coverNodeId+">path");h.css(s.moveCoverStyle)}this._placeholder.setVisible(!1)}else{if(o=this._isCoverPlaceholderRect(i),o.success===!0){this._coverPlaceholderRectPath=o;var d=this._placeholder.getRectShape(),l=this.getShapeById(o.nodeId),_=r.String.getTemplateValue(o.nodeId,a._nodeId).i,c=this.getShapeById(a.getTextBorderId(_)),u=.7;d.setWidth(c.getWidth()),d.setHeight(s.height*u);var g=l.getTransform(),f=c.getTransform();g.m.e+=f.m.e,g.m.f+=f.m.f,"top"===o.direction?g.m.f-=s.height*u+5:g.m.f+=c.getHeight()+5,this._placeholder.setMatrix(g),this._curMoveMinderNode.getChangeBroAble()&&this._placeholder.setVisible(!0),this._coverType="coverPlaceholder"}else this._placeholder.setVisible(!1),this._coverType="";this._recoveryRectPathStyle(),this._coverTargetRectPath={}}}},nodeCoverMoveDown:function(e){if(this._curMoveMinderNode=this.getMinderNodeById(e),this._curMoveMinderNode.isRoot()||!this._curMoveMinderNode.getMoveAble())return void(this._curMoveMinderNode=null);this._mouseRateNum=0,this._coverTargetRectPath={},this._coverPlaceholderRectPath={},this._coverType="";var t=this.getRoot().rtGetPosRecords();for(var i in t){var n=this.getShapeById(i);n?t[i].visible="none"!==n.node.getAttribute("display"):delete t[i]}}};i.MindCore.__include(h)}(e,jQuery,n),function(e,t,i){var n=i.Logger,r=i.Config.CHANGE_REASON,o=function(e,t,i){"requireChildren"===e&&t.setRequireChildren(i),"requireContent"===e&&t.setRequireContent(i),"contentEditAble"===e&&t.setContentEditAble(i),"deleteAble"===e&&t.setDeleteAble(i),"moveAble"===e&&t.setMoveAble(i),"changeParentAble"===e&&t.setChangeParentAble(i),"changeBroAble"===e&&t.setChangeBroAble(i)},a={_createNode:function(e,t,i){var n=t.addNode(e,i,!0);if(n.setExpand(e.isExpand),e.matrix){var r,o=e.matrix.split(" ");r=6===o.length?new kity.Matrix(o[0],o[1],o[2],scale,o[4],o[5]):new kity.Matrix(1,0,0,1,o[0],o[1]),n.setMatrix(r)}return n},insertNode:function(e,t,i){var n=this;return t=this._createNode(e.data,t,i),e.children.forEach(function(e,i){n.insertNode(e,t,i)}),t},patches:function(e){for(var t="",i=0;i<e.length;i++){this.patch(e[i]);var n=e[i].path.split("/"),o=n.pop(),a=e[i].op;"add"===a?t=r.ADD:"remove"===a?t=r.DELETE:"replace"===a&&("text"===o&&(t=r.TEXT_CONTENT),"orientation"===o&&(t=r.ORIENTATION_CHANGE))}return this.getRoot().trvShow(),this.getRoot().trvDrawInit(),t&&this._option.onChange(t),this},patch:function(e){var t=e.path.split("/");t.shift();var i,r=t.shift();if("root"==r){var a=t.indexOf("data");if(a>-1){r="data";var s=t.splice(a+1);e.dataPath=s}else r="node";i=this.getRoot();for(var h,d;h=t.shift();)"children"!=h&&("undefined"!=typeof d&&(i=i.getChild(d)),d=+h);e.index=d,e.node=i}var l=e.express=[r,e.op].join(".");switch(n.debug("diff-patch",e),l){case"minder.replace":var _,c=e.value.split(" "),u=this._minder.getTransform().m.a;_=6===c.length?new kity.Matrix(u,c[1],c[2],u,c[4],c[5]):new kity.Matrix(u,0,0,u,c[0],c[1]),this._minder.setMatrix(_);break;case"node.add":this.insertNode(e.value,e.node,e.index);break;case"node.remove":e.node.getChild(e.index).destroy();break;case"data.replace":var s=e.dataPath.shift();if("text"===s&&(e.node.setText(e.value),e.node.layoutBox()),"matrix"===s){var _,c=e.value.split(" ");_=6===c.length?new kity.Matrix(c[0],c[1],c[2],u,c[4],c[5]):new kity.Matrix(1,0,0,1,c[0],c[1]),e.node.setMatrix(_)}"textVisible"===s&&(e.node.setTextVisible(e.value),e.node.layoutBox()),"isExpand"===s&&(e.node.setExpand(e.value),e.node.trvShow()),"identifier"===s&&e.node.setIdentifier(e.value),o(s,e.node,e.value),"requireChildren"===s&&e.node.layoutBox();break;case"data.remove":var s=e.dataPath.shift();o(s,e.node,void 0),"requireChildren"===s&&e.node.layoutBox();break;case"data.add":var s=e.dataPath.shift();o(s,e.node,e.value),"requireChildren"===s&&e.node.layoutBox()}}};i.MindCore.__include(a)}(e,jQuery,n),function(e,t,i){var n=i.Utils,r=i.Logger,o=i.Config.CHANGE_REASON,a=20;i.History={_undoDiffs:null,_redoDiffs:null,_minder:null,_lastSnap:null,_patchLock:null,create:function(e){var t=Object.create(this);return t._undoDiffs=[],t._redoDiffs=[],t._minder=e,t._lastSnap=t.getData(),t._minder.on("change",t.changed,t),t._minder.on("rendered",t.reset,t),t},reset:function(){this._undoDiffs=[],this._redoDiffs=[],this._lastSnap=this.getData()},getData:function(){return this._minder.getData(!0,!0)},makeUndoDiff:function(){var e=this.getData(),t=n.JsonDiff.compare(e,this._lastSnap);if(r.debug("diff-undo",JSON.stringify(t)),r.debug("diff-undo",JSON.stringify(t),this._undoDiffs,e,this._lastSnap),t.length){for(this._undoDiffs.push(t);this._undoDiffs.length>a;)this._undoDiffs.shift();return this._lastSnap=e,!0}},makeRedoDiff:function(){var e=this.getData(),t=n.JsonDiff.compare(e,this._lastSnap);this._redoDiffs.push(t),r.debug("diff-redo",JSON.stringify(t)),r.debug("diff-redo",t,this._redoDiffs),this._lastSnap=e},undo:function(){this._patchLock=!0;var e=this._undoDiffs.pop();e&&(this._minder._mindCore.patches(e),this.makeRedoDiff()),this._minder._eventBus.trigger("change",o.UNDO_REDO),this._patchLock=!1},redo:function(){this._patchLock=!0;var e=this._redoDiffs.pop();e&&(this._minder._mindCore.patches(e),this.makeUndoDiff()),this._minder._eventBus.trigger("change",o.UNDO_REDO),this._patchLock=!1},changed:function(e){return e===o.RENDER?void this.reset():void(this._patchLock||this.makeUndoDiff()&&(this._redoDiffs=[]))},hasUndo:function(){return!!this._undoDiffs.length},hasRedo:function(){return!!this._redoDiffs.length}}}(e,jQuery,n),function(e,i,n){var r=n.MindCore,o=n.Event,a=n.Logger,s=n.Utils,h=n.Config.DefaultLang,d=(n.Config.EVENT_KEY,n.Config.CHANGE_REASON),l={create:function(e){var t=Object.create(this);if(e)for(var n in e)t[n]=e[n],"langData"===n?t[n]=i.extend(!0,{},h,e.langData):null!==e[n]&&(t[n]=e[n]);return s.isMobile&&(t.animate=!1),t.rootVertical&&(t.rootPaddingX=10,t.rootPaddingY=15,t.rootMinWidth=43),"both"!==t.type&&(t.autoRideCount=1e4),t},lock:!1,maxScale:2.5,minScale:.1,editAble:!0,animate:!0,showMenu:!0,ignoreAttrTextVisible:!1,contentClickViewAble:!1,renderDataAutoLayout:!0,pinchIntensity:.8,baseScale:1,disableKeyMap:[],hideMenuItem:[],langData:h,triggerBlurContainer:null,autoRideCount:4,type:"both",rootVertical:!1,showRequireStar:!1,showRequireFill:!0,remarkVisible:!1,remarkEditAble:!1,viewPort:[],position:[]};e.MinderMap={_mindCore:null,_eventBus:null,_commandQueue:null,_history:null,_lang:null,create:function(e){var t=Object.create(this);return e=l.create(e),e.onScale=function(e){t._eventBus.trigger("scale",e)},e.onChange=function(e){return e===d.MINDER_MOVE||e===d.MINDER_SCALE?void t._mindCore.resizeRemark():(t._eventBus.trigger("change",e),void(e!==d.BRO_RELATION&&e!==d.PARENT_CHANGE&&e!==d.DELETE&&e!==d.TEXT_CONTENT&&e!==d.ORIENTATION_CHANGE&&e!==d.ADD&&e!==d.CLEAR||t._eventBus.trigger("contentChange",e)))},t._eventBus=o.create(),t._mindCore=r.create(e),t._history=n.History.create(t),t},render:function(e){var i=typeof e;"string"===i?e=t.getElementById(e):"object"===i&&e instanceof jQuery&&(e=e[0]),this._mindCore.render(e),this._eventBus.trigger("rendered",""),this._eventBus.trigger("change",d.RENDER)},setData:function(e){this._mindCore.setData(e)},getData:function(e,t){return this._mindCore.getData(e,t)},rootCenter:function(){this._mindCore.rootCenter(),this._mindCore.getEditAble()?this._mindCore.getLock()||this._mindCore.focusRoot():this._mindCore.focusEditDisableRoot()},focusRoot:function(){this._mindCore.focusRoot()},focusCenter:function(){this._mindCore.focusCenter()},blur:function(){this._mindCore.blur()},matchParent:function(){this._mindCore.matchParent()},changePosition:function(e){this._mindCore.changePosition(e)},hasChange:function(){return this._mindCore.hasChange()},setLock:function(e){this._mindCore.setLock(e)},setEditAble:function(e){this._mindCore.setEditAble(e)},clear:function(){this._mindCore.clear()},scale:function(e){this._mindCore.scale(e)},onResize:function(){this._mindCore.onResize()},undo:function(){this._mindCore.getEditTextVisible()?this._mindCore.blur(!1):(this.blur(),this._history.undo())},redo:function(){this._mindCore.getEditTextVisible()?this._mindCore.blur(!1):(this.blur(),this._history.redo())},hasUndo:function(){return this._history.hasUndo()},hasRedo:function(){return this._history.hasRedo()},on:function(e,t,i){this._eventBus.add(e,t,i||this)},off:function(e,t){this._eventBus.remove(e,t)},setLogLevel:function(e){a.setLevel(e)},getLang:function(e){return this._lang[e]},isValid:function(){var e=this.getData(!0,!0),t=function(e){var i=!0,n=e.data,r=e.children;if(n.requireChildren&&r.length<=0)return!1;if(n.requireContent&&""===n.text.trim())return!1;for(var o=0;o<r.length;o++)if(!t(r[o]))return i=!1;return i};return t(e.root)},destroy:function(){this._mindCore&&this._mindCore.destroy(),this._eventBus=null,this._mindCore=null}}}(e,jQuery,n)}(window,document,jQuery);
//# sourceMappingURL=minder.min.js.map
