{"version":3,"sources":["light.min.js"],"names":["window","document","$","require","define","defined","defineWaiting","callDeps","key","toLowerCase","df","args","i","deps","length","depName","ret","callback","apply","Array","Error","module","Logger","include","baseCls","cls","__overwrite","indexOf","debug","proxy","thisobj","fn","arguments","Base","___eventBus","___eventsInfo","params","__base","eventBus","eventsInfo","this","prototype","slice","arg","event","type","on","__include","__proxyAll","__on","push","__triggerEvent","trigger","__getEventBus","__destroy","off","Object","create","color","kity","Color","createRGBA","createRGB","parse","EventKey","Blur","DomEvent","SurfaceAngleVisible","NormalAngleVisible","NameVisible","ZIndexChange","LightLineVisible","MoveBtn","BtnMove","lang","rf_incidence_line_name","rf_incidence_angle","rf_incidence_point","rf_normal_name","rf_reflection_line_name","rf_reflection_angle","rf_reflection_surface","rf_equal_angle_name","fontClass","black","green","blue","red","orange","purple","style","LineStyle","strokeStyle","stroke-width","stroke","rectHeight","btnRotate","width","height","arrow","commonLineFill","commonArrowCls","IncidenceLine","fill","arrowClass","ReflectionLine","RefractionLine","Sector","surfaceFill","incidence_normalFill","normalFill","incidence_normalFontClass","normalFontClass","surfaceFontClass","NormalLine","pointWidth","pointFill","InverseRefractionLine","name","incidencePointName","IncidencePoint","Surface","surfaceClass","Pedal","EqualAngleName","gloInitJqEvent","supportTouch","isMobile","navigator","userAgent","match","vEventHandler","mouseDown","mouseUp","mouseWheel","getEventX","originalEvent","changedTouches","clientX","getEventY","clientY","special","lrTap","setup","$that","vMouseDown","vMouseUp","_start","_startX","_startY","bind","which","Date","getTime","end","endX","endY","holdTime","dx","Math","abs","dy","fix","tapEventSource","tapFireTouch","triggerHandler","sourceCapabilities","firesTouchEvents","teardown","unbind","Utils","BaseReflector","_lightComplexArray","_uuid","eventbus","getUuid","createView","drawAll","drawNext","hasNext","getData","getType","_TYPE","getNameVisible","_option","nameVisible","pushEvent","eventInfo","_event","EventUtils","_$$paper","_$$paperItems","_eventInfo","paper","option","instance","bindDomEvent","_domEvents","node","_getEventInfo","e","$target","srcElement","hasClass","closest","uuid","data","eventType","triggerBlur","parent","_initEventInfo","_clearEventInfo","_events","that","mType","forEach","info","moveAbs","mMoveAbs","currentPos","mCurrentPos","lastPos","mLastPos","_downTrigger","_touchTrigger","_moveTrigger","_startTime","_startPos","_moveLastPos","__domEvents","lock","getPagePos","svgBound","getBoundingClientRect","startX","left","right","startY","top","bottom","preventDefault","p","x","y","mxj","parseFloat","mMoveTrigger","mTouchTrigger","fixed","fixPcClick","isMove","isDown","addDomEvent","dom","domEvent","identifier","stopPropagation","attr","String","View","ForeignView","Svg","Btn","_fwRotate","_id","_lineUuid","_refractorMain","refractorMain","addRotateBtn","_fwTranslate","setVisibility","g","Group","_paper","addShape","append","getView","addClass","removeClass","blur","_tranlineUuid","moveBtnEventHandler","scale","clientRect","tranClientRect","tranUuid","visible","pLeft","pTop","rect","rLeft","rTop","transforms","getAttrTranslate","setTranslate","tpLeft","tpTop","trLeft","trTop","undefined","LightComplex","LightComplexArray","_lightArray","_lightEnable","_lightDrawBefore","_chainMode","_currentHighZIndex","config","onLineMove","onLightTrans","onLightFocusBlur","chainMode","_config","initZIndexEvent","lightComplex","Visible","appendToView","$$container","each","prependToView","prependItem","gtIndexAppendToView","callBack","index","call","indexValidate","getCommandLength","pushDrawCommand","command","hasDrawCommand","setPedalDrawIndex","pedalIndex","setDrawIndex","drawIndex","resetAngle","surfaceAngle","init","changeChainLineCommonFill","setRefractionLineCommonFill","isEnableAndDraw","setIncidenceLineCommonFill","hasNextEnable","hasCall","isVisibilityHidden","hasDrawNext","setAllEnable","enable","setEnable","setSectorEnable","rotateAble","angle","surfaceMove","flag","rotateFixed","complexRotateAble","around","surfaceRotatePosX","adsorptionPedal","isPedalExcludeDisable","isPedal","setViewTapListener","j","changeTransparent","getCurrentHighZIndex","showFirstIndex","setIncidenceNameEnable","nameEnable","setIncidenceNameVisible","get","getDrawBegin","setNameVisible","setLinePedalChangeLock","getCount","drawAllNext","cb","drawAllAll","getFirRefAngle","getRefAngle","getFirIncidenceAngle","getIncidenceLineXAngle","getHasdrawMaterialObjectImagingGroup4","getHasdrawMaterialObjectImagingGroup5","GraphMath","Refractor","_CONFIG","defaultAngle","clickAble","rotateFixedAfterDraw","PedalWidth","lineVisible","pointNameVisible","sectorInVisible","sectorOutVisible","incidenceVisible","refractionVisible","IncidencePosX","IncidencePosY","DrawIndex","PedalDrawIndex","NoRefracDrawIndex","Lines","aPoint","bPoint","degree","range","refractivity1","refractivity2","transAble","pedalLineAngle","_curLineIndex","rotatePosX","rotatePosY","Type","tl","ForeignSurf","translateX","translateY","_Event","_$$container","_incidencePointPos","_surfacePagePos","_equalAngleNameHasShowBefore","resetState","extend","initEvent","configData","afterCreateView","initExtrasDrawCommand","_surface","onSurfaceMove","langData","onLineTrans","_equalAngleName","bgLeft","bgTop","airTextCon","refraction_air","textCon","refraction_water","airG","airText","Text","setContent","setAttr","airTextWidth","_foreignSurf","foreignline1","Path","setStyle","lineG","foreignBg","prepend","text","textWidth","initEqualAngleNamePos","parentTranslate","getTransform","m","getWidth","getHeight","viewPortWidth","viewPortHeight","f","toCenter","rotate","getRotateAngle","getMoveRotateAngle","getRotateOffsetPos","initEqualAngleVisibility","curLineIndex","afterLineMove","lightComplex0","incidTran","_$$incidencePoint","refractAPos1","lines","lineIn","incidenceAngle1","getIncidenceRotateAngle","incidenceLine0","result0","pointInLine","initIncidW","_configData","incidW0","getTwoPointDistance","acrossPoint","setIncidenceLineWidth","refractAngle1","getRefractionRotateAngle","refractLine1","result","initRefracLineW","incidentPoint2","refracWidth","setRefractionLineWidth","getTwoLineVisible","setResetState","state","Extend","Refractor1","reflectionVisible","refraction_glass","lightComplex1","_acrossPoint","lineIn2","setCurLineIndex","setIncidenceLineVisible","setGroupTranslate","incidenceAngle2","setIncidenceXAxisAngle","_curRefAngle","Refractor2","refraction_prism","arrowPos","MaterialObjectVisibility","waterBgGroup","setId","txtWater","appendItem","waterBg","setX","setY","airGroup4","txtAir","addItem","eyeGroup","eyeForeign","materialObjectGroup4","realFishGroup","realFishForeign","realGoldCoinGroup","display","realGoldCoinForeign","realChopsticksGroup","setRotate","realChopsticksForeign","arrowButtonGroup4","arrowButtonForeign","materialObjectImagingGroup4","MaterialObjectImagingGroup","imagingFishGroup","imagingFishForeign","imagingGoldCoinGroup","imagingGoldCoinForeign","imagingChopsticksGroup","imagingChopsticksForeign","css","overflow","setForeignWidth","$view","parents","find","first","click","hide","setNamePos","setNamePosByType","Incidence","Refraction","setMaterialObjectVisibility","Refractor6","waterGroup","airGroup","materialObjectGroup5","realTreeGroup","realTreeForeign","realLightHouseGroup","realLightHouseForeign","realHumanGroup","realHumanForeign","arrowButtonGroup5","materialObjectImagingGroup5","imagingTreeGroup","imagingTreeForeign","imagingLightHouseGroup","imagingLightHouseForeign","imagingHumanGroup","imagingHumanForeign","Refractor3","Refractor4","Refractor5","RefractorFactory","getRefractor","EventBus","Lang","VERSION","_templateHtml","ViewPort","OPTION","refractorType","surfaceAngleVisible","normalAngleVisible","reflector5NameEnable","RefractorMain","_refractors","_currentIndex","_init","render","obj","getElementById","jQuery","$mainHtml","template","id","html","Paper","setViewBox","createRefractor","_btn","_createRefractor","$$item","refractor","afterInit","__create","_data","currentIndex","refractor4","refractor5","refractorData","setNormalAngleVisible","setSurfaceAngleVisible","setData","version","domain","show","getCurrentIndex","getSurfaceAngleVisible","getNormalAngleVisible","getCurrentRefractor","reset","clear","getCurRefResetState","setCurRefResetState","destroy","LightComplexDraw","_hasDrawBegin","_hasDrawNext","setDrawBegin","hasDrawBegin","setSectorInsideDrawStatus","_drawCommand","stop","hasNextWidthOutVisibilityStatus","initDrawCommand","_hsdrawIncidencePoint","_hsdrawSectorRefraction","_hsDrawRefractionLine","_hsdrawInverseRefractionLine","_hsdrawMaterialObjectImagingGroup4","_hsdrawMaterialObjectImagingGroup5","deffer","animate","fadeIn","fadeOut","resolve","_normalLine","setPointNameVisibility","getPointNameVisible","setSectorVisibilityByType","SurfaceIn","_surfaceInSector","_incidenceLine","round","getSectorAngle","_incidenceSector","setLineVisibility","getLineVisible","_pedalLine","_refractionSector","_refractionLine","SurfaceOut","_surfaceOutSector","_draw11","sectorAnimateDisappear","_inverseRefractionLine","initDrawStatus","hasDrawFuns","pedalDrawIndex","setIncidenceShortPedalView","setWidth","setArrowPos","PedalArrowPos","resetLinePos","isDrawIncidenceShortPedalView","getHasDrawIncidencePoint","getHasDrawSectorAnimateDisappear","getHasDrawSectorRefraction","getHasDrawRefractionLine","getHasdrawInverseRefractionLine","draw","Draw","incidencePoint","sectorRefraction","refractionLine","inverserefractionline","LightComplexEvent","surfaceAngleVisibleHandler","setSectorVisibilityByOutSideLogic","normalAngleVisibleHandler","getNameGroup","nameVisibleHandler","Style","BaseView","LightLine","PedalLine","DrawCommand","IncidencePointStyle","Config","onLightMove","highLineZIndex","arrowVisible","incidenceR","refractionR","surfaceR","IncidencePointVisible","PedalLineVisible","view90PedalLineVisible","nameEventEnable","_onLightMove","_onLightTrans","_onLightFocusBlur","_linePedalChangeLock","_surfaceLines","_surfacelinesKb","_sectorState","incidenceSector","refractionSector","initVisibleState","initDomEvent","appendPosX","createSector","appendSector","refractionTranslateX","normalTranslateX","inverseRefractionTranslateX","Circle","getLineKb","initSectorVisibleState","gtIndexSectorAppendToView","_surfaceAngle","incidenceAngleBac","incidenceAngle","refractivity","negative","incidenceAngleAbs","startAngle","angle90","angle180","angle270","angle540","curRefAngle","getRefractAngle","normalAngle","refractRotate","resetSectorAngle","syncSectorVisibilityByName","setRefractionPartVisibility","resetPedalRotateAngle","originalPosSvg","point","leftDis","rightDis","_pedalLineAngle","originalPos","offset","lightType","lineRotateAble","countLineXY","xDis","yDis","k","getScale","isInSegment","xRel","yRel","lineXY","lineNext","inWhichLine","leftDisNew","rightDisNew","setIncidence0180View","setSectorVisibility","setIncidencePos","getIncidencePosX","surfaceInSectorAngle","MinAngle","surfaceRotateX","marginX","r","pos","getSpherePos","getSectorOutSideVisibilityByType","hasDraw","getSectorHasDraw","normalLineAngle","domEventHandler","_onViewClickListener","setRefractionLineVisible","proxyApi","sector","namePos","NamePos","_lastMinLine","initLineNamePos","line","lineAngle","Number","makeNameViewAround","toFixed","get0T360Angle","getSphereAngle","lineRotateAngle","sphereAngle","LightComplexProxyApi","setIncidenceLineArrowPos","setRefractionLineArrowPos","common","setCommonFill","restoreFill","getIncidenceLineVisible","getReflectionLineVisible","_reflectionLine","getIncidenceSurfaceAngle","setNameEnable","getNormalLineRotateAngle","getRefractionLineXAngle","getNormalLineXAngle","getSectorInLineXAngle","lineRotate","normalRotate","getSectorOutLineXAngle","getIncidenceLineSphereAngle","getRefractionLineSphereAngle","getNormalLineSphereAngle","getLineXAngle","lineType","getLine0To360RotateAngle","getLineQuad","incidenceRotate","refractionRotate","setLineEnable","transx","transy","_nameGroup","getNameByType","NameGroup","LightComplexSector","_sector","_sectorEnable","_currentVisibleStatus","_sectorHasDraw","sectorNameData","cx","cy","sectorEach","setAngleVisibleByType","setHasDrawStatusByType","setNormalAngle","setHasDrawStatus","getHasDrawStatus","status","getAngleIsValidByType","getHasDrawStatusByType","Reflection","getAngleVisibilityByType","getAngle","getSectorRoundAngle","getRoundAngle","getSectorLinesPos","sectorType","centerPos","startXAngle","endXAngle","startLineType","endLineType","_getPos","xAngle","quad","sectorR","sin","getRadian","cos","posB","a","b","setSectorOpacity","opacity","setOpacity","Command","_queue","_hasDrawQueue","_drawIndex","_maxLength","_stopCallback","_stopFlag","_drawing","makeAsPromise","setCurrentIndex","force","tasks","getTask","doneCallBack","when","done","actualIndex","task","hasNotDrawNext","stopCallBack","Deferred","unshift","promise","_eventHandler","shift","handlers","handler","toString","len","splice","isUp","test","isTouch","ev","pageX","pageY","startPos","endPos","startTime","endTime","_holdTime","getTwoLineIntersection","c","d","denominator","PI","getDegree","radian","kb","tan","getArc","getDifferent","originPos","startVector","endVector","getCosineAngle","cosA","pow","acosA","acos","getCosineAngleByPos","aPos","bPos","cPos","sqrt","getPythagoreanLineC","getLinePosByAngle","getSvgSectorPoint","endAngle","rad","x1","y1","x2","y2","ar","join","pos1","pos2","getShortestDistanceAndPoint","posa","posb","posc","ab","ac","bc","halfPerimeter","S","thirdLong","max","hc","shortestDistance","shortestPos","min","getRectVerticalPos","h","minSide","getRectShortestDistance","s","z","target","vertical","direction","getLightPos","ca","n","la","different","getPedalHeight","pos3","A","B","getLineCircleIntersectionPos","ptStart","ptEnd","ptCenter","Radius","EPS","ptInter1","ptInter2","fDis","E","a2","e2","Radius2","t","incidentAngle","incidentAng","incidentAngelRel","asin","linesArr","inline","linesArrKb","lineArr","anotherPoint","lineKb","lineArrKb","getApointBytwoLine","acrossPoint2","line1","line2","insPoint","methods","_console","console","method","emptyFuc","_logger","_level","setLevel","level","log","msg","warn","error","_templateRegExp","tpl","attrs","replace","$0","$1","$2","getTemplateValue","tempRegExp","templateRegex","regExp","exec","keys","values","parseInt","regexStr","RegExp","transformRegex","translate","svg","getRotateMatrix","createElementNS","setAttribute","matrix","getCTM","getRotateKityMatrix","svgMatrix","Matrix","getAttrRotate","transform","item","createJqForeignObject","foreignObject","$div","getFixedFloat","floatNum","digitalCount","num","numAry","split","substring","getValue","str","regex","arr","hexDigits","substr","floor","random","ViewUtils","$$view","visibility","hidden","makeAbsViewHorizontal","centerX","centerY","marginY","nagitive","box","getRenderBox","makeViewAround","$$referenceView","distance","getAttr","pointBox","shortDistance","asbPos","subx","suby","isNaN","ArrowStyle","activeFill","bgCls","0","1","2","Arrow","_$$path","_$$activePath","_type","_width","_contraryDirection","contraryDirection","_$$clickArea","Rect","setSize","active","isActive","changeType","restoreType","Blue","Red","Purple","_$$view","eventInfos","$$shape","setTranslateX","setVisible","isVisible","getVisible","EqualAngleNameStyle","_lang","_$$name","_$view","_$insideView","_height","_cls","setHeight","setDomEvent","setForeignHeight","setInsideWidth","setInsideHeight","appendHtml","applyTransform","degre","val","_$$line","InverseRefractionLineStyle","_domEvent","_pointVisible","_lineVisible","_$$nameDown","initNamePos","downWidth","nameWidth","showAll","strokeWidth","CONFIG","_$$lineGroup","_lineGroupUuid","_$$lintWhite","_arrow","_fwBtn","_fwTranBtn","_lightType","_$$offsetPoint","initArrowPos","_$$lintClick","clickWidth","_$$whiteRect","_fwBtnInvisible","_fwTranBtnInvisible","initView","_tranBtnTranslate","getArrowPos","setFwBtnVisible","setClickAble","clickable","btnStillInBox","fwBtnMove","getRotatePos","getNameEnable","setOpacityIgnoreName","aroundLineAngle","getLightType","rotateTranslate","tranBtnTranslate","originalRect","svgRect","originalRectTran","fwBtnTranslate","subY","setNameDisplay","MultipleText","_lineHeight","_$$texts","lineHeight","appendLine","center","maxWidth","lastIsAngle","$$text","content","getContent","remove","SectorStyle","anglePaddingLeft","_nameVisible","_lightHeight","_status","mtAngle","mtName","mtInvisibleAngle","angleStr","actualAngle","_normalAngle","nagative","__getIndex","sub","_rotate","updatePosByType","isNameVertical","setNameStatusAndVisible","isSurfaceAngle","NormalLineStyle","PedalStyle","$$line","plusDrawer","getDrawer","moveTo","lineTo","_$$sector","_$$sectorBorder","_startAngle","_endAngle","_cx","_cy","_r","absEndAngle","absStartAngle","SurfaceStyle","_$$surface","_onSurfaceMove","tr","tl_Large","_fwSurface","intOriginalFwBtnPos","getSurfaceXAxisDegree","surface","isRight","get0To360RotateAngle","LightRefractor","setLogLevel","setLang","i18n","getLang"],"mappings":"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","file":"light.min.js","sourcesContent":["//version=1.0\r\n(function(window,document,$){\r\n/**\r\n * 简易模块化加载器\r\n * Created by ylf on 2016/7/5.\r\n */\r\n\r\n\r\nvar require, define;\r\n(function () {\r\n    var defined = {}, defineWaiting = {};\r\n\r\n    var callDeps = function (key) {\r\n        if (key) {\r\n            key = key.toLowerCase();\r\n        }\r\n        if (defineWaiting[key]) {\r\n            var df = defineWaiting[key];\r\n            delete defineWaiting[key];\r\n            var args = [];\r\n            for (var i = 0; i < df.deps.length; i++) {\r\n                var depName = df.deps[i];\r\n                args[i] = callDeps(depName);\r\n            }\r\n            var ret = df.callback.apply(df.callback, args);\r\n            defined[key] = ret;\r\n        }\r\n\r\n        return defined[key];\r\n    };\r\n\r\n    define = function (key, deps, callback) {\r\n        if (key) {\r\n            key = key.toLowerCase();\r\n        }\r\n        if (!(deps instanceof Array)) {\r\n            callback = deps;\r\n            deps = [];\r\n        }\r\n        if (defineWaiting[key]) {\r\n            throw  new Error('the key already has been  used');\r\n        }\r\n        defineWaiting[key] = {\r\n            'deps': deps,\r\n            'callback': callback,\r\n            'module': null\r\n        };\r\n    };\r\n\r\n    require = function (key) {\r\n        return callDeps(key);\r\n    };\r\n\r\n})();\r\n\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/base/base', [], function () {\r\n    var Logger = require('js/utils/logger');\r\n\r\n    var include = function (baseCls, cls) {\r\n        for (var key in cls) {\r\n            if (typeof baseCls[key] !== \"undefined\" && key !== '__base') {\r\n                if (!baseCls.__overwrite || baseCls.__overwrite.indexOf(key) < 0) {\r\n                    //Logger.error('有重复的成员', key);\r\n                    Logger.debug('有重复的成员', key);\r\n                }\r\n            }\r\n            baseCls[key] = cls[key];\r\n        }\r\n        return baseCls;\r\n    };\r\n\r\n    var proxy = function (thisobj, fn) {\r\n        return function () {\r\n            return fn.apply(thisobj, arguments);\r\n        };\r\n    };\r\n\r\n    /**\r\n     * {\r\n                key: '',//key\r\n                fucs: '',//方法名\r\n                params: []//参数说明\r\n            }\r\n     */\r\n\r\n    var Base = {\r\n        ___eventBus: null,\r\n        ___eventsInfo: [{\r\n            key: '',//key\r\n            callback: '',//方法名\r\n            params: []//参数说明\r\n        }],\r\n        __base: function (eventBus, eventsInfo) {\r\n            this.___eventsInfo = null;\r\n            this.___eventBus = null;\r\n\r\n            var args = Array.prototype.slice.apply(arguments, [0]);\r\n            if (args.length > 2) {\r\n                throw  new Error('参数长度有误');\r\n            }\r\n            for (var i = 0; i < args.length; i++) {\r\n                var arg = args[i];\r\n                if (arg instanceof Array) {\r\n                    this.___eventsInfo = arg;\r\n                } else if (typeof  arg === 'object') {\r\n                    this.___eventBus = eventBus;\r\n                }\r\n            }\r\n\r\n            this.___eventBus = this.___eventBus || {};\r\n            this.___eventsInfo = this.___eventsInfo || [];\r\n\r\n            //__addEvent;\r\n            for (var i = 0; i < this.___eventsInfo.length; i++) {\r\n                var event = this.___eventsInfo[i];\r\n                var type = event.key;\r\n                if (typeof event.callback === 'string') {\r\n                    this.___eventBus.on(type, this[event.callback], this);\r\n                } else {\r\n                    this.___eventBus.on(type, event.callback, this);\r\n                }\r\n            }\r\n        },\r\n        __include: function (cls) {\r\n            return include(this, cls);\r\n        },\r\n        __proxyAll: function (callback) {\r\n            for (var i = 0; i < callback.length; i++) {\r\n                if (typeof callback[i] === 'string') {\r\n                    this[callback[i]] = proxy(this, this[callback[i]]);\r\n                }\r\n            }\r\n        },\r\n        __on: function (key, callback, params) {\r\n            this.___eventsInfo.push({\r\n                key: key,//key\r\n                callback: callback,//方法名\r\n                params: params//参数说明\r\n            });\r\n\r\n            if (typeof callback === 'string') {\r\n                this.___eventBus.on(key, this[callback], this);\r\n            } else {\r\n                this.___eventBus.on(key, callback, this);\r\n            }\r\n        },\r\n        __triggerEvent: function (type) {\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            this.___eventBus.trigger.apply(this.___eventBus, arg);\r\n        },\r\n        __getEventBus: function () {\r\n            return this.___eventBus;\r\n        },\r\n        __destroy: function () {\r\n            var eventsInfo = this.___eventsInfo;\r\n            for (var i = 0; i < eventsInfo.length; i++) {\r\n                var event = eventsInfo[i];\r\n                var type = event.key;\r\n                if (typeof event.callback === 'string') {\r\n                    this.___eventBus.off(type, this[event.callback], this);\r\n                } else {\r\n                    this.___eventBus.off(type, event.callback, this);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    return function (cls) {\r\n        return Object.create(Base).__include(cls);\r\n    };\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 全局颜色配置\r\n */\r\ndefine('js/config/color', [], function () {\r\n\r\n\r\n    var color = {};\r\n    color['transparent'] = kity.Color.createRGBA(0, 0, 0, 0);\r\n    color['node_stroke_normal'] = kity.Color.createRGB(115, 161, 191);\r\n    color['node_stroke_active'] = kity.Color.createRGB(57, 80, 96);\r\n    color['backgroud_color'] = kity.Color.parse('#C0D3E2');\r\n    color['line_color'] = kity.Color.parse('#666564');\r\n\r\n    return color;\r\n})\n/**\r\n * Created by ylf on 2016/7/26.\r\n * 事件key\r\n */\r\ndefine('js/config/eventKey', [], function () {\r\n\r\n\r\n    var EventKey = {\r\n        Blur: 'Blur',\r\n        DomEvent: 'DomEvent',\r\n        SurfaceAngleVisible: 'SurfaceAngleVisible',\r\n        NormalAngleVisible: 'NormalAngleVisible',\r\n        NameVisible: 'NameVisible',\r\n        ZIndexChange: 'ZIndexChange',\r\n        LightLineVisible: 'LightLineVisible',\r\n        MoveBtn: 'MoveBtn',\r\n        BtnMove: 'BtnMove'\r\n    };\r\n\r\n    return EventKey;\r\n})\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 全局颜色配置\r\n */\r\ndefine('js/config/lang', [], function () {\r\n\r\n    var lang = {\r\n        'rf_incidence_line_name': '入射光线',\r\n        'rf_incidence_angle': '入射角',\r\n        'rf_incidence_point': '入射点O',\r\n        'rf_normal_name': '法线N',\r\n        'rf_reflection_line_name': '反射光线',\r\n        'rf_reflection_angle': '反射角',\r\n        'rf_reflection_surface': '反射面',\r\n        'rf_equal_angle_name': '反射角=入射角=0°'\r\n    };\r\n\r\n\r\n    return lang;\r\n})\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 全局颜色配置\r\n */\r\ndefine('js/config/style', ['js/config/color'], function () {\r\n\r\n    var fontClass = {\r\n        black: 'svg_text color_black',\r\n        green: 'svg_text color_green',\r\n        blue: 'svg_text color_blue',\r\n        red: 'svg_text color_red',\r\n        orange: 'svg_text color_orange',\r\n        purple: 'svg_text color_purple'\r\n    };\r\n\r\n    var style = {};\r\n\r\n\r\n    style.LineStyle = {\r\n        strokeStyle: {'stroke-width': 2.5, 'stroke': kity.Color.parse('#ffffff')},\r\n        rectHeight: 8,\r\n        btnRotate: {width: 64, height: 64},\r\n        arrow: {width: 34, height: 45},\r\n        on: 'on',\r\n        commonLineFill: kity.Color.parse('#794F78'),\r\n        commonArrowCls: 'arrow_purple',\r\n        IncidenceLine: {\r\n            fill: kity.Color.parse('#005798'),\r\n            fontClass: fontClass.blue,\r\n            arrowClass: 'arrow_blue'\r\n        },\r\n        ReflectionLine: {\r\n            fill: kity.Color.parse('#CB1F1F'),\r\n            fontClass: fontClass.red,\r\n            arrowClass: 'arrow_red'\r\n        },\r\n        RefractionLine: {\r\n            fill: kity.Color.parse('#CB1F1F'),\r\n            fontClass: fontClass.red,\r\n \r\n            arrowClass: 'arrow_red'\r\n        }\r\n    };\r\n\r\n    style.Sector = {\r\n        strokeStyle: {'stroke-width': 1, 'stroke': kity.Color.parse('#7595AC')},\r\n        //surfaceFill: kity.Color.parse('#C2B69C'),\r\n        //normalFill: kity.Color.parse('#8DB8A7'),\r\n        surfaceFill: kity.Color.createRGBA(213, 139, 34, 0.35),\r\n        incidence_normalFill: kity.Color.createRGBA(204, 131, 255, 0.35),\r\n        normalFill: kity.Color.createRGBA(60, 143, 65, 0.35),\r\n        incidence_normalFontClass: fontClass.purple,\r\n        normalFontClass: fontClass.green,\r\n        surfaceFontClass: fontClass.orange\r\n    };\r\n\r\n    style.NormalLine = {\r\n        strokeStyle: {'stroke-width': 4, 'stroke': kity.Color.parse('#4D4D4D')},\r\n        fontClass: fontClass.black,\r\n        pointWidth: 5,\r\n        pointFill: kity.Color.parse('#CB1F1F')\r\n    };\r\n\r\n    style.InverseRefractionLine = {\r\n        strokeStyle: {'stroke-width': 4, 'stroke': kity.Color.parse('#FF0000')},\r\n        fontClass: fontClass.black,\r\n        pointWidth: 5,\r\n        name: '',\r\n        incidencePointName: '',\r\n        pointFill: kity.Color.parse('#CB1F1F')\r\n    };\r\n\r\n    style.IncidencePoint = {\r\n        width: 9,\r\n        fill: kity.Color.parse('#FFE012')\r\n    };\r\n\r\n    style.Surface = {\r\n        height: 19,\r\n        surfaceClass: 'wall_tl',\r\n        fontClass: fontClass.black,\r\n        btnRotate: {width: 64, height: 64}\r\n    };\r\n\r\n    style.Pedal = {\r\n        strokeStyle: {'stroke-width': 5, 'stroke': kity.Color.parse('#04740b')},\r\n        width: 35\r\n    };\r\n\r\n    style.EqualAngleName = {\r\n        fontClass: fontClass.green\r\n    };\r\n\r\n    return style;\r\n})\n/**\r\n * 点击事件 create by ylf 2016/7/5\r\n */\r\nvar gloInitJqEvent = function () {\r\n    var supportTouch = 'ontouchend' in document;\r\n    var isMobile = navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false;\r\n    var vEventHandler = {};\r\n    if (supportTouch && isMobile) {\r\n        //拥有触屏事件\r\n        vEventHandler.mouseDown = 'touchstart';\r\n        vEventHandler.mouseUp = 'touchend';\r\n        vEventHandler.mouseWheel = 'touchmove';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientY;\r\n        };\r\n    } else {\r\n        //没有触屏幕事件\r\n        vEventHandler.mouseDown = 'mousedown';\r\n        vEventHandler.mouseUp = 'mouseup';\r\n        vEventHandler.mouseWheel = 'mousewheel';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.clientY;\r\n        };\r\n    }\r\n\r\n    //点击事件\r\n    $.event.special.lrTap = {\r\n        setup: function () {\r\n            var $that = $(this);\r\n            if (supportTouch && isMobile) {\r\n                var vMouseDown = vEventHandler.mouseDown;\r\n                var vMouseUp = vEventHandler.mouseUp;\r\n                var _start = 0;\r\n                var _startX = 0;\r\n                var _startY = 0;\r\n                $that.bind(vMouseDown, function (event) {\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        _start = new Date().getTime();\r\n                        _startX = vEventHandler.getEventX(event);\r\n                        _startY = vEventHandler.getEventY(event);\r\n                    }\r\n                });\r\n                $that.bind(vMouseUp, function (event) {\r\n\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        var end = new Date().getTime();\r\n                        var endX = vEventHandler.getEventX(event);\r\n                        var endY = vEventHandler.getEventY(event);\r\n                        var holdTime = end - _start;\r\n                        var dx = Math.abs(endX - _startX);\r\n                        var dy = Math.abs(endY - _startY);\r\n                        if (holdTime <= 550 && dx < 8 && dy < 8) {\r\n                            //触发tap事件\r\n                            event = $.event.fix(event);\r\n                            event.type = 'lrTap';\r\n                            event.tapEventSource = 'touchclick';\r\n                            event.tapFireTouch = true;\r\n                            $that.triggerHandler(event);\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                $that.bind('click', function (event) {\r\n                    //触发tap事件\r\n                    event = $.event.fix(event);\r\n                    event.type = 'lrTap';\r\n                    event.tapEventSource = 'mouseclick';\r\n                    event.tapFireTouch = false;\r\n                    //白板手写笔点击触发touch事件\r\n                    if (event.originalEvent && event.originalEvent.sourceCapabilities && event.originalEvent.sourceCapabilities.firesTouchEvents) {\r\n                        event.tapFireTouch = true;\r\n                    }\r\n                    $that.triggerHandler(event);\r\n                });\r\n            }\r\n        },\r\n        teardown: function () {\r\n            var vMouseDown = vEventHandler.mouseDown;\r\n            var vMouseUp = vEventHandler.mouseUp;\r\n            var $that = $(this);\r\n            $that.unbind(vMouseUp).unbind(vMouseDown);\r\n        }\r\n    };\r\n\r\n};\r\n\r\ngloInitJqEvent();\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/reflector/baseReflector', ['js/base/base','js/utils/utils'], function (Base,Utils) {\r\n\r\n    var BaseReflector = {\r\n        _lightComplexArray: null,//光组件合集\r\n        _uuid:null,\r\n        __overwrite: ['createView', 'drawAll', 'drawNext', 'getData'],\r\n        __base: function (eventbus, eventsInfo) {\r\n            var args = Array.prototype.slice.apply(arguments, [0]);\r\n            Base({}).__base.apply(this, args);\r\n            this._uuid=Utils.getUuid();\r\n        },\r\n        createView: function () {\r\n\r\n        },\r\n        drawAll: function () {\r\n            this._lightComplexArray.drawAll();\r\n        },\r\n        drawNext: function () {\r\n            this._lightComplexArray.drawNext();\r\n        },\r\n        hasNext: function () {\r\n            return this._lightComplexArray.hasNext();\r\n        },\r\n        getData: function () {\r\n\r\n        },\r\n        getType: function () {\r\n            return this._TYPE;\r\n        },\r\n        getNameVisible: function () {\r\n            return this._option.nameVisible;\r\n        },\r\n        pushEvent: function (eventInfo) {\r\n            this._event.push(eventInfo);\r\n            this.__proxyAll([eventInfo.callback]);\r\n        },\r\n        getUuid:function(){\r\n            return this._uuid;\r\n        }\r\n\r\n    };\r\n\r\n\r\n    return function (cls) {\r\n        return Base(BaseReflector).__include(cls);\r\n    };\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/reflector/domEvent', ['js/base/Base', 'js/config/EventKey', 'js/utils/eventUtils'], function (Base, EventKey, EventUtils) {\r\n\r\n    var Logger = require('js/utils/logger');\r\n\r\n    var DomEvent = Base({\r\n        _$$paper: null,\r\n        _$$paperItems: [],\r\n        _option: null,\r\n        _eventInfo: [],\r\n        create: function (paper, eventBus, option) {\r\n            var instance = Object.create(this);\r\n            instance.__base(eventBus, []);\r\n            instance._option = option;\r\n            instance._$$paper = paper;\r\n            return instance;\r\n        },\r\n        bindDomEvent: function () {\r\n            this._domEvents();\r\n            //var refractionOffset = $(this._$$paper.node).closest('div').offset();\r\n            $(this._$$paper.node).on(' lrTap  mousedown  mouseup mousemove mouseleave touchstart touchmove touchend touchcancel', this._domEvents);\r\n\r\n            // this.startX = refractionOffset.left;\r\n            // this.startY = refractionOffset.top;\r\n            // this.endX = this.startX + $(this._$$paper.node).closest('div').width();\r\n            // this.endY = this.startY + $(this._$$paper.node).closest('div').height();\r\n           // console.log('startX='+this.startX+', endX='+this.endX+', startY='+this.startY+', endY='+this.endY);\r\n\r\n            //$(this._$$paper.node).closest('.refraction_main').on(' lrTap  mousedown  mouseup mousemove mouseleave touchstart touchmove touchend touchcancel', this._domEvents);\r\n        },\r\n        _getEventInfo: function (e) {\r\n            var eventInfo = [];\r\n            e = e.originalEvent || e;\r\n            var $target = $(e.srcElement);\r\n            if (!$target.hasClass('_lr_event')) {\r\n                $target = $target.closest('._lr_event');\r\n            }\r\n            while ($target.length > 0) {\r\n                eventInfo.push({\r\n                    uuid: $target.data('event-identifier'),\r\n                    eventType: $target.data('event-type'),\r\n                    triggerBlur: $target.data('event-triggerblur')\r\n                });\r\n                if ($target.data('event-stoppropagation') === false || $target.data('event-stoppropagation') === 'false') {\r\n                    var parent = $target.parent();\r\n                    if (parent.hasClass('_lr_event')) {\r\n                        $target = parent;\r\n                    } else {\r\n                        $target = parent.closest('._lr_event');\r\n                    }\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n            return eventInfo;\r\n        },\r\n        _initEventInfo: function (e) {\r\n            this._eventInfo = this._getEventInfo(e);\r\n        },\r\n        _clearEventInfo: function (e) {\r\n            this._eventInfo = null;\r\n        },\r\n        _events: function (e) {\r\n            var that = this;\r\n            var type = e.mType;\r\n            if (type !== 'move') {\r\n             //   Logger.debug('domevent-self', type);\r\n            }\r\n\r\n            //交给各自职责的事件处理\r\n            switch (e.mType) {\r\n                case 'lrTap':\r\n                    this._initEventInfo(e);\r\n                    if (this._eventInfo == null || this._eventInfo.length <= 0) {\r\n                        this.__triggerEvent(EventKey.Blur);\r\n                    } else {\r\n                        //只触发第一个\r\n                        if (this._eventInfo[0].triggerBlur) {\r\n                            this.__triggerEvent(EventKey.Blur, this._eventInfo[0].uuid);\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'down':\r\n                    this._initEventInfo(e);\r\n                    break;\r\n                case 'beforemove':\r\n                    break;\r\n                case 'move':\r\n                    break;\r\n                case 'aftermove':\r\n                    break;\r\n                //case 'up':\r\n                //    this._clearEventInfo(e);\r\n                //    break;\r\n            }\r\n\r\n            if (this._eventInfo) {\r\n\r\n                this._eventInfo.forEach(function (info) {\r\n                    if (info.eventType.indexOf(type) > -1) {\r\n                        that.__triggerEvent(info.uuid, type, info.uuid, {\r\n                            moveAbs: e.mMoveAbs,\r\n                            currentPos: e.mCurrentPos,\r\n                            lastPos: e.mLastPos\r\n                        });\r\n                    }\r\n                })\r\n\r\n            }\r\n\r\n\r\n            //交给各自职责的事件处理\r\n            switch (e.mType) {\r\n                case 'up':\r\n                    this._clearEventInfo(e);\r\n                    break;\r\n            }\r\n        },\r\n        _domEvents: function () {\r\n            var that = this;\r\n            var _downTrigger = false;\r\n            var _touchTrigger = false;\r\n            var _moveTrigger = false;\r\n            var _startTime = 0;\r\n            var _startPos = {};\r\n            var _moveLastPos = {};\r\n\r\n            var __domEvents = function (e) {\r\n                if (that._option.lock) {\r\n                    return;\r\n                }\r\n                var type = e.type || '';\r\n                if (type !== 'mousemove' && type !== 'touchmove') {\r\n                //    Logger.debug('domevent-original', type);\r\n                }\r\n\r\n                switch (type) {\r\n                    case 'mousedown':\r\n                    case 'touchstart':\r\n                        _startTime = new Date().getTime();\r\n                        if (type === 'mousedown') {\r\n                            _startPos = EventUtils.getPagePos(e);\r\n                        }\r\n\r\n                        _downTrigger = true;\r\n                        _moveTrigger = false;\r\n                        if (type === 'touchstart') {\r\n                            _touchTrigger = true;\r\n                        }\r\n                        e.mType = 'down';\r\n                        var svgBound = $(that._$$paper.node)[0].getBoundingClientRect();\r\n                        that.startX = svgBound.left; \r\n                        that.endX = svgBound.right; \r\n                        that.startY = svgBound.top; \r\n                        that.endY = svgBound.bottom;\r\n                    \r\n                        break;\r\n                    case 'mousemove':\r\n                    case 'touchmove':\r\n                        if (!_downTrigger) {\r\n                            return;\r\n                        }\r\n                        //缩放时不处理move事件\r\n                        e.preventDefault();\r\n                        var p = EventUtils.getPagePos(e);\r\n\r\n                        e.mLastPos = _moveLastPos;\r\n                        e.mCurrentPos = p;\r\n                        var x = p.x - _moveLastPos.x;\r\n                        var y = p.y - _moveLastPos.y;\r\n                        e.mMoveAbs = {\r\n                            x: x,\r\n                            y: y\r\n                        };\r\n\r\n                        e.mxj = parseFloat(_moveLastPos.x * p.y) - parseFloat(p.x * _moveLastPos.y);//叉积\r\n                        if (x !== 0 || y !== 0) {\r\n                            if (!_moveTrigger) {\r\n                                e.mType = 'beforemove';\r\n                                that._events(e);\r\n                            }\r\n                            e.mType = 'move';\r\n                            _moveTrigger = true;\r\n                        }\r\n                        /**\r\n                         * 判断 当前点是否超过refraction_main区域\r\n                         */\r\n                        // if(type === 'touchmove'){\r\n                        //     console.log(\"p.x = \"+p.x + \"; p.y = \"+p.y);\r\n                        if(p.x <= that.startX || p.x >= that.endX || p.y <= that.startY || p.y >= that.endY){\r\n                            $(that._$$paper.node).closest('.refraction_main').trigger('mouseup');\r\n                            $(that._$$paper.node).closest('.refraction_main').trigger('touchend');\r\n                            return;\r\n                        }\r\n                        //  }\r\n                        break;\r\n                    case 'touchend':\r\n                    case 'touchcancel':\r\n                    case 'mouseup':\r\n                    case 'mouseleave':\r\n                        if (_moveTrigger) {\r\n                            e.mType = 'aftermove';\r\n                            that._events(e);\r\n                        }\r\n                        e.mMoveTrigger = _moveTrigger;\r\n                        _moveTrigger = false;\r\n                        _downTrigger = false;\r\n\r\n                        e.mType = 'up';\r\n                        break;\r\n                    case 'lrTap':\r\n                        e.mType = type;\r\n\r\n                        //是否有touch事件触发\r\n                        if (e.tapEventSource === 'touchclick' || (e.tapEventSource === 'mouseclick' && _touchTrigger)) {\r\n                            e.mTouchTrigger = true;\r\n                        } else {\r\n                            e.mTouchTrigger = false;\r\n                        }\r\n                        _touchTrigger = false;\r\n                        //修复点击事件，超过时间和坐标不触发点击事件\r\n                        if (e.tapEventSource === 'mouseclick') {\r\n                            var fixed = EventUtils.fixPcClick(_startPos, EventUtils.getPagePos(e), _startTime, new Date().getTime());\r\n                            if (!fixed) {\r\n                                return;\r\n                            }\r\n                        }\r\n                        break;\r\n                    default:\r\n                        e.mType = type;\r\n                        break;\r\n                }\r\n                that._events(e);\r\n\r\n                //保存最后一次移动的位置\r\n                if (EventUtils.isMove(type) || EventUtils.isDown(type)) {\r\n                    _moveLastPos = EventUtils.getPagePos(e);\r\n                }\r\n            };\r\n            that._domEvents = __domEvents;\r\n        }\r\n    });\r\n\r\n    /**\r\n     * 添加事件\r\n     * @param dom\r\n     * @param domEvent 要添加的事件名称组数\r\n     * @param identifier dom标识符\r\n     */\r\n    DomEvent.addDomEvent = function (dom, domEvent, identifier, stopPropagation, triggerBlur) {\r\n        if (domEvent && domEvent.length > 0) {\r\n            if (typeof stopPropagation === typeof undefined) {\r\n                stopPropagation = true;\r\n            }\r\n            if (typeof triggerBlur === typeof undefined) {\r\n                triggerBlur = true;\r\n            }\r\n            $(dom).attr('class', '_lr_event');\r\n            $(dom).data('event-type', domEvent);\r\n            $(dom).data('event-identifier', identifier);\r\n            $(dom).data('event-stoppropagation', stopPropagation);\r\n            $(dom).data('event-triggerblur', triggerBlur);\r\n        }\r\n    };\r\n\r\n    return DomEvent;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/refractor/btn', ['js/base/Base', 'js/utils/string', 'js/utils/utils', 'js/config/eventKey', 'js/utils/view'], function (Base, String, Utils, EventKey, View) {\r\n\r\n    var ForeignView = require('js/view/foreignview');\r\n    var Svg = require('js/utils/svg');\r\n    var DomEvent = require('js/reflector/domEvent');\r\n    var LineStyle = require('js/config/style').LineStyle;\r\n\r\n    var Btn = Base({\r\n        _fwRotate: null,\r\n        _id: '',\r\n        _lineUuid: '',\r\n        _refractorMain: null,\r\n        create: function (eventBus, refractorMain) {\r\n            var instance = Object.create(this);\r\n            var eventsInfo = [];\r\n            instance._id = Utils.getUuid();\r\n            instance._refractorMain = refractorMain;\r\n            eventsInfo.push({key: EventKey.MoveBtn, callback: 'moveBtnEventHandler', params: []});\r\n            instance.__base(eventBus, eventsInfo);\r\n            instance.addRotateBtn();\r\n            return instance;\r\n        },\r\n        addRotateBtn: function () {\r\n            //旋转按钮\r\n            var that = this;\r\n            this._fwRotate = ForeignView.create('btn_rotate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            this._fwTranslate = ForeignView.create('btn_translate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            this._fwRotate.setVisibility(false);\r\n            this._fwTranslate.setVisibility(false);\r\n            //this._fwRotate.setTranslate(-LineStyle.btnRotate.width - 10, (LineStyle.rectHeight - LineStyle.btnRotate.height) / 2);\r\n            var g = new kity.Group();\r\n            this._refractorMain._paper.addShape(g);\r\n            $(g.node).append(this._fwRotate.getView());\r\n            $(g.node).append(this._fwTranslate.getView());\r\n            DomEvent.addDomEvent(this._fwRotate.getView()[0], ['down', 'beforemove', 'move', 'aftermove', 'up'], this._fwRotate.getUuid(), false, false);\r\n            DomEvent.addDomEvent(this._fwTranslate.getView()[0], ['down', 'beforemove', 'move', 'aftermove', 'up'], this._fwTranslate.getUuid(), false, false);\r\n            this.__on(this._fwRotate.getUuid(), function (eventType, uuid, data) {\r\n                if (eventType === 'down') {\r\n                    this._fwRotate.addClass('on');\r\n                } else if (eventType === 'aftermove' || eventType === 'up') {\r\n                    this._fwRotate.removeClass('on');\r\n                    this._fwRotate.getView().blur();\r\n                }\r\n                that.__triggerEvent(EventKey.BtnMove + that._lineUuid, eventType, this._lineUuid, data);\r\n            }, '');\r\n            this.__on(this._fwTranslate.getUuid(), function (eventType, uuid, data) {\r\n                if (eventType === 'down') {\r\n                    this._fwTranslate.addClass('on');\r\n                } else if (eventType === 'aftermove' || eventType === 'up') {\r\n                    this._fwTranslate.removeClass('on');\r\n                }\r\n                that.__triggerEvent(EventKey.BtnMove + that._tranlineUuid, eventType, this._tranlineUuid, data);\r\n            }, '');\r\n        },\r\n        moveBtnEventHandler: function (scale, clientRect, tranClientRect, uuid, tranUuid, visible) {\r\n            this._lineUuid = uuid;\r\n            this._tranlineUuid = tranUuid;\r\n            var pLeft = clientRect.left + clientRect.width / 2;\r\n            var pTop = clientRect.top + clientRect.height / 2;\r\n            var rect = this._fwRotate.getView()[0].getBoundingClientRect();\r\n            var rLeft = rect.left + rect.width / 2;\r\n            var rTop = rect.top + rect.height / 2;\r\n\r\n            var transforms = Svg.getAttrTranslate(this._fwRotate.getView().attr('transform'));\r\n            //pos 针对于整个page的位置\r\n            if (transforms && transforms.length == 2) {\r\n                this._fwRotate.setTranslate(transforms[0] + (pLeft - rLeft) / scale, transforms[1] + (pTop - rTop) / scale);\r\n            } else {\r\n                this._fwRotate.setTranslate((pLeft - rLeft) / scale, (pTop - rTop) / scale);\r\n            }\r\n\r\n\r\n            var tpLeft = tranClientRect.left + tranClientRect.width / 2;\r\n            var tpTop = tranClientRect.top + tranClientRect.height / 2;\r\n            var rect = this._fwTranslate.getView()[0].getBoundingClientRect();\r\n            var trLeft = rect.left + rect.width / 2;\r\n            var trTop = rect.top + rect.height / 2;\r\n\r\n            var transforms = Svg.getAttrTranslate(this._fwTranslate.getView().attr('transform'));\r\n            //pos 针对于整个page的位置\r\n            if (transforms && transforms.length == 2) {\r\n                this._fwTranslate.setTranslate(transforms[0] + (tpLeft - trLeft) / scale, transforms[1] + (tpTop - trTop) / scale);\r\n            } else {\r\n                this._fwTranslate.setTranslate((tpLeft - trLeft) / scale, (tpTop - trTop) / scale);\r\n            }\r\n\r\n            if (visible != undefined) {\r\n                this._fwRotate.setVisibility(visible);\r\n                this._fwTranslate.setVisibility(visible);\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    return Btn;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/refractor/LightComplexArrayRef', ['js/base/base', 'js/utils/utils'], function (Base, Utils) {\r\n\r\n    //view\r\n    var LightComplex = require('js/refractor/LightComplexRef/main');\r\n    var LightLine = require('js/view/LightLine');\r\n\r\n    var LightComplexArray = Base({\r\n        _lightArray: [],\r\n        _lightEnable: [],\r\n        _lightDrawBefore: [],\r\n        _chainMode: false,//点之间是否是链式的调用\r\n        _currentHighZIndex: 0,//处在高位的索引值\r\n        create: function (eventBus, config, option, onLineMove, onLightTrans,onLightFocusBlur, chainMode) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            //事件绑定\r\n            instance.__base(eventBus, []);\r\n            instance._config = config;\r\n            instance._lightArray = [];\r\n            instance._lightDrawBefore = [];\r\n            instance._lightEnable = [];\r\n            instance._chainMode = chainMode || false;\r\n            instance.createView(onLineMove, onLightTrans, onLightFocusBlur, option);\r\n            instance.initZIndexEvent();\r\n            return instance;\r\n        },\r\n        createView: function (onLineMove, onLightTrans, onLightFocusBlur, option) {\r\n            var that = this;\r\n            this._config.forEach(function (config, i) {\r\n                var lightComplex = LightComplex.create(that.__getEventBus(), config, onLineMove, onLightTrans,onLightFocusBlur, option);\r\n                that._lightArray.push(lightComplex);\r\n                lightComplex.setVisibility(config.Visible);\r\n                //that._lightEnable[i] = config.Visible;\r\n                //that._lightDrawBefore[i] = config.Visible;\r\n                that._lightEnable[i] = true;\r\n                that._lightDrawBefore[i] = true;\r\n            });\r\n        },\r\n        appendToView: function ($$container) {\r\n            this.each(function () {\r\n                $$container.addShape(this.getView());\r\n            });\r\n        },\r\n        prependToView: function ($$container) {\r\n            this.each(function () {\r\n                $$container.prependItem(this.getView());\r\n            });\r\n        },\r\n        gtIndexAppendToView: function ($$container) {\r\n            this.each(function () {\r\n                this.gtIndexAppendToView($$container);\r\n            });\r\n        },\r\n        each: function (callBack, index) {\r\n            var that = this;\r\n            this._lightArray.forEach(function (lightComplex, i) {\r\n                var call = true;\r\n                if (that.indexValidate(index)) {\r\n                    call = index === i;\r\n                }\r\n                if (call) {\r\n                    callBack.apply(lightComplex, [i]);\r\n                }\r\n            })\r\n        },\r\n        indexValidate: function (index) {\r\n            return typeof index !== typeof  undefined && index < this._lightArray.length;\r\n        },\r\n        getCommandLength: function (index) {\r\n            return this._lightArray[index || 0].getCommandLength();\r\n        },\r\n        pushDrawCommand: function (command, hasDrawCommand, index) {\r\n            this.each(function (i) {\r\n                this.pushDrawCommand(command, hasDrawCommand);\r\n            }, index);\r\n        },\r\n        setPedalDrawIndex: function (pedalIndex, index) {\r\n            this.each(function (i) {\r\n                this.setPedalDrawIndex(pedalIndex);\r\n            }, index);\r\n        },\r\n        setDrawIndex: function (drawIndex, index) {\r\n            this.each(function (i) {\r\n                this.setDrawIndex(drawIndex);\r\n            }, index);\r\n        },\r\n        resetAngle: function (surfaceAngle, init, index) {\r\n            this.each(function (i) {\r\n                this.resetAngle(surfaceAngle, init);\r\n            }, index);\r\n        },\r\n        changeChainLineCommonFill: function () {\r\n            if (!this._chainMode) {\r\n                return;\r\n            }\r\n            var that = this;\r\n            this.each(function (i) {\r\n                var hasNext = true;\r\n                if ((i + 1) >= that._lightArray.length) {\r\n                    hasNext = false\r\n                }\r\n                if (hasNext) {\r\n                    if (i === 0) {\r\n                        this.setRefractionLineCommonFill(that.isEnableAndDraw(i + 1));\r\n                    } else {\r\n                        this.setIncidenceLineCommonFill(that.isEnableAndDraw(i - 1));\r\n                        this.setRefractionLineCommonFill(that.isEnableAndDraw(i + 1));\r\n                    }\r\n                } else {\r\n                    //更新入射光线\r\n                    if (i !== 0) {\r\n                        this.setIncidenceLineCommonFill(that.isEnableAndDraw(i));\r\n                    }\r\n                }\r\n\r\n            })\r\n\r\n        },\r\n        drawAll: function (index) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                if (that.hasNextEnable(i)) {\r\n                    that._lightArray[i + 1].setVisibility(true);\r\n                    that._lightDrawBefore[i + 1] = true;\r\n                }\r\n\r\n                this.drawAll();\r\n            }, index);\r\n\r\n        //    that.changeChainLineCommonFill();\r\n        },\r\n        drawNext: function (index) {\r\n            var that = this;\r\n            var hasCall = false;\r\n            this.each(function (i) {\r\n                if (this.hasNext() && !hasCall&&that._lightEnable[i]===true) {\r\n                    hasCall = true;\r\n                    this.drawNext();\r\n                }\r\n                if (!hasCall && that.hasNextEnable(i)) {\r\n                    hasCall = true;\r\n                    that._lightArray[i + 1].setVisibility(true);\r\n                    that._lightDrawBefore[i + 1] = true;\r\n                }\r\n            }, index);\r\n      //      that.changeChainLineCommonFill();\r\n        },\r\n        //是否有可用的没有显示\r\n        hasNextEnable: function (i) {\r\n            var that = this;\r\n            if (i + 1 < that._lightArray.length) {\r\n                //可用但是未显示\r\n                if (that._lightEnable[i + 1] === true && that._lightArray[i + 1].isVisibilityHidden()) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        //是否有动画未绘制\r\n        hasDrawNext: function (index) {\r\n            var hasNext = false;\r\n            var that = this;\r\n            this.each(function (i) {\r\n                if (!hasNext) {\r\n                    hasNext = this.hasNext();\r\n                }\r\n            }, index);\r\n            return hasNext;\r\n        },\r\n        hasNext: function (index) {\r\n            var hasNext = false;\r\n            var that = this;\r\n            this.each(function (i) {\r\n                if (!hasNext) {\r\n                    hasNext = this.hasNext();\r\n                }\r\n                if (!hasNext) {\r\n                    hasNext = that.hasNextEnable(i);\r\n                }\r\n            }, index);\r\n            return hasNext;\r\n        },\r\n        setAllEnable: function (enable) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                that._lightEnable[i] = enable;\r\n                if (!enable) {\r\n                    this.setVisibility(false);\r\n                }\r\n                //之前绘制过，且可用，则直接显示出来\r\n                if (that._lightDrawBefore[i] && that._lightEnable[i]) {\r\n                    this.setVisibility(true);\r\n                }\r\n            })\r\n        },\r\n        //setDrawStatus:function(index, hasDraw){\r\n        //    this._lightDrawBefore[index]=hasDraw;\r\n        //},\r\n        setEnable: function (index, enable) {\r\n            this._lightEnable[index] = enable;\r\n            //之前绘制过，且可用，则直接显示出来\r\n            if (this._lightDrawBefore[index] && this._lightEnable[index]) {\r\n                this._lightArray[index].setVisibility(true);\r\n            }\r\n            //不可用直接隐藏\r\n            if (enable === false) {\r\n                this._lightArray[index].setVisibility(false);\r\n            }\r\n            this.__triggerEvent('insidechange', 'enablechange');\r\n        },\r\n        setSectorEnable: function (enable) {\r\n            this.each(function () {\r\n                this.setSectorEnable(enable);\r\n            })\r\n        },\r\n        //是否可用，且绘制过\r\n        isEnableAndDraw: function (index) {\r\n            return this._lightEnable[index] && this._lightDrawBefore[index];\r\n        },\r\n        getData: function (index) {\r\n            var data = {\r\n                LightComplex: []\r\n            };\r\n            this.each(function () {\r\n                data.LightComplex.push(this.getData());\r\n            }, index);\r\n            return data;\r\n        },\r\n        rotateAble: function (angle, surfaceMove) {\r\n            var that = this;\r\n            var flag = true;\r\n            this.each(function (i) {\r\n                if (flag) {\r\n                    angle = surfaceMove && that._config[i].IncidenceLine.rotateFixed ? -angle : angle;\r\n                    flag = this.complexRotateAble(angle);\r\n                }\r\n            });\r\n            return flag;\r\n        },\r\n        around: function (surfaceAngle, surfaceRotatePosX) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                this.around(surfaceAngle, surfaceRotatePosX);\r\n            });\r\n        },\r\n        adsorptionPedal: function () {\r\n            this.each(function () {\r\n                this.adsorptionPedal();\r\n            });\r\n        },\r\n        isPedalExcludeDisable: function (index) {\r\n            var isPedal = true;\r\n            this.each(function () {\r\n                if (!this.isVisibilityHidden()) {\r\n                    if (isPedal) {\r\n                        isPedal = this.isPedal();\r\n                    }\r\n                }\r\n            }, index);\r\n            return isPedal;\r\n        },\r\n        isPedal: function (index) {\r\n            var isPedal = true;\r\n            this.each(function () {\r\n                if (isPedal) {\r\n                    isPedal = this.isPedal();\r\n                }\r\n            }, index);\r\n            return isPedal;\r\n        },\r\n        initZIndexEvent: function () {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                var lightComplex = this;\r\n                //i变量做为参数，防止闭包问题\r\n                (function (i) {\r\n                    lightComplex.setViewTapListener(function () {\r\n                        that._currentHighZIndex = i;\r\n                        that.each(function (j) {\r\n                            this.changeTransparent(i === j);\r\n                        })\r\n                    });\r\n                })(i);\r\n            })\r\n        },\r\n        getCurrentHighZIndex: function () {\r\n            return this._currentHighZIndex;\r\n        },\r\n        showFirstIndex: function () {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                this.changeTransparent(i === 0);\r\n            })\r\n        },\r\n        setIncidenceNameEnable: function (nameEnable) {\r\n            this.each(function (i) {\r\n                this.setIncidenceNameEnable(nameEnable);\r\n            })\r\n        },\r\n        setIncidenceNameVisible: function (visible) {\r\n            this.each(function (i) {\r\n                this.setIncidenceNameVisible(visible);\r\n            });\r\n        },\r\n        get: function (index) {\r\n            return this._lightArray[index];\r\n        },\r\n        getDrawBegin: function () {\r\n            return this._lightArray[0].getDrawBegin();\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this.each(function () {\r\n                this.setNameVisible(visible);\r\n            })\r\n        },\r\n        setLinePedalChangeLock: function (lock) {\r\n            this.each(function (i) {\r\n                this.setLinePedalChangeLock(lock);\r\n            })\r\n        },\r\n        getCount: function () {\r\n            return this._lightArray.length;\r\n        },\r\n        /**\r\n         * 场景4,5用\r\n         */\r\n        drawAllNext: function (cb) {\r\n            this.each(function () {\r\n                if (this.hasNext()) {\r\n                    this.drawNext(cb);\r\n                }\r\n            });\r\n        },\r\n        /**\r\n         * 场景4,5用\r\n         */\r\n        drawAllAll: function (cb) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                if (that.hasNextEnable(i)) {\r\n                    that._lightArray[i + 1].setVisibility(true);\r\n                    that._lightDrawBefore[i + 1] = true;\r\n                }\r\n\r\n                this.drawAll(cb);\r\n            });\r\n\r\n            //    that.changeChainLineCommonFill();\r\n        },\r\n        getFirRefAngle: function(){\r\n            return this._lightArray[0].getRefAngle();\r\n        },\r\n        getFirIncidenceAngle: function(){\r\n            return this._lightArray[0].getIncidenceLineXAngle();\r\n        },\r\n        /**\r\n         * 获取虚拟成像已经画了木有\r\n         */\r\n        getHasdrawMaterialObjectImagingGroup4: function(){\r\n            return this._lightArray[0].getHasdrawMaterialObjectImagingGroup4();\r\n        },\r\n        getHasdrawMaterialObjectImagingGroup5: function(){\r\n            return this._lightArray[0].getHasdrawMaterialObjectImagingGroup5();\r\n        }\r\n    });\r\n\r\n    return LightComplexArray;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/refractor/refractor1', ['js/reflector/baseReflector', 'js/utils/utils', 'js/utils/graphMath', 'js/utils/svg'], function (BaseReflector, Utils, GraphMath, Svg) {\r\n\r\n    //view\r\n    var Surface = require('js/view/surface');\r\n    var LightComplexArray = require('js/refractor/LightComplexArrayRef');\r\n    var EqualAngleName = require('js/view/EqualAngleName');\r\n    var ForeignView = require('js/view/ForeignView');\r\n    var EventKey = require('js/config/eventKey');\r\n\r\n    var Refractor = BaseReflector({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    //refractivity1: 3,\r\n                    //refractivity2: 4,\r\n                    IncidenceLine: {\r\n                       // width: 250,//整体长度\r\n                       // arrowPos: 110,//箭号所在位置\r\n                        defaultAngle: 45, rotateFixed: true, clickAble: true, rotateFixedAfterDraw: true\r\n                    },\r\n                    RefractionLine: {\r\n                        visible: false, rotateFixed: true, clickAble: false,\r\n                       // width: 250,\r\n                      //  arrowPos: 110,\r\n                        PedalWidth: 290\r\n                    },\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, refractionVisible: false},\r\n                    IncidencePosX: 1420 / 2,//入射点位置\r\n                    IncidencePosY: 432,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1, 3], [4, 5, 6], [7, 11], [8]],\r\n                    //PedalDrawIndex: [[0, 1], [5, 6], [10]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        //第一次设置\r\n                        //{aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 120, y: 435},{x: 1300, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true}\r\n                        //修改需求\r\n                        {aPoint: {x: 20, y: 435}, bPoint: {x: 1400, y: 435}, degree: 0, range: [{x: 1420/2, y: 435},{x: 1420/2, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true, pedalLineAngle: 90}\r\n                        //{aPoint: {x: 0, y: 435 - 200}, bPoint: {x: 0, y: 396+435}, degree: 90, range: [{x: 0, y: 435},{x: 0, y: 396+435}], refractivity1: 1, refractivity2: 1.333, transAble: false},\r\n                        //{aPoint: {x: 1422, y: 435 - 200}, bPoint: {x: 1420, y: 435+396}, degree: 90, range: [{x: 1420, y: 435},{x: 1420, y: 435+396}], refractivity1: 1, refractivity2: 1.333, transAble: false}\r\n                    ],\r\n                    _curLineIndex: 0\r\n                }],\r\n            Surface: {\r\n                width: 1420,\r\n                defaultAngle: 0,\r\n                rotatePosX: 1420 / 2,//旋转位置\r\n                rotatePosY: 4,//旋转位置\r\n                visible: false,\r\n                clickAble: true,\r\n                type: Surface.Type.tl\r\n\t    },\r\n            ForeignSurf: {\r\n                cls: \"bg_water\",\r\n                width: 1420,\r\n                height: 396,\r\n                translateX: 0,\r\n                translateY: 435\r\n\r\n            }\r\n        },\r\n        _TYPE: 1,\r\n        _Event: [],\r\n        _event: null,\r\n        _$$container: null,\r\n        _incidencePointPos: null,\r\n        _surfacePagePos: null,\r\n        _option: null,\r\n        _equalAngleNameHasShowBefore: false,\r\n        resetState: false,\r\n        create: function (eventBus, $$container, option, data) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance._event = $.extend(true, [], this._Event);\r\n            instance.initEvent();\r\n            //事件绑定\r\n            instance.__base(eventBus, instance._event);\r\n\r\n            instance.__proxyAll(['onSurfaceMove', 'onLineMove', 'onLineTrans','onLightFocusBlur','nameVisibleHandler']);//绑定this指针\r\n            instance._$$container = $$container;\r\n            instance._config = $.extend(true, {}, this._CONFIG, (data && data.configData) || {});\r\n            instance._option = option;\r\n            instance.createView();\r\n            instance.afterCreateView();\r\n            instance.initExtrasDrawCommand();\r\n            instance.resetState = data && data.resetState? data.resetState: this.resetState;//是否可重置\r\n            return instance;\r\n        },\r\n        initEvent: function () {\r\n            //TODO:交由基类处理\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            //反射面\r\n            this._surface = Surface.create(this.__getEventBus(), this._config.Surface, this.onSurfaceMove, this._option.langData);\r\n\r\n            this._lightComplexArray = LightComplexArray.create(this.__getEventBus(), this._config.LightComplex, this._option, this.onLineMove, this.onLineTrans, this.onLightFocusBlur);\r\n            this._lightComplexArray.appendToView(this._$$container);\r\n\r\n            this._equalAngleName = EqualAngleName.create(this._option.langData);\r\n\r\n            /**\r\n             * 用于定位介质文字 多语言问题\r\n             */\r\n            var bgLeft = this._config.ForeignSurf.translateX, bgRight = bgLeft + this._config.ForeignSurf.width, bgTop = this._config.ForeignSurf.translateY, bgBottom = bgTop + this._config.ForeignSurf.height;\r\n\r\n            var langData = that._option.langData;\r\n            var airTextCon = langData.refraction_air || '空气';\r\n            var textCon = langData.refraction_water || '水';\r\n\r\n            //空气\r\n            var airG = new kity.Group();\r\n            //airG.setTranslate(1180,170);\r\n\r\n            var airText =  new kity.Text().setContent(airTextCon).setAttr('x', 0).setAttr('y', 40).addClass(\"svg_text_l\").addClass(\"color_black\");\r\n\r\n            airG.addShape(airText);\r\n            this._$$container.prependItem(airG);\r\n            var airTextWidth = $(airText.node).width();\r\n            airG.setTranslate(1180 + 170- airTextWidth ,170);\r\n            //水和水面\r\n            this._foreignSurf = new kity.Group();\r\n            var foreignline1 = new kity.Path(\"M 0 0 L 1420 0\");\r\n          //  var foreignline2 = new kity.Path(\"M 120 0 L 1300 0 \");\r\n            foreignline1.setStyle({\"stroke-width\": 4, \"stroke\": \"#898989\"});\r\n          //  foreignline2.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            this.lineG = new kity.Group();\r\n            this.lineG.addClass(\"hide_dom\");\r\n            this.lineG.addShape(foreignline1);\r\n            //this.lineG.addShape(foreignline2);\r\n            var foreignBg = ForeignView.create(this._config.ForeignSurf.cls, this._config.ForeignSurf.width, this._config.ForeignSurf.height);\r\n            this._foreignSurf.addShape(this.lineG);\r\n            $(this._foreignSurf.node).prepend(foreignBg.getView());\r\n            //var text = new kity.Text().setContent(text).setAttr('x', 1200).setAttr('y', 146).addClass(\"svg_text_l\").addClass(\"color_white\");\r\n            var text = new kity.Text().setContent(textCon);\r\n            text.addClass(\"svg_text_l\").addClass(\"color_white\");\r\n            this._foreignSurf.addShape(text);\r\n            this._$$container.prependItem(this._foreignSurf);\r\n            var textWidth = $(text.node).width();\r\n            text.setAttr('x', 1200 + 100  - textWidth).setAttr('y', 146);\r\n\r\n            this._foreignSurf.setTranslate(this._config.ForeignSurf.translateX, this._config.ForeignSurf.translateY);\r\n\r\n            this._$$container.addShape(this._surface.getView());\r\n            this._$$container.addShape(this._equalAngleName.getView());\r\n            this._lightComplexArray.gtIndexAppendToView(this._$$container);\r\n\r\n            this._surface.setTranslate(0, this._config.LightComplex[0].IncidencePosY);\r\n            this._surface.setNameVisible(this._option.nameVisible);\r\n            if (this._config.EqualAngleName) {\r\n                that._equalAngleNameHasShowBefore = this._config.EqualAngleName.visible;\r\n                this._equalAngleName.setVisibility(this._config.EqualAngleName.visible);\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n       //     this.resetAngle(this._config.Surface.defaultAngle, true);\r\n            this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree, true);\r\n\r\n            //从新初始化坐标位置\r\n            //this.toCenter();\r\n            this.initEqualAngleNamePos();\r\n        },\r\n        initExtrasDrawCommand: function () {\r\n            //交由基类处理\r\n            //var that = this;\r\n            //var length = this._lightComplexArray.getCommandLength();\r\n            //this._lightComplexArray.pushDrawCommand(function (deffer) {\r\n            //    if (that._lightComplexArray.isPedal()) {\r\n            //        that._equalAngleNameHasShowBefore = true;\r\n            //        that._equalAngleName.setVisibility(true);\r\n            //    }\r\n            //    deffer.resolve();\r\n            //}, function () {\r\n            //    if (!that._lightComplexArray.isPedal()) {\r\n            //        return true;\r\n            //    }\r\n            //    if (!that._equalAngleName.isVisibilityHidden()) {\r\n            //        return true;\r\n            //    }\r\n            //    return that._equalAngleNameHasShowBefore;\r\n            //});\r\n            //var pedalIndex = $.extend(true, [], this._config.LightComplex[0].PedalDrawIndex);\r\n            //pedalIndex.splice(2, 0, length);\r\n            //this._lightComplexArray.setPedalDrawIndex(pedalIndex);\r\n        },\r\n        afterCreateView: function () {\r\n            //TODO:交由子类覆盖\r\n        },\r\n        initEqualAngleNamePos: function () {\r\n            //布局角度\r\n            var parentTranslate = this._$$container.getTransform().m;\r\n            var width = this._equalAngleName.getView().getWidth();\r\n            var height = this._equalAngleName.getView().getHeight();\r\n            this._equalAngleName.setTranslate(this._option.viewPortWidth - parentTranslate.e - width - 135, -( this._option.viewPortHeight - parentTranslate.f - height ) + 20);\r\n        },\r\n        toCenter: function () {\r\n            this._$$container.setTranslate(this._option.viewPortWidth / 2 - this.getWidth() / 2, this._option.viewPortHeight / 2 + 10);\r\n        },\r\n        resetAngle: function (angle, init) {\r\n            this._surface.rotate(angle);\r\n            var surfaceAngle = this._surface.getRotateAngle() || 0;\r\n            this._lightComplexArray.resetAngle(surfaceAngle, init);\r\n        },\r\n        getData: function () {\r\n            var data = {};\r\n            data.type = this._TYPE;\r\n            data.configData = this._lightComplexArray.getData();\r\n            data.configData.Surface = {\r\n                defaultAngle: this._surface.getRotateAngle(),\r\n                visible: !this._surface.isVisibilityHidden()\r\n            };\r\n            data.configData.EqualAngleName = {\r\n                visible: !this._equalAngleName.isVisibilityHidden()\r\n            };\r\n            data.resetState = this.resetState;\r\n            return data;\r\n        },\r\n        getMoveRotateAngle: function (data) {\r\n            var currentPos = data.currentPos;\r\n            var lastPos = data.lastPos;\r\n            return GraphMath.getRotateAngle(this._surface.getRotateOffsetPos(), lastPos, currentPos);\r\n        },\r\n        onSurfaceMove: function (data, eventType) {\r\n            if (eventType === 'move') {\r\n                var angle = this.getMoveRotateAngle(data);\r\n                if (this._lightComplexArray.rotateAble(angle)) {\r\n                    this.resetAngle(angle);\r\n                    this._lightComplexArray.around(this._surface.getRotateAngle(), this._config.Surface.rotatePosX);\r\n                }\r\n            } else if (eventType === 'aftermove') {\r\n                this._lightComplexArray.adsorptionPedal();\r\n            }\r\n            this.initEqualAngleVisibility();\r\n            this.resetState = true;\r\n        },\r\n        onLineMove: function (uuid, angle, curLineIndex) {\r\n            this.resetState = true;\r\n            this.initEqualAngleVisibility();\r\n            this.afterLineMove(curLineIndex);\r\n\r\n        },\r\n        onLineTrans: function (uuid, x, y, curLineIndex){\r\n            this.resetState = true;\r\n            this.afterLineMove(curLineIndex);\r\n\r\n        },\r\n        onLightFocusBlur: function(type){\r\n            if(this.lineG){\r\n                if(type == \"focus\"){\r\n                    this.lineG.removeClass(\"hide_dom\");\r\n                }else{\r\n                    this.lineG.addClass(\"hide_dom\");\r\n                }\r\n            }\r\n        },\r\n        afterLineMove: function (curLineIndex) {\r\n            var lightComplex0 = this._lightComplexArray.get(0);\r\n\r\n            var incidTran = Svg.getAttrTranslate($(lightComplex0._$$incidencePoint.node).attr('transform'));\r\n            var refractAPos1 = {x: incidTran[0], y: incidTran[1]};\r\n            var lines = this._config.LightComplex[0].Lines;\r\n            var lineIn = curLineIndex? curLineIndex: 0;\r\n            //重置入射线的长度\r\n            var incidenceAngle1 = lightComplex0.getIncidenceRotateAngle();\r\n            var incidenceLine0 = {degree: incidenceAngle1,  aPoint: refractAPos1};\r\n            if(lineIn >= 0){\r\n                var result0 = GraphMath.pointInLine(incidenceLine0, lines, lineIn);\r\n                var initIncidW = lightComplex0._configData.IncidenceLine.width;\r\n                if(result0){\r\n                    var incidW0 = GraphMath.getTwoPointDistance(result0.acrossPoint, refractAPos1);\r\n                    if(incidW0 < initIncidW){\r\n                        lightComplex0.setIncidenceLineWidth(incidW0);\r\n                    }else{\r\n                        lightComplex0.setIncidenceLineWidth(initIncidW);\r\n                    }\r\n                }else{\r\n                    lightComplex0.setIncidenceLineWidth(initIncidW);\r\n                }\r\n            }\r\n\r\n            var refractAngle1 = lightComplex0.getRefractionRotateAngle();\r\n            var refractLine1 = {degree: refractAngle1, aPoint: refractAPos1};\r\n            if (lineIn >= 0) {\r\n                var result = GraphMath.pointInLine(refractLine1, lines, lineIn);\r\n                var initRefracLineW = lightComplex0._configData.RefractionLine.width;\r\n                if (result) {\r\n                    var incidentPoint2 = result.acrossPoint;\r\n                    var lineIn2 = result.index;\r\n                    var refracWidth = GraphMath.getTwoPointDistance(refractAPos1, incidentPoint2);\r\n\r\n                    //第一个场景\r\n                    if(refracWidth > initRefracLineW){\r\n                        lightComplex0.setRefractionLineWidth(initRefracLineW);\r\n                    }else {\r\n                        lightComplex0.setRefractionLineWidth(refracWidth);\r\n                    }\r\n\r\n                } else {\r\n                    //var curRefracLineW = lightComplex0.getRefractionLineWidth();\r\n                    //if(curRefracLineW > initRefracLineW){\r\n                    //    lightComplex0.setRefractionLineWidth(initRefracLineW);\r\n                    //}\r\n                    lightComplex0.setRefractionLineWidth(initRefracLineW);\r\n                }\r\n            }\r\n        },\r\n        initEqualAngleVisibility: function () {\r\n            //非垂足重置为不可见\r\n            if (this._lightComplexArray.isPedal()) {\r\n                if (this._equalAngleNameHasShowBefore || this._lightComplexArray.get(0).getTwoLineVisible()) {\r\n                    this._equalAngleName.setVisibility(true);\r\n                }\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n        },\r\n        getWidth: function () {\r\n            return this._config.Surface.width;\r\n        },\r\n        drawAll: function () {\r\n            this.resetState = true;\r\n            this._lightComplexArray.drawAll();\r\n        },\r\n        drawNext: function () {\r\n            this.resetState = true;\r\n            this._lightComplexArray.drawNext();\r\n        },\r\n        setResetState: function(state){\r\n            this.resetState = state;\r\n        }\r\n    });\r\n\r\n    Refractor.Extend = function (cls) {\r\n        return Object.create(Refractor).__include(cls);\r\n    };\r\n    return Refractor;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/refractor/refractor2', ['js/refractor/refractor1', 'js/utils/utils', 'js/utils/graphMath', 'js/utils/svg'], function (Refractor1, Utils, GraphMath, Svg) {\r\n\r\n    //view\r\n    var Surface = require('js/view/surface');\r\n    var LightComplexArray = require('js/refractor/LightComplexArrayRef');\r\n    var EqualAngleName = require('js/view/EqualAngleName');\r\n    var ForeignView = require('js/view/ForeignView');\r\n    var EventKey = require('js/config/eventKey');\r\n    var Sector = require('js/view/sector');//为了隐藏全放射状态的折射线引入的，加入全反射后可以删掉\r\n\r\n    var Refractor = Refractor1.Extend({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    //refractivity1: 1,\r\n                    //refractivity2: 1.5,\r\n                    IncidenceLine: {defaultAngle: 45, rotateFixed: true, clickAble: true},\r\n                    //ReflectionLine: {\r\n                    //    visible: false,\r\n                    //    rotateFixed: false,\r\n                    //    clickAble: false\r\n                    //},\r\n                    RefractionLine: {visible: false, rotateFixed: true, clickAble: false},\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false, refractionVisible: false},\r\n                    //第一次\r\n                    //IncidencePosX: 716,//入射点位置\r\n                    //IncidencePosY: 316,\r\n                    //第二次\r\n                    IncidencePosX: 420 + 764/2,//入射点位置\r\n                    IncidencePosY: 313,\r\n                    //IncidencePosX: 420,//入射点位置\r\n                    //IncidencePosY: 316+ 309/2,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1, 3], [4, 5, 6], [7, 11], [8]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        //第一次修改\r\n                        //{aPoint: {x: 420, y: 316}, bPoint: {x: 1184, y: 316}, degree: 0, range: [{x: 32+420, y: 0+316}, {x: 731+420, y: 0+316}], refractivity1: 1, refractivity2: 1.5, transAble: true},\r\n                        //{aPoint: {x: 420, y: 625}, bPoint: {x: 1184, y: 625}, degree: 0, range: [{x: 32+420, y: 625}, {x: 731+420, y: 309+316}], refractivity1: 1.5, refractivity2: 1, transAble: true},\r\n                        //{aPoint: {x: 420, y: 316}, bPoint: {x: 420, y: 625}, degree: 90, range: [{x: 0+420, y: 32+316}, {x: 0+420, y: 281+316}], refractivity1: 1.5, refractivity2: 1, transAble: true},\r\n                        //{aPoint: {x: 1184, y: 316}, bPoint: {x: 1184, y: 625}, degree: 90, range: [{x: 1184, y: 32+316}, {x: 1184, y: 281+316}], refractivity1: 1, refractivity2: 1.5, transAble: true}\r\n                        //第二次修改\r\n                        //{aPoint: {x: 420, y: 316}, bPoint: {x: 1184, y: 316}, degree: 0, range: [{x: 120+420, y: 0+316}, {x: 641+420, y: 0+316}], refractivity1: 1, refractivity2: 1.5, transAble: true},\r\n                        //{aPoint: {x: 420, y: 625}, bPoint: {x: 1184, y: 625}, degree: 0, range: [{x: 120+420, y: 625}, {x: 641+420, y: 625}], refractivity1: 1.5, refractivity2: 1, transAble: true},\r\n                        //{aPoint: {x: 420, y: 316}, bPoint: {x: 420, y: 625}, degree: 90, range: [{x: 0+420, y: 120+316}, {x: 0+420, y: 189+316}], refractivity1: 1.5, refractivity2: 1, transAble: true},\r\n                        //{aPoint: {x: 1184, y: 316}, bPoint: {x: 1184, y: 625}, degree: 90, range: [{x: 1184, y: 120+316}, {x: 1184, y: 189+316}], refractivity1: 1, refractivity2: 1.5, transAble: true}\r\n                        //第三次修改\r\n                        {aPoint: {x: 420, y: 316}, bPoint: {x: 1184, y: 316}, degree: 0, range: [{x: 420 + 764/2, y: 0+316}, {x: 420 + 764/2, y: 0+316}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 90},\r\n                        {aPoint: {x: 420, y: 625}, bPoint: {x: 1184, y: 625}, degree: 0, range: [{x: 420 + 764/2, y: 625}, {x: 420 + 764/2, y: 625}], refractivity1: 1.5, refractivity2: 1, transAble: true, pedalLineAngle: 90},\r\n                        {aPoint: {x: 420, y: 316}, bPoint: {x: 420, y: 625}, degree: 90, range: [{x: 0+420, y: 316+ 309/2}, {x: 0+420, y: 316+ 309/2}], refractivity1: 1.5, refractivity2: 1, transAble: true, pedalLineAngle: 90},\r\n                        {aPoint: {x: 1184, y: 316}, bPoint: {x: 1184, y: 625}, degree: 90, range: [{x: 1184, y: 316+ 309/2}, {x: 1184, y: 316+ 309/2}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 90}\r\n\r\n                    ],\r\n                    _curLineIndex: 0\r\n                },\r\n                {\r\n                    //refractivity1: 1.5,\r\n                    //refractivity2: 1,\r\n                    IncidenceLine: {defaultAngle: 30, rotateFixed: true, clickAble: true, visible: false},\r\n                    //ReflectionLine: {\r\n                    //    visible: false,\r\n                    //    rotateFixed: false,\r\n                    //    clickAble: false\r\n                    //},\r\n                    RefractionLine: {visible: false, rotateFixed: true, clickAble: false,},\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false, refractionVisible: false},\r\n                    IncidencePosX: 300,//入射点位置\r\n                    IncidencePosY: 200,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1], [4, 5, 6], [7, 11], [8]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n\t\t            Visible: true,\r\n                    Lines: [\r\n                        {aPoint: {x: 420, y: 316}, bPoint: {x: 1184, y: 316}, degree: 0, range: [{x: 420 + 764/2, y: 0+316}, {x: 420 + 764/2, y: 0+316}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 90},\r\n                        {aPoint: {x: 420, y: 625}, bPoint: {x: 1184, y: 625}, degree: 0, range: [{x: 420 + 764/2, y: 625}, {x: 420 + 764/2, y: 625}], refractivity1: 1.5, refractivity2: 1, transAble: true, pedalLineAngle: 90},\r\n                        {aPoint: {x: 420, y: 316}, bPoint: {x: 420, y: 625}, degree: 90, range: [{x: 0+420, y: 316+ 309/2}, {x: 0+420, y: 316+ 309/2}], refractivity1: 1.5, refractivity2: 1, transAble: true, pedalLineAngle: 90},\r\n                        {aPoint: {x: 1184, y: 316}, bPoint: {x: 1184, y: 625}, degree: 90, range: [{x: 1184, y: 316+ 309/2}, {x: 1184, y: 316+ 309/2}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 90}\r\n\r\n                    ],\r\n                    _curLineIndex: 0\r\n                }\r\n            ],\r\n            Surface: {width: 764, defaultAngle: 0, rotatePosX: 764/2,rotatePosY: 316, visible: false, clickAble: true, aPoint: {x: 420, y: 316}, bPoint: {x: 1184, y: 316}},\r\n\r\n            ForeignSurf: {\r\n                cls: \"bg_glassrect\",\r\n                width: 905,\r\n                height: 453,\r\n                translateX: 420,\r\n                translateY: 316\r\n            }\r\n\r\n        },\r\n        _TYPE: 2,\r\n        resetState: false,\r\n        create: function (eventBus, $$container, option, data) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance._event = $.extend(true, [], this._Event);\r\n            instance.initEvent();\r\n            //事件绑定\r\n            instance.__base(eventBus, instance._event);\r\n\r\n            instance.__proxyAll(['onSurfaceMove', 'onLineMove', 'onLineTrans','onLightFocusBlur','nameVisibleHandler']);//绑定this指针\r\n            instance._$$container = $$container;\r\n            instance._config = $.extend(true, {}, this._CONFIG, (data && data.configData) || {});\r\n            instance._option = option;\r\n            instance.createView();\r\n            instance.afterCreateView();\r\n            instance.initExtrasDrawCommand();\r\n            instance.resetState = data && data.resetState? data.resetState: this.resetState;//是否可重置\r\n            return instance;\r\n        },\r\n\r\n        createView: function () {\r\n            var that = this;\r\n            //$('body').on('REFRACTION_HIDE',that.refractionHideHandler.bind(this));\r\n            //$('body').on('REFRACTION_SHOW',that.refractionShowHandler.bind(this));\r\n            //反射面\r\n            this._surface = Surface.create(this.__getEventBus(), this._config.Surface, this.onSurfaceMove, this._option.langData);\r\n\r\n            this._lightComplexArray = LightComplexArray.create(this.__getEventBus(), this._config.LightComplex, this._option, this.onLineMove, this.onLineTrans, this.onLightFocusBlur);\r\n            this._lightComplexArray.prependToView(this._$$container);\r\n\r\n            this._equalAngleName = EqualAngleName.create(this._option.langData);\r\n\r\n            /**\r\n             * 用于定位介质文字 多语言问题\r\n             */\r\n            var bgLeft = this._config.ForeignSurf.translateX, bgRight = bgLeft + this._config.ForeignSurf.width, bgTop = this._config.ForeignSurf.translateY, bgBottom = bgTop + this._config.ForeignSurf.height;\r\n\r\n            var langData = that._option.langData;\r\n            var airTextCon = langData.refraction_air || '空气';\r\n            var textCon = langData.refraction_glass || '玻璃';\r\n            //空气\r\n            var airG = new kity.Group();\r\n            //airG.setTranslate(1160,116);\r\n            var airText =  new kity.Text().setContent(airTextCon).setAttr('x', 0).setAttr('y', 40).addClass(\"svg_text_l\").addClass(\"color_black\");\r\n            airG.addShape(airText);\r\n            this._$$container.prependItem(airG);\r\n            var airTextWidth = $(airText.node).width();\r\n            airG.setTranslate(1160+ 170 - airTextWidth ,116);\r\n            //玻璃背景\r\n            this._foreignSurf = new kity.Group();\r\n            var foreignline1 = new kity.Path(\"M 0 0 L 761 0 L764 309 L0 309Z\");\r\n            //var foreignline2 = new kity.Path(\"M 120 0 L 641 0\");\r\n            //var foreignline3 = new kity.Path(\"M 120 309 L 641 309\");\r\n            //var foreignline4 = new kity.Path(\"M 0 120 L 0 189\");\r\n            //var foreignline5 = new kity.Path(\"M764 120 L 764 189\");\r\n            foreignline1.setStyle({\"stroke-width\": 4, \"stroke\": \"#898989\"});\r\n            //foreignline2.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            //foreignline3.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            //foreignline4.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            //foreignline5.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            var foreignBg = ForeignView.create(this._config.ForeignSurf.cls, this._config.ForeignSurf.width, this._config.ForeignSurf.height);\r\n            foreignBg.setTranslate(-41, -43);\r\n            this.lineG = new kity.Group();\r\n            this.lineG.addClass(\"hide_dom\");\r\n            this.lineG.addShape(foreignline1);\r\n            //this.lineG.addShape(foreignline2);\r\n            //this.lineG.addShape(foreignline3);\r\n            //this.lineG.addShape(foreignline4);\r\n            //this.lineG.addShape(foreignline5);\r\n            this._foreignSurf.addShape(this.lineG);\r\n            $(this._foreignSurf.node).prepend(foreignBg.getView());\r\n            var text = new kity.Text().setContent(textCon).addClass(\"svg_text_l\").addClass(\"color_glass\");\r\n            this._foreignSurf.addShape(text);\r\n            this._foreignSurf.setTranslate(this._config.ForeignSurf.translateX, this._config.ForeignSurf.translateY);\r\n            this._$$container.prependItem(this._foreignSurf);\r\n            var textWidth = $(text.node).width();\r\n            text.setAttr('x', 570 + 170 -textWidth).setAttr('y', 90);\r\n\r\n\r\n\r\n            this._$$container.addShape(this._surface.getView());\r\n            this._$$container.addShape(this._equalAngleName.getView());\r\n            this._lightComplexArray.gtIndexAppendToView(this._$$container);\r\n\r\n            this._surface.setTranslate(420, this._config.LightComplex[0].IncidencePosY);\r\n            this._surface.setNameVisible(this._option.nameVisible);\r\n            if (this._config.EqualAngleName) {\r\n                that._equalAngleNameHasShowBefore = this._config.EqualAngleName.visible;\r\n                this._equalAngleName.setVisibility(this._config.EqualAngleName.visible);\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n            //this.resetAngle(this._config.Surface.defaultAngle, true);\r\n            this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree, true);\r\n            //从新初始化坐标位置\r\n            this.toCenter();\r\n            this.initEqualAngleNamePos();\r\n        },\r\n\r\n        afterCreateView: function () {\r\n            //交由基类处理\r\n          //  this.afterLineMove();\r\n          //  this._lightComplexArray.showFirstIndex();\r\n            this.afterLineMove(this._config.LightComplex[0]._curLineIndex);\r\n        },\r\n      \r\n        toCenter: function () {\r\n         //   this._$$container.setTranslate(-100, 0);\r\n        },\r\n        onLineMove: function (uuid, angle, curLineIndex) {\r\n            this.resetState = true;\r\n            this.initEqualAngleVisibility();\r\n            this.afterLineMove(curLineIndex);\r\n        },\r\n        onLineTrans: function (uuid, x, y, curLineIndex){\r\n            this.resetState = true;\r\n            this.afterLineMove(curLineIndex);\r\n        },\r\n\r\n        //resetAngle: function (angle, init) {\r\n        //    this._surface.rotate(angle);\r\n        //    this._surfacebottom.rotate(angle);\r\n        //    var surfaceAngle = this._surface.getRotateAngle() || 0;\r\n        //    //TODO:这个角度应该是有问题的\r\n        //    this._lightComplexArray.resetAngle(surfaceAngle, init);\r\n        //},\r\n\r\n        afterLineMove: function (curLineIndex) {\r\n            var lightComplex0 = this._lightComplexArray.get(0);\r\n            var lightComplex1 = this._lightComplexArray.get(1);\r\n\r\n            var incidTran = Svg.getAttrTranslate($(lightComplex0._$$incidencePoint.node).attr('transform'));\r\n            var refractAPos1 = {x: incidTran[0], y: incidTran[1]};\r\n            var lines = this._config.LightComplex[0].Lines;\r\n            //var lineIn = GraphMath.inWhichLine(refractAPos1, lines);\r\n            var lineIn = curLineIndex ? curLineIndex: 0;\r\n            //重置入射线的长度\r\n            var incidenceAngle1 = lightComplex0.getIncidenceRotateAngle();\r\n            var incidenceLine0 = {degree: incidenceAngle1,  aPoint: refractAPos1};\r\n            if(lineIn >= 0){\r\n                var result0 = GraphMath.pointInLine(incidenceLine0, lines, lineIn);\r\n                var initIncidW = lightComplex0._configData.IncidenceLine.width;\r\n                if(result0 ){\r\n                    var incidW0 = GraphMath.getTwoPointDistance(result0.acrossPoint, refractAPos1);\r\n                    if(incidW0 < initIncidW){\r\n                        lightComplex0.setIncidenceLineWidth(incidW0);\r\n                    }else{\r\n                        lightComplex0.setIncidenceLineWidth(initIncidW);\r\n                    }\r\n                }else{\r\n                    lightComplex0.setIncidenceLineWidth(initIncidW);\r\n                }\r\n            }\r\n\r\n            //if(lightComplex0.getRefractionVisible()) { //判断是否显示第二模块,然后初始化第二模块\r\n                var refractAngle1 = lightComplex0.getRefractionRotateAngle();\r\n                var refractLine1 = {degree: refractAngle1, aPoint: refractAPos1};\r\n\r\n                if (lineIn >= 0) {\r\n                    var result = GraphMath.pointInLine(refractLine1, lines, lineIn);\r\n                    this._acrossPoint = result;\r\n                    if (result) {\r\n                        //lightComplex1.setVisibility(true);\r\n                        //this._lightComplexArray._lightArray.push(lightComplex1);\r\n                        var incidentPoint2 = result.acrossPoint;\r\n                        var lineIn2 = result.index;\r\n                        lightComplex1.setCurLineIndex(lineIn2);\r\n                        var refracWidth = GraphMath.getTwoPointDistance(refractAPos1, incidentPoint2);\r\n                        lightComplex0.setRefractionLineWidth(refracWidth);\r\n                        //lightComplex1.setIncidenVisibility(false);\r\n                        lightComplex1.setIncidenceLineVisible(false);\r\n                        lightComplex1.setIncidenceLineWidth(refracWidth);\r\n                        lightComplex1.setGroupTranslate(incidentPoint2.x, incidentPoint2.y);\r\n                        var incidenceAngle2 = GraphMath.getRotateAngle(incidentPoint2, lines[lineIn2].aPoint, refractAPos1);\r\n                     //   console.log(\"incidenceAngle2 = \"+incidenceAngle2);\r\n                        lightComplex1.setIncidenceXAxisAngle(incidenceAngle2 + lines[lineIn2].degree);\r\n                        lightComplex1.resetAngle(lines[lineIn2].degree);\r\n                        if(lightComplex0._curRefAngle == \"no_refract\" || lightComplex1._curRefAngle == \"no_refract\" ){\r\n                            this._lightComplexArray.setEnable(1, false);\r\n                        }else{\r\n                            this._lightComplexArray.setEnable(1, true);\r\n                        }\r\n\r\n                    } else {\r\n                        //lightComplex1.setVisibility(false);\r\n                        this._lightComplexArray.setEnable(1, false);\r\n                        var initRefracLineW = lightComplex0._configData.RefractionLine.width;\r\n                        lightComplex0.setRefractionLineWidth(initRefracLineW);\r\n                    }\r\n                }\r\n            /**\r\n             * 场景2\r\n             */\r\n            if(lightComplex0.isPedal()){\r\n                if(lightComplex1.isPedal()){\r\n                    this._lightComplexArray.setEnable(1, false);\r\n                    lightComplex0.setRefractionLineWidth(refracWidth + 100);\r\n                }\r\n            }//else if(lightComplex0.isPedal() && lightComplex1)\r\n            //if(result) {\r\n            //    lightComplex1.setVisibility(true);\r\n            //\r\n            // }else{\r\n            //    lightComplex1.setVisibility(false);\r\n            //    var initRefracLineW = lightComplex0._configData.RefractionLine.width;\r\n            //    lightComplex0.setRefractionLineWidth(initRefracLineW);\r\n            //}\r\n        }\r\n\r\n    });\r\n\r\n    Refractor.Extend = function (cls) {\r\n        return Object.create(Refractor).__include(cls);\r\n    };\r\n    return Refractor;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/refractor/refractor3', ['js/refractor/refractor2', 'js/utils/utils', 'js/utils/graphMath', 'js/utils/svg'], function (Refractor2, Utils, GraphMath, Svg) {\r\n\r\n    //view\r\n    var Surface = require('js/view/surface');\r\n    var LightComplexArray = require('js/refractor/LightComplexArrayRef');\r\n    var EqualAngleName = require('js/view/EqualAngleName');\r\n    var ForeignView = require('js/view/ForeignView');\r\n\r\n    var Sector = require('js/view/sector');//为了隐藏全放射状态的折射线引入的，加入全反射后可以删掉\r\n\r\n    var Refractor = Refractor2.Extend({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    //refractivity1: 1,\r\n                    //refractivity2: 1.5,\r\n                    IncidenceLine: {defaultAngle: -13, rotateFixed: true, clickAble: true},\r\n                    //ReflectionLine: {\r\n                    //    visible: false,\r\n                    //    rotateFixed: false,\r\n                    //    clickAble: false\r\n                    //},\r\n                    RefractionLine: {visible: false, rotateFixed: true, clickAble: false},\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false, refractionVisible: false},\r\n                    //第一次\r\n                    //IncidencePosX: 672,//入射点位置\r\n                    //IncidencePosY: 418.74580629534967,\r\n                    //第二次\r\n                    IncidencePosX: 682.8,//入射点位置\r\n                    IncidencePosY: 399.5,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1, 3], [4, 5, 6], [7, 11], [8]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        //最初的区域\r\n                        //{aPoint: {x: 510, y: 515+163}, bPoint: {x: 320+510, y: 163}, degree: 302, range: [{x: 22+510, y: 483+163}, {x: 297+510, y: 37+163}], refractivity1: 1, refractivity2: 1.5, transAble: true},\r\n                        //{aPoint: {x: 320+510, y: 163}, bPoint: {x: 510+600+42, y: 515+163}, degree: 58, range: [{x: 343+510, y: 37+163}, {x: 622+510, y: 480+163}], refractivity1: 1, refractivity2: 1.5, transAble: true},\r\n                        //{aPoint: {x: 510 , y: 515+163}, bPoint: {x: 510+600+42 , y: 515+163}, degree: 0, range: [{x: 32+510, y: 515+163}, {x: 600+510, y: 515+163}], refractivity1: 1.5, refractivity2: 1, transAble: true}\r\n                        //第二次修改的区域\r\n                        //{aPoint: {x: 510, y: 515+163}, bPoint: {x: 320+510, y: 163}, degree: 302, range: [{x: 60+510, y: 420+163}, {x: 260+510, y: 98+163}], refractivity1: 1, refractivity2: 1.5, transAble: true},\r\n                        //{aPoint: {x: 320+510, y: 163}, bPoint: {x: 510+600+42, y: 515+163}, degree: 58, range: [{x: 382+510, y: 98+163}, {x: 584+510, y: 420+163}], refractivity1: 1, refractivity2: 1.5, transAble: true},\r\n                        //{aPoint: {x: 510 , y: 515+163}, bPoint: {x: 510+600+42 , y: 515+163}, degree: 0, range: [{x: 120+510, y: 515+163}, {x: 524+510, y: 515+163}], refractivity1: 1.5, refractivity2: 1, transAble: true}\r\n                        //第三次修改的区域\r\n                        {aPoint: {x: 510, y: 515+163}, bPoint: {x: 320+510, y: 163}, degree: 302, range: [{x: 682.8, y: 402.5},{x: 682.8, y: 402.5}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 32},\r\n                        {aPoint: {x: 320+510, y: 163}, bPoint: {x: 510+600+42, y: 515+163}, degree: 58, range: [{x: 980.4, y: 402.5},{x: 980.4, y: 402.5}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 58},\r\n                        {aPoint: {x: 510 , y: 515+163}, bPoint: {x: 510+600+42 , y: 515+163}, degree: 0, range: [{x: 510+642/2, y: 515+163}, {x:510+642/2, y: 515+163}], refractivity1: 1.5, refractivity2: 1, transAble: true, pedalLineAngle: 90}\r\n                    ],\r\n                    _curLineIndex: 0\r\n                },\r\n                {\r\n                    //refractivity1:1.5,\r\n                    //refractivity2: 1,\r\n                    IncidenceLine: {defaultAngle: 30, rotateFixed: true, clickAble: true, visible: false},\r\n                    //ReflectionLine: {\r\n                    //    visible: false,\r\n                    //    rotateFixed: false,\r\n                    //    clickAble: false\r\n                    //},\r\n                    RefractionLine: {visible: false, rotateFixed: true, clickAble: false},\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false, refractionVisible: false},\r\n                    IncidencePosX: 672,//入射点位置\r\n                    IncidencePosY: 418.74580629534967,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1], [4, 5, 6], [7, 11], [8]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        {aPoint: {x: 510, y: 515+163}, bPoint: {x: 320+510, y: 163}, degree: 302, range: [{x: 682.8, y: 402.5},{x: 682.8, y: 402.5}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 32},\r\n                        {aPoint: {x: 320+510, y: 163}, bPoint: {x: 510+600+42, y: 515+163}, degree: 58, range: [{x: 980.4, y: 402.5},{x: 980.4, y: 402.5}], refractivity1: 1, refractivity2: 1.5, transAble: true, pedalLineAngle: 58},\r\n                        {aPoint: {x: 510 , y: 515+163}, bPoint: {x: 510+600+42 , y: 515+163}, degree: 0, range: [{x: 510+642/2, y: 515+163}, {x:510+642/2, y: 515+163}], refractivity1: 1.5, refractivity2: 1, transAble: true, pedalLineAngle: 90}\r\n                    ],\r\n                    _curLineIndex: 0\r\n                }\r\n            ],\r\n            Surface: {width: 600, defaultAngle: -58, rotatePosX: 600 / 2,rotatePosY: 0, visible: false, clickAble: true,aPoint: {x: 500, y: 515+163}, bPoint: {x: 320+510, y: 163}},\r\n\r\n            ForeignSurf: {\r\n                cls: \"bg_glasstria\",\r\n                width: 771,\r\n                height: 635,\r\n                translateX: 510,\r\n                translateY: 163\r\n            }\r\n        },\r\n        _TYPE: 3,\r\n        resetState: false,\r\n        create: function (eventBus, $$container, option, data) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance._event = $.extend(true, [], this._Event);\r\n            instance.initEvent();\r\n            //事件绑定\r\n            instance.__base(eventBus, instance._event);\r\n\r\n            instance.__proxyAll(['onSurfaceMove', 'onLineMove', 'onLineTrans','onLightFocusBlur','nameVisibleHandler']);//绑定this指针\r\n            instance._$$container = $$container;\r\n            instance._config = $.extend(true, {}, this._CONFIG, (data && data.configData) || {});\r\n            instance._option = option;\r\n            instance.createView();\r\n            instance.afterCreateView();\r\n            instance.initExtrasDrawCommand();\r\n            instance.resetState = data && data.resetState? data.resetState: this.resetState;//是否可重置\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            //反射面\r\n            this._surface = Surface.create(this.__getEventBus(), this._config.Surface, this.onSurfaceMove, this._option.langData);\r\n\r\n            this._lightComplexArray = LightComplexArray.create(this.__getEventBus(), this._config.LightComplex, this._option, this.onLineMove, this.onLineTrans, this.onLightFocusBlur);\r\n            this._lightComplexArray.prependToView(this._$$container);\r\n\r\n            this._equalAngleName = EqualAngleName.create(this._option.langData);\r\n\r\n            /**\r\n             * 用于定位介质文字 多语言问题\r\n             */\r\n            var bgLeft = this._config.ForeignSurf.translateX, bgRight = bgLeft + this._config.ForeignSurf.width, bgTop = this._config.ForeignSurf.translateY, bgBottom = bgTop + this._config.ForeignSurf.height;\r\n\r\n            var langData = that._option.langData;\r\n            var airTextCon = langData.refraction_air || '空气';\r\n            var textCon = langData.refraction_prism || '三棱镜';\r\n\r\n            //空气\r\n            var airG = new kity.Group();\r\n\r\n            var airText =  new kity.Text().setContent(airTextCon).setAttr('x', 0).setAttr('y', 40).addClass(\"svg_text_l\").addClass(\"color_black\");\r\n            airG.addShape(airText);\r\n            this._$$container.prependItem(airG);\r\n            var airTextWidth = $(airText.node).width();\r\n            airG.setTranslate(1160 + 170 - airTextWidth,116);\r\n            //三棱镜背景\r\n            this._foreignSurf = new kity.Group();\r\n            var foreignline1 = new kity.Path(\"M 320 0 L 644 515 L0 515 Z\");\r\n            //var foreignline2 = new kity.Path(\"M 260 98 L 60 420\");\r\n           // var foreignline3 = new kity.Path(\"M 382 98 L 584 420\");\r\n            //var foreignline4 = new kity.Path(\"M120 515 L524 515\");\r\n            foreignline1.setStyle({\"stroke-width\": 4, \"stroke\": \"#898989\"});\r\n            //foreignline2.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            //foreignline3.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            //foreignline4.setStyle({\"stroke-width\": 4, \"stroke\": \"#2383cc\"});\r\n            var foreignBg = ForeignView.create(this._config.ForeignSurf.cls, this._config.ForeignSurf.width, this._config.ForeignSurf.height);\r\n            foreignBg.setTranslate(-34, -24);\r\n            this.lineG = new kity.Group();\r\n            this.lineG.addClass(\"hide_dom\");\r\n            this.lineG.addShape(foreignline1);\r\n            //this.lineG.addShape(foreignline2);\r\n            //this.lineG.addShape(foreignline3);\r\n            //this.lineG.addShape(foreignline4);\r\n            this._foreignSurf.addShape(this.lineG);\r\n            $(this._foreignSurf.node).prepend(foreignBg.getView());\r\n            var text = new kity.Text().setContent(textCon).addClass(\"svg_text_l\").addClass(\"color_glass\");\r\n            this._foreignSurf.addShape(text);\r\n            this._$$container.prependItem(this._foreignSurf);\r\n            var textWidth = $(text.node).width();\r\n            text.setAttr('x',200 + 128 - textWidth/2).setAttr('y', 498);\r\n\r\n            this._foreignSurf.setTranslate(this._config.ForeignSurf.translateX, this._config.ForeignSurf.translateY);\r\n\r\n            this._$$container.addShape(this._surface.getView());\r\n            this._$$container.addShape(this._equalAngleName.getView());\r\n            this._lightComplexArray.gtIndexAppendToView(this._$$container);\r\n            //this._surface.setTranslate(370, this._config.LightComplex[0].IncidencePosY);\r\n            this._surface.setTranslate(370, 412);\r\n            this._surface.setNameVisible(this._option.nameVisible);\r\n            if (this._config.EqualAngleName) {\r\n                that._equalAngleNameHasShowBefore = this._config.EqualAngleName.visible;\r\n                this._equalAngleName.setVisibility(this._config.EqualAngleName.visible);\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n            //this.resetAngle(this._config.Surface.defaultAngle, true);\r\n            this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree, true);\r\n\t    //从新初始化坐标位置\r\n            this.toCenter();\r\n            this.initEqualAngleNamePos();\r\n        }\r\n    });\r\n\r\n    Refractor.Extend = function (cls) {\r\n        return Object.create(Refractor).__include(cls);\r\n    };\r\n    return Refractor;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/refractor/refractor4', ['js/reflector/baseReflector', 'js/utils/utils', 'js/utils/graphMath', 'js/utils/svg', 'js/view/sector'], function (BaseReflector, Utils, GraphMath, Svg, Sector) {\r\n\r\n    //view\r\n    var Surface = require('js/view/surface');\r\n    var LightComplexArray = require('js/refractor/LightComplexArrayRef');\r\n    var EqualAngleName = require('js/view/EqualAngleName');\r\n    var ForeignView = require('js/view/ForeignView');\r\n    var EventKey = require('js/config/eventKey');\r\n\r\n    var Refractor = BaseReflector({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    //refractivity1: 3,\r\n                    //refractivity2: 4,\r\n                    IncidenceLine: {\r\n                        width: 425,//整体长度\r\n                        arrowPos: 200,//箭号所在位置\r\n                        defaultAngle: 312, rotateFixed: true, clickAble: false, rotateFixedAfterDraw: true\r\n                    },\r\n                    RefractionLine: {\r\n                        visible: false, rotateFixed: true, clickAble: false,\r\n                        width: 440,\r\n                        arrowPos: 170,\r\n                        PedalWidth: 290\r\n                    },\r\n                    NormalLine: {width: 460, lineVisible: false, pointNameVisible: false},\r\n                    InverseRefractionLine: {\r\n                        width: 200,\r\n                        defaultAngle: 333\r\n                    },\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, refractionVisible: false},\r\n                    IncidencePosX: 370,//入射点位置\r\n                    IncidencePosY: -60,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1, 3], [4, 5, 6], [7, 11, 8], [13], [14]],\r\n                    //PedalDrawIndex: [[0, 1], [5, 6], [10]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        //第一次设置\r\n                        //{aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 120, y: 435},{x: 1300, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true}\r\n                        //修改需求\r\n                        {aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 1420/2, y: 435},{x: 1420/2, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true, pedalLineAngle: 0}\r\n                        //{aPoint: {x: 0, y: 435 - 200}, bPoint: {x: 0, y: 396+435}, degree: 90, range: [{x: 0, y: 435},{x: 0, y: 396+435}], refractivity1: 1, refractivity2: 1.333, transAble: false},\r\n                        //{aPoint: {x: 1422, y: 435 - 200}, bPoint: {x: 1420, y: 435+396}, degree: 90, range: [{x: 1420, y: 435},{x: 1420, y: 435+396}], refractivity1: 1, refractivity2: 1.333, transAble: false}\r\n                    ],\r\n                    _curLineIndex: 0\r\n                },\r\n                {\r\n                    //refractivity1: 3,\r\n                    //refractivity2: 4,\r\n                    IncidenceLine: {\r\n                        width: 370,//整体长度\r\n                        arrowPos: 190,//箭号所在位置\r\n                        defaultAngle: 302, rotateFixed: true, clickAble: false, rotateFixedAfterDraw: true\r\n                    },\r\n                    RefractionLine: {\r\n                        visible: false, rotateFixed: true, clickAble: false,\r\n                        width: 440,\r\n                        arrowPos: 150,\r\n                        PedalWidth: 290\r\n                    },\r\n                    NormalLine: {width: 460, lineVisible: false, pointNameVisible: false},\r\n                    InverseRefractionLine: {\r\n                        width: 125,\r\n                        defaultAngle: 315\r\n                    },\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, refractionVisible: false},\r\n                    IncidencePosX: 280,//入射点位置\r\n                    IncidencePosY: -60,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1, 3], [4, 5, 6], [7, 11, 8], [13], [14]],\r\n                    //PedalDrawIndex: [[0, 1], [5, 6], [10]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        //第一次设置\r\n                        //{aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 120, y: 435},{x: 1300, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true}\r\n                        //修改需求\r\n                        {aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 1420/2, y: 435},{x: 1420/2, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true, pedalLineAngle: 0}\r\n                        //{aPoint: {x: 0, y: 435 - 200}, bPoint: {x: 0, y: 396+435}, degree: 90, range: [{x: 0, y: 435},{x: 0, y: 396+435}], refractivity1: 1, refractivity2: 1.333, transAble: false},\r\n                        //{aPoint: {x: 1422, y: 435 - 200}, bPoint: {x: 1420, y: 435+396}, degree: 90, range: [{x: 1420, y: 435},{x: 1420, y: 435+396}], refractivity1: 1, refractivity2: 1.333, transAble: false}\r\n                    ],\r\n                    _curLineIndex: 0\r\n                }\r\n            ],\r\n            Surface: {\r\n                width: 1420,\r\n                defaultAngle: 0,\r\n                rotatePosX: 1420 / 2,//旋转位置\r\n                rotatePosY: 4,//旋转位置\r\n                visible: false,\r\n                clickAble: true,\r\n                type: Surface.Type.tl\r\n            },\r\n            ForeignSurf: {\r\n                cls: \"bg_water\",\r\n                width: 1420,\r\n                height: 396,\r\n                translateX: 0,\r\n                translateY: 502\r\n            }\r\n        },\r\n        _TYPE: 4,\r\n        _Event: [],\r\n        _event: null,\r\n        _$$container: null,\r\n        _incidencePointPos: null,\r\n        _surfacePagePos: null,\r\n        _option: null,\r\n        _equalAngleNameHasShowBefore: false,\r\n        resetState: false,\r\n        MaterialObjectVisibility: false,\r\n\r\n        create: function (eventBus, $$container, option, data) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance._event = $.extend(true, [], this._Event);\r\n            instance.initEvent();\r\n            //事件绑定\r\n            instance.__base(eventBus, instance._event);\r\n\r\n            instance.__proxyAll(['onSurfaceMove', 'onLineMove', 'onLineTrans','onLightFocusBlur','nameVisibleHandler']);//绑定this指针\r\n            instance._$$container = $$container;\r\n            instance._config = $.extend(true, {}, this._CONFIG, (data && data.configData) || {});\r\n            instance._option = option;\r\n            instance.MaterialObjectVisibility = data && data.MaterialObjectVisibility? data.MaterialObjectVisibility: this.MaterialObjectVisibility;\r\n            instance.createView();\r\n            instance.afterCreateView();\r\n            instance.initExtrasDrawCommand();\r\n            instance.resetState = data && data.resetState? data.resetState: this.resetState;//是否可重置\r\n\r\n            return instance;\r\n        },\r\n        initEvent: function () {\r\n            //TODO:交由基类处理\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            //反射面\r\n            this._surface = Surface.create(this.__getEventBus(), this._config.Surface, this.onSurfaceMove, this._option.langData);\r\n\r\n            this._lightComplexArray = LightComplexArray.create(this.__getEventBus(), this._config.LightComplex, this._option, this.onLineMove, this.onLineTrans, this.onLightFocusBlur);\r\n            this._lightComplexArray.appendToView(this._$$container);\r\n\r\n            this._equalAngleName = EqualAngleName.create(this._option.langData);\r\n\r\n            /**\r\n             * 用于定位介质文字 多语言问题\r\n             */\r\n            var bgLeft = this._config.ForeignSurf.translateX, bgRight = bgLeft + this._config.ForeignSurf.width, bgTop = this._config.ForeignSurf.translateY, bgBottom = bgTop + this._config.ForeignSurf.height;\r\n\r\n            var langData = that._option.langData;\r\n            var airTextCon = langData.refraction_air || '空气';\r\n            var textCon = langData.refraction_water || '水';\r\n\r\n            var waterBgGroup = new kity.Group();\r\n            waterBgGroup.setId('waterBgGroup');\r\n            //水文字\r\n            var txtWater = new kity.Text(textCon);\r\n            txtWater.addClass('svg_text_l').addClass('color_white');\r\n            waterBgGroup.appendItem(txtWater);\r\n            //背景\r\n            var waterBg = ForeignView.create('bg_water', 1420, 396);\r\n            waterBg.setTranslate(0, -64);\r\n            $(waterBgGroup.node).prepend(waterBg.getView());\r\n            this._$$container.prependItem(waterBgGroup);\r\n            var textWidth = $(txtWater.node).width();\r\n            txtWater.setX(1254 + 85 - textWidth).setY(80);\r\n\r\n            waterBgGroup.setTranslate(-450, 2);\r\n\r\n            //空气字\r\n            var airGroup4 = new kity.Group();\r\n            airGroup4.setId('airGroup4');\r\n            var txtAir = new kity.Text(airTextCon);\r\n            txtAir.addClass('svg_text_l').addClass('color_black');\r\n            airGroup4.appendItem(txtAir);\r\n            this._$$container.addItem(airGroup4, 1);\r\n            var airTextWidth = $(txtAir.node).width();\r\n            airGroup4.setTranslate(774 + 170 - airTextWidth, -180);\r\n\r\n            //眼睛\r\n            var eyeGroup = new kity.Group();\r\n            eyeGroup.setId('eyeGroup');\r\n            eyeGroup.setTranslate(630, -350);\r\n            var eyeForeign = ForeignView.create('icon_eye', '64', '44');\r\n            $(eyeGroup.node).append(eyeForeign.getView());\r\n            this._$$container.addItem(eyeGroup, 2);\r\n            //实物\r\n            var materialObjectGroup4 = new kity.Group();\r\n            materialObjectGroup4.setId('materialObjectGroup4');\r\n            materialObjectGroup4.setTranslate(-8, 200);\r\n            var realFishGroup = new kity.Group();\r\n            realFishGroup.setId('realFishGroup');\r\n            var realFishForeign = ForeignView.create('real_fish', '90', '78');\r\n            $(realFishGroup.node).append(realFishForeign.getView());\r\n            materialObjectGroup4.addItem(realFishGroup);\r\n\r\n            var realGoldCoinGroup = new kity.Group();\r\n            realGoldCoinGroup.setId('realGoldCoinGroup');\r\n            realGoldCoinGroup.setStyle({'display': 'none'});\r\n            var realGoldCoinForeign = ForeignView.create('real_coin', '85', '82');\r\n            $(realGoldCoinGroup.node).append(realGoldCoinForeign.getView());\r\n            materialObjectGroup4.addItem(realGoldCoinGroup);\r\n\r\n            var realChopsticksGroup = new kity.Group();\r\n            realChopsticksGroup.setId('realChopsticksGroup');\r\n            realChopsticksGroup.setStyle({'display': 'none'});\r\n            realChopsticksGroup.setRotate(-102, 50, 5);\r\n            realChopsticksGroup.setTranslate(12, 0);\r\n            var realChopsticksForeign = ForeignView.create('real_chopsticks', '558', '27');\r\n            $(realChopsticksGroup.node).append(realChopsticksForeign.getView());\r\n            materialObjectGroup4.addItem(realChopsticksGroup);\r\n\r\n            var arrowButtonGroup4 = new kity.Group();\r\n            arrowButtonGroup4.setId('arrowButtonGroup4');\r\n            arrowButtonGroup4.setTranslate(-70, 18);\r\n            arrowButtonGroup4.setRotate(180, 28, 28);\r\n            var arrowButtonForeign = ForeignView.create('btn_openlist', '64', '64');\r\n            $(arrowButtonGroup4.node).append(arrowButtonForeign.getView());\r\n            materialObjectGroup4.addItem(arrowButtonGroup4);\r\n            this._$$container.addItem(materialObjectGroup4, 4);\r\n\r\n\r\n            //实物成像\r\n            var materialObjectImagingGroup4 = new kity.Group();\r\n            this.MaterialObjectImagingGroup = materialObjectImagingGroup4;\r\n\r\n            materialObjectImagingGroup4.setId('materialObjectImagingGroup4');\r\n            //materialObjectImagingGroup4.setStyle({'display': 'none'});\r\n            materialObjectImagingGroup4.setStyle({'display': this.MaterialObjectVisibility? 'inline-block':'none'});\r\n            materialObjectImagingGroup4.setTranslate(100, -20);\r\n            var imagingFishGroup = new kity.Group();\r\n            imagingFishGroup.setId('imagingFishGroup');\r\n            var imagingFishForeign = ForeignView.create('real_fish', '90', '78');\r\n            $(imagingFishGroup.node).append(imagingFishForeign.getView());\r\n            imagingFishGroup.addClass('fake_fish');\r\n            materialObjectImagingGroup4.addItem(imagingFishGroup);\r\n\r\n            var imagingGoldCoinGroup = new kity.Group();\r\n            imagingGoldCoinGroup.setId('imagingGoldCoinGroup');\r\n            imagingGoldCoinGroup.setStyle({'display': 'none'});\r\n            var imagingGoldCoinForeign = ForeignView.create('real_coin', '85', '82');\r\n            $(imagingGoldCoinGroup.node).append(imagingGoldCoinForeign.getView());\r\n            imagingGoldCoinGroup.addClass('fake_coin');\r\n            materialObjectImagingGroup4.addItem(imagingGoldCoinGroup);\r\n\r\n            var imagingChopsticksGroup = new kity.Group();\r\n            imagingChopsticksGroup.setId('imagingChopsticksGroup');\r\n            imagingChopsticksGroup.setRotate(-154, 30, 23);\r\n            imagingChopsticksGroup.setTranslate(25, 0);\r\n            imagingChopsticksGroup.setStyle({'display': 'none'});\r\n            var imagingChopsticksForeign = ForeignView.create('real_chopsticks', '558', '27');\r\n            $(imagingChopsticksForeign.getView()).css({'width': 190, 'height': 27, 'overflow': 'hidden'});\r\n            imagingChopsticksForeign.setForeignWidth(190);\r\n            $(imagingChopsticksGroup.node).append(imagingChopsticksForeign.getView());\r\n            imagingChopsticksGroup.addClass('fake_chopsticks');\r\n            materialObjectImagingGroup4.addItem(imagingChopsticksGroup);\r\n            this._$$container.addItem(materialObjectImagingGroup4, 3);\r\n\r\n            this._$$container.addShape(this._surface.getView());\r\n            this._$$container.addShape(this._equalAngleName.getView());\r\n            this._lightComplexArray.gtIndexAppendToView(this._$$container);\r\n\r\n            this._surface.setTranslate(0, this._config.LightComplex[0].IncidencePosY);\r\n            this._surface.setNameVisible(this._option.nameVisible);\r\n            if (this._config.EqualAngleName) {\r\n                that._equalAngleNameHasShowBefore = this._config.EqualAngleName.visible;\r\n                this._equalAngleName.setVisibility(this._config.EqualAngleName.visible);\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n       //     this.resetAngle(this._config.Surface.defaultAngle, true);\r\n            this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree, true);\r\n\r\n            //从新初始化坐标位置\r\n            this.toCenter();\r\n           // this.initEqualAngleNamePos();\r\n            //对弹出窗口的操作\r\n            var $view = $(arrowButtonGroup4.node).parents('#Refraction');\r\n            $(arrowButtonGroup4.node).off('click');\r\n            $view.find('._refraction_tab_container4 ._tab_content li').removeClass('on');\r\n            $view.find('._refraction_tab_container4 ._tab_content li').first().addClass('on');\r\n            $(arrowButtonGroup4.node).click(function (e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                $view.find('._refraction_tab_container4').removeClass('hide_dom');\r\n                $view.find('#arrowButtonGroup4').hide();\r\n            });\r\n        },\r\n        initExtrasDrawCommand: function () {\r\n            //交由基类处理\r\n            //var that = this;\r\n            //var length = this._lightComplexArray.getCommandLength();\r\n            //this._lightComplexArray.pushDrawCommand(function (deffer) {\r\n            //    if (that._lightComplexArray.isPedal()) {\r\n            //        that._equalAngleNameHasShowBefore = true;\r\n            //        that._equalAngleName.setVisibility(true);\r\n            //    }\r\n            //    deffer.resolve();\r\n            //}, function () {\r\n            //    if (!that._lightComplexArray.isPedal()) {\r\n            //        return true;\r\n            //    }\r\n            //    if (!that._equalAngleName.isVisibilityHidden()) {\r\n            //        return true;\r\n            //    }\r\n            //    return that._equalAngleNameHasShowBefore;\r\n            //});\r\n            //var pedalIndex = $.extend(true, [], this._config.LightComplex[0].PedalDrawIndex);\r\n            //pedalIndex.splice(2, 0, length);\r\n            //this._lightComplexArray.setPedalDrawIndex(pedalIndex);\r\n        },\r\n        afterCreateView: function () {\r\n            //TODO:交由子类覆盖\r\n        },\r\n        initEqualAngleNamePos: function () {\r\n            //布局角度\r\n            var parentTranslate = this._$$container.getTransform().m;\r\n            var width = this._equalAngleName.getView().getWidth();\r\n            var height = this._equalAngleName.getView().getHeight();\r\n            this._equalAngleName.setTranslate(this._option.viewPortWidth - parentTranslate.e - width - 135, -( this._option.viewPortHeight - parentTranslate.f - height ) + 20);\r\n        },\r\n        toCenter: function () {\r\n            this._$$container.setTranslate(this._option.viewPortWidth / 2 - this.getWidth() / 2, this._option.viewPortHeight / 2 + 10);\r\n        },\r\n        resetAngle: function (angle, init) {\r\n            this._surface.rotate(angle);\r\n            var surfaceAngle = this._surface.getRotateAngle() || 0;\r\n            this._lightComplexArray.resetAngle(surfaceAngle, init);\r\n        },\r\n        getData: function () {\r\n            var data = {};\r\n            data.type = this._TYPE;\r\n            data.configData = this._lightComplexArray.getData();\r\n            data.configData.Surface = {\r\n                defaultAngle: this._surface.getRotateAngle(),\r\n                visible: !this._surface.isVisibilityHidden()\r\n            };\r\n            data.configData.EqualAngleName = {\r\n                visible: !this._equalAngleName.isVisibilityHidden()\r\n            };\r\n            data.resetState = this.resetState;\r\n            data.MaterialObjectVisibility = this._lightComplexArray.getHasdrawMaterialObjectImagingGroup4();\r\n            return data;\r\n        },\r\n        getMoveRotateAngle: function (data) {\r\n            var currentPos = data.currentPos;\r\n            var lastPos = data.lastPos;\r\n            return GraphMath.getRotateAngle(this._surface.getRotateOffsetPos(), lastPos, currentPos);\r\n        },\r\n        onSurfaceMove: function (data, eventType) {\r\n            if (eventType === 'move') {\r\n                var angle = this.getMoveRotateAngle(data);\r\n                if (this._lightComplexArray.rotateAble(angle)) {\r\n                    this.resetAngle(angle);\r\n                    this._lightComplexArray.around(this._surface.getRotateAngle(), this._config.Surface.rotatePosX);\r\n                }\r\n            } else if (eventType === 'aftermove') {\r\n                this._lightComplexArray.adsorptionPedal();\r\n            }\r\n            this.initEqualAngleVisibility();\r\n            this.resetState = true;\r\n        },\r\n        onLineMove: function (uuid, angle, curLineIndex) {\r\n            this.resetState = true;\r\n            this.initEqualAngleVisibility();\r\n            this.afterLineMove(curLineIndex);\r\n\r\n        },\r\n        onLineTrans: function (uuid, x, y, curLineIndex){\r\n            this.resetState = true;\r\n            this.afterLineMove(curLineIndex);\r\n\r\n        },\r\n        onLightFocusBlur: function(type){\r\n            if(this.lineG){\r\n                if(type == \"focus\"){\r\n                    this.lineG.removeClass(\"hide_dom\");\r\n                }else{\r\n                    this.lineG.addClass(\"hide_dom\");\r\n                }\r\n            }\r\n        },\r\n        afterLineMove: function (curLineIndex) {\r\n        },\r\n        initEqualAngleVisibility: function () {\r\n            //非垂足重置为不可见\r\n            if (this._lightComplexArray.isPedal()) {\r\n                if (this._equalAngleNameHasShowBefore || this._lightComplexArray.get(0).getTwoLineVisible()) {\r\n                    this._equalAngleName.setVisibility(true);\r\n                }\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n        },\r\n        getWidth: function () {\r\n            return this._config.Surface.width;\r\n        },\r\n        drawAll: function () {\r\n            var that = this;\r\n            this.resetState = true;\r\n            this._lightComplexArray.drawAllAll(function(){\r\n                that.setNamePos();\r\n            });\r\n        },\r\n        drawNext: function () {\r\n            var that = this;\r\n            this.resetState = true;\r\n            //this._lightComplexArray.drawNext();\r\n            this._lightComplexArray.drawAllNext(function(){\r\n                that.setNamePos();\r\n            });\r\n        },\r\n        toCenter: function () {\r\n            this._$$container.setTranslate(450, 500);\r\n        },\r\n        /**\r\n         * 重置name的位置\r\n         */\r\n        setNamePos: function(){\r\n            var that = this;\r\n            var lightComplex0 = that._lightComplexArray.get(0);\r\n            var lightComplex1 = that._lightComplexArray.get(1);\r\n            lightComplex0.setNamePosByType(Sector.Type.Incidence, -60, 120);\r\n            lightComplex1.setNamePosByType(Sector.Type.Incidence, -55, 120);\r\n            lightComplex0.setNamePosByType(Sector.Type.Refraction, 30, -80);\r\n            lightComplex1.setNamePosByType(Sector.Type.Refraction, 0, -90);\r\n        },\r\n        /**\r\n         * 虚拟像是否显示\r\n         */\r\n        setMaterialObjectVisibility: function(visible){\r\n            this.MaterialObjectImagingGroup.setStyle({'display': visible? 'inline-block':'none'});\r\n        },\r\n        setResetState: function(state){\r\n            this.resetState = state;\r\n        }\r\n\r\n    });\r\n\r\n    Refractor.Extend = function (cls) {\r\n        return Object.create(Refractor).__include(cls);\r\n    };\r\n    return Refractor;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/refractor/refractor5', ['js/refractor/refractor4', 'js/utils/utils', 'js/utils/graphMath', 'js/utils/svg', 'js/view/sector'], function (Refractor6, Utils, GraphMath, Svg, Sector) {\r\n\r\n    //view\r\n    var Surface = require('js/view/surface');\r\n    var LightComplexArray = require('js/refractor/LightComplexArrayRef');\r\n    var EqualAngleName = require('js/view/EqualAngleName');\r\n    var ForeignView = require('js/view/ForeignView');\r\n    var EventKey = require('js/config/eventKey');\r\n\r\n    var Refractor = Refractor6.Extend({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    //refractivity1: 3,\r\n                    //refractivity2: 4,\r\n                    IncidenceLine: {\r\n                        width: 145,//整体长度\r\n                        arrowPos: 50,//箭号所在位置\r\n                        defaultAngle: 135, rotateFixed: true, clickAble: false, rotateFixedAfterDraw: true\r\n                    },\r\n                    RefractionLine: {\r\n                        visible: false, rotateFixed: true, clickAble: false\r\n                    },\r\n                    NormalLine: {width: 300, lineVisible: false, pointNameVisible: false},\r\n                    InverseRefractionLine: {\r\n                        width: 420,\r\n                        defaultAngle: 132\r\n                    },\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, refractionVisible: false},\r\n                    IncidencePosX: 550,//入射点位置\r\n                    IncidencePosY: 0,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1, 3], [4, 5, 6], [7, 11, 8], [13], [15]],\r\n                    //PedalDrawIndex: [[0, 1], [5, 6], [10]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        //第一次设置\r\n                        //{aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 120, y: 435},{x: 1300, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true}\r\n                        //修改需求\r\n                        {aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 1420/2, y: 435},{x: 1420/2, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true, pedalLineAngle: 0}\r\n                        //{aPoint: {x: 0, y: 435 - 200}, bPoint: {x: 0, y: 396+435}, degree: 90, range: [{x: 0, y: 435},{x: 0, y: 396+435}], refractivity1: 1, refractivity2: 1.333, transAble: false},\r\n                        //{aPoint: {x: 1422, y: 435 - 200}, bPoint: {x: 1420, y: 435+396}, degree: 90, range: [{x: 1420, y: 435},{x: 1420, y: 435+396}], refractivity1: 1, refractivity2: 1.333, transAble: false}\r\n                    ],\r\n                    _curLineIndex: 0\r\n                },\r\n                {\r\n                    //refractivity1: 3,\r\n                    //refractivity2: 4,\r\n                    IncidenceLine: {\r\n                        width: 225,//整体长度\r\n                        arrowPos: 100,//箭号所在位置\r\n                        defaultAngle: 153, rotateFixed: true, clickAble: false, rotateFixedAfterDraw: true\r\n                    },\r\n                    RefractionLine: {\r\n                        visible: false, rotateFixed: true, clickAble: false,\r\n                        width: 200\r\n                    },\r\n                    NormalLine: {width: 300, lineVisible: false, pointNameVisible: false},\r\n                    InverseRefractionLine: {\r\n                        width: 480,\r\n                        defaultAngle: 120\r\n                    },\r\n                    Sector: {sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, refractionVisible: false},\r\n                    IncidencePosX: 450,//入射点位置\r\n                    IncidencePosY: 0,\r\n                    //DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    DrawIndex: [[0, 1, 3], [4, 5, 6], [7, 11, 8], [13], [15]],\r\n                    //PedalDrawIndex: [[0, 1], [5, 6], [10]],\r\n                    PedalDrawIndex: [[1 ,5, 6,8, 10]],\r\n                    NoRefracDrawIndex:[],\r\n                    Visible: true,\r\n                    Lines: [\r\n                        //第一次设置\r\n                        //{aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 120, y: 435},{x: 1300, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true}\r\n                        //修改需求\r\n                        {aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 1420/2, y: 435},{x: 1420/2, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true, pedalLineAngle: 0}\r\n                        //{aPoint: {x: 0, y: 435 - 200}, bPoint: {x: 0, y: 396+435}, degree: 90, range: [{x: 0, y: 435},{x: 0, y: 396+435}], refractivity1: 1, refractivity2: 1.333, transAble: false},\r\n                        //{aPoint: {x: 1422, y: 435 - 200}, bPoint: {x: 1420, y: 435+396}, degree: 90, range: [{x: 1420, y: 435},{x: 1420, y: 435+396}], refractivity1: 1, refractivity2: 1.333, transAble: false}\r\n                    ],\r\n                    _curLineIndex: 0\r\n                }\r\n            ],\r\n            Surface: {\r\n                width: 1420,\r\n                defaultAngle: 0,\r\n                rotatePosX: 1420 / 2,//旋转位置\r\n                rotatePosY: 4,//旋转位置\r\n                visible: false,\r\n                clickAble: true,\r\n                type: Surface.Type.tl\r\n            },\r\n            ForeignSurf: {\r\n                cls: \"bg_water\",\r\n                width: 1520,\r\n                height: 396,\r\n                translateX: 0,\r\n                translateY: 502\r\n            }\r\n        },\r\n        _TYPE: 5,\r\n        _Event: [],\r\n        _event: null,\r\n        _$$container: null,\r\n        _incidencePointPos: null,\r\n        _surfacePagePos: null,\r\n        _option: null,\r\n        _equalAngleNameHasShowBefore: false,\r\n        resetState: false,\r\n        MaterialObjectVisibility: false,\r\n        create: function (eventBus, $$container, option, data) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance._event = $.extend(true, [], this._Event);\r\n            instance.initEvent();\r\n            //事件绑定\r\n            instance.__base(eventBus, instance._event);\r\n\r\n            instance.__proxyAll(['onSurfaceMove', 'onLineMove', 'onLineTrans','onLightFocusBlur','nameVisibleHandler']);//绑定this指针\r\n            instance._$$container = $$container;\r\n            instance._config = $.extend(true, {}, this._CONFIG, (data && data.configData) || {});\r\n            instance._option = option;\r\n            instance.MaterialObjectVisibility = data && data.MaterialObjectVisibility? data.MaterialObjectVisibility: this.MaterialObjectVisibility;\r\n            instance.createView();\r\n            instance.afterCreateView();\r\n            instance.initExtrasDrawCommand();\r\n            instance.resetState = data && data.resetState? data.resetState: this.resetState;//是否可重置\r\n            return instance;\r\n        },\r\n        initEvent: function () {\r\n            //TODO:交由基类处理\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            //反射面\r\n            this._surface = Surface.create(this.__getEventBus(), this._config.Surface, this.onSurfaceMove, this._option.langData);\r\n\r\n            this._lightComplexArray = LightComplexArray.create(this.__getEventBus(), this._config.LightComplex, this._option, this.onLineMove, this.onLineTrans, this.onLightFocusBlur);\r\n            this._lightComplexArray.appendToView(this._$$container);\r\n\r\n            this._equalAngleName = EqualAngleName.create(this._option.langData);\r\n\r\n            /**\r\n             * 用于定位介质文字 多语言问题\r\n             */\r\n            var bgLeft = this._config.ForeignSurf.translateX, bgRight = bgLeft + this._config.ForeignSurf.width, bgTop = this._config.ForeignSurf.translateY, bgBottom = bgTop + this._config.ForeignSurf.height;\r\n\r\n            var langData = that._option.langData;\r\n            var airTextCon = langData.refraction_air || '空气';\r\n            var textCon = langData.refraction_water || '水';\r\n            var waterGroup = new kity.Group();\r\n            waterGroup.setId('waterGroup');\r\n            //水文字\r\n            var txtWater = new kity.Text(textCon);\r\n            txtWater.addClass('svg_text_l').addClass('color_white');\r\n            waterGroup.appendItem(txtWater);\r\n            //背景\r\n            var waterBg = ForeignView.create('bg_waterground', 1520, 396);\r\n            waterBg.setTranslate(0, -64);\r\n            $(waterGroup.node).prepend(waterBg.getView());\r\n            this._$$container.prependItem(waterGroup);\r\n            waterGroup.setTranslate(-450, 2);\r\n\r\n            var textWidth = $(txtWater.node).width();\r\n            txtWater.setX(120).setY(190);\r\n\r\n            //空气字\r\n            var airGroup = new kity.Group();\r\n            airGroup.setId('airGroup');\r\n\r\n            var txtAir = new kity.Text(airTextCon);\r\n            txtAir.addClass('svg_text_l').addClass('color_black').setX(0).setY(40);\r\n            airGroup.appendItem(txtAir);\r\n            this._$$container.addItem(airGroup, 1);\r\n\r\n            var airTextWidth = $(txtAir.node).width();\r\n            airGroup.setTranslate(880 +170 - airTextWidth, -360);\r\n\r\n            //水里的眼睛\r\n            var eyeGroup = new kity.Group();\r\n            eyeGroup.setId('eyeGroup');\r\n            eyeGroup.setTranslate(306, 172);\r\n            var eyeForeign = ForeignView.create('icon_eye', '64', '44');\r\n            $(eyeGroup.node).append(eyeForeign.getView());\r\n            this._$$container.addItem(eyeGroup, 2);\r\n            //实物\r\n            var materialObjectGroup5 = new kity.Group();\r\n            materialObjectGroup5.setId('materialObjectGroup5');\r\n            materialObjectGroup5.setTranslate(378, -250);\r\n            var realTreeGroup = new kity.Group();\r\n            realTreeGroup.setId('realTreeGroup');\r\n            var realTreeForeign = ForeignView.create('real_tree', '383', '252');\r\n            $(realTreeGroup.node).append(realTreeForeign.getView());\r\n            materialObjectGroup5.addItem(realTreeGroup);\r\n\r\n            var realLightHouseGroup = new kity.Group();\r\n            realLightHouseGroup.setId('realLightHouseGroup');\r\n            realLightHouseGroup.setStyle({'display': 'none'});\r\n            var realLightHouseForeign = ForeignView.create('real_lighthouse', '383', '252');\r\n            $(realLightHouseGroup.node).append(realLightHouseForeign.getView());\r\n            materialObjectGroup5.addItem(realLightHouseGroup);\r\n\r\n            var realHumanGroup = new kity.Group();\r\n            realHumanGroup.setId('realHumanGroup');\r\n            realHumanGroup.setStyle({'display': 'none'});\r\n            var realHumanForeign = ForeignView.create('real_human', '383', '252');\r\n            $(realHumanGroup.node).append(realHumanForeign.getView());\r\n            materialObjectGroup5.addItem(realHumanGroup);\r\n\r\n            var arrowButtonGroup5 = new kity.Group();\r\n            arrowButtonGroup5.setId('arrowButtonGroup5');\r\n            arrowButtonGroup5.setTranslate(350, 180);\r\n            var arrowButtonForeign = ForeignView.create('btn_openlist', '64', '64');\r\n            $(arrowButtonGroup5.node).append(arrowButtonForeign.getView());\r\n            materialObjectGroup5.addItem(arrowButtonGroup5);\r\n            this._$$container.addItem(materialObjectGroup5, 3);\r\n\r\n            //实物成像\r\n            var materialObjectImagingGroup5 = new kity.Group();\r\n            this.MaterialObjectImagingGroup = materialObjectImagingGroup5;\r\n\r\n            materialObjectImagingGroup5.setId('materialObjectImagingGroup5');\r\n            //materialObjectImagingGroup5.setStyle({'display': 'none'});\r\n            materialObjectImagingGroup5.setStyle({'display': this.MaterialObjectVisibility? 'inline-block':'none'});\r\n            materialObjectImagingGroup5.setTranslate(500, -500);\r\n            var imagingTreeGroup = new kity.Group();\r\n            imagingTreeGroup.setId('imagingTreeGroup');\r\n            var imagingTreeForeign = ForeignView.create('real_tree', '383', '252');\r\n            $(imagingTreeGroup.node).append(imagingTreeForeign.getView());\r\n            imagingTreeGroup.addClass('fake_tree');\r\n            materialObjectImagingGroup5.addItem(imagingTreeGroup);\r\n\r\n            var imagingLightHouseGroup = new kity.Group();\r\n            imagingLightHouseGroup.setId('imagingLightHouseGroup');\r\n            imagingLightHouseGroup.setStyle({'display': 'none'});\r\n            var imagingLightHouseForeign = ForeignView.create('real_lighthouse', '383', '252');\r\n            $(imagingLightHouseGroup.node).append(imagingLightHouseForeign.getView());\r\n            imagingLightHouseGroup.addClass('fake_lighthouse');\r\n            materialObjectImagingGroup5.addItem(imagingLightHouseGroup);\r\n\r\n            var imagingHumanGroup = new kity.Group();\r\n            imagingHumanGroup.setId('imagingHumanGroup');\r\n            imagingHumanGroup.setStyle({'display': 'none'});\r\n            var imagingHumanForeign = ForeignView.create('real_human', '383', '252');\r\n            $(imagingHumanGroup.node).append(imagingHumanForeign.getView());\r\n            imagingHumanGroup.addClass('fake_human');\r\n            materialObjectImagingGroup5.addItem(imagingHumanGroup);\r\n            this._$$container.addShape(materialObjectImagingGroup5);\r\n\r\n            this._$$container.addShape(this._surface.getView());\r\n            this._$$container.addShape(this._equalAngleName.getView());\r\n            this._lightComplexArray.gtIndexAppendToView(this._$$container);\r\n\r\n            this._surface.setTranslate(0, this._config.LightComplex[0].IncidencePosY);\r\n            this._surface.setNameVisible(this._option.nameVisible);\r\n            if (this._config.EqualAngleName) {\r\n                that._equalAngleNameHasShowBefore = this._config.EqualAngleName.visible;\r\n                this._equalAngleName.setVisibility(this._config.EqualAngleName.visible);\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n       //     this.resetAngle(this._config.Surface.defaultAngle, true);\r\n            this.resetAngle(this._config.LightComplex[0].Lines[this._config.LightComplex[0]._curLineIndex].degree, true);\r\n\r\n            //从新初始化坐标位置\r\n            this.toCenter();\r\n          //  this.initEqualAngleNamePos();\r\n            //对弹出窗口的操作\r\n            var $view = $(arrowButtonGroup5.node).parents('#Refraction');\r\n            $(arrowButtonGroup5.node).off('click');\r\n            $view.find('._refraction_tab_container5 ._tab_content li').removeClass('on');\r\n            $view.find('._refraction_tab_container5 ._tab_content li').first().addClass('on');\r\n            $(arrowButtonGroup5.node).click(function (e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                $view.find('._refraction_tab_container5').removeClass('hide_dom');\r\n                $view.find('#arrowButtonGroup5').hide();\r\n            });\r\n        },\r\n        toCenter: function () {\r\n            this._$$container.setTranslate(380, 500);\r\n        },\r\n        getData: function () {\r\n            var data = {};\r\n            data.type = this._TYPE;\r\n            data.configData = this._lightComplexArray.getData();\r\n            data.configData.Surface = {\r\n                defaultAngle: this._surface.getRotateAngle(),\r\n                visible: !this._surface.isVisibilityHidden()\r\n            };\r\n            data.configData.EqualAngleName = {\r\n                visible: !this._equalAngleName.isVisibilityHidden()\r\n            };\r\n            data.resetState = this.resetState;\r\n            data.MaterialObjectVisibility = this._lightComplexArray.getHasdrawMaterialObjectImagingGroup5();\r\n            return data;\r\n        },\r\n        /**\r\n         * 重置name的位置\r\n         */\r\n        setNamePos: function(){\r\n            var that = this;\r\n            var lightComplex0 = that._lightComplexArray.get(0);\r\n            var lightComplex1 = that._lightComplexArray.get(1);\r\n            lightComplex0.setNamePosByType(Sector.Type.Incidence, 5, -80);\r\n            lightComplex1.setNamePosByType(Sector.Type.Incidence, 15, -80);\r\n            lightComplex0.setNamePosByType(Sector.Type.Refraction, -55, 130);\r\n            lightComplex1.setNamePosByType(Sector.Type.Refraction, -90, 130);\r\n        }\r\n    });\r\n\r\n    Refractor.Extend = function (cls) {\r\n        return Object.create(Refractor).__include(cls);\r\n    };\r\n    return Refractor;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/5.\r\n */\r\ndefine('js/refractor/refractorFactory', ['js/base/base', 'js/refractor/refractor1', 'js/refractor/refractor2', 'js/refractor/refractor3', 'js/refractor/refractor4', 'js/refractor/refractor5'], function (Base, Refractor1, Refractor2, Refractor3, Refractor4, Refractor5) {\r\n\r\n    var RefractorFactory = {\r\n        getRefractor: function (type, eventBus, $$container, option, data) {\r\n            if (type === 1) {\r\n                return Refractor1.create(eventBus, $$container, option, data);\r\n            }else if (type === 2) {\r\n                return Refractor2.create(eventBus, $$container, option, data);\r\n            }else if (type === 3) {\r\n                return Refractor3.create(eventBus, $$container, option, data);\r\n            }else if (type === 4) {\r\n                return Refractor4.create(eventBus, $$container, option, data);\r\n            }else if (type === 5) {\r\n                return Refractor5.create(eventBus, $$container, option, data);\r\n            }\r\n            //var Refractor = Refractor + type;\r\n            //return Refractor.create(eventBus, $$container, option, data);\r\n        }\r\n    };\r\n\r\n\r\n    return RefractorFactory;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/refractor/refractorMain', ['js/base/Base', 'js/utils/eventBus', 'js/utils/string', 'js/utils/utils', 'js/config/eventKey', 'js/refractor/refractorFactory', 'js/utils/view'], function (Base, EventBus, String, Utils, EventKey, RefractorFactory, View) {\r\n\r\n    var DomEvent = require('js/reflector/domEvent');\r\n    var Btn = require('js/refractor/btn');\r\n    var Lang = require('js/config/lang');\r\n\r\n    var VERSION = '1.0.0';\r\n\r\n    var _templateHtml = '<div class=\"${cls}\" id=\"${id}\"></div>';\r\n\r\n    var ViewPort = {\r\n        x: 0,\r\n        y: 0,\r\n        width: 1420,\r\n        height: 900\r\n    };\r\n\r\n    var OPTION = {\r\n        create: function (option) {\r\n            var instance = Object.create(this);\r\n            for (var key in option) {\r\n                if (key === 'langData') {\r\n                    instance[key] = $.extend(true, {}, Lang, option.langData);\r\n                } else {\r\n                    instance[key] = option[key];\r\n                }\r\n            }\r\n            return instance;\r\n        },\r\n        viewPortWidth: ViewPort.width,\r\n        viewPortHeight: ViewPort.height,\r\n        refractorType: [1, 2, 3, 4, 5],\r\n        nameVisible: true,\r\n        surfaceAngleVisible: true,\r\n        normalAngleVisible: true,\r\n        reflector5NameEnable: false,//默认不显示预设五的名称\r\n        lock: false,//是否锁定\r\n        langData: Lang//默认中文\r\n    };\r\n\r\n\r\n    var RefractorMain = Base({\r\n        _$$paper: null,\r\n        _$$paperItems: [],\r\n        _refractors: [],\r\n        _currentIndex: 0,\r\n        _id: null,\r\n        _init: false,\r\n        create: function (option) {\r\n            var eventBus = EventBus.create();\r\n            var instance = Object.create(this);\r\n            //创建配置\r\n            instance._option = OPTION.create(option);\r\n            instance._id = Utils.getUuid();\r\n            instance._$$paper = [];\r\n            instance._$$paperItems = [];\r\n            instance._refractors = [];\r\n            instance.__base(eventBus, []);\r\n            instance.__on('insidechange', function (p) {\r\n                if (instance._init) {\r\n                    instance.__triggerEvent('change', p);\r\n                }\r\n            });\r\n            return instance;\r\n        },\r\n        render: function (obj) {\r\n            this._init = false;\r\n            var type = typeof  obj;\r\n            if (type === 'string') {\r\n                obj = document.getElementById(obj);\r\n            } else if (type === 'object') {\r\n                if (obj instanceof jQuery) {\r\n                    obj = obj[0];\r\n                }\r\n            }\r\n            var $mainHtml = $(String.template(_templateHtml, {cls: 'fm', id: this._id}));\r\n            $(obj).html($mainHtml);\r\n            this._paper = new kity.Paper($mainHtml[0]);\r\n            this._paper.setViewBox(0, 0, this._option.viewPortWidth, this._option.viewPortHeight);\r\n            //绑定事件\r\n            var domEvent = DomEvent.create(this._paper, this.__getEventBus(), this._option);\r\n            domEvent.bindDomEvent();\r\n            this.createRefractor();\r\n            //this.show((this._data && this._data.currentIndex) || this._currentIndex);\r\n            this._init = true;\r\n            this._btn=Btn.create(this.__getEventBus(),this);\r\n            this.__triggerEvent('insidechange', 'init');\r\n        },\r\n        _createRefractor: function (index, type, data) {\r\n            var that = this;\r\n            var $$item = new kity.Group().setId('item_' + index);\r\n            $$item.setAttr('class', '_lr_item');\r\n            that._$$paperItems.push($$item);\r\n            that._paper.addShape($$item);\r\n            //add reflector\r\n            var refractor = RefractorFactory.getRefractor(type, that.__getEventBus(), $$item, that._option, data);\r\n            if (refractor) {\r\n                refractor.afterInit();\r\n            }\r\n            View.setVisibility($$item, index === that._currentIndex);\r\n            that._refractors.push(refractor);\r\n            return refractor;\r\n        },\r\n        createRefractor: function () {\r\n            var that = this;\r\n\r\n            this._refractors = [];\r\n            this._$$paperItems = [];\r\n\r\n            var __create = function (index, type, data) {\r\n                var $$item = new kity.Group().setId('item_' + index);\r\n                $$item.setAttr('class', '_lr_item');\r\n                that._$$paperItems.push($$item);\r\n                that._paper.addShape($$item);\r\n                //add reflector\r\n                var refractor = RefractorFactory.getRefractor(type, that.__getEventBus(), $$item, that._option, data);\r\n                View.setVisibility($$item, index === that._currentIndex);\r\n                that._refractors.push(refractor);\r\n                return refractor;\r\n            };\r\n\r\n            if (this._data && this._data.data && this._data.data.length > 0) {\r\n                var data = this._data.data;\r\n                this._currentIndex = this._data.currentIndex;\r\n                var refractor4, refractor5;\r\n                for (var i = 0; i < data.length; i++) {\r\n                    var refractorData = data[i];\r\n                    var refractor = __create(i, refractorData.type, refractorData);\r\n                    //refractor.renderData(refractorData);\r\n                    /**\r\n                     * 重置name的位置\r\n                     */\r\n                    if(refractorData.type == 4){\r\n                        refractor4 = refractor;\r\n                    }\r\n                    if(refractorData.type == 5){\r\n                        refractor5 = refractor;\r\n                    }\r\n                }\r\n                this.setNormalAngleVisible(this._data.option.normalAngleVisible);\r\n                this.setSurfaceAngleVisible(this._data.option.surfaceAngleVisible);\r\n                this.setNameVisible(this._data.option.nameVisible);\r\n                /**\r\n                 * 重置name的位置\r\n                 */\r\n                refractor4 && refractor4.setNamePos();\r\n                refractor5 && refractor5.setNamePos();\r\n\r\n            } else {\r\n                for (var i = 0; i < this._option.refractorType.length; i++) {\r\n                    var type = this._option.refractorType[i];\r\n                    __create(i, type);\r\n                }\r\n            }\r\n        },\r\n        setData: function (data) {\r\n            if (!data.version || !data.data) {\r\n                return;\r\n            }\r\n            this._data = data;\r\n        },\r\n        getData: function () {\r\n            var data = {};\r\n            data.version = VERSION;\r\n            data.data = [];\r\n            data.currentIndex = this._currentIndex;\r\n            this._refractors.forEach(function (refractor) {\r\n                if (refractor) {\r\n                    data.data.push(refractor.getData());\r\n                }\r\n            });\r\n            data.option = {\r\n                nameVisible: this._option.nameVisible,\r\n                surfaceAngleVisible: this._option.surfaceAngleVisible,\r\n                normalAngleVisible: this._option.normalAngleVisible\r\n            };\r\n            return data;\r\n        },\r\n        /**\r\n         * 目前支持 change、\r\n         * @param type\r\n         * @param callback\r\n         * @param domain\r\n         */\r\n        on: function (type, callback, domain) {\r\n            this.__getEventBus().on(type, callback, domain);\r\n        },\r\n        off: function (type, callback, domain) {\r\n            this.__getEventBus().off(type, callback, domain);\r\n        },\r\n        show: function (index) {\r\n             this.__triggerEvent(EventKey.Blur);\r\n            this._currentIndex = index;\r\n            this._$$paperItems.forEach(function ($$item, i) {\r\n                View.setVisibility($$item, index === i);\r\n            });\r\n            this.__triggerEvent('insidechange', 'showChange');\r\n        },\r\n        getCurrentIndex:function(){\r\n            return this._currentIndex;\r\n        },\r\n        //反射面角度\r\n        setSurfaceAngleVisible: function (visible) {\r\n            this._option.surfaceAngleVisible = visible;\r\n            this.__triggerEvent(EventKey.SurfaceAngleVisible, visible);\r\n        },\r\n        getSurfaceAngleVisible: function () {\r\n            return this._option.surfaceAngleVisible;\r\n        },\r\n        //与发现夹角\r\n        setNormalAngleVisible: function (visible) {\r\n            this._option.normalAngleVisible = visible;\r\n            this.__triggerEvent(EventKey.NormalAngleVisible, visible);\r\n            //this._refractors[3].setNormalAngleVisible(visible);\r\n            //this._refractors[4].setNormalAngleVisible(visible);\r\n            this._refractors[3].setNamePos();\r\n            this._refractors[4].setNamePos();\r\n        },\r\n        getNormalAngleVisible: function () {\r\n            return this._option.normalAngleVisible;\r\n        },\r\n        //名称\r\n        setNameVisible: function (visible) {\r\n            this._option.nameVisible = visible;\r\n            this.__triggerEvent(EventKey.NameVisible, visible);\r\n            //this._refractors[3].setNameVisible(false);\r\n            //this._refractors[4].setNameVisible(false);\r\n            this._refractors[3].setNamePos();\r\n            this._refractors[4].setNamePos();\r\n        },\r\n        //名称是否显示\r\n        getNameVisible: function () {\r\n            return this._option.nameVisible;\r\n        },\r\n        getCurrentRefractor: function () {\r\n            return this._refractors[this._currentIndex];\r\n        },\r\n        //一步画\r\n        drawAll: function () {\r\n            this.__triggerEvent(EventKey.Blur);\r\n            this.getCurrentRefractor().drawAll();\r\n        },\r\n        //逐步画\r\n        drawNext: function () {\r\n            this.__triggerEvent(EventKey.Blur);\r\n            this.getCurrentRefractor().drawNext();\r\n        },\r\n        //是否有下一步\r\n        hasNext: function () {\r\n            return this.getCurrentRefractor().hasNext();\r\n        },\r\n        reset: function (option) {\r\n            $.extend(this._option, option);\r\n\r\n            this._$$paperItems[this._currentIndex].clear();\r\n            //var $$item = this._$$paperItems[this._currentIndex] = new kity.Group().setId('item_' + this._currentIndex);\r\n            //$$item.setAttr('class', '_lr_item');\r\n            //this._paper.addShape($$item);\r\n            var refractor = RefractorFactory.getRefractor(this._refractors[this._currentIndex].getType(), this.__getEventBus(),  this._$$paperItems[this._currentIndex], this._option, {});\r\n            this._refractors[this._currentIndex] = refractor;\r\n            this.__triggerEvent('insidechange', 'reset');\r\n        },\r\n        getCurRefResetState: function(){\r\n            return this.getCurrentRefractor().resetState;\r\n        },\r\n        /**\r\n         * 设置某个场景的reset值\r\n         */\r\n        setCurRefResetState: function(state){\r\n            this.getCurrentRefractor().setResetState(state);\r\n            this.__triggerEvent('insidechange', 'reset');\r\n        },\r\n        getFirRefAngle: function(){ //获取第一模块的折射角\r\n            return this.getCurrentRefractor()._lightComplexArray.getFirRefAngle();\r\n        },\r\n        getFirIncidenceAngle: function(){ //获取第一模块的入射角角\r\n            return this.getCurrentRefractor()._lightComplexArray.getFirIncidenceAngle();\r\n        },\r\n        destroy: function () {\r\n\r\n        }\r\n    });\r\n\r\n\r\n    return RefractorMain;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/refractor/lightComplexRef/draw', ['js/view/sector', 'js/utils/utils', 'js/utils/view'], function (Sector, Utils, View) {\r\n\r\n    var LightComplexDraw = {\r\n        _hasDrawBegin: false,\r\n        _hasDrawNext: true,\r\n        setDrawBegin: function (hasDrawBegin) {\r\n            this._hasDrawBegin = hasDrawBegin;\r\n            //固定预设线，不可跟随旋转\r\n            if (this._configData.IncidenceLine.rotateFixedAfterDraw) {\r\n                this._configData.IncidenceLine.rotateFixed = true;\r\n            }\r\n            if (this._configData.RefractionLine.rotateFixedAfterDraw) {\r\n                this._configData.RefractionLine.rotateFixed = true;\r\n            }\r\n\r\n        },\r\n        getDrawBegin: function () {\r\n            return this._hasDrawBegin;\r\n        },\r\n        drawAll: function (cb) {\r\n            //隐藏状态下不能绘制\r\n            if (this.isVisibilityHidden()) {\r\n                return;\r\n            }\r\n            //设置所有扇面都绘制过\r\n\r\n            this.setSectorInsideDrawStatus(true);\r\n            this.setDrawBegin(true);\r\n            var that = this;\r\n            //if (!this._hasDrawNext) {\r\n            //    return;\r\n            //}\r\n            this._drawCommand.stop(function () {\r\n                that._drawCommand.drawAll(null, false);\r\n                //自动吸附90°\r\n                that.adsorptionPedal();\r\n                that.__triggerEvent('insidechange', 'drawAll');\r\n                cb && cb();\r\n            });\r\n            this._hasDrawNext = false;\r\n            //\r\n            //if(that._curRefAngle != \"no_refract\"){\r\n            //    //this.setRefractVisibility(true);\r\n            //    that.setRefractionPartVisibility(true);\r\n            //    that.setSectorVisibilityByType(Sector.Type.Incidence, true);\r\n            //}else if(that._curRefAngle == \"no_refract\"){\r\n            //    that.setRefractionPartVisibility(false);\r\n            //    //强制隐藏状态\r\n            //    that.getNameGroup().setHasDrawStatusByType(false,Sector.Type.Refraction);\r\n            //}\r\n        },\r\n        drawNext: function (cb) {\r\n            //隐藏状态下不能绘制\r\n            if (this.isVisibilityHidden()) {\r\n                return;\r\n            }\r\n            this.setDrawBegin(true);\r\n            var that = this;\r\n            //if (!this._hasDrawNext) {\r\n            //    return;\r\n            //}\r\n            this._drawCommand.drawNext(function () {\r\n                //绘制完后隐藏相应视图\r\n                that._hasDrawNext = that._drawCommand.hasNext();\r\n                //自动吸附90°\r\n                that.adsorptionPedal();\r\n                that.__triggerEvent('insidechange', 'drawNext');\r\n                cb && cb();\r\n            }, true);\r\n        },\r\n        hasNext: function () {\r\n            //隐藏状态下不能绘制\r\n            if (this.isVisibilityHidden()) {\r\n                return false;\r\n            }\r\n            //return this._hasDrawNext;\r\n            return this._drawCommand.hasNext();\r\n        },\r\n        hasNextWidthOutVisibilityStatus: function () {\r\n            return this._hasDrawNext;\r\n        },\r\n        initDrawCommand: function () {\r\n            var that = this;\r\n            that._hsdrawIncidencePoint = false;\r\n            that._hsdrawSectorRefraction = false;\r\n            that._hsDrawRefractionLine = false;\r\n            that._hsdrawInverseRefractionLine = false;\r\n            that._hsdrawMaterialObjectImagingGroup4 = false;\r\n            that._hsdrawMaterialObjectImagingGroup5 = false;\r\n            //0.入射点闪烁显示\r\n            this._drawCommand.push(function (deffer, animate) {\r\n\r\n                that._hsdrawIncidencePoint = true;\r\n                if (animate) {\r\n                    View.setVisibility(that._$$incidencePoint, true);\r\n                    $(that._$$incidencePoint.node).fadeIn(300).fadeOut(300).fadeIn(300, function () {\r\n                        View.setVisibility(that._$$incidencePoint, false);\r\n                        deffer.resolve();\r\n                    });\r\n                } else {\r\n                    deffer.resolve();\r\n                }\r\n            }, function () {\r\n                return that._hsdrawIncidencePoint;\r\n                //return !View.isVisibilityHidden(that._$$incidencePoint);\r\n            });\r\n\r\n            //1.入射点名称\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                that._normalLine.setPointNameVisibility(that._option.nameVisible, true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return that._normalLine.getPointNameVisible();\r\n            });\r\n\r\n            //2.入射于反射面扇面\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                if (that._option.surfaceAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.SurfaceIn, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.SurfaceIn);\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (that._option.surfaceAngleVisible === true && !that.isPedal()) {\r\n                    return !that._surfaceInSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n            //3.入射光线\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                that._incidenceLine.setVisibility(true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._incidenceLine.isVisibilityHidden();\r\n            });\r\n\r\n            //4.入射角\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                //扇面显示时才显示角度\r\n                if (that._option.normalAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.Incidence, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.Incidence);\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (that._option.normalAngleVisible === true && !that.isPedal() && Math.round(that.getSectorAngle(Sector.Type.Incidence)) != 90) {\r\n                    return !that._incidenceSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n            //5.法线\r\n            this._drawCommand.push(function (deffer) {\r\n                that._normalLine.setLineVisibility(that._option.nameVisible, true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return that._normalLine.getLineVisible();\r\n            });\r\n\r\n            //6.垂足符号\r\n            this._drawCommand.push(function (deffer) {\r\n                that._pedalLine.setVisibility(true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._pedalLine.isVisibilityHidden();\r\n            });\r\n\r\n\r\n            //7.折射角\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                //扇面显示时才显示角度\r\n                if (that._option.normalAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.Refraction, true);\r\n                }\r\n                that._hsdrawSectorRefraction = true;\r\n                if (that._curRefAngle == \"no_refract\") {\r\n\r\n                    that.setSectorVisibilityByType(Sector.Type.Refraction, false);\r\n                    //that.setRefractionPartVisibility(false);\r\n                }\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (that._option.normalAngleVisible === true && !that.isPedal()) {\r\n                    return !that._refractionSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n\r\n            //8.反射线\r\n            this._drawCommand.push(function (deffer) {\r\n                that._refractionLine.setVisibility(true);\r\n                that._hsDrawRefractionLine = true;\r\n               if(that._curRefAngle == \"no_refract\"){\r\n                  // that.setRefractionPartVisibility(false);\r\n                   that._refractionLine.setVisibility(false);\r\n                }\r\n                deffer.resolve();\r\n            }, function () {\r\n              //  return !that._refractionLine.isVisibilityHidden()\r\n                return that._hsDrawRefractionLine;\r\n            });\r\n\r\n            //9.反射线与反射面扇面\r\n            this._drawCommand.push(function (deffer) {\r\n                if (that._option.surfaceAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.SurfaceOut, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.SurfaceOut);\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (that._option.surfaceAngleVisible === true && !that.isPedal()&& Math.round(that.getSectorAngle(Sector.Type.Incidence)) != 90) {\r\n                    return !that._surfaceOutSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n\r\n            //10.显示垂足的入射光线、反射光线 和法线\r\n            this._drawCommand.push(function (deffer) {\r\n                that._incidenceLine.setVisibility(true);\r\n                if (that._option.normalAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.Incidence, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.Incidence);\r\n\r\n                that._refractionLine.setVisibility(true);\r\n                if (that._option.normalAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.Refraction, true);\r\n                }\r\n\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.Refraction);\r\n                that._hsdrawSectorRefraction = true;\r\n                that._pedalLine.setVisibility(true);\r\n                //that._incidenceLine.setWidth(that._configData.IncidenceLine.PedalWidth);\r\n                //that._incidenceLine.setArrowPos(that._configData.IncidenceLine.PedalArrowPos);\r\n                //that._refractionLine.setWidth(that._configData.RefractionLine.PedalWidth);\r\n                //that.resetLinePos();\r\n                //that._refractionLine.setArrowPos(that._configData.RefractionLine.PedalArrowPos);\r\n                //that.setSectorInsideDrawStatus(true, Sector.Type.Incidence);\r\n                //that.setSectorInsideDrawStatus(true, Sector.Type.Reflection);\r\n                //if (that._curRefAngle != \"no_refract\") {\r\n                    //this.setRefractVisibility(true);\r\n                    //that.setRefractionPartVisibility(true);\r\n                    //if(this._option.normalAngleVisible){\r\n                    //    that.setSectorVisibilityByType(Sector.Type.Incidence, true);\r\n                    //}\r\n                //} else if (that._curRefAngle == \"no_refract\") {\r\n                    //that.setRefractionPartVisibility(false);\r\n                    //强制隐藏状态\r\n                    //that.getNameGroup().setHasDrawStatusByType(false, Sector.Type.Refraction);\r\n                //}\r\n                that._hsdrawIncidencePoint=true;\r\n                that._hsDrawRefractionLine = true;\r\n                that._draw11=true;\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._refractionLine.isVisibilityHidden() && !that._incidenceLine.isVisibilityHidden();\r\n            });\r\n            that._draw11 = false;\r\n            //11.入射角、反射镜闪烁隐藏\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                that._draw11 = true;\r\n                //扇面显示时才显示角度\r\n                if (that._option.normalAngleVisible === false && animate) {\r\n                    that.sectorAnimateDisappear(function () {\r\n                        deffer.resolve();\r\n                    });\r\n                } else {\r\n                    deffer.resolve();\r\n                }\r\n            }, function () {\r\n                return !!that._draw11;\r\n            });\r\n            //12.入射角=反射角=0°\r\n            this._drawCommand.push(function (deffer) {\r\n                //TODO:\r\n                deffer.resolve();\r\n            }, function () {\r\n                //TODO:\r\n                return true;\r\n            });\r\n            //13.反射折射线InverseRefractionLine\r\n            this._drawCommand.push(function (deffer) {\r\n                that._hsdrawInverseRefractionLine = true;\r\n                that._inverseRefractionLine.setLineVisibility(false, true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                //return that._inverseRefractionLine.getLineVisible();\r\n                return that._hsdrawInverseRefractionLine;\r\n            });\r\n            //14.场景4显示虚拟成像\r\n            this._drawCommand.push(function (deffer) {\r\n                that._hsdrawMaterialObjectImagingGroup4 = true;\r\n                $('#materialObjectImagingGroup4').show();\r\n                deffer.resolve();\r\n            }, function () {\r\n                //return $('#materialObjectImagingGroup4').css('display') != 'none';\r\n                return that._hsdrawMaterialObjectImagingGroup4;\r\n            });\r\n            //15.场景5显示虚拟成像\r\n            this._drawCommand.push(function (deffer) {\r\n                that._hsdrawMaterialObjectImagingGroup5 = true;\r\n                $('#materialObjectImagingGroup5').show();\r\n                deffer.resolve();\r\n            }, function () {\r\n              //  return $('#materialObjectImagingGroup5').css('display') != 'none';\r\n                return that._hsdrawMaterialObjectImagingGroup5;\r\n            });\r\n\r\n            //初始化绘制状态\r\n            this.initDrawStatus();\r\n        },\r\n        getCommandLength: function () {\r\n            return this._drawCommand.getCommandLength();\r\n        },\r\n        pushDrawCommand: function (command, hasDrawFuns) {\r\n            this._drawCommand.push(command, hasDrawFuns);\r\n        },\r\n        setDrawIndex: function (drawIndex) {\r\n            this._configData.DrawIndex = drawIndex;\r\n            if (!this.isPedal()) {\r\n                this._drawCommand.setDrawIndex(drawIndex);\r\n            }\r\n        },\r\n        setPedalDrawIndex: function (pedalDrawIndex) {\r\n            this._configData.PedalDrawIndex = pedalDrawIndex;\r\n            if (this.isPedal()) {\r\n                this._drawCommand.setDrawIndex(pedalDrawIndex);\r\n            }\r\n        },\r\n        //显示预设4的垂足入射、反射线\r\n        setIncidenceShortPedalView: function (width) {\r\n            this._incidenceLine.setVisibility(true);\r\n            this._refractionLine.setVisibility(true);\r\n\r\n            this._incidenceLine.setWidth(width || this._configData.IncidenceLine.PedalWidth);\r\n            if (width === this._configData.IncidenceLine.PedalWidth) {\r\n                this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos);\r\n            }\r\n            this._refractionLine.setWidth(this._configData.RefractionLine.PedalWidth);\r\n            this._refractionLine.setArrowPos(this._configData.RefractionLine.PedalArrowPos);\r\n            this.resetLinePos();\r\n        },\r\n        isDrawIncidenceShortPedalView: function (width) {\r\n            return !this._refractionLine.isVisibilityHidden() && !this._incidenceLine.isVisibilityHidden() && (this._incidenceLine.getWidth() === (width || this._configData.IncidenceLine.PedalWidth));\r\n        },\r\n        getHasDrawIncidencePoint: function () {\r\n            return this._hsdrawIncidencePoint;\r\n        },\r\n        getHasDrawSectorAnimateDisappear: function () {\r\n            return this._draw11;\r\n        },\r\n        getHasDrawSectorRefraction: function(){\r\n            return this._hsdrawSectorRefraction;\r\n        },\r\n        getHasDrawRefractionLine: function(){\r\n            return this._hsDrawRefractionLine;\r\n        },\r\n        getHasdrawInverseRefractionLine: function(){\r\n            return this._hsdrawInverseRefractionLine;\r\n        },\r\n        getHasdrawMaterialObjectImagingGroup4: function(){\r\n            return this._hsdrawMaterialObjectImagingGroup4;\r\n        },\r\n        getHasdrawMaterialObjectImagingGroup5: function(){\r\n            return this._hsdrawMaterialObjectImagingGroup5;\r\n        },\r\n        //getHasPedalLineDraw:function(){},\r\n        initDrawStatus: function () {\r\n            var draw = this._configData.Draw;\r\n            if (draw) {\r\n                this._hsdrawIncidencePoint = draw.incidencePoint;\r\n                this._draw11 = draw.sectorAnimateDisappear;\r\n                this._hsdrawSectorRefraction = draw.sectorRefraction;\r\n                this._hsDrawRefractionLine = draw.refractionLine;\r\n                this._hsdrawInverseRefractionLine = draw.inverserefractionline;\r\n                this._hsdrawMaterialObjectImagingGroup4 = draw.materialObjectImagingGroup4;\r\n                this._hsdrawMaterialObjectImagingGroup5 = draw.materialObjectImagingGroup5;\r\n                if (typeof draw.hasNext !== typeof  undefined) {\r\n                    this._hasDrawNext = draw.hasNext;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return LightComplexDraw;\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/refractor/lightComplexRef/event', ['js/view/sector'], function (Sector) {\r\n\r\n    var LightComplexEvent = {\r\n        surfaceAngleVisibleHandler: function (visible) {\r\n            this.setSectorVisibilityByOutSideLogic(Sector.Type.SurfaceIn, visible);\r\n            this.setSectorVisibilityByOutSideLogic(Sector.Type.SurfaceOut, visible);\r\n        },\r\n        normalAngleVisibleHandler: function (visible) {\r\n            this.setSectorVisibilityByOutSideLogic(Sector.Type.Incidence, visible);\r\n            if(this._curRefAngle != \"no_refract\"){ //折射角这时候不控制\r\n                this.setSectorVisibilityByOutSideLogic(Sector.Type.Refraction, visible);\r\n            }\r\n\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this._incidenceLine.setNameVisible(visible);\r\n            this._refractionLine.setNameVisible(visible);\r\n            this.getNameGroup().setNameVisible(visible);\r\n            this._normalLine.setNameVisible(visible);\r\n        },\r\n        nameVisibleHandler: function (visible) {\r\n            this.setNameVisible(visible);\r\n        }\r\n\r\n    };\r\n\r\n    return LightComplexEvent;\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/refractor/lightComplexRef/main', ['js/reflector/baseReflector', 'js/utils/utils', 'js/utils/graphMath', 'js/config/style', 'js/config/eventKey', 'js/utils/view', 'js/utils/svg'], function (BaseReflector, Utils, GraphMath, Style, EventKey, View, Svg) {\r\n\r\n    //view\r\n    var BaseView = require('js/view/BaseView');\r\n    var Sector = require('js/view/sector');\r\n    var LightLine = require('js/view/LightLine');\r\n    var NormalLine = require('js/view/NormalLine');\r\n    var InverseRefractionLine = require('js/view/InverseRefractionLine');\r\n    var NameGroup = require('js/view/NameGroup');\r\n    var PedalLine = require('js/view/PedalLine');\r\n    var DrawCommand = require('js/utils/DrawCommand');\r\n\r\n    //var MinAngle = 5;\r\n\r\n    var IncidencePointStyle = Style.IncidencePoint;\r\n\r\n\r\n    var Config = {\r\n        onLightMove: null,\r\n        onLightTrans: null,\r\n        IncidenceLine: {\r\n            width: 250,//整体长度\r\n            arrowPos: 145,//箭号所在位置\r\n            defaultAngle: 50,//默认角度\r\n            visible: true,//是否显示\r\n            clickAble: true,//是否允许点击和移动\r\n            rotateFixed: true,//是否旋转时，固定不动\r\n            PedalWidth: 250,//垂足显示时的长度\r\n            PedalArrowPos: 150,//垂足显示时箭头位置\r\n            rotateFixedAfterDraw: false,//一步完成、或逐步画开始后，不跟随反射面移动而移动\r\n            highLineZIndex: false,//反射和入射线中是否层级更高\r\n            nameEnable: true,//是否需要名称支持\r\n            arrowVisible: true//是否显示箭头\r\n        },\r\n        RefractionLine: {\r\n            width: 250,\r\n            arrowPos: 73,\r\n            visible: true,\r\n            clickAble: true,\r\n            rotateFixed: false,\r\n            PedalWidth: 250,//垂足显示时的长度\r\n            PedalArrowPos: 150,//垂足显示时箭头位置\r\n            rotateFixedAfterDraw: false,\r\n            nameEnable: true,\r\n            arrowVisible: true\r\n        },\r\n        NormalLine: {\r\n            width: 470,\r\n            lineVisible: false,\r\n            pointNameVisible: false,\r\n            visible: true\r\n        },\r\n        InverseRefractionLine: {\r\n            width: 310,\r\n            lineVisible: false,\r\n            pointNameVisible: false,\r\n            visible: true\r\n        },\r\n        Sector: {\r\n            sectorInVisible: false,\r\n            sectorOutVisible: false,\r\n            incidenceVisible: true,\r\n            refractionVisible: true,\r\n            incidenceR: 70,\r\n            refractionR: 70,\r\n            surfaceR: 60\r\n        },\r\n        IncidencePointVisible: false,\r\n        PedalLineVisible: false,\r\n        IncidencePosX: 0,//入射点位置\r\n        IncidencePosY: 0,//入射点位置\r\n        DrawIndex: [0, 1, 2, 3],//绘制动画内容和顺序\r\n        PedalDrawIndex: [[0, 1], [5, 6], [10]],//TODO:反射镜=入射角的还未处理//绘制动画内容和顺序\r\n        NoRefracDrawIndex: [[0, 1, 3], [4, 5, 6]],\r\n        Visible: true,\r\n        view90PedalLineVisible: true,//处理垂足时候显示垂足符号\r\n        nameEventEnable: true,//名称显示事件支持\r\n        Lines: [\r\n            //第一次设置\r\n            //{aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 120, y: 435},{x: 1300, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true}\r\n            //修改需求\r\n            {aPoint: {x: 0, y: 435}, bPoint: {x: 1420, y: 435}, degree: 0, range: [{x: 1420/2, y: 435},{x: 1420/2, y: 435}], refractivity1: 1, refractivity2: 1.333, transAble: true, pedalLineAngle: 90}\r\n            //{aPoint: {x: 0, y: 435 - 200}, bPoint: {x: 0, y: 396+435}, degree: 90, range: [{x: 0, y: 435},{x: 0, y: 396+435}], refractivity1: 1, refractivity2: 1.333, transAble: false},\r\n            //{aPoint: {x: 1422, y: 435 - 200}, bPoint: {x: 1420, y: 435+396}, degree: 90, range: [{x: 1420, y: 435},{x: 1420, y: 435+396}], refractivity1: 1, refractivity2: 1.333, transAble: false}\r\n        ],\r\n        //_TYPE: 1,\r\n        _curLineIndex: 0\r\n    };\r\n\r\n    var LightComplex = BaseView({\r\n        _data: null,\r\n        _configData: null,\r\n        _onLightMove: null,\r\n        _onLightTrans: null,\r\n        _onLightFocusBlur: null,\r\n        _option: null,\r\n        _linePedalChangeLock: false,\r\n        _hasDrawNext: true,//是否还有下一步\r\n        _surfaceLines: [],\r\n        _surfacelinesKb: [],\r\n        _curLineIndex: 0,\r\n        create: function (eventBus, configData, onLightMove, onLightTrans, onLightFocusBlur, option) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance._configData = $.extend(true, {}, Config, configData);\r\n            instance._configData.DrawIndex = $.extend(true, [], configData.DrawIndex || Config.DrawIndex);\r\n            instance._configData.PedalDrawIndex = $.extend(true, [], configData.PedalDrawIndex || Config.PedalDrawIndex);\r\n            instance._configData.NoRefracDrawIndex = $.extend(true, [], configData.NoRefracDrawIndex || Config.NoRefracDrawIndex);\r\n            //事件绑定\r\n            var eventsInfo = [];\r\n            eventsInfo.push({key: EventKey.SurfaceAngleVisible, callback: 'surfaceAngleVisibleHandler', params: []});\r\n            eventsInfo.push({key: EventKey.NormalAngleVisible, callback: 'normalAngleVisibleHandler', params: []});\r\n            if (instance._configData.nameEventEnable) {\r\n                eventsInfo.push({key: EventKey.NameVisible, callback: 'nameVisibleHandler', params: []});\r\n            }\r\n            eventsInfo.push({key: EventKey.ZIndexChange, callback: 'zIndexChangeHandler', params: []});\r\n            instance.__base(eventBus, eventsInfo);\r\n            instance.__proxyAll(['onLightMove', 'onLightTrans', 'onLightFocusBlur']);//绑定this指针\r\n\r\n            instance._surfacelinesKb = [];\r\n            instance._surfaceLines = [];\r\n            instance._sectorState = {\r\n                incidenceSector: false,\r\n                refractionSector: false\r\n            };\r\n            instance._option = option;\r\n            instance._onLightMove = onLightMove;\r\n            instance._onLightTrans = onLightTrans;\r\n            instance._onLightFocusBlur = onLightFocusBlur;\r\n            instance._drawCommand = DrawCommand.create();\r\n            instance._drawCommand.setDrawIndex(instance._configData.DrawIndex);\r\n            instance.createView();\r\n            instance.initVisibleState();\r\n            instance.initDrawCommand();\r\n            instance.initDomEvent();\r\n            instance._surfaceLines = instance._configData.Lines;\r\n            instance._curLineIndex = instance._configData._curLineIndex;\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            var configData = this._configData;\r\n            var appendPosX = 0;//内部偏移坐标\r\n            //夹角扇面和名称\r\n            this.createSector(appendPosX);\r\n            //反射、入射线\r\n            this._refractionLine = LightLine.create(this.__getEventBus(), LightLine.Type.RefractionLine, configData.RefractionLine, this.onLightMove, this.onLightTrans, this.onLightFocusBlur, this._option.langData);\r\n            this._incidenceLine = LightLine.create(this.__getEventBus(), LightLine.Type.IncidenceLine, configData.IncidenceLine, this.onLightMove, this.onLightTrans, this.onLightFocusBlur, this._option.langData);\r\n\r\n            //法线\r\n            this._normalLine = NormalLine.create(configData.NormalLine.width, this._option.langData);\r\n\r\n            //反向折射线\r\n            this._inverseRefractionLine = InverseRefractionLine.create(configData.InverseRefractionLine.width);\r\n\r\n            //垂足符号\r\n            this._pedalLine = PedalLine.create();\r\n\r\n            this.appendSector();\r\n\r\n            this.addShape(this._normalLine.getView());\r\n            this.addShape(this._inverseRefractionLine.getView());\r\n            if (configData.IncidenceLine.highLineZIndex) {\r\n                this.addShape(this._refractionLine.getView());\r\n                this.addShape(this._incidenceLine.getView());\r\n            } else {\r\n                this.addShape(this._incidenceLine.getView());\r\n\r\n                this.addShape(this._refractionLine.getView());\r\n            }\r\n\r\n            this.addShape(this._pedalLine.getView());\r\n\r\n            var translateX = -(Math.abs(appendPosX - configData.IncidenceLine.width));\r\n            var refractionTranslateX = -(Math.abs(appendPosX - configData.RefractionLine.width));\r\n            var translateY = -1;//向上偏移一个像素，防止底部突出\r\n            var normalTranslateX = -(Math.abs(appendPosX - configData.NormalLine.width));\r\n            var inverseRefractionTranslateX = -(Math.abs(appendPosX - configData.InverseRefractionLine.width));\r\n\r\n            this._incidenceLine.setTranslate(translateX, translateY);\r\n            this._incidenceLine.setRotate(configData.IncidenceLine.defaultAngle);\r\n            this._normalLine.setTranslate(normalTranslateX / 2, 1);\r\n            //this._inverseRefractionLine.setRotate(configData.InverseRefractionLine.defaultAngle);\r\n\r\n            this._refractionLine.setTranslate(refractionTranslateX, translateY);\r\n            this._inverseRefractionLine.setTranslate(inverseRefractionTranslateX, 0);\r\n\r\n            //定位到入射点\r\n            this.setTranslate(this._configData.IncidencePosX, this._configData.IncidencePosY);\r\n\r\n            //入射点\r\n            this._$$incidencePoint = new kity.Circle(IncidencePointStyle.width).fill(IncidencePointStyle.fill);\r\n            this._$$incidencePoint.setTranslate(this._configData.IncidencePosX, this._configData.IncidencePosY);\r\n\r\n            /*移动的线*/\r\n            this._surfaceLines = this._configData.Lines;\r\n            for (var i = 0; i < this._surfaceLines.length; i++) {\r\n                this._surfaceLines[i].degree = (this._surfaceLines[i].degree + 360) % 360;\r\n                this._surfacelinesKb[i] = GraphMath.getLineKb(this._surfaceLines[i].degree, this._surfaceLines[i].aPoint);\r\n            }\r\n            this._curLineIndex = this._configData._curLineIndex;\r\n        },\r\n        initVisibleState: function () {\r\n\r\n            var configData = this._configData;\r\n            this.initSectorVisibleState();\r\n            this.surfaceAngleVisibleHandler(this._option.surfaceAngleVisible);\r\n            this.normalAngleVisibleHandler(this._option.normalAngleVisible);\r\n            this.nameVisibleHandler(this._option.nameVisible);\r\n\r\n            this._normalLine.setVisibility(configData.NormalLine.visible);\r\n            this._pedalLine.setVisibility(configData.PedalLineVisible);\r\n            this._inverseRefractionLine.setLineVisibility(false, configData.InverseRefractionLine.lineVisible);\r\n\r\n            View.setVisibility(this._$$incidencePoint, configData.IncidencePointVisible);\r\n\r\n            this._normalLine.setPointNameVisibility(this._option.nameVisible, configData.NormalLine.pointNameVisible);\r\n            this._normalLine.setLineVisibility(this._option.nameVisible, configData.NormalLine.lineVisible);\r\n        },\r\n\r\n\r\n\r\n        gtIndexAppendToView: function ($$container) {\r\n            $$container.addShape(this._$$incidencePoint);\r\n            this.gtIndexSectorAppendToView($$container);\r\n            //this._incidenceLine.gtIndexBtnAppendToView($$container);\r\n        },\r\n        resetAngle: function (surfaceAngle, init) {\r\n            surfaceAngle = surfaceAngle < 0 ? (surfaceAngle + 360) % 360 : surfaceAngle % 360;\r\n            this._surfaceAngle = surfaceAngle;\r\n            this._surfaceAngle %= 360;\r\n\r\n            //var incidenceAngle = this._incidenceLine.getRotateAngle();\r\n            var incidenceAngleBac = this._incidenceLine.getRotateAngle() ? this._incidenceLine.getRotateAngle(): 0 ;\r\n            //console.log(\"incidenceAngleBac = \"+incidenceAngleBac);\r\n            var incidenceAngle = (incidenceAngleBac - surfaceAngle) > 360 ? (incidenceAngleBac % 360) : (incidenceAngleBac - surfaceAngle) < 0 ? incidenceAngleBac + 360 : incidenceAngleBac;\r\n            if (incidenceAngle <= (180 + this._surfaceLines[this._curLineIndex].degree)) {\r\n                this.refractivity = parseFloat(this._surfaceLines[this._curLineIndex].refractivity2 / this._surfaceLines[this._curLineIndex].refractivity1);\r\n            } else {\r\n                this.refractivity = parseFloat(this._surfaceLines[this._curLineIndex].refractivity1 / this._surfaceLines[this._curLineIndex].refractivity2);\r\n            }\r\n\r\n            var angle = [];\r\n            var negative = false;\r\n\r\n            var incidenceAngleAbs = incidenceAngle - surfaceAngle;\r\n            var startAngle = surfaceAngle;\r\n            var angle90 = 90 + surfaceAngle;\r\n            var angle180 = 180 + surfaceAngle;\r\n            var angle270 = 270 + surfaceAngle;\r\n            var angle540 = 540 + surfaceAngle;\r\n\r\n            this._incidenceLine.setRotate(incidenceAngle);\r\n            this._normalLine.setRotate(angle90, this._configData.NormalLine.width / 2, 0);\r\n            // this._normalLine.setTranslate(-this._configData.NormalLine.width/2, 0);\r\n\r\n            this._pedalLine.setRotate(this._surfaceLines[this._curLineIndex].pedalLineAngle);\r\n\r\n            //if(incidenceAngleAbs > 180){\r\n\r\n\r\n            //    this._pedalLine.setRotate(180+surfaceAngle);\r\n            //}\r\n\r\n            //以下为折射角大于90度是变成全反射的解决\r\n            var curRefAngle = GraphMath.getRefractAngle(incidenceAngleAbs, this.refractivity);\r\n            var normalAngle = this._normalLine.getRotateAngle();\r\n            //0°不显示折射\r\n            //精确到小数点后一位\r\n            if (Math.abs(Math.round(incidenceAngleBac - normalAngle)) === 90 || Math.abs(Math.round(incidenceAngleBac - normalAngle)) === 270) {\r\n                curRefAngle = 'no_refract';\r\n                incidenceAngle = Math.round(incidenceAngle);\r\n            }\r\n            //if (this.isPedal()){\r\n            //    incidenceAngle = Math.round(incidenceAngle);\r\n            //    curRefAngle = 0;\r\n            //}\r\n\r\n            var refractRotate;\r\n            if (curRefAngle !== \"no_refract\") {//折射角存在\r\n                //this._refractionLine.setVisibility(true);\r\n                //this._refractionSector.setVisibility(true);\r\n                //this._nameGroup.setNameAngleVisibleByType(Sector.Type.Refraction, true);\r\n                if (incidenceAngleAbs <= 90) {\r\n                    angle = [startAngle, incidenceAngle, angle90, angle270 - curRefAngle, angle270];\r\n                    refractRotate = angle[3];\r\n                } else if (incidenceAngleAbs > 90 && incidenceAngleAbs <= 180) {\r\n                    angle = [startAngle, angle90, incidenceAngle, angle270, angle270 + curRefAngle];\r\n                    refractRotate = angle[4];\r\n                } else if (incidenceAngleAbs > 180 && incidenceAngleAbs <= 270) {\r\n                    angle = [startAngle, incidenceAngle, angle270, angle90 - curRefAngle, angle90];\r\n                    refractRotate = angle[3];\r\n                } else if (incidenceAngleAbs > 270 && incidenceAngleAbs <= 360) {\r\n                    angle = [startAngle, angle270, incidenceAngle, angle90, angle90 + curRefAngle];\r\n                    refractRotate = angle[4];\r\n                }\r\n\r\n            } else { //折射角不存在\r\n                //this._refractionLine.setVisibility(false);\r\n                //this._refractionSector.setVisibility(false);\r\n                //this._nameGroup.setNameAngleVisibleByType(Sector.Type.Refraction, false);\r\n\r\n                if (incidenceAngleAbs <= 90) {\r\n                    angle = [startAngle, incidenceAngle, angle90, angle90, angle180 - incidenceAngleAbs];\r\n                    refractRotate = angle[4];\r\n                } else if (incidenceAngleAbs > 90 && incidenceAngleAbs <= 180) {\r\n                    angle = [startAngle, angle90, incidenceAngle, angle180 - incidenceAngleAbs, angle90];\r\n                    refractRotate = angle[3];\r\n                } else if (incidenceAngleAbs > 180 && incidenceAngleAbs <= 270) {\r\n                    angle = [startAngle, incidenceAngle, angle270, angle270, angle540 - incidenceAngleAbs];\r\n                    refractRotate = angle[4];\r\n                } else if (incidenceAngleAbs > 270 && incidenceAngleAbs <= 360) {\r\n                    angle = [startAngle, angle270, incidenceAngle, angle540 - incidenceAngleAbs, angle270];\r\n                    refractRotate = angle[3];\r\n                }\r\n            }\r\n\r\n            this._inverseRefractionLine.setRotate((refractRotate + 180) % 360);\r\n            this._curRefAngle = curRefAngle;\r\n\r\n            //围绕线底部，中心轴旋转\r\n            if (this._configData.IncidenceLine.rotateFixed) {\r\n                // this._reflectionLine.setRotate(holdAngle - (incidenceAngle - surfaceAngle));\r\n                this._refractionLine.setRotate(refractRotate);\r\n            }\r\n\r\n            //重置扇面角度相关\r\n            this.resetSectorAngle(this._normalLine.getRotateAngle(), negative, angle);\r\n\r\n            //设置动画内容\r\n            //this._drawCommand.setDrawIndex(this.isPedal() ? this._configData.PedalDrawIndex : this._configData.DrawIndex);\r\n            if (this.isPedal() && !this._incidenceLine.isVisibilityHidden()) {  //是垂直模式，并且入射线显示（判断第二模块也是垂直的情况，即场景2，不显示第二模块的垂足）\r\n                this._drawCommand.setDrawIndex(this._configData.PedalDrawIndex);\r\n                if (incidenceAngleAbs > 180) {\r\n                    this._pedalLine.setRotate(180 + surfaceAngle);\r\n                }\r\n                //90度时显示垂足符号\r\n                if (this._configData.view90PedalLineVisible) {\r\n                    this._pedalLine.setVisibility(true);\r\n                }\r\n            } else {\r\n                if (this._curRefAngle == \"no_refract\") {\r\n                    this._drawCommand.setDrawIndex(this._configData.NoRefracDrawIndex); //无折射\r\n                } else {\r\n                    this._drawCommand.setDrawIndex(this._configData.DrawIndex);  //正常折射\r\n                }\r\n                //法线和垂足符号是一起显示的\r\n                this._pedalLine.setVisibility(this._normalLine.getLineVisible());\r\n            }\r\n\r\n            if (this._curRefAngle != \"no_refract\") {\r\n                //this.setRefractVisibility(true);\r\n                //this.setRefractionLineVisible(true);\r\n                if (this._option.normalAngleVisible && this._hsdrawSectorRefraction) {//外部控制显示了\r\n                    //this.setRefractionPartVisibility(true);\r\n                    this.setSectorVisibilityByType(Sector.Type.Refraction, true);\r\n                    this.syncSectorVisibilityByName();\r\n                }\r\n                if (this._hsDrawRefractionLine) {\r\n                    this._refractionLine.setVisibility(true);\r\n                }\r\n                // this.setSectorVisibilityByType(Sector.Type.Incidence, true);\r\n\r\n            } else if (this._curRefAngle == \"no_refract\") {\r\n                this.setRefractionPartVisibility(false);\r\n                //强制隐藏状态\r\n                //this.getNameGroup().setHasDrawStatusByType(false, Sector.Type.Refraction);\r\n            }\r\n\r\n            //this.setIncidence0180View();\r\n            //是否显示垂足\r\n\r\n            this.resetLinePos();\r\n            this.resetPedalRotateAngle();\r\n        },\r\n        //设置垂足角度\r\n        resetPedalRotateAngle: function(){\r\n            var that = this;\r\n            var originalPosSvg = Svg.getAttrTranslate($(that._$$incidencePoint.node).attr(\"transform\"));\r\n            if (originalPosSvg.length == 0) {\r\n                originalPosSvg = [0, 0];\r\n            }\r\n            var point = {x: originalPosSvg[0], y: originalPosSvg[1]};\r\n            var leftDis = GraphMath.getTwoPointDistance(point, that._surfaceLines[that._curLineIndex].aPoint);\r\n            var rightDis = GraphMath.getTwoPointDistance(point, that._surfaceLines[that._curLineIndex].bPoint);\r\n            var _pedalLineAngle = (this._pedalLine.getRotateAngle()[0] - this._surfaceAngle) < 0 ?(this._pedalLine.getRotateAngle()[0] - this._surfaceAngle+360): (this._pedalLine.getRotateAngle()[0] - this._surfaceAngle);\r\n            if(leftDis <= 40){\r\n                if(_pedalLineAngle == 0){\r\n                    this._pedalLine.setRotate(90+ this._surfaceAngle);\r\n                }else if(_pedalLineAngle == 270){\r\n                    this._pedalLine.setRotate(180 + this._surfaceAngle);\r\n                }\r\n            }else if(rightDis <= 40){\r\n                if(_pedalLineAngle == 90){\r\n                    this._pedalLine.setRotate(0+ this._surfaceAngle);\r\n                }else if(_pedalLineAngle == 180){\r\n                    this._pedalLine.setRotate(270 + this._surfaceAngle);\r\n                }\r\n            }\r\n        },\r\n        getMoveRotateAngle: function (data) {\r\n            var currentPos = data.currentPos;\r\n            var lastPos = data.lastPos;\r\n            var originalPos;\r\n            var offset = $(this._$$incidencePoint.node).offset();\r\n            originalPos = {\r\n                x: offset.left,\r\n                y: offset.top\r\n            };\r\n            return GraphMath.getRotateAngle(originalPos, lastPos, currentPos);\r\n        },\r\n        onLightMove: function (lightType, data, eventType) {\r\n            if (eventType === 'beforemove') {\r\n                //this._isPedal = this.isPedal();\r\n            } else if (eventType === 'aftermove') {\r\n                //让角度自动吸附90° 和0°\r\n                this.adsorptionPedal();\r\n            } else if (eventType === 'move') {\r\n                var angle = this.getMoveRotateAngle(data);\r\n                //反射线角度是相反的\r\n                //if (lightType === LightLine.Type.ReflectionLine) {\r\n                //    angle = -angle;\r\n                //}\r\n                if (this.lineRotateAble(angle)) {\r\n                    if (this._configData.IncidenceLine.rotateFixed) {\r\n                        this._incidenceLine.rotate(angle);\r\n                    } //else if (this._configData.ReflectionLine.rotateFixed) {\r\n                    //    this._reflectionLine.rotate(-angle);\r\n                    //}\r\n                    else {\r\n                        this._incidenceLine.rotate(angle);\r\n                    }\r\n\r\n                    this.resetAngle(this._surfaceAngle);\r\n                    this._onLightMove(this.getUuid(), angle, this._curLineIndex);\r\n                }\r\n            }\r\n        },\r\n        /**\r\n         * 根据某条先算出该线的偏移值\r\n         * curLineIndex: 哪条线\r\n         * xDis, yDis, 偏移值\r\n         */\r\n        countLineXY: function (curLineIndex, xDis, yDis) {\r\n            var that = this;\r\n            if (that._surfacelinesKb[curLineIndex].degree <= 45 || that._surfacelinesKb[curLineIndex].degree >= 315) {\r\n                yDis = xDis * that._surfacelinesKb[curLineIndex].k;\r\n            } else {\r\n                if (that._surfacelinesKb[curLineIndex].k != \"no_exist\") {\r\n                    xDis = yDis / that._surfacelinesKb[curLineIndex].k;\r\n                } else {\r\n                    //xDis = that._surfacelinesKb[curLineIndex].x;\r\n                    xDis = 0;\r\n                }\r\n            }\r\n            return {\r\n                xDis: xDis,\r\n                yDis: yDis\r\n            }\r\n\r\n        },\r\n        /**\r\n         * 平移\r\n         * lightComplex 在某条线段上移动\r\n         * tranBtnTran: 移动按钮偏移值\r\n         */\r\n        onLightTrans: function (lightType, data, eventType) {\r\n            var that = this;\r\n            var scale = this._incidenceLine.getScale();\r\n            if (eventType === 'beforemove') {\r\n                //this._isPedal = this.isPedal();\r\n            } else if (eventType === 'aftermove') {\r\n                //让角度自动吸附90°\r\n                // this.setAngleToPedal();\r\n                var originalPosSvg = Svg.getAttrTranslate($(that._$$incidencePoint.node).attr(\"transform\"));\r\n                if (originalPosSvg.length == 0) {\r\n                    originalPosSvg = [0, 0];\r\n                }\r\n                var point = {x: originalPosSvg[0], y: originalPosSvg[1]};\r\n                //alert(originalPosSvg[0]+\" ,\"+originalPosSvg[1]);\r\n                if (GraphMath.isInSegment(point, that._surfaceLines[that._curLineIndex].range[0], that._surfaceLines[that._curLineIndex].range[1])) {\r\n                } else {\r\n                    var leftDis = GraphMath.getTwoPointDistance(point, that._surfaceLines[that._curLineIndex].range[0]), rightDis = GraphMath.getTwoPointDistance(point, that._surfaceLines[that._curLineIndex].range[1]);\r\n                    if (leftDis <= rightDis) {\r\n                        //xRel = that._surfaceLines[that._curLineIndex].range[0].x;\r\n                        //yRel = that._surfaceLines[that._curLineIndex].range[0].y;\r\n                        point = that._surfaceLines[that._curLineIndex].range[0];\r\n                    } else {\r\n                        //xRel = that._surfaceLines[that._curLineIndex].range[1].x;\r\n                        //yRel = that._surfaceLines[that._curLineIndex].range[1].y;\r\n                        point = that._surfaceLines[that._curLineIndex].range[1];\r\n                    }\r\n                    that.setGroupTranslate(point.x, point.y);\r\n                    that.resetAngle(that._surfaceLines[that._curLineIndex].degree);\r\n                    that._onLightTrans(that.getUuid(), xRel, yRel, that._curLineIndex);\r\n                }\r\n\r\n            } else if (eventType === 'move') {\r\n                var originalPosSvg = Svg.getAttrTranslate($(that._$$incidencePoint.node).attr(\"transform\"));\r\n                if (originalPosSvg.length == 0) {\r\n                    originalPosSvg = [0, 0];\r\n                }\r\n                var lastPos = data.lastPos;\r\n\r\n                var currentPos = data.currentPos;\r\n                var xDis = currentPos.x - lastPos.x, yDis = currentPos.y - lastPos.y;\r\n\r\n                xDis = xDis / scale;\r\n                yDis = yDis / scale;\r\n                var lineXY, xRel, yRel;\r\n                lineXY = that.countLineXY(that._curLineIndex, xDis, yDis);\r\n                xRel = originalPosSvg[0] + lineXY.xDis * 1420 / 1600;\r\n                yRel = originalPosSvg[1] + lineXY.yDis * 9 / 10;\r\n                var point = {x: xRel, y: yRel};\r\n                var leftDis, rightDis;\r\n                leftDis = GraphMath.getTwoPointDistance(point, that._surfaceLines[that._curLineIndex].aPoint);\r\n                rightDis = GraphMath.getTwoPointDistance(point, that._surfaceLines[that._curLineIndex].bPoint);\r\n                if (GraphMath.isInSegment(point, that._surfaceLines[that._curLineIndex].aPoint, that._surfaceLines[that._curLineIndex].bPoint)) {\r\n                    that.setGroupTranslate(xRel, yRel);\r\n                    that.resetAngle(that._surfaceLines[that._curLineIndex].degree);\r\n                    that._onLightTrans(that.getUuid(), xRel, yRel, that._curLineIndex);\r\n                } else {\r\n                    var lineNext;\r\n                    if (leftDis <= rightDis) {\r\n                        lineNext = GraphMath.inWhichLine(that._surfaceLines[that._curLineIndex].aPoint, that._surfaceLines, that._curLineIndex);\r\n                    } else {\r\n                        lineNext = GraphMath.inWhichLine(that._surfaceLines[that._curLineIndex].bPoint, that._surfaceLines, that._curLineIndex);\r\n                    }\r\n                    if(lineNext != -1) {\r\n                        that._curLineIndex = lineNext;\r\n                        var leftDisNew = GraphMath.getTwoPointDistance(point, that._surfaceLines[lineNext].range[0]);\r\n                        var rightDisNew = GraphMath.getTwoPointDistance(point, that._surfaceLines[lineNext].range[1]);\r\n                        if (leftDisNew <= rightDisNew) {\r\n                            xRel = that._surfaceLines[lineNext].range[0].x;\r\n                            yRel = that._surfaceLines[lineNext].range[0].y;\r\n                        } else {\r\n                            xRel = that._surfaceLines[lineNext].range[1].x;\r\n                            yRel = that._surfaceLines[lineNext].range[1].y;\r\n                        }\r\n                        that.setGroupTranslate(xRel, yRel);\r\n                        that.resetAngle(that._surfaceLines[that._curLineIndex].degree);\r\n                        that._onLightTrans(that.getUuid(), xRel, yRel, that._curLineIndex);\r\n                    }else{\r\n                        xRel = that._surfaceLines[that._curLineIndex].range[0].x;\r\n                        yRel = that._surfaceLines[that._curLineIndex].range[0].y;\r\n\r\n                        //$(this.getView().node).closest('._refraction').trigger('mouseup');\r\n                        //$(this.getView().node).closest('._refraction').trigger('touchend');\r\n                    }\r\n                }\r\n\r\n            }\r\n        },\r\n        /**\r\n         * 点击线的时候，控制外面的背景\r\n         */\r\n        onLightFocusBlur: function (type) {\r\n            this._onLightFocusBlur(type);\r\n        },\r\n\r\n        /**\r\n         * 度数精确到小数点后一位，不用吸附0度\r\n         */\r\n        setIncidence0180View: function () {\r\n            var angle = Math.round(this.getSectorAngle(Sector.Type.Incidence));\r\n            if (angle === 0 || angle === 90) {\r\n                this.setSectorVisibility(false);\r\n                //90度时显示垂足符号\r\n                if (this._configData.view90PedalLineVisible) {\r\n                    if (angle === 0) {\r\n                        this._pedalLine.setVisibility(true);\r\n                    } else {\r\n                        //法线和垂足符号是一起显示的\r\n                        this._pedalLine.setVisibility(this._normalLine.getLineVisible());\r\n                    }\r\n                }\r\n                if (!this._incidenceLine.isVisibilityHidden() && !this._refractionLine.isVisibilityHidden() && !this._linePedalChangeLock) {\r\n                    this._incidenceLine.setWidth(this._configData.IncidenceLine.PedalWidth);\r\n                    this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos);\r\n                    this._refractionLine.setWidth(this._configData.RefractionLine.PedalWidth);\r\n                    this._refractionLine.setArrowPos(this._configData.RefractionLine.PedalArrowPos);\r\n                }\r\n            } else {\r\n                //和名称同步\r\n                this.syncSectorVisibilityByName();\r\n                if (this._configData.view90PedalLineVisible) {\r\n                    this._pedalLine.setVisibility(this._normalLine.getLineVisible());\r\n                }\r\n                if (!this._incidenceLine.isVisibilityHidden() && !this._refractionLine.isVisibilityHidden() && !this._linePedalChangeLock) {\r\n                    this._incidenceLine.setWidth(this._configData.IncidenceLine.width);\r\n                    this._incidenceLine.setArrowPos(this._configData.IncidenceLine.arrowPos);\r\n                    this._refractionLine.setWidth(this._configData.RefractionLine.width);\r\n                    this._refractionLine.setArrowPos(this._configData.RefractionLine.arrowPos);\r\n                }\r\n            }\r\n        },\r\n        setIncidencePos: function (x, y) {\r\n            //定位到入射点\r\n            this._configData.IncidencePosX = x;\r\n            this.setTranslate(this._configData.IncidencePosX, this._configData.IncidencePosY);\r\n            this._$$incidencePoint.setTranslate(this._configData.IncidencePosX, this._configData.IncidencePosY);\r\n            this.getNameGroup().setTranslate(this._configData.IncidencePosX, this._configData.IncidencePosY);\r\n        },\r\n        getIncidencePosX: function () {\r\n            return this._configData.IncidencePosX;\r\n        },\r\n        //内部线条是否可移动\r\n        lineRotateAble: function (angle) {\r\n            if (this._incidenceLine.getRotateAngle() > this._normalLine.getRotateAngle()) {\r\n                angle = -angle;\r\n            }\r\n            var surfaceInSectorAngle = this.getSectorAngle(Sector.Type.SurfaceIn);\r\n            //if (surfaceInSectorAngle + angle < MinAngle) {\r\n            //    return false;\r\n            //}\r\n            return true;\r\n        },\r\n        //整个光组件是否可移动\r\n        complexRotateAble: function (angle) {\r\n            if (!this._configData.IncidenceLine.rotateFixed && !this._configData.RefractionLine.rotateFixed) {\r\n                return true;\r\n            }\r\n            //根据相对固定的光线来进行判断\r\n            if (this._incidenceLine.getRotateAngle() > this._normalLine.getRotateAngle()) {\r\n                if (this._configData.IncidenceLine.rotateFixed) {\r\n                    angle = angle;\r\n                } else if (this._configData.RefractionLine.rotateFixed) {\r\n                    angle = -angle;\r\n                }\r\n            } else {\r\n                if (this._configData.IncidenceLine.rotateFixed) {\r\n                    angle = -angle;\r\n                } else if (this._configData.RefractionLine.rotateFixed) {\r\n                    angle = angle;\r\n                }\r\n            }\r\n            var surfaceInSectorAngle = this.getSectorAngle(Sector.Type.SurfaceIn);\r\n            if (surfaceInSectorAngle + angle < MinAngle) {\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n        /**\r\n         * 旋转到指定角度和位置\r\n         * @param surfaceAngle\r\n         * @param surfaceRotateX 旋转点\r\n         * @param marginX 便宜量\r\n         */\r\n        around: function (surfaceAngle, surfaceRotateX, marginX) {\r\n            marginX = marginX || 0;\r\n            //这边可通过画图来求解坐标关系，最终求的是离圆心的坐标位置\r\n\r\n            //计算围绕旋转的半径\r\n            var r = Math.abs(surfaceRotateX - this._configData.IncidencePosX);\r\n\r\n            //求出该圆点所在坐标\r\n            var pos = GraphMath.getSpherePos(surfaceAngle || 0, r);\r\n            //计算离坐标原点的距离\r\n            var x, y;\r\n            if (surfaceRotateX > this._configData.IncidencePosX) {\r\n                //点在旋转中小左侧\r\n                x = surfaceRotateX + (-pos.x);//因为角度变成了负数，计算的时目标位置与x轴对称的值\r\n                y = pos.y;\r\n            } else {\r\n                //点在旋转中小右侧\r\n                x = pos.x + surfaceRotateX;\r\n                y = -pos.y;\r\n            }\r\n\r\n            //设置偏移量，svgtranslate,y坐标和坐标系相反\r\n            this.setTranslate(x + marginX, -y);\r\n            this._$$incidencePoint.setTranslate(x + marginX, -y);\r\n            this.getNameGroup().setTranslate(x + marginX, -y);\r\n        },\r\n        getData: function () {\r\n            var that = this;\r\n            var originalPosSvg = Svg.getAttrTranslate($(that._$$incidencePoint.node).attr(\"transform\"));\r\n            var defaultAngle = that.getSectorAngle(Sector.Type.SurfaceIn);\r\n            if (this._normalLine.getRotateAngle() < this._incidenceLine.getRotateAngle()) {\r\n                defaultAngle = 180 - defaultAngle;\r\n            }\r\n            var data = {\r\n                IncidenceLine: {\r\n                //    width: that._incidenceLine.getWidth(),//整体长度\r\n                    defaultAngle: that._incidenceLine.getRotateAngle(),//默认角度\r\n                    visible: !that._incidenceLine.isVisibilityHidden()//是否显示\r\n                },\r\n                RefractionLine: {\r\n             //       width: that._refractionLine.getWidth(),\r\n                    visible: !that._refractionLine.isVisibilityHidden()\r\n                },\r\n                NormalLine: {\r\n                    pointNameVisible: that._normalLine.getPointNameVisible(),\r\n                    lineVisible: that._normalLine.getLineVisible()\r\n                },\r\n                InverseRefractionLine: {\r\n                    pointNameVisible: that._inverseRefractionLine.getPointNameVisible(),\r\n                  //  lineVisible: that._inverseRefractionLine.getLineVisible()\r\n                    lineVisible: !that._inverseRefractionLine.isVisibilityHidden() && that.getHasdrawInverseRefractionLine()\r\n                },\r\n                Sector: {\r\n                    sectorInVisible: that.getSectorOutSideVisibilityByType(Sector.Type.SurfaceIn),\r\n                    sectorOutVisible: that.getSectorOutSideVisibilityByType(Sector.Type.SurfaceOut),\r\n                    incidenceVisible: that.getSectorOutSideVisibilityByType(Sector.Type.Incidence),\r\n                    refractionVisible: that.getSectorOutSideVisibilityByType(Sector.Type.Refraction),\r\n                    hasDraw: that.getSectorHasDraw()\r\n                },\r\n                //IncidencePointVisible: !View.isVisibilityHidden(that._$$incidencePoint),\r\n\r\n                Draw: {\r\n                    hasNext: that.hasNextWidthOutVisibilityStatus(),\r\n                    incidencePoint: that.getHasDrawIncidencePoint(),\r\n                    sectorAnimateDisappear: that.getHasDrawSectorAnimateDisappear(),\r\n                    sectorRefraction: that.getHasDrawSectorRefraction(),\r\n                    refractionLine: that.getHasDrawRefractionLine(),\r\n                    inverserefractionline: that.getHasdrawInverseRefractionLine(),\r\n                    materialObjectImagingGroup4: that.getHasdrawMaterialObjectImagingGroup4(),\r\n                    materialObjectImagingGroup5: that.getHasdrawMaterialObjectImagingGroup5()\r\n                },\r\n                PedalLineVisible: !that._pedalLine.isVisibilityHidden(),\r\n                IncidencePosX: originalPosSvg[0], //入射点位置TODO:这个需要动态计算，暂时写死\r\n                IncidencePosY: originalPosSvg[1],\r\n                Visible: !that.isVisibilityHidden(),\r\n                _curLineIndex: that._curLineIndex\r\n\r\n            };\r\n            return data;\r\n        },\r\n        //90°时自动吸附\r\n        //角度用小数点显示，去掉吸附\r\n        adsorptionPedal: function () {\r\n            if (this.isPedal()) {\r\n                var normalLineAngle = this._normalLine.getRotateAngle();\r\n                //垂足\r\n                var incidenceAngle = this._incidenceLine.getRotateAngle();\r\n\r\n                if (Math.abs(normalLineAngle % 360 - incidenceAngle % 360) > 90) {\r\n                    this._refractionLine.setRotate(normalLineAngle);\r\n                    this._incidenceLine.setRotate(normalLineAngle + 180);\r\n                } else {\r\n                    this._incidenceLine.setRotate(normalLineAngle);\r\n                    this._refractionLine.setRotate(normalLineAngle + 180);\r\n                }\r\n\r\n                this.resetAngle(normalLineAngle - 90);\r\n            } else if (Math.round(this.getSectorAngle(Sector.Type.Incidence)) === 90) {\r\n                var incidenceAngle = this._incidenceLine.getRotateAngle() % 360;\r\n                var normalLineAngle = this._normalLine.getRotateAngle() % 360;\r\n                //右侧\r\n                if (Math.abs(incidenceAngle - normalLineAngle - 90) <= 2) {\r\n                    this._incidenceLine.setRotate(normalLineAngle + 90);\r\n                } else {\r\n                    this._incidenceLine.setRotate(normalLineAngle - 90);\r\n                }\r\n            }\r\n        },\r\n        //是否垂足\r\n        isPedal: function () {\r\n            return Math.round(this.getSectorAngle(Sector.Type.Incidence)) === 0;\r\n            //var normalLineAngle = this._normalLine.getRotateAngle();\r\n            //var inverseRefractionLineAngle = this._inverseRefractionLine.getRotateAngle();\r\n            //var incidenceAngle = this._incidenceLine.getRotateAngle();\r\n            //return Math.round(normalLineAngle % 180) === Math.round(incidenceAngle % 180);\r\n        },\r\n        initDomEvent: function () {\r\n            this.bindDomEvent(this.getView().node, ['lrTap'], this.getUuid(), this.domEventHandler);\r\n        },\r\n        setViewTapListener: function (callback) {\r\n            this._onViewClickListener = callback;\r\n        },\r\n        domEventHandler: function (uuid) {\r\n            this._onViewClickListener && this._onViewClickListener(uuid);\r\n        },\r\n        changeTransparent: function (show) {\r\n            //option = option || {};\r\n            //option.incidenceName = typeof option.incidenceName === typeof  undefined ? true : option.incidenceName;//入射角名称忽略\r\n            // var opacity = show ? 1.0 : 0.3;\r\n            //  this._normalLine.setOpacity(opacity);\r\n            //this._pedalLine.setOpacity(opacity);\r\n             //this.setSectorOpacity(opacity);\r\n\r\n            //if (show) {\r\n            //    var $$item = $(this.getView().node).closest('._lr_item');\r\n            //    var $surface = $$item.children('._lr_surface');\r\n            //    $surface.last().after(this.getNameGroup().getView().node);\r\n            //    //添加到反射面最近的一层\r\n            //    $surface.first().before(this.getView().node);\r\n            //    //名称放到最后\r\n            //    $$item.children().last().after(this.getNameGroup().getView().node);\r\n            //} else {\r\n            //    var $first = $(this.getView().node).closest('._lr_item').children().first();\r\n            //    $first.before(this.getNameGroup().getView().node);\r\n            //}\r\n        },\r\n        setVisibility: function (visible) {\r\n            View.setVisibility(this.getView(), visible);\r\n            this.getNameGroup().setVisibility(visible);\r\n        },\r\n        setLinePedalChangeLock: function (lock) {\r\n            this._linePedalChangeLock = lock;\r\n        },\r\n        getTwoLineVisible: function () {\r\n            return !this._incidenceLine.isVisibilityHidden() && !this._refractionLine.isVisibilityHidden();\r\n        },\r\n        setRefractionPartVisibility: function (visible) {\r\n            this.setRefractionLineVisible(visible);\r\n            this.setSectorVisibilityByType(Sector.Type.Refraction, visible);\r\n            this.syncSectorVisibilityByName();\r\n        }\r\n\r\n    });\r\n\r\n    //include part api\r\n    var draw = require('js/refractor/lightComplexRef/draw');\r\n    var event = require('js/refractor/lightComplexRef/event');\r\n    var proxyApi = require('js/refractor/lightComplexRef/proxyApi');\r\n    var sector = require('js/refractor/lightComplexRef/sector');\r\n    var namePos = require('js/refractor/lightComplexRef/namePos');\r\n    LightComplex.__include(draw);\r\n    LightComplex.__include(event);\r\n    LightComplex.__include(proxyApi);\r\n    LightComplex.__include(sector);\r\n    LightComplex.__include(namePos);\r\n\r\n    return LightComplex;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/refractor/lightComplexRef/namePos', ['js/view/sector', 'js/utils/utils', 'js/utils/view', 'js/utils/graphmath', 'js/utils/svg', 'js/view/lightLine'], function (Sector, Utils, View, GraphMath, Svg, LightLine) {\r\n\r\n\r\n    var NamePos = {\r\n        _lastMinLine: null,\r\n        resetLinePos: function () {\r\n            this.initLineNamePos(this._incidenceLine);\r\n            this.initLineNamePos(this._refractionLine);\r\n        },\r\n        initLineNamePos: function (line) {\r\n          //  line.makeNameViewAround(line.getRotateAngle().toFixed(5));\r\n            var lineAngle = new Number(line.getRotateAngle());\r\n            line.makeNameViewAround(lineAngle.toFixed(5));\r\n\r\n        }\r\n    };\r\n\r\n    return NamePos;\r\n});\r\n\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/refractor/lightComplexRef/proxyApi', ['js/view/sector', 'js/utils/utils', 'js/utils/view', 'js/view/LightLine'], function (Sector, Utils, View, LightLine) {\r\n\r\n    //将选择角度装换为0~360度\r\n    var get0T360Angle = function (angle) {\r\n        angle = angle % 360;\r\n        if (angle < 0) {\r\n            return 360 + angle;\r\n        }\r\n        return angle;\r\n    };\r\n\r\n    /**\r\n     * 获取线针对圆的旋转角度，圆从右侧开始为0°\r\n     * @param lineRotateAngle\r\n     * @returns {number}\r\n     */\r\n    var getSphereAngle = function (lineRotateAngle) {\r\n        var sphereAngle = (180 - lineRotateAngle % 360) % 360;\r\n        if (sphereAngle < 0) {\r\n            sphereAngle = 360 + sphereAngle;\r\n        }\r\n        return sphereAngle;\r\n    };\r\n\r\n\r\n    var LightComplexProxyApi = {\r\n        setIncidenceXAxisAngle: function (angle) {\r\n            this._incidenceLine.setRotate(angle);\r\n        },\r\n        getIncidenceRotateAngle: function () {\r\n            return this._incidenceLine.getRotateAngle();\r\n        },\r\n        getRefractionRotateAngle: function () {\r\n            return this._refractionLine.getRotateAngle();\r\n        },\r\n        setIncidenceLineWidth: function (width) {\r\n            this._incidenceLine.setWidth(width);\r\n        },\r\n        setRefractionLineWidth: function (width) {\r\n            this._refractionLine.setWidth(width);\r\n        },\r\n        setIncidenceLineArrowPos: function (arrowPos) {\r\n            this._incidenceLine.setArrowPos(arrowPos);\r\n        },\r\n        setRefractionLineArrowPos: function (arrowPos) {\r\n            this._refractionLine.setArrowPos(arrowPos);\r\n        },\r\n        setIncidenceLineCommonFill: function (common) {\r\n            if (common) {\r\n                this._incidenceLine.setCommonFill();\r\n            } else {\r\n                this._incidenceLine.restoreFill();\r\n            }\r\n        },\r\n        setRefractionLineCommonFill: function (common) {\r\n            if (common) {\r\n                this._refractionLine.setCommonFill();\r\n            } else {\r\n                this._refractionLine.restoreFill();\r\n            }\r\n        },\r\n        setIncidenceLineVisible: function (visible) {\r\n            this._incidenceLine.setVisibility(visible);\r\n        },\r\n        setRefractionLineVisible: function (visible) {\r\n            this._refractionLine.setVisibility(visible);\r\n        },\r\n        getIncidenceLineVisible: function () {\r\n            return !this._incidenceLine.isVisibilityHidden();\r\n        },\r\n        getReflectionLineVisible: function () {\r\n            return !this._reflectionLine.isVisibilityHidden();\r\n        },\r\n        getIncidenceSurfaceAngle: function () {\r\n            return this.getSectorAngle(Sector.Type.Incidence);\r\n        },\r\n        setIncidenceNameEnable: function (nameEnable) {\r\n            this._incidenceLine.setNameEnable(nameEnable);\r\n        },\r\n        setIncidenceNameVisible: function (visible) {\r\n            this._incidenceLine.setNameVisible(visible);\r\n            //更新名称位置\r\n            this.resetLinePos();\r\n        },\r\n\r\n        getNormalLineRotateAngle: function () {\r\n            return this._normalLine.getRotateAngle();\r\n        },\r\n        //获取与X轴的斜率夹角\r\n        getIncidenceLineXAngle: function () {\r\n            return (360 - this._incidenceLine.getRotateAngle() % 360) % 180;\r\n        },\r\n        //获取与X轴的斜率夹角\r\n        getRefractionLineXAngle: function () {\r\n            return (360 - this._refractionLine.getRotateAngle() % 360) % 180;\r\n        },\r\n        getNormalLineXAngle: function () {\r\n            return (360 - this._normalLine.getRotateAngle() % 360) % 180;\r\n        },\r\n        getSectorInLineXAngle: function () {\r\n            var rotate = 0;\r\n            var lineRotate = this._incidenceLine.getRotateAngle();\r\n            var normalRotate = this._normalLine.getRotateAngle();\r\n            if (lineRotate > normalRotate) {\r\n                rotate = lineRotate + this.getSectorAngle(Sector.Type.SurfaceIn);\r\n            } else {\r\n                rotate = lineRotate - this.getSectorAngle(Sector.Type.SurfaceIn);\r\n            }\r\n            return (360 - rotate % 360) % 180;\r\n        },\r\n        getSectorOutLineXAngle: function () {\r\n            var rotate = 0;\r\n            var lineRotate = this._refractionLine.getRotateAngle();\r\n            var normalRotate = this._normalLine.getRotateAngle();\r\n            if (lineRotate > normalRotate) {\r\n                rotate = lineRotate + this.getSectorAngle(Sector.Type.SurfaceOut);\r\n            } else {\r\n                rotate = lineRotate - this.getSectorAngle(Sector.Type.SurfaceOut);\r\n            }\r\n            return (360 - rotate % 360) % 180;\r\n        },\r\n        //获取相对圆的角度\r\n        getIncidenceLineSphereAngle: function () {\r\n            return getSphereAngle(this._incidenceLine.getRotateAngle());\r\n        },\r\n        //获取与X轴的斜率夹角\r\n        getRefractionLineSphereAngle: function () {\r\n            return getSphereAngle(this._refractionLine.getRotateAngle());\r\n        },\r\n        getNormalLineSphereAngle: function () {\r\n            return getSphereAngle(this._normalLine.getRotateAngle());\r\n        },\r\n        getLineXAngle: function (lineType) {\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                return this.getIncidenceLineXAngle();\r\n            } else if (lineType === LightLine.Type.RefractionLine) {\r\n                return this.getRefractionLineXAngle();\r\n            }\r\n        },\r\n        getLine0To360RotateAngle: function (lineType) {\r\n            var line;\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                line = this._incidenceLine;\r\n            } else if (lineType === LightLine.Type.RefractionLine) {\r\n                line = this._refractionLine;\r\n            }\r\n            return get0T360Angle(line.getRotateAngle());\r\n        },\r\n        //获取线旋转的象限位置\r\n        getLineQuad: function (lineType) {\r\n            var line, angle;\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                line = this._incidenceLine;\r\n            } else if (lineType === LightLine.Type.RefractionLine) {\r\n                line = this._refractionLine;\r\n            } else if (lineType === LightLine.Type.NormalLine) {\r\n                line = this._normalLine;\r\n            } else if (lineType === LightLine.Type.SurfaceIn) {\r\n                var normalRotate = this.getNormalLineRotateAngle();\r\n                var incidenceRotate = this.getIncidenceRotateAngle();\r\n                if (incidenceRotate < normalRotate) {\r\n                    angle = get0T360Angle(incidenceRotate) - this.getSectorAngle(Sector.Type.SurfaceIn);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                } else {\r\n                    angle = get0T360Angle(incidenceRotate) + this.getSectorAngle(Sector.Type.SurfaceIn);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                }\r\n            } else if (lineType === LightLine.Type.SurfaceOut) {\r\n                var normalRotate = this.getNormalLineRotateAngle();\r\n                var refractionRotate = this.getRefractionRotateAngle();\r\n                if (refractionRotate < normalRotate) {\r\n                    angle = get0T360Angle(refractionRotate) - this.getSectorAngle(Sector.Type.SurfaceOut);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                } else {\r\n                    angle = get0T360Angle(refractionRotate) + this.getSectorAngle(Sector.Type.SurfaceOut);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                }\r\n            }\r\n            //线的旋转角度都是从左侧0度开始旋转，和象限值不服，需要装换\r\n            if (line) {\r\n                angle = get0T360Angle(line.getRotateAngle());\r\n            }\r\n\r\n            if (angle >= 0 && angle <= 90) {\r\n                return 2;\r\n            } else if (angle >= 90 && angle <= 180) {\r\n                return 1;\r\n            } else if (angle >= 180 && angle <= 270) {\r\n                return 4\r\n            } else if (angle >= 270 && angle <= 360) {\r\n                return 3;\r\n            }\r\n            return 0;\r\n        },\r\n        setLineVisibility: function (lineType, visible) {\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                this._incidenceLine.setVisibility(visible);\r\n            } else if (lineType === LightLine.Type.RefractionLine) {\r\n                this._refractionLine.setVisibility(visible);\r\n            }\r\n        },\r\n        setLineEnable: function (lineType, enable) {\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                this._incidenceLine.setLineEnable(enable);\r\n            } else if (lineType === LightLine.Type.RefractionLine) {\r\n                this._refractionLine.setLineEnable(enable);\r\n            }\r\n        },\r\n\t /**\r\n\t 第二模块是动态计算的，所以_curLineIndex的值需要动态计算\r\n\t  */\r\n        setCurLineIndex: function(index){\r\n            this._curLineIndex = index;\r\n        },\r\n        setGroupTranslate: function(transx, transy){\r\n            this.setTranslate(transx, transy);\r\n            this._nameGroup.setTranslate(transx, transy);\r\n            this._$$incidencePoint.setTranslate(transx, transy);\r\n        },\r\n        /**\r\n         * 返回折射角\r\n         */\r\n\r\n        getRefAngle: function(){\r\n            return this._curRefAngle;\r\n        },\r\n        /**\r\n         * 获取某文字\r\n         */\r\n        getNameByType: function(type){\r\n            return this._nameGroup.getNameByType(type);\r\n        },\r\n        /**\r\n         * 重置name的位置\r\n         */\r\n        setNamePosByType: function(type, x, y){\r\n            this.getNameByType(type).setTranslate(x, y);\r\n        }\r\n\r\n    };\r\n\r\n    return LightComplexProxyApi;\r\n});\n/**\r\n * Created by ylf on 2016/8/24.\r\n */\r\ndefine('js/refractor/lightComplexRef/sector', ['js/view/sector', 'js/utils/utils', 'js/utils/view', 'js/view/NameGroup', 'js/view/LightLine'], function (Sector, Utils, View, NameGroup, LightLine) {\r\n\r\n    var GraphMath = require('js/utils/graphMath');\r\n\r\n    var LightComplexSector = {\r\n        _sector: null,\r\n        _sectorEnable: true,\r\n        _currentVisibleStatus: null,\r\n        _sectorHasDraw: null,\r\n        createSector: function (appendPosX) {\r\n            var configData = this._configData;\r\n            this._sector = {};\r\n            this._currentVisibleStatus = {};\r\n            //夹角扇面\r\n            this._sector[Sector.Type.Incidence] = this._incidenceSector = Sector.create(Sector.Type.Incidence, appendPosX, 0, configData.Sector.incidenceR, this._option.langData);\r\n            this._sector[Sector.Type.Refraction] = this._refractionSector = Sector.create(Sector.Type.Refraction, appendPosX, 0, configData.Sector.refractionR, this._option.langData);\r\n            this._sector[Sector.Type.SurfaceIn] = this._surfaceInSector = Sector.create(Sector.Type.SurfaceIn, appendPosX, 0, configData.Sector.surfaceR, this._option.langData);\r\n            this._sector[Sector.Type.SurfaceOut] = this._surfaceOutSector = Sector.create(Sector.Type.SurfaceOut, appendPosX, 0, configData.Sector.surfaceR, this._option.langData);\r\n\r\n\r\n            var sectorNameData = {};\r\n            sectorNameData[Sector.Type.Incidence] = {cx: appendPosX, cy: 0, r: configData.Sector.refractionR};\r\n            sectorNameData[Sector.Type.Refraction] = {cx: appendPosX, cy: 0, r: configData.Sector.refractionR};\r\n            sectorNameData[Sector.Type.SurfaceIn] = {cx: appendPosX, cy: 0, r: configData.Sector.surfaceR};\r\n            sectorNameData[Sector.Type.SurfaceOut] = {cx: appendPosX, cy: 0, r: configData.Sector.surfaceR};\r\n            this._nameGroup = NameGroup.create(sectorNameData, this._option.langData, this._option);\r\n            this._nameGroup.setTranslate(this._configData.IncidencePosX, this._configData.IncidencePosY);\r\n        },\r\n        sectorEach: function (callback) {\r\n            for (var key in this._sector) {\r\n                callback.apply(this._sector[key], [key]);\r\n            }\r\n        },\r\n        appendSector: function () {\r\n            var that = this;\r\n            this.sectorEach(function (type) {\r\n                that.addShape(this.getView());\r\n            })\r\n        },\r\n        gtIndexSectorAppendToView: function ($$container) {\r\n            $$container.addShape(this._nameGroup.getView());\r\n        },\r\n        setAngleVisibleByType: function (type, visible) {\r\n            this._currentVisibleStatus[type] = visible;\r\n\r\n            //不可用则不能更改状态\r\n            if (!this._sectorEnable) {\r\n                if (visible === true) {\r\n                    this._nameGroup.setHasDrawStatusByType(type, visible);\r\n                }\r\n                return;\r\n            }\r\n            this._nameGroup.setAngleVisibleByType(type, visible);\r\n        },\r\n        resetSectorAngle: function (normalAngle, negative, angle) {\r\n            var __getIndex = function (index, nagative, sub) {\r\n                return nagative ? sub - index : index;\r\n            };\r\n            this._surfaceInSector.rotate(angle[0], angle[1]);\r\n            this._incidenceSector.rotate(angle[1], angle[2]);\r\n            this._refractionSector.rotate(angle[3], angle[4]);\r\n            this._surfaceOutSector.rotate(angle[2], angle[3]);\r\n            this._nameGroup.setNormalAngle(normalAngle);\r\n            this._nameGroup.rotate(angle, negative);\r\n        },\r\n        initSectorVisibleState: function () {\r\n            var configData = this._configData;\r\n            this.setAngleVisibleByType(Sector.Type.SurfaceIn, configData.Sector.sectorInVisible);\r\n            this.setAngleVisibleByType(Sector.Type.SurfaceOut, configData.Sector.sectorOutVisible);\r\n            this.setAngleVisibleByType(Sector.Type.Incidence, configData.Sector.incidenceVisible);\r\n            this.setAngleVisibleByType(Sector.Type.Refraction, configData.Sector.refractionVisible);\r\n\r\n            if (this._configData.Sector.hasDraw) {\r\n                this._nameGroup.setHasDrawStatus(this._configData.Sector.hasDraw)\r\n            }\r\n            this.syncSectorVisibilityByName();\r\n        },\r\n        getSectorHasDraw: function () {\r\n            return this._nameGroup.getHasDrawStatus();\r\n        },\r\n        //设置是否由程序内部逻辑导致的绘制\r\n        setSectorInsideDrawStatus: function (status, type) {\r\n            this._nameGroup.setHasDrawStatusByType(status, type);\r\n        },\r\n        setSectorVisibilityByType: function (type, visible) {\r\n            this.setAngleVisibleByType(type, visible);\r\n            this._sector[type].setVisibility(this._nameGroup.getAngleIsValidByType(type));\r\n        },\r\n        //被外部接口改变显示，这个时候不记录状态\r\n        setSectorVisibilityByOutSideLogic: function (type, visible) {\r\n            if (this._nameGroup.getHasDrawStatusByType(type)) {\r\n                this.setAngleVisibleByType(type, visible);\r\n            }\r\n            this._sector[type].setVisibility(this._nameGroup.getAngleIsValidByType(type));\r\n        },\r\n        //直接隐藏扇面，不记录状态\r\n        setSectorVisibility: function (visible) {\r\n            this.sectorEach(function () {\r\n                this.setVisibility(visible);\r\n            })\r\n        },\r\n        syncSectorVisibilityByName: function () {\r\n            var that = this;\r\n            this.sectorEach(function (type) {\r\n                this.setVisibility(that._nameGroup.getAngleIsValidByType(type))\r\n            });\r\n        },\r\n        sectorAnimateDisappear: function (callback) {\r\n            var that = this;\r\n            that.setAngleVisibleByType(Sector.Type.Incidence, true);\r\n            that.setAngleVisibleByType(Sector.Type.Refraction, true);\r\n            that.syncSectorVisibilityByName();\r\n            that.setAngleVisibleByType(Sector.Type.Incidence, false);\r\n            that.setAngleVisibleByType(Sector.Type.Refraction, false);\r\n            that.setSectorInsideDrawStatus(true, Sector.Type.Incidence);\r\n            that.setSectorInsideDrawStatus(true, Sector.Type.Reflection);\r\n            $(that._refractionSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300, function () {\r\n                that.syncSectorVisibilityByName();\r\n                $(that._refractionSector.getView().node).css('display', '');\r\n                callback && callback();\r\n            });\r\n            $(that._incidenceSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300, function () {\r\n                that.syncSectorVisibilityByName();\r\n                $(that._incidenceSector.getView().node).css('display', '');\r\n                callback && callback();\r\n            });\r\n        },\r\n        getSectorOutSideVisibilityByType: function (type) {\r\n            return this._nameGroup.getAngleVisibilityByType(type);\r\n        },\r\n        getNameGroup: function () {\r\n            return this._nameGroup;\r\n        },\r\n        getSectorAngle: function (type) {\r\n            return this._nameGroup.getAngle(type);\r\n        },\r\n        getSectorRoundAngle: function (type) {\r\n            return this._nameGroup.getRoundAngle(type);\r\n        },\r\n        //获取扇面线段坐标\r\n        getSectorLinesPos: function (sectorType, centerPos) {\r\n            var that = this;\r\n            var startXAngle, endXAngle;\r\n            var startLineType, endLineType;\r\n            if (sectorType == Sector.Type.Incidence) {\r\n                startXAngle = this.getIncidenceLineXAngle();\r\n                endXAngle = this.getNormalLineXAngle();\r\n                startLineType = LightLine.Type.IncidenceLine;\r\n                endLineType = LightLine.Type.NormalLine;\r\n            } else if (sectorType == Sector.Type.Refraction) {\r\n                startXAngle = this.getNormalLineXAngle();\r\n                endXAngle = this.getRefractionLineXAngle();\r\n                startLineType = LightLine.Type.NormalLine;\r\n                endLineType = LightLine.Type.RefractionLine;\r\n            } else if (sectorType == Sector.Type.SurfaceIn) {\r\n                startXAngle = this.getIncidenceLineXAngle();\r\n                endXAngle = this.getSectorInLineXAngle();\r\n                startLineType = LightLine.Type.IncidenceLine;\r\n                endLineType = LightLine.Type.SurfaceIn;\r\n            } else if (sectorType == Sector.Type.SurfaceOut) {\r\n                startXAngle = this.getRefractionLineXAngle();\r\n                endXAngle = this.getSectorOutLineXAngle();\r\n                startLineType = LightLine.Type.RefractionLine;\r\n                endLineType = LightLine.Type.SurfaceOut;\r\n            }\r\n\r\n\r\n            var _getPos = function (xAngle, lineType) {\r\n                //统一装换为锐角\r\n                if (xAngle > 90) {\r\n                    xAngle = 180 - xAngle;\r\n                }\r\n                var quad = that.getLineQuad(lineType);\r\n\r\n                var sectorR = that._configData.Sector.surfaceR;\r\n                if (sectorType == Sector.Type.Incidence) {\r\n                    sectorR = that._configData.Sector.incidenceR;\r\n                } else if (sectorType == Sector.Type.Refraction) {\r\n                    sectorR = that._configData.Sector.refractionR;\r\n                }\r\n\r\n                var pos = {\r\n                    y: Math.sin(GraphMath.getRadian(xAngle)) * sectorR,\r\n                    x: Math.cos(GraphMath.getRadian(xAngle)) * sectorR\r\n                };\r\n\r\n                var posB = {};\r\n                if (quad === 1) {\r\n                    posB.x = centerPos.x + pos.x;\r\n                    posB.y = centerPos.y + pos.y;\r\n                } else if (quad === 2) {\r\n                    posB.x = centerPos.x - pos.x;\r\n                    posB.y = centerPos.y + pos.y;\r\n                } else if (quad === 3) {\r\n                    posB.x = centerPos.x - pos.x;\r\n                    posB.y = centerPos.y - pos.y;\r\n                } else {\r\n                    posB.x = centerPos.x + pos.x;\r\n                    posB.y = centerPos.y - pos.y;\r\n                }\r\n                return {\r\n                    a: centerPos,\r\n                    b: posB\r\n                }\r\n            };\r\n\r\n            var line = [_getPos(startXAngle, startLineType), _getPos(endXAngle, endLineType)];\r\n            return line;\r\n        },\r\n        setSectorEnable: function (enable) {\r\n            var that = this;\r\n            this._sectorEnable = enable;\r\n            if (enable) {\r\n                //还原显示\r\n                this.sectorEach(function (type) {\r\n                    that._nameGroup.setAngleVisibleByType(type, that._currentVisibleStatus[type]);\r\n                });\r\n                //进行同步\r\n                this.syncSectorVisibilityByName();\r\n            } else {\r\n                this.sectorEach(function (type) {\r\n                    this.setVisibility(false);\r\n                    that._nameGroup.setAngleVisibleByType(type, false);\r\n                })\r\n            }\r\n        },\r\n        setSectorOpacity: function (opacity) {\r\n            this.getNameGroup().setOpacity(opacity);\r\n            this.sectorEach(function () {\r\n                this.setOpacity(opacity);\r\n            });\r\n        }\r\n    };\r\n\r\n    return LightComplexSector;\r\n});\n/**\r\n * 动画命令执行队列\r\n * Created by ylf on 2016/8/5.\r\n */\r\n\r\n\r\ndefine('js/utils/drawCommand', ['js/utils/logger'], function (Logger) {\r\n\r\n    var Command = {\r\n        _queue: [],\r\n        _hasDrawQueue: [],\r\n        _drawIndex: [],\r\n        _currentIndex: 0,\r\n        _maxLength: 100,\r\n        _stopCallback: null,\r\n        _stopFlag: false,\r\n        _drawing: false,\r\n        create: function () {\r\n            var instance = Object.create(this);\r\n            instance._queue = [];\r\n            instance._drawIndex = [];\r\n            instance._hasDrawQueue = [];\r\n            return instance;\r\n        },\r\n        push: function (draw, hasDraw) {\r\n            this._queue.push(this.makeAsPromise(draw));\r\n            this._hasDrawQueue.push(hasDraw);\r\n        },\r\n        setCurrentIndex: function (index) {\r\n            this._currentIndex = index;\r\n        },\r\n        drawNext: function (callback, animate, force) {\r\n            var that = this;\r\n            if (this._drawing && force !== true) {\r\n                Logger.debug('draw', '正在绘制中，不能提交新的绘制命令');\r\n                callback && callback(that._currentIndex);\r\n                return;\r\n            }\r\n            if (this.hasNext()) {\r\n                this._drawing = true;\r\n                var hasDraw = this.hasDraw(this._currentIndex);\r\n                if (hasDraw) {\r\n                    this._currentIndex++;\r\n                    this.drawNext(callback, animate, true);\r\n                    this._drawing = false;\r\n                    return;\r\n                }\r\n                var tasks = this.getTask(this._currentIndex);\r\n                this._currentIndex++;\r\n                var doneCallBack = function () {\r\n                    that._drawing = false;\r\n                    that._stopCallback && that._stopCallback();\r\n                    callback && callback(that._currentIndex);\r\n                };\r\n                //TODO:这个地方先写死四个,待优化\r\n                if (tasks.length === 1) {\r\n                    $.when([tasks[0](animate)]).done(doneCallBack);\r\n                } else if (tasks.length === 2) {\r\n                    $.when([tasks[0](animate), tasks[1](animate)]).done(doneCallBack);\r\n                } else if (tasks.length === 3) {\r\n                    $.when([tasks[0](animate), tasks[1](animate), tasks[2](animate)]).done(doneCallBack);\r\n                } else if (tasks.length === 4) {\r\n                    $.when([tasks[0](animate), tasks[1](animate), tasks[2](animate), tasks[3](animate)]).done(doneCallBack);\r\n                } else if (tasks.length === 5) {\r\n                    $.when([tasks[0](animate), tasks[1](animate), tasks[2](animate), tasks[3](animate), tasks[4](animate)]).done(doneCallBack);\r\n                }\r\n                return true;\r\n            } else {\r\n                Logger.debug('draw', '已经没有更多命令需要绘制');\r\n                callback && callback(that._currentIndex);\r\n                return false;\r\n            }\r\n        },\r\n        getTask: function (index) {\r\n            var that = this;\r\n            var actualIndex = this._drawIndex[index];\r\n            var task = [];\r\n            if (actualIndex instanceof Array) {\r\n                actualIndex.forEach(function (i) {\r\n                    task.push(that._queue[i]);\r\n                })\r\n            } else {\r\n                task.push(that._queue[actualIndex]);\r\n            }\r\n            return task;\r\n        },\r\n        hasNext: function () {\r\n            var hasNext = false;\r\n            for (var i = 0; i < this._drawIndex.length; i++) {\r\n                var hasDraw = this.hasDraw(i);\r\n                if (!hasDraw) {\r\n                    hasNext = true;\r\n                }\r\n            }\r\n            return hasNext;\r\n        },\r\n        hasNotDrawNext: function () {\r\n            if (this._drawIndex.length > 0) {\r\n                return this._currentIndex <= this._drawIndex.length - 1;\r\n            }\r\n            return this._currentIndex <= this._queue.length - 1;\r\n        },\r\n        drawAll: function (callback, animate) {\r\n            for (var i = 0; i < this._drawIndex.length; i++) {\r\n                var tasks = this.getTask(i);\r\n                tasks.forEach(function (task) {\r\n                    task(animate);\r\n                })\r\n            }\r\n            callback && callback();\r\n        },\r\n        setDrawIndex: function (drawIndex) {\r\n            if (!this._drawing) {\r\n                this._drawIndex = drawIndex;\r\n                this._currentIndex = 0;\r\n            }\r\n        },\r\n        stop: function (stopCallBack) {\r\n            if (!this._drawing) {\r\n                this._stopFlag = true;\r\n                stopCallBack && stopCallBack();\r\n                return;\r\n            }\r\n            this._stopFlag = true;\r\n            this._stopCallback = stopCallBack;\r\n        },\r\n        hasDraw: function (index) {\r\n            var that = this;\r\n            var actualIndex = this._drawIndex[index];\r\n            var hasDraw = true;\r\n            if (actualIndex instanceof Array) {\r\n                actualIndex.forEach(function (i) {\r\n                    if (hasDraw) {\r\n                        hasDraw = that._hasDrawQueue[i]();\r\n                    }\r\n                })\r\n            } else {\r\n                hasDraw = that._hasDrawQueue[actualIndex]();\r\n            }\r\n            return hasDraw;\r\n        },\r\n        makeAsPromise: function (callBack) {\r\n            return function () {\r\n                var deffer = $.Deferred();\r\n                var arg = Array.prototype.slice.apply(arguments, [0]);\r\n                arg.unshift(deffer);\r\n                callBack.apply(this, arg);\r\n                return deffer.promise();\r\n            }\r\n        },\r\n        getCommandLength: function () {\r\n            return this._queue.length;\r\n        }\r\n    };\r\n\r\n    return Command;\r\n});\n/**\r\n * Created by ylf on 2016/7/22.\r\n * 事件管理对象\r\n */\r\ndefine('js/utils/eventBus', ['js/utils/logger'], function (Logger) {\r\n\r\n    var EventBus = {\r\n        _eventHandler: null,\r\n        create: function () {\r\n            var instance = Object.create(this);\r\n            instance._eventHandler = {};\r\n            return instance;\r\n        },\r\n        trigger: function () {\r\n            //将参数转换为数组\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            //取第一个，并从数组中删除，事件key\r\n            var type = arg.shift();\r\n            if (!this._eventHandler || !this._eventHandler[type]) {\r\n                return false;\r\n            }\r\n            var handlers = this._eventHandler[type];\r\n            handlers.forEach(function (handler) {\r\n                handler.cb.apply(handler.domain || this, arg);\r\n                Logger.debug('event-trigger', type, arg.toString());\r\n            });\r\n            return true;\r\n        },\r\n        on: function (type, callback, domain) {\r\n            if (!this._eventHandler[type]) {\r\n                this._eventHandler[type] = [];\r\n            }\r\n            this._eventHandler[type].push({cb: callback, domain: domain});\r\n            return true;\r\n        },\r\n        off: function (type, callback, domain) {\r\n            var handlers = this._eventHandler[type];\r\n            if (handlers && handlers.length > 0) {\r\n                var len = handlers.length;\r\n                var handler;\r\n                for (var i = 0; i < len; i++) {\r\n                    handler = handlers[i];\r\n                    if (handler && callback === handler.cb) {\r\n                        if (domain && domain !== handler.domain) {\r\n                            continue;\r\n                        }\r\n                        handlers.splice(i, 1);\r\n                        i--;\r\n                        len--;\r\n                    }\r\n                }\r\n            }\r\n            if (handlers && handlers.length === 0) {\r\n                delete  this._eventHandler[type];\r\n            }\r\n        }\r\n    };\r\n    return EventBus;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/utils/eventUtils', function () {\r\n\r\n    var EventUtils = {\r\n        isDown: function (type) {\r\n            return type === 'touchstart' || type === 'mousedown';\r\n        },\r\n        isUp: function (type) {\r\n            return /^(touchend|touchcancel|mouseup|mouseleave)$/.test(type);\r\n        },\r\n        isMove: function (type) {\r\n            return type === 'mousemove' || type === 'touchmove';\r\n        },\r\n        isTouch: function (type) {\r\n            return /^(touchend|touchcancel|touchstart|touchmove)$/.test(type);\r\n        },\r\n        getPagePos: function (ev) {\r\n            var ev = ev.originalEvent ? ev.originalEvent : ev;\r\n            var point = {};\r\n            switch (ev.type) {\r\n                case 'touchstart':\r\n                case 'touchmove':\r\n                case 'touchend':\r\n                case 'touchcancel':\r\n                    point.x = ev.changedTouches[0].pageX;\r\n                    point.y = ev.changedTouches[0].pageY;\r\n                    return point;\r\n                default:\r\n                    point.x = ev.pageX;\r\n                    point.y = ev.pageY;\r\n                    return point;\r\n            }\r\n            return point;\r\n        },\r\n        /**\r\n         * 修复pc上移动后还可以触发点击事件的bug\r\n         */\r\n        fixPcClick: function (startPos, endPos, startTime, endTime) {\r\n            var _holdTime = endTime - startTime;\r\n            var dx = Math.abs(endPos.x - startPos.x);\r\n            var dy = Math.abs(endPos.y - startPos.y);\r\n            if (_holdTime > 800 || dx >= 4 || dy >= 4) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    };\r\n    return EventUtils;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/utils/graphMath', function () {\r\n\r\n    var GraphMath = {\r\n        /**\r\n         * 获取两条线的交点位置和坐标\r\n         * @param line1 {k:0.5,b:2}\r\n         * @param line2 kb\r\n         * @returns {*}\r\n         */\r\n        getTwoLineIntersection: function (a, b, c, d) {\r\n\r\n            /** 1 解线性方程组, 求线段交点. **/\r\n            // 如果分母为0 则平行或共线, 不相交\r\n            var denominator = (b.y - a.y) * (d.x - c.x) - (a.x - b.x) * (c.y - d.y);\r\n            if (denominator == 0) {\r\n                return false;\r\n            }\r\n\r\n            // 线段所在直线的交点坐标 (x , y)\r\n            var x = ( (b.x - a.x) * (d.x - c.x) * (c.y - a.y)\r\n                + (b.y - a.y) * (d.x - c.x) * a.x\r\n                - (d.y - c.y) * (b.x - a.x) * c.x ) / denominator;\r\n            var y = -( (b.y - a.y) * (d.y - c.y) * (c.x - a.x)\r\n                + (b.x - a.x) * (d.y - c.y) * a.y\r\n                - (d.x - c.x) * (b.y - a.y) * c.y ) / denominator;\r\n\r\n            /** 2 判断交点是否在两条线段上 **/\r\n            if (\r\n                // 交点在线段1上\r\n            Math.round((x - a.x) * (x - b.x)) <= 0 && Math.round((y - a.y) * (y - b.y)) <= 0\r\n                // 且交点也在线段2上\r\n            && Math.round((x - c.x) * (x - d.x)) <= 0 && Math.round((y - c.y) * (y - d.y)) <= 0\r\n            ) {\r\n\r\n                // 返回交点p\r\n                return {\r\n                    x: x,\r\n                    y: y\r\n                }\r\n            }\r\n            //否则不相交\r\n            return false\r\n        },\r\n        /**\r\n         * 获取弧度\r\n         * @param degree 角度\r\n         * @returns {number}\r\n         */\r\n        getRadian: function (degree) {\r\n            return (2 * Math.PI) / 360 * degree;\r\n        },\r\n        /**\r\n         * 获取角度\r\n         * @param degree 弧度\r\n         * @returns {number}\r\n         */\r\n        getDegree: function (radian) {\r\n            return (radian * 360) / (2 * Math.PI);\r\n        },\r\n        /**\r\n         * 获取直接kb值\r\n         * @param degree 与x轴角度\r\n         * @param pos 线上的一点\r\n         */\r\n        //getLineKb: function (degree, pos) {\r\n        //    var kb = {};\r\n        //    if (degree > 90) {\r\n        //        kb.k = Math.tan(this.getRadian(180 - degree));\r\n        //        kb.k = -kb.k;\r\n        //    } else {\r\n        //        kb.k = Math.tan(this.getRadian(degree));\r\n        //    }\r\n        //    //pos.y = k * pos.x + b;\r\n        //    kb.b = pos.y - kb.k * pos.x;\r\n        //    return kb;\r\n        //}\r\n        getLineKb: function (degree, pos) {\r\n            var kb = {};\r\n            degree = degree < 0? (degree+ 360) % 360: degree % 360;\r\n            kb.degree = degree;\r\n            //kb.k = Math.cos(this.getRadian(degree));\r\n            if(degree != 90 && degree != 270 && degree !=0 && degree != 180) {\r\n                kb.k = Math.tan(this.getRadian(degree));\r\n                //pos.y = k * pos.x + b;\r\n                kb.b = pos.y - kb.k * pos.x;\r\n                return kb;\r\n            }else if(degree == 90 || degree == 270){\r\n                kb.k = \"no_exist\";\r\n                kb.x = pos.x;\r\n                return kb;\r\n            }else if(degree == 0 || degree == 180) {\r\n                kb.k = 0;\r\n                kb.b = pos.y;\r\n                return kb;\r\n            }\r\n        }\r\n        ,\r\n        /**\r\n         * 获取弧长\r\n         * @param degree 角度\r\n         * @param r 半径\r\n         * @returns {number}\r\n         */\r\n        getArc: function (degree, r) {\r\n            return (2 * Math.PI * r * degree) / 360;\r\n        },\r\n        /**\r\n         * 获取差积\r\n         * @param originPos 焦点、原始坐标\r\n         * @param startPos  相对开始坐标\r\n         * @param endPos 结束坐标\r\n         * @returns {number}\r\n         */\r\n        getDifferent: function (originPos, startPos, endPos) {\r\n            var startVector = {\r\n                x: startPos.x - originPos.x,\r\n                y: startPos.y - originPos.y\r\n            };\r\n            var endVector = {\r\n                x: endPos.x - originPos.x,\r\n                y: endPos.y - originPos.y\r\n            };\r\n            return parseFloat(startVector.x * endVector.y) - parseFloat(endVector.x * startVector.y);//叉积\r\n        },\r\n        /**\r\n         * 余弦定理，已知三边，求角度\r\n         * @param a\r\n         * @param b\r\n         * @param c\r\n         * @returns {Number}\r\n         */\r\n        getCosineAngle: function (a, b, c) {\r\n            //余弦定理\r\n            //由余弦定理得a²=b²+c²-2bc*CosA\r\n            //∴CosA=(b²+c²-a²)/(2bc)=7/8\r\n            var cosA = (Math.pow(b, 2) + Math.pow(c, 2) - Math.pow(a, 2)) / (2 * b * c);\r\n            // 得到弧度\r\n            if(cosA >= -1 && cosA <= 1)\r\n            {\r\n                var acosA = Math.acos(cosA);\r\n            }else{\r\n                acosA = 0;\r\n            }\r\n            // 弧度转角度\r\n            //1弧度=180/π度\r\n            //1度=π/180弧度\r\n            return parseFloat(acosA * (180 / Math.PI));\r\n        },\r\n        getCosineAngleByPos: function (aPos, bPos, cPos) {\r\n            var a, b, c;\r\n            a = parseFloat(Math.sqrt(Math.pow(bPos.x - cPos.x, 2) + Math.pow(bPos.y - cPos.y, 2)));\r\n            b = parseFloat(Math.sqrt(Math.pow(bPos.x - aPos.x, 2) + Math.pow(bPos.y - aPos.y, 2)));\r\n            c = parseFloat(Math.sqrt(Math.pow(cPos.x - aPos.x, 2) + Math.pow(cPos.y - aPos.y, 2)));\r\n            return this.getCosineAngle(a, b, c);\r\n        },\r\n        /**\r\n         * 勾股定理，求C边的值\r\n         * @param a a边长\r\n         * @param b b边长\r\n         * @returns {number}\r\n         */\r\n        getPythagoreanLineC: function (a, b) {\r\n            return Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));\r\n        },\r\n        /**\r\n         * 已知角度和斜边长，求斜边坐标\r\n         * @param a a边长\r\n         * @param b b边长\r\n         * @returns {number}\r\n         */\r\n        getLinePosByAngle: function (angle, width) {\r\n            //TODO:确认一下角度超过90度时候的值是否是对称的\r\n            if (angle > 90) {\r\n                angle = 180 - angle;\r\n            }\r\n            var x = Math.cos(this.getRadian(angle)) * width;\r\n            var y = Math.sin(this.getRadian(angle)) * width;\r\n            return {x: x, y: y};\r\n        },\r\n        /**\r\n         * 获取svg扇形路径信息\r\n         * @param cx 旋转中心点 x坐标\r\n         * @param cy 旋转中心点 y坐标\r\n         * @param r 旋转半径\r\n         * @param startAngle 开始角度\r\n         * @param endAngle 结束角度\r\n         * @returns {string}\r\n         */\r\n        getSvgSectorPoint: function (cx, cy, r, startAngle, endAngle) {\r\n            var rad = Math.PI / 180;\r\n            var x1 = cx + r * Math.cos(-startAngle * rad),        //起始X点\r\n                y1 = cy + r * Math.sin(-startAngle * rad),        //起始Y点\r\n                x2 = cx + r * Math.cos(-endAngle * rad),        //结束X点\r\n                y2 = cy + r * Math.sin(-endAngle * rad);        //结束Y点\r\n            var ar = [];\r\n            ar.push('M');\r\n            ar.push(cx);\r\n            ar.push(cy);\r\n            ar.push(\"L\");\r\n            ar.push(x1);\r\n            ar.push(y1);\r\n            ar.push(\"A\");\r\n            ar.push(r);\r\n            ar.push(r);\r\n            ar.push(0);\r\n            ar.push(+(endAngle - startAngle > 180));\r\n            ar.push(0);\r\n            ar.push(x2);\r\n            ar.push(y2);\r\n            ar.push('z');\r\n            return ar.join(' ');\r\n        }\r\n        ,\r\n        /**\r\n         * 获取两点距离\r\n         * @param pos1 {x:100,y:100}\r\n         * @param pos2\r\n         * @returns {number}\r\n         */\r\n        getTwoPointDistance: function (pos1, pos2) {\r\n            var x = pos2.x - pos1.x,\r\n                y = pos2.y - pos1.y;\r\n            return Math.sqrt((x * x) + (y * y));\r\n        }\r\n        ,\r\n        /**\r\n         * 求点在圆上的坐标\r\n         * @param degree 角度\r\n         * @param r 半径\r\n         * @returns {{x: number, y: number}}\r\n         */\r\n        getSpherePos: function (degree, r) {\r\n\r\n            var x1 = 0 + r * Math.cos(degree * Math.PI / 180);\r\n            var y1 = 0 + r * Math.sin(degree * Math.PI / 180);\r\n\r\n            return {\r\n                x: x1,\r\n                y: y1\r\n            };\r\n        }\r\n        ,\r\n        /**\r\n         * 计算点a到线段bc的最短距离\r\n         * @param posa\r\n         * @param posb\r\n         * @param posc\r\n         */\r\n        getShortestDistanceAndPoint: function (posa, posb, posc) {\r\n            var ab = this.getTwoPointDistance(posa, posb);\r\n            var ac = this.getTwoPointDistance(posa, posc);\r\n            var bc = this.getTwoPointDistance(posb, posc);\r\n            var halfPerimeter = (ab + ac + bc) / 2;//半周长\r\n            //求面积：海伦公式\r\n            var S = Math.sqrt(halfPerimeter * (halfPerimeter - ab) * (halfPerimeter - ac) * (halfPerimeter - bc));\r\n            //另外一个面积公式： 底*高/2\r\n            var height = (2 * S) / bc;\r\n            //判断高是否在三角形内\r\n            var thirdLong = Math.max(ab, ac);\r\n            var hc = Math.sqrt((thirdLong * thirdLong) - (height * height));//计算高垂足点到c的位置\r\n            //计算出来的长度大于底边，在外部\r\n            var shortestDistance = 0;\r\n            var shortestPos = {};\r\n            if (hc > bc) {\r\n                shortestDistance = Math.min(ac, ab);\r\n                if (ac > ab) {\r\n                    shortestDistance = ab;\r\n                    shortestPos = posb;\r\n                } else {\r\n                    shortestDistance = ac;\r\n                    shortestPos = posc;\r\n                }\r\n            } else {\r\n                //返回最短距离\r\n                shortestDistance = height;\r\n                shortestPos = this.getRectVerticalPos(posa, posb, posc, height);//\r\n            }\r\n            return {\r\n                d: shortestDistance,//最短距离\r\n                pos: shortestPos,//高在a边上的坐标\r\n                h: height,//高\r\n                minSide: Math.min(ab, ac)\r\n            }\r\n        }\r\n        ,\r\n        /**\r\n         * 特例（矩形上的）已知直角对应的两点和两侧线长，求直接坐标\r\n         * @param pos1\r\n         * @param pos2\r\n         */\r\n        getRectVerticalPos: function (posa, posb, posc, height) {\r\n            var x = 0, y = 0;\r\n            if (posb.x === posc.x) {\r\n                x = posb.x;\r\n                y = posa.y;\r\n            } else if (posb.y = posc.y) {\r\n                y = posb.y;\r\n                x = posa.x;\r\n            }\r\n            return {\r\n                x: x,\r\n                y: y\r\n            }\r\n        }\r\n        ,\r\n        /**\r\n         * 计算点离矩形最短距离\r\n         * @param posa 点\r\n         * @param rect 矩形 {left:,top,right,bottom}\r\n         * @returns {number}\r\n         */\r\n        getRectShortestDistance: function (posa, rect) {\r\n            //上\r\n            var s = this.getShortestDistanceAndPoint(posa, {x: rect.left, y: rect.top}, {x: rect.right, y: rect.top});\r\n            //右\r\n            var y = this.getShortestDistanceAndPoint(posa, {x: rect.right, y: rect.top}, {x: rect.right, y: rect.bottom});\r\n            //下\r\n            var x = this.getShortestDistanceAndPoint(posa, {x: rect.left, y: rect.bottom}, {x: rect.right, y: rect.bottom});\r\n            //左\r\n            var z = this.getShortestDistanceAndPoint(posa, {x: rect.left, y: rect.top}, {x: rect.left, y: rect.bottom});\r\n\r\n            var target = s;\r\n\r\n            var d = Math.min(s.d, y.d, x.d, z.d);\r\n            if (d === s.d) {\r\n                target = s;\r\n                target.vertical = true;\r\n                target.direction = 'top';\r\n            }\r\n            if (d === y.d) {\r\n                target = y;\r\n                target.vertical = false;\r\n                target.direction = 'right';\r\n            }\r\n            if (d === x.d) {\r\n                target = x;\r\n                target.vertical = true;\r\n                target.direction = 'bottom';\r\n            }\r\n            if (d === z.d) {\r\n                target = z;\r\n                target.vertical = false;\r\n                target.direction = 'left';\r\n            }\r\n            return target;\r\n        }\r\n        ,\r\n        /**\r\n         * 定比点公式，获取线段上的第三点坐标\r\n         * @param posa 点a\r\n         * @param posb 点b\r\n         * @param ca 点c到a的距离\r\n         * @returns {{x: (number|*), y: (number|*)}}\r\n         */\r\n        getLightPos: function (posa, posb, ca) {\r\n            //http://www.zybang.com/question/0f4a343e136e33929290d3d599fc1d7c.html\r\n            var m, n;\r\n            var s = ca;\r\n            var a = posa.x;\r\n            var b = posa.y;\r\n            var c = posb.x;\r\n            var d = posb.y;\r\n\r\n            var M = this.getTwoPointDistance(posa, posb);\r\n            var la = s / (Math.sqrt(Math.pow((a - c), 2) + Math.pow((b - d), 2)) - s);\r\n            m = (a + la * c) / (1 + la);\r\n            n = (b + la * d) / (1 + la);\r\n            return {\r\n                x: m,\r\n                y: n\r\n            }\r\n        }\r\n        ,\r\n        /**\r\n         * 根据三点获取旋转角度\r\n         * @param posa 中心点\r\n         * @param posb 上一个点\r\n         * @param posc 当前点\r\n         * @returns {*}\r\n         */\r\n        getRotateAngle: function (posa, posb, posc) {\r\n            var angle;\r\n            //0度的时候\r\n            if((posa.x == posb.x && posb.x == posc.x) ||(posa.y == posb.y && posb.y == posc.y)){\r\n                angle = 0;\r\n            }else{\r\n                //通过三点计算旋转角度\r\n                angle = this.getCosineAngleByPos(posa, posb, posc);\r\n            }\r\n\r\n            //计算三点的差积，判断旋转方向\r\n            var different = this.getDifferent(posa, posb, posc);\r\n            if (different < 0) {\r\n                angle = -angle;\r\n            }\r\n            return angle;\r\n        },\r\n        /**\r\n         * http://blog.csdn.net/fly542/article/details/6638299\r\n         * 已知三点，求第三点到另外两点组成的垂线长度\r\n         * @param pos1\r\n         * @param pos2\r\n         * @param pos3\r\n         * @returns {number}\r\n         */\r\n        getPedalHeight: function (pos1, pos2, pos3) {\r\n            var A = (pos1.y - pos2.y) / (pos1.x - pos2.x);\r\n            var B = (pos1.y - A * pos1.y);\r\n            /// > 0 = ax +b -y;\r\n            return Math.abs(A * pos3.x + B - pos3.y) / Math.sqrt(A * A + 1);\r\n        },\r\n        /**\r\n         * 获取圆和线段的交点\r\n         * http://blog.csdn.net/luols/article/details/7476512\r\n         * @param ptStart 线起点\r\n         * @param ptEnd 线终点\r\n         * @param ptCenter 原心\r\n         * @param Radius 半径\r\n         * @returns {boolean}\r\n         * @constructor\r\n         */\r\n        getLineCircleIntersectionPos: function (ptStart, ptEnd, ptCenter, Radius) {\r\n            var EPS = 0.00001;\r\n            var ptInter1 = {};\r\n            var ptInter2 = {};\r\n            var fDis = Math.sqrt((ptEnd.x - ptStart.x) * (ptEnd.x - ptStart.x) + (ptEnd.y - ptStart.y) * (ptEnd.y - ptStart.y));\r\n            var d = {};\r\n            d.x = (ptEnd.x - ptStart.x) / fDis;\r\n            d.y = (ptEnd.y - ptStart.y) / fDis;\r\n            var E = {};\r\n            E.x = ptCenter.x - ptStart.x;\r\n            E.y = ptCenter.y - ptStart.y;\r\n            var a = E.x * d.x + E.y * d.y;\r\n            var a2 = a * a;\r\n            var e2 = E.x * E.x + E.y * E.y;\r\n            var Radius2 = Radius * Radius;\r\n            if ((Radius2 - e2 + a2) < 0) {\r\n                return false;\r\n            }\r\n            else {\r\n                var f = Math.sqrt(Radius2 - e2 + a2);\r\n                var t = a - f;\r\n                if (((t - 0.0) > -EPS) && (t - fDis) < EPS) {\r\n                    ptInter1.x = ptStart.x + t * d.x;\r\n                    ptInter1.y = ptStart.y + t * d.y;\r\n                }\r\n                t = a + f;\r\n                if (((t - 0.0) > -EPS) && (t - fDis) < EPS) {\r\n                    ptInter2.x = ptStart.x + t * d.x;\r\n                    ptInter2.y = ptStart.y + t * d.y;\r\n                }\r\n                return [ptInter1, ptInter2];\r\n            }\r\n        },\r\n        /**\r\n         * 根据折射率计算折射角\r\n         * @param incidentAngle 入射角\r\n         * @param refractivity 折射率\r\n         */\r\n        getRefractAngle: function(incidentAngle, refractivity){\r\n            incidentAngle =  incidentAngle < 0? incidentAngle + 360: incidentAngle;\r\n            var incidentAng;\r\n            if(incidentAngle <= 90){\r\n                incidentAng = 90 - incidentAngle ;\r\n            }else if(incidentAngle > 90 && incidentAngle <= 180){\r\n                incidentAng = incidentAngle - 90;\r\n            }else if(incidentAngle > 180 && incidentAngle <= 270){\r\n                incidentAng = 270 - incidentAngle;\r\n            }else{\r\n                incidentAng = incidentAngle - 270;\r\n            }\r\n            var incidentAngelRel = this.getRadian(incidentAng);\r\n            var asin = Math.sin(incidentAngelRel) / refractivity;\r\n            if(asin >= -1 && asin <= 1){\r\n                asin = Math.asin(asin);\r\n                var angle = this.getDegree(asin);\r\n                return angle;\r\n            }else{\r\n                return \"no_refract\";\r\n            }\r\n        },\r\n        /**\r\n         *一个线段数组，一个点\r\n         *判断折射点在哪条线段上,返回线段下标\r\n         *aPoint:{x:x, y:y}\r\n         *lineArr:[{degree:0, aPoint:{x:x, y:y}, bPoint:{x:x, y:y}},{},...]\r\n         */\r\n        inWhichLine: function(aPoint, linesArr, curLineIndex) {\r\n            var index = -1;\r\n            for (var i = 0; i < linesArr.length; i++) {\r\n                if(curLineIndex != undefined){\r\n                    if(i == curLineIndex){\r\n                        continue;\r\n                    }\r\n                }\r\n                var inline = false;\r\n                var linesArrKb = GraphMath.getLineKb(linesArr[i].degree, linesArr[i].aPoint);\r\n                if(linesArrKb.k != \"no_exist\"){\r\n                    if(linesArrKb.k * aPoint.x + linesArrKb.b - 5 <= aPoint.y && linesArrKb.k * aPoint.x + linesArrKb.b + 5 >= aPoint.y){ //误差的情况\r\n                        inline = true;\r\n                    }\r\n                }else{\r\n                    if(linesArrKb.x == aPoint.x){\r\n                        inline = true;\r\n                    }\r\n                }\r\n                if(inline == true){\r\n                    if (GraphMath.isInSegment(aPoint, linesArr[i].aPoint, linesArr[i].bPoint)) {\r\n                        index = i;\r\n                        break;\r\n                    } else {\r\n                        index = -1;\r\n                    }\r\n                }else{\r\n                    index = -1;\r\n                }\r\n            }\r\n            return index;\r\n        },\r\n        /**\r\n         *判断折射线线与哪条线段相交\r\n         *line:{degree:0, aPoint:{x: x, y: y}}\r\n         *lineArr:[{degree:0, aPoint:{x:x, y:y}, bPoint:{x:x, y:y}},{},...]\r\n         */\r\n        pointInLine: function(line, lineArr, index) {\r\n            //     var index = GraphMath.inWhichLine(line.aPoint, lineArr);\r\n            var lineKb = GraphMath.getLineKb(line.degree, line.aPoint);\r\n            var anotherPoint;\r\n            if(lineKb.k !=\"no_exist\" && lineKb.k != 0) {\r\n                if (lineKb.degree > 0 && lineKb.degree < 180) {\r\n                    anotherPoint = {x: (-10000 - lineKb.b) / lineKb.k, y: -10000};\r\n                } else {\r\n                    anotherPoint = {x: (10000 - lineKb.b) / lineKb.k, y: 10000};\r\n                }\r\n            }else if(lineKb.k ==\"no_exist\"){\r\n                if(lineKb.degree == 90){\r\n                    anotherPoint = {x: lineKb.x , y: -1000};\r\n                }else{\r\n                    anotherPoint = {x: lineKb.x , y: 1000};\r\n                }\r\n\r\n            }else if(lineKb.k ==0){\r\n                if(lineKb.degree == 0){\r\n                    anotherPoint = {x: -10000 , y: lineKb.b};\r\n                }else{\r\n                    anotherPoint = {x: 10000 , y: lineKb.b};\r\n                }\r\n            }\r\n            var acrossPoint, result = false;\r\n            var lineArrKb;\r\n            if (index >= 0 && typeof index == \"number\") {\r\n                for (var i = 0; i < lineArr.length; i++) {\r\n                    if (i != index) {\r\n\r\n                        lineArrKb = GraphMath.getLineKb(lineArr[i].degree, lineArr[i].aPoint);\r\n                        acrossPoint = GraphMath.getApointBytwoLine(lineKb, lineArrKb);\r\n                        var acrossPoint2 = GraphMath.getTwoLineIntersection(line.aPoint, anotherPoint, lineArr[i].aPoint, lineArr[i].bPoint);\r\n                        if (acrossPoint || acrossPoint2) {\r\n                            acrossPoint = GraphMath.isInSegment(acrossPoint, lineArr[i].aPoint, lineArr[i].bPoint) && GraphMath.isInSegment(acrossPoint, line.aPoint, anotherPoint);\r\n                            if (acrossPoint || acrossPoint2) {\r\n                                result = acrossPoint || acrossPoint2;\r\n                                index = i;\r\n                                break;\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                }\r\n                if(result){\r\n                    return {\r\n                        acrossPoint: result,\r\n                        index: index\r\n                    }\r\n                }else{\r\n                    //alert(\"折射点不在所有的线段上\");\r\n                    return false;\r\n                }\r\n            }else{\r\n                //alert(\"折射点不在所有的线段上\");\r\n\r\n\r\n                return false;\r\n            }\r\n        },\r\n        /**\r\n         *已知两条直线的k 和b，求两条直线交点\r\n         *求有木有交点\r\n         * line{\r\n         *  k:\r\n         *  b:\r\n         * }\r\n         */\r\n        getApointBytwoLine: function(line1, line2){\r\n            var result = {};\r\n            if(line1.k == line2.k){ //平行\r\n                return false;\r\n            }else if(line1.k == \"no_exist\" || line2.k == \"no_exist\") {\r\n                if(line1.k == \"no_exist\"){\r\n                    result = {\r\n                        x: line1.x,\r\n                        y: line2.k * line1.x + line2.b\r\n                    }\r\n                }else{\r\n         //           console.log(\"line2.x = \"+line2.x);\r\n                    result = {\r\n                        x: line2.x,\r\n                        y: line1.k * line2.x + line1.b\r\n                    }\r\n                }\r\n            }else{\r\n                var x = parseFloat((line2.b - line1.b) / (line1.k - line2.k));\r\n                var y = line1.k * x + line1.b;\r\n                result = {\r\n                    x: x,\r\n                    y: y\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        /**\r\n         * 判断交点在线段上\r\n         * insPoint： 交点（已经是直线上的点）\r\n         * aPoint、bPoint: 线段的两个点\r\n         */\r\n        isInSegment: function(insPoint, a, b){\r\n            var x = insPoint.x, y = insPoint.y;\r\n            /** 2 判断交点是否在两条线段上 **/\r\n            if (\r\n                // 交点在线段1上\r\n            (x - a.x) * (x - b.x) <= 0 && (y - a.y) * (y - b.y) <= 0\r\n            // 且交点也在线段2上\r\n            // && (x - c.x) * (x - d.x) <= 0 && (y - c.y) * (y - d.y) <= 0\r\n            ) {\r\n\r\n                // 返回交点p\r\n                return {\r\n                    x: x,\r\n                    y: y\r\n                }\r\n            }\r\n            //否则不在线段上\r\n            return false;\r\n        }\r\n\r\n    };\r\n    return GraphMath;\r\n})\r\n;\n/**\r\n * Created by ylf on 2015/12/13.\r\n */\r\n\r\ndefine('js/utils/logger', function () {\r\n    'use strict';\r\n\r\n    var methods = [\r\n        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',\r\n        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',\r\n        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',\r\n        'timeline', 'timelineEnd', 'timeStamp', 'trace', 'warn'\r\n    ];\r\n    var length = methods.length;\r\n    var _console = (window.console = window.console || {});\r\n    var method = null;\r\n\r\n    var emptyFuc = function () {\r\n    };\r\n\r\n    while (length--) {\r\n        method = methods[length];\r\n        // Only stub undefined methods.\r\n        if (!_console[method]) {\r\n            _console[method] = emptyFuc;\r\n        }\r\n    }\r\n\r\n    //logger level值(debug:3, info:2, warn:1, error: 0, close: -1)\r\n    var _logger = {\r\n        _level: 0,\r\n        _console: _console,\r\n        setLevel: function (level) {\r\n            switch (level) {\r\n                case 'debug':\r\n                    this._level = 3;\r\n                    break;\r\n                case 'info':\r\n                    this._level = 2;\r\n                    break;\r\n                case 'warn':\r\n                    this._level = 1;\r\n                    break;\r\n                case 'error':\r\n                    this._level = 0;\r\n                    break;\r\n                default:\r\n                    this._level = -1;\r\n            }\r\n        },\r\n        debug: function () {\r\n            if (this._level >= 3) {\r\n                this._console.log.apply(this._console, arguments);\r\n            }\r\n        },\r\n        info: function (msg) {\r\n            if (this._level >= 2) {\r\n                this._console.info.apply(this._console, arguments);\r\n            }\r\n        },\r\n        warn: function (msg) {\r\n            if (this._level >= 1) {\r\n                this._console.warn.apply(this._console, arguments);\r\n            }\r\n        },\r\n        error: function (msg) {\r\n            if (this._level >= 0) {\r\n                this._console.error.apply(this._console, arguments);\r\n            }\r\n        }\r\n    };\r\n\r\n    return _logger;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/4/9.\r\n */\r\ndefine('js/utils/string', function () {\r\n\r\n    var String = {\r\n        _templateRegExp: /\\$\\{(.+?)(?:\\:(.+?))?\\}/g,\r\n        //替换字符串\r\n        template: function (tpl, attrs) {\r\n            return tpl.replace(this._templateRegExp, function ($0, $1, $2) {\r\n                return attrs[$1] || $0;\r\n            });\r\n        },\r\n        /**\r\n         * 获取膜拜对应值\r\n         * @param text  minder_node_121_dasdfs\r\n         * @param tpl  minder_node_${id:number}_${name:string}\r\n         * @return {id:121,name:'dasdfs'}\r\n         */\r\n        getTemplateValue: function (text, tpl) {\r\n            //获取到数据类型\r\n            var tempRegExp = this.templateRegex(tpl);\r\n            var result = tempRegExp.regExp.exec(text);\r\n            if (!result) {\r\n                return null;\r\n            }\r\n\r\n            //获取所有key\r\n            var keys = Object.keys(tempRegExp.attrs);\r\n            var values = null;\r\n\r\n            //从1开始，略过匹配的全局字符串\r\n            for (var i = 1; i < result.length; i++) {\r\n                if (!values) {\r\n                    values = {};\r\n                }\r\n                if (keys.length > i - 1) {\r\n                    var key = keys[i - 1];\r\n                    if (tempRegExp.attrs[key] === 'number') {\r\n                        values[key] = parseInt(result[i]);\r\n                    } else {\r\n                        values[key] = result[i];\r\n                    }\r\n                }\r\n            }\r\n            return values;\r\n        },\r\n        //生成正则表达式\r\n        templateRegex: function (tpl) {\r\n            var attrs = {};\r\n            var regexStr = tpl.replace(this._templateRegExp, function ($0, $1, $2) {\r\n                attrs[$1] = $2;\r\n                if ($2) {\r\n                    if ($2 === 'number') {\r\n                        return '(\\\\d+?)';\r\n                    } else if ($2 === 'string') {\r\n                        return '(.+?)';\r\n                    }\r\n                }\r\n                else {\r\n                    return '(.+?)';\r\n                }\r\n            });\r\n            regexStr = '^' + regexStr + '$';\r\n            return {\r\n                regExp: new RegExp(regexStr),\r\n                attrs: attrs\r\n            };\r\n        }\r\n    };\r\n    return String;\r\n});\n/**\r\n * create by ylf 7/25\r\n * svg 操作相关\r\n */\r\ndefine('js/utils/svg', function () {\r\n\r\n    var transformRegex = {\r\n        translate: /translate\\(\\s*?([\\-0-9.]*)\\s*?([\\-0-9.]*)\\s*?\\)/,\r\n        rotate: /rotate\\(\\s*?([\\-0-9.]*)\\s*?([\\-0-9.]*)?\\s*?([\\-0-9.]*)?\\s*?\\)/\r\n    }\r\n\r\n    var svg = {\r\n        getRotateMatrix: function (angle, x, y) {\r\n            var rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\r\n            rect.setAttribute('transform', 'rotate(' + angle + ' ' + x + ' ' + y + ')');\r\n            var matrix = rect.getCTM();\r\n            return matrix;\r\n        },\r\n        getRotateKityMatrix: function (angle, x, y) {\r\n            var svgMatrix = this.getRotateMatrix(angle, x, y);\r\n            var matrix = new kity.Matrix(svgMatrix.a, svgMatrix.b, svgMatrix.c, svgMatrix.d, svgMatrix.e, svgMatrix.f);\r\n            return matrix;\r\n        },\r\n        rotate: function (node, angle, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            $(node).attr('transform', 'rotate(' + angle + ',' + x + ',' + y + ')');\r\n        },\r\n        setTranslate: function (node, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            $(node).attr('transform', 'translate(' + x + ',' + y + ')');\r\n        },\r\n        getAttrRotate: function (transform) {\r\n            var result = transformRegex.rotate.exec(transform);\r\n            if (result) {\r\n                result.shift();\r\n                result.forEach(function (item, i) {\r\n                    if (typeof item !== typeof undefined) {\r\n                        result[i] = parseFloat(item);\r\n                    } else {\r\n                        result[i] = 0;\r\n                    }\r\n                });\r\n                return result;\r\n            }\r\n            return [];\r\n        },\r\n        getAttrTranslate: function (transform) {\r\n            var result = transformRegex.translate.exec(transform);\r\n            if (result) {\r\n                result.shift();\r\n                result.forEach(function (item, i) {\r\n                    result[i] = parseFloat(item);\r\n                });\r\n                return result;\r\n            }\r\n            return [];\r\n        },\r\n        createJqForeignObject: function (cls) {\r\n            var foreignObject = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');\r\n            var $div = $('<div class=\"' + cls + '\"></div>');\r\n            $(foreignObject).html($div);\r\n            return $(foreignObject);\r\n        }\r\n    };\r\n\r\n    return svg;\r\n\r\n});\ndefine('js/utils/utils', function () {\r\n    var Utils = {\r\n        getFixedFloat: function (floatNum, digitalCount) {\r\n            var num = floatNum.toString();\r\n            var numAry = num.split('.');\r\n            if (numAry.length !== 2) {\r\n                return floatNum;\r\n            }\r\n            if (numAry[0] === '') {\r\n                numAry[0] = '0';\r\n            }\r\n            var len = numAry[1].length;\r\n            if (len === 0 || digitalCount === 0) {\r\n                return parseInt(numAry[0]);\r\n            }\r\n            var result = numAry[0] + '.' + numAry[1].substring(0, (digitalCount >= len ? len : digitalCount));\r\n            return parseFloat(result);\r\n        },\r\n        getValue: function (str, regex, index) {\r\n            var result = '';\r\n            var arr = str.match(regex);\r\n            if (typeof  index === 'number' && arr && arr.length > index) {\r\n                result = arr[index];\r\n            } else if (arr && arr.length === 2) {\r\n                result = arr[1];\r\n            }\r\n            return result;\r\n        },\r\n        getUuid: function () {\r\n            var s = [];\r\n            var hexDigits = \"0123456789abcdef\";\r\n            for (var i = 0; i < 36; i++) {\r\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n            }\r\n            s[14] = \"4\";  // bits 12-15 of the time_hi_and_version field to 0010\r\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01\r\n            s[8] = s[13] = s[18] = s[23] = \"-\";\r\n\r\n            var uuid = s.join(\"\");\r\n            return uuid;\r\n        },\r\n        isMobile: navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false,\r\n        supportTouch: 'ontouchend' in document\r\n    };\r\n\r\n    return Utils;\r\n\r\n});\n/**\r\n * create by ylf 2016/8/5\r\n * view相关 操作相关\r\n */\r\ndefine('js/utils/View', ['js/utils/GraphMath', 'js/utils/svg', 'js/utils/logger'], function (GraphMath, Svg, Logger) {\r\n    var ViewUtils = {\r\n        setVisibility: function ($$view, visible) {\r\n            $$view.setStyle({'visibility': visible ? '' : 'hidden'});\r\n        },\r\n        isVisibilityHidden: function ($$view) {\r\n            var style = $($$view.node).attr('style');\r\n            var hidden = /visibility:[\\s]*?hidden/.test(style || '');\r\n            return hidden;\r\n            //return $($$view.node).css('visibility') === 'hidden';\r\n        },\r\n        /**\r\n         * 让视图始终水平显示\r\n         * @param $$view 当前水平视图\r\n         * @param referenceView 参照视图，基于该视图旋转角度而变化\r\n         * @param r\r\n         * @param paddingX X轴偏移\r\n         * @param paddingY Y轴偏移\r\n         */\r\n        makeAbsViewHorizontal: function ($$view, angle, r, centerX, centerY, marginX, marginY, nagitive) {\r\n            marginX = marginX ? marginX : 0;\r\n            marginY = marginY ? marginY : 0;\r\n\r\n            //计算离原点的位置\r\n            var pos = GraphMath.getSpherePos(angle || 0, r);\r\n            var x, y;\r\n            if (nagitive) {\r\n                x = centerX + pos.x, y = centerY + pos.y;\r\n            } else {\r\n                x = centerX - pos.x, y = centerY - pos.y;\r\n            }\r\n            //定位到指定位置\r\n            $$view.setTranslate(x + ' ' + y);\r\n            //纠正位置，定位到文本节点正中间\r\n            var box = $$view.getRenderBox();\r\n            x = x + (x - box.cx) + marginX;\r\n            y = y + (y - box.cy) + marginY;\r\n            $$view.setTranslate(x + ' ' + y);\r\n        },\r\n        /**\r\n         * 视图已指定距离围绕旋转\r\n         * @param $$view\r\n         * @param $$referenceView\r\n         * @param r 旋转时候的过度快门，越大越快\r\n         * @param distance 围绕半径\r\n         * @param centerX 围绕中心点\r\n         * @param centerY\r\n         * @param marginX 视图偏移量\r\n         * @param marginY\r\n         * @param nagitive 正向还是方向旋转\r\n         */\r\n        makeViewAround: function ($$view, $$referenceView, r, distance, centerX, centerY, marginX, marginY, nagitive) {\r\n            //取一个大的值即可，保证不会和referenceview发生碰撞\r\n            var angle;\r\n            if (typeof $$referenceView === 'object') {\r\n                angle = Svg.getAttrRotate($$referenceView.getAttr('transform'))[0];\r\n            } else {\r\n                angle = $$referenceView;\r\n            }\r\n            var r = r;\r\n            //将点进行平移，并改变象限\r\n            this.makeAbsViewHorizontal($$view, angle, r, centerX, centerY, marginX, marginY, nagitive);\r\n\r\n            //矩形框的位置信息\r\n            var pointBox = $$view.getRenderBox();\r\n            //获取点到矩形的最短距离、坐标\r\n            var shortDistance = GraphMath.getRectShortestDistance({x: centerX, y: centerY}, pointBox);\r\n\r\n\r\n            //求原点离该距离的坐标\r\n            var asbPos = GraphMath.getLightPos({x: centerX, y: centerY}, shortDistance.pos, distance);\r\n            var subx = asbPos.x - shortDistance.pos.x;\r\n            var suby = asbPos.y - shortDistance.pos.y;\r\n            //求直线坐标\r\n            var translate = Svg.getAttrTranslate($$view.getAttr('transform'));\r\n            if (!isNaN(translate[0] + subx)) {\r\n                $$view.setTranslate(translate[0] + subx, translate[1] + suby);\r\n            } else {\r\n                Logger.warn($$view, 'makeViewAround error  isNAN');\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n\r\n    return ViewUtils;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/9/1.\r\n * 箭号\r\n */\r\ndefine('js/view/arrow', ['js/view/BaseView', 'js/config/style', 'js/utils/view'], function (BaseView, Style, View) {\r\n\r\n\r\n    var ArrowStyle = {\r\n        activeFill: kity.Color.parse('#fff'),\r\n        //这边类型和Arrow.Type一致\r\n        bgCls: {\r\n            '0': 'bg_blue ',\r\n            '1': 'bg_red',\r\n            '2': 'bg_purple'\r\n        }\r\n    };\r\n\r\n\r\n    var Arrow = BaseView({\r\n        _$$path: null,\r\n        _$$activePath: null,\r\n        _type: null,\r\n        _width: 42,\r\n        _contraryDirection: false,//是否反向\r\n        create: function (type, contraryDirection) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._type = type;\r\n            instance._contraryDirection = contraryDirection;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$activePath = new kity.Path('M6.913,46c-0.136,0-0.273-0.011-0.41-0.034c-1.06-0.176-1.889-1.01-2.059-2.071    c-1.172-7.314,4.579-15.533,7.306-18.948C3.348,13.541,4.311,6.795,4.456,6.033C4.632,5.102,5.32,4.352,6.232,4.094    C6.456,4.031,6.685,4,6.912,4C7.605,4,8.279,4.288,8.76,4.816c12.288,13.49,24.683,17.681,24.806,17.722    c0.993,0.327,1.677,1.236,1.716,2.281c0.04,1.044-0.575,2.002-1.54,2.403C14.267,35.3,9.17,44.578,9.12,44.671    C8.682,45.498,7.826,46,6.913,46z');\r\n            this._$$path = new kity.Path('M6.912,43.5c0,0,5.342-10.071,25.873-18.588c0,0-13-4.281-25.873-18.412    c0,0-1.268,6.674,8.038,18.526C14.95,25.026,5.593,35.268,6.912,43.5z');\r\n            this._$$activePath.fill(ArrowStyle.activeFill);\r\n            this._$$path.fill(ArrowStyle.activeFill);\r\n            this._$$path.setAttr('class', ArrowStyle.bgCls[this._type]);\r\n            this._$$clickArea = new kity.Rect().fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            //点击区域大小\r\n            this._$$clickArea.setSize(36, 60);\r\n            this._$$clickArea.setTranslate(0, -5);\r\n            if (this._contraryDirection) {\r\n                //\r\n                this.getView().setRotate(180,16,0);\r\n            }\r\n\r\n            this.addShape(this._$$activePath);\r\n            this.addShape(this._$$path);\r\n            this.addShape(this._$$clickArea);\r\n        },\r\n        getHeight: function () {\r\n            return 42;\r\n            //return this._$$activePath.getHeight();\r\n        },\r\n        getWidth: function () {\r\n            return 32;\r\n        },\r\n        active: function (active) {\r\n            View.setVisibility(this._$$activePath, active);\r\n        },\r\n        isActive: function () {\r\n            return !View.isVisibilityHidden(this._$$activePath);\r\n        },\r\n        changeType: function (type) {\r\n            this._$$path.setAttr('class', ArrowStyle.bgCls[type]);\r\n        },\r\n        restoreType: function () {\r\n            this._$$path.setAttr('class', ArrowStyle.bgCls[this._type]);\r\n        }\r\n\r\n    });\r\n\r\n    Arrow.Type = {\r\n        Blue: '0',\r\n        Red: '1',\r\n        Purple: '2'\r\n    };\r\n\r\n    return Arrow;\r\n})\r\n;\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/view/baseView', ['js/base/base', 'js/utils/utils', 'js/reflector/domevent', 'js/utils/svg', 'js/utils/graphMath', 'js/utils/view'], function (Base, Utils, DomEvent, Svg, GraphMath, View) {\r\n\r\n    var BaseView = {\r\n        __overwrite: ['domEventHandler', 'setVisibility'],\r\n        _uuid: null,\r\n        _$$view: null,\r\n        __base: function (eventbus, eventInfos) {\r\n            Base({}).__base.apply(this, [eventbus, eventInfos]);\r\n            if (!this._uuid) {\r\n                this._uuid = Utils.getUuid();\r\n            }\r\n            this._$$view = new kity.Group();\r\n        },\r\n        bindDomEvent: function (dom, domEvent, identifier, callback, stopPropagation) {\r\n            if (dom instanceof jQuery) {\r\n                dom = dom[0];\r\n            }\r\n            DomEvent.addDomEvent(dom, domEvent, identifier, stopPropagation);\r\n            this.__on(identifier, callback, '');\r\n        },\r\n        domEventHandler: function (uuid, eventType, dom) {\r\n            //各自实现来处理事件\r\n        },\r\n        getUuid: function () {\r\n            return this._uuid;\r\n        },\r\n        getView: function () {\r\n            return this._$$view;\r\n        },\r\n        addShape: function ($$shape) {\r\n            this._$$view.addShape($$shape);\r\n        },\r\n        setTranslate: function (x, y) {\r\n            if (arguments.length === 1 && typeof x === 'string') {\r\n                this._$$view.setTranslate(x);\r\n            } else {\r\n                this._$$view.setTranslate(x + ' ' + y);\r\n            }\r\n        },\r\n        setTranslateX: function (x) {\r\n            var translate = Svg.getAttrTranslate($(this._$$view.node).attr('transform'));\r\n            if (translate.length > 0) {\r\n                this.setTranslate(x, translate[1]);\r\n            }\r\n        },\r\n        setOpacity: function (opacity) {\r\n            this._$$view.setStyle({opacity: opacity});\r\n        },\r\n        translate: function (x, y) {\r\n            this._$$view.translate(x, y);\r\n        },\r\n        setVisible: function (visible) {\r\n            this._$$view.setVisible(visible);\r\n        },\r\n        isVisible: function () {\r\n            return (!this.isVisibilityHidden()) && this.getVisible();\r\n        },\r\n        setVisibility: function (visible) {\r\n            View.setVisibility(this._$$view, visible);\r\n        },\r\n        isVisibilityHidden: function () {\r\n            return View.isVisibilityHidden(this._$$view);// $(this._$$view.node).css('visibility') === 'hidden';\r\n        },\r\n        makeAbsViewHorizontal: function ($$view, angle, r, centerX, centerY, marginX, marginY, nagitive) {\r\n            View.makeAbsViewHorizontal($$view, angle, r, centerX, centerY, marginX, marginY, nagitive);\r\n        },\r\n        makeViewAround: function ($$view, $$referenceView, r, distance, centerX, centerY, marginX, marginY, nagitive) {\r\n            View.makeViewAround($$view, $$referenceView, r, distance, centerX, centerY, marginX, marginY, nagitive);\r\n        }\r\n    };\r\n\r\n\r\n    return function (cls) {\r\n        return Base(BaseView).__include(cls);\r\n    };\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/4.\r\n * 扇面名称和角度\r\n */\r\ndefine('js/view/EqualAngleName', ['js/view/BaseView', 'js/config/style'], function (BaseView, Style) {\r\n\r\n\r\n    var EqualAngleNameStyle = Style.EqualAngleName;\r\n\r\n\r\n    var EqualAngleName = BaseView({\r\n        create: function (lang) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$name = new kity.Text();\r\n            this._$$name.setContent(this._lang['rf_equal_angle_name']).setAttr('class', EqualAngleNameStyle.fontClass);\r\n            this.addShape(this._$$name);\r\n        }\r\n    });\r\n\r\n\r\n    return EqualAngleName;\r\n});\n/**\r\n * Created by ylf on 2016/7/29.\r\n */\r\ndefine('js/view/ForeignView', ['js/base/base', 'js/utils/utils', 'js/utils/svg'], function (Base, Utils, Svg) {\r\n\r\n    var ForeignView = Base({\r\n        _uuid: null,\r\n        _$view: null,\r\n        _$insideView: null,\r\n        _width: 0,\r\n        _height: 0,\r\n        _cls: '',\r\n        create: function (cls, width, height) {\r\n            var instance = Object.create(this);\r\n            instance.__base(null, []);\r\n            instance._cls = cls;\r\n            instance._uuid = Utils.getUuid();\r\n            instance._$view = Svg.createJqForeignObject(cls);\r\n            instance._$insideView = instance._$view.find('div');\r\n            instance.setWidth(width);\r\n            instance.setHeight(height);\r\n\r\n            return instance;\r\n        },\r\n        setDomEvent: function (domEvent) {\r\n            if (domEvent && domEvent.length > 0) {\r\n                this._$view.attr('class', '_lr_event');\r\n                this._$view.data('event-type', domEvent);\r\n                this._$view.data('event-identifier', this._uuid);\r\n            }\r\n        },\r\n        getUuid: function () {\r\n            return this._uuid;\r\n        },\r\n        setWidth: function (width) {\r\n            this._width = width;\r\n            this._$view.css({width: width});\r\n            this._$view.attr(\"width\", width);\r\n            this._$insideView.css({width: width});\r\n            return this;\r\n        },\r\n        setHeight: function (height) {\r\n            this._height = height;\r\n            this._$view.css({height: height});\r\n            this._$view.attr(\"height\", height);\r\n            this._$insideView.css({height: height});\r\n            return this;\r\n        },\r\n        setForeignWidth:function (width) {\r\n            this._$view.attr('width', width);\r\n        },\r\n        setForeignHeight:function (height) {\r\n            this._$view.attr('height', height);\r\n        },\r\n        setInsideWidth:function (width) {\r\n            this._$insideView.css({width: width});\r\n        },\r\n        setInsideHeight:function (height) {\r\n            this._$insideView.css({height: height});\r\n        },\r\n        getView: function () {\r\n            return this._$view;\r\n        },\r\n        appendHtml: function (html) {\r\n            this._$insideView.append(html);\r\n        },\r\n        setTranslate: function (x, y) {\r\n            var rotate = Svg.getAttrRotate(this._$view.attr('transform'));\r\n            var translate = [x, y];\r\n            this.applyTransform(translate, rotate);\r\n        },\r\n        setRotate: function (degre, cx, cy) {\r\n            var translate = Svg.getAttrTranslate(this._$view.attr('transform'));\r\n            var rotate = [degre];\r\n            if (typeof cx !== typeof  undefined && typeof cy !== typeof  undefined) {\r\n                rotate.push(cx);\r\n                rotate.push(cy);\r\n            }\r\n            this.applyTransform(translate, rotate);\r\n        },\r\n        applyTransform: function (translate, rotate) {\r\n            var transform = '';\r\n            if (translate.length > 1) {\r\n                transform = 'translate(' + translate[0] + ' ' + translate[1] + ')';\r\n            }\r\n            if (rotate.length === 1) {\r\n                transform += ' rotate(' + rotate[0] + ')';\r\n            } else if (rotate.length === 3) {\r\n                transform += ' rotate(' + rotate[0] + ' ' + rotate[1] + ' ' + rotate[2] + ')';\r\n            }\r\n            this._$view.attr('transform', transform);\r\n        },\r\n        setVisible: function (visible) {\r\n            if (visible) {\r\n                this._$view.show();\r\n            } else {\r\n                this._$view.hide();\r\n            }\r\n        },\r\n        setVisibility: function (visible) {\r\n            this._$view.css({'visibility': visible ? '' : 'hidden'});\r\n        },\r\n        setOpacity: function (opacity) {\r\n            this._$view.css({opacity: opacity});\r\n        },\r\n        setAttr: function (key, val) {\r\n            this._$view.attr(key, val);\r\n        },\r\n        addClass: function (cls) {\r\n            this._$insideView.addClass(cls);\r\n        },\r\n        removeClass: function (cls) {\r\n            this._$insideView.removeClass(cls);\r\n        },\r\n        hasClass: function (cls) {\r\n            return this._$insideView.hasClass(cls);\r\n        }\r\n    });\r\n\r\n\r\n    return ForeignView;\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/15.\r\n * 垂足符号\r\n */\r\ndefine('js/view/IncidencePoint', ['js/view/BaseView', 'js/config/style', 'js/utils/view'], function (BaseView, Style) {\r\n\r\n    var IncidencePointStyle = Style.IncidencePoint;\r\n\r\n    var IncidencePoint = BaseView({\r\n        _$$line: null,\r\n        create: function (data) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._data = data;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$incidencePoint = new kity.Circle(IncidencePointStyle.width).fill(IncidencePointStyle.fill);\r\n            this._$$incidencePoint = new kity.Circle(IncidencePointStyle.width).fill(IncidencePointStyle.fill);\r\n            this.addShape(this._$$incidencePoint);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            this._$$line.setRotate(angle + ' ' + x + ' ' + y);\r\n        }\r\n    });\r\n\r\n\r\n    return IncidencePoint;\r\n});\n/**\r\n * Created by hsm on 2016/8/24.\r\n * 入射线\r\n */\r\ndefine('js/view/Inverserefractionline', ['js/view/BaseView', 'js/config/style', 'js/utils/view', 'js/utils/svg'], function (BaseView, Style, View, Svg) {\r\n\r\n\r\n    var InverseRefractionLineStyle = Style.InverseRefractionLine;\r\n\r\n    var InverseRefractionLine = BaseView({\r\n        _$$line: null,\r\n        _domEvent: null,\r\n        _width: 200,\r\n        _$$name: null,\r\n        _pointVisible: false,\r\n        _lineVisible: false,\r\n        create: function (width) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._width = width;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            //1.反向折射线\r\n            this._$$line = new kity.Path('').setStyle(InverseRefractionLineStyle.strokeStyle);\r\n            this._$$line.setAttr('d', 'M0 0 ' + this._width + ' 0');\r\n            this._$$line.setAttr('stroke-dasharray', '15,12');\r\n            this.addShape(this._$$line);\r\n\r\n            //2.名称\r\n            this._$$name = new kity.Text();\r\n            this._$$name.setContent(InverseRefractionLineStyle.name).setAttr('class', InverseRefractionLineStyle.fontClass);\r\n            this.addShape(this._$$name);\r\n\r\n            //3.入射点名称\r\n            this._$$nameDown = new kity.Text();\r\n            this._$$nameDown.setContent(InverseRefractionLineStyle.incidencePointName).setAttr('class', InverseRefractionLineStyle.fontClass);\r\n            this.addShape(this._$$nameDown);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? this._width : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            this._$$line.setRotate(angle + ' ' + x + ' ' + y);\r\n            this.initNamePos(x, y);\r\n        },\r\n        getRotateAngle: function () {\r\n            var rotate = Svg.getAttrRotate(this._$$line.getAttr('transform'));\r\n            return rotate[0];\r\n        },\r\n        initNamePos: function (centerX, centerY) {\r\n            centerX = typeof centerX === typeof undefined ? this._width : centerX;\r\n            centerY = typeof centerY === typeof undefined ? 0 : centerY;\r\n            var downWidth = this._$$nameDown.getWidth();\r\n            var nameWidth = this._$$name.getWidth();\r\n            this.makeViewAround(this._$$name, this._$$line, this._width, this._width + 25, centerX, centerY, -nameWidth / 2 + 5, 0, false);\r\n            this.makeViewAround(this._$$nameDown, this._$$line, 150, 25, centerX, centerY, -downWidth / 2 + 5, 0, true);\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this._$$nameDown.setContent(visible === true ? InverseRefractionLineStyle.incidencePointName : '');\r\n            this._$$name.setContent(visible === true ? InverseRefractionLineStyle.name : '');\r\n            this.initNamePos();\r\n        },\r\n        setPointNameVisibility: function (nameVisible, visible) {\r\n            this._pointVisible = visible;\r\n            this._$$nameDown.setContent(nameVisible === true ? InverseRefractionLineStyle.incidencePointName : '');\r\n            View.setVisibility(this._$$nameDown, visible);\r\n            View.setVisibility(this._$$name, this._lineVisible);\r\n            View.setVisibility(this._$$line, this._lineVisible);\r\n            this.setVisibility(true);\r\n            this.initNamePos();\r\n        },\r\n        setLineVisibility: function (nameVisible, visible) {\r\n            this._lineVisible = visible;\r\n            this._$$name.setContent(nameVisible === true ? InverseRefractionLineStyle.name : '');\r\n            View.setVisibility(this._$$name, visible);\r\n            View.setVisibility(this._$$nameDown, this._pointVisible);\r\n            View.setVisibility(this._$$line, visible);\r\n            this.setVisibility(true);\r\n            this.initNamePos();\r\n        },\r\n        showAll: function () {\r\n            this.setVisibility(true);\r\n            View.setVisibility(this._$$name, true);\r\n            View.setVisibility(this._$$nameDown, true);\r\n            View.setVisibility(this._$$line, true);\r\n            this.initNamePos();\r\n        },\r\n        getLineVisible: function () {\r\n            return this._lineVisible;\r\n        },\r\n        getPointNameVisible: function () {\r\n            return this._pointVisible;\r\n        }\r\n    });\r\n\r\n    return InverseRefractionLine;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 入射线\r\n */\r\ndefine('js/view/LightLine', ['js/view/BaseView', 'js/config/style', 'js/utils/utils', 'js/utils/graphmath', 'js/utils/svg', 'js/view/ForeignView', 'js/config/eventKey', 'js/utils/view'], function (BaseView, Style, Utils, GraphMath, Svg, ForeignView, EventKey, View) {\r\n\r\n\r\n    var LineStyle = Style.LineStyle;\r\n    var strokeWidth = LineStyle.strokeStyle['stroke-width'];\r\n    var Arrow = require('js/view/arrow');\r\n\r\n    var CONFIG = {\r\n        width: 290,//整体长度\r\n        arrowPos: 145,//箭号所在位置\r\n        visible: true,//是否显示\r\n        clickAble: true,//是否允许点击和移动\r\n        nameEnable: true//是否需要名称支持\r\n    };\r\n\r\n    var LightLine = BaseView({\r\n        _$$lineGroup: null,\r\n        _lineGroupUuid: '',\r\n        _$$lintWhite: null,\r\n        _arrow: null,\r\n        _fwBtn: null,\r\n        _fwTranBtn: null,\r\n        _config: null,\r\n        _lightType: null,\r\n        _$$name: null,\r\n        _onLightMove: null,\r\n        _onLightTrans: null,\r\n        _onLightFocusBlur: null,//点击光线需要改变场景的背景\r\n        _lang: null,\r\n        create: function (eventbus, lightType, config, onLightMove, onLightTrans, onLightFocusBlur, lang) {\r\n            var instance = Object.create(this);\r\n            var eventInfos = [];\r\n            eventInfos.push({key: EventKey.Blur, callback: instance.blur, params: []});\r\n            //instance._uuid = Utils.getUuid();\r\n            //eventInfos.push({key: EventKey.BtnMove + instance._uuid, callback: instance.domEventHandler, params: []});\r\n            instance.__base(eventbus, eventInfos);\r\n            instance._lightType = lightType;\r\n            instance._config = $.extend(true, {}, CONFIG, config);\r\n            instance._onLightMove = onLightMove;\r\n            instance._onLightTrans = onLightTrans;\r\n            instance._onLightFocusBlur = onLightFocusBlur;\r\n            instance._lineGroupUuid = Utils.getUuid();\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            instance.__on(EventKey.BtnMove + instance._fwBtn.getUuid(), instance.domEventHandler, []);\r\n            instance.__on(EventKey.BtnMove + instance._fwTranBtn.getUuid(), instance.domEventHandler, []);\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n\r\n            //添加一个标记，用于获取缩放值\r\n            this._$$offsetPoint = new kity.Circle(10).fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            this.addShape(this._$$offsetPoint);\r\n\r\n            //添加名称\r\n            this._$$name = new kity.Text();\r\n            var name = this._lightType === LightLine.Type.IncidenceLine ? this._lang['rf_incidence_line_name'] : this._lang['rf_refraction_line_name'];\r\n            this._$$name.setContent(name).setAttr('class', LineStyle[this._lightType].fontClass);\r\n            this.addShape(this._$$name);\r\n\r\n            this._$$lineGroup = new kity.Group();\r\n\r\n\r\n            //添加白边\r\n            this._$$lintWhite = new kity.Rect().setStyle(LineStyle.strokeStyle);\r\n            this._$$lintWhite.setSize(this.getWidth() + strokeWidth, LineStyle.rectHeight + strokeWidth);\r\n            this._$$lintWhite.translate(-strokeWidth / 2, -strokeWidth / 2);\r\n            this._$$lineGroup.addShape(this._$$lintWhite);\r\n\r\n            //添加箭头\r\n            this._arrow = Arrow.create(this._lightType === LightLine.Type.IncidenceLine ? Arrow.Type.Blue : Arrow.Type.Red, this._lightType === LightLine.Type.RefractionLine);\r\n            this._$$lineGroup.addShape(this._arrow.getView());\r\n\r\n            this.initArrowPos();\r\n\r\n            //增加透明区域，放大点击区域\r\n            this._$$lintClick = new kity.Rect().fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            var clickWidth = LineStyle.arrow.height / 5;\r\n            this._$$lintClick.setSize(this.getWidth() + strokeWidth, clickWidth);\r\n            this._$$lintClick.translate(0, -(clickWidth - LineStyle.rectHeight) / 2);\r\n            this._$$lineGroup.addShape(this._$$lintClick);\r\n\r\n\r\n            //添加白边内实心矩形\r\n            this._$$whiteRect = new kity.Rect();\r\n            this._$$whiteRect.setSize(this.getWidth(), LineStyle.rectHeight);\r\n            this._$$whiteRect.fill(LineStyle[this._lightType].fill);\r\n            this._$$lineGroup.addShape(this._$$whiteRect);\r\n\r\n            //旋转按钮\r\n            this._fwBtn = ForeignView.create('btn_rotate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            //this._fwBtn.setTranslate(-LineStyle.btnRotate.width - 10, (LineStyle.rectHeight - LineStyle.btnRotate.height) / 2);\r\n            this._fwBtn.setTranslate(0, -LineStyle.btnRotate.height - 10);\r\n            this._fwBtnInvisible = ForeignView.create('btn_rotate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            //this._fwBtnInvisible.setTranslate(-LineStyle.btnRotate.width - 10, (LineStyle.rectHeight - LineStyle.btnRotate.height) / 2);\r\n            this._fwBtnInvisible.setTranslate(0, -LineStyle.btnRotate.height - 10);\r\n            this._fwBtnInvisible.setVisibility(false);\r\n            this._fwBtn.setVisibility(false);\r\n            $(this._$$lineGroup.node).append(this._fwBtn.getView());\r\n            $(this._$$lineGroup.node).append(this._fwBtnInvisible.getView());\r\n\r\n            //平移按钮\r\n            this._fwTranBtn = ForeignView.create('btn_translate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            this._fwTranBtn.setTranslate(0, LineStyle.btnRotate.height -45);\r\n            /*记录初始位置用*/\r\n            this._fwTranBtnInvisible = ForeignView.create('btn_translate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            this._fwTranBtnInvisible.setTranslate(0, LineStyle.btnRotate.height -45);\r\n            this._fwTranBtnInvisible.setVisibility(false);\r\n            this._fwTranBtn.setVisibility(false);\r\n            $(this._$$lineGroup.node).append(this._fwTranBtn.getView());\r\n            $(this._$$lineGroup.node).append(this._fwTranBtnInvisible.getView());\r\n\r\n            this.addShape(this._$$lineGroup);\r\n\r\n            //绑定事件\r\n            //this.bindDomEvent(this._fwBtn.getView(), ['beforemove', 'move', 'aftermove'], this._fwBtn.getUuid(), this.domEventHandler, false);\r\n            //this.bindDomEvent(this._fwTranBtn.getView(), ['beforemove', 'move', 'aftermove'], this._fwTranBtn.getUuid(), this.domEventHandler, false);\r\n            this.bindDomEvent(this._$$lineGroup.node, ['lrTap'], this._lineGroupUuid, this.domEventHandler, false);\r\n\r\n            this.initView();\r\n        },\r\n        getWidth: function () {\r\n            return this._config.width;\r\n        },\r\n        setWidth: function (width) {\r\n            this._config.width =  width=isNaN(width)? this._config.width: width;\r\n\r\n            //this._config.arrowPos = (width - this._arrow.getWidth()) / 2;\r\n            if (this._lightType === LightLine.Type.RefractionLine) {\r\n                this._config.arrowPos = (width - this._arrow.getWidth()) / 3;\r\n            }else{\r\n                this._config.arrowPos = (width - this._arrow.getWidth()) - (width - this._arrow.getWidth()) / 3;\r\n            }\r\n\r\n            //线没有箭号长时，隐藏入射箭号\r\n            if (this._config.width <= this._arrow.getWidth() + 10) {\r\n                this._arrow.setVisibility(false);\r\n            } else {\r\n                this._arrow.setVisibility(true);\r\n            }\r\n            this._$$lintWhite.setSize(this.getWidth() + strokeWidth, LineStyle.rectHeight + strokeWidth);\r\n            var clickWidth = LineStyle.arrow.height / 3;\r\n            this._$$lintClick.setSize(this.getWidth() + strokeWidth, clickWidth);\r\n            this._$$whiteRect.setSize(this.getWidth(), LineStyle.rectHeight);\r\n\r\n            this.initArrowPos();\r\n            this.setTranslate(-this.getWidth(), -1);\r\n            var rotate = Svg.getAttrRotate(this._$$lineGroup.getAttr('transform'));\r\n            if (rotate && rotate.length > 0) {\r\n                this._$$lineGroup.setRotate((rotate[0] ) + ' ' + this.getWidth() + ' ' + rotate[2]);\r\n            }\r\n            //移动按钮不超过线末端\r\n\r\n            this._tranBtnTranslate();\r\n            this.initNamePos();\r\n        },\r\n        setArrowPos: function (arrowPos) {\r\n            this._config.arrowPos = isNaN(arrowPos)? this._config.arrowPos: arrowPos;\r\n            this.initArrowPos();\r\n        },\r\n        initArrowPos: function () {\r\n            //这里加上两个偏差\r\n            if (this._lightType === LightLine.Type.RefractionLine) {\r\n                this._arrow.setTranslate(this.getArrowPos(), (LineStyle.rectHeight + this._arrow.getHeight()) / 2 + 3.5);\r\n            } else {\r\n                this._arrow.setTranslate(this.getArrowPos(), ( -this._arrow.getHeight() - LineStyle.rectHeight) / 2 + 1+3);\r\n            }\r\n        },\r\n        getArrowPos: function () {\r\n            return this._config.arrowPos;\r\n        },\r\n        blur: function (uuid) {\r\n            if (uuid !== this._lineGroupUuid) {\r\n                //this._fwBtn.setVisible(false);\r\n\r\n                this.setFwBtnVisible(false);\r\n                this._$$lintWhite.setVisible(false);\r\n                this._arrow.active(false);\r\n\r\n                this._fwTranBtn.setVisible(false);\r\n                this._onLightFocusBlur(\"blur\");\r\n            }\r\n        },\r\n        setClickAble: function (clickable) {\r\n            this._config.clickAble = clickable;\r\n        },\r\n        domEventHandler: function (eventType, uuid, data) {\r\n            if (!this._config.clickAble) {\r\n                return;\r\n            }\r\n            if (uuid === this._fwBtn.getUuid()) {\r\n                this._onLightMove(this._lightType, data, eventType);\r\n                if (eventType === 'aftermove') {\r\n                    this.__triggerEvent('insidechange', this._lightType + '-move');\r\n                }\r\n            } else if (uuid === this._fwTranBtn.getUuid()) {\r\n                this._onLightTrans(this._lightType, data, eventType);\r\n\r\n                if (eventType === 'aftermove') {\r\n                    this.__triggerEvent('insidechange', this._lightType + '-move');\r\n                }\r\n            } else if (uuid === this._lineGroupUuid) {\r\n                if (eventType === 'lrTap') {\r\n                    if (this._arrow.isActive()) {\r\n                        this.blur();\r\n                        return;\r\n                    }\r\n                    //this._fwBtn.setVisible(true);\r\n\r\n                    this.setFwBtnVisible(true);\r\n                    this._$$lintWhite.setVisible(true);\r\n                    this._arrow.active(true);\r\n                    this._fwTranBtn.setVisible(true);\r\n                    this._onLightFocusBlur(\"focus\");\r\n                }\r\n            }\r\n            this.btnStillInBox();\r\n            this._tranBtnTranslate();\r\n        },\r\n        initView: function () {\r\n            //this._fwBtn.setVisible(false);\r\n            this.setFwBtnVisible(false);\r\n            this._fwTranBtn.setVisible(false);\r\n            this._$$lintWhite.setVisible(false);\r\n            this._arrow.active(false);\r\n            if (this._config.nameEnable === false) {\r\n                View.setVisibility(this._$$name, false)\r\n            }\r\n            this.setVisibility(this._config.visible);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? LineStyle.rectHeight / 2 : y;\r\n\r\n            this._$$lineGroup.setRotate(angle + ' ' + x + ' ' + y);\r\n            this.initNamePos(x, y);\r\n            this.fwBtnMove();\r\n        },\r\n        rotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? LineStyle.rectHeight / 2 : y;\r\n            var rotate = Svg.getAttrRotate(this._$$lineGroup.getAttr('transform'));\r\n            if (rotate && rotate.length > 0) {\r\n                this._$$lineGroup.setRotate((rotate[0] + angle) + ' ' + x + ' ' + y);\r\n            } else {\r\n                this._$$lineGroup.setRotate(angle + ' ' + x + ' ' + y);\r\n            }\r\n            this.initNamePos(x, y);\r\n            this.fwBtnMove();\r\n        },\r\n        getRotateAngle: function () {\r\n            var rotate = Svg.getAttrRotate(this._$$lineGroup.getAttr('transform'));\r\n            return rotate[0];\r\n        },\r\n        initNamePos: function (x, y) {\r\n            return false;\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? LineStyle.rectHeight / 2 : y;\r\n            //this.makeViewHorizontal(this._$$name, this._$$lineGroup, this._width, 60, 0);\r\n            this.makeViewAround(this._$$name, this._$$lineGroup, this.getWidth(), this.getWidth() + 15, x, y, 0, 10, false);\r\n        },\r\n        getRotatePos: function () {\r\n            return {x: this.getWidth(), y: LineStyle.rectHeight / 2};\r\n        },\r\n        setNameVisible: function (visible) {\r\n            if (this._config.nameEnable) {\r\n                View.setVisibility(this._$$name, visible);\r\n            }\r\n        },\r\n        //设置公共线样式\r\n        setCommonFill: function () {\r\n            this._$$whiteRect.fill(LineStyle.commonLineFill);\r\n            this._arrow.changeType(Arrow.Type.Purple);\r\n        },\r\n        //从公共线还原\r\n        restoreFill: function () {\r\n            this._$$whiteRect.fill(LineStyle[this._lightType].fill);\r\n            this._arrow.restoreType();\r\n        },\r\n        setNameEnable: function (nameEnable) {\r\n            this._config.nameEnable = nameEnable;\r\n            View.setVisibility(this._$$name, nameEnable);\r\n        },\r\n        getNameEnable: function () {\r\n            return this._config.nameEnable;\r\n        },\r\n        setOpacityIgnoreName: function (opacity) {\r\n            $(this._$$lineGroup.node).css({opacity: opacity});\r\n            $(this._arrow.getView()).css({opacity: opacity});\r\n            $(this._$$lineGroup.node).css({opacity: opacity});\r\n        },\r\n        setVisibility: function (visible) {\r\n            BaseView({}).setVisibility.apply(this, [visible]);\r\n            this.__triggerEvent(EventKey.LightLineVisible, this._lightType, visible);\r\n        },\r\n\r\n        makeNameViewAround: function (aroundLineAngle, x, y) {\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? LineStyle.rectHeight / 2 : y;\r\n            aroundLineAngle = typeof aroundLineAngle === typeof undefined ? this._$$lineGroup : aroundLineAngle;\r\n            this.makeViewAround(this._$$name, aroundLineAngle, this.getWidth(), this.getWidth() + 10, x, y, 0, 0, false);\r\n        },\r\n        getLightType: function () {\r\n            return this._lightType;\r\n        },\r\n        _tranBtnTranslate: function () {\r\n            var rotateTranslate = Svg.getAttrTranslate(this._fwBtn.getView().attr('transform'));\r\n            var tranBtnTranslate = Svg.getAttrTranslate(this._fwTranBtn.getView().attr('transform'));\r\n            var translateX = rotateTranslate[0];\r\n            this._fwTranBtn.setTranslate(translateX, tranBtnTranslate[1]);\r\n            this.fwBtnMove();\r\n        },\r\n        btnStillInBox: function () {\r\n            var svg = this._fwBtn.getView().closest('svg');\r\n            var originalRect = this._fwBtnInvisible.getView()[0].getBoundingClientRect();\r\n            var svgRect = this._fwBtn.getView().closest('svg')[0].getBoundingClientRect();\r\n            var originalRectTran =  this._fwTranBtnInvisible.getView()[0].getBoundingClientRect();/*平移按钮默认位置*/\r\n            this.originalRect = originalRect;\r\n            this.svgRect = svgRect;\r\n            var angle = Math.abs(this.getRotateAngle() % 180);\r\n            //统一计算与X轴锐角\r\n            if (angle <= 0) {\r\n                angle = -angle;\r\n            }\r\n            if (angle > 90) {\r\n                angle = 180 - angle;\r\n            }\r\n\r\n            var translate = Svg.getAttrTranslate(this._fwBtnInvisible.getView().attr('transform'));\r\n            if (translate.length <= 0) {\r\n                return;\r\n            }\r\n\r\n            //inside svg\r\n            if (originalRect.bottom <= svgRect.bottom && originalRect.left >= svgRect.left && originalRect.right <= svgRect.right && originalRect.top >= svgRect.top && originalRectTran.bottom <= svgRect.bottom && originalRectTran.left >= svgRect.left && originalRectTran.right <= svgRect.right && originalRectTran.top >= svgRect.top) {\r\n                //this._fwBtn.setTranslate(-LineStyle.btnRotate.width - 10, translate[1]);\r\n                //this._fwBtn.setTranslate(-LineStyle.btnRotate.width - 10, translate[1]);\r\n                this.fwBtnTranslate(0, translate[1]);\r\n\r\n            } else {\r\n                var translateX = 0;\r\n                var scale = this.getScale();\r\n                if (originalRect.left <= svgRect.left || originalRectTran.left <= svgRect.left) {\r\n                    //超出左侧\r\n                   // var subY = svgRect.left - originalRect.left;\r\n                    //var x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n\r\n                    var x = 0;\r\n                    //if(angle != 90){\r\n                    //    x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n                    //}\r\n\r\n                    translateX = translate[0] - ( -x);\r\n                    //this._fwBtn.setTranslate(translateX, translate[1]);\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                    //svg.trigger('mouseleave');\r\n                    //svg.trigger('mouseup');\r\n                }\r\n\r\n                //超出右側\r\n                if (originalRect.right >= svgRect.right || originalRectTran.right >= svgRect.right) {\r\n                  //  var subY =  originalRect.right -svgRect.right;\r\n                    //var x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n                    var x = 0;\r\n\r\n                    //if(angle != 90){\r\n                    //    x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n                    //}\r\n                    translateX = translate[0] - ( -x);\r\n\r\n\r\n                    //this._fwBtn.setTranslate(translateX, translate[1]);\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                    //svg.trigger('mouseleave');\r\n                    //svg.trigger('mouseup');\r\n                }\r\n\r\n                if (originalRect.bottom >= svgRect.bottom) {\r\n                    // 超出下方\r\n                    var subY = originalRect.bottom - svgRect.bottom;\r\n                    //var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    var x = 0;\r\n                    if(angle != 0){\r\n                        x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    }\r\n                    if (translateX == 0 || translateX < translate[0] + x) {\r\n                        translateX = translate[0] + x\r\n                    }\r\n\r\n                    //this._fwBtn.setTranslate(translateX, translate[1]);\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n                /*平移按钮超出下方*/\r\n                if (originalRectTran.bottom >= svgRect.bottom) {\r\n                    // 超出下方\r\n                    var subY = originalRectTran.bottom - svgRect.bottom;\r\n                    //var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    var x = 0;\r\n                    if(angle != 0){\r\n                        x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    }\r\n                    if (translateX == 0 || translateX < translate[0] + x) {\r\n                        translateX = translate[0] + x\r\n                    }\r\n\r\n                    //this._fwBtn.setTranslate(translateX, translate[1]);\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                //超出上方\r\n                if (originalRect.top <= svgRect.top) {\r\n                    var subY = svgRect.top - originalRect.top;\r\n                    //var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    var x = 0;\r\n                    if(angle != 0){\r\n                        x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    }\r\n                    if (translateX == 0 || translateX < translate[0] + x) {\r\n                        translateX = translate[0] + x\r\n                    }\r\n                    //this._fwBtn.setTranslate(translateX, translate[1]);\r\n\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                ////超出右侧\r\n                //if (originalRect.right >= svgRect.right) {\r\n                //    //超出左侧\r\n                //    var subY = originalRect.right-svgRect.right;\r\n                //    var x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n                //    translateX = translate[0] - ( -x);\r\n                //    //this._fwBtn.setTranslate(translateX, translate[1]);\r\n                //    this.fwBtnTranslate(translateX, translate[1]);\r\n                //}\r\n\r\n            }\r\n        },\r\n        fwBtnTranslate: function (x, y) {\r\n            //不能超过线长度\r\n            if (x > this.getWidth() - LineStyle.btnRotate.width) {\r\n                x = this.getWidth() - LineStyle.btnRotate.width;\r\n            }\r\n            this._fwBtn.setTranslate(x, y);\r\n            //this._tranBtnTranslate();\r\n        //    this.fwBtnMove();\r\n        },\r\n        fwBtnMove: function () {\r\n            if (!this.isVisibilityHidden()) {\r\n                this.__triggerEvent(EventKey.MoveBtn, this.getScale(), this._fwBtn.getView()[0].getBoundingClientRect(), this._fwTranBtn.getView()[0].getBoundingClientRect(), this._fwBtn.getUuid(), this._fwTranBtn.getUuid());\r\n            }\r\n        },\r\n        setFwBtnVisible: function (visible) {\r\n            //this._fwBtn.setVisible(visible);\r\n\r\n\r\n            this.__triggerEvent(EventKey.MoveBtn, this.getScale(), this._fwBtn.getView()[0].getBoundingClientRect(), this._fwTranBtn.getView()[0].getBoundingClientRect(), this._fwBtn.getUuid(), this._fwTranBtn.getUuid(), visible);\r\n            //this.__triggerEvent(EventKey.MoveBtn, this.getScale(), this._fwBtn.getView()[0].getBoundingClientRect(), this._fwBtn.getUuid(), this._fwTranBtn.getUuid(), visible);\r\n        },\r\n        getScale: function () {\r\n            var scale = (this._$$offsetPoint.node.getBoundingClientRect().width / 20) || 1;\r\n            return scale;\r\n        },\r\n        /**\r\n         * 场景4,5用\r\n         */\r\n        setNameDisplay: function (str) {\r\n            $(this._$$name.node).css(\"display\", str);\r\n        },\r\n        /**\r\n         * 把按钮移到上面\r\n         */\r\n        //gtIndexBtnAppendToView: function($$container){\r\n        //    $($$container.node).append(this._fwBtn);\r\n        //    $($$container.node).append(this._fwBtn);\r\n        //}\r\n    });\r\n\r\n    //静态方法\r\n    LightLine.Type = {\r\n        IncidenceLine: 'IncidenceLine',\r\n        ReflectionLine: 'ReflectionLine',\r\n        RefractionLine: 'RefractionLine',\r\n        NormalLine: 'NormalLine',\r\n        SurfaceIn: 'SurfaceIn',\r\n        SurfaceOut: 'SurfaceOut'\r\n    };\r\n\r\n    return LightLine;\r\n});\n/**\r\n * Created by ylf on 2016/7/26.\r\n */\r\ndefine('js/view/multipleText', ['js/view/BaseView', 'js/utils/view'], function (BaseView, View) {\r\n\r\n\r\n    var MultipleText = BaseView({\r\n        _lineHeight: 18,\r\n        _$$texts: [],\r\n        create: function (lineHeight) {\r\n            var instance = Object.create(this);\r\n            instance._$$texts = [];\r\n            instance._lineHeight = lineHeight;\r\n            instance.__base([]);\r\n            instance.createView();\r\n            //创建节点容器\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n        },\r\n        setContent: function (lines) {\r\n            this.clear();\r\n            var that = this;\r\n            if (typeof lines === 'string') {\r\n                that.appendLine(lines);\r\n            } else {\r\n                lines.forEach(function (line) {\r\n                    that.appendLine(line);\r\n                });\r\n            }\r\n\r\n            this.center();\r\n        },\r\n        center: function () {\r\n            var maxWidth = 0;\r\n\r\n            if (this._$$texts.length > 1) {\r\n                var lastIsAngle = false;\r\n                this._$$texts.forEach(function ($$text) {\r\n                    var width = $$text.getWidth();\r\n                    if (width > maxWidth) {\r\n                        maxWidth = width;\r\n                        var content = $$text.getContent();\r\n                        lastIsAngle = content.substring(content.length - 1, content.length) === '°';\r\n                    }\r\n                });\r\n                this._$$texts.forEach(function ($$text) {\r\n                    var width = $$text.getWidth();\r\n                    if (width < maxWidth) {\r\n                        $$text.setAttr('x', Math.abs((maxWidth - width) / 2));\r\n                    }\r\n                });\r\n\r\n            }\r\n        },\r\n        getRenderBox: function () {\r\n            return this._$$view.getRenderBox();\r\n        },\r\n        getAttr: function (name) {\r\n            return this._$$view.getAttr(name);\r\n        },\r\n        appendLine: function (text) {\r\n            var y = (this._$$texts.length ) * this._lineHeight;\r\n            var $$text = new kity.Text().setContent(text).setAttr('x', 0).setAttr('y', y >= 0 ? y : 0).setAttr('class', 'nd_NewRoman');\r\n            this._$$texts.push($$text);\r\n            this._$$view.addShape($$text);\r\n\r\n        },\r\n        getWidth: function () {\r\n            var width = 0;\r\n            this._$$texts.forEach(function ($$text) {\r\n                if ($$text.getWidth() > width) {\r\n                    width = $$text.getWidth();\r\n                }\r\n            });\r\n            return width;\r\n        },\r\n        getContent: function () {\r\n            //TODO:\r\n        },\r\n        getHeight: function () {\r\n            return this._lineHeight * this._$$texts.length;\r\n        },\r\n        clear: function () {\r\n            this._$$texts.forEach(function ($$text) {\r\n                $$text.remove();\r\n            });\r\n            this._$$texts = [];\r\n        }\r\n    });\r\n\r\n    return MultipleText;\r\n});\n/**\r\n * Created by ylf on 2016/8/4.\r\n * 扇面名称和角度\r\n */\r\ndefine('js/view/NameGroup', ['js/view/BaseView', 'js/config/style', 'js/utils/graphmath', 'js/utils/svg', 'js/view/MultipleText', 'js/view/sector', 'js/utils/view'], function (BaseView, Style, GraphMath, Svg, MultipleText, Sector, View) {\r\n\r\n\r\n    var SectorStyle = Style.Sector;\r\n\r\n    var data = {\r\n        \"type\": {\r\n            name: '',\r\n            angle: 0,\r\n            vertical: true,\r\n            cx: 0,\r\n            cy: 0,\r\n            r: 0\r\n        }\r\n    };\r\n\r\n    var anglePaddingLeft = 5;\r\n\r\n\r\n    var NameGroup = BaseView({\r\n        _data: '',\r\n        _nameVisible: true,\r\n        _$$incidencePoint: null,\r\n        _lang: null,\r\n        _lightHeight: 50,\r\n        _option: null,\r\n        _status: null,\r\n        create: function (data, lang, option) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._data = data;\r\n            instance._lang = lang;\r\n            instance._option = option;\r\n            instance._status = {};\r\n            for (var type in Sector.Type) {\r\n                instance._status[Sector.Type[type]] = false;\r\n            }\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            for (var key in this._data) {\r\n                var data = this._data[key];\r\n                //名称和度数\r\n                data.mtAngle = MultipleText.create(that._lightHeight);\r\n                data.mtName = MultipleText.create(that._lightHeight);\r\n\r\n                if (key == Sector.Type.SurfaceIn || key == Sector.Type.SurfaceOut) {\r\n                    //与反射面夹角\r\n                    data.name = '';\r\n                    data.mtAngle.getView().setAttr('class', SectorStyle.surfaceFontClass);\r\n                } else if (key == Sector.Type.Incidence) {\r\n                    //入射线与法线夹角\r\n                    data.name = this._lang['rf_incidence_angle'];\r\n                    //角度\r\n                    data.mtAngle.getView().setAttr('class', SectorStyle.incidence_normalFontClass);\r\n                    //隐藏的角度，用来确认位置\r\n                    data.mtInvisibleAngle = MultipleText.create(that._lightHeight);\r\n                    data.mtInvisibleAngle.getView().setAttr('class', SectorStyle.normalFontClass);\r\n                    //名称\r\n                    data.mtName = MultipleText.create(that._lightHeight);\r\n                    data.mtName.getView().setAttr('class', SectorStyle.normalFontClass);\r\n                    that.addShape(data.mtInvisibleAngle.getView());\r\n                    View.setVisibility(data.mtInvisibleAngle.getView(), false);\r\n                } else if (key == Sector.Type.Refraction) {\r\n                    //反射线与法线夹角\r\n                    data.name = this._lang['rf_refraction_angle'];\r\n                    data.mtAngle.getView().setAttr('class', SectorStyle.normalFontClass);\r\n                    data.mtInvisibleAngle = MultipleText.create(that._lightHeight);\r\n                    data.mtInvisibleAngle.getView().setAttr('class', SectorStyle.normalFontClass);\r\n                    //名称\r\n                    data.mtName = MultipleText.create(that._lightHeight);\r\n                    data.mtName.getView().setAttr('class', SectorStyle.normalFontClass);\r\n                    that.addShape(data.mtInvisibleAngle.getView());\r\n                    View.setVisibility(data.mtInvisibleAngle.getView(), false);\r\n                }\r\n                data.angleStr = '';\r\n                data.angle = 0;\r\n                that.addShape(data.mtAngle.getView());\r\n                that.addShape(data.mtName.getView());\r\n                data.mtName.setVisibility(false);\r\n            }\r\n        },\r\n        getAngle: function (type) {\r\n            return this._data[type].actualAngle;\r\n        },\r\n        getRoundAngle: function (type) {\r\n            return this._data[type].angle;\r\n        },\r\n        setNormalAngle: function (normalAngle) {\r\n            this._normalAngle = normalAngle;\r\n        },\r\n        rotate: function (angle, nagative) {\r\n            var __getIndex = function (index, nagative, sub) {\r\n                return nagative ? sub - index : index;\r\n            };\r\n            this._rotate(Sector.Type.SurfaceIn, angle[__getIndex(0, nagative, 3)], angle[__getIndex(1, nagative, 5)]);\r\n            this._rotate(Sector.Type.Incidence, angle[__getIndex(1, nagative, 3)], angle[__getIndex(2, nagative, 5)]);\r\n            //this._rotate(Sector.Type.Refraction, angle[__getIndex(2, nagative, 3)], angle[__getIndex(3, nagative, 5)]);\r\n  \t\r\n            this._rotate(Sector.Type.Refraction, angle[__getIndex(3, nagative, 3)], angle[__getIndex(4, nagative, 5)]);\r\n            this._rotate(Sector.Type.SurfaceOut, angle[__getIndex(3, nagative, 3)], angle[__getIndex(4, nagative, 5)]);\r\n        },\r\n        _rotate: function (type, startAngle, endAngle) {\r\n           // console.log(\"startAngle = \"+ startAngle +\" ,endAngle=\"+endAngle);\r\n            var data = this._data[type];\r\n            //var angle = Math.abs(Math.round(startAngle - endAngle));\r\n            var angle = Math.abs((startAngle - endAngle).toFixed(1));\r\n            data.angle = angle;\r\n            data.actualAngle = Math.abs(startAngle - endAngle);\r\n            data.angleStr = angle + '°';\r\n            var sphereAngle = startAngle + (endAngle - startAngle) / 2;\r\n            data.sphereAngle = sphereAngle;\r\n            //不设置隐藏是否，只进行旋转定位\r\n            this.updatePosByType(type);\r\n        },\r\n        isNameVertical: function () {\r\n            var angle = this._normalAngle % 360;\r\n            if (angle > -40 && angle <= 0) {\r\n                return false;\r\n            } else if (angle <= 360 && angle >= 310) {\r\n                return false;\r\n            } else if (angle >= 0 && angle <= 40) {\r\n                return false;\r\n            } else if (angle >= 130 && angle <= 230) {\r\n                return false\r\n            }\r\n            return true;\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this._nameVisible = visible;\r\n            for (var type in this._data) {\r\n                if (this._status[type] === true) {\r\n                    if (this._data[type].mtName) {\r\n                        View.setVisibility(this._data[type].mtName.getView(), visible);\r\n                    }\r\n                    this.updatePosByType(type);\r\n                }\r\n            }\r\n        },\r\n        setNameStatusAndVisible: function (type, visible) {\r\n            if (this._data[type].mtName) {\r\n                if (this._data[type].mtName) {\r\n                    View.setVisibility(this._data[type].mtName.getView(), visible);\r\n                }\r\n                //已经绘制过\r\n                this._status[type] = true;\r\n                this.updatePosByType(type);\r\n            }\r\n        },\r\n        updatePosByType: function (type) {\r\n\r\n            var data = this._data[type];\r\n            var nameVisible = !data.mtName.isVisibilityHidden();\r\n            if (data.angle === 0 || data.angle === 90) {\r\n                //角度为0/90时，不显示文本内容\r\n                data.mtName.setContent('');\r\n                data.mtAngle.setContent('');\r\n                if (type == Sector.Type.Incidence || type == Sector.Type.Reflection) {\r\n                    data.mtInvisibleAngle.setContent('');\r\n                }\r\n            } else {\r\n                var isNameVertical = this.isNameVertical();\r\n                if (nameVisible) {\r\n                    data.mtName.setContent(isNameVertical ? data.name.split('') : data.name);\r\n                } else {\r\n                    data.mtName.setContent('');\r\n                }\r\n                data.mtAngle.setContent(data.angleStr);\r\n\r\n                var r = data.r + this._lightHeight;\r\n\r\n                //显示名称，且名称水平显示\r\n                if (!isNameVertical && nameVisible && !this.isSurfaceAngle(type)) {\r\n                    r += data.mtAngle.getWidth() / 2 + data.mtName.getWidth() / 2;\r\n                }\r\n                //入射角、反射角\r\n                if (!this.isSurfaceAngle(type)) {\r\n                    r += 5;\r\n                }\r\n                if (this.isSurfaceAngle(type) || !nameVisible) {\r\n                    this.makeAbsViewHorizontal(data.mtAngle, data.sphereAngle, r, data.cx, data.cy, 0, 0, false);\r\n                } else if (nameVisible) {\r\n                    //获取到角度的位置，并同步名称位置\r\n                    if (isNameVertical) {\r\n                        data.mtInvisibleAngle.setContent(data.angleStr);\r\n                    } else {\r\n                        data.mtInvisibleAngle.setContent(data.name + data.angleStr);\r\n                    }\r\n                    this.makeAbsViewHorizontal(data.mtInvisibleAngle, data.sphereAngle, r, data.cx, data.cy, 0, 0, false);\r\n                    var translate = Svg.getAttrTranslate(data.mtInvisibleAngle.getAttr('transform'));\r\n                    if (isNameVertical) {\r\n                        //在原点上方\r\n                        if (translate[1] < 0) {\r\n                            data.mtAngle.setTranslate(translate[0], translate[1] - data.mtAngle.getHeight() + this._lightHeight);\r\n                            data.mtName.setTranslate(translate[0] + anglePaddingLeft, translate[1] - data.mtAngle.getHeight() - data.mtName.getHeight() + this._lightHeight);\r\n                        } else {\r\n                            //原点下方\r\n                            data.mtName.setTranslate(translate[0] + anglePaddingLeft, translate[1]);\r\n                            data.mtAngle.setTranslate(translate[0], translate[1] - data.mtAngle.getHeight() + data.mtName.getHeight() + this._lightHeight);\r\n                        }\r\n                    } else {\r\n                        //横向排列，名称在前，角度在后\r\n                        data.mtAngle.setTranslate(translate[0] + data.mtName.getWidth(), translate[1]);\r\n                        data.mtName.setTranslate(translate[0], translate[1]);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        isSurfaceAngle: function (type) {\r\n            return type == Sector.Type.SurfaceIn || type == Sector.Type.SurfaceOut;\r\n        },\r\n        setAngleVisibleByType: function (type, visible) {\r\n            //设置内置状态，说明已经绘制过。\r\n            if (visible) {\r\n                this._status[type] = true;\r\n            }\r\n            var data = this._data[type];\r\n            View.setVisibility(data.mtAngle.getView(), visible);\r\n            if (this._status[type] === true) {\r\n                View.setVisibility(data.mtName.getView(), this._nameVisible);\r\n            }\r\n            this.updatePosByType(type);\r\n        },\r\n        //加入角度判断\r\n        getAngleIsValidByType: function (type) {\r\n            var data = this._data[type];\r\n            if (data.angle === 0 || data.angle === 90) {\r\n                return false;\r\n            }\r\n            return !View.isVisibilityHidden(data.mtAngle.getView());\r\n        },\r\n        getHasDrawStatus: function () {\r\n            return this._status;\r\n        },\r\n        setHasDrawStatus: function (status, type) {\r\n            this._status = status;\r\n        },\r\n        setHasDrawStatusByType: function (status, type) {\r\n            if (typeof type !== typeof  undefined) {\r\n                this._status[type] = status;\r\n            } else {\r\n                for (var key in   this._status) {\r\n                    this._status[key] = status;\r\n                }\r\n            }\r\n        },\r\n        getHasDrawStatusByType: function (type) {\r\n            return this._status[type];\r\n        },\r\n        getAngleVisibilityByType: function (type) {\r\n            var data = this._data[type];\r\n            return !View.isVisibilityHidden(data.mtAngle.getView());\r\n        },\r\n        setEnable: function (enable) {\r\n            for (var type in this._data) {\r\n                if (this._status[type] === true) {\r\n                    if (this._data[type].mtName) {\r\n                        View.setVisibility(this._data[type].mtName.getView(), visible);\r\n                    }\r\n                    this.updatePosByType(type);\r\n                }\r\n            }\r\n        },\r\n        /**\r\n         * 场景4,5用\r\n         */\r\n        setNameDisplay: function(display){\r\n            for(var key in this._data){\r\n                //$(this._data[key].$$name._$$view.node).css(\"display\", display);\r\n                // this._data[key].mtName.setVisible(false);\r\n                // this._data[key].mtAngle.setVisible(false);\r\n                $(this._data[key].mtName._$$view.node).css(\"display\", display);\r\n                $(this._data[key].mtAngle._$$view.node).css(\"display\", display);\r\n            }\r\n        },\r\n        /**\r\n         * 获取某文字\r\n         */\r\n        getNameByType: function(type){\r\n            var data = this._data[type];\r\n\r\n               return data.mtAngle.getView();\r\n\r\n        }\r\n    });\r\n\r\n\r\n    return NameGroup;\r\n});\n/**\r\n * Created by ylf on 2016/7/28.\r\n * 入射线\r\n */\r\ndefine('js/view/normalLine', ['js/view/BaseView', 'js/config/style', 'js/utils/view', 'js/utils/svg'], function (BaseView, Style, View, Svg) {\r\n\r\n\r\n    var NormalLineStyle = Style.NormalLine;\r\n\r\n    var NormalLine = BaseView({\r\n        _$$line: null,\r\n        _domEvent: null,\r\n        _width: 200,\r\n        _$$name: null,\r\n        _pointVisible: false,\r\n        _lineVisible: false,\r\n        _lang: false,\r\n        create: function (width, lang) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._width = width;\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            //1.法线\r\n            this._$$line = new kity.Path('').setStyle(NormalLineStyle.strokeStyle);\r\n            this._$$line.setAttr('d', 'M0 0 ' + this._width + ' 0');\r\n            this._$$line.setAttr('stroke-dasharray', '15,12');\r\n            this.addShape(this._$$line);\r\n\r\n            //2.名称\r\n            this._$$name = new kity.Text();\r\n            this._$$name.setContent(this._lang['rf_normal_name']).setAttr('class', NormalLineStyle.fontClass);\r\n            this.addShape(this._$$name);\r\n\r\n            //3.入射点名称\r\n            this._$$nameDown = new kity.Text();\r\n            this._$$nameDown.setContent(this._lang['rf_incidence_point']).setAttr('class', NormalLineStyle.fontClass);\r\n            this.addShape(this._$$nameDown);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? this._width : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            this._$$line.setRotate(angle + ' ' + x + ' ' + y);\r\n            this.initNamePos(x, y);\r\n        },\r\n        getRotateAngle: function () {\r\n            var rotate = Svg.getAttrRotate(this._$$line.getAttr('transform'));\r\n            return rotate[0];\r\n        },\r\n        //setTranslate:function(x,y){\r\n        //    BaseView({}).setTranslate.apply(this,[x,y]);\r\n        //    this.initNamePos(Math.abs(x) - this._width/2,y);\r\n        //},\r\n        initNamePos: function (centerX, centerY) {\r\n            centerX = typeof centerX === typeof undefined ? this._width/2 : centerX;\r\n            centerY = typeof centerY === typeof undefined ? 0 : centerY;\r\n            var downWidth = this._$$nameDown.getWidth();\r\n            var nameWidth = this._$$name.getWidth();\r\n            this.makeViewAround(this._$$name, this._$$line, this._width, this._width/2 + 25, centerX, centerY, -nameWidth / 2 + 5, 0, false);\r\n            this.makeViewAround(this._$$nameDown, this._$$line, 150, 25, centerX, centerY, -downWidth / 2 -10, 0, true);\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this._$$nameDown.setContent(visible === true ? this._lang['rf_incidence_point'] : '');\r\n            this._$$name.setContent(visible === true ? this._lang['rf_normal_name'] : '');\r\n            this.initNamePos();\r\n        },\r\n        setPointNameVisibility: function (nameVisible, visible) {\r\n            this._pointVisible = visible;\r\n            //this._$$nameDown.setContent(nameVisible === true ? this._lang['rf_incidence_point'] : 'O');\r\n            View.setVisibility(this._$$nameDown, visible);\r\n            View.setVisibility(this._$$name, this._lineVisible);\r\n            View.setVisibility(this._$$line, this._lineVisible);\r\n            this.setVisibility(true);\r\n            this.initNamePos();\r\n        },\r\n        setLineVisibility: function (nameVisible, visible) {\r\n            this._lineVisible = visible;\r\n            //this._$$name.setContent(nameVisible === true ? this._lang['rf_normal_name'] : 'N');\r\n            View.setVisibility(this._$$name, visible);\r\n            View.setVisibility(this._$$nameDown, this._pointVisible);\r\n            View.setVisibility(this._$$line, visible);\r\n            this.setVisibility(true);\r\n            this.initNamePos();\r\n        },\r\n        showAll: function () {\r\n            this.setVisibility(true);\r\n            View.setVisibility(this._$$name, true);\r\n            View.setVisibility(this._$$nameDown, true);\r\n            View.setVisibility(this._$$line, true);\r\n            this.initNamePos();\r\n        },\r\n        getLineVisible: function () {\r\n            return this._lineVisible;\r\n        },\r\n        getPointNameVisible: function () {\r\n            return this._pointVisible;\r\n        }\r\n    });\r\n\r\n    return NormalLine;\r\n});\n/**\r\n * Created by ylf on 2016/8/15.\r\n * 垂足符号\r\n */\r\ndefine('js/view/PedalLine', ['js/view/BaseView', 'js/config/style', 'js/utils/svg', 'js/utils/view'], function (BaseView, Style,Svg) {\r\n\r\n\r\n    var PedalStyle = Style.Pedal;\r\n\r\n\r\n    var PedalLine = BaseView({\r\n        _$$line: null,\r\n        create: function (data) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._data = data;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            var $$line = this._$$line = new kity.Path().setId('dd').setStyle(PedalStyle.strokeStyle);\r\n            var plusDrawer = $$line.getDrawer();\r\n            //为了和线角度统一，这边垂足符号进行了向左90°旋转\r\n            plusDrawer.moveTo(-PedalStyle.width, 0);\r\n            plusDrawer.lineTo(-PedalStyle.width, -PedalStyle.width);//左\r\n            plusDrawer.lineTo(0, -PedalStyle.width);//右\r\n            this.addShape($$line);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            this._$$line.setRotate(angle + ' ' + x + ' ' + y);\r\n        },\r\n        getRotateAngle: function(){\r\n            var rotate = Svg.getAttrRotate(this._$$line.getAttr('transform'));\r\n            return rotate;\r\n        }\r\n    });\r\n\r\n\r\n    return PedalLine;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 夹角扇面\r\n */\r\ndefine('js/view/sector', ['js/view/BaseView', 'js/config/style', 'js/utils/graphmath', 'js/utils/svg', 'js/view/MultipleText'], function (BaseView, Style, GraphMath, Svg, MultipleText) {\r\n\r\n\r\n    var SectorStyle = Style.Sector;\r\n\r\n    var Sector = BaseView({\r\n        _$$sector: null,\r\n        _$$sectorBorder: null,\r\n        _type: 1,\r\n        _startAngle: 0,\r\n        _endAngle: 0,\r\n        _cx: 0,\r\n        _cy: 0,\r\n        _lang: 0,\r\n        _$$incidencePoint: null,\r\n        create: function (type, cx, cy, r, lang) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._type = type;\r\n            instance._cx = cx;\r\n            instance._cy = cy;\r\n            instance._r = r;\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$sector = new kity.Path('');\r\n            //this._$$sector.setStyle(SectorStyle.strokeStyle);\r\n            this._$$sectorBorder = new kity.Path('');\r\n            this._$$sectorBorder.setStyle(SectorStyle.strokeStyle);\r\n\r\n            //名称和度数\r\n            if (this._type === Sector.Type.SurfaceIn || this._type === Sector.Type.SurfaceOut) {\r\n                //与反射面夹角\r\n                this._$$sector.fill(SectorStyle.surfaceFill);\r\n            } else if (this._type === Sector.Type.Incidence) {\r\n                //入射线与法线夹角\r\n               // this._$$sector.fill(SectorStyle.normalFill);\r\n                this._$$sector.fill(SectorStyle.incidence_normalFill);\r\n            } else if (this._type === Sector.Type.Reflection || this._type === Sector.Type.Refraction) {\r\n                //反射线与法线夹角\r\n                this._$$sector.fill(SectorStyle.normalFill);\r\n            }\r\n            this.addShape(this._$$sector);\r\n            this.addShape(this._$$sectorBorder);\r\n        },\r\n        rotate: function (startAngle, endAngle) {\r\n            //装换为扇面内部角度，扇面角度从右侧到左侧0~180\r\n            this._startAngle = startAngle;\r\n            this._endAngle = endAngle;\r\n            var absEndAngle = 180 - startAngle;\r\n            var absStartAngle = 180 - endAngle;\r\n            var str = GraphMath.getSvgSectorPoint(this._cx, this._cy, this._r, absStartAngle, absEndAngle);\r\n\r\n            this._$$sector.setAttr('d', str);\r\n            //this._$$sector.setStyle({opacity:0.6});\r\n            this._$$sectorBorder.setAttr('d', str);\r\n        }\r\n\r\n    });\r\n\r\n    Sector.Type = {\r\n        Incidence: 1,\r\n        Reflection: 2,\r\n        SurfaceIn: 3,\r\n        SurfaceOut: 4,\r\n        Refraction: 5\r\n    };\r\n\r\n    return Sector;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 平面\r\n */\r\ndefine('js/view/surface', ['js/view/BaseView', 'js/config/style', 'js/utils/utils', 'js/utils/svg', 'js/view/ForeignView', 'js/config/eventKey', 'js/utils/view'], function (BaseView, Style, Utils, Svg, ForeignView, EventKey, View) {\r\n\r\n    var GraphMath = require('js/utils/graphmath');\r\n    var SurfaceStyle = Style.Surface;\r\n\r\n    var CONFIG = {\r\n        width: 520,\r\n        defaultAngle: 0,\r\n        rotatePosX: 5,//旋转位置 ，远点扣除左侧的空白\r\n        rotatePosY: 4,//y旋转位置，计算了样式空白造成的偏移量\r\n        visible: true,\r\n        clickAble: true,\r\n        nameEnable: true,\r\n        nameEventEnable: true,\r\n        type: ''//类型\r\n    };\r\n\r\n    var Surface = BaseView({\r\n        _config: null,\r\n        _$$surface: null,\r\n        _$$name: null,\r\n        _onSurfaceMove: null,\r\n        _lang: null,\r\n        _$$incidencePoint: null,\r\n        create: function (eventbus, config, onSurfaceMove, lang) {\r\n            var instance = Object.create(this);\r\n            instance._config = $.extend(true, {}, CONFIG, config);\r\n            //监听失去焦点\r\n            var eventInfos = [];\r\n            if (instance._config.nameEventEnable) {\r\n                eventInfos.push({key: EventKey.NameVisible, callback: 'nameVisibleHandler', params: []});\r\n            }\r\n            eventInfos.push({key: EventKey.Blur, callback: instance.blur, params: []});\r\n\r\n            instance.__base(eventbus, eventInfos);\r\n\r\n            instance._type = config.type;\r\n            instance._onSurfaceMove = onSurfaceMove;\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n\r\n            this._$$surface = new kity.Group();\r\n\r\n            var cls = 'wall_tl';\r\n            if (Surface.Type.tl === this._type) {\r\n                cls = 'wall_tl';\r\n            } else if (Surface.Type.tr === this._type) {\r\n                cls = 'wall_tr';\r\n            } else if (Surface.Type.tl_Large === this._type) {\r\n                cls = 'wall_tl_large';\r\n            }\r\n            //1.反射面\r\n            this._fwSurface = ForeignView.create(cls, this._config.width, SurfaceStyle.height);\r\n            $(this._$$surface.node).append(this._fwSurface.getView());\r\n            this.addShape(this._$$surface);\r\n\r\n            //添加一个标记，用于获取旋转点的offset坐标\r\n            this._$$offsetPoint = new kity.Circle(10).fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            //View.setVisibility(this._$$offsetPoint, false);\r\n            this._$$offsetPoint.setTranslate(this._config.rotatePosX, this._config.rotatePosY);\r\n            this.addShape(this._$$offsetPoint);\r\n\r\n\r\n            //名称\r\n            this._$$name = new kity.Text();\r\n            this._$$name.setContent(this._lang['rf_refraction_surface']).setAttr('class', SurfaceStyle.fontClass);\r\n            if (!this._config.nameEnable) {\r\n                View.setVisibility(this._$$name, false);\r\n            }\r\n            this.addShape(this._$$name);\r\n\r\n            //旋转按钮\r\n            this._fwBtn = ForeignView.create('btn_rotate', SurfaceStyle.btnRotate.width, SurfaceStyle.btnRotate.height);\r\n            this._fwBtnInvisible = ForeignView.create('btn_rotate', SurfaceStyle.btnRotate.width, SurfaceStyle.btnRotate.height);\r\n            this._fwBtnInvisible.setVisibility(false);\r\n            $(this._$$surface.node).append(this._fwBtn.getView());\r\n            $(this._$$surface.node).append(this._fwBtnInvisible.getView());\r\n            this.intOriginalFwBtnPos();\r\n\r\n            //处理样式中3像素的图片偏移量\r\n            this.setTranslate(0, -3);\r\n\r\n            //绑定事件\r\n            this.bindDomEvent(this._$$surface.node, ['lrTap'], this.getUuid(), this.domEventHandler);\r\n            this.bindDomEvent(this._fwBtn.getView(), ['move', 'aftermove'], this._fwBtn.getUuid(), this.domEventHandler);\r\n\r\n            this._fwBtn.setVisible(false);\r\n\r\n            $(this.getView().node).attr('class', '_lr_surface');\r\n\r\n            this.setVisibility(this._config.visible);\r\n        },\r\n        intOriginalFwBtnPos: function () {\r\n            if (this._type === Surface.Type.tl) {\r\n                this._fwBtn.setTranslate(this._config.width + 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n                this._fwBtnInvisible.setTranslate(this._config.width + 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n            } else {\r\n                this._fwBtn.setTranslate(-SurfaceStyle.btnRotate.width - 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n                this._fwBtnInvisible.setTranslate(-SurfaceStyle.btnRotate.width - 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n            }\r\n        },\r\n        blur: function (uuid) {\r\n            if (uuid !== this.getUuid()) {\r\n                this._fwBtn.setVisible(false);\r\n                this._fwSurface.removeClass('on');\r\n            }\r\n        },\r\n        domEventHandler: function (eventType, uuid, data) {\r\n            if (!this._config.clickAble) {\r\n                return;\r\n            }\r\n            if (uuid === this.getUuid()) {\r\n                if (eventType === 'lrTap') {\r\n                    if (this._fwSurface.hasClass('on')) {\r\n                        this.blur();\r\n                        return;\r\n                    }\r\n                    this._fwBtn.setVisible(true);\r\n                    this._fwSurface.addClass('on');\r\n                }\r\n            } else if (uuid === this._fwBtn.getUuid()) {\r\n                //if (eventType === 'move') {\r\n                this._onSurfaceMove(data, eventType);\r\n                //}\r\n                if (eventType === 'aftermove') {\r\n                    this.__triggerEvent('insidechange', 'surface-move');\r\n                }\r\n            }\r\n            this.btnStillInBox();\r\n        },\r\n        getSurfaceXAxisDegree: function (surface) {\r\n            var degree = surface.getRotateAngle() % 180;\r\n            //角度换算\r\n            if (degree <= 0) {\r\n                degree = -degree;\r\n            } else {\r\n                degree = 180 - degree;\r\n            }\r\n            return degree;\r\n        },\r\n        btnStillInBox: function () {\r\n            var originalRect = this._fwBtnInvisible.getView()[0].getBoundingClientRect();\r\n            var svgRect = this._fwBtn.getView().closest('svg')[0].getBoundingClientRect();\r\n            var angle = Math.abs(this.getRotateAngle() % 180);\r\n            //统一计算与X轴锐角\r\n            if (angle <= 0) {\r\n                angle = -angle;\r\n            }\r\n            if (angle > 90) {\r\n                angle = 180 - angle;\r\n            }\r\n\r\n            var translate = Svg.getAttrTranslate(this._fwBtnInvisible.getView().attr('transform'));\r\n            if (translate.length <= 0) {\r\n                return;\r\n            }\r\n            var flag = false;\r\n\r\n            //inside svg\r\n            if (originalRect.bottom <= svgRect.bottom && originalRect.left >= svgRect.left && originalRect.right <= svgRect.right && originalRect.top >= svgRect.top) {\r\n                if (this._type === Surface.Type.tl) {\r\n                    this._fwBtn.setTranslate(this._config.width + 10, translate[1]);\r\n                } else {\r\n                    this._fwBtn.setTranslate(-SurfaceStyle.btnRotate.width - 10, translate[1]);\r\n                }\r\n            } else {\r\n                var translateX = 0;\r\n                var scale = this.getScale();\r\n                var isRight = this._type === Surface.Type.tl;\r\n                if (originalRect.left <= svgRect.left) {\r\n                    //超出左侧\r\n                    var subY = svgRect.left - originalRect.left;\r\n                    var x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n                    translateX = translate[0] - (isRight ? x : -x);\r\n                    this._fwBtn.setTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                if (originalRect.bottom >= svgRect.bottom) {\r\n                    // 超出下方\r\n                    var subY = originalRect.bottom - svgRect.bottom;\r\n                    var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    if (isRight) {\r\n                        if (translateX == 0 || translateX > translate[0] - x) {\r\n                            translateX = translate[0] - x\r\n                        }\r\n                    } else {\r\n                        if (translateX == 0 || translateX < translate[0] + x) {\r\n                            translateX = translate[0] + x\r\n                        }\r\n                    }\r\n\r\n                    this._fwBtn.setTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                //超出上方\r\n                if (originalRect.top <= svgRect.top) {\r\n                    var subY = svgRect.top - originalRect.top;\r\n                    var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    if (isRight) {\r\n                        if (translateX == 0 || translateX > translate[0] - x) {\r\n                            translateX = translate[0] - x\r\n                        }\r\n                    } else {\r\n                        if (translateX == 0 || translateX < translate[0] + x) {\r\n                            translateX = translate[0] + x\r\n                        }\r\n                    }\r\n                    this._fwBtn.setTranslate(translateX, translate[1]);\r\n                }\r\n            }\r\n        },\r\n        rotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? this._config.rotatePosX : x;\r\n            y = typeof y === typeof undefined ? this._config.rotatePosY : y;\r\n            var rotate = Svg.getAttrRotate(this._$$surface.getAttr('transform'));\r\n            if (rotate && rotate.length > 0) {\r\n                this._$$surface.setRotate((rotate[0] + angle) + ' ' + x + ' ' + y);\r\n            } else {\r\n                this._$$surface.setRotate(angle + ' ' + x + ' ' + y);\r\n            }\r\n            this.initNamePos(x, y);\r\n        },\r\n        getRotateOffsetPos: function () {\r\n            var offset = $(this._$$offsetPoint.node).offset();\r\n            return {\r\n                x: offset.left,\r\n                y: offset.top\r\n            };\r\n        },\r\n        getRotateAngle: function () {\r\n            var rotate = Svg.getAttrRotate(this._$$surface.getAttr('transform'));\r\n            return rotate[0] || 0;\r\n        },\r\n        initNamePos: function (x, y) {\r\n            var r = this._config.rotatePosX + 100;\r\n            var distance = this._config.rotatePosX + 20;\r\n            this.makeViewAround(this._$$name, this._$$surface, r, distance, this._config.rotatePosX, y, 0, -(SurfaceStyle.height - this._$$name.getHeight()) / 2, false);\r\n        },\r\n        setNameVisible: function (visible) {\r\n            if (this._config.nameEnable) {\r\n                View.setVisibility(this._$$name, visible);\r\n            }\r\n        },\r\n        nameVisibleHandler: function (visible) {\r\n            this.setNameVisible(visible);\r\n        },\r\n        setClickAble: function (clickable) {\r\n            this._config.clickAble = clickable;\r\n        },\r\n        getScale: function () {\r\n            var scale = (this._$$offsetPoint.node.getBoundingClientRect().width / 20) || 1;\r\n            return scale;\r\n        },\r\n        get0To360RotateAngle: function () {\r\n            var angle = this.getRotateAngle() % 360;\r\n            if (angle < 0) {\r\n                angle = 360 + angle;\r\n            }\r\n            return angle;\r\n        }\r\n    });\r\n    Surface.Type = {\r\n        tl: 'tl',\r\n        tr: 'tr',\r\n        tl_Large: 'wall_tl_large'\r\n    }\r\n    return Surface;\r\n});\ndefine('js/mainRefraction', ['js/refractor/refractorMain', 'js/utils/logger'], function (RefractorMain, Logger) {\r\n\r\n    window.LightRefractor = {\r\n        create: function (option) {\r\n            return RefractorMain.create(option);\r\n        },\r\n        setLogLevel: function (level) {\r\n            Logger.setLevel(level);\r\n        },\r\n        setLang: function(i18n){\r\n\r\n        },\r\n        getLang: function(){\r\n\r\n        }\r\n    }\r\n\r\n\r\n});\r\n//主入口初始化\r\nrequire('js/mainRefraction');\r\n})(window,document,jQuery)"]}