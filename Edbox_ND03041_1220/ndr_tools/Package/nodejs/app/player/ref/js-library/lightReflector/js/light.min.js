!function(e,t,i){var n,s;!function(){var e={},t={},i=function(n){if(n&&(n=n.toLowerCase()),t[n]){var s=t[n];delete t[n];for(var a=[],r=0;r<s.deps.length;r++){var o=s.deps[r];a[r]=i(o)}var l=s.callback.apply(s.callback,a);e[n]=l}return e[n]};s=function(e,i,n){if(e&&(e=e.toLowerCase()),i instanceof Array||(n=i,i=[]),t[e])throw new Error("the key already has been  used");t[e]={deps:i,callback:n,module:null}},n=function(e){return i(e)}}(),s("js/base/base",[],function(){var e=n("js/utils/logger"),t=function(t,i){for(var n in i)"undefined"!=typeof t[n]&&"__base"!==n&&(!t.__overwrite||t.__overwrite.indexOf(n)<0)&&e.debug("有重复的成员",n),t[n]=i[n];return t},i=function(e,t){return function(){return t.apply(e,arguments)}},s={___eventBus:null,___eventsInfo:[{key:"",callback:"",params:[]}],__base:function(e,t){this.___eventsInfo=null,this.___eventBus=null;var i=Array.prototype.slice.apply(arguments,[0]);if(i.length>2)throw new Error("参数长度有误");for(var n=0;n<i.length;n++){var s=i[n];s instanceof Array?this.___eventsInfo=s:"object"==typeof s&&(this.___eventBus=e)}this.___eventBus=this.___eventBus||{},this.___eventsInfo=this.___eventsInfo||[];for(var n=0;n<this.___eventsInfo.length;n++){var a=this.___eventsInfo[n],r=a.key;"string"==typeof a.callback?this.___eventBus.on(r,this[a.callback],this):this.___eventBus.on(r,a.callback,this)}},__include:function(e){return t(this,e)},__proxyAll:function(e){for(var t=0;t<e.length;t++)"string"==typeof e[t]&&(this[e[t]]=i(this,this[e[t]]))},__on:function(e,t,i){this.___eventsInfo.push({key:e,callback:t,params:i}),"string"==typeof t?this.___eventBus.on(e,this[t],this):this.___eventBus.on(e,t,this)},__triggerEvent:function(e){var t=Array.prototype.slice.apply(arguments,[0]);this.___eventBus.trigger.apply(this.___eventBus,t)},__getEventBus:function(){return this.___eventBus},__destroy:function(){for(var e=this.___eventsInfo,t=0;t<e.length;t++){var i=e[t],n=i.key;"string"==typeof i.callback?this.___eventBus.off(n,this[i.callback],this):this.___eventBus.off(n,i.callback,this)}}};return function(e){return Object.create(s).__include(e)}}),s("js/config/color",[],function(){var e={};return e.transparent=kity.Color.createRGBA(0,0,0,0),e.node_stroke_normal=kity.Color.createRGB(115,161,191),e.node_stroke_active=kity.Color.createRGB(57,80,96),e.backgroud_color=kity.Color.parse("#C0D3E2"),e.line_color=kity.Color.parse("#666564"),e}),s("js/config/eventKey",[],function(){var e={Blur:"Blur",DomEvent:"DomEvent",SurfaceAngleVisible:"SurfaceAngleVisible",NormalAngleVisible:"NormalAngleVisible",NameVisible:"NameVisible",ZIndexChange:"ZIndexChange",LightLineVisible:"LightLineVisible",MoveBtn:"MoveBtn",BtnMove:"BtnMove"};return e}),s("js/config/lang",[],function(){var e={rf_incidence_line_name:"入射光线",rf_incidence_angle:"入射角",rf_incidence_point:"入射点O",rf_normal_name:"法线N",rf_reflection_line_name:"反射光线",rf_reflection_angle:"反射角",rf_reflection_surface:"反射面",rf_equal_angle_name:"反射角=入射角=0°"};return e}),s("js/config/style",["js/config/color"],function(){var e={black:"svg_text color_black",green:"svg_text color_green",blue:"svg_text color_blue",red:"svg_text color_red",orange:"svg_text color_orange",purple:"svg_text color_purple",roman:" roman"},t={};return t.LineStyle={strokeStyle:{"stroke-width":2.5,stroke:kity.Color.parse("#ffffff")},rectHeight:8,btnRotate:{width:60,height:60},arrow:{width:34,height:45},on:"on",commonLineFill:kity.Color.parse("#CB1F1F"),commonArrowCls:"arrow_red",IncidenceLine:{fill:kity.Color.parse("#005798"),fontClass:e.blue,arrowClass:"arrow_blue"},ReflectionLine:{fill:kity.Color.parse("#CB1F1F"),fontClass:e.red,arrowClass:"arrow_red"},Reverse:{fill:kity.Color.parse("#09924D"),fontClass:e.green,arrowClass:"arrow_red"}},t.Sector={strokeStyle:{"stroke-width":1,stroke:kity.Color.parse("#7595AC")},surfaceFill:kity.Color.createRGBA(213,139,34,.35),incidenceFill:kity.Color.createRGBA(204,131,255,.35),reflectionFill:kity.Color.createRGBA(60,143,65,.35),incidenceFontClass:e.purple,reflectionFontClass:e.green,surfaceFontClass:e.orange,incidenceLetterClass:e.purple+e.roman+" svg_letter",reflectionLetterClass:e.green+e.roman+" svg_letter"},t.NormalLine={strokeStyle:{"stroke-width":4,stroke:kity.Color.parse("#4D4D4D")},fontClass:e.black,pointWidth:5,pointFill:kity.Color.parse("#CB1F1F")},t.IncidencePoint={width:9,fill:kity.Color.parse("#FFE012")},t.Surface={height:19,surfaceClass:"wall_tl",fontClass:e.black,btnRotate:{width:60,height:60}},t.Pedal={strokeStyle:{"stroke-width":5,stroke:kity.Color.parse("#04740b")},width:35},t.EqualAngleName={fontClass:e.green},t});var a=function(){var e="ontouchend"in t,n=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),s={};e&&n?(s.mouseDown="touchstart",s.mouseUp="touchend",s.mouseWheel="touchmove",s.getEventX=function(e){return e.originalEvent.changedTouches[0].clientX},s.getEventY=function(e){return e.originalEvent.changedTouches[0].clientY}):(s.mouseDown="mousedown",s.mouseUp="mouseup",s.mouseWheel="mousewheel",s.getEventX=function(e){return e.clientX},s.getEventY=function(e){return e.clientY}),i.event.special.lrTap={setup:function(){var t=i(this);if(e&&n){var a=s.mouseDown,r=s.mouseUp,o=0,l=0,c=0;t.bind(a,function(e){0===e.which&&1===e.which||(o=(new Date).getTime(),l=s.getEventX(e),c=s.getEventY(e))}),t.bind(r,function(e){if(0!==e.which||1!==e.which){var n=(new Date).getTime(),a=s.getEventX(e),r=s.getEventY(e),h=n-o,u=Math.abs(a-l),g=Math.abs(r-c);h<=550&&u<8&&g<8&&(e=i.event.fix(e),e.type="lrTap",e.tapEventSource="touchclick",e.tapFireTouch=!0,t.triggerHandler(e))}})}else t.bind("click",function(e){e=i.event.fix(e),e.type="lrTap",e.tapEventSource="mouseclick",e.tapFireTouch=!1,e.originalEvent&&e.originalEvent.sourceCapabilities&&e.originalEvent.sourceCapabilities.firesTouchEvents&&(e.tapFireTouch=!0),t.triggerHandler(e)})},teardown:function(){var e=s.mouseDown,t=s.mouseUp,n=i(this);n.unbind(t).unbind(e)}}};a(),s("js/reflector/baseReflector",["js/base/base"],function(e){var t={_lightComplexArray:null,__overwrite:["createView","drawAll","drawNext","getData"],__base:function(t,i){var n=Array.prototype.slice.apply(arguments,[0]);e({}).__base.apply(this,n)},createView:function(){},updatePos:function(){this._lightComplexArray.updatePos()},drawAll:function(){this._lightComplexArray.drawAll()},drawNext:function(){this._lightComplexArray.drawNext()},hasNext:function(){return this._lightComplexArray.hasNext()},getData:function(){},getType:function(){return this._TYPE},getNameVisible:function(){return this._option.nameVisible},pushEvent:function(e){this._event.push(e),this.__proxyAll([e.callback])}};return function(i){return e(t).__include(i)}}),s("js/reflector/btns",["js/base/Base","js/utils/string","js/utils/utils","js/config/eventKey","js/utils/view"],function(e,t,s,a,r){var o=n("js/view/foreignview"),l=n("js/utils/svg"),c=n("js/reflector/domEvent"),h=n("js/config/style").LineStyle,u=e({_fwRotateBtns:[],_g:null,_id:"",_lineUuid:"",_reflector:null,create:function(e,t,i){var n=Object.create(this),a=[];return n._id=s.getUuid(),n._fwRotateBtns={},n._reflector=t,n.__base(e,a),n.initRotateBtn(i),n},initRotateBtn:function(e){var t,n,s=this;for(s._g=new kity.Group,n=0;n<e;n++)t=o.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwRotateBtns[n]=t,c.addDomEvent(t.getView()[0],["down","beforemove","move","aftermove","up"],t.getUuid(),!1,!1),i(s._g.node).append(t.getView()),this.__on(t.getUuid(),function(e,t,i){var n=g.apply(s,[t]);"down"===e?n.addClass("on"):"aftermove"!==e&&"up"!==e||(n.removeClass("on"),n.getView().blur());var r=n.__lineUuid;s.__triggerEvent(a.BtnMove+r,e,r,i)},""),t.setVisibility(!1)},getView:function(){return this._g},appendToView:function(e){e.addShape(this._g)},moveBtnEventHandler:function(e,t,i,n){var s=f.apply(this,[i]),a=t.left+t.width/2,r=t.top+t.height/2,o=s.getView()[0].getBoundingClientRect(),c=o.left+o.width/2,h=o.top+o.height/2,u=l.getAttrTranslate(s.getView().attr("transform"));u&&2==u.length?s.setTranslate(u[0]+(a-c)/e,u[1]+(r-h)/e):s.setTranslate((a-c)/e,(r-h)/e),s.setVisibility(!0)}}),g=function(e){var t,i,n=this._fwRotateBtns;for(t in n)if(i=n[t],i.getUuid()===e)return i},f=function(e){var t,i=this._fwRotateBtns;if(i[e])return i[e].__lineUuid=e,i[e];for(t in i)if(/^\d+$/.test(t))return i[e]=i[t],i[e].__lineUuid=e,delete i[t],i[e]};return u}),s("js/reflector/domEvent",["js/base/Base","js/config/EventKey","js/utils/eventUtils"],function(e,t,s){var a=n("js/utils/logger"),r=e({_$$paper:null,_$$paperItems:[],_option:null,_eventInfo:[],create:function(e,t,i){var n=Object.create(this);return n.__base(t,[]),n._option=i,n._$$paper=e,n},bindDomEvent:function(){this._domEvents(),i(this._$$paper.node).on(" lrTap  mousedown  mouseup mousemove mouseleave touchstart touchmove touchend touchcancel",this._domEvents)},_getEventInfo:function(e){var t=[];e=e.originalEvent||e;var n=i(e.srcElement);for(n.hasClass("_lr_event")||(n=n.closest("._lr_event"));n.length>0&&(t.push({uuid:n.data("event-identifier"),eventType:n.data("event-type")}),n.data("event-stoppropagation")===!1||"false"===n.data("event-stoppropagation"));){var s=n.parent();n=s.hasClass("_lr_event")?s:s.closest("._lr_event")}return t},_initEventInfo:function(e){this._eventInfo=this._getEventInfo(e)},_clearEventInfo:function(e){this._eventInfo=null},_events:function(e){var i=this,n=e.mType;switch("move"!==n&&a.debug("domevent-self",n),e.mType){case"lrTap":this._initEventInfo(e);break;case"down":this._initEventInfo(e),null==this._eventInfo||this._eventInfo.length<=0?this.__triggerEvent(t.Blur):this.__triggerEvent(t.Blur,this._eventInfo[0].uuid);break;case"beforemove":break;case"move":break;case"aftermove":}switch(this._eventInfo&&this._eventInfo.forEach(function(t){t.eventType.indexOf(n)>-1&&i.__triggerEvent(t.uuid,n,t.uuid,{moveAbs:e.mMoveAbs,currentPos:e.mCurrentPos,lastPos:e.mLastPos})}),e.mType){case"up":this._clearEventInfo(e)}},_domEvents:function(){var e=this,t=!1,i=!1,n=!1,r=0,o={},l={},c=function(c){if(!e._option.lock){var h=c.type||"";switch("mousemove"!==h&&"touchmove"!==h&&a.debug("domevent-original",h),h){case"mousedown":case"touchstart":r=(new Date).getTime(),"mousedown"===h&&(o=s.getPagePos(c)),t=!0,n=!1,"touchstart"===h&&(i=!0),c.mType="down";break;case"mousemove":case"touchmove":if(!t)return;c.preventDefault();var u=s.getPagePos(c);c.mLastPos=l,c.mCurrentPos=u;var g=u.x-l.x,f=u.y-l.y;c.mMoveAbs={x:g,y:f},c.mxj=parseFloat(l.x*u.y)-parseFloat(u.x*l.y),0===g&&0===f||(n||(c.mType="beforemove",e._events(c)),c.mType="move",n=!0);break;case"touchend":case"touchcancel":case"mouseup":case"mouseleave":n&&(c.mType="aftermove",e._events(c)),c.mMoveTrigger=n,n=!1,t=!1,c.mType="up";break;case"lrTap":if(c.mType=h,"touchclick"===c.tapEventSource||"mouseclick"===c.tapEventSource&&i?c.mTouchTrigger=!0:c.mTouchTrigger=!1,i=!1,"mouseclick"===c.tapEventSource){var d=s.fixPcClick(o,s.getPagePos(c),r,(new Date).getTime());if(!d)return}break;default:c.mType=h}e._events(c),(s.isMove(h)||s.isDown(h))&&(l=s.getPagePos(c))}};e._domEvents=c}});return r.addDomEvent=function(e,t,n,s){t&&t.length>0&&("undefined"==typeof s&&(s=!0),i(e).attr("class","_lr_event"),i(e).data("event-type",t),i(e).data("event-identifier",n),i(e).data("event-stoppropagation",s))},r}),s("js/reflector/LightComplexArray",["js/base/base","js/utils/utils"],function(e,t){var i=n("js/reflector/LightComplex/main"),s=(n("js/view/LightLine"),e({_lightArray:[],_lightEnable:[],_lightDrawBefore:[],_chainMode:!1,_currentHighZIndex:0,create:function(e,i,n,s,a,r){var o=Object.create(this);return o._uuid=t.getUuid(),o.__base(e,[]),o._config=i,o._lightArray=[],o._lightDrawBefore=[],o._lightEnable=[],o._chainMode=a||!1,o.createView(s,n,r),o.initZIndexEvent(),o},createView:function(e,t,n){var s=this;this._config.forEach(function(a,r){var o=i.create(s.__getEventBus(),a,e,t,n);s._lightArray.push(o),o.setVisibility(a.Visible),s._lightEnable[r]=a.Visible,s._lightDrawBefore[r]=a.Visible})},appendToView:function(e){this.each(function(){e.addShape(this.getView())})},gtIndexAppendToView:function(e){this.each(function(){this.gtIndexAppendToView(e)}),this.each(function(){this.bringBtnToTop()})},btnStillInBox:function(){this.each(function(){this.btnStillInBox()})},each:function(e,t){var i=this;this._lightArray.forEach(function(n,s){var a=!0;i.indexValidate(t)&&(a=t===s),a&&e.apply(n,[s])})},indexValidate:function(e){return"undefined"!=typeof e&&e<this._lightArray.length},getCommandLength:function(e){return this._lightArray[e||0].getCommandLength()},pushDrawCommand:function(e,t,i){this.each(function(i){this.pushDrawCommand(e,t)},i)},setPedalDrawIndex:function(e,t){this.each(function(t){this.setPedalDrawIndex(e)},t)},setDrawIndex:function(e,t){this.each(function(t){this.setDrawIndex(e)},t)},resetAngle:function(e,t,i){this.each(function(i){this.resetAngle(e,t)},i)},changeChainLineCommonFill:function(){if(this._chainMode){var e=this;this.each(function(t){var i=!0;t+1>=e._lightArray.length&&(i=!1),i?0===t?this.setReflectionLineCommonFill(e.isEnableAndDraw(t+1)):(this.setIncidenceLineCommonFill(e.isEnableAndDraw(t-1)),this.setReflectionLineCommonFill(e.isEnableAndDraw(t+1))):0!==t&&this.setIncidenceLineCommonFill(e.isEnableAndDraw(t))})}},setCommonLineVisible:function(e){var t=this;this.each(function(e){var i=!0;e+1>=t._lightArray.length&&(i=!1),t.isEnableAndDraw(e)&&(i?0===e?t.isEnableAndDraw(e+1)&&this.setReflectionLineVisible(t._currentHighZIndex===e):1===e&&(t.isEnableAndDraw(e+1)&&this.setReflectionLineVisible(t._currentHighZIndex===e),this.setIncidenceLineVisible(t._currentHighZIndex===e)):0!==e&&this.setIncidenceLineVisible(!0))})},drawAll:function(e,t){var i=this;this.each(function(e){i.hasNextEnable(e)&&(i._lightArray[e+1].setVisibility(!0),i._lightDrawBefore[e+1]=!0),this.drawAll(function(){})},e),i.changeChainLineCommonFill(),t&&t()},drawNext:function(e,t){var i=this,n=!1;this.each(function(e){this.hasNext()&&!n&&(n=!0,this.drawNext(function(){t&&t()})),!n&&i.hasNextEnable(e)&&(n=!0,i._lightArray[e+1].setVisibility(!0),i._lightDrawBefore[e+1]=!0,t&&t())},e),i.changeChainLineCommonFill()},hasNextEnable:function(e){var t=this;return!!(e+1<t._lightArray.length&&t._lightEnable[e+1]===!0&&t._lightArray[e+1].isVisibilityHidden())},hasDrawNext:function(e){var t=!1;return this.each(function(e){t||(t=this.hasNext())},e),t},hasNext:function(e){var t=!1,i=this;return this.each(function(e){t||(t=this.hasNext()),t||(t=i.hasNextEnable(e))},e),t},setAllEnable:function(e){var t=this;this.each(function(i){t._lightEnable[i]=e,e||this.setVisibility(!1),t._lightDrawBefore[i]&&t._lightEnable[i]&&this.setVisibility(!0)})},setEnable:function(e,t){this._lightEnable[e]=t,e===this._currentHighZIndex&&t===!1&&this.showFirstIndex(),this._lightDrawBefore[e]&&this._lightEnable[e]&&this._lightArray[e].setVisibility(!0),t===!1&&this._lightArray[e].setVisibility(!1),this.__triggerEvent("insidechange","enablechange")},setSectorEnable:function(e){this.each(function(){this.setSectorEnable(e)})},isEnableAndDraw:function(e){return this._lightEnable[e]&&this._lightDrawBefore[e]},getData:function(e){var t={LightComplex:[]};return this.each(function(){t.LightComplex.push(this.getData())},e),t},rotateAble:function(e,t){var i=this,n=!0;return this.each(function(s){n&&(e=t&&i._config[s].IncidenceLine.rotateFixed?-e:e,n=this.complexRotateAble(e))}),n},around:function(e,t){this.each(function(i){this.around(e,t)})},updatePos:function(){this.each(function(){this.updatePos()})},adsorptionPedal:function(){this.each(function(){this.adsorptionPedal()})},adsorption:function(){this.each(function(){this.adsorptionPedal(),this.adsorptionStatic()})},isPedalExcludeDisable:function(e){var t=!0;return this.each(function(){this.isVisibilityHidden()||t&&(t=this.isPedal())},e),t},isPedal:function(e){var t=!0;return this.each(function(){t&&(t=this.isPedal())},e),t},initZIndexEvent:function(){var e=this;this.each(function(t){var i=this;!function(t){i.setViewTapListener(function(){e._currentHighZIndex=t,e.each(function(e){this.changeTransparent(t===e)})})}(t)})},getCurrentHighZIndex:function(){return this._currentHighZIndex},showFirstIndex:function(){this.each(function(e){this.changeTransparent(0===e)})},setIncidenceNameEnable:function(e){this.each(function(t){this.setIncidenceNameEnable(e)})},setIncidenceNameVisible:function(e){this.each(function(t){this.setIncidenceNameVisible(e)})},get:function(e){return this._lightArray[e]},getDrawBegin:function(){return this._lightArray[0].getDrawBegin()},setNameVisible:function(e){this.each(function(){this.setNameVisible(e)})},setLinePedalChangeLock:function(e){this.each(function(t){this.setLinePedalChangeLock(e)})},getCount:function(){return this._lightArray.length}}));return s}),s("js/reflector/reflector1",["js/reflector/baseReflector","js/utils/utils","js/utils/graphMath","js/utils/svg"],function(e,t,s,a){var r=n("js/view/surface"),o=n("js/reflector/LightComplexArray"),l=n("js/view/EqualAngleName"),c=(n("js/config/eventKey"),n("js/reflector/btns")),h=e({_CONFIG:{LightComplex:[{IncidenceLine:{width:370,arrowPos:140,defaultAngle:60,rotateFixed:!1,clickAble:!0,rotateFixedAfterDraw:!0},ReflectionLine:{visible:!1,rotateFixed:!1,clickAble:!1,width:370,arrowPos:140},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!0,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,letterR:110,angleR:180},IncidencePosX:260,DrawIndex:[[0,1,2,3],[4,5,6],[7,11],[8,9]],PedalDrawIndex:[[0,1,2],[4,5,6],[7,9,10]],Visible:!0}],Surface:{width:520,defaultAngle:0,rotatePosX:260,rotatePosY:4,visible:!0,clickAble:!0,type:r.Type.tl}},_TYPE:1,_Event:[],_event:null,_$$container:null,_incidencePointPos:null,_surfacePagePos:null,_option:null,_equalAngleNameHasShowBefore:!1,create:function(e,n,s,a){var r=Object.create(this);return r._uuid=t.getUuid(),r._event=i.extend(!0,[],this._Event),r.initEvent(),r.__base(e,r._event),r.__proxyAll(["onSurfaceMove","onLineMove","nameVisibleHandler"]),r._$$container=n,r._config=i.extend(!0,{},this._CONFIG,a&&a.configData||{}),r._option=s,r.createView(),r.afterCreateView(),r.initExtrasDrawCommand(),r},initEvent:function(){},createView:function(){var e=this;this._surface=r.create(this.__getEventBus(),this._config.Surface,this.onSurfaceMove,this._option.langData),this._config.Surface.clickAble&&(this.btns=c.create(this.__getEventBus(),this._$$container,1),this._surface.setMoveListener(function(t,i,n,s){e.btns.moveBtnEventHandler(t,i,n,s),e._lightComplexArray.btnStillInBox()})),this._lightComplexArray=o.create(this.__getEventBus(),this._config.LightComplex,this._option,this.onLineMove,!1,this._TYPE),this._lightComplexArray.appendToView(this._$$container),this._equalAngleName=l.create(this._option.langData),this._$$container.addShape(this._surface.getView()),this._$$container.addShape(this._equalAngleName.getView()),this._lightComplexArray.gtIndexAppendToView(this._$$container),this.btns&&this.btns.appendToView(this._$$container),this._surface.setNameVisible(this._option.nameVisible),this._config.EqualAngleName?(e._equalAngleNameHasShowBefore=this._config.EqualAngleName.visible,this._equalAngleName.setVisibility(this._config.EqualAngleName.visible)):this._equalAngleName.setVisibility(!1),this.resetAngle(this._config.Surface.defaultAngle,!0),this.toCenter(),e._lightComplexArray.btnStillInBox(),this.initEqualAngleNamePos()},initExtrasDrawCommand:function(){var e=this,t=this._lightComplexArray.getCommandLength();this._lightComplexArray.pushDrawCommand(function(t){e._lightComplexArray.isPedal()&&(e._equalAngleNameHasShowBefore=!0,e._equalAngleName.setVisibility(!0)),t.resolve()},function(){return!e._lightComplexArray.isPedal()||(!e._equalAngleName.isVisibilityHidden()||e._equalAngleNameHasShowBefore)});var n=i.extend(!0,[],this._config.LightComplex[0].PedalDrawIndex);n.splice(2,0,t),this._lightComplexArray.setPedalDrawIndex(n)},afterCreateView:function(){},initEqualAngleNamePos:function(){var e=this._equalAngleName.getView().getWidth(),t=this._equalAngleName.getView().getHeight(),i=this._$$container.container.getWidth(),n=this._$$container.node.getCTM(),s=this._$$container.container.node.getCTM().a,a=i/s-n.e/s-e-50,r=n.f/s-t;this._equalAngleName.setTranslate(a,-r)},toCenter:function(){this._$$container.setTranslate(this._option.viewPortWidth/2-this.getWidth()/2,this._option.viewPortHeight/2+60)},resetAngle:function(e,t){this._surface.rotate(e);var i=this._surface.getRotateAngle()||0;this._lightComplexArray.resetAngle(i,t)},getData:function(){var e={};return e.type=this._TYPE,e.configData=this._lightComplexArray.getData(),e.configData.Surface={defaultAngle:this._surface.getRotateAngle(),visible:!this._surface.isVisibilityHidden()},e.configData.EqualAngleName={visible:!this._equalAngleName.isVisibilityHidden()},e},getMoveRotateAngle:function(e){var t=e.currentPos,i=e.lastPos;return s.getRotateAngle(this._surface.getRotateOffsetPos(),i,t)},onSurfaceMove:function(e,t){if("move"===t){var i=this.getMoveRotateAngle(e);this._lightComplexArray.rotateAble(i)&&(this.resetAngle(i),this._lightComplexArray.around(this._surface.getRotateAngle(),this._config.Surface.rotatePosX))}else"aftermove"===t&&this._lightComplexArray.adsorption();this.initEqualAngleVisibility()},onLineMove:function(e,t){this.initEqualAngleVisibility(),this.afterLineMove()},afterLineMove:function(){},initEqualAngleVisibility:function(){this._lightComplexArray.isPedal()?(this._equalAngleNameHasShowBefore||this._lightComplexArray.get(0).getTwoLineVisible())&&this._equalAngleName.setVisibility(!0):this._equalAngleName.setVisibility(!1)},getWidth:function(){return this._config.Surface.width}});return h.Extend=function(e){return Object.create(h).__include(e)},h}),s("js/reflector/reflector2",["js/reflector/reflector1"],function(e){var t=n("js/view/surface"),i=e.Extend({_CONFIG:{LightComplex:[{IncidenceLine:{visible:!1,rotateFixed:!1,clickAble:!1,defaultAngle:60,arrowPos:140},ReflectionLine:{visible:!0,rotateFixed:!1,clickAble:!0,rotateFixedAfterDraw:!0,arrowPos:140},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!1,sectorOutVisible:!0,incidenceVisible:!1,reflectionVisible:!1,letterR:110,angleR:180},IncidencePosX:260,DrawIndex:[[0,1,9,8],[5,6,7],[4,11],[2,3]],PedalDrawIndex:[[0,1,9],[5,6,7],[4,10,2]],Visible:!0}],Surface:{width:520,defaultAngle:0,rotatePosX:260,visible:!0,clickAble:!0,type:t.Type.tl}},_TYPE:2});return i}),s("js/reflector/reflector3",["js/reflector/reflector1"],function(e){var t=n("js/view/surface"),s=e.Extend({_CONFIG:{LightComplex:[{IncidenceLine:{visible:!0,rotateFixed:!1,defaultAngle:60,arrowPos:140},ReflectionLine:{visible:!0,rotateFixed:!1,arrowPos:140},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!1,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,letterR:110,angleR:180},IncidencePosX:260,DrawIndex:[[0,1,8,3],[4,7,11],[5],[2,6,9]],PedalDrawIndex:[[0,1,10],[5,4,7],[6,2,9]],Visible:!0,view90PedalLineVisible:!1}],Surface:{width:520,defaultAngle:0,rotatePosX:260,visible:!1,clickAble:!1,type:t.Type.tl}},_TYPE:3,initExtrasDrawCommand:function(){var e=this,t=this._lightComplexArray.getCommandLength();this._lightComplexArray.pushDrawCommand(function(t){e._equalAngleNameHasShowBefore=!0,e._equalAngleName.setVisibility(!0),t.resolve()},function(){return!e._equalAngleName.isVisibilityHidden()}),this._lightComplexArray.pushDrawCommand(function(t,i){e._surface.setVisibility(!0),t.resolve()},function(){return!e._surface.isVisibilityHidden()});var n=i.extend(!0,[],this._config.LightComplex[0].PedalDrawIndex),s=i.extend(!0,[],this._config.LightComplex[0].DrawIndex);n.splice(1,0,t),n[3].push(t+1),s[3].push(t+1),this._lightComplexArray.setDrawIndex(s),this._lightComplexArray.setPedalDrawIndex(n)}});return s}),s("js/reflector/reflector4",["js/reflector/reflector1","js/utils/graphMath","js/utils/logger","js/config/style","js/view/LightLine"],function(e,t,s,a,r){var o=a.LineStyle,l=(n("js/utils/view"),n("js/view/sector")),c=n("js/config/eventKey"),h=n("js/view/Surface"),u=e.Extend({_CONFIG:{LightComplex:[{IncidenceLine:{defaultAngle:60,rotateFixed:!1,clickAble:!1,visible:!1,width:410,arrowPos:210,PedalWidth:350,PedalArrowPos:150,highLineZIndex:!0},ReflectionLine:{visible:!0,rotateFixed:!1,clickAble:!0,width:410,arrowPos:150,PedalWidth:410,PedalArrowPos:150},NormalLine:{lineVisible:!1,pointNameVisible:!1,width:470},Sector:{sectorInVisible:!1,sectorOutVisible:!0,incidenceVisible:!1,reflectionVisible:!1,letterR:90,angleR:90},IncidencePosX:331,DrawIndex:[[0,1,9,8],[5,6,7],[4,11],[2,3]],PedalDrawIndex:[[0,1,9],[5,6,7],[4,2]],Visible:!0},{IncidenceLine:{defaultAngle:40,rotateFixed:!1,clickAble:!1,visible:!1,width:410,arrowPos:210,PedalWidth:350,PedalArrowPos:150,highLineZIndex:!0},ReflectionLine:{visible:!0,rotateFixed:!1,clickAble:!0,width:410,arrowPos:150,PedalWidth:410,PedalArrowPos:150},NormalLine:{lineVisible:!1,pointNameVisible:!1,width:470},Sector:{sectorInVisible:!1,sectorOutVisible:!0,incidenceVisible:!1,reflectionVisible:!1,letterR:90,angleR:90},IncidencePosX:585,DrawIndex:[[0,1,9,8],[5,6,7],[4,11],[2,3]],PedalDrawIndex:[[0,1,9],[5,6,7],[4,2]],Visible:!0}],Surface:{width:916,defaultAngle:0,rotatePosX:458,visible:!0,clickAble:!1,type:h.Type.tl_Large}},_TYPE:4,_incidenceWidth:[],initEvent:function(){this.pushEvent({key:c.LightLineVisible,callback:"lightLineVisibleHandler",params:[]}),this.pushEvent({key:c.NameVisible,callback:"nameVisibleHandler",params:[]})},afterCreateView:function(){this._incidenceWidth=[];var e=this._option.langData.rf_incidence_line_name;this._$$incidenceName=new kity.Text,this.setCommonNameVisible(!1),this._$$incidenceName.setContent(e).setAttr("class",o[r.Type.IncidenceLine].fontClass),this._$$container.addShape(this._$$incidenceName),this._lightComplexArray.showFirstIndex(),this.afterLineMove()},lightLineVisibleHandler:function(e,t){t&&this.setCommonNameVisible(t)},nameVisibleHandler:function(e){this.setCommonNameVisible(e)},setCommonNameVisible:function(e){this._$$incidenceName&&(this._incidenceWidth.length>0&&this._lightComplexArray.get(0).getIncidenceLineVisible()&&e===!0?this._$$incidenceName.setVisible(this.getNameVisible()):this._$$incidenceName.setVisible(!1))},initExtrasDrawCommand:function(){e.initExtrasDrawCommand.apply(this,[]);var t=this,n=this._lightComplexArray.getCommandLength(),s=function(e){t._lightComplexArray.get(e).pushDrawCommand(function(i){t._lightComplexArray.get(e).setIncidenceShortPedalView(t._incidenceWidth[e]),i.resolve()},function(){return t._lightComplexArray.get(e).isDrawIncidenceShortPedalView(t._incidenceWidth[e])})};s(0),s(1);var a=i.extend(!0,[],this._config.LightComplex[0].PedalDrawIndex);a[a.length-1].push(n),this._lightComplexArray.setPedalDrawIndex(a)},initEqualAngleNamePos:function(){var e=this._$$container.getTransform().m,t=this._equalAngleName.getView().getWidth(),i=this._equalAngleName.getView().getHeight();this._equalAngleName.setTranslate(this._option.viewPortWidth-e.e-t-20,-(e.f-i-20))},initEqualAngleVisibility:function(){},afterLineMove:function(){var e=this,i=this._config,n=[];this._lightComplexArray.each(function(s){var a={x:i.LightComplex[s].IncidencePosX,y:0},r=e._lightComplexArray.get(s).getIncidenceRotateAngle(),o=t.getLineKb(180-r,a),l={a:a,b:{x:(5e3-o.b)/o.k,y:5e3}};n.push(l)});var a=this._lightComplexArray.get(0),r=this._lightComplexArray.get(1),o=t.getTwoLineIntersection(n[0].a,n[0].b,n[1].a,n[1].b);if(o){var c=t.getPythagoreanLineC(o.y,n[0].a.x-o.x),h=t.getPythagoreanLineC(o.y,n[1].a.x-o.x);this._incidenceWidth=[c,h],a.setIncidenceLineWidth(c),r.setIncidenceLineWidth(h+2),this.setCommonNameVisible(this.getNameVisible());var u=Math.round(this._lightComplexArray.get(0).getIncidenceRotateAngle()),g=Math.round(this._lightComplexArray.get(1).getIncidenceRotateAngle()),c=(this._$$incidenceName.getWidth()||112)+10;u>90&&g<=90?o.x>this._CONFIG.LightComplex[0].IncidencePosX&&(c=o.x-this._CONFIG.LightComplex[0].IncidencePosX-10):u<=90?c=c:g>90&&(c=-10),s.debug("reflector4",this._CONFIG.LightComplex[0].IncidencePosX,o.x),this._$$incidenceName.setTranslate(o.x-c,-o.y-15),this._lightComplexArray.setIncidenceNameEnable(!1),this._lightComplexArray.setLinePedalChangeLock(!0)}else this._incidenceWidth=[],0===Math.round(a.getSectorAngle(l.Type.Incidence))?(a.setIncidenceLineWidth(this._CONFIG.LightComplex[0].IncidenceLine.PedalWidth),a.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.PedalArrowPos)):(a.setIncidenceLineWidth(this._CONFIG.LightComplex[0].IncidenceLine.width),a.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.arrowPos)),0===Math.round(r.getSectorAngle(l.Type.Incidence))?(r.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.PedalWidth),r.setIncidenceLineArrowPos(this._CONFIG.LightComplex[1].IncidenceLine.PedalArrowPos)):(r.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width),r.setIncidenceLineArrowPos(this._CONFIG.LightComplex[1].IncidenceLine.arrowPos)),this.setCommonNameVisible(!1),this._lightComplexArray.setIncidenceNameEnable(!0),this._lightComplexArray.setIncidenceNameVisible(this.getNameVisible()),this._lightComplexArray.setLinePedalChangeLock(!1);s.debug("reflector4",o,n)},toCenter:function(){this._$$container.setTranslate(this._option.viewPortWidth/2-this.getWidth()/2,this._option.viewPortHeight/2+250)}});return u}),s("js/reflector/reflector5",["js/reflector/baseReflector","js/utils/utils","js/utils/graphMath","js/utils/svg"],function(e,t,s,a){var r=n("js/view/surface"),o=n("js/utils/logger"),l=n("js/view/Sector"),c=n("js/reflector/LightComplexArray"),h=n("js/view/EqualAngleName"),u=n("js/view/LightLine"),g=n("js/reflector/btns"),f={x:7,y:4,tr:14,verticalX:6,verticalY:3},d=e({_CONFIG:{LightComplex:[{IncidenceLine:{defaultAngle:60,rotateFixed:!1,clickAble:!0,width:270,rotateFixedAfterDraw:!0,PedalWidth:270,arrowPos:100,PedalArrowPos:100},ReflectionLine:{visible:!1,rotateFixed:!1,clickAble:!1,width:270,arrowPos:150,PedalWidth:210,PedalArrowPos:105},NormalLine:{width:280},Sector:{sectorInVisible:!0,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,letterR:90,angleR:90},IncidencePosX:-255,DrawIndex:[[0,1,2,3],[4,5,6],[7,11],[8,9]],PedalDrawIndex:[[0,1,2],[4,5,6],[7,9,10]],Visible:!0,nameEventEnable:!0,NameAutoPos:!0},{IncidenceLine:{defaultAngle:50,rotateFixed:!1,clickAble:!1,visible:!0,need:!0,width:68,arrowPos:0,arrowVisible:!1},NormalLine:{width:210},ReflectionLine:{visible:!1,rotateFixed:!1,clickAble:!1,width:270,arrowPos:135},Sector:{sectorInVisible:!0,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,letterR:85},IncidencePosX:0,DrawIndex:[[0,1,2,3],[4,5,6],[7,11],[8,9]],PedalDrawIndex:[[0,1,2],[4,5,6],[7,9,10]],Visible:!1,nameEventEnable:!0},{IncidenceLine:{defaultAngle:50,rotateFixed:!1,clickAble:!1,visible:!0,need:!0,width:68,arrowPos:0,arrowVisible:!1},NormalLine:{width:210},ReflectionLine:{visible:!1,rotateFixed:!1,clickAble:!1,width:270,arrowPos:135},Sector:{sectorInVisible:!0,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,letterR:90,angleR:90},IncidencePosX:0,DrawIndex:[[0,1,2,3],[4,5,6],[7,11],[8,9]],PedalDrawIndex:[[0,1,2],[4,5,6],[7,9,10]],Visible:!1,nameEventEnable:!0}],Surface:{width:630,defaultAngle:0,rotatePosX:f.x,rotatePosY:f.y,visible:!0,clickAble:!0,nameEventEnable:!0,type:r.Type.tl},SurfaceVertical:{width:480,defaultAngle:90,rotatePosX:480-f.x,rotatePosY:f.y,visible:!0,clickAble:!0,nameEnable:!1,nameEventEnable:!0,type:r.Type.tr}},_TYPE:5,_$$container:null,_incidencePointPos:null,_surfacePagePos:null,_option:null,_equalAngleNameHasShowBefore:!1,create:function(e,n,s,a){var r=Object.create(this);return r._uuid=t.getUuid(),r.__base(e,[]),r.__proxyAll(["onSurfaceMove","onLineMove","onVerticalSurfaceMove"]),r._$$container=n,r._config=i.extend(!0,{},this._CONFIG,a&&a.configData||{}),s.reflector5NameEnable===!1&&(r._config.Surface.nameEventEnable=!1,r._config.SurfaceVertical.nameEventEnable=!1,r._config.LightComplex.forEach(function(e){e.nameEventEnable=!1})),r._option=s,r.createView(),r.afterCreateView(),r.initExtrasDrawCommand(),r},createView:function(){var e=this;this._surface=r.create(this.__getEventBus(),this._config.Surface,this.onSurfaceMove,this._option.langData),
this._surfaceVertical=r.create(this.__getEventBus(),this._config.SurfaceVertical,this.onVerticalSurfaceMove,this._option.langData);var t=this._config.Surface.clickAble?1:0;if(this._config.SurfaceVertical.clickAble&&t++,t>0){var i=this.btns=g.create(this.__getEventBus(),this._$$container,t);this._config.Surface.clickAble&&this._surface.setMoveListener(function(t,n,s,a){i.moveBtnEventHandler(t,n,s,a),e._lightComplexArray.btnStillInBox()}),this._config.SurfaceVertical.clickAble&&this._surfaceVertical.setMoveListener(function(t,n,s,a){i.moveBtnEventHandler(t,n,s,a),e._lightComplexArray.btnStillInBox()})}this._lightComplexArray=c.create(this.__getEventBus(),this._config.LightComplex,this._option,this.onLineMove,!0,this._TYPE),this._lightComplexArray.appendToView(this._$$container),this._equalAngleName=h.create(this._option.langData),this._$$container.addShape(this._surface.getView()),this._$$container.addShape(this._surfaceVertical.getView()),this._$$container.addShape(this._equalAngleName.getView()),this._lightComplexArray.gtIndexAppendToView(this._$$container),this.btns&&this.btns.appendToView(this._$$container),this._surface.setNameVisible(this._option.nameVisible),this._config.EqualAngleName?(e._equalAngleNameHasShowBefore=this._config.EqualAngleName.visible,this._equalAngleName.setVisibility(this._config.EqualAngleName.visible)):this._equalAngleName.setVisibility(!1),this._surfaceVertical.setTranslateX(-this._config.SurfaceVertical.width+f.tr),this.setSurfaceVerticalAngle(this._config.SurfaceVertical.defaultAngle,!0),this._surface.rotate(this._config.Surface.defaultAngle),this._lightComplexArray.get(1).resetAngle(this._config.Surface.defaultAngle,!0),this._lightComplexArray.get(2).resetAngle(this._config.SurfaceVertical.defaultAngle,!0),this.toCenter(),this.initEqualAngleNamePos()},initEqualAngleNamePos:function(){var e=this._equalAngleName.getView().getWidth(),t=this._equalAngleName.getView().getHeight(),i=this._$$container.container.getWidth(),n=this._$$container.node.getCTM(),s=this._$$container.container.node.getCTM().a,a=i/s-n.e/s-e-50,r=n.f/s-t;this._equalAngleName.setTranslate(a,-r)},afterCreateView:function(){this._lightComplexArray.showFirstIndex(),this.mathLine(),this._option.reflector5NameEnable===!1&&this.setNameVisible(!1)},setNameVisible:function(e){this._surface.setNameVisible(e),this._surfaceVertical.setNameVisible(e),this._lightComplexArray.setNameVisible(e)},setSurfaceVerticalAngle:function(e,t){this._surfaceVertical.rotate(e),this._lightComplexArray.get(0).resetAngle(e,t),this._lightComplexArray.get(0).around(e,-f.x,f.tr)},getData:function(){var e={};return e.type=this._TYPE,e.configData=this._lightComplexArray.getData(),e.configData.Surface={defaultAngle:this._surface.getRotateAngle()},e.configData.SurfaceVertical={defaultAngle:this._surfaceVertical.getRotateAngle()},e.configData.EqualAngleName={visible:!this._equalAngleName.isVisibilityHidden()},e},getMoveRotateAngle:function(e){var t=e.currentPos,i=e.lastPos;return s.getRotateAngle(this._surface.getRotateOffsetPos(),i,t)},onSurfaceMove:function(e,t){var i=!0;if("move"===t){var n=this.getMoveRotateAngle(e),s=Math.abs(this._surfaceVertical.getRotateAngle()-this._surface.getRotateAngle()-n);s<180&&this._surface.rotate(n)}else"aftermove"===t&&this._lightComplexArray.adsorptionPedal();var s=Math.abs(this._surfaceVertical.getRotateAngle()-this._surface.getRotateAngle());s>=177?(this._lightComplexArray.setAllEnable(!1),i=!1):this._lightComplexArray.setEnable(0,!0),i&&(this.mathLine(),this.initEqualAngleVisibility())},onVerticalSurfaceMove:function(e,t){var i=!0;if("move"===t){var n=this.getMoveRotateAngle(e);if(this._lightComplexArray.rotateAble(n)){var s=Math.abs(this._surfaceVertical.getRotateAngle()-this._surface.getRotateAngle()+n);s<180&&this._surfaceVertical.rotate(n)}}else"aftermove"===t&&this._lightComplexArray.adsorptionPedal();var s=Math.abs(this._surfaceVertical.getRotateAngle()-this._surface.getRotateAngle());s>=177?(this._lightComplexArray.setAllEnable(!1),i=!1):this._lightComplexArray.setEnable(0,!0);var a=this._surfaceVertical.getRotateAngle()||0;this._lightComplexArray.get(0).resetAngle(a),this._lightComplexArray.get(0).around(this._surfaceVertical.getRotateAngle(),-f.x,f.tr),i&&(this.mathLine(),this.initEqualAngleVisibility())},onLineMove:function(e,t){e===this._lightComplexArray.get(0).getUuid()&&this.mathLine(),this.initEqualAngleVisibility()},initEqualAngleVisibility:function(){this._lightComplexArray.isPedalExcludeDisable()&&this._lightComplexArray.isEnableAndDraw(0)?(this._equalAngleNameHasShowBefore||this._lightComplexArray.get(0).getTwoLineVisible())&&this._equalAngleName.setVisibility(!0):this._equalAngleName.setVisibility(!1)},getSurfaceXAxisDegree:function(e){var t=e.getRotateAngle()%180;return t=t<=0?-t:180-t},getSurfaceSpherePos:function(e,t,i){return this._surface===t?e>0&&e<=90?i.y=-i.y:e>90&&e<=180?(i.y=-i.y,i.x=-i.x):e>180&&e<=270&&(i.x=-i.x):e>0&&e<=90?i.x=-i.x:e>90&&e<=180||(e>180&&e<=270?i.y=-i.y:e>270&&e<=360&&(i.y=-i.y,i.x=-i.x)),i},getSurfacePos:function(e){var t={x:this._config.Surface.rotatePosX,y:0};e===this._surfaceVertical&&(t={x:f.tr-f.x,y:0});var i=this.getSurfaceXAxisDegree(e),n={a:t,b:s.getLinePosByAngle(i,e===this._surface?this._config.Surface.width-f.x:this._config.SurfaceVertical.width-f.x)},a=e.get0To360RotateAngle();return n.b=this.getSurfaceSpherePos(a,e,n.b),n.b.x+=t.x,n},getLineSpherePos:function(e,t,i){var n={};return t>0&&t<=90||t>270&&t<=360?n={x:i.x-1e3,y:e.k*(i.x-1e3)+e.b}:(t>90&&t<=180||t>180&&t<=270)&&(n={x:i.x+1e3,y:e.k*(i.x+1e3)+e.b}),n},getFirstLinePos:function(e){var t=this._lightComplexArray.get(0).getLine0To360RotateAngle(e),i=this.getSurfaceXAxisDegree(this._surfaceVertical),n=s.getLinePosByAngle(i,Math.abs(this._config.LightComplex[0].IncidencePosX)-f.x),a=this._surfaceVertical.get0To360RotateAngle();n=this.getSurfaceSpherePos(a,this._surfaceVertical,n),n.x=n.x+(f.tr-f.x);var r=this._lightComplexArray.get(0).getLineXAngle(e),o=s.getLineKb(r,n),l={a:n};return l.b=this.getLineSpherePos(o,t,n),l},getReflectionLine:function(e,t){var i=this._lightComplexArray.get(e).getLine0To360RotateAngle(u.Type.ReflectionLine),n=s.getLineKb(this._lightComplexArray.get(e).getReflectionLineXAngle(),t),a={a:t};return a.b=this.getLineSpherePos(n,i,t),a},getSecondLinePos:function(e){return this.getReflectionLine(1,e)},getThirdLinePos:function(e){return this.getReflectionLine(2,e)},mathLine:function(){var e=this.getSurfacePos(this._surfaceVertical),t=this.getSurfacePos(this._surface),i=this.getFirstLinePos(u.Type.ReflectionLine),n=this.getFirstLinePos(u.Type.IncidenceLine);o.debug("reflector5",t,e,n,i);var a=this._lightComplexArray.get(0),r=this._lightComplexArray.get(1),c=this._lightComplexArray.get(2);a.setIncidenceLineWidth(this._CONFIG.LightComplex[0].IncidenceLine.width),a.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.arrowPos);var h=s.getTwoLineIntersection(t.a,t.b,i.a,i.b);if(h){var g=a.getReflectionRotateAngle()%360-180,d=s.getPythagoreanLineC(h.x-f.x,h.y)+f.x;r.setIncidencePos(d),r.setIncidenceXAxisAngle(g),r.resetAngle(this._surface.getRotateAngle()),r.around(this._surface.getRotateAngle(),f.x);var _=s.getPythagoreanLineC(h.x-i.a.x,h.y-i.a.y);a.setReflectionLineWidth(_),_<=this._CONFIG.LightComplex[1].IncidenceLine.width?r.setIncidenceLineWidth(_):r.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width)}else a.setReflectionLineWidth(this._CONFIG.LightComplex[0].ReflectionLine.width),a.setReflectionLineArrowPos(this._CONFIG.LightComplex[0].ReflectionLine.arrowPos),r.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width);this._lightComplexArray.setEnable(1,!!h);var p=this.getSecondLinePos(h),m=s.getTwoLineIntersection(e.a,e.b,p.a,p.b);if(m){var v=-(s.getPythagoreanLineC(m.x-f.x,m.y)+f.x),g=0;a.getIncidencePosX()>v?(g=a.getIncidenceRotateAngle()<=a.getNormalLineRotateAngle()?2*r.getSectorAngle(l.Type.Incidence)+a.getSectorAngle(l.Type.SurfaceOut)+2*a.getSectorAngle(l.Type.Incidence):2*r.getSectorAngle(l.Type.Incidence)+a.getSectorAngle(l.Type.SurfaceOut),g=180-g,g=180-g):(g=a.getSectorAngle(l.Type.SurfaceOut)+2*r.getSectorAngle(l.Type.Incidence),g=180-g),c.setIncidencePos(v),c.setIncidenceXAxisAngle(g+this._surfaceVertical.getRotateAngle()),c.resetAngle(this._surfaceVertical.getRotateAngle()),c.around(this._surfaceVertical.getRotateAngle(),-f.x,f.tr);var _=s.getPythagoreanLineC(h.x-m.x,h.y-m.y);r.setReflectionLineWidth(_),_<=this._CONFIG.LightComplex[2].IncidenceLine.width?c.setIncidenceLineWidth(_):c.setIncidenceLineWidth(this._CONFIG.LightComplex[2].IncidenceLine.width)}else c.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width);this._lightComplexArray.setEnable(2,!!m);var y=s.getTwoLineIntersection(t.a,t.b,n.a,n.b);if(y){var b=s.getPythagoreanLineC(y.x-n.a.x,y.y-n.a.y),w=this._CONFIG.LightComplex[0].IncidenceLine.width;a.setIncidenceLineWidth(b<w?b:w),b>=w&&a.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.arrowPos)}if(m){var A=this.getThirdLinePos(m),V=s.getTwoLineIntersection(t.a,t.b,A.a,A.b);if(V){var b=s.getPythagoreanLineC(m.x-V.x,m.y-V.y),w=this._CONFIG.LightComplex[0].IncidenceLine.width;c.setReflectionLineWidth(b<w?b:w)}}90===Math.round(a.getIncidenceSurfaceAngle())&&(this._lightComplexArray.setEnable(1,!1),this._lightComplexArray.setEnable(2,!1)),this.surfaceIntersect(n.a,h),this._lightComplexArray.changeChainLineCommonFill()},initExtrasDrawCommand:function(){var e=this,t=this._lightComplexArray.getCommandLength();this._lightComplexArray.pushDrawCommand(function(t){e._lightComplexArray.isPedalExcludeDisable()&&(e._equalAngleNameHasShowBefore=!0,e._equalAngleName.setVisibility(!0)),t.resolve()},function(){return!e._lightComplexArray.isPedalExcludeDisable()||!e._equalAngleName.isVisibilityHidden()},0);var n=i.extend(!0,[],this._config.LightComplex[0].PedalDrawIndex);n.splice(2,0,t),this._lightComplexArray.setPedalDrawIndex(n,0)},surfaceIntersect:function(e,t){var i=!1;if(e){var n=this.getSurfacePos(this._surface),a=s.getPedalHeight(n.a,n.b,e);if(a<=100)for(var r in l.Type){if(i)break;i=this.surfaceEachIntersect(this._lightComplexArray.get(0),e,l.Type[r],n)}}if(t&&!i&&this._lightComplexArray.isEnableAndDraw(1)){var o=this.getSurfacePos(this._surfaceVertical),a=s.getPedalHeight(o.a,o.b,t);if(a<=100)for(var r in l.Type){if(i)break;i=this.surfaceEachIntersect(this._lightComplexArray.get(1),t,l.Type[r],o)}}return this._lightComplexArray.setSectorEnable(!i),i},surfaceEachIntersect:function(e,t,i,n){var a;a=i==l.Type.Reflection?75:i==l.Type.Incidence?65:55;var r=s.getLineCircleIntersectionPos(n.a,n.b,t,a);if(!r)return!1;for(var o=e.getSectorLinesPos(i,t),c={a:o[0].b,b:o[1].b},h=!1,u=0;u<r.length;u++){var g=r[u];if(h)break;h=s.getTwoLineIntersection(t,g,c.a,c.b)}if(h)return!0;for(var u=0;u<o.length;u++){var f=o[u],d=s.getTwoLineIntersection(n.a,n.b,f.a,f.b);if(d)return!0}return!1},toCenter:function(){this._$$container.setTranslate(this._option.viewPortWidth/2-this.getWidth()/2+50,this._option.viewPortHeight/2+200)},getWidth:function(){return this._config.Surface.width},drawAll:function(){var e=this;this._lightComplexArray.drawAll(void 0,function(){e.mathLine()})},drawNext:function(){var e=this;this._lightComplexArray.drawNext(void 0,function(){e.mathLine()})}});return d}),s("js/reflector/reflector6",["js/reflector/reflector1"],function(e){var t=n("js/view/LightLine"),i=n("js/view/surface"),s=e.Extend({_CONFIG:{LightComplex:[{IncidenceLine:{width:370,arrowPos:140,defaultAngle:120,rotateFixed:!1,clickAble:!0,rotateFixedAfterDraw:!0},ReflectionLine:{visible:!1,rotateFixed:!1,clickAble:!1,width:370,arrowPos:140},NormalLine:{lineVisible:!1,pointNameVisible:!1},Sector:{sectorInVisible:!0,sectorOutVisible:!1,incidenceVisible:!1,reflectionVisible:!1,letterR:110,angleR:180},IncidencePosX:260,DrawIndex:[[0,1,2,3],[4,5,6],[7,11],[8,9]],PedalDrawIndex:[[0,1,2],[4,5,6],[7,9,10]],Visible:!0,StaticLine:[{width:370,arrowPos:170,defaultAngle:60,visible:!0,clickAble:!1,rotateFixed:!0,autoAdsorption:!0,arrowReverse:!0,lineType:t.Type.Reverse},{width:370,arrowPos:170,defaultAngle:120,visible:!0,clickAble:!1,rotateFixed:!0,autoAdsorption:!0,arrowReverse:!1,lineType:t.Type.Reverse}]}],Surface:{width:520,defaultAngle:0,rotatePosX:260,visible:!0,clickAble:!0,type:i.Type.tl}},_TYPE:6});return s}),s("js/reflector/reflectorFactory",["js/base/base","js/reflector/reflector1","js/reflector/reflector2","js/reflector/reflector3","js/reflector/reflector4","js/reflector/reflector5","js/reflector/reflector6"],function(e,t,i,n,s,a,r){var o={getReflector:function(e,o,l,c,h){return 1===e?t.create(o,l,c,h):2===e?i.create(o,l,c,h):3===e?n.create(o,l,c,h):4===e?s.create(o,l,c,h):5===e?a.create(o,l,c,h):6===e?r.create(o,l,c,h):void 0}};return o}),s("js/reflector/reflectorMain",["js/base/Base","js/utils/eventBus","js/utils/string","js/utils/utils","js/config/eventKey","js/reflector/reflectorFactory","js/utils/view"],function(e,s,a,r,o,l,c){var h=n("js/reflector/domEvent"),u=n("js/config/lang"),g="1.0.0",f='<div class="${cls}" id="${id}"></div>',d={x:0,y:0,width:1520,height:896},_={create:function(e){var t=Object.create(this);for(var n in e)"langData"===n?t[n]=i.extend(!0,{},u,e.langData):t[n]=e[n];return t},viewPortWidth:d.width,viewPortHeight:d.height,reflectorType:[1,2,3,4,5],nameVisible:!0,surfaceAngleVisible:!0,normalAngleVisible:!0,reflector5NameEnable:!1,lock:!1,langData:u,showDefaultRotateBtn:!1},p=e({_$$paper:null,_$$paperItems:[],_reflectors:[],_currentIndex:0,_id:null,_lock:!1,_init:!1,create:function(e){var t=s.create(),i=Object.create(this);return i._option=_.create(e),i._id=r.getUuid(),i._$$paper=[],i._$$paperItems=[],i._reflectors=[],i.__base(t,[]),i.__on("insidechange",function(e){i._init&&i.__triggerEvent("change",e)}),i},render:function(e){this._init=!1;var n=typeof e;"string"===n?e=t.getElementById(e):"object"===n&&e instanceof jQuery&&(e=e[0]);var s=i(a.template(f,{cls:"fm",id:this._id}));i(e).html(s),this._paper=new kity.Paper(s[0]),this._paper.setViewBox(0,0,this._option.viewPortWidth,this._option.viewPortHeight);var r=h.create(this._paper,this.__getEventBus(),this._option);r.bindDomEvent(),this.createReflector(),this._init=!0,this.__triggerEvent("insidechange","init")},createReflector:function(){var e=this;this._reflectors=[],this._$$paperItems=[];var t=function(t,i,n){var s=(new kity.Group).setId("item_"+t);s.setAttr("class","_lr_item"),e._$$paperItems.push(s),e._paper.addShape(s);var a=l.getReflector(i,e.__getEventBus(),s,e._option,n);return c.setVisibility(s,t===e._currentIndex),e._reflectors.push(a),a};if(this._data&&this._data.data&&this._data.data.length>0)for(var i=this._data.data,n=0;n<i.length;n++){var s=i[n];t(n,s.type,s)}else for(var n=0;n<this._option.reflectorType.length;n++){var a=this._option.reflectorType[n];t(n,a)}},setData:function(e){e.version&&e.data&&(this._data=e)},getData:function(){var e={};return e.version=g,e.data=[],e.currentIndex=this._currentIndex,this._reflectors.forEach(function(t){t&&e.data.push(t.getData())}),e.option={nameVisible:this._option.nameVisible,surfaceAngleVisible:this._option.surfaceAngleVisible,normalAngleVisible:this._option.normalAngleVisible},e},on:function(e,t,i){this.__getEventBus().on(e,t,i)},off:function(e,t,i){this.__getEventBus().off(e,t,i)},show:function(e){this.__triggerEvent(o.Blur),this._currentIndex=e,this._$$paperItems.forEach(function(t,i){c.setVisibility(t,e===i)}),this.__triggerEvent("insidechange","showChange")},getCurrentIndex:function(){return this._currentIndex},setSurfaceAngleVisible:function(e){this._option.surfaceAngleVisible=e,this.__triggerEvent(o.SurfaceAngleVisible,e)},getSurfaceAngleVisible:function(){return this._option.surfaceAngleVisible},setNormalAngleVisible:function(e){this._option.normalAngleVisible=e,this.__triggerEvent(o.NormalAngleVisible,e)},getNormalAngleVisible:function(){return this._option.normalAngleVisible},setNameVisible:function(e){this._option.nameVisible=e,this.__triggerEvent(o.NameVisible,e)},getNameVisible:function(){return this._option.nameVisible},getCurrentReflector:function(){return this._reflectors[this._currentIndex]},drawAll:function(){this.__triggerEvent(o.Blur),this.getCurrentReflector().drawAll()},drawNext:function(){this.__triggerEvent(o.Blur),this.getCurrentReflector().drawNext()},hasNext:function(){return this.getCurrentReflector().hasNext()},updatePos:function(){this._reflectors.forEach(function(e){e&&e.updatePos()})},reset:function(e){i.extend(this._option,e),this._$$paperItems[this._currentIndex].clear();var t=l.getReflector(this._reflectors[this._currentIndex].getType(),this.__getEventBus(),this._$$paperItems[this._currentIndex],this._option,{});this._reflectors[this._currentIndex]=t,this.__triggerEvent("insidechange","reset")},setLock:function(e){this._option.lock=e},destroy:function(){}});return p}),s("js/utils/drawCommand",["js/utils/logger"],function(e){var t={_queue:[],_hasDrawQueue:[],_drawIndex:[],_currentIndex:0,_maxLength:100,_stopCallback:null,_stopFlag:!1,_drawing:!1,create:function(){var e=Object.create(this);return e._queue=[],e._drawIndex=[],e._hasDrawQueue=[],e},push:function(e,t){this._queue.push(this.makeAsPromise(e)),this._hasDrawQueue.push(t)},setCurrentIndex:function(e){this._currentIndex=e},drawNext:function(t,n,s){var a=this;if(this._drawing&&s!==!0)return e.debug("draw","正在绘制中，不能提交新的绘制命令"),void(t&&t(a._currentIndex));if(this.hasNext()){this._drawing=!0;var r=this.hasDraw(this._currentIndex);if(r)return this._currentIndex++,this.drawNext(t,n,!0),void(this._drawing=!1);var o=this.getTask(this._currentIndex);this._currentIndex++;var l=function(){a._drawing=!1,a._stopCallback&&a._stopCallback(),t&&t(a._currentIndex)};return 1===o.length?i.when(o[0](n)).done(l):2===o.length?i.when(o[0](n),o[1](n)).done(l):3===o.length?i.when(o[0](n),o[1](n),o[2](n)).done(l):4===o.length&&i.when(o[0](n),o[1](n),o[2](n),o[3](n)).done(l),!0}return e.debug("draw","已经没有更多命令需要绘制"),t&&t(a._currentIndex),!1},getTask:function(e){var t=this,i=this._drawIndex[e],n=[];return i instanceof Array?i.forEach(function(e){n.push(t._queue[e])}):n.push(t._queue[i]),n},hasNext:function(){for(var e=!1,t=0;t<this._drawIndex.length;t++){var i=this.hasDraw(t);i||(e=!0)}return e},drawAll:function(e,t){for(var i=0;i<this._drawIndex.length;i++){var n=this.getTask(i);n.forEach(function(e){e(t)})}e&&e()},setDrawIndex:function(e){this._drawing||(this._drawIndex=e,this._currentIndex=0)},stop:function(e){return this._drawing?(this._stopFlag=!0,void(this._stopCallback=e)):(this._stopFlag=!0,void(e&&e()))},hasDraw:function(e){var t=this,i=this._drawIndex[e],n=!0;return i instanceof Array?i.forEach(function(e){n&&(n=t._hasDrawQueue[e]())}):n=t._hasDrawQueue[i](),n},makeAsPromise:function(e){return function(){var t=i.Deferred(),n=Array.prototype.slice.apply(arguments,[0]);return n.unshift(t),e.apply(this,n),t.promise()}},getCommandLength:function(){return this._queue.length}};return t}),s("js/utils/eventBus",["js/utils/logger"],function(e){var t={_eventHandler:null,create:function(){var e=Object.create(this);return e._eventHandler={},e},trigger:function(){var t=Array.prototype.slice.apply(arguments,[0]),i=t.shift();if(!this._eventHandler||!this._eventHandler[i])return!1;var n=this._eventHandler[i];return n.forEach(function(n){n.cb.apply(n.domain||this,t),e.debug("event-trigger",i,t.toString())}),!0},on:function(e,t,i){return this._eventHandler[e]||(this._eventHandler[e]=[]),this._eventHandler[e].push({cb:t,domain:i}),!0},off:function(e,t,i){var n=this._eventHandler[e];if(n&&n.length>0)for(var s,a=n.length,r=0;r<a;r++)if(s=n[r],s&&t===s.cb){if(i&&i!==s.domain)continue;n.splice(r,1),r--,a--}n&&0===n.length&&delete this._eventHandler[e]}};return t}),s("js/utils/eventUtils",function(){var e={isDown:function(e){return"touchstart"===e||"mousedown"===e},isUp:function(e){return/^(touchend|touchcancel|mouseup|mouseleave)$/.test(e)},isMove:function(e){return"mousemove"===e||"touchmove"===e},isTouch:function(e){return/^(touchend|touchcancel|touchstart|touchmove)$/.test(e)},getPagePos:function(e){var e=e.originalEvent?e.originalEvent:e,t={};switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return t.x=e.changedTouches[0].pageX,t.y=e.changedTouches[0].pageY,t;default:return t.x=e.pageX,t.y=e.pageY,t}return t},fixPcClick:function(e,t,i,n){var s=n-i,a=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return!(s>800||a>=4||r>=4)}};return e}),s("js/utils/graphMath",function(){var e={getTwoLineIntersection:function(e,t,i,n){var s=(t.y-e.y)*(n.x-i.x)-(e.x-t.x)*(i.y-n.y);if(0==s)return!1;var a=((t.x-e.x)*(n.x-i.x)*(i.y-e.y)+(t.y-e.y)*(n.x-i.x)*e.x-(n.y-i.y)*(t.x-e.x)*i.x)/s,r=-((t.y-e.y)*(n.y-i.y)*(i.x-e.x)+(t.x-e.x)*(n.y-i.y)*e.y-(n.x-i.x)*(t.y-e.y)*i.y)/s;return Math.round((a-e.x)*(a-t.x))<=0&&Math.round((r-e.y)*(r-t.y))<=0&&Math.round((a-i.x)*(a-n.x))<=0&&Math.round((r-i.y)*(r-n.y))<=0&&{x:a,y:r}},getRadian:function(e){return 2*Math.PI/360*e},getDegree:function(e){return 360*e/(2*Math.PI)},getLineKb:function(e,t){var i={};return e>90?(i.k=Math.tan(this.getRadian(180-e)),i.k=-i.k):i.k=Math.tan(this.getRadian(e)),i.b=t.y-i.k*t.x,i},getArc:function(e,t){return 2*Math.PI*t*e/360},getDifferent:function(e,t,i){var n={x:t.x-e.x,y:t.y-e.y},s={x:i.x-e.x,y:i.y-e.y};return parseFloat(n.x*s.y)-parseFloat(s.x*n.y)},getCosineAngle:function(e,t,i){var n=(Math.pow(t,2)+Math.pow(i,2)-Math.pow(e,2))/(2*t*i),s=Math.acos(n);return parseFloat(s*(180/Math.PI))},getCosineAngleByPos:function(e,t,i){var n,s,a;return n=parseFloat(Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))),s=parseFloat(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))),a=parseFloat(Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))),this.getCosineAngle(n,s,a)},getPythagoreanLineC:function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},getLinePosByAngle:function(e,t){e>90&&(e=180-e);var i=Math.cos(this.getRadian(e))*t,n=Math.sin(this.getRadian(e))*t;return{x:i,y:n}},getSvgSectorPoint:function(e,t,i,n,s){var a=Math.PI/180,r=e+i*Math.cos(-n*a),o=t+i*Math.sin(-n*a),l=e+i*Math.cos(-s*a),c=t+i*Math.sin(-s*a),h=[];return h.push("M"),h.push(e),h.push(t),h.push("L"),h.push(r),h.push(o),h.push("A"),h.push(i),h.push(i),h.push(0),h.push(+(s-n>180)),h.push(0),h.push(l),h.push(c),h.push("z"),h.join(" ")},getTwoPointDistance:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},getSpherePos:function(e,t){var i=0+t*Math.cos(e*Math.PI/180),n=0+t*Math.sin(e*Math.PI/180);return{x:i,y:n}},getShortestDistanceAndPoint:function(e,t,i){var n=this.getTwoPointDistance(e,t),s=this.getTwoPointDistance(e,i),a=this.getTwoPointDistance(t,i),r=(n+s+a)/2,o=Math.sqrt(r*(r-n)*(r-s)*(r-a)),l=2*o/a,c=Math.max(n,s),h=Math.sqrt(c*c-l*l),u=0,g={};return h>a?(u=Math.min(s,n),s>n?(u=n,g=t):(u=s,g=i)):(u=l,g=this.getRectVerticalPos(e,t,i,l)),{d:u,pos:g,h:l,minSide:Math.min(n,s)}},getRectVerticalPos:function(e,t,i,n){var s=0,a=0;return t.x===i.x?(s=t.x,a=e.y):(t.y=i.y)&&(a=t.y,s=e.x),{x:s,y:a}},getRectShortestDistance:function(e,t){var i=this.getShortestDistanceAndPoint(e,{x:t.left,y:t.top},{x:t.right,y:t.top}),n=this.getShortestDistanceAndPoint(e,{x:t.right,y:t.top},{x:t.right,y:t.bottom}),s=this.getShortestDistanceAndPoint(e,{x:t.left,y:t.bottom},{x:t.right,y:t.bottom}),a=this.getShortestDistanceAndPoint(e,{x:t.left,y:t.top},{x:t.left,y:t.bottom}),r=i,o=Math.min(i.d,n.d,s.d,a.d);return o===i.d&&(r=i,r.vertical=!0,r.direction="top"),o===n.d&&(r=n,r.vertical=!1,r.direction="right"),o===s.d&&(r=s,r.vertical=!0,r.direction="bottom"),o===a.d&&(r=a,r.vertical=!1,r.direction="left"),r},getLightPos:function(e,t,i){var n,s,a=i,r=e.x,o=e.y,l=t.x,c=t.y,h=(this.getTwoPointDistance(e,t),a/(Math.sqrt(Math.pow(r-l,2)+Math.pow(o-c,2))-a));return n=(r+h*l)/(1+h),s=(o+h*c)/(1+h),{x:n,y:s}},getRotateAngle:function(e,t,i){var n=this.getCosineAngleByPos(e,t,i),s=this.getDifferent(e,t,i);return s<0&&(n=-n),n},getPedalHeight:function(e,t,i){var n=(e.y-t.y)/(e.x-t.x),s=e.y-n*e.y;return Math.abs(n*i.x+s-i.y)/Math.sqrt(n*n+1)},getLineCircleIntersectionPos:function(e,t,i,n){var s=1e-5,a={},r={},o=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),l={};l.x=(t.x-e.x)/o,l.y=(t.y-e.y)/o;var c={};c.x=i.x-e.x,c.y=i.y-e.y;var h=c.x*l.x+c.y*l.y,u=h*h,g=c.x*c.x+c.y*c.y,f=n*n;if(f-g+u<0)return!1;var d=Math.sqrt(f-g+u),_=h-d;return _-0>-s&&_-o<s&&(a.x=e.x+_*l.x,a.y=e.y+_*l.y),_=h+d,_-0>-s&&_-o<s&&(r.x=e.x+_*l.x,r.y=e.y+_*l.y),[a,r]}};return e}),s("js/utils/logger",function(){"use strict";for(var t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],i=t.length,n=e.console=e.console||{},s=null,a=function(){};i--;)s=t[i],n[s]||(n[s]=a);var r={_level:0,_console:n,setLevel:function(e){switch(e){case"debug":this._level=3;break;case"info":this._level=2;break;case"warn":this._level=1;break;case"error":this._level=0;break;default:this._level=-1}},debug:function(){this._level>=3&&this._console.log.apply(this._console,arguments)},info:function(e){this._level>=2&&this._console.info.apply(this._console,arguments)},warn:function(e){this._level>=1&&this._console.warn.apply(this._console,arguments)},error:function(e){this._level>=0&&this._console.error.apply(this._console,arguments)}};return r}),s("js/utils/string",function(){var e={_templateRegExp:/\$\{(.+?)(?:\:(.+?))?\}/g,template:function(e,t){return e.replace(this._templateRegExp,function(e,i,n){return t[i]||e})},getTemplateValue:function(e,t){var i=this.templateRegex(t),n=i.regExp.exec(e);if(!n)return null;for(var s=Object.keys(i.attrs),a=null,r=1;r<n.length;r++)if(a||(a={}),s.length>r-1){var o=s[r-1];"number"===i.attrs[o]?a[o]=parseInt(n[r]):a[o]=n[r]}return a},templateRegex:function(e){var t={},i=e.replace(this._templateRegExp,function(e,i,n){return t[i]=n,n?"number"===n?"(\\d+?)":"string"===n?"(.+?)":void 0:"(.+?)"});return i="^"+i+"$",{regExp:new RegExp(i),attrs:t}}};return e}),s("js/utils/svg",function(){var e={translate:/translate\(\s*?([\-0-9.]*)\s*?([\-0-9.]*)\s*?\)/,rotate:/rotate\(\s*?([\-0-9.]*)\s*?([\-0-9.]*)?\s*?([\-0-9.]*)?\s*?\)/},n={getRotateMatrix:function(e,i,n){var s=t.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("transform","rotate("+e+" "+i+" "+n+")");var a=s.getCTM();return a},getRotateKityMatrix:function(e,t,i){var n=this.getRotateMatrix(e,t,i),s=new kity.Matrix(n.a,n.b,n.c,n.d,n.e,n.f);return s},rotate:function(e,t,n,s){n="undefined"==typeof n?0:n,s="undefined"==typeof s?0:s,i(e).attr("transform","rotate("+t+","+n+","+s+")")},setTranslate:function(e,t,n){t="undefined"==typeof t?0:t,n="undefined"==typeof n?0:n,i(e).attr("transform","translate("+t+","+n+")")},getAttrRotate:function(t){var i=e.rotate.exec(t);return i?(i.shift(),i.forEach(function(e,t){"undefined"!=typeof e?i[t]=parseFloat(e):i[t]=0}),i):[]},getAttrTranslate:function(t){var i=e.translate.exec(t);return i?(i.shift(),i.forEach(function(e,t){i[t]=parseFloat(e)}),i):[]},createJqForeignObject:function(e){var n=t.createElementNS("http://www.w3.org/2000/svg","foreignObject"),s=i('<div class="'+e+'"></div>');return i(n).html(s),i(n)}};return n}),s("js/utils/utils",function(){var e={getFixedFloat:function(e,t){var i=e.toString(),n=i.split(".");if(2!==n.length)return e;""===n[0]&&(n[0]="0");var s=n[1].length;if(0===s||0===t)return parseInt(n[0]);var a=n[0]+"."+n[1].substring(0,t>=s?s:t);return parseFloat(a)},getValue:function(e,t,i){var n="",s=e.match(t);return"number"==typeof i&&s&&s.length>i?n=s[i]:s&&2===s.length&&(n=s[1]),n},getUuid:function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},isMobile:!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),supportTouch:"ontouchend"in t};return e}),s("js/utils/View",["js/utils/GraphMath","js/utils/svg","js/utils/logger"],function(e,t,n){var s={setVisibility:function(e,t){e.setStyle({visibility:t?"":"hidden"})},isVisibilityHidden:function(e){var t=i(e.node).attr("style"),n=/visibility:[\s]*?hidden/.test(t||"");return n},makeAbsViewHorizontal:function(t,i,n,s,a,r,o,l){r=r?r:0,o=o?o:0;var c,h,u=e.getSpherePos(i||0,n);l?(c=s+u.x,h=a+u.y):(c=s-u.x,h=a-u.y),t.setTranslate(c+" "+h);var g=t.getRenderBox();c=c+(c-g.cx)+r,h=h+(h-g.cy)+o,t.setTranslate(c+" "+h)},makeViewAround:function(i,s,a,r,o,l,c,h,u){var g;g="object"==typeof s?t.getAttrRotate(s.getAttr("transform"))[0]:s;var a=a;this.makeAbsViewHorizontal(i,g,a,o,l,c,h,u);var f=i.getRenderBox(),d=e.getRectShortestDistance({x:o,y:l},f),_=e.getLightPos({x:o,y:l},d.pos,r),p=_.x-d.pos.x,m=_.y-d.pos.y,v=t.getAttrTranslate(i.getAttr("transform"));isNaN(v[0]+p)?n.warn(i,"makeViewAround error  isNAN"):i.setTranslate(v[0]+p,v[1]+m)}};return s}),s("js/view/arrow",["js/view/BaseView","js/config/style","js/utils/view"],function(e,t,i){var n={activeFill:kity.Color.parse("#fff"),bgCls:{0:"bg_blue",1:"bg_red",2:"bg_purple",3:"bg_yellow",4:"bg_green"}},s=e({_$$path:null,_$$activePath:null,_type:null,_width:42,_contraryDirection:!1,create:function(e,t){var i=Object.create(this);return i.__base([]),i._type=e,i._contraryDirection=t,i.createView(),i},createView:function(){this._$$activePath=new kity.Path("M6.913,46c-0.136,0-0.273-0.011-0.41-0.034c-1.06-0.176-1.889-1.01-2.059-2.071    c-1.172-7.314,4.579-15.533,7.306-18.948C3.348,13.541,4.311,6.795,4.456,6.033C4.632,5.102,5.32,4.352,6.232,4.094    C6.456,4.031,6.685,4,6.912,4C7.605,4,8.279,4.288,8.76,4.816c12.288,13.49,24.683,17.681,24.806,17.722    c0.993,0.327,1.677,1.236,1.716,2.281c0.04,1.044-0.575,2.002-1.54,2.403C14.267,35.3,9.17,44.578,9.12,44.671    C8.682,45.498,7.826,46,6.913,46z"),this._$$path=new kity.Path("M6.912,43.5c0,0,5.342-10.071,25.873-18.588c0,0-13-4.281-25.873-18.412    c0,0-1.268,6.674,8.038,18.526C14.95,25.026,5.593,35.268,6.912,43.5z"),this._$$activePath.fill(n.activeFill),this._$$path.fill(n.activeFill),this._$$path.setAttr("class",n.bgCls[this._type]),this._$$clickArea=(new kity.Rect).fill(kity.Color.createRGBA(0,0,0,0)),this._$$clickArea.setSize(36,60),this._$$clickArea.setTranslate(0,-5),this._contraryDirection&&this.getView().setRotate(180,16,0),this.addShape(this._$$activePath),this.addShape(this._$$path),this.addShape(this._$$clickArea)},getHeight:function(){return 42},getWidth:function(){return 32},active:function(e){i.setVisibility(this._$$activePath,e)},isActive:function(){return!i.isVisibilityHidden(this._$$activePath)},changeType:function(e){this._$$path.setAttr("class",n.bgCls[e])},restoreType:function(){this._$$path.setAttr("class",n.bgCls[this._type])}});return s.Type={Blue:"0",Red:"1",Purple:"2",Yellow:"3",Green:"4"},s}),s("js/view/baseView",["js/base/base","js/utils/utils","js/reflector/domevent","js/utils/svg","js/utils/graphMath","js/utils/view"],function(e,t,n,s,a,r){var o={__overwrite:["domEventHandler","setVisibility"],_uuid:null,_$$view:null,__base:function(i,n){e({}).__base.apply(this,[i,n]),this._uuid=t.getUuid(),this._$$view=new kity.Group},bindDomEvent:function(e,t,i,s,a){e instanceof jQuery&&(e=e[0]),n.addDomEvent(e,t,i,a),this.__on(i,s,"")},domEventHandler:function(e,t,i){},getUuid:function(){return this._uuid},getView:function(){return this._$$view},addShape:function(e){this._$$view.addShape(e)},setTranslate:function(e,t){1===arguments.length&&"string"==typeof e?this._$$view.setTranslate(e):this._$$view.setTranslate(e+" "+t)},setTranslateX:function(e){var t=s.getAttrTranslate(i(this._$$view.node).attr("transform"));t.length>0&&this.setTranslate(e,t[1])},setOpacity:function(e){this._$$view.setStyle({opacity:e})},translate:function(e,t){this._$$view.translate(e,t)},setVisible:function(e){this._$$view.setVisible(e)},isVisible:function(){return!this.isVisibilityHidden()&&this.getVisible()},setVisibility:function(e){r.setVisibility(this._$$view,e)},isVisibilityHidden:function(){return r.isVisibilityHidden(this._$$view)},makeAbsViewHorizontal:function(e,t,i,n,s,a,o,l){r.makeAbsViewHorizontal(e,t,i,n,s,a,o,l);
},makeViewAround:function(e,t,i,n,s,a,o,l,c){r.makeViewAround(e,t,i,n,s,a,o,l,c)}};return function(t){return e(o).__include(t)}}),s("js/view/EqualAngleName",["js/view/BaseView","js/config/style"],function(e,t){var i=t.EqualAngleName,n=e({create:function(e){var t=Object.create(this);return t.__base([]),t._lang=e,t.createView(),t},createView:function(){this._$$name=new kity.Text,this._$$name.setContent(this._lang.rf_equal_angle_name).setAttr("class",i.fontClass),this.addShape(this._$$name)}});return n}),s("js/view/ForeignView",["js/base/base","js/utils/utils","js/utils/svg"],function(e,t,i){var n=e({_uuid:null,_$view:null,_$insideView:null,_width:0,_height:0,_cls:"",create:function(e,n,s){var a=Object.create(this);return a.__base(null,[]),a._cls=e,a._uuid=t.getUuid(),a._$view=i.createJqForeignObject(e),a._$insideView=a._$view.find("div"),a.setWidth(n),a.setHeight(s),a},setDomEvent:function(e){e&&e.length>0&&(this._$view.attr("class","_lr_event"),this._$view.data("event-type",e),this._$view.data("event-identifier",this._uuid))},getUuid:function(){return this._uuid},setWidth:function(e){return this._width=e,this._$view.css({width:e}),this._$view.attr("width",e),this._$insideView.css({width:e}),this},setHeight:function(e){return this._height=e,this._$view.css({height:e}),this._$view.attr("height",e),this._$insideView.css({height:e}),this},getView:function(){return this._$view},appendHtml:function(e){this._$insideView.append(e)},setTranslate:function(e,t){var n=i.getAttrRotate(this._$view.attr("transform")),s=[e,t];this.applyTransform(s,n)},setRotate:function(e,t,n){var s=i.getAttrTranslate(this._$view.attr("transform")),a=[e];"undefined"!=typeof t&&"undefined"!=typeof n&&(a.push(t),a.push(n)),this.applyTransform(s,a)},applyTransform:function(e,t){var i="";e.length>1&&(i="translate("+e[0]+" "+e[1]+")"),1===t.length?i+=" rotate("+t[0]+")":3===t.length&&(i+=" rotate("+t[0]+" "+t[1]+" "+t[2]+")"),this._$view.attr("transform",i)},setVisible:function(e){e?this._$view.show():this._$view.hide()},setVisibility:function(e){this._$view.css({visibility:e?"":"hidden"})},setOpacity:function(e){this._$view.css({opacity:e})},setAttr:function(e,t){this._$view.attr(e,t)},addClass:function(e){this._$insideView.addClass(e)},removeClass:function(e){this._$insideView.removeClass(e)},hasClass:function(e){return this._$insideView.hasClass(e)}});return n}),s("js/view/IncidencePoint",["js/view/BaseView","js/config/style","js/utils/view"],function(e,t){var i=t.IncidencePoint,n=e({_$$line:null,create:function(e){var t=Object.create(this);return t.__base([]),t._data=e,t.createView(),t},createView:function(){this._$$incidencePoint=new kity.Circle(i.width).fill(i.fill),this._$$incidencePoint=new kity.Circle(i.width).fill(i.fill),this.addShape(this._$$incidencePoint)},setRotate:function(e,t,i){t="undefined"==typeof t?0:t,i="undefined"==typeof i?0:i,this._$$line.setRotate(e+" "+t+" "+i)}});return n}),s("js/view/LightLine",["js/view/BaseView","js/config/style","js/utils/utils","js/utils/graphmath","js/utils/svg","js/view/ForeignView","js/config/eventKey","js/utils/view"],function(e,t,s,a,r,o,l,c){var h=t.LineStyle,u=h.strokeStyle["stroke-width"],g=n("js/view/arrow"),f={width:290,arrowPos:145,visible:!0,clickAble:!0,nameEnable:!0,arrowVisible:!0,arrowReverse:!1},d=h.rectHeight/2,_=e({_$$lineGroup:null,_lineGroupUuid:"",_$$lintWhite:null,_arrow:null,_fwBtn:null,_config:null,_lightType:null,_$$name:null,_onLightMove:null,_lang:null,_showRotate:!1,create:function(e,t,n,a,r,o){var c=Object.create(this),h=[];return h.push({key:l.Blur,callback:c.blur,params:[]}),c.__base(e,h),c._lightType=t,c._config=i.extend(!0,{},f,n),c._onLightMove=a,c._lineGroupUuid=s.getUuid(),c._lang=r,c._showRotate=o,c.createView(),c.__on(l.BtnMove+c._fwBtn.getUuid(),c.domEventHandler,[]),c},createView:function(){if(this._$$offsetPoint=new kity.Circle(10).fill(kity.Color.createRGBA(0,0,0,0)),this.addShape(this._$$offsetPoint),this._$$name=new kity.Text,this._lang){var e=this._lightType===_.Type.IncidenceLine?this._lang.rf_incidence_line_name:this._lang.rf_reflection_line_name;this._$$name.setContent(e)}h[this._lightType]&&this._$$name.setAttr("class",h[this._lightType].fontClass),this.addShape(this._$$name),this._$$lineGroup=new kity.Group,this._$$lintWhite=(new kity.Rect).setStyle(h.strokeStyle),this._$$lintWhite.setSize(this.getWidth()+u,h.rectHeight+u),this._$$lintWhite.translate(-u/2,-u/2),this._$$lineGroup.addShape(this._$$lintWhite);var t;this._lightType==_.Type.IncidenceLine?t=g.Type.Blue:this._lightType==_.Type.ReflectionLine?t=g.Type.Red:this._lightType==_.Type.Reverse&&(t=g.Type.Green),this._arrow=g.create(t,this._lightType===_.Type.ReflectionLine||this._config.arrowReverse),this._arrow.setVisibility(this._config.arrowVisible),this._$$lineGroup.addShape(this._arrow.getView()),this.initArrowPos(),this._$$lintClick=(new kity.Rect).fill(kity.Color.createRGBA(0,0,0,0));var n=h.arrow.height/5;this._$$lintClick.setSize(this.getWidth()+u,n),this._$$lintClick.translate(0,-(n-h.rectHeight)/2),this._$$lineGroup.addShape(this._$$lintClick),this._$$whiteRect=new kity.Rect,this._$$whiteRect.setSize(this.getWidth(),h.rectHeight),this._$$whiteRect.fill(h[this._lightType].fill),this._$$lineGroup.addShape(this._$$whiteRect),this._fwBtn=o.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtn.setTranslate(-h.btnRotate.width-10,(h.rectHeight-h.btnRotate.height)/2),this._fwBtnInvisible=o.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtnInvisible.setTranslate(-h.btnRotate.width-10,(h.rectHeight-h.btnRotate.height)/2),this._fwBtnInvisible.setVisibility(!1),i(this._$$lineGroup.node).append(this._fwBtn.getView()),this._fwBtn.setVisibility(this._showRotate||!1),this._showRotate&&this._fwBtn.setRotate(-60,30,30),i(this._$$lineGroup.node).append(this._fwBtnInvisible.getView()),this.addShape(this._$$lineGroup),this.bindDomEvent(this._fwBtn.getView(),["down","beforemove","move","aftermove"],this._fwBtn.getUuid(),this.domEventHandler,!1),this.bindDomEvent(this._$$lineGroup.node,["lrTap"],this._lineGroupUuid,this.domEventHandler,!1),this.initView()},setMoveListener:function(e){this._moveListener=e},getWidth:function(){return this._config.width},setWidth:function(e){this._config.width=e,this._config.arrowPos=(e-this._arrow.getWidth())/2,this._config.width<=this._arrow.getWidth()+10?this._arrow.setVisibility(!1):this._arrow.setVisibility(this._config.arrowVisible),this._$$lintWhite.setSize(this.getWidth()+u,h.rectHeight+u);var t=h.arrow.height/3;this._$$lintClick.setSize(this.getWidth()+u,t),this._$$whiteRect.setSize(this.getWidth(),h.rectHeight),this.initArrowPos(),this.setTranslate(-this.getWidth(),-3);var i=r.getAttrRotate(this._$$lineGroup.getAttr("transform"));i&&i.length>0&&this._$$lineGroup.setRotate(i[0]+" "+this.getWidth()+" "+i[2]),this.initNamePos()},setArrowPos:function(e){this._config.arrowPos=e,this.initArrowPos()},initArrowPos:function(){this._lightType===_.Type.ReflectionLine||this._config.arrowReverse?this._arrow.setTranslate(this.getArrowPos(),(h.rectHeight+this._arrow.getHeight())/2+3.5):this._arrow.setTranslate(this.getArrowPos(),-this._arrow.getHeight()/2)},getArrowPos:function(){return this._config.arrowPos},blur:function(e){e!==this._lineGroupUuid&&(this.setFwBtnVisible(!1),this._$$lintWhite.setVisible(!1),this._arrow.active(!1))},setClickAble:function(e){this._config.clickAble=e},domEventHandler:function(e,t,i){if(this._config.clickAble){if(t===this._fwBtn.getUuid())this._onLightMove(this._lightType,i,e),"down"===e?(this._$$lintWhite.setVisible(!0),this._arrow.active(!0)):"beforemove"===e||"move"===e||"aftermove"===e&&this.__triggerEvent("insidechange",this._lightType+"-move");else if(t===this._lineGroupUuid&&"lrTap"===e){if(this._arrow.isActive())return void this.blur();this.setFwBtnVisible(!0),this._$$lintWhite.setVisible(!0),this._arrow.active(!0)}this.btnStillInBox()}},initView:function(){this.setFwBtnVisible(!1),this._$$lintWhite.setVisible(!1),this._arrow.active(!1),this._config.nameEnable===!1&&c.setVisibility(this._$$name,!1),this.setVisibility(this._config.visible)},setRotate:function(e,t,i){t="undefined"==typeof t?this.getWidth():t,i="undefined"==typeof i?d:i,this._$$lineGroup.setRotate(e+" "+t+" "+i),this.initNamePos(t,i),this.fwBtnMove()},rotate:function(e,t,i){t="undefined"==typeof t?this.getWidth():t,i="undefined"==typeof i?d:i;var n=r.getAttrRotate(this._$$lineGroup.getAttr("transform"));n&&n.length>0?this._$$lineGroup.setRotate(n[0]+e+" "+t+" "+i):this._$$lineGroup.setRotate(e+" "+t+" "+i),this.initNamePos(t,i),this.fwBtnMove()},getRotateAngle:function(){var e=r.getAttrRotate(this._$$lineGroup.getAttr("transform"));return e[0]},initNamePos:function(e,t){return!1},getRotatePos:function(){return{x:this.getWidth(),y:d}},setNameVisible:function(e){this._config.nameEnable&&c.setVisibility(this._$$name,e)},setCommonFill:function(){this._$$whiteRect.fill(h.commonLineFill),this._arrow.changeType(g.Type.Red)},restoreFill:function(){this._$$whiteRect.fill(h[this._lightType].fill),this._arrow.restoreType()},setNameEnable:function(e){this._config.nameEnable=e,c.setVisibility(this._$$name,e)},getNameEnable:function(){return this._config.nameEnable},setVisibility:function(t){e({}).setVisibility.apply(this,[t]),this.__triggerEvent(l.LightLineVisible,this._lightType,t)},setLineEnable:function(e){},makeNameViewAround:function(e,t,i){t="undefined"==typeof t?this.getWidth():t,i="undefined"==typeof i?d:i,e="undefined"==typeof e?this._$$lineGroup:e,this.makeViewAround(this._$$name,e,this.getWidth(),this.getWidth()+10,t,i,0,0,!1)},getLightType:function(){return this._lightType},fwBtnMove:function(){this._config.clickAble&&this.triggerMoveBtn()},setFwBtnVisible:function(e){this.triggerMoveBtn(e)},triggerMoveBtn:function(e){this._config.clickAble&&(this._showRotate||this._moveListener&&this._moveListener(this.getScale(),this._fwBtn.getView()[0].getBoundingClientRect(),this._fwBtn.getUuid()))},fwBtnTranslate:function(e,t){this._config.clickAble&&(this._fwBtn.setTranslate(e,t),this.fwBtnMove())},btnStillInBox:function(){if(this._config.clickAble){var e=this._fwBtnInvisible.getView()[0].getBoundingClientRect(),t=this._fwBtn.getView().closest("svg")[0];if(t){var i=t.getBoundingClientRect(),n=Math.abs(this.getRotateAngle()%180);n<=0&&(n=-n),n>90&&(n=180-n);var s=r.getAttrTranslate(this._fwBtnInvisible.getView().attr("transform"));if(!(s.length<=0))if(e.bottom<=i.bottom&&e.left>=i.left&&e.right<=i.right&&e.top>=i.top||90===n)this.fwBtnTranslate(-h.btnRotate.width-10,s[1]);else{var o=0,l=this.getScale(),c=this._config.width+s[0]+h.btnRotate.width+10;if(e.left<=i.left){var u=i.left-e.left,g=u/Math.cos(a.getRadian(n))/l;o=s[0]- -g,o>c&&(o=c),this.fwBtnTranslate(o,s[1])}if(e.bottom>=i.bottom){var u=e.bottom-i.bottom,g=u/Math.sin(a.getRadian(n))/l;(0==o||o<s[0]+g)&&(o=s[0]+g),o>c&&(o=c),this.fwBtnTranslate(o,s[1])}if(e.top<=i.top){var u=i.top-e.top,g=u/Math.sin(a.getRadian(n))/l;(0==o||o<s[0]+g)&&(o=s[0]+g),this.fwBtnTranslate(o,s[1])}if(e.right>=i.right){var u=e.right-i.right,g=u/Math.cos(a.getRadian(n))/l;o=s[0]- -g,this.fwBtnTranslate(o,s[1])}}}}},getScale:function(){var e=this._$$offsetPoint.node.getBoundingClientRect().width/20||1;return e}});return _.Type={IncidenceLine:"IncidenceLine",ReflectionLine:"ReflectionLine",NormalLine:"NormalLine",SurfaceIn:"SurfaceIn",SurfaceOut:"SurfaceOut",Reverse:"Reverse"},_}),s("js/view/multipleText",["js/view/BaseView","js/utils/view"],function(e,t){var i=e({_lineHeight:18,_$$texts:[],create:function(e){var t=Object.create(this);return t._$$texts=[],t._lineHeight=e,t.__base([]),t.createView(),t},createView:function(){},setContent:function(e){this.clear();var t=this;"string"==typeof e?t.appendLine(e):e.forEach(function(e){t.appendLine(e)}),this.center()},center:function(){var e=0;if(this._$$texts.length>1){var t=!1;this._$$texts.forEach(function(i){var n=i.getWidth();if(n>e){e=n;var s=i.getContent();t="°"===s.substring(s.length-1,s.length)}}),this._$$texts.forEach(function(t){var i=t.getWidth();i<e&&t.setAttr("x",Math.abs((e-i)/2))})}},getRenderBox:function(){return this._$$view.getRenderBox()},getAttr:function(e){return this._$$view.getAttr(e)},appendLine:function(e){var t=this._$$texts.length*this._lineHeight,i=(new kity.Text).setContent(e).setAttr("x",0).setAttr("y",t>=0?t:0);this._$$texts.push(i),this._$$view.addShape(i)},getWidth:function(){var e=0;return this._$$texts.forEach(function(t){t.getWidth()>e&&(e=t.getWidth())}),e},getContent:function(){},getHeight:function(){return this._lineHeight*this._$$texts.length},clear:function(){this._$$texts.forEach(function(e){e.remove()}),this._$$texts=[]}});return i}),s("js/view/NameGroup",["js/view/BaseView","js/config/style","js/utils/graphmath","js/utils/svg","js/view/MultipleText","js/view/sector","js/utils/view"],function(e,t,i,n,s,a,r){var o=t.Sector,l=10,c=e({_data:"",_nameVisible:!0,_$$incidencePoint:null,_lang:null,_lightHeight:48,_option:null,_reflectorType:0,_nameAutoPos:!1,_status:null,create:function(e,t,i,n,s){var r=Object.create(this);r.__base([]),r._data=e,r._reflectorType=n,r._lang=t,r._option=i,r._status={},r._nameAutoPos=s;for(var o in a.Type)r._status[a.Type[o]]=!1;return r.createView(),r},createView:function(){var e=this;for(var t in this._data){var i=this._data[t];i.mtAngle=s.create(e._lightHeight),i.mtName=s.create(e._lightHeight),t==a.Type.SurfaceIn||t==a.Type.SurfaceOut?(i.name="",i.mtAngle.getView().setAttr("class",o.surfaceFontClass)):t==a.Type.Incidence?(i.name=this._lang.rf_incidence_angle,i.mtAngle.getView().setAttr("class",o.incidenceFontClass),i.mtInvisibleAngle=s.create(e._lightHeight),i.mtInvisibleAngle.getView().setAttr("class",o.incidenceFontClass),i.mtName=s.create(e._lightHeight),i.mtName.getView().setAttr("class",o.incidenceFontClass),e.addShape(i.mtInvisibleAngle.getView()),r.setVisibility(i.mtInvisibleAngle.getView(),!1),i.angleLetter="i",i.mtAngleLetter=new kity.Text("i").setAttr("class",o.incidenceLetterClass),e.addShape(i.mtAngleLetter)):t==a.Type.Reflection&&(i.name=this._lang.rf_reflection_angle,i.mtAngle.getView().setAttr("class",o.reflectionFontClass),i.mtInvisibleAngle=s.create(e._lightHeight),i.mtInvisibleAngle.getView().setAttr("class",o.reflectionFontClass),i.mtName=s.create(e._lightHeight),i.mtName.getView().setAttr("class",o.reflectionFontClass),e.addShape(i.mtInvisibleAngle.getView()),r.setVisibility(i.mtInvisibleAngle.getView(),!1),i.angleLetter="r",i.mtAngleLetter=new kity.Text("r").setAttr("class",o.reflectionLetterClass),e.addShape(i.mtAngleLetter)),i.angleStr="",i.angle=0,e.addShape(i.mtAngle.getView()),e.addShape(i.mtName.getView()),i.mtName.setVisibility(!1)}},getAngle:function(e){return this._data[e].actualAngle},setNormalAngle:function(e){this._normalAngle=e},rotate:function(e,t){var i=function(e,t,i){return t?i-e:e};this._rotate(a.Type.SurfaceIn,e[i(0,t,3)],e[i(1,t,5)]),this._rotate(a.Type.Incidence,e[i(1,t,3)],e[i(2,t,5)]),this._rotate(a.Type.Reflection,e[i(2,t,3)],e[i(3,t,5)]),this._rotate(a.Type.SurfaceOut,e[i(3,t,3)],e[i(4,t,5)])},_rotate:function(e,t,i){var n=this._data[e],s=Math.abs(Math.round(t-i));n.angle=s,n.actualAngle=Math.abs(t-i),n.angleStr=s+"°";var a=t+(i-t)/2;n.sphereAngle=a,this.updatePosByType(e)},isNameVertical:function(){var e=this._normalAngle%360;return!(e>-40&&e<=0)&&(!(e<=360&&e>=310)&&(!(e>=0&&e<=40)&&!(e>=130&&e<=230)))},setNameVisible:function(e){this._nameVisible=e;for(var t in this._data)this._status[t]===!0&&(this._data[t].mtName&&r.setVisibility(this._data[t].mtName.getView(),e),this.updatePosByType(t))},setNameStatusAndVisible:function(e,t){this._data[e].mtName&&(this._data[e].mtName&&r.setVisibility(this._data[e].mtName.getView(),t),this._status[e]=!0,this.updatePosByType(e))},updatePos:function(){for(var e in this._data)this.updatePosByType(e)},updatePosByType:function(e){var t=this._data[e],i=!t.mtName.isVisibilityHidden();if(0===t.angle||90===t.angle)t.mtName.setContent(""),t.mtAngle.setContent(""),e!=a.Type.Incidence&&e!=a.Type.Reflection||(t.mtInvisibleAngle.setContent(""),t.mtAngleLetter.setContent(""));else{var s=this.isNameVertical();i?t.mtName.setContent(s?t.name.split(""):t.name):t.mtName.setContent(""),t.mtAngle.setContent(t.angleStr),t.mtAngleLetter&&t.mtAngleLetter.setContent(t.angleLetter);var r=t.angleR+this._lightHeight;if(s||!i||this.isSurfaceAngle(e)||(r+=t.mtAngle.getWidth()/2+t.mtName.getWidth()/2),this.isSurfaceAngle(e)||(r+=1===this._reflectorType||2===this._reflectorType||3===this._reflectorType?20:13),this.isSurfaceAngle(e)||!i){var o=0,c=0;if(this.isSurfaceAngle(e)?4===this._reflectorType?(r-=16,o=9):5===this._reflectorType?(r-=10,o=6):o=3:5===this._reflectorType,this.makeAbsViewHorizontal(t.mtAngle,t.sphereAngle,r,t.cx,t.cy,o,c,!1),t.mtAngleLetter){var h;h=t.letterR?t.letterR:110,this.makeAbsViewHorizontal(t.mtAngleLetter,t.sphereAngle,h,t.cx,t.cy,o,c,!1)}}else if(i){s?t.mtInvisibleAngle.setContent(t.angleStr):t.mtInvisibleAngle.setContent(t.name+t.angleStr),this.makeAbsViewHorizontal(t.mtInvisibleAngle,t.sphereAngle,r,t.cx,t.cy,0,0,!1);var u=n.getAttrTranslate(t.mtInvisibleAngle.getAttr("transform"));s?u[1]<0?(t.mtAngle.setTranslate(u[0],u[1]-t.mtAngle.getHeight()+this._lightHeight),t.mtName.setTranslate(u[0]+l,u[1]-t.mtAngle.getHeight()-t.mtName.getHeight()+this._lightHeight)):(t.mtName.setTranslate(u[0]+l,u[1]),t.mtAngle.setTranslate(u[0],u[1]-t.mtAngle.getHeight()+t.mtName.getHeight()+this._lightHeight)):(t.mtAngle.setTranslate(u[0]+t.mtName.getWidth(),u[1]),t.mtName.setTranslate(u[0],u[1]))}}},isSurfaceAngle:function(e){return e==a.Type.SurfaceIn||e==a.Type.SurfaceOut},setAngleVisibleByType:function(e,t){t&&(this._status[e]=!0);var i=this._data[e];r.setVisibility(i.mtAngle.getView(),t),i.mtAngleLetter&&r.setVisibility(i.mtAngleLetter,t),this._status[e]===!0&&r.setVisibility(i.mtName.getView(),this._nameVisible),this.updatePosByType(e)},getAngleIsValidByType:function(e){var t=this._data[e];return 0!==t.angle&&90!==t.angle&&!r.isVisibilityHidden(t.mtAngle.getView())},getHasDrawStatus:function(){return this._status},setHasDrawStatus:function(e,t){this._status=e},setHasDrawStatusByType:function(e,t){if("undefined"!=typeof t){if(this._status[t]=e,this._status[t]===!0){var i=this._data[t];i.mtName&&(r.setVisibility(i.mtName.getView(),this._nameVisible),this.updatePosByType(t))}}else for(var n in this._status){this._status[n]=e;var i=this._data[n];i.mtName&&(r.setVisibility(i.mtName.getView(),this._nameVisible),this.updatePosByType(n))}},getHasDrawStatusByType:function(e){return this._status[e]},getAngleVisibilityByType:function(e){var t=this._data[e];return!r.isVisibilityHidden(t.mtAngle.getView())}});return c}),s("js/view/normalLine",["js/view/BaseView","js/config/style","js/utils/view","js/utils/svg"],function(e,t,i,n){var s=t.NormalLine,a=e({_$$line:null,_domEvent:null,_width:200,_$$name:null,_pointVisible:!1,_lineVisible:!1,_lang:!1,create:function(e,t){var i=Object.create(this);return i.__base([]),i._width=e,i._lang=t,i.createView(),i},createView:function(){this._$$line=new kity.Path("").setStyle(s.strokeStyle),this._$$line.setAttr("d","M0 0 "+this._width+" 0"),this._$$line.setAttr("stroke-dasharray","15,12"),this.addShape(this._$$line),this._$$name=new kity.Text,this._$$name.setContent(this._lang.rf_normal_name).setAttr("class",s.fontClass),this.addShape(this._$$name),this._$$nameDown=new kity.Text,this._$$nameDown.setContent(this._lang.rf_incidence_point).setAttr("class",s.fontClass),this.addShape(this._$$nameDown)},setRotate:function(e,t,i){t="undefined"==typeof t?this._width:t,i="undefined"==typeof i?0:i,this._$$line.setRotate(e+" "+t+" "+i),this.initNamePos(t,i)},getRotateAngle:function(){var e=n.getAttrRotate(this._$$line.getAttr("transform"));return e[0]},initNamePos:function(e,t){e="undefined"==typeof e?this._width:e,t="undefined"==typeof t?0:t;var i=this._$$nameDown.getWidth(),n=this._$$name.getWidth();this.makeViewAround(this._$$name,this._$$line,this._width,this._width+25,e,t,-n/2+17,0,!1),this.makeViewAround(this._$$nameDown,this._$$line,250,25,e,t,-i/2+15,0,!0)},setNameVisible:function(e){this._$$nameDown.setContent(e===!0?this._lang.rf_incidence_point:""),this._$$name.setContent(e===!0?this._lang.rf_normal_name:""),this.initNamePos()},setPointNameVisibility:function(e,t){this._pointVisible=t,i.setVisibility(this._$$nameDown,t),i.setVisibility(this._$$name,this._lineVisible),i.setVisibility(this._$$line,this._lineVisible),this.setVisibility(!0),this.initNamePos()},setLineVisibility:function(e,t){this._lineVisible=t,i.setVisibility(this._$$name,t),i.setVisibility(this._$$nameDown,this._pointVisible),i.setVisibility(this._$$line,t),this.setVisibility(!0),this.initNamePos()},showAll:function(){this.setVisibility(!0),i.setVisibility(this._$$name,!0),i.setVisibility(this._$$nameDown,!0),i.setVisibility(this._$$line,!0),this.initNamePos()},getLineVisible:function(){return this._lineVisible},getPointNameVisible:function(){return this._pointVisible}});return a}),s("js/view/PedalLine",["js/view/BaseView","js/config/style","js/utils/view"],function(e,t){var i=t.Pedal,n=e({_$$line:null,create:function(e){var t=Object.create(this);return t.__base([]),t._data=e,t.createView(),t},createView:function(){var e=this._$$line=(new kity.Path).setId("dd").setStyle(i.strokeStyle),t=e.getDrawer();t.moveTo(-i.width,0),t.lineTo(-i.width,-i.width),t.lineTo(0,-i.width),this.addShape(e)},setRotate:function(e,t,i){t="undefined"==typeof t?0:t,i="undefined"==typeof i?0:i,this._$$line.setRotate(e+" "+t+" "+i)}});return n}),s("js/view/sector",["js/view/BaseView","js/config/style","js/utils/graphmath","js/utils/svg","js/view/MultipleText"],function(e,t,i,n,s){var a=t.Sector,r=e({_$$sector:null,_$$sectorBorder:null,_type:1,_startAngle:0,_endAngle:0,_cx:0,_cy:0,_lang:0,_$$incidencePoint:null,create:function(e,t,i,n,s){var a=Object.create(this);return a.__base([]),a._type=e,a._cx=t,a._cy=i,a._r=n,a._lang=s,a.createView(),a},createView:function(){this._$$sector=new kity.Path(""),this._$$sector.setStyle(a.strokeStyle),this._$$sectorBorder=new kity.Path(""),this._$$sectorBorder.setStyle(a.strokeStyle),this._type===r.Type.SurfaceIn||this._type===r.Type.SurfaceOut?this._$$sector.fill(a.surfaceFill):this._type===r.Type.Incidence?this._$$sector.fill(a.incidenceFill):this._type===r.Type.Reflection&&this._$$sector.fill(a.reflectionFill),this.addShape(this._$$sector),this.addShape(this._$$sectorBorder)},rotate:function(e,t){this._startAngle=e,this._endAngle=t;var n=180-e,s=180-t,a=i.getSvgSectorPoint(this._cx,this._cy,this._r,s,n);this._$$sector.setAttr("d",a),this._$$sector.setStyle({opacity:.6}),this._$$sectorBorder.setAttr("d",a)}});return r.Type={Incidence:1,Reflection:2,SurfaceIn:3,SurfaceOut:4},r}),s("js/view/surface",["js/view/BaseView","js/config/style","js/utils/utils","js/utils/svg","js/view/ForeignView","js/config/eventKey","js/utils/view"],function(e,t,s,a,r,o,l){var c=n("js/utils/graphmath"),h=t.Surface,u={width:520,defaultAngle:0,rotatePosX:5,rotatePosY:4,visible:!0,clickAble:!0,nameEnable:!0,nameEventEnable:!0,type:""},g=e({_config:null,_$$surface:null,_$$name:null,_onSurfaceMove:null,_lang:null,_$$incidencePoint:null,create:function(e,t,n,s){var a=Object.create(this);a._config=i.extend(!0,{},u,t);var r=[];return a._config.nameEventEnable&&r.push({key:o.NameVisible,callback:"nameVisibleHandler",params:[]}),r.push({key:o.Blur,callback:a.blur,params:[]}),a.__base(e,r),a._type=t.type,a._onSurfaceMove=n,a._lang=s,a.createView(),a.__on(o.BtnMove+a._fwBtn.getUuid(),a.domEventHandler,[]),a},createView:function(){this._$$surface=new kity.Group;var e="wall_tl";g.Type.tl===this._type?e="wall_tl":g.Type.tr===this._type?e="wall_tr":g.Type.tl_Large===this._type&&(e="wall_tl_large"),this._fwSurface=r.create(e,this._config.width,h.height),i(this._$$surface.node).append(this._fwSurface.getView()),this.addShape(this._$$surface),this._$$offsetPoint=new kity.Circle(10).fill(kity.Color.createRGBA(0,0,0,0)),this._$$offsetPoint.setTranslate(this._config.rotatePosX,this._config.rotatePosY),this.addShape(this._$$offsetPoint),this._$$name=new kity.Text,this._$$name.setContent(this._lang.rf_reflection_surface).setAttr("class",h.fontClass),this._config.nameEnable||l.setVisibility(this._$$name,!1),this.addShape(this._$$name),this._fwBtn=r.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtnInvisible=r.create("btn_rotate",h.btnRotate.width,h.btnRotate.height),this._fwBtnInvisible.setVisibility(!1),i(this._$$surface.node).append(this._fwBtn.getView()),i(this._$$surface.node).append(this._fwBtnInvisible.getView()),this.intOriginalFwBtnPos(),this.setTranslate(0,-3),this.bindDomEvent(this._$$surface.node,["lrTap"],this.getUuid(),this.domEventHandler),this.bindDomEvent(this._fwBtn.getView(),["down","beforemove","move","aftermove"],this._fwBtn.getUuid(),this.domEventHandler),this._fwBtn.setVisibility(!1),i(this.getView().node).attr("class","_lr_surface"),this.setVisibility(this._config.visible)},intOriginalFwBtnPos:function(){this._type===g.Type.tl?(this._fwBtn.setTranslate(this._config.width+10,(h.height-h.btnRotate.height)/2),this._fwBtnInvisible.setTranslate(this._config.width+10,(h.height-h.btnRotate.height)/2)):(this._fwBtn.setTranslate(-h.btnRotate.width-10,(h.height-h.btnRotate.height)/2),this._fwBtnInvisible.setTranslate(-h.btnRotate.width-10,(h.height-h.btnRotate.height)/2))},blur:function(e){e!==this.getUuid()&&(this.setFwBtnVisible(!1),this._fwSurface.removeClass("on"))},domEventHandler:function(e,t,i){if(this._config.clickAble){if(t===this.getUuid()){if("lrTap"===e){if(this._fwSurface.hasClass("on"))return void this.blur();this.setFwBtnVisible(!0),this._fwSurface.addClass("on")}}else t===this._fwBtn.getUuid()&&(this._onSurfaceMove(i,e),"down"===e?this._fwSurface.addClass("on"):"beforemove"===e||"aftermove"===e&&this.__triggerEvent("insidechange","surface-move"));this.btnStillInBox()}},getSurfaceXAxisDegree:function(e){var t=e.getRotateAngle()%180;return t=t<=0?-t:180-t},setMoveListener:function(e){this._moveListener=e},btnStillInBox:function(){var e=this._fwBtnInvisible.getView()[0].getBoundingClientRect(),t=this._fwBtn.getView().closest("svg")[0].getBoundingClientRect(),i=Math.abs(this.getRotateAngle()%180);i<=0&&(i=-i),i>90&&(i=180-i);var n=a.getAttrTranslate(this._fwBtnInvisible.getView().attr("transform"));if(!(n.length<=0)){if(e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right&&e.top>=t.top)this._type===g.Type.tl?this.fwBtnTranslate(this._config.width+10,n[1]):this.fwBtnTranslate(-h.btnRotate.width-10,n[1]);else{var s=0,r=this.getScale(),o=this._type===g.Type.tl;if(e.left<=t.left){var l=t.left-e.left,u=l/Math.cos(c.getRadian(i))/r;s=n[0]-(o?u:-u),this.fwBtnTranslate(s,n[1])}if(e.bottom>=t.bottom){var l=e.bottom-t.bottom,u=l/Math.sin(c.getRadian(i))/r;o?(0==s||s>n[0]-u)&&(s=n[0]-u):(0==s||s<n[0]+u)&&(s=n[0]+u),this.fwBtnTranslate(s,n[1])}if(e.top<=t.top){var l=t.top-e.top,u=l/Math.sin(c.getRadian(i))/r;o?(0==s||s>n[0]-u)&&(s=n[0]-u):(0==s||s<n[0]+u)&&(s=n[0]+u),this.fwBtnTranslate(s,n[1])}}}},rotate:function(e,t,i){t="undefined"==typeof t?this._config.rotatePosX:t,i="undefined"==typeof i?this._config.rotatePosY:i;var n=a.getAttrRotate(this._$$surface.getAttr("transform"));n&&n.length>0?this._$$surface.setRotate(n[0]+e+" "+t+" "+i):this._$$surface.setRotate(e+" "+t+" "+i),this.initNamePos(t,i),this.fwBtnMove()},getRotateOffsetPos:function(){var e=i(this._$$offsetPoint.node).offset();return{x:e.left,y:e.top}},getRotateAngle:function(){var e=a.getAttrRotate(this._$$surface.getAttr("transform"));return e[0]||0},initNamePos:function(e,t){var i=this._config.rotatePosX+100,n=this._config.rotatePosX+20;this.makeViewAround(this._$$name,this._$$surface,i,n,this._config.rotatePosX,t,0,0,!1)},setNameVisible:function(e){this._config.nameEnable&&l.setVisibility(this._$$name,e)},nameVisibleHandler:function(e){this.setNameVisible(e)},setClickAble:function(e){this._config.clickAble=e},getScale:function(){var e=this._$$offsetPoint.node.getBoundingClientRect().width/20||1;return e},get0To360RotateAngle:function(){var e=this.getRotateAngle()%360;return e<0&&(e=360+e),e},fwBtnMove:function(){this._config.clickAble&&!this.isVisibilityHidden()&&this._moveListener&&this._moveListener(this.getScale(),this._fwBtn.getView()[0].getBoundingClientRect(),this._fwBtn.getUuid())},setFwBtnVisible:function(e){this._config.clickAble&&this._moveListener&&this._moveListener(this.getScale(),this._fwBtn.getView()[0].getBoundingClientRect(),this._fwBtn.getUuid(),e)},fwBtnTranslate:function(e,t){this._fwBtn.setTranslate(e,t),this.fwBtnMove()}});return g.Type={tl:"tl",tr:"tr",tl_Large:"wall_tl_large"},g}),s("js/reflector/lightComplex/config",[],function(){var e=(n("js/view/LightLine"),{IncidenceLine:{width:370,arrowPos:150,defaultAngle:50,visible:!0,clickAble:!0,rotateFixed:!0,PedalWidth:370,PedalArrowPos:140,rotateFixedAfterDraw:!1,highLineZIndex:!1,nameEnable:!0,arrowVisible:!0},ReflectionLine:{width:370,arrowPos:240,visible:!0,clickAble:!0,rotateFixed:!1,PedalWidth:280,PedalArrowPos:155,rotateFixedAfterDraw:!1,nameEnable:!0,arrowVisible:!0},NormalLine:{width:400,lineVisible:!1,pointNameVisible:!1,visible:!0},StaticLine:[],Sector:{sectorInVisible:!0,sectorOutVisible:!0,incidenceVisible:!0,reflectionVisible:!0,incidenceR:65,reflectionR:76,surfaceR:55,letterR:76,angleR:76},IncidencePointVisible:!1,PedalLineVisible:!1,IncidencePosX:0,DrawIndex:[0,1,2,3],PedalDrawIndex:[[0,1],[5,6],[10]],Visible:!0,view90PedalLineVisible:!0,nameEventEnable:!0,NameAutoPos:!1});return e}),s("js/reflector/lightComplex/draw",["js/view/sector","js/utils/utils","js/utils/view"],function(e,t,n){var s={_hasDrawBegin:!1,_hasDrawNext:!0,setDrawBegin:function(e){this._hasDrawBegin=e,this._configData.IncidenceLine.rotateFixedAfterDraw&&(this._configData.IncidenceLine.rotateFixed=!0),this._configData.ReflectionLine.rotateFixedAfterDraw&&(this._configData.ReflectionLine.rotateFixed=!0)},getDrawBegin:function(){return this._hasDrawBegin},drawAll:function(e){if(!this.isVisibilityHidden()){this.setSectorInsideDrawStatus(!0),this.setDrawBegin(!0);var t=this;this._drawCommand.stop(function(){t._drawCommand.drawAll(null,!1),t.adsorptionPedal(),t.__triggerEvent("insidechange","drawAll"),e&&e()})}},drawNext:function(e){if(!this.isVisibilityHidden()){this.setDrawBegin(!0);var t=this;this._drawCommand.hasNext()?this._drawCommand.drawNext(function(){t.adsorptionPedal(),t.__triggerEvent("insidechange","drawNext"),e&&e()},!0):e&&e()}},hasNext:function(){return!this.isVisibilityHidden()&&this._drawCommand.hasNext()},hasNextWidthOutVisibilityStatus:function(){return this._drawCommand.hasNext()},initDrawCommand:function(){var t=this;t._hsdrawIncidencePoint=!1,this._drawCommand.push(function(e,s){t._hsdrawIncidencePoint=!0,s?(n.setVisibility(t._$$incidencePoint,!0),i(t._$$incidencePoint.node).fadeIn(300).fadeOut(300).fadeIn(300,function(){n.setVisibility(t._$$incidencePoint,!1),e.resolve()})):e.resolve()},function(){return t._hsdrawIncidencePoint}),this._drawCommand.push(function(e,i){t._normalLine.setPointNameVisibility(t._option.nameVisible,!0),e.resolve()},function(){return t._normalLine.getPointNameVisible()}),this._drawCommand.push(function(i,n){t._option.surfaceAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.SurfaceIn,!0),t.setSectorInsideDrawStatus(!0,e.Type.SurfaceIn),i.resolve()},function(){return!t.getSectorEnable()||(!(t._option.surfaceAngleVisible===!0&&!t.isPedal())||!t._surfaceInSector.isVisibilityHidden())}),this._drawCommand.push(function(e,i){t._incidenceLine.setVisibility(!0),e.resolve()},function(){return!t._incidenceLine.isVisibilityHidden()}),this._drawCommand.push(function(i,n){t._option.normalAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.Incidence,!0),t.setSectorInsideDrawStatus(!0,e.Type.Incidence),i.resolve()},function(){return!t.getSectorEnable()||(!(t._option.normalAngleVisible===!0&&!t.isPedal())||!t._incidenceSector.isVisibilityHidden())}),this._drawCommand.push(function(e){t._normalLine.setLineVisibility(t._option.nameVisible,!0),e.resolve()},function(){return t._normalLine.getLineVisible()}),
this._drawCommand.push(function(e){t._pedalLine.setVisibility(!0),e.resolve()},function(){return!t._pedalLine.isVisibilityHidden()}),this._drawCommand.push(function(i,n){t._option.normalAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.Reflection,!0),t.setSectorInsideDrawStatus(!0,e.Type.Reflection),i.resolve()},function(){return!t.getSectorEnable()||(!(t._option.normalAngleVisible===!0&&!t.isPedal())||!t._reflectionSector.isVisibilityHidden())}),this._drawCommand.push(function(e){t._reflectionLine.setVisibility(!0),e.resolve()},function(){return!t._reflectionLine.isVisibilityHidden()}),this._drawCommand.push(function(i){t._option.surfaceAngleVisible===!0&&t.setSectorVisibilityByType(e.Type.SurfaceOut,!0),t.setSectorInsideDrawStatus(!0,e.Type.SurfaceOut),i.resolve()},function(){return!t.getSectorEnable()||(!(t._option.surfaceAngleVisible===!0&&!t.isPedal())||!t._surfaceOutSector.isVisibilityHidden())}),this._drawCommand.push(function(e){t._incidenceLine.setVisibility(!0),t._reflectionLine.setVisibility(!0),t._incidenceLine.setWidth(t._configData.IncidenceLine.PedalWidth),t._incidenceLine.setArrowPos(t._configData.IncidenceLine.PedalArrowPos),t._reflectionLine.setWidth(t._configData.ReflectionLine.PedalWidth),t.resetLinePos(),t._reflectionLine.setArrowPos(t._configData.ReflectionLine.PedalArrowPos),e.resolve()},function(){return!t._reflectionLine.isVisibilityHidden()&&!t._incidenceLine.isVisibilityHidden()&&t._reflectionLine.getWidth()===t._configData.ReflectionLine.PedalWidth}),this._drawCommand.push(function(e,i){t._option.normalAngleVisible===!1&&i?t.sectorAnimateDisappear(function(){e.resolve()}):e.resolve()},function(){return t.getSectorHasDraw(e.Type.Incidence)&&t.getSectorHasDraw(e.Type.Reflection)}),this.initDrawStatus()},getCommandLength:function(){return this._drawCommand.getCommandLength()},pushDrawCommand:function(e,t){this._drawCommand.push(e,t)},setDrawIndex:function(e){this._configData.DrawIndex=e,this.isPedal()||this._drawCommand.setDrawIndex(e)},setPedalDrawIndex:function(e){this._configData.PedalDrawIndex=e,this.isPedal()&&this._drawCommand.setDrawIndex(e)},setIncidenceShortPedalView:function(e){this._incidenceLine.setVisibility(!0),this._reflectionLine.setVisibility(!0),this._incidenceLine.setWidth(e||this._configData.IncidenceLine.PedalWidth),e===this._configData.IncidenceLine.PedalWidth&&this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos),this._reflectionLine.setWidth(this._configData.ReflectionLine.PedalWidth),this._reflectionLine.setArrowPos(this._configData.ReflectionLine.PedalArrowPos),this.resetLinePos()},isDrawIncidenceShortPedalView:function(e){return!this._reflectionLine.isVisibilityHidden()&&!this._incidenceLine.isVisibilityHidden()&&this._incidenceLine.getWidth()===(e||this._configData.IncidenceLine.PedalWidth)},getHasDrawIncidencePoint:function(){return this._hsdrawIncidencePoint},initDrawStatus:function(){var e=this._configData.Draw;e&&(this._hsdrawIncidencePoint=e.incidencePoint)}};return s}),s("js/reflector/lightComplex/event",["js/view/sector"],function(e){var t={surfaceAngleVisibleHandler:function(t){this.setSectorVisibilityByOutSideLogic(e.Type.SurfaceIn,t),this.setSectorVisibilityByOutSideLogic(e.Type.SurfaceOut,t)},normalAngleVisibleHandler:function(t){this.setSectorVisibilityByOutSideLogic(e.Type.Incidence,t),this.setSectorVisibilityByOutSideLogic(e.Type.Reflection,t)},setNameVisible:function(e){this._incidenceLine.setNameVisible(e),this._reflectionLine.setNameVisible(e),this.getNameGroup().setNameVisible(e),this._normalLine.setNameVisible(e)},nameVisibleHandler:function(e){this.setNameVisible(e)}};return t}),s("js/reflector/lightComplex/main",["js/reflector/baseReflector","js/utils/utils","js/utils/graphMath","js/config/style","js/config/eventKey","js/utils/view"],function(e,t,s,a,r,o){var l=n("js/view/BaseView"),c=n("js/view/sector"),h=n("js/view/LightLine"),u=n("js/view/NormalLine"),g=(n("js/view/NameGroup"),n("js/view/PedalLine")),f=n("js/utils/DrawCommand"),d=n("js/reflector/lightComplex/config"),_=n("js/reflector/btns"),p=5,m=a.IncidencePoint,v=l({_data:null,_configData:null,_onLightMove:null,_option:null,_reflectorType:0,_staticLines:[],_linePedalChangeLock:!1,_lineMoveListener:null,_hasDrawNext:!0,create:function(e,n,s,a,o){var l=Object.create(this);l._uuid=t.getUuid(),l._reflectorType=o,l._configData=i.extend(!0,{},d,n),l._configData.DrawIndex=i.extend(!0,[],n.DrawIndex||d.DrawIndex),l._configData.PedalDrawIndex=i.extend(!0,[],n.PedalDrawIndex||d.PedalDrawIndex);var c=[];return l._staticLines=[],c.push({key:r.SurfaceAngleVisible,callback:"surfaceAngleVisibleHandler",params:[]}),c.push({key:r.NormalAngleVisible,callback:"normalAngleVisibleHandler",params:[]}),l._configData.nameEventEnable&&c.push({key:r.NameVisible,callback:"nameVisibleHandler",params:[]}),c.push({key:r.ZIndexChange,callback:"zIndexChangeHandler",params:[]}),l.__base(e,c),l.__proxyAll(["onLightMove"]),l._option=a,l._onLightMove=s,l._drawCommand=f.create(),l._drawCommand.setDrawIndex(l._configData.DrawIndex),l.initBtns(),l.createView(),l.initVisibleState(),l.initDrawCommand(),l.initDomEvent(),l},createView:function(){var e=this,t=this._configData,i=0;this.createSector(i);for(var n=0;n<t.StaticLine.length;n++){var s=h.create(this.__getEventBus(),t.StaticLine[n].lineType,t.StaticLine[n]);this.addShape(s.getView()),this._staticLines.push(s)}this._reflectionLine=h.create(this.__getEventBus(),h.Type.ReflectionLine,t.ReflectionLine,this.onLightMove,this._option.langData),this._incidenceLine=h.create(this.__getEventBus(),h.Type.IncidenceLine,t.IncidenceLine,this.onLightMove,this._option.langData,this._option.showDefaultRotateBtn),t.IncidenceLine.clickAble&&this._incidenceLine.setMoveListener(function(t,i,n,s){e.btns.moveBtnEventHandler(t,i,n,s),e._lineMoveListener&&e._lineMoveListener()}),t.ReflectionLine.clickAble&&this._reflectionLine.setMoveListener(function(t,i,n,s){e.btns.moveBtnEventHandler(t,i,n,s),e._lineMoveListener&&e._lineMoveListener()}),this._normalLine=u.create(t.NormalLine.width,this._option.langData),this._pedalLine=g.create(),this.appendSector(),this.addShape(this._normalLine.getView()),t.IncidenceLine.highLineZIndex?(this.addShape(this._reflectionLine.getView()),this.addShape(this._incidenceLine.getView())):(this.addShape(this._incidenceLine.getView()),this.addShape(this._reflectionLine.getView())),this.addShape(this._pedalLine.getView());var a=-Math.abs(i-t.IncidenceLine.width),r=-Math.abs(i-t.ReflectionLine.width),o=-3,l=-Math.abs(i-t.NormalLine.width);this._incidenceLine.setTranslate(a,o),this._incidenceLine.setRotate(t.IncidenceLine.defaultAngle),this._reflectionLine.setTranslate(r,o),this._reflectionLine.setRotate(180-t.IncidenceLine.defaultAngle),this._normalLine.setTranslate(l,1),this._staticLines.forEach(function(e,n){var s=t.StaticLine[n],a=-Math.abs(i-s.width);e.setTranslate(a,o),e.setRotate(s.defaultAngle)}),this.setTranslate(this._configData.IncidencePosX,0),this._$$incidencePoint=new kity.Circle(m.width).fill(m.fill),this._$$incidencePoint.setTranslate(this._configData.IncidencePosX,0)},setLineMoveListener:function(e){this._lineMoveListener=e},btnStillInBox:function(){this._reflectionLine.btnStillInBox(),this._incidenceLine.btnStillInBox(),this._staticLines.forEach(function(e,t){e.btnStillInBox()})},initBtns:function(){var e=this._configData.IncidenceLine.clickAble?1:0;this._configData.ReflectionLine.clickAble&&e++,this.btns=_.create(this.__getEventBus(),this._$$container,e)},initVisibleState:function(){var e=this._configData;this.initSectorVisibleState(),this.surfaceAngleVisibleHandler(this._option.surfaceAngleVisible),this.normalAngleVisibleHandler(this._option.normalAngleVisible),this.nameVisibleHandler(this._option.nameVisible),this._normalLine.setVisibility(e.NormalLine.visible),this._pedalLine.setVisibility(e.PedalLineVisible),o.setVisibility(this._$$incidencePoint,e.IncidencePointVisible),this._normalLine.setPointNameVisibility(this._option.nameVisible,e.NormalLine.pointNameVisible),this._normalLine.setLineVisibility(this._option.nameVisible,e.NormalLine.lineVisible)},gtIndexAppendToView:function(e){e.addShape(this._$$incidencePoint),this.gtIndexSectorAppendToView(e),this.btns.appendToView(e)},bringBtnToTop:function(){this.btns.getView().bringTop()},resetAngle:function(e,t){var i=this,n="undefined"==typeof this._surfaceAngle?e:e-this._surfaceAngle;this._surfaceAngle=e;var s=this._incidenceLine.getRotateAngle();if(t)s+=n;else if(this._configData.ReflectionLine.rotateFixed){var a=this._reflectionLine.getRotateAngle();s=180-a+2*e}else this._configData.IncidenceLine.rotateFixed?s=this._incidenceLine.getRotateAngle():s+=n;var r=s-e,o=e,l=90+e,c=180+e;this._staticLines.forEach(function(e,t){var n=i._configData.StaticLine[t];e.setRotate(c-n.defaultAngle)}),!this._configData.ReflectionLine.rotateFixed||t?this._reflectionLine.setRotate(c-(s-e)):this._reflectionLine.setRotate(this._reflectionLine.getRotateAngle()),this._incidenceLine.setRotate(s),this._normalLine.setRotate(l),this._pedalLine.setRotate(l);var h=[],u=!1;s>l?(h=[o,c-r,l,s,c],u=!0):h=[o,s,l,c-r,c],this.resetSectorAngle(this._normalLine.getRotateAngle(),u,h),this._drawCommand.setDrawIndex(this.isPedal()?this._configData.PedalDrawIndex:this._configData.DrawIndex),this.setIncidence0180View(),this.resetLinePos()},getMoveRotateAngle:function(e){var t,n=e.currentPos,a=e.lastPos,r=i(this._$$incidencePoint.node).offset();return t={x:r.left,y:r.top},s.getRotateAngle(t,a,n)},onLightMove:function(e,t,i){if("beforemove"===i);else if("aftermove"===i)this.adsorptionPedal(),this.adsorptionStatic();else if("move"===i){var n=this.getMoveRotateAngle(t);e===h.Type.ReflectionLine&&(n=-n),this.lineRotateAble(n)&&(this._configData.IncidenceLine.rotateFixed?this._incidenceLine.rotate(n):this._configData.ReflectionLine.rotateFixed?this._reflectionLine.rotate(-n):this._incidenceLine.rotate(n),this.resetAngle(this._surfaceAngle),this._onLightMove(this.getUuid(),n))}},adsorptionStatic:function(){if(0!==this._staticLines.length){var e,t,i,n,s=this,a=Math.round(this.getSectorAngle(c.Type.SurfaceIn)),r=s._incidenceLine.getRotateAngle(),o=s._reflectionLine.getRotateAngle();this._staticLines.forEach(function(l,c){e=s._configData.StaticLine[c],e.autoAdsorption&&a===e.defaultAngle&&(t=l.getRotateAngle(),n=Math.abs(r-t),i=Math.abs(o-t),n<i?(s._incidenceLine.setRotate(t),s._reflectionLine.setRotate(o+r-t)):(s._reflectionLine.setRotate(t),s._incidenceLine.setRotate(r+o-t)))})}},setIncidence0180View:function(){var e=Math.round(this.getSectorAngle(c.Type.Incidence));0===e||90===e?(this.setSectorVisibility(!1),this._configData.view90PedalLineVisible&&(0===e?this._pedalLine.setVisibility(!0):this._pedalLine.setVisibility(this._normalLine.getLineVisible())),this._incidenceLine.isVisibilityHidden()||this._reflectionLine.isVisibilityHidden()||this._linePedalChangeLock||(this._incidenceLine.setWidth(this._configData.IncidenceLine.PedalWidth),this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos),this._reflectionLine.setWidth(this._configData.ReflectionLine.PedalWidth),this._reflectionLine.setArrowPos(this._configData.ReflectionLine.PedalArrowPos))):(this.syncSectorVisibilityByName(),this._configData.view90PedalLineVisible&&this._pedalLine.setVisibility(this._normalLine.getLineVisible()),this._incidenceLine.isVisibilityHidden()||this._reflectionLine.isVisibilityHidden()||this._linePedalChangeLock||(this._incidenceLine.setWidth(this._configData.IncidenceLine.width),this._incidenceLine.setArrowPos(this._configData.IncidenceLine.arrowPos),this._reflectionLine.setWidth(this._configData.ReflectionLine.width),this._reflectionLine.setArrowPos(this._configData.ReflectionLine.arrowPos)))},setIncidencePos:function(e,t){this._configData.IncidencePosX=e,this.setTranslate(this._configData.IncidencePosX,0),this._$$incidencePoint.setTranslate(this._configData.IncidencePosX,0),this.getNameGroup().setTranslate(this._configData.IncidencePosX,0)},getIncidencePosX:function(){return this._configData.IncidencePosX},lineRotateAble:function(e){this._incidenceLine.getRotateAngle()>this._normalLine.getRotateAngle()&&(e=-e);var t=this.getSectorAngle(c.Type.SurfaceIn);return!(t+e<p)},complexRotateAble:function(e){if(!this._configData.IncidenceLine.rotateFixed&&!this._configData.ReflectionLine.rotateFixed)return!0;this._incidenceLine.getRotateAngle()>this._normalLine.getRotateAngle()?this._configData.IncidenceLine.rotateFixed?e=e:this._configData.ReflectionLine.rotateFixed&&(e=-e):this._configData.IncidenceLine.rotateFixed?e=-e:this._configData.ReflectionLine.rotateFixed&&(e=e);var t=this.getSectorAngle(c.Type.SurfaceIn);return!(t+e<p)},around:function(e,t,i){i=i||0;var n,a,r=Math.abs(t-this._configData.IncidencePosX),o=s.getSpherePos(e||0,r);t>this._configData.IncidencePosX?(n=t+-o.x,a=o.y):(n=o.x+t,a=-o.y),this.setTranslate(n+i,-a),this._$$incidencePoint.setTranslate(n+i,-a),this.getNameGroup().setTranslate(n+i,-a),this._incidenceLine.fwBtnMove(),this._reflectionLine.fwBtnMove()},updatePos:function(){this._incidenceLine.fwBtnMove(),this._reflectionLine.fwBtnMove(),this.getNameGroup().updatePos()},getData:function(){var e=this,t=e.getSectorAngle(c.Type.SurfaceIn);this._normalLine.getRotateAngle()<this._incidenceLine.getRotateAngle()&&(t=180-t);var i={IncidenceLine:{defaultAngle:t,visible:!e._incidenceLine.isVisibilityHidden(),rotateFixed:e._configData.IncidenceLine.rotateFixed,nameEnable:e._incidenceLine.getNameEnable()},ReflectionLine:{visible:!e._reflectionLine.isVisibilityHidden(),rotateFixed:e._configData.ReflectionLine.rotateFixed,nameEnable:e._reflectionLine.getNameEnable()},NormalLine:{pointNameVisible:e._normalLine.getPointNameVisible(),lineVisible:e._normalLine.getLineVisible()},Sector:{sectorInVisible:e.getSectorOutSideVisibilityByType(c.Type.SurfaceIn),sectorOutVisible:e.getSectorOutSideVisibilityByType(c.Type.SurfaceOut),incidenceVisible:e.getSectorOutSideVisibilityByType(c.Type.Incidence),reflectionVisible:e.getSectorOutSideVisibilityByType(c.Type.Reflection),hasDraw:e.getSectorHasDraw()},Draw:{incidencePoint:e.getHasDrawIncidencePoint()},PedalLineVisible:!e._pedalLine.isVisibilityHidden(),IncidencePosX:e._configData.IncidencePosX,Visible:!e.isVisibilityHidden()};return i},adsorptionPedal:function(){if(this.isPedal()){var e=this._normalLine.getRotateAngle();this._incidenceLine.setRotate(e),this._reflectionLine.setRotate(e),this.resetAngle(e-90)}},isPedal:function(){return 0===Math.round(this.getSectorAngle(c.Type.Incidence))},initDomEvent:function(){this.bindDomEvent(this.getView().node,["lrTap"],this.getUuid(),this.domEventHandler)},setViewTapListener:function(e){this._onViewClickListener=e},domEventHandler:function(e){this._onViewClickListener&&this._onViewClickListener(e)},changeTransparent:function(e){return},setVisibility:function(e){o.setVisibility(this.getView(),e),this.getNameGroup().setVisibility(e)},setLinePedalChangeLock:function(e){this._linePedalChangeLock=e},getTwoLineVisible:function(){return!this._incidenceLine.isVisibilityHidden()&&!this._reflectionLine.isVisibilityHidden()}}),y=n("js/reflector/lightComplex/draw"),b=n("js/reflector/lightComplex/event"),w=n("js/reflector/lightComplex/proxyApi"),A=n("js/reflector/lightComplex/sector"),V=n("js/reflector/lightComplex/namePos");return v.__include(y),v.__include(b),v.__include(w),v.__include(A),v.__include(V),v}),s("js/reflector/lightComplex/namePos",["js/view/sector","js/utils/utils","js/utils/view","js/utils/graphmath","js/utils/svg","js/view/lightLine"],function(e,t,i,n,s,a){var r={_lastMinLine:null,resetLinePos:function(){this.initLineNamePos(this._incidenceLine),this.initLineNamePos(this._reflectionLine)},initLineNamePos:function(t){var i=parseFloat(this._normalLine.getRotateAngle().toFixed(5)),n=parseFloat(t.getRotateAngle().toFixed(5)),s=t.getWidth(),r=this.getSectorAngle(e.Type.Incidence),o=Math.abs(i%180),l=0;l=s<=290?(290-s)/50:(290-s)/85;var c=1;c=o>90?1-(o-90)/90:o/90;var h=15+7*c+4*l;r<=h&&(n=n>i?i+h:i===n?t.getLightType()==a.Type.IncidenceLine?i-h:i+h:i-h),n&&t.makeNameViewAround(n)}};return r}),s("js/reflector/lightComplex/proxyApi",["js/view/sector","js/utils/utils","js/utils/view","js/view/LightLine"],function(e,t,i,n){var s=function(e){return e%=360,e<0?360+e:e},a=function(e){var t=(180-e%360)%360;return t<0&&(t=360+t),t},r={setIncidenceXAxisAngle:function(e){this._incidenceLine.setRotate(e)},getIncidenceRotateAngle:function(){return this._incidenceLine.getRotateAngle()},getReflectionRotateAngle:function(){return this._reflectionLine.getRotateAngle()},setIncidenceLineWidth:function(e){this._incidenceLine.setWidth(e)},setReflectionLineWidth:function(e){this._reflectionLine.setWidth(e)},setIncidenceLineArrowPos:function(e){this._incidenceLine.setArrowPos(e)},setReflectionLineArrowPos:function(e){this._reflectionLine.setArrowPos(e)},setIncidenceLineCommonFill:function(e){e?this._incidenceLine.setCommonFill():this._incidenceLine.restoreFill()},setReflectionLineCommonFill:function(e){e?this._reflectionLine.setCommonFill():this._reflectionLine.restoreFill()},setIncidenceLineVisible:function(e){this._incidenceLine.setVisibility(e)},setReflectionLineVisible:function(e){this._reflectionLine.setVisibility(e)},getIncidenceLineVisible:function(){return!this._incidenceLine.isVisibilityHidden()},getReflectionLineVisible:function(){return!this._reflectionLine.isVisibilityHidden()},getIncidenceSurfaceAngle:function(){return this.getSectorAngle(e.Type.Incidence)},setIncidenceNameEnable:function(e){this._incidenceLine.setNameEnable(e)},setIncidenceNameVisible:function(e){this._incidenceLine.setNameVisible(e),this.resetLinePos()},getNormalLineRotateAngle:function(){return this._normalLine.getRotateAngle()},getIncidenceLineXAngle:function(){return(360-this._incidenceLine.getRotateAngle()%360)%180},getReflectionLineXAngle:function(){return(360-this._reflectionLine.getRotateAngle()%360)%180},getNormalLineXAngle:function(){return(360-this._normalLine.getRotateAngle()%360)%180},getSectorInLineXAngle:function(){var t=0,i=this._incidenceLine.getRotateAngle(),n=this._normalLine.getRotateAngle();return t=i>n?i+this.getSectorAngle(e.Type.SurfaceIn):i-this.getSectorAngle(e.Type.SurfaceIn),(360-t%360)%180},getSectorOutLineXAngle:function(){var t=0,i=this._reflectionLine.getRotateAngle(),n=this._normalLine.getRotateAngle();return t=i>n?i+this.getSectorAngle(e.Type.SurfaceOut):i-this.getSectorAngle(e.Type.SurfaceOut),(360-t%360)%180},getIncidenceLineSphereAngle:function(){return a(this._incidenceLine.getRotateAngle())},getReflectionLineSphereAngle:function(){return a(this._reflectionLine.getRotateAngle())},getNormalLineSphereAngle:function(){return a(this._normalLine.getRotateAngle())},getLineXAngle:function(e){return e===n.Type.IncidenceLine?this.getIncidenceLineXAngle():e===n.Type.ReflectionLine?this.getReflectionLineXAngle():void 0},getLine0To360RotateAngle:function(e){var t;return e===n.Type.IncidenceLine?t=this._incidenceLine:e===n.Type.ReflectionLine&&(t=this._reflectionLine),s(t.getRotateAngle())},getLineQuad:function(t){var i,a;if(t===n.Type.IncidenceLine)i=this._incidenceLine;else if(t===n.Type.ReflectionLine)i=this._reflectionLine;else if(t===n.Type.NormalLine)i=this._normalLine;else if(t===n.Type.SurfaceIn){var r=this.getNormalLineRotateAngle(),o=this.getIncidenceRotateAngle();o<r?(a=s(o)-this.getSectorAngle(e.Type.SurfaceIn),a<0&&(a=360+a)):(a=s(o)+this.getSectorAngle(e.Type.SurfaceIn),a<0&&(a=360+a))}else if(t===n.Type.SurfaceOut){var r=this.getNormalLineRotateAngle(),l=this.getReflectionRotateAngle();l<r?(a=s(l)-this.getSectorAngle(e.Type.SurfaceOut),a<0&&(a=360+a)):(a=s(l)+this.getSectorAngle(e.Type.SurfaceOut),a<0&&(a=360+a))}return i&&(a=s(i.getRotateAngle())),a>=0&&a<=90?2:a>=90&&a<=180?1:a>=180&&a<=270?4:a>=270&&a<=360?3:0},setLineVisibility:function(e,t){e===n.Type.IncidenceLine?this._incidenceLine.setVisibility(t):e===n.Type.ReflectionLine&&this._reflectionLine.setVisibility(t)},setLineEnable:function(e,t){e===n.Type.IncidenceLine?this._incidenceLine.setLineEnable(t):e===n.Type.ReflectionLine&&this._reflectionLine.setLineEnable(t)}};return r}),s("js/reflector/lightComplex/sector",["js/view/sector","js/utils/utils","js/utils/view","js/view/NameGroup","js/view/LightLine"],function(e,t,s,a,r){var o=n("js/utils/graphMath"),l={_sector:null,_sectorEnable:!0,_currentVisibleStatus:null,_sectorHasDraw:null,createSector:function(t){var i=this._configData;this._sector={},this._currentVisibleStatus={},this._sector[e.Type.Incidence]=this._incidenceSector=e.create(e.Type.Incidence,t,0,i.Sector.incidenceR,this._option.langData),this._sector[e.Type.Reflection]=this._reflectionSector=e.create(e.Type.Reflection,t,0,i.Sector.reflectionR,this._option.langData),this._sector[e.Type.SurfaceIn]=this._surfaceInSector=e.create(e.Type.SurfaceIn,t,0,i.Sector.surfaceR,this._option.langData),this._sector[e.Type.SurfaceOut]=this._surfaceOutSector=e.create(e.Type.SurfaceOut,t,0,i.Sector.surfaceR,this._option.langData);var n={};n[e.Type.Incidence]={cx:t,cy:0,r:i.Sector.reflectionR,letterR:i.Sector.letterR,angleR:i.Sector.angleR},n[e.Type.Reflection]={cx:t,cy:0,r:i.Sector.reflectionR,letterR:i.Sector.letterR,angleR:i.Sector.angleR},n[e.Type.SurfaceIn]={cx:t,cy:0,r:i.Sector.surfaceR,angleR:i.Sector.surfaceR},n[e.Type.SurfaceOut]={cx:t,cy:0,r:i.Sector.surfaceR,angleR:i.Sector.surfaceR},this._nameGroup=a.create(n,this._option.langData,this._option,this._reflectorType,this._configData.NameAutoPos),this._nameGroup.setTranslate(this._configData.IncidencePosX,0)},sectorEach:function(e){for(var t in this._sector)e.apply(this._sector[t],[t])},appendSector:function(){var e=this;this.sectorEach(function(t){e.addShape(this.getView())})},gtIndexSectorAppendToView:function(e){e.addShape(this._nameGroup.getView())},setAngleVisibleByType:function(e,t){return this._currentVisibleStatus[e]=t,this._sectorEnable?void this._nameGroup.setAngleVisibleByType(e,t):void(t===!0&&this._nameGroup.setHasDrawStatusByType(e,t))},resetSectorAngle:function(e,t,i){var n=function(e,t,i){return t?i-e:e};this._surfaceInSector.rotate(i[n(0,t,3)],i[n(1,t,5)]),this._incidenceSector.rotate(i[n(1,t,3)],i[n(2,t,5)]),this._reflectionSector.rotate(i[n(2,t,3)],i[n(3,t,5)]),this._surfaceOutSector.rotate(i[n(3,t,3)],i[n(4,t,5)]),this._nameGroup.setNormalAngle(e),this._nameGroup.rotate(i,t)},initSectorVisibleState:function(){var t=this._configData;this.setAngleVisibleByType(e.Type.SurfaceIn,t.Sector.sectorInVisible),this.setAngleVisibleByType(e.Type.SurfaceOut,t.Sector.sectorOutVisible),this.setAngleVisibleByType(e.Type.Incidence,t.Sector.incidenceVisible),this.setAngleVisibleByType(e.Type.Reflection,t.Sector.reflectionVisible),this._configData.Sector.hasDraw&&this._nameGroup.setHasDrawStatus(this._configData.Sector.hasDraw),this.syncSectorVisibilityByName()},getSectorHasDraw:function(e){return"undefined"!=typeof e?this._nameGroup.getHasDrawStatusByType(e):this._nameGroup.getHasDrawStatus()},setSectorInsideDrawStatus:function(e,t){this._nameGroup.setHasDrawStatusByType(e,t)},setSectorVisibilityByType:function(e,t){this.setAngleVisibleByType(e,t),this._sector[e].setVisibility(this._nameGroup.getAngleIsValidByType(e))},setSectorVisibilityByOutSideLogic:function(e,t){this._nameGroup.getHasDrawStatusByType(e)&&this.setAngleVisibleByType(e,t),this._sector[e].setVisibility(this._nameGroup.getAngleIsValidByType(e))},setSectorVisibility:function(e){this.sectorEach(function(){this.setVisibility(e)})},syncSectorVisibilityByName:function(){var e=this;this.sectorEach(function(t){this.setVisibility(e._nameGroup.getAngleIsValidByType(t))})},sectorAnimateDisappear:function(t){var n=this;n.setAngleVisibleByType(e.Type.Incidence,!0),n.setAngleVisibleByType(e.Type.Reflection,!0),n.syncSectorVisibilityByName(),n.setAngleVisibleByType(e.Type.Incidence,!1),n.setAngleVisibleByType(e.Type.Reflection,!1),n.setSectorInsideDrawStatus(!0,e.Type.Incidence),n.setSectorInsideDrawStatus(!0,e.Type.Reflection),i(n._reflectionSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300,function(){n.syncSectorVisibilityByName(),i(n._reflectionSector.getView().node).css("display",""),t&&t()}),i(n._incidenceSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300,function(){n.syncSectorVisibilityByName(),i(n._incidenceSector.getView().node).css("display",""),t&&t()})},getSectorOutSideVisibilityByType:function(e){return this._nameGroup.getAngleVisibilityByType(e)},getNameGroup:function(){return this._nameGroup},getSectorAngle:function(e){return this._nameGroup.getAngle(e)},getSectorLinesPos:function(t,i){var n,s,a,l,c=this;t==e.Type.Incidence?(n=this.getIncidenceLineXAngle(),s=this.getNormalLineXAngle(),a=r.Type.IncidenceLine,l=r.Type.NormalLine):t==e.Type.Reflection?(n=this.getNormalLineXAngle(),s=this.getReflectionLineXAngle(),a=r.Type.NormalLine,l=r.Type.ReflectionLine):t==e.Type.SurfaceIn?(n=this.getIncidenceLineXAngle(),s=this.getSectorInLineXAngle(),a=r.Type.IncidenceLine,l=r.Type.SurfaceIn):t==e.Type.SurfaceOut&&(n=this.getReflectionLineXAngle(),s=this.getSectorOutLineXAngle(),a=r.Type.ReflectionLine,l=r.Type.SurfaceOut);var h=function(n,s){n>90&&(n=180-n);var a=c.getLineQuad(s),r=c._configData.Sector.surfaceR;t==e.Type.Incidence?r=c._configData.Sector.incidenceR:t==e.Type.Reflection&&(r=c._configData.Sector.reflectionR);var l={y:Math.sin(o.getRadian(n))*r,x:Math.cos(o.getRadian(n))*r},h={};return 1===a?(h.x=i.x+l.x,h.y=i.y+l.y):2===a?(h.x=i.x-l.x,h.y=i.y+l.y):3===a?(h.x=i.x-l.x,h.y=i.y-l.y):(h.x=i.x+l.x,h.y=i.y-l.y),{a:i,b:h}},u=[h(n,a),h(s,l)];return u},setSectorEnable:function(e){var t=this;this._sectorEnable=e,e?(this.sectorEach(function(e){t._nameGroup.setAngleVisibleByType(e,t._currentVisibleStatus[e])}),this.syncSectorVisibilityByName()):this.sectorEach(function(e){this.setVisibility(!1),t._nameGroup.setAngleVisibleByType(e,!1)})},getSectorEnable:function(){return this._sectorEnable},setSectorOpacity:function(e){this.getNameGroup().setOpacity(e),this.sectorEach(function(){this.setOpacity(e)})}};return l}),s("js/main",["js/reflector/reflectorMain","js/utils/logger"],function(t,i){e.LightReflector={create:function(e){return t.create(e)},setLogLevel:function(e){i.setLevel(e)}}}),n("js/main")}(window,document,jQuery);
//# sourceMappingURL=light.min.js.map
