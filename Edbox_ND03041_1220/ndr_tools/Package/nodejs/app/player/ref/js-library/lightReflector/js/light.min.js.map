{"version":3,"sources":["light.min.js"],"names":["window","document","$","require","define","defined","defineWaiting","callDeps","key","toLowerCase","df","args","i","deps","length","depName","ret","callback","apply","Array","Error","module","Logger","include","baseCls","cls","__overwrite","indexOf","debug","proxy","thisobj","fn","arguments","Base","___eventBus","___eventsInfo","params","__base","eventBus","eventsInfo","this","prototype","slice","arg","event","type","on","__include","__proxyAll","__on","push","__triggerEvent","trigger","__getEventBus","__destroy","off","Object","create","color","kity","Color","createRGBA","createRGB","parse","EventKey","Blur","DomEvent","SurfaceAngleVisible","NormalAngleVisible","NameVisible","ZIndexChange","LightLineVisible","MoveBtn","BtnMove","lang","rf_incidence_line_name","rf_incidence_angle","rf_incidence_point","rf_normal_name","rf_reflection_line_name","rf_reflection_angle","rf_reflection_surface","rf_equal_angle_name","fontClass","black","green","blue","red","orange","purple","roman","style","LineStyle","strokeStyle","stroke-width","stroke","rectHeight","btnRotate","width","height","arrow","commonLineFill","commonArrowCls","IncidenceLine","fill","arrowClass","ReflectionLine","Reverse","Sector","surfaceFill","incidenceFill","reflectionFill","incidenceFontClass","reflectionFontClass","surfaceFontClass","incidenceLetterClass","reflectionLetterClass","NormalLine","pointWidth","pointFill","IncidencePoint","Surface","surfaceClass","Pedal","EqualAngleName","gloInitJqEvent","supportTouch","isMobile","navigator","userAgent","match","vEventHandler","mouseDown","mouseUp","mouseWheel","getEventX","originalEvent","changedTouches","clientX","getEventY","clientY","special","lrTap","setup","$that","vMouseDown","vMouseUp","_start","_startX","_startY","bind","which","Date","getTime","end","endX","endY","holdTime","dx","Math","abs","dy","fix","tapEventSource","tapFireTouch","triggerHandler","sourceCapabilities","firesTouchEvents","teardown","unbind","BaseReflector","_lightComplexArray","eventbus","createView","updatePos","drawAll","drawNext","hasNext","getData","getType","_TYPE","getNameVisible","_option","nameVisible","pushEvent","eventInfo","_event","String","Utils","View","ForeignView","Svg","Btns","_fwRotateBtns","_g","_id","_lineUuid","_reflector","reflector","count","instance","getUuid","initRotateBtn","fwRotate","that","Group","addDomEvent","getView","node","append","eventType","selfId","data","getFwRotateBySelfId","addClass","removeClass","blur","lineId","__lineUuid","setVisibility","appendToView","$$container","addShape","moveBtnEventHandler","scale","clientRect","uuid","visible","getFwRotateByLineId","pLeft","left","pTop","top","rect","getBoundingClientRect","rLeft","rTop","transforms","getAttrTranslate","attr","setTranslate","fwRotateBtns","test","EventUtils","_$$paper","_$$paperItems","_eventInfo","paper","option","bindDomEvent","_domEvents","_getEventInfo","e","$target","srcElement","hasClass","closest","parent","_initEventInfo","_clearEventInfo","_events","mType","forEach","info","moveAbs","mMoveAbs","currentPos","mCurrentPos","lastPos","mLastPos","_downTrigger","_touchTrigger","_moveTrigger","_startTime","_startPos","_moveLastPos","__domEvents","lock","getPagePos","preventDefault","p","x","y","mxj","parseFloat","mMoveTrigger","mTouchTrigger","fixed","fixPcClick","isMove","isDown","dom","domEvent","identifier","stopPropagation","LightComplex","LightComplexArray","_lightArray","_lightEnable","_lightDrawBefore","_chainMode","_currentHighZIndex","config","onLineMove","chainMode","reflectorType","_uuid","_config","initZIndexEvent","lightComplex","Visible","each","gtIndexAppendToView","bringBtnToTop","btnStillInBox","callBack","index","call","indexValidate","getCommandLength","pushDrawCommand","command","hasDrawCommand","setPedalDrawIndex","pedalIndex","setDrawIndex","drawIndex","resetAngle","surfaceAngle","init","changeChainLineCommonFill","setReflectionLineCommonFill","isEnableAndDraw","setIncidenceLineCommonFill","setCommonLineVisible","setReflectionLineVisible","setIncidenceLineVisible","cb","hasNextEnable","hasCall","isVisibilityHidden","hasDrawNext","setAllEnable","enable","setEnable","showFirstIndex","setSectorEnable","rotateAble","angle","surfaceMove","flag","rotateFixed","complexRotateAble","around","surfaceRotatePosX","adsorptionPedal","adsorption","adsorptionStatic","isPedalExcludeDisable","isPedal","setViewTapListener","j","changeTransparent","getCurrentHighZIndex","setIncidenceNameEnable","nameEnable","setIncidenceNameVisible","get","getDrawBegin","setNameVisible","setLinePedalChangeLock","getCount","GraphMath","Reflector","_CONFIG","arrowPos","defaultAngle","clickAble","rotateFixedAfterDraw","lineVisible","pointNameVisible","sectorInVisible","sectorOutVisible","incidenceVisible","reflectionVisible","letterR","angleR","IncidencePosX","DrawIndex","PedalDrawIndex","rotatePosX","rotatePosY","Type","tl","_Event","_$$container","_incidencePointPos","_surfacePagePos","_equalAngleNameHasShowBefore","extend","initEvent","configData","afterCreateView","initExtrasDrawCommand","_surface","onSurfaceMove","langData","btns","setMoveListener","_equalAngleName","toCenter","initEqualAngleNamePos","deffer","resolve","splice","getWidth","getHeight","svgWidth","container","containerCTM","getCTM","a","f","viewPortWidth","viewPortHeight","rotate","getRotateAngle","getMoveRotateAngle","getRotateOffsetPos","initEqualAngleVisibility","afterLineMove","getTwoLineVisible","Extend","Reflector1","Reflector2","Reflector3","view90PedalLineVisible","animate","defaultIndex","Style","LightLine","PedalWidth","PedalArrowPos","highLineZIndex","tl_Large","_incidenceWidth","name","_$$incidenceName","Text","setCommonNameVisible","setContent","setAttr","lightLineVisibleHandler","nameVisibleHandler","getIncidenceLineVisible","setVisible","__push","setIncidenceShortPedalView","isDrawIncidenceShortPedalView","parentTranslate","getTransform","m","linesPos","pos","degree","getIncidenceRotateAngle","kb","getLineKb","linePos","b","k","firstLight","secondLight","getTwoLineIntersection","getPythagoreanLineC","width2","setIncidenceLineWidth","incidenceRotateAngle","round","incidenceRotateAngle2","getSectorAngle","Incidence","setIncidenceLineArrowPos","SurfaceVerticalPadding","tr","verticalX","verticalY","nameEventEnable","NameAutoPos","need","arrowVisible","SurfaceVertical","reflector5NameEnable","item","_surfaceVertical","onVerticalSurfaceMove","setTranslateX","setSurfaceVerticalAngle","mathLine","subAngle","getSurfaceXAxisDegree","surface","getSurfaceSpherePos","sphereDegree","getSurfacePos","getLinePosByAngle","get0To360RotateAngle","getLineSpherePos","lineAngle","posA","posB","getFirstLinePos","lightType","getLine0To360RotateAngle","surfaceXDegree","lineXAngle","getLineXAngle","getReflectionLine","getReflectionLineXAngle","getSecondLinePos","getThirdLinePos","surfaceVerticalLine","surfaceLine","firstReflectionLinePos","firstIncidenceLinePos","firstLightComplex","secondLightComplex","thirdLightComplex","reflectionPos2","incidenceDegree","getReflectionRotateAngle","setIncidencePos","setIncidenceXAxisAngle","posWidth","setReflectionLineWidth","setReflectionLineArrowPos","secondLinePos","reflectionPos3","incidencePosX","getIncidencePosX","getNormalLineRotateAngle","SurfaceOut","incidenceASurfacePos","maxWidth","thirdReflectionLine","reflectionASurfacePos","getIncidenceSurfaceAngle","surfaceIntersect","pos1","pos2","getPedalHeight","surfaceEachIntersect","centerPos","sectorType","sectorR","Reflection","ps","getLineCircleIntersectionPos","getSectorLinesPos","sectorLinePos","psPos","undefined","StaticLine","autoAdsorption","arrowReverse","lineType","Reflector4","Reflector5","Reflector6","ReflectorFactory","getReflector","EventBus","Lang","VERSION","_templateHtml","ViewPort","OPTION","surfaceAngleVisible","normalAngleVisible","showDefaultRotateBtn","ReflectorMain","_reflectors","_currentIndex","_lock","_init","render","obj","getElementById","jQuery","$mainHtml","template","id","html","_paper","Paper","setViewBox","createReflector","__create","$$item","setId","_data","reflectorData","setData","version","currentIndex","domain","show","getCurrentIndex","setSurfaceAngleVisible","getSurfaceAngleVisible","setNormalAngleVisible","getNormalAngleVisible","getCurrentReflector","reset","clear","setLock","destroy","Command","_queue","_hasDrawQueue","_drawIndex","_maxLength","_stopCallback","_stopFlag","_drawing","draw","hasDraw","makeAsPromise","setCurrentIndex","force","tasks","getTask","doneCallBack","when","done","actualIndex","task","stop","stopCallBack","Deferred","unshift","promise","_eventHandler","shift","handlers","handler","toString","len","isUp","isTouch","ev","point","pageX","pageY","startPos","endPos","startTime","endTime","_holdTime","c","d","denominator","getRadian","PI","getDegree","radian","tan","getArc","r","getDifferent","originPos","startVector","endVector","getCosineAngle","cosA","pow","acosA","acos","getCosineAngleByPos","aPos","bPos","cPos","sqrt","cos","sin","getSvgSectorPoint","cx","cy","startAngle","endAngle","rad","x1","y1","x2","y2","ar","join","getTwoPointDistance","getSpherePos","getShortestDistanceAndPoint","posa","posb","posc","ab","ac","bc","halfPerimeter","S","thirdLong","max","hc","shortestDistance","shortestPos","min","getRectVerticalPos","h","minSide","getRectShortestDistance","s","right","bottom","z","target","vertical","direction","getLightPos","ca","n","la","different","pos3","A","B","ptStart","ptEnd","ptCenter","Radius","EPS","ptInter1","ptInter2","fDis","E","a2","e2","Radius2","t","methods","_console","console","method","emptyFuc","_logger","_level","setLevel","level","log","msg","warn","error","_templateRegExp","tpl","attrs","replace","$0","$1","$2","getTemplateValue","text","tempRegExp","templateRegex","result","regExp","exec","keys","values","parseInt","regexStr","RegExp","transformRegex","translate","svg","getRotateMatrix","createElementNS","setAttribute","matrix","getRotateKityMatrix","svgMatrix","Matrix","getAttrRotate","transform","createJqForeignObject","foreignObject","$div","getFixedFloat","floatNum","digitalCount","num","numAry","split","substring","getValue","str","regex","arr","hexDigits","substr","floor","random","ViewUtils","$$view","setStyle","visibility","hidden","makeAbsViewHorizontal","centerX","centerY","marginX","marginY","nagitive","box","getRenderBox","makeViewAround","$$referenceView","distance","getAttr","pointBox","shortDistance","asbPos","subx","suby","isNaN","BaseView","ArrowStyle","activeFill","bgCls","0","1","2","3","4","Arrow","_$$path","_$$activePath","_type","_width","_contraryDirection","contraryDirection","Path","_$$clickArea","Rect","setSize","setRotate","active","isActive","changeType","restoreType","Blue","Red","Purple","Yellow","Green","_$$view","eventInfos","domEventHandler","$$shape","setOpacity","opacity","isVisible","getVisible","EqualAngleNameStyle","_lang","_$$name","_$view","_$insideView","_height","_cls","find","setWidth","setHeight","setDomEvent","css","appendHtml","applyTransform","degre","hide","val","IncidencePointStyle","_$$line","_$$incidencePoint","Circle","strokeWidth","CONFIG","halfY","_$$lineGroup","_lineGroupUuid","_$$lintWhite","_arrow","_fwBtn","_lightType","_onLightMove","_showRotate","onLightMove","showRotate","_$$offsetPoint","arrowType","initArrowPos","_$$lintClick","clickWidth","_$$whiteRect","_fwBtnInvisible","initView","listner","_moveListener","initNamePos","setArrowPos","getArrowPos","setFwBtnVisible","setClickAble","clickable","fwBtnMove","getRotatePos","setCommonFill","restoreFill","setNameEnable","getNameEnable","setLineEnable","makeNameViewAround","aroundLineAngle","getLightType","triggerMoveBtn","getScale","fwBtnTranslate","originalRect","svgElem","svgRect","translateX","subY","SurfaceIn","MultipleText","_lineHeight","_$$texts","lineHeight","lines","appendLine","line","center","lastIsAngle","$$text","content","getContent","remove","SectorStyle","anglePaddingLeft","NameGroup","_nameVisible","_lightHeight","_reflectorType","_nameAutoPos","_status","nameAutoPos","mtAngle","mtName","mtInvisibleAngle","angleLetter","mtAngleLetter","angleStr","getAngle","actualAngle","setNormalAngle","normalAngle","_normalAngle","nagative","__getIndex","sub","_rotate","sphereAngle","updatePosByType","isNameVertical","setNameStatusAndVisible","isSurfaceAngle","setAngleVisibleByType","getAngleIsValidByType","getHasDrawStatus","setHasDrawStatus","status","setHasDrawStatusByType","getHasDrawStatusByType","getAngleVisibilityByType","NormalLineStyle","_domEvent","_pointVisible","_lineVisible","_$$nameDown","downWidth","nameWidth","setPointNameVisibility","setLineVisibility","showAll","getLineVisible","getPointNameVisible","PedalStyle","PedalLine","$$line","plusDrawer","getDrawer","moveTo","lineTo","_$$sector","_$$sectorBorder","_startAngle","_endAngle","_cx","_cy","_r","absEndAngle","absStartAngle","SurfaceStyle","_$$surface","_onSurfaceMove","_fwSurface","intOriginalFwBtnPos","isRight","offset","Config","incidenceR","reflectionR","surfaceR","IncidencePointVisible","PedalLineVisible","LightComplexDraw","_hasDrawBegin","_hasDrawNext","setDrawBegin","hasDrawBegin","_configData","setSectorInsideDrawStatus","_drawCommand","hasNextWidthOutVisibilityStatus","initDrawCommand","_hsdrawIncidencePoint","fadeIn","fadeOut","_normalLine","setSectorVisibilityByType","getSectorEnable","_surfaceInSector","_incidenceLine","_incidenceSector","_pedalLine","_reflectionSector","_reflectionLine","_surfaceOutSector","resetLinePos","sectorAnimateDisappear","getSectorHasDraw","initDrawStatus","hasDrawFuns","pedalDrawIndex","getHasDrawIncidencePoint","Draw","incidencePoint","LightComplexEvent","surfaceAngleVisibleHandler","setSectorVisibilityByOutSideLogic","normalAngleVisibleHandler","getNameGroup","DrawCommand","MinAngle","_staticLines","_linePedalChangeLock","_lineMoveListener","initBtns","initVisibleState","initDomEvent","appendPosX","createSector","appendSector","reflectionTranslateX","translateY","normalTranslateX","lineConfig","setLineMoveListener","lineMoveListener","initSectorVisibleState","gtIndexSectorAppendToView","bringTop","_surfaceAngle","incidenceAngle","reflectionAngle","incidenceAngleAbs","halfAngle","holdAngle","negative","resetSectorAngle","setIncidence0180View","originalPos","lineRotateAble","autoAngle","subReflectionAngle","subIncidenceAngle","setSectorVisibility","syncSectorVisibilityByName","surfaceInSectorAngle","surfaceRotateX","getSectorOutSideVisibilityByType","normalLineAngle","_onViewClickListener","proxyApi","sector","namePos","NamePos","_lastMinLine","initLineNamePos","toFixed","sectorAngle","normalAbsAngle","linePercent","anglePercent","get0T360Angle","getSphereAngle","lineRotateAngle","LightComplexProxyApi","common","getReflectionLineVisible","getIncidenceLineXAngle","getNormalLineXAngle","getSectorInLineXAngle","lineRotate","normalRotate","getSectorOutLineXAngle","getIncidenceLineSphereAngle","getReflectionLineSphereAngle","getNormalLineSphereAngle","getLineQuad","incidenceRotate","reflectionRotate","LightComplexSector","_sector","_sectorEnable","_currentVisibleStatus","_sectorHasDraw","sectorNameData","_nameGroup","sectorEach","startXAngle","endXAngle","startLineType","endLineType","_getPos","xAngle","quad","setSectorOpacity","LightReflector","setLogLevel"],"mappings":"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","file":"light.min.js","sourcesContent":["//version=1.0\r\n(function(window,document,$){\r\n/**\r\n * 简易模块化加载器\r\n * Created by ylf on 2016/7/5.\r\n */\r\n\r\n\r\nvar require, define;\r\n(function () {\r\n    var defined = {}, defineWaiting = {};\r\n\r\n    var callDeps = function (key) {\r\n        if (key) {\r\n            key = key.toLowerCase();\r\n        }\r\n        if (defineWaiting[key]) {\r\n            var df = defineWaiting[key];\r\n            delete defineWaiting[key];\r\n            var args = [];\r\n            for (var i = 0; i < df.deps.length; i++) {\r\n                var depName = df.deps[i];\r\n                args[i] = callDeps(depName);\r\n            }\r\n            var ret = df.callback.apply(df.callback, args);\r\n            defined[key] = ret;\r\n        }\r\n\r\n        return defined[key];\r\n    };\r\n\r\n    define = function (key, deps, callback) {\r\n        if (key) {\r\n            key = key.toLowerCase();\r\n        }\r\n        if (!(deps instanceof Array)) {\r\n            callback = deps;\r\n            deps = [];\r\n        }\r\n        if (defineWaiting[key]) {\r\n            throw  new Error('the key already has been  used');\r\n        }\r\n        defineWaiting[key] = {\r\n            'deps': deps,\r\n            'callback': callback,\r\n            'module': null\r\n        };\r\n    };\r\n\r\n    require = function (key) {\r\n        return callDeps(key);\r\n    };\r\n\r\n})();\r\n\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/base/base', [], function () {\r\n    var Logger = require('js/utils/logger');\r\n\r\n    var include = function (baseCls, cls) {\r\n        for (var key in cls) {\r\n            if (typeof baseCls[key] !== \"undefined\" && key !== '__base') {\r\n                if (!baseCls.__overwrite || baseCls.__overwrite.indexOf(key) < 0) {\r\n                    //Logger.error('有重复的成员', key);\r\n                    Logger.debug('有重复的成员', key);\r\n                }\r\n            }\r\n            baseCls[key] = cls[key];\r\n        }\r\n        return baseCls;\r\n    };\r\n\r\n    var proxy = function (thisobj, fn) {\r\n        return function () {\r\n            return fn.apply(thisobj, arguments);\r\n        };\r\n    };\r\n\r\n    /**\r\n     * {\r\n                key: '',//key\r\n                fucs: '',//方法名\r\n                params: []//参数说明\r\n            }\r\n     */\r\n\r\n    var Base = {\r\n        ___eventBus: null,\r\n        ___eventsInfo: [{\r\n            key: '',//key\r\n            callback: '',//方法名\r\n            params: []//参数说明\r\n        }],\r\n        __base: function (eventBus, eventsInfo) {\r\n            this.___eventsInfo = null;\r\n            this.___eventBus = null;\r\n\r\n            var args = Array.prototype.slice.apply(arguments, [0]);\r\n            if (args.length > 2) {\r\n                throw  new Error('参数长度有误');\r\n            }\r\n            for (var i = 0; i < args.length; i++) {\r\n                var arg = args[i];\r\n                if (arg instanceof Array) {\r\n                    this.___eventsInfo = arg;\r\n                } else if (typeof  arg === 'object') {\r\n                    this.___eventBus = eventBus;\r\n                }\r\n            }\r\n\r\n            this.___eventBus = this.___eventBus || {};\r\n            this.___eventsInfo = this.___eventsInfo || [];\r\n\r\n            //__addEvent;\r\n            for (var i = 0; i < this.___eventsInfo.length; i++) {\r\n                var event = this.___eventsInfo[i];\r\n                var type = event.key;\r\n                if (typeof event.callback === 'string') {\r\n                    this.___eventBus.on(type, this[event.callback], this);\r\n                } else {\r\n                    this.___eventBus.on(type, event.callback, this);\r\n                }\r\n            }\r\n        },\r\n        __include: function (cls) {\r\n            return include(this, cls);\r\n        },\r\n        __proxyAll: function (callback) {\r\n            for (var i = 0; i < callback.length; i++) {\r\n                if (typeof callback[i] === 'string') {\r\n                    this[callback[i]] = proxy(this, this[callback[i]]);\r\n                }\r\n            }\r\n        },\r\n        __on: function (key, callback, params) {\r\n            this.___eventsInfo.push({\r\n                key: key,//key\r\n                callback: callback,//方法名\r\n                params: params//参数说明\r\n            });\r\n\r\n            if (typeof callback === 'string') {\r\n                this.___eventBus.on(key, this[callback], this);\r\n            } else {\r\n                this.___eventBus.on(key, callback, this);\r\n            }\r\n        },\r\n        __triggerEvent: function (type) {\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            this.___eventBus.trigger.apply(this.___eventBus, arg);\r\n        },\r\n        __getEventBus: function () {\r\n            return this.___eventBus;\r\n        },\r\n        __destroy: function () {\r\n            var eventsInfo = this.___eventsInfo;\r\n            for (var i = 0; i < eventsInfo.length; i++) {\r\n                var event = eventsInfo[i];\r\n                var type = event.key;\r\n                if (typeof event.callback === 'string') {\r\n                    this.___eventBus.off(type, this[event.callback], this);\r\n                } else {\r\n                    this.___eventBus.off(type, event.callback, this);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    return function (cls) {\r\n        return Object.create(Base).__include(cls);\r\n    };\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 全局颜色配置\r\n */\r\ndefine('js/config/color', [], function () {\r\n\r\n\r\n    var color = {};\r\n    color['transparent'] = kity.Color.createRGBA(0, 0, 0, 0);\r\n    color['node_stroke_normal'] = kity.Color.createRGB(115, 161, 191);\r\n    color['node_stroke_active'] = kity.Color.createRGB(57, 80, 96);\r\n    color['backgroud_color'] = kity.Color.parse('#C0D3E2');\r\n    color['line_color'] = kity.Color.parse('#666564');\r\n\r\n    return color;\r\n})\n/**\r\n * Created by ylf on 2016/7/26.\r\n * 事件key\r\n */\r\ndefine('js/config/eventKey', [], function () {\r\n\r\n\r\n    var EventKey = {\r\n        Blur: 'Blur',\r\n        DomEvent: 'DomEvent',\r\n        SurfaceAngleVisible: 'SurfaceAngleVisible',\r\n        NormalAngleVisible: 'NormalAngleVisible',\r\n        NameVisible: 'NameVisible',\r\n        ZIndexChange: 'ZIndexChange',\r\n        LightLineVisible: 'LightLineVisible',\r\n        MoveBtn: 'MoveBtn',\r\n        BtnMove: 'BtnMove'\r\n    };\r\n\r\n    return EventKey;\r\n})\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 全局颜色配置\r\n */\r\ndefine('js/config/lang', [], function () {\r\n\r\n    var lang = {\r\n        'rf_incidence_line_name': '入射光线',\r\n        'rf_incidence_angle': '入射角',\r\n        'rf_incidence_point': '入射点O',\r\n        'rf_normal_name': '法线N',\r\n        'rf_reflection_line_name': '反射光线',\r\n        'rf_reflection_angle': '反射角',\r\n        'rf_reflection_surface': '反射面',\r\n        'rf_equal_angle_name': '反射角=入射角=0°'\r\n    };\r\n\r\n\r\n    return lang;\r\n})\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 全局颜色配置\r\n */\r\ndefine('js/config/style', ['js/config/color'], function () {\r\n\r\n    var fontClass = {\r\n        black: 'svg_text color_black',\r\n        green: 'svg_text color_green',\r\n        blue: 'svg_text color_blue',\r\n        red: 'svg_text color_red',\r\n        orange: 'svg_text color_orange',\r\n        purple: 'svg_text color_purple',\r\n        roman: ' roman'\r\n    };\r\n\r\n    var style = {};\r\n\r\n\r\n    style.LineStyle = {\r\n        strokeStyle: {'stroke-width': 2.5, 'stroke': kity.Color.parse('#ffffff')},\r\n        rectHeight: 8,\r\n        btnRotate: {width: 60, height: 60},\r\n        arrow: {width: 34, height: 45},\r\n        on: 'on',\r\n        //commonLineFill: kity.Color.parse('#794F78'),\r\n        //commonArrowCls: 'arrow_purple',\r\n        commonLineFill: kity.Color.parse('#CB1F1F'),\r\n        commonArrowCls: 'arrow_red',\r\n        IncidenceLine: {\r\n            fill: kity.Color.parse('#005798'),\r\n            fontClass: fontClass.blue,\r\n            arrowClass: 'arrow_blue'\r\n        },\r\n        ReflectionLine: {\r\n            fill: kity.Color.parse('#CB1F1F'),\r\n            fontClass: fontClass.red,\r\n            arrowClass: 'arrow_red'\r\n        },\r\n        Reverse: {\r\n            fill: kity.Color.parse('#09924D'),\r\n            fontClass: fontClass.green,\r\n            arrowClass: 'arrow_red'\r\n        }\r\n    };\r\n\r\n    style.Sector = {\r\n        strokeStyle: {'stroke-width': 1, 'stroke': kity.Color.parse('#7595AC')},\r\n        //surfaceFill: kity.Color.parse('#C2B69C'),\r\n        //normalFill: kity.Color.parse('#8DB8A7'),\r\n        surfaceFill: kity.Color.createRGBA(213, 139, 34, 0.35),\r\n        incidenceFill: kity.Color.createRGBA(204, 131, 255, 0.35),\r\n        reflectionFill: kity.Color.createRGBA(60, 143, 65, 0.35),\r\n        incidenceFontClass: fontClass.purple,\r\n        reflectionFontClass: fontClass.green,\r\n        surfaceFontClass: fontClass.orange,\r\n        incidenceLetterClass: fontClass.purple + fontClass.roman + ' svg_letter',\r\n        reflectionLetterClass: fontClass.green + fontClass.roman + ' svg_letter'\r\n    };\r\n\r\n    style.NormalLine = {\r\n        strokeStyle: {'stroke-width': 4, 'stroke': kity.Color.parse('#4D4D4D')},\r\n        fontClass: fontClass.black,\r\n        pointWidth: 5,\r\n        pointFill: kity.Color.parse('#CB1F1F')\r\n    };\r\n\r\n    style.IncidencePoint = {\r\n        width: 9,\r\n        fill: kity.Color.parse('#FFE012')\r\n    };\r\n\r\n    style.Surface = {\r\n        height: 19,\r\n        surfaceClass: 'wall_tl',\r\n        fontClass: fontClass.black,\r\n        btnRotate: {width: 60, height: 60}\r\n    };\r\n\r\n    style.Pedal = {\r\n        strokeStyle: {'stroke-width': 5, 'stroke': kity.Color.parse('#04740b')},\r\n        width: 35\r\n    };\r\n\r\n    style.EqualAngleName = {\r\n        fontClass: fontClass.green\r\n    };\r\n\r\n    return style;\r\n})\n/**\r\n * 点击事件 create by ylf 2016/7/5\r\n */\r\nvar gloInitJqEvent = function () {\r\n    var supportTouch = 'ontouchend' in document;\r\n    var isMobile = navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false;\r\n    var vEventHandler = {};\r\n    if (supportTouch && isMobile) {\r\n        //拥有触屏事件\r\n        vEventHandler.mouseDown = 'touchstart';\r\n        vEventHandler.mouseUp = 'touchend';\r\n        vEventHandler.mouseWheel = 'touchmove';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.originalEvent.changedTouches[0].clientY;\r\n        };\r\n    } else {\r\n        //没有触屏幕事件\r\n        vEventHandler.mouseDown = 'mousedown';\r\n        vEventHandler.mouseUp = 'mouseup';\r\n        vEventHandler.mouseWheel = 'mousewheel';\r\n        vEventHandler.getEventX = function (event) {\r\n            return event.clientX;\r\n        };\r\n        vEventHandler.getEventY = function (event) {\r\n            return event.clientY;\r\n        };\r\n    }\r\n\r\n    //点击事件\r\n    $.event.special.lrTap = {\r\n        setup: function () {\r\n            var $that = $(this);\r\n            if (supportTouch && isMobile) {\r\n                var vMouseDown = vEventHandler.mouseDown;\r\n                var vMouseUp = vEventHandler.mouseUp;\r\n                var _start = 0;\r\n                var _startX = 0;\r\n                var _startY = 0;\r\n                $that.bind(vMouseDown, function (event) {\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        _start = new Date().getTime();\r\n                        _startX = vEventHandler.getEventX(event);\r\n                        _startY = vEventHandler.getEventY(event);\r\n                    }\r\n                });\r\n                $that.bind(vMouseUp, function (event) {\r\n\r\n                    if (event.which !== 0 || event.which !== 1) {\r\n                        var end = new Date().getTime();\r\n                        var endX = vEventHandler.getEventX(event);\r\n                        var endY = vEventHandler.getEventY(event);\r\n                        var holdTime = end - _start;\r\n                        var dx = Math.abs(endX - _startX);\r\n                        var dy = Math.abs(endY - _startY);\r\n                        if (holdTime <= 550 && dx < 8 && dy < 8) {\r\n                            //触发tap事件\r\n                            event = $.event.fix(event);\r\n                            event.type = 'lrTap';\r\n                            event.tapEventSource = 'touchclick';\r\n                            event.tapFireTouch = true;\r\n                            $that.triggerHandler(event);\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                $that.bind('click', function (event) {\r\n                    //触发tap事件\r\n                    event = $.event.fix(event);\r\n                    event.type = 'lrTap';\r\n                    event.tapEventSource = 'mouseclick';\r\n                    event.tapFireTouch = false;\r\n                    //白板手写笔点击触发touch事件\r\n                    if (event.originalEvent && event.originalEvent.sourceCapabilities && event.originalEvent.sourceCapabilities.firesTouchEvents) {\r\n                        event.tapFireTouch = true;\r\n                    }\r\n                    $that.triggerHandler(event);\r\n                });\r\n            }\r\n        },\r\n        teardown: function () {\r\n            var vMouseDown = vEventHandler.mouseDown;\r\n            var vMouseUp = vEventHandler.mouseUp;\r\n            var $that = $(this);\r\n            $that.unbind(vMouseUp).unbind(vMouseDown);\r\n        }\r\n    };\r\n\r\n};\r\n\r\ngloInitJqEvent();\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/reflector/baseReflector', ['js/base/base'], function (Base) {\r\n\r\n    var BaseReflector = {\r\n        _lightComplexArray: null,//光组件合集\r\n        __overwrite: ['createView', 'drawAll', 'drawNext', 'getData'],\r\n        __base: function (eventbus, eventsInfo) {\r\n            var args = Array.prototype.slice.apply(arguments, [0]);\r\n            Base({}).__base.apply(this, args);\r\n        },\r\n        createView: function () {\r\n\r\n        },\r\n        updatePos: function () {\r\n            this._lightComplexArray.updatePos();\r\n        },\r\n        drawAll: function () {\r\n            this._lightComplexArray.drawAll();\r\n        },\r\n        drawNext: function () {\r\n            this._lightComplexArray.drawNext();\r\n        },\r\n        hasNext: function () {\r\n            return this._lightComplexArray.hasNext();\r\n        },\r\n        getData: function () {\r\n\r\n        },\r\n        getType: function () {\r\n            return this._TYPE;\r\n        },\r\n        getNameVisible: function () {\r\n            return this._option.nameVisible;\r\n        },\r\n        pushEvent: function (eventInfo) {\r\n            this._event.push(eventInfo);\r\n            this.__proxyAll([eventInfo.callback]);\r\n        }\r\n    };\r\n\r\n\r\n    return function (cls) {\r\n        return Base(BaseReflector).__include(cls);\r\n    };\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/reflector/btns', ['js/base/Base', 'js/utils/string', 'js/utils/utils', 'js/config/eventKey', 'js/utils/view'], function (Base, String, Utils, EventKey, View) {\r\n\r\n    var ForeignView = require('js/view/foreignview');\r\n    var Svg = require('js/utils/svg');\r\n    var DomEvent = require('js/reflector/domEvent');\r\n    var LineStyle = require('js/config/style').LineStyle;\r\n\r\n    var Btns = Base({\r\n        _fwRotateBtns: [],\r\n        _g: null,\r\n        _id: '',\r\n        _lineUuid: '',\r\n        _reflector: null,\r\n        create: function (eventBus, reflector, count) {\r\n            var instance = Object.create(this);\r\n            var eventsInfo = [];\r\n            instance._id = Utils.getUuid();\r\n            instance._fwRotateBtns = {};\r\n            instance._reflector = reflector;\r\n            instance.__base(eventBus, eventsInfo);\r\n            instance.initRotateBtn(count);\r\n            return instance;\r\n        },\r\n        initRotateBtn: function (count) {\r\n            //旋转按钮\r\n            var that = this,\r\n                fwRotate,\r\n                i;\r\n\r\n            that._g = new kity.Group();\r\n\r\n            for (i = 0; i < count; i++) {\r\n                fwRotate = ForeignView.create('btn_rotate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n                this._fwRotateBtns[i] = fwRotate;\r\n                // fwRotate.setVisibility(false);\r\n                DomEvent.addDomEvent(fwRotate.getView()[0], ['down', 'beforemove', 'move', 'aftermove', 'up'], fwRotate.getUuid(), false, false);\r\n                //append to reflector\r\n\r\n                $(that._g.node).append(fwRotate.getView());\r\n                this.__on(fwRotate.getUuid(), function (eventType, selfId, data) {\r\n                    var fwRotate = getFwRotateBySelfId.apply(that, [selfId]);\r\n                    if (eventType === 'down') {\r\n                        fwRotate.addClass('on');\r\n                    } else if (eventType === 'aftermove' || eventType === 'up') {\r\n                        fwRotate.removeClass('on');\r\n                        fwRotate.getView().blur();\r\n                    }\r\n                    var lineId = fwRotate.__lineUuid;\r\n                    that.__triggerEvent(EventKey.BtnMove + lineId, eventType, lineId, data);\r\n                }, '');\r\n                fwRotate.setVisibility(false)\r\n            }\r\n            // this._reflector.addShape(g);\r\n        },\r\n        getView: function () {\r\n            return this._g;\r\n        },\r\n        appendToView: function ($$container) {\r\n            $$container.addShape(this._g);\r\n        },\r\n        moveBtnEventHandler: function (scale, clientRect, uuid, visible) {\r\n            var fwRotate = getFwRotateByLineId.apply(this, [uuid]);\r\n            var pLeft = clientRect.left + clientRect.width / 2;\r\n            var pTop = clientRect.top + clientRect.height / 2;\r\n            var rect = fwRotate.getView()[0].getBoundingClientRect();\r\n            var rLeft = rect.left + rect.width / 2;\r\n            var rTop = rect.top + rect.height / 2;\r\n\r\n            var transforms = Svg.getAttrTranslate(fwRotate.getView().attr('transform'));\r\n            //pos 针对于整个page的位置\r\n            if (transforms && transforms.length == 2) {\r\n                fwRotate.setTranslate(transforms[0] + (pLeft - rLeft) / scale, transforms[1] + (pTop - rTop) / scale);\r\n            } else {\r\n                fwRotate.setTranslate((pLeft - rLeft) / scale, (pTop - rTop) / scale);\r\n            }\r\n\r\n            fwRotate.setVisibility(true);\r\n        }\r\n    });\r\n\r\n    var getFwRotateBySelfId = function (selfId) {\r\n        var i,\r\n            fwRotateBtns = this._fwRotateBtns,\r\n            key,\r\n            fwRotate;\r\n\r\n        for (key in fwRotateBtns) {\r\n            fwRotate = fwRotateBtns[key];\r\n            if (fwRotate.getUuid() === selfId) {\r\n                return fwRotate;\r\n            }\r\n        }\r\n    };\r\n\r\n    var getFwRotateByLineId = function (lineId) {\r\n        var i,\r\n            fwRotateBtns = this._fwRotateBtns,\r\n            key\r\n\r\n        if (fwRotateBtns[lineId]) {\r\n            fwRotateBtns[lineId].__lineUuid = lineId;\r\n            return fwRotateBtns[lineId];\r\n        }\r\n\r\n        for (key in fwRotateBtns) {\r\n            if (/^\\d+$/.test(key)) {\r\n                fwRotateBtns[lineId] = fwRotateBtns[key];\r\n                fwRotateBtns[lineId].__lineUuid = lineId;\r\n                delete fwRotateBtns[key];\r\n                return fwRotateBtns[lineId];\r\n            }\r\n        }\r\n    }\r\n\r\n    return Btns;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/reflector/domEvent', ['js/base/Base', 'js/config/EventKey', 'js/utils/eventUtils'], function (Base, EventKey, EventUtils) {\r\n\r\n    var Logger = require('js/utils/logger');\r\n\r\n    var DomEvent = Base({\r\n        _$$paper: null,\r\n        _$$paperItems: [],\r\n        _option: null,\r\n        _eventInfo: [],\r\n        create: function (paper, eventBus, option) {\r\n            var instance = Object.create(this);\r\n            instance.__base(eventBus, []);\r\n            instance._option = option;\r\n            instance._$$paper = paper;\r\n            return instance;\r\n        },\r\n        bindDomEvent: function () {\r\n            this._domEvents();\r\n            $(this._$$paper.node).on(' lrTap  mousedown  mouseup mousemove mouseleave touchstart touchmove touchend touchcancel', this._domEvents);\r\n        },\r\n        _getEventInfo: function (e) {\r\n            var eventInfo = [];\r\n            e = e.originalEvent || e;\r\n            var $target = $(e.srcElement);\r\n            if (!$target.hasClass('_lr_event')) {\r\n                $target = $target.closest('._lr_event');\r\n            }\r\n            while ($target.length > 0) {\r\n                eventInfo.push({\r\n                    uuid: $target.data('event-identifier'),\r\n                    eventType: $target.data('event-type')\r\n                });\r\n                if ($target.data('event-stoppropagation') === false || $target.data('event-stoppropagation') === 'false') {\r\n                    var parent = $target.parent();\r\n                    if (parent.hasClass('_lr_event')) {\r\n                        $target = parent;\r\n                    } else {\r\n                        $target = parent.closest('._lr_event');\r\n                    }\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n            return eventInfo;\r\n        },\r\n        _initEventInfo: function (e) {\r\n            this._eventInfo = this._getEventInfo(e);\r\n        },\r\n        _clearEventInfo: function (e) {\r\n            this._eventInfo = null;\r\n        },\r\n        _events: function (e) {\r\n            var that = this;\r\n            var type = e.mType;\r\n            if (type !== 'move') {\r\n                Logger.debug('domevent-self', type);\r\n            }\r\n\r\n            //交给各自职责的事件处理\r\n            switch (e.mType) {\r\n                case 'lrTap':\r\n                    this._initEventInfo(e);\r\n                    // if (this._eventInfo == null || this._eventInfo.length <= 0) {\r\n                    //     this.__triggerEvent(EventKey.Blur);\r\n                    // } else {\r\n                    //     //只触发第一个\r\n                    //     this.__triggerEvent(EventKey.Blur, this._eventInfo[0].uuid);\r\n                    // }\r\n                    break;\r\n                case 'down':\r\n                    this._initEventInfo(e);\r\n                    if (this._eventInfo == null || this._eventInfo.length <= 0) {\r\n                        this.__triggerEvent(EventKey.Blur);\r\n                    } else {\r\n                        //只触发第一个\r\n                        this.__triggerEvent(EventKey.Blur, this._eventInfo[0].uuid);\r\n                    }\r\n                    break;\r\n                case 'beforemove':\r\n                    break;\r\n                case 'move':\r\n                    break;\r\n                case 'aftermove':\r\n                    break;\r\n                //case 'up':\r\n                //    this._clearEventInfo(e);\r\n                //    break;\r\n            }\r\n\r\n            if (this._eventInfo) {\r\n\r\n                this._eventInfo.forEach(function (info) {\r\n                    if (info.eventType.indexOf(type) > -1) {\r\n                        that.__triggerEvent(info.uuid, type, info.uuid, {\r\n                            moveAbs: e.mMoveAbs,\r\n                            currentPos: e.mCurrentPos,\r\n                            lastPos: e.mLastPos\r\n                        });\r\n                    }\r\n                })\r\n\r\n            }\r\n            //交给各自职责的事件处理\r\n            switch (e.mType) {\r\n                case 'up':\r\n                    this._clearEventInfo(e);\r\n                    break;\r\n            }\r\n        },\r\n        _domEvents: function () {\r\n            var that = this;\r\n            var _downTrigger = false;\r\n            var _touchTrigger = false;\r\n            var _moveTrigger = false;\r\n            var _startTime = 0;\r\n            var _startPos = {};\r\n            var _moveLastPos = {};\r\n\r\n            var __domEvents = function (e) {\r\n                if (that._option.lock) {\r\n                    return;\r\n                }\r\n                var type = e.type || '';\r\n\r\n                if (type !== 'mousemove' && type !== 'touchmove') {\r\n                    Logger.debug('domevent-original', type);\r\n                }\r\n\r\n                switch (type) {\r\n                    case 'mousedown':\r\n                    case 'touchstart':\r\n                        _startTime = new Date().getTime();\r\n                        if (type === 'mousedown') {\r\n                            _startPos = EventUtils.getPagePos(e);\r\n                        }\r\n\r\n                        _downTrigger = true;\r\n                        _moveTrigger = false;\r\n                        if (type === 'touchstart') {\r\n                            _touchTrigger = true;\r\n                        }\r\n                        e.mType = 'down';\r\n                        break;\r\n                    case 'mousemove':\r\n                    case 'touchmove':\r\n                        if (!_downTrigger) {\r\n                            return;\r\n                        }\r\n                        //缩放时不处理move事件\r\n                        e.preventDefault();\r\n                        var p = EventUtils.getPagePos(e);\r\n                        e.mLastPos = _moveLastPos;\r\n                        e.mCurrentPos = p;\r\n                        var x = p.x - _moveLastPos.x;\r\n                        var y = p.y - _moveLastPos.y;\r\n                        e.mMoveAbs = {\r\n                            x: x,\r\n                            y: y\r\n                        };\r\n\r\n                        e.mxj = parseFloat(_moveLastPos.x * p.y) - parseFloat(p.x * _moveLastPos.y);//叉积\r\n                        if (x !== 0 || y !== 0) {\r\n                            if (!_moveTrigger) {\r\n                                e.mType = 'beforemove';\r\n                                that._events(e);\r\n                            }\r\n                            e.mType = 'move';\r\n                            _moveTrigger = true;\r\n                        }\r\n                        break;\r\n                    case 'touchend':\r\n                    case 'touchcancel':\r\n                    case 'mouseup':\r\n                    case 'mouseleave':\r\n                        if (_moveTrigger) {\r\n                            e.mType = 'aftermove';\r\n                            that._events(e);\r\n                        }\r\n                        e.mMoveTrigger = _moveTrigger;\r\n                        _moveTrigger = false;\r\n                        _downTrigger = false;\r\n\r\n                        e.mType = 'up';\r\n                        break;\r\n                    case 'lrTap':\r\n                        e.mType = type;\r\n\r\n                        //是否有touch事件触发\r\n                        if (e.tapEventSource === 'touchclick' || (e.tapEventSource === 'mouseclick' && _touchTrigger)) {\r\n                            e.mTouchTrigger = true;\r\n                        } else {\r\n                            e.mTouchTrigger = false;\r\n                        }\r\n                        _touchTrigger = false;\r\n                        //修复点击事件，超过时间和坐标不触发点击事件\r\n                        if (e.tapEventSource === 'mouseclick') {\r\n                            var fixed = EventUtils.fixPcClick(_startPos, EventUtils.getPagePos(e), _startTime, new Date().getTime());\r\n                            if (!fixed) {\r\n                                return;\r\n                            }\r\n                        }\r\n                        break;\r\n                    default:\r\n                        e.mType = type;\r\n                        break;\r\n                }\r\n                that._events(e);\r\n\r\n                //保存最后一次移动的位置\r\n                if (EventUtils.isMove(type) || EventUtils.isDown(type)) {\r\n                    _moveLastPos = EventUtils.getPagePos(e);\r\n                }\r\n            };\r\n            that._domEvents = __domEvents;\r\n        }\r\n    });\r\n\r\n    /**\r\n     * 添加事件\r\n     * @param dom\r\n     * @param domEvent 要添加的事件名称组数\r\n     * @param identifier dom标识符\r\n     */\r\n    DomEvent.addDomEvent = function (dom, domEvent, identifier, stopPropagation) {\r\n        if (domEvent && domEvent.length > 0) {\r\n            if (typeof stopPropagation === typeof undefined) {\r\n                stopPropagation = true;\r\n            }\r\n            $(dom).attr('class', '_lr_event');\r\n            $(dom).data('event-type', domEvent);\r\n            $(dom).data('event-identifier', identifier);\r\n            $(dom).data('event-stoppropagation', stopPropagation);\r\n        }\r\n    };\r\n\r\n    return DomEvent;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/reflector/LightComplexArray', ['js/base/base', 'js/utils/utils'], function (Base, Utils) {\r\n\r\n    //view\r\n    var LightComplex = require('js/reflector/LightComplex/main');\r\n    var LightLine = require('js/view/LightLine');\r\n\r\n    var LightComplexArray = Base({\r\n        _lightArray: [],//节点\r\n        _lightEnable: [],//节点是否可用\r\n        _lightDrawBefore: [],//节点是否已经开始绘制\r\n        _chainMode: false,//点之间是否是链式的调用关系\r\n        _currentHighZIndex: 0,//处在高位的索引值\r\n        create: function (eventBus, config, option, onLineMove, chainMode, reflectorType) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            //事件绑定\r\n            instance.__base(eventBus, []);\r\n            instance._config = config;\r\n            instance._lightArray = [];\r\n            instance._lightDrawBefore = [];\r\n            instance._lightEnable = [];\r\n            instance._chainMode = chainMode || false;\r\n            instance.createView(onLineMove, option, reflectorType);\r\n            instance.initZIndexEvent();\r\n            return instance;\r\n        },\r\n        createView: function (onLineMove, option, reflectorType) {\r\n            var that = this;\r\n            this._config.forEach(function (config, i) {\r\n                var lightComplex = LightComplex.create(that.__getEventBus(), config, onLineMove, option, reflectorType);\r\n                that._lightArray.push(lightComplex);\r\n                lightComplex.setVisibility(config.Visible);\r\n                that._lightEnable[i] = config.Visible;\r\n                that._lightDrawBefore[i] = config.Visible;\r\n            });\r\n        },\r\n        appendToView: function ($$container) {\r\n            this.each(function () {\r\n                $$container.addShape(this.getView());\r\n            });\r\n        },\r\n        gtIndexAppendToView: function ($$container) {\r\n            this.each(function () {\r\n                this.gtIndexAppendToView($$container);\r\n            });\r\n            this.each(function () {\r\n                this.bringBtnToTop();\r\n            });\r\n        },\r\n        btnStillInBox: function () {\r\n            this.each(function () {\r\n                this.btnStillInBox();\r\n            })\r\n        },\r\n        each: function (callBack, index) {\r\n            var that = this;\r\n            this._lightArray.forEach(function (lightComplex, i) {\r\n                var call = true;\r\n                if (that.indexValidate(index)) {\r\n                    call = index === i;\r\n                }\r\n                if (call) {\r\n                    callBack.apply(lightComplex, [i]);\r\n                }\r\n            })\r\n        },\r\n        indexValidate: function (index) {\r\n            return typeof index !== typeof  undefined && index < this._lightArray.length;\r\n        },\r\n        getCommandLength: function (index) {\r\n            return this._lightArray[index || 0].getCommandLength();\r\n        },\r\n        pushDrawCommand: function (command, hasDrawCommand, index) {\r\n            this.each(function (i) {\r\n                this.pushDrawCommand(command, hasDrawCommand);\r\n            }, index);\r\n        },\r\n        setPedalDrawIndex: function (pedalIndex, index) {\r\n            this.each(function (i) {\r\n                this.setPedalDrawIndex(pedalIndex);\r\n            }, index);\r\n        },\r\n        setDrawIndex: function (drawIndex, index) {\r\n            this.each(function (i) {\r\n                this.setDrawIndex(drawIndex);\r\n            }, index);\r\n        },\r\n        resetAngle: function (surfaceAngle, init, index) {\r\n            this.each(function (i) {\r\n                this.resetAngle(surfaceAngle, init);\r\n            }, index);\r\n        },\r\n        changeChainLineCommonFill: function () {\r\n            if (!this._chainMode) {\r\n                return;\r\n            }\r\n            var that = this;\r\n            this.each(function (i) {\r\n                var hasNext = true;\r\n                if ((i + 1) >= that._lightArray.length) {\r\n                    hasNext = false\r\n                }\r\n                if (hasNext) {\r\n                    if (i === 0) {\r\n                        this.setReflectionLineCommonFill(that.isEnableAndDraw(i + 1));\r\n                    } else {\r\n                        this.setIncidenceLineCommonFill(that.isEnableAndDraw(i - 1));\r\n                        this.setReflectionLineCommonFill(that.isEnableAndDraw(i + 1));\r\n                    }\r\n                } else {\r\n                    //更新入射光线\r\n                    if (i !== 0) {\r\n                        this.setIncidenceLineCommonFill(that.isEnableAndDraw(i));\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        setCommonLineVisible: function (visible) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                var hasNext = true;\r\n                if ((i + 1) >= that._lightArray.length) {\r\n                    hasNext = false\r\n                }\r\n                if (that.isEnableAndDraw(i)) {\r\n                    if (hasNext) {\r\n                        if (i === 0) {\r\n                            if (that.isEnableAndDraw(i + 1)) {\r\n                                this.setReflectionLineVisible(that._currentHighZIndex === i);\r\n                            }\r\n                        } else if (i === 1) {\r\n                            if (that.isEnableAndDraw(i + 1)) {\r\n                                this.setReflectionLineVisible(that._currentHighZIndex === i);\r\n                            }\r\n                            this.setIncidenceLineVisible(that._currentHighZIndex === i);\r\n                        }\r\n                    } else {\r\n                        //更新入射光线\r\n                        if (i !== 0) {\r\n                            this.setIncidenceLineVisible(true);\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        drawAll: function (index, cb) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                if (that.hasNextEnable(i)) {\r\n                    that._lightArray[i + 1].setVisibility(true);\r\n                    that._lightDrawBefore[i + 1] = true;\r\n                }\r\n\r\n                this.drawAll(function () {\r\n                    //cb && cb();\r\n                });\r\n            }, index);\r\n\r\n            that.changeChainLineCommonFill();\r\n            cb && cb();\r\n        },\r\n        drawNext: function (index, cb) {\r\n            var that = this;\r\n            var hasCall = false;\r\n            this.each(function (i) {\r\n                if (this.hasNext() && !hasCall) {\r\n                    hasCall = true;\r\n                    this.drawNext(function () {\r\n                        cb && cb();\r\n                    });\r\n                }\r\n                if (!hasCall && that.hasNextEnable(i)) {\r\n                    hasCall = true;\r\n                    that._lightArray[i + 1].setVisibility(true);\r\n                    that._lightDrawBefore[i + 1] = true;\r\n                    cb && cb();\r\n                }\r\n            }, index);\r\n            that.changeChainLineCommonFill();\r\n            //if(hasCall){\r\n            //\r\n            //}\r\n        },\r\n        //是否有可用的没有显示\r\n        hasNextEnable: function (i) {\r\n            var that = this;\r\n            if (i + 1 < that._lightArray.length) {\r\n                //可用但是未显示\r\n                if (that._lightEnable[i + 1] === true && that._lightArray[i + 1].isVisibilityHidden()) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        //是否有动画未绘制\r\n        hasDrawNext: function (index) {\r\n            var hasNext = false;\r\n            var that = this;\r\n            this.each(function (i) {\r\n                if (!hasNext) {\r\n                    hasNext = this.hasNext();\r\n                }\r\n            }, index);\r\n            return hasNext;\r\n        },\r\n        hasNext: function (index) {\r\n            var hasNext = false;\r\n            var that = this;\r\n            this.each(function (i) {\r\n                if (!hasNext) {\r\n                    hasNext = this.hasNext();\r\n                }\r\n                if (!hasNext) {\r\n                    hasNext = that.hasNextEnable(i);\r\n                }\r\n            }, index);\r\n            return hasNext;\r\n        },\r\n        setAllEnable: function (enable) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                that._lightEnable[i] = enable;\r\n                if (!enable) {\r\n                    this.setVisibility(false);\r\n                }\r\n                //之前绘制过，且可用，则直接显示出来\r\n                if (that._lightDrawBefore[i] && that._lightEnable[i]) {\r\n                    this.setVisibility(true);\r\n                }\r\n            })\r\n        },\r\n        setEnable: function (index, enable) {\r\n            this._lightEnable[index] = enable;\r\n            //层级较高的被置为不可用了，需要重新指定第一个层级为最高\r\n            if (index === this._currentHighZIndex && enable === false) {\r\n                this.showFirstIndex();\r\n            }\r\n            //之前绘制过，且可用，则直接显示出来\r\n            if (this._lightDrawBefore[index] && this._lightEnable[index]) {\r\n                this._lightArray[index].setVisibility(true);\r\n            }\r\n            //不可用直接隐藏\r\n            if (enable === false) {\r\n                this._lightArray[index].setVisibility(false);\r\n            }\r\n            this.__triggerEvent('insidechange', 'enablechange');\r\n        },\r\n        setSectorEnable: function (enable) {\r\n            this.each(function () {\r\n                this.setSectorEnable(enable);\r\n            })\r\n        },\r\n        //是否可用，且绘制过\r\n        isEnableAndDraw: function (index) {\r\n            return this._lightEnable[index] && this._lightDrawBefore[index];\r\n        },\r\n        getData: function (index) {\r\n            var data = {\r\n                LightComplex: []\r\n            };\r\n            this.each(function () {\r\n                data.LightComplex.push(this.getData());\r\n            }, index);\r\n            return data;\r\n        },\r\n        rotateAble: function (angle, surfaceMove) {\r\n            var that = this;\r\n            var flag = true;\r\n            this.each(function (i) {\r\n                if (flag) {\r\n                    angle = surfaceMove && that._config[i].IncidenceLine.rotateFixed ? -angle : angle;\r\n                    flag = this.complexRotateAble(angle);\r\n                }\r\n            });\r\n            return flag;\r\n        },\r\n        around: function (surfaceAngle, surfaceRotatePosX) {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                this.around(surfaceAngle, surfaceRotatePosX);\r\n            });\r\n        },\r\n        updatePos: function () {\r\n            this.each(function () {\r\n                this.updatePos();\r\n            });\r\n        },\r\n        adsorptionPedal: function () {\r\n            this.each(function () {\r\n                this.adsorptionPedal();\r\n            });\r\n        },\r\n        adsorption: function () {\r\n            this.each(function () {\r\n                this.adsorptionPedal();\r\n                this.adsorptionStatic();\r\n            });\r\n        },\r\n        isPedalExcludeDisable: function (index) {\r\n            var isPedal = true;\r\n            this.each(function () {\r\n                if (!this.isVisibilityHidden()) {\r\n                    if (isPedal) {\r\n                        isPedal = this.isPedal();\r\n                    }\r\n                }\r\n            }, index);\r\n            return isPedal;\r\n        },\r\n        isPedal: function (index) {\r\n            var isPedal = true;\r\n            this.each(function () {\r\n                if (isPedal) {\r\n                    isPedal = this.isPedal();\r\n                }\r\n            }, index);\r\n            return isPedal;\r\n        },\r\n        initZIndexEvent: function () {\r\n            var that = this;\r\n            this.each(function (i) {\r\n                var lightComplex = this;\r\n                //i变量做为参数，防止闭包问题\r\n                (function (i) {\r\n                    lightComplex.setViewTapListener(function () {\r\n                        that._currentHighZIndex = i;\r\n                        that.each(function (j) {\r\n                            this.changeTransparent(i === j);\r\n                        })\r\n                    });\r\n                })(i);\r\n            })\r\n        },\r\n        getCurrentHighZIndex: function () {\r\n            return this._currentHighZIndex;\r\n        },\r\n        showFirstIndex: function () {\r\n            this.each(function (i) {\r\n                this.changeTransparent(i === 0);\r\n            })\r\n        },\r\n        setIncidenceNameEnable: function (nameEnable) {\r\n            this.each(function (i) {\r\n                this.setIncidenceNameEnable(nameEnable);\r\n            })\r\n        },\r\n        setIncidenceNameVisible: function (visible) {\r\n            this.each(function (i) {\r\n                this.setIncidenceNameVisible(visible);\r\n            });\r\n        },\r\n        get: function (index) {\r\n            return this._lightArray[index];\r\n        },\r\n        getDrawBegin: function () {\r\n            return this._lightArray[0].getDrawBegin();\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this.each(function () {\r\n                this.setNameVisible(visible);\r\n            });\r\n        },\r\n        setLinePedalChangeLock: function (lock) {\r\n            this.each(function (i) {\r\n                this.setLinePedalChangeLock(lock);\r\n            })\r\n        },\r\n        getCount: function () {\r\n            return this._lightArray.length;\r\n        }\r\n    });\r\n\r\n    return LightComplexArray;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/reflector/reflector1', ['js/reflector/baseReflector', 'js/utils/utils', 'js/utils/graphMath', 'js/utils/svg'], function (BaseReflector, Utils, GraphMath, Svg) {\r\n\r\n    //view\r\n    var Surface = require('js/view/surface');\r\n    var LightComplexArray = require('js/reflector/LightComplexArray');\r\n    var EqualAngleName = require('js/view/EqualAngleName');\r\n    var EventKey = require('js/config/eventKey');\r\n    var Btns = require('js/reflector/btns');\r\n\r\n    var Reflector = BaseReflector({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    IncidenceLine: {\r\n                        width: 370,//整体长度\r\n                        arrowPos: 140,//箭号所在位置\r\n                        defaultAngle: 60, rotateFixed: false, clickAble: true, rotateFixedAfterDraw: true\r\n                    },\r\n                    ReflectionLine: {\r\n                        visible: false, rotateFixed: false, clickAble: false,\r\n                        width: 370,\r\n                        arrowPos: 140\r\n                    },\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                    Sector: {sectorInVisible: true, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false, letterR: 110, angleR: 180},\r\n                    IncidencePosX: 520 / 2,//入射点位置\r\n                    DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    PedalDrawIndex: [[0, 1, 2], [4, 5, 6], [7, 9, 10]],\r\n                    Visible: true\r\n                }],\r\n            Surface: {\r\n                width: 520,\r\n                defaultAngle: 0,\r\n                rotatePosX: 520 / 2,//旋转位置\r\n                rotatePosY: 4,//旋转位置\r\n                visible: true,\r\n                clickAble: true,\r\n                type: Surface.Type.tl\r\n            }\r\n        },\r\n        _TYPE: 1,\r\n        _Event: [],\r\n        _event: null,\r\n        _$$container: null,\r\n        _incidencePointPos: null,\r\n        _surfacePagePos: null,\r\n        _option: null,\r\n        _equalAngleNameHasShowBefore: false,\r\n        create: function (eventBus, $$container, option, data) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance._event = $.extend(true, [], this._Event);\r\n            instance.initEvent();\r\n            //事件绑定\r\n            instance.__base(eventBus, instance._event);\r\n\r\n            instance.__proxyAll(['onSurfaceMove', 'onLineMove', 'nameVisibleHandler']);//绑定this指针\r\n            instance._$$container = $$container;\r\n            instance._config = $.extend(true, {}, this._CONFIG, (data && data.configData) || {});\r\n            instance._option = option;\r\n            instance.createView();\r\n            instance.afterCreateView();\r\n            instance.initExtrasDrawCommand();\r\n            return instance;\r\n        },\r\n        initEvent: function () {\r\n            //TODO:交由基类处理\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            //反射面\r\n            this._surface = Surface.create(this.__getEventBus(), this._config.Surface, this.onSurfaceMove, this._option.langData);\r\n            if (this._config.Surface.clickAble) {\r\n                this.btns = Btns.create(this.__getEventBus(), this._$$container, 1);\r\n                this._surface.setMoveListener(function (scale, clientRect, uuid, visible) {\r\n                    that.btns.moveBtnEventHandler(scale, clientRect, uuid, visible);\r\n                    that._lightComplexArray.btnStillInBox();\r\n                });\r\n            }\r\n            this._lightComplexArray = LightComplexArray.create(this.__getEventBus(), this._config.LightComplex, this._option, this.onLineMove, false, this._TYPE);\r\n            this._lightComplexArray.appendToView(this._$$container);\r\n\r\n            this._equalAngleName = EqualAngleName.create(this._option.langData);\r\n\r\n            this._$$container.addShape(this._surface.getView());\r\n            this._$$container.addShape(this._equalAngleName.getView());\r\n            this._lightComplexArray.gtIndexAppendToView(this._$$container);\r\n            if (this.btns) {\r\n                this.btns.appendToView(this._$$container);\r\n            }\r\n            this._surface.setNameVisible(this._option.nameVisible);\r\n            if (this._config.EqualAngleName) {\r\n                that._equalAngleNameHasShowBefore = this._config.EqualAngleName.visible;\r\n                this._equalAngleName.setVisibility(this._config.EqualAngleName.visible);\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n            this.resetAngle(this._config.Surface.defaultAngle, true);\r\n\r\n            //从新初始化坐标位置\r\n            this.toCenter();\r\n            //tocenter位置变化后重新结算值\r\n            that._lightComplexArray.btnStillInBox();\r\n            this.initEqualAngleNamePos();\r\n        },\r\n        initExtrasDrawCommand: function () {\r\n            //交由基类处理\r\n            var that = this;\r\n            var length = this._lightComplexArray.getCommandLength();\r\n            this._lightComplexArray.pushDrawCommand(function (deffer) {\r\n                if (that._lightComplexArray.isPedal()) {\r\n                    that._equalAngleNameHasShowBefore = true;\r\n                    that._equalAngleName.setVisibility(true);\r\n                }\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (!that._lightComplexArray.isPedal()) {\r\n                    return true;\r\n                }\r\n                if (!that._equalAngleName.isVisibilityHidden()) {\r\n                    return true;\r\n                }\r\n                return that._equalAngleNameHasShowBefore;\r\n            });\r\n            var pedalIndex = $.extend(true, [], this._config.LightComplex[0].PedalDrawIndex);\r\n            pedalIndex.splice(2, 0, length);\r\n            this._lightComplexArray.setPedalDrawIndex(pedalIndex);\r\n        },\r\n        afterCreateView: function () {\r\n            //TODO:交由子类覆盖\r\n        },\r\n        initEqualAngleNamePos: function () {\r\n            //布局角度\r\n            var width = this._equalAngleName.getView().getWidth(),\r\n                height = this._equalAngleName.getView().getHeight(),\r\n                svgWidth = this._$$container.container.getWidth(),\r\n                containerCTM = this._$$container.node.getCTM(),\r\n                scale = this._$$container.container.node.getCTM().a;\r\n\r\n            var x = svgWidth / scale - containerCTM.e / scale - width - 50;\r\n            var y = containerCTM.f / scale - height;\r\n\r\n            this._equalAngleName.setTranslate(x, -y);\r\n        },\r\n        toCenter: function () {\r\n            this._$$container.setTranslate(this._option.viewPortWidth / 2 - this.getWidth() / 2, this._option.viewPortHeight / 2 + 60);\r\n        },\r\n        resetAngle: function (angle, init) {\r\n            this._surface.rotate(angle);\r\n            var surfaceAngle = this._surface.getRotateAngle() || 0;\r\n            this._lightComplexArray.resetAngle(surfaceAngle, init);\r\n        },\r\n        getData: function () {\r\n            var data = {};\r\n            data.type = this._TYPE;\r\n            data.configData = this._lightComplexArray.getData();\r\n            data.configData.Surface = {\r\n                defaultAngle: this._surface.getRotateAngle(),\r\n                visible: !this._surface.isVisibilityHidden()\r\n            };\r\n            data.configData.EqualAngleName = {\r\n                visible: !this._equalAngleName.isVisibilityHidden()\r\n            };\r\n            return data;\r\n        },\r\n        getMoveRotateAngle: function (data) {\r\n            var currentPos = data.currentPos;\r\n            var lastPos = data.lastPos;\r\n            return GraphMath.getRotateAngle(this._surface.getRotateOffsetPos(), lastPos, currentPos);\r\n        },\r\n        onSurfaceMove: function (data, eventType) {\r\n            if (eventType === 'move') {\r\n                var angle = this.getMoveRotateAngle(data);\r\n                if (this._lightComplexArray.rotateAble(angle)) {\r\n                    this.resetAngle(angle);\r\n                    this._lightComplexArray.around(this._surface.getRotateAngle(), this._config.Surface.rotatePosX);\r\n                }\r\n            } else if (eventType === 'aftermove') {\r\n                this._lightComplexArray.adsorption();\r\n            }\r\n            this.initEqualAngleVisibility();\r\n        },\r\n        onLineMove: function (uuid, angle) {\r\n            this.initEqualAngleVisibility();\r\n            this.afterLineMove();\r\n        },\r\n        afterLineMove: function () {\r\n\r\n        },\r\n        initEqualAngleVisibility: function () {\r\n            //非垂足重置为不可见\r\n            if (this._lightComplexArray.isPedal()) {\r\n                if (this._equalAngleNameHasShowBefore || this._lightComplexArray.get(0).getTwoLineVisible()) {\r\n                    this._equalAngleName.setVisibility(true);\r\n                }\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n        },\r\n        getWidth: function () {\r\n            return this._config.Surface.width;\r\n        }\r\n    });\r\n\r\n    Reflector.Extend = function (cls) {\r\n        return Object.create(Reflector).__include(cls);\r\n    };\r\n    return Reflector;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/15.\r\n */\r\ndefine('js/reflector/reflector2', ['js/reflector/reflector1'], function (Reflector1) {\r\n\r\n\r\n    var Surface = require('js/view/surface');\r\n\r\n    var Reflector2 = Reflector1.Extend({\r\n        _CONFIG: {\r\n            LightComplex: [{\r\n                IncidenceLine: {\r\n                    visible: false,\r\n                    rotateFixed: false,\r\n                    clickAble: false,\r\n                    defaultAngle: 60,\r\n                    arrowPos: 140//箭号所在位置\r\n                },\r\n                ReflectionLine: {\r\n                    visible: true,\r\n                    rotateFixed: false,\r\n                    clickAble: true,\r\n                    rotateFixedAfterDraw: true,\r\n                    arrowPos: 140\r\n                },\r\n                NormalLine: {\r\n                    lineVisible: false,\r\n                    pointNameVisible: false\r\n                },\r\n\r\n                Sector: {\r\n                    sectorInVisible: false,\r\n                    sectorOutVisible: true,\r\n                    incidenceVisible: false,\r\n                    reflectionVisible: false,\r\n                    letterR: 110,\r\n                    angleR: 180\r\n                },\r\n                IncidencePosX: 520 / 2,//入射点位置\r\n                DrawIndex: [[0, 1, 9, 8], [5, 6, 7], [4, 11], [2, 3]],\r\n                PedalDrawIndex: [[0, 1, 9], [5, 6, 7], [4, 10, 2]],\r\n                Visible: true\r\n            }],\r\n            Surface: {\r\n                width: 520,\r\n                defaultAngle: 0,\r\n                rotatePosX: 520 / 2,\r\n                visible: true,\r\n                clickAble: true,\r\n                type: Surface.Type.tl\r\n            }\r\n        },\r\n        _TYPE: 2\r\n    });\r\n\r\n    return Reflector2;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/15.\r\n */\r\ndefine('js/reflector/reflector3', ['js/reflector/reflector1'], function (Reflector1) {\r\n\r\n\r\n    var Surface = require('js/view/surface');\r\n\r\n    var Reflector3 = Reflector1.Extend({\r\n        _CONFIG: {\r\n            LightComplex: [{\r\n                IncidenceLine: {\r\n                    visible: true, rotateFixed: false, defaultAngle: 60,\r\n                    arrowPos: 140\r\n                },\r\n                ReflectionLine: {\r\n                    visible: true, rotateFixed: false,\r\n                    arrowPos: 140\r\n                },\r\n                NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                Sector: {\r\n                    sectorInVisible: false, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false,\r\n                    letterR: 110,\r\n                    angleR: 180\r\n                },\r\n                IncidencePosX: 520 / 2,//入射点位置\r\n                DrawIndex: [[0, 1, 8, 3], [4, 7, 11], [5], [2, 6, 9]],\r\n                PedalDrawIndex: [[0, 1, 10], [5, 4, 7], [6, 2, 9]],\r\n                Visible: true,\r\n                view90PedalLineVisible: false\r\n            }],\r\n            Surface: {\r\n                width: 520,\r\n                defaultAngle: 0,\r\n                rotatePosX: 520 / 2,\r\n                visible: false,\r\n                clickAble: false,\r\n                type: Surface.Type.tl\r\n            }\r\n        },\r\n        _TYPE: 3,\r\n        initExtrasDrawCommand: function () {\r\n            var that = this;\r\n            var length = this._lightComplexArray.getCommandLength();\r\n\r\n            this._lightComplexArray.pushDrawCommand(function (deffer) {\r\n                that._equalAngleNameHasShowBefore = true;\r\n                that._equalAngleName.setVisibility(true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._equalAngleName.isVisibilityHidden();\r\n            });\r\n\r\n            this._lightComplexArray.pushDrawCommand(function (deffer, animate) {\r\n                that._surface.setVisibility(true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._surface.isVisibilityHidden();\r\n            });\r\n            var pedalIndex = $.extend(true, [], this._config.LightComplex[0].PedalDrawIndex);\r\n            var defaultIndex = $.extend(true, [], this._config.LightComplex[0].DrawIndex);\r\n            pedalIndex.splice(1, 0, length);//插入入射角=反射角\r\n            pedalIndex[3].push(length + 1);//插件反射面\r\n            defaultIndex[3].push(length + 1);//插入反射面\r\n\r\n            this._lightComplexArray.setDrawIndex(defaultIndex);\r\n            this._lightComplexArray.setPedalDrawIndex(pedalIndex);\r\n        }\r\n    });\r\n\r\n    return Reflector3;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/reflector/reflector4', ['js/reflector/reflector1', 'js/utils/graphMath', 'js/utils/logger', 'js/config/style', 'js/view/LightLine'], function (Reflector1, GraphMath, Logger, Style, LightLine) {\r\n\r\n    var LineStyle = Style.LineStyle;\r\n    var View = require('js/utils/view');\r\n    var Sector = require('js/view/sector');\r\n    var EventKey = require('js/config/eventKey');\r\n    var Surface = require('js/view/Surface');\r\n\r\n\r\n    var Reflector = Reflector1.Extend({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    IncidenceLine: {defaultAngle: 60, rotateFixed: false, clickAble: false, visible: false, width: 410, arrowPos: 210, PedalWidth: 350, PedalArrowPos: 150, highLineZIndex: true},\r\n                    ReflectionLine: {visible: true, rotateFixed: false, clickAble: true, width: 410, arrowPos: 150, PedalWidth: 410, PedalArrowPos: 150},\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false, width: 470},\r\n                    Sector: {\r\n                        sectorInVisible: false, sectorOutVisible: true, incidenceVisible: false, reflectionVisible: false,\r\n                        letterR: 90,\r\n                        angleR: 90\r\n                    },\r\n                    IncidencePosX: 916 / 2 - 127,\r\n                    DrawIndex: [[0, 1, 9, 8], [5, 6, 7], [4, 11], [2, 3]],\r\n                    PedalDrawIndex: [[0, 1, 9], [5, 6, 7], [4, 2]],\r\n                    Visible: true\r\n                },\r\n                {\r\n                    IncidenceLine: {defaultAngle: 40, rotateFixed: false, clickAble: false, visible: false, width: 410, arrowPos: 210, PedalWidth: 350, PedalArrowPos: 150, highLineZIndex: true},\r\n                    ReflectionLine: {visible: true, rotateFixed: false, clickAble: true, width: 410, arrowPos: 150, PedalWidth: 410, PedalArrowPos: 150},\r\n                    NormalLine: {lineVisible: false, pointNameVisible: false, width: 470},\r\n                    Sector: {\r\n                        sectorInVisible: false, sectorOutVisible: true, incidenceVisible: false, reflectionVisible: false,\r\n                        letterR: 90,\r\n                        angleR: 90\r\n                    },\r\n                    IncidencePosX: 916 / 2 + 127,\r\n                    DrawIndex: [[0, 1, 9, 8], [5, 6, 7], [4, 11], [2, 3]],\r\n                    PedalDrawIndex: [[0, 1, 9], [5, 6, 7], [4, 2]],\r\n                    Visible: true\r\n                }],\r\n            Surface: {\r\n                width: 916,\r\n                defaultAngle: 0,\r\n                rotatePosX: 916 / 2,//旋转位置\r\n                visible: true,\r\n                clickAble: false,\r\n                type: Surface.Type.tl_Large\r\n            }\r\n        },\r\n        _TYPE: 4,\r\n        _incidenceWidth: [],\r\n        initEvent: function () {\r\n            this.pushEvent({key: EventKey.LightLineVisible, callback: 'lightLineVisibleHandler', params: []});\r\n            this.pushEvent({key: EventKey.NameVisible, callback: 'nameVisibleHandler', params: []});\r\n        },\r\n        afterCreateView: function () {\r\n            this._incidenceWidth = [];\r\n            var name = this._option.langData['rf_incidence_line_name'];\r\n            this._$$incidenceName = new kity.Text();\r\n            this.setCommonNameVisible(false);\r\n            this._$$incidenceName.setContent(name).setAttr('class', LineStyle[LightLine.Type.IncidenceLine].fontClass);\r\n            this._$$container.addShape(this._$$incidenceName);\r\n\r\n            this._lightComplexArray.showFirstIndex();\r\n            this.afterLineMove();\r\n        },\r\n        lightLineVisibleHandler: function (type, visible) {\r\n            if (visible) {\r\n                this.setCommonNameVisible(visible);\r\n            }\r\n        },\r\n        nameVisibleHandler: function (visible) {\r\n            this.setCommonNameVisible(visible);\r\n        },\r\n        setCommonNameVisible: function (visible) {\r\n            if (this._$$incidenceName) {\r\n                if (this._incidenceWidth.length > 0 && this._lightComplexArray.get(0).getIncidenceLineVisible() && visible === true) {\r\n                    this._$$incidenceName.setVisible(this.getNameVisible());\r\n                } else {\r\n                    this._$$incidenceName.setVisible(false);\r\n                }\r\n            }\r\n        },\r\n        initExtrasDrawCommand: function () {\r\n            //调用基类方法\r\n            Reflector1.initExtrasDrawCommand.apply(this, []);\r\n\r\n            var that = this;\r\n            var length = this._lightComplexArray.getCommandLength();\r\n            var __push = function (index) {\r\n                //显示垂足动画\r\n                that._lightComplexArray.get(index).pushDrawCommand(function (deffer) {\r\n                    that._lightComplexArray.get(index).setIncidenceShortPedalView(that._incidenceWidth[index]);\r\n                    deffer.resolve();\r\n                }, function () {\r\n                    return that._lightComplexArray.get(index).isDrawIncidenceShortPedalView(that._incidenceWidth[index]);\r\n                });\r\n            };\r\n            __push(0);\r\n            __push(1);\r\n            var pedalIndex = $.extend(true, [], this._config.LightComplex[0].PedalDrawIndex);\r\n            pedalIndex[pedalIndex.length - 1].push(length);\r\n            this._lightComplexArray.setPedalDrawIndex(pedalIndex);\r\n        },\r\n        initEqualAngleNamePos: function () {\r\n            var parentTranslate = this._$$container.getTransform().m;\r\n            var width = this._equalAngleName.getView().getWidth();\r\n            var height = this._equalAngleName.getView().getHeight();\r\n            this._equalAngleName.setTranslate(this._option.viewPortWidth - parentTranslate.e - width - 20, -(  parentTranslate.f - height - 20 ));\r\n        },\r\n        initEqualAngleVisibility: function () {\r\n\r\n        },\r\n        afterLineMove: function () {\r\n            //反射面角度按-180~180来处理\r\n            var that = this;\r\n            var config = this._config;\r\n            var linesPos = [];\r\n            this._lightComplexArray.each(function (i) {\r\n                var pos = {x: config.LightComplex[i].IncidencePosX, y: 0};\r\n                var degree = that._lightComplexArray.get(i).getIncidenceRotateAngle();\r\n                var kb = GraphMath.getLineKb(180 - degree, pos);\r\n                var linePos = {\r\n                    a: pos,\r\n                    b: {\r\n                        x: ( 5000 - kb.b ) / kb.k, y: 5000\r\n                    }\r\n                };\r\n                linesPos.push(linePos);\r\n            });\r\n\r\n            var firstLight = this._lightComplexArray.get(0);\r\n            var secondLight = this._lightComplexArray.get(1);\r\n\r\n            var pos = GraphMath.getTwoLineIntersection(linesPos[0].a, linesPos[0].b, linesPos[1].a, linesPos[1].b);\r\n            if (pos) {\r\n                var width = GraphMath.getPythagoreanLineC(pos.y, linesPos[0].a.x - pos.x);\r\n                var width2 = GraphMath.getPythagoreanLineC(pos.y, linesPos[1].a.x - pos.x);\r\n                this._incidenceWidth = [width, width2];\r\n                firstLight.setIncidenceLineWidth(width);\r\n                secondLight.setIncidenceLineWidth(width2 + 2);//加2像素使得两条线头部重合\r\n                this.setCommonNameVisible(this.getNameVisible());\r\n                var incidenceRotateAngle = Math.round(this._lightComplexArray.get(0).getIncidenceRotateAngle());\r\n                var incidenceRotateAngle2 = Math.round(this._lightComplexArray.get(1).getIncidenceRotateAngle());\r\n                //动态计算名称位置\r\n                var width = (this._$$incidenceName.getWidth() || 112) + 10;\r\n                if (incidenceRotateAngle > 90 && incidenceRotateAngle2 <= 90) {\r\n                    //width = width / 2;\r\n                    if (pos.x > this._CONFIG.LightComplex[0].IncidencePosX) {\r\n                        width = ((pos.x - this._CONFIG.LightComplex[0].IncidencePosX)) - 10;\r\n                    }\r\n                } else if (incidenceRotateAngle <= 90) {\r\n                    width = width;\r\n                } else if (incidenceRotateAngle2 > 90) {\r\n                    width = -10;\r\n                }\r\n                Logger.debug('reflector4', this._CONFIG.LightComplex[0].IncidencePosX, pos.x);\r\n                this._$$incidenceName.setTranslate(pos.x - width, -pos.y - 15);\r\n                this._lightComplexArray.setIncidenceNameEnable(false);\r\n                this._lightComplexArray.setLinePedalChangeLock(true);\r\n            } else {\r\n                this._incidenceWidth = [];\r\n                if (Math.round(firstLight.getSectorAngle(Sector.Type.Incidence)) === 0) {\r\n                    firstLight.setIncidenceLineWidth(this._CONFIG.LightComplex[0].IncidenceLine.PedalWidth);\r\n                    firstLight.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.PedalArrowPos);\r\n                } else {\r\n                    firstLight.setIncidenceLineWidth(this._CONFIG.LightComplex[0].IncidenceLine.width);\r\n                    firstLight.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.arrowPos);\r\n                }\r\n                if (Math.round(secondLight.getSectorAngle(Sector.Type.Incidence)) === 0) {\r\n                    secondLight.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.PedalWidth);\r\n                    secondLight.setIncidenceLineArrowPos(this._CONFIG.LightComplex[1].IncidenceLine.PedalArrowPos);\r\n                } else {\r\n                    secondLight.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width);\r\n                    secondLight.setIncidenceLineArrowPos(this._CONFIG.LightComplex[1].IncidenceLine.arrowPos);\r\n                }\r\n                this.setCommonNameVisible(false);\r\n                this._lightComplexArray.setIncidenceNameEnable(true);\r\n                this._lightComplexArray.setIncidenceNameVisible(this.getNameVisible());\r\n                this._lightComplexArray.setLinePedalChangeLock(false);\r\n            }\r\n\r\n            Logger.debug('reflector4', pos, linesPos);\r\n        },\r\n        toCenter: function () {\r\n            this._$$container.setTranslate(this._option.viewPortWidth / 2 - this.getWidth() / 2, this._option.viewPortHeight / 2 + 250);\r\n        }\r\n    });\r\n\r\n    return Reflector;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/reflector/reflector5', ['js/reflector/baseReflector', 'js/utils/utils', 'js/utils/graphMath', 'js/utils/svg'], function (BaseReflector, Utils, GraphMath, Svg) {\r\n\r\n    //view\r\n    var Surface = require('js/view/surface');\r\n    var Logger = require('js/utils/logger');\r\n    var Sector = require('js/view/Sector');\r\n    var LightComplexArray = require('js/reflector/LightComplexArray');\r\n    var EqualAngleName = require('js/view/EqualAngleName');\r\n    var LightLine = require('js/view/LightLine');\r\n    var Btns = require('js/reflector/btns');\r\n\r\n    //针对偏移量\r\n    var SurfaceVerticalPadding = {\r\n        x: 7,//5\r\n        y: 4,//4\r\n        tr: 14,\r\n        verticalX: 6,\r\n        verticalY: 3\r\n    };\r\n\r\n    var Reflector = BaseReflector({\r\n        _CONFIG: {\r\n            LightComplex: [\r\n                {\r\n                    IncidenceLine: {defaultAngle: 60, rotateFixed: false, clickAble: true, width: 270, rotateFixedAfterDraw: true, PedalWidth: 270, arrowPos: 100, PedalArrowPos: 100},\r\n                    ReflectionLine: {visible: false, rotateFixed: false, clickAble: false, width: 270, arrowPos: 150, PedalWidth: 210, PedalArrowPos: 105},\r\n                    NormalLine: {width: 280},\r\n                    Sector: {\r\n                        sectorInVisible: true, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false,\r\n                        letterR: 90,\r\n                        angleR: 90\r\n                    },\r\n                    IncidencePosX: -480 / 2 - 15,//入射点位置\r\n                    DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    PedalDrawIndex: [[0, 1, 2], [4, 5, 6], [7, 9, 10]],\r\n                    Visible: true,\r\n                    nameEventEnable: true,\r\n                    NameAutoPos: true\r\n                },\r\n                {\r\n                    IncidenceLine: {defaultAngle: 50, rotateFixed: false, clickAble: false, visible: true, need: true, width: 68, arrowPos: 0, arrowVisible: false},\r\n                    NormalLine: {width: 210},\r\n                    ReflectionLine: {visible: false, rotateFixed: false, clickAble: false, width: 270, arrowPos: 135},\r\n                    Sector: {\r\n                        sectorInVisible: true, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false,\r\n                        letterR: 85\r\n                    },\r\n                    IncidencePosX: 0,//入射点位置\r\n                    DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    PedalDrawIndex: [[0, 1, 2], [4, 5, 6], [7, 9, 10]],\r\n                    Visible: false,\r\n                    nameEventEnable: true\r\n                },\r\n                {\r\n                    IncidenceLine: {defaultAngle: 50, rotateFixed: false, clickAble: false, visible: true, need: true, width: 68, arrowPos: 0, arrowVisible: false},\r\n                    NormalLine: {width: 210},\r\n                    ReflectionLine: {visible: false, rotateFixed: false, clickAble: false, width: 270, arrowPos: 135},\r\n                    Sector: {\r\n                        sectorInVisible: true, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false,\r\n                        letterR: 90,\r\n                        angleR: 90\r\n                    },\r\n                    IncidencePosX: 0,//入射点位置\r\n                    DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                    PedalDrawIndex: [[0, 1, 2], [4, 5, 6], [7, 9, 10]],\r\n                    Visible: false,\r\n                    nameEventEnable: true\r\n                }\r\n            ],\r\n            Surface: {\r\n                width: 630,//630\r\n                defaultAngle: 0,\r\n                rotatePosX: SurfaceVerticalPadding.x,//旋转位置k\r\n                rotatePosY: SurfaceVerticalPadding.y,//旋转位置\r\n                visible: true,\r\n                clickAble: true,\r\n                nameEventEnable: true,\r\n                type: Surface.Type.tl\r\n            },\r\n            SurfaceVertical: {\r\n                width: 480,//480\r\n                defaultAngle: 90,\r\n                rotatePosX: 480 - SurfaceVerticalPadding.x,//旋转位置\r\n                rotatePosY: SurfaceVerticalPadding.y,//旋转位置\r\n                visible: true,\r\n                clickAble: true,\r\n                nameEnable: false,\r\n                nameEventEnable: true,\r\n                type: Surface.Type.tr\r\n            }\r\n        },\r\n        _TYPE: 5,\r\n        _$$container: null,\r\n        _incidencePointPos: null,\r\n        _surfacePagePos: null,\r\n        _option: null,\r\n        _equalAngleNameHasShowBefore: false,\r\n        create: function (eventBus, $$container, option, data) {\r\n            var instance = Object.create(this);\r\n            instance._uuid = Utils.getUuid();\r\n            instance.__base(eventBus, []);\r\n            instance.__proxyAll(['onSurfaceMove', 'onLineMove', 'onVerticalSurfaceMove']);//绑定this指针\r\n            instance._$$container = $$container;\r\n            instance._config = $.extend(true, {}, this._CONFIG, (data && data.configData) || {});\r\n\r\n            //不显示\r\n            if (option.reflector5NameEnable === false) {\r\n                instance._config.Surface.nameEventEnable = false;\r\n                instance._config.SurfaceVertical.nameEventEnable = false;\r\n                instance._config.LightComplex.forEach(function (item) {\r\n                    item.nameEventEnable = false;\r\n                })\r\n            }\r\n            instance._option = option;\r\n            instance.createView();\r\n            instance.afterCreateView();\r\n            instance.initExtrasDrawCommand();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            //反射面,3像素旋转偏移\r\n            this._surface = Surface.create(this.__getEventBus(), this._config.Surface, this.onSurfaceMove, this._option.langData);\r\n            //反射面2\r\n            this._surfaceVertical = Surface.create(this.__getEventBus(), this._config.SurfaceVertical, this.onVerticalSurfaceMove, this._option.langData);\r\n\r\n            var count = this._config.Surface.clickAble ? 1 : 0;\r\n            if (this._config.SurfaceVertical.clickAble) {\r\n                count++;\r\n            }\r\n\r\n            if (count > 0) {\r\n                var btns = this.btns = Btns.create(this.__getEventBus(), this._$$container, count);\r\n                if (this._config.Surface.clickAble) {\r\n                    this._surface.setMoveListener(function (scale, clientRect, uuid, visible) {\r\n                        btns.moveBtnEventHandler(scale, clientRect, uuid, visible);\r\n                        that._lightComplexArray.btnStillInBox();\r\n                    })\r\n                }\r\n                if (this._config.SurfaceVertical.clickAble) {\r\n                    this._surfaceVertical.setMoveListener(function (scale, clientRect, uuid, visible) {\r\n                        btns.moveBtnEventHandler(scale, clientRect, uuid, visible);\r\n                        that._lightComplexArray.btnStillInBox();\r\n                    })\r\n                }\r\n            }\r\n\r\n            this._lightComplexArray = LightComplexArray.create(this.__getEventBus(), this._config.LightComplex, this._option, this.onLineMove, true, this._TYPE);\r\n            this._lightComplexArray.appendToView(this._$$container);\r\n\r\n            this._equalAngleName = EqualAngleName.create(this._option.langData);\r\n\r\n            this._$$container.addShape(this._surface.getView());\r\n            this._$$container.addShape(this._surfaceVertical.getView());\r\n            this._$$container.addShape(this._equalAngleName.getView());\r\n            this._lightComplexArray.gtIndexAppendToView(this._$$container);\r\n            if (this.btns) {\r\n                this.btns.appendToView(this._$$container);\r\n            }\r\n            this._surface.setNameVisible(this._option.nameVisible);\r\n\r\n            if (this._config.EqualAngleName) {\r\n                that._equalAngleNameHasShowBefore = this._config.EqualAngleName.visible;\r\n                this._equalAngleName.setVisibility(this._config.EqualAngleName.visible);\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n            //移动到指定位置\r\n            this._surfaceVertical.setTranslateX(-this._config.SurfaceVertical.width + SurfaceVerticalPadding.tr);\r\n            this.setSurfaceVerticalAngle(this._config.SurfaceVertical.defaultAngle, true);\r\n            this._surface.rotate(this._config.Surface.defaultAngle);\r\n            this._lightComplexArray.get(1).resetAngle(this._config.Surface.defaultAngle, true);\r\n            this._lightComplexArray.get(2).resetAngle(this._config.SurfaceVertical.defaultAngle, true);\r\n\r\n\r\n            //从新初始化坐标位置\r\n            this.toCenter();\r\n            //布局角度\r\n            this.initEqualAngleNamePos();\r\n\r\n        },\r\n        initEqualAngleNamePos: function () {\r\n            //布局角度\r\n            var width = this._equalAngleName.getView().getWidth(),\r\n                height = this._equalAngleName.getView().getHeight(),\r\n                svgWidth = this._$$container.container.getWidth(),\r\n                containerCTM = this._$$container.node.getCTM(),\r\n                scale = this._$$container.container.node.getCTM().a;\r\n\r\n            var x = svgWidth / scale - containerCTM.e / scale - width - 50;\r\n            var y = containerCTM.f / scale - height;\r\n\r\n            this._equalAngleName.setTranslate(x, -y);\r\n        },\r\n        afterCreateView: function () {\r\n            this._lightComplexArray.showFirstIndex();\r\n            this.mathLine();\r\n            if (this._option.reflector5NameEnable === false) {\r\n                this.setNameVisible(false);\r\n            }\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this._surface.setNameVisible(visible);\r\n            this._surfaceVertical.setNameVisible(visible);\r\n            this._lightComplexArray.setNameVisible(visible);\r\n        },\r\n        setSurfaceVerticalAngle: function (angle, init) {\r\n            this._surfaceVertical.rotate(angle);\r\n            this._lightComplexArray.get(0).resetAngle(angle, init);\r\n            this._lightComplexArray.get(0).around(angle, -SurfaceVerticalPadding.x, SurfaceVerticalPadding.tr);\r\n        },\r\n        getData: function () {\r\n            var data = {};\r\n            data.type = this._TYPE;\r\n            data.configData = this._lightComplexArray.getData();\r\n            data.configData.Surface = {\r\n                defaultAngle: this._surface.getRotateAngle()\r\n            };\r\n            data.configData.SurfaceVertical = {\r\n                defaultAngle: this._surfaceVertical.getRotateAngle()\r\n            };\r\n            data.configData.EqualAngleName = {\r\n                visible: !this._equalAngleName.isVisibilityHidden()\r\n            };\r\n            return data;\r\n        },\r\n        getMoveRotateAngle: function (data) {\r\n            var currentPos = data.currentPos;\r\n            var lastPos = data.lastPos;\r\n            return GraphMath.getRotateAngle(this._surface.getRotateOffsetPos(), lastPos, currentPos);\r\n        },\r\n        onSurfaceMove: function (data, eventType) {\r\n            var enable = true;\r\n            if (eventType === 'move') {\r\n                var angle = this.getMoveRotateAngle(data);\r\n                var subAngle = Math.abs(this._surfaceVertical.getRotateAngle() - this._surface.getRotateAngle() - angle);\r\n                if (subAngle < 180) {\r\n                    this._surface.rotate(angle);\r\n                }\r\n                //if (subAngle >= 177) {\r\n                //    this._lightComplexArray.setAllEnable(false);\r\n                //    enable = false;\r\n                //} else {\r\n                //    this._lightComplexArray.setEnable(0, true);\r\n                //}\r\n            } else if (eventType === 'aftermove') {\r\n                this._lightComplexArray.adsorptionPedal();\r\n            } else if (eventType === 'beforemove') {\r\n                //移动前先隐藏一条公共线\r\n            }\r\n            var subAngle = Math.abs(this._surfaceVertical.getRotateAngle() - this._surface.getRotateAngle());\r\n            if (subAngle >= 177) {\r\n                this._lightComplexArray.setAllEnable(false);\r\n                enable = false;\r\n            } else {\r\n                this._lightComplexArray.setEnable(0, true);\r\n            }\r\n            if (enable) {\r\n                this.mathLine();\r\n                this.initEqualAngleVisibility();\r\n            }\r\n        },\r\n        onVerticalSurfaceMove: function (data, eventType) {\r\n            var enable = true;\r\n            if (eventType === 'move') {\r\n                var angle = this.getMoveRotateAngle(data);\r\n                if (this._lightComplexArray.rotateAble(angle)) {\r\n                    var subAngle = Math.abs(this._surfaceVertical.getRotateAngle() - this._surface.getRotateAngle() + angle);\r\n                    if (subAngle < 180) {\r\n                        this._surfaceVertical.rotate(angle);\r\n                    }\r\n                }\r\n            } else if (eventType === 'aftermove') {\r\n                this._lightComplexArray.adsorptionPedal();\r\n\r\n            } else if (eventType === 'beforemove') {\r\n\r\n            }\r\n            var subAngle = Math.abs(this._surfaceVertical.getRotateAngle() - this._surface.getRotateAngle());\r\n            if (subAngle >= 177) {\r\n                this._lightComplexArray.setAllEnable(false);\r\n                enable = false;\r\n            } else {\r\n                this._lightComplexArray.setEnable(0, true);\r\n            }\r\n            var surfaceAngle = this._surfaceVertical.getRotateAngle() || 0;\r\n            this._lightComplexArray.get(0).resetAngle(surfaceAngle);\r\n            this._lightComplexArray.get(0).around(this._surfaceVertical.getRotateAngle(), -SurfaceVerticalPadding.x, SurfaceVerticalPadding.tr);\r\n            if (enable) {\r\n                this.mathLine();\r\n                this.initEqualAngleVisibility();\r\n            }\r\n        },\r\n        onLineMove: function (uuid, angle) {\r\n            if (uuid === this._lightComplexArray.get(0).getUuid()) {\r\n                this.mathLine();\r\n            }\r\n            this.initEqualAngleVisibility();\r\n        },\r\n        initEqualAngleVisibility: function () {\r\n            //非垂足重置为不可见\r\n            if (this._lightComplexArray.isPedalExcludeDisable() && this._lightComplexArray.isEnableAndDraw(0)) {\r\n                if (this._equalAngleNameHasShowBefore || this._lightComplexArray.get(0).getTwoLineVisible()) {\r\n                    this._equalAngleName.setVisibility(true);\r\n                }\r\n            } else {\r\n                this._equalAngleName.setVisibility(false);\r\n            }\r\n        },\r\n        //获取针对x轴的夹角\r\n        getSurfaceXAxisDegree: function (surface) {\r\n            var degree = surface.getRotateAngle() % 180;\r\n            //角度换算\r\n            if (degree <= 0) {\r\n                degree = -degree;\r\n            } else {\r\n                degree = 180 - degree;\r\n            }\r\n            return degree;\r\n        },\r\n        getSurfaceSpherePos: function (sphereDegree, surface, pos) {\r\n            if (this._surface === surface) {\r\n                if (sphereDegree > 0 && sphereDegree <= 90) {\r\n                    pos.y = -pos.y;\r\n                } else if (sphereDegree > 90 && sphereDegree <= 180) {\r\n                    pos.y = -pos.y;\r\n                    pos.x = -pos.x;\r\n                } else if (sphereDegree > 180 && sphereDegree <= 270) {\r\n                    pos.x = -pos.x;\r\n                } else if (sphereDegree > 270 && sphereDegree <= 360) {\r\n\r\n                }\r\n            } else {\r\n                if (sphereDegree > 0 && sphereDegree <= 90) {\r\n                    pos.x = -pos.x;\r\n                } else if (sphereDegree > 90 && sphereDegree <= 180) {\r\n\r\n                } else if (sphereDegree > 180 && sphereDegree <= 270) {\r\n                    pos.y = -pos.y;\r\n                } else if (sphereDegree > 270 && sphereDegree <= 360) {\r\n                    pos.y = -pos.y;\r\n                    pos.x = -pos.x;\r\n                }\r\n            }\r\n            return pos;\r\n        },\r\n        getSurfacePos: function (surface) {\r\n            var pos = {x: this._config.Surface.rotatePosX, y: 0};\r\n            if (surface === this._surfaceVertical) {\r\n                pos = {x: SurfaceVerticalPadding.tr - SurfaceVerticalPadding.x, y: 0};\r\n            }\r\n            var degree = this.getSurfaceXAxisDegree(surface);\r\n            //var kb = GraphMath.getLineKb(degree, pos);\r\n            var linePos = {\r\n                a: pos,\r\n                b: GraphMath.getLinePosByAngle(degree, surface === this._surface ? (this._config.Surface.width - SurfaceVerticalPadding.x) : (this._config.SurfaceVertical.width - SurfaceVerticalPadding.x))\r\n            };\r\n            var sphereDegree = surface.get0To360RotateAngle();\r\n\r\n            linePos.b = this.getSurfaceSpherePos(sphereDegree, surface, linePos.b);\r\n            linePos.b.x += pos.x;\r\n            return linePos;\r\n        },\r\n        getLineSpherePos: function (kb, lineAngle, posA) {\r\n            var posB = {};\r\n            if ((lineAngle > 0 && lineAngle <= 90) || (lineAngle > 270 && lineAngle <= 360)) {\r\n                posB = {\r\n                    x: posA.x - 1000,\r\n                    y: kb.k * (posA.x - 1000) + kb.b\r\n                }\r\n            } else if ((lineAngle > 90 && lineAngle <= 180) || (lineAngle > 180 && lineAngle <= 270)) {\r\n                posB = {\r\n                    x: posA.x + 1000,\r\n                    y: kb.k * (posA.x + 1000) + kb.b\r\n                }\r\n            }\r\n            return posB;\r\n        },\r\n        getFirstLinePos: function (lightType) {\r\n            var lineAngle = this._lightComplexArray.get(0).getLine0To360RotateAngle(lightType);\r\n            //计算与反射面上的点\r\n            var surfaceXDegree = this.getSurfaceXAxisDegree(this._surfaceVertical);\r\n            //计算出线相对于反射面与x轴交点的坐标\r\n            var posA = GraphMath.getLinePosByAngle(surfaceXDegree, Math.abs(this._config.LightComplex[0].IncidencePosX) - (SurfaceVerticalPadding.x));\r\n            var sphereDegree = this._surfaceVertical.get0To360RotateAngle();\r\n            posA = this.getSurfaceSpherePos(sphereDegree, this._surfaceVertical, posA);\r\n            //对X坐标进行平移\r\n            posA.x = posA.x + (SurfaceVerticalPadding.tr - SurfaceVerticalPadding.x);\r\n            var lineXAngle = this._lightComplexArray.get(0).getLineXAngle(lightType);\r\n            var kb = GraphMath.getLineKb(lineXAngle, posA);\r\n            var linePos = {\r\n                a: posA\r\n            };\r\n\r\n            linePos.b = this.getLineSpherePos(kb, lineAngle, posA);\r\n            return linePos;\r\n        },\r\n        getReflectionLine: function (index, posA) {\r\n            var lineAngle = this._lightComplexArray.get(index).getLine0To360RotateAngle(LightLine.Type.ReflectionLine);\r\n            var kb = GraphMath.getLineKb(this._lightComplexArray.get(index).getReflectionLineXAngle(), posA);\r\n            var linePos = {\r\n                a: posA\r\n            };\r\n            linePos.b = this.getLineSpherePos(kb, lineAngle, posA);\r\n            return linePos;\r\n        },\r\n        //第二个点反射线\r\n        getSecondLinePos: function (posA) {\r\n            return this.getReflectionLine(1, posA);\r\n        },\r\n        //第三个点反射线\r\n        getThirdLinePos: function (posA) {\r\n            return this.getReflectionLine(2, posA);\r\n        },\r\n        mathLine: function () {\r\n            //坐标针对item的原点\r\n            var surfaceVerticalLine = this.getSurfacePos(this._surfaceVertical);\r\n            var surfaceLine = this.getSurfacePos(this._surface);\r\n            var firstReflectionLinePos = this.getFirstLinePos(LightLine.Type.ReflectionLine);\r\n            var firstIncidenceLinePos = this.getFirstLinePos(LightLine.Type.IncidenceLine);\r\n            Logger.debug('reflector5', surfaceLine, surfaceVerticalLine, firstIncidenceLinePos, firstReflectionLinePos);\r\n\r\n            var firstLightComplex = this._lightComplexArray.get(0);\r\n            var secondLightComplex = this._lightComplexArray.get(1);\r\n            var thirdLightComplex = this._lightComplexArray.get(2);\r\n\r\n            //初始化\r\n            firstLightComplex.setIncidenceLineWidth(this._CONFIG.LightComplex[0].IncidenceLine.width);\r\n            firstLightComplex.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.arrowPos);\r\n\r\n            //计算第一个点反射线和水平方向反射面交点\r\n            var reflectionPos2 = GraphMath.getTwoLineIntersection(surfaceLine.a, surfaceLine.b, firstReflectionLinePos.a, firstReflectionLinePos.b);\r\n            if (reflectionPos2) {\r\n                //点在上方\r\n                var incidenceDegree = firstLightComplex.getReflectionRotateAngle() % 360 - 180;\r\n                //if (reflectionPos2.y > firstReflectionLinePos.a.y) {\r\n                //点在目标点下方\r\n                //incidenceDegree = firstLightComplex.getReflectionRotateAngle() % 360 + 180;\r\n                //incidenceDegree=360-incidenceDegree;\r\n                //}\r\n\r\n                //计算出针对反射面与x轴的坐标，加上偏移坐标\r\n                var rotatePosX = GraphMath.getPythagoreanLineC(reflectionPos2.x - SurfaceVerticalPadding.x, reflectionPos2.y) + SurfaceVerticalPadding.x;\r\n                //设置组件位置\r\n                secondLightComplex.setIncidencePos(rotatePosX);\r\n                //设置入射角初始旋转角度\r\n                secondLightComplex.setIncidenceXAxisAngle(incidenceDegree);\r\n                //根据反射面角度，重新计算旋转角度\r\n                secondLightComplex.resetAngle(this._surface.getRotateAngle());\r\n                //同步位置：设置反射面旋转导致的位置偏移\r\n                secondLightComplex.around(this._surface.getRotateAngle(), SurfaceVerticalPadding.x);\r\n                var posWidth = GraphMath.getPythagoreanLineC(reflectionPos2.x - firstReflectionLinePos.a.x, reflectionPos2.y - firstReflectionLinePos.a.y);\r\n                firstLightComplex.setReflectionLineWidth(posWidth);\r\n                if (posWidth <= this._CONFIG.LightComplex[1].IncidenceLine.width) {\r\n                    secondLightComplex.setIncidenceLineWidth(posWidth);\r\n                } else {\r\n                    secondLightComplex.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width);\r\n                }\r\n\r\n            } else {\r\n                firstLightComplex.setReflectionLineWidth(this._CONFIG.LightComplex[0].ReflectionLine.width);\r\n                firstLightComplex.setReflectionLineArrowPos(this._CONFIG.LightComplex[0].ReflectionLine.arrowPos);\r\n                secondLightComplex.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width);\r\n            }\r\n            this._lightComplexArray.setEnable(1, !!reflectionPos2);\r\n\r\n\r\n            //计算第二次反射交点\r\n            var secondLinePos = this.getSecondLinePos(reflectionPos2);\r\n            var reflectionPos3 = GraphMath.getTwoLineIntersection(surfaceVerticalLine.a, surfaceVerticalLine.b, secondLinePos.a, secondLinePos.b);\r\n            if (reflectionPos3) {\r\n                //计算出针对反射面与x轴的坐标，加上偏移坐标\r\n                var incidencePosX = -(GraphMath.getPythagoreanLineC(reflectionPos3.x - SurfaceVerticalPadding.x, reflectionPos3.y) + SurfaceVerticalPadding.x);\r\n                //计算出针对反射面与x轴的坐标，加上偏移坐标\r\n                var incidenceDegree = 0;\r\n                //通过图解可得一下公式\r\n                if (firstLightComplex.getIncidencePosX() > incidencePosX) {\r\n                    if (firstLightComplex.getIncidenceRotateAngle() <= firstLightComplex.getNormalLineRotateAngle()) {\r\n                        incidenceDegree = secondLightComplex.getSectorAngle(Sector.Type.Incidence) * 2 + firstLightComplex.getSectorAngle(Sector.Type.SurfaceOut) + firstLightComplex.getSectorAngle(Sector.Type.Incidence) * 2;\r\n                    } else {\r\n                        incidenceDegree = secondLightComplex.getSectorAngle(Sector.Type.Incidence) * 2 + firstLightComplex.getSectorAngle(Sector.Type.SurfaceOut);\r\n                    }\r\n                    incidenceDegree = 180 - incidenceDegree;\r\n                    //对调反射线和入射线\r\n                    incidenceDegree = 180 - incidenceDegree;\r\n                } else {\r\n                    incidenceDegree = firstLightComplex.getSectorAngle(Sector.Type.SurfaceOut) + secondLightComplex.getSectorAngle(Sector.Type.Incidence) * 2;\r\n                    incidenceDegree = 180 - incidenceDegree;\r\n                }\r\n                thirdLightComplex.setIncidencePos(incidencePosX);\r\n                //要设置完整的反射角度，否则异常\r\n                thirdLightComplex.setIncidenceXAxisAngle(incidenceDegree + this._surfaceVertical.getRotateAngle());\r\n                thirdLightComplex.resetAngle(this._surfaceVertical.getRotateAngle());\r\n                thirdLightComplex.around(this._surfaceVertical.getRotateAngle(), -SurfaceVerticalPadding.x, SurfaceVerticalPadding.tr);\r\n                var posWidth = GraphMath.getPythagoreanLineC(reflectionPos2.x - reflectionPos3.x, reflectionPos2.y - reflectionPos3.y);\r\n                secondLightComplex.setReflectionLineWidth(posWidth);\r\n                //thirdLightComplex.setIncidenceLineWidth(posWidth);\r\n                if (posWidth <= this._CONFIG.LightComplex[2].IncidenceLine.width) {\r\n                    thirdLightComplex.setIncidenceLineWidth(posWidth);\r\n                } else {\r\n                    thirdLightComplex.setIncidenceLineWidth(this._CONFIG.LightComplex[2].IncidenceLine.width);\r\n                }\r\n            } else {\r\n                thirdLightComplex.setIncidenceLineWidth(this._CONFIG.LightComplex[1].IncidenceLine.width);\r\n            }\r\n\r\n            this._lightComplexArray.setEnable(2, !!reflectionPos3);\r\n\r\n            //入射光线不能超出\r\n            var incidenceASurfacePos = GraphMath.getTwoLineIntersection(surfaceLine.a, surfaceLine.b, firstIncidenceLinePos.a, firstIncidenceLinePos.b);\r\n            if (incidenceASurfacePos) {\r\n                var width = GraphMath.getPythagoreanLineC(incidenceASurfacePos.x - firstIncidenceLinePos.a.x, incidenceASurfacePos.y - firstIncidenceLinePos.a.y);\r\n                var maxWidth = this._CONFIG.LightComplex[0].IncidenceLine.width;\r\n                firstLightComplex.setIncidenceLineWidth(width < maxWidth ? width : maxWidth);\r\n                if (width >= maxWidth) {\r\n                    firstLightComplex.setIncidenceLineArrowPos(this._CONFIG.LightComplex[0].IncidenceLine.arrowPos);\r\n                }\r\n            }\r\n\r\n            //最后一条反射光线不能超出\r\n            if (reflectionPos3) {\r\n                var thirdReflectionLine = this.getThirdLinePos(reflectionPos3);\r\n                var reflectionASurfacePos = GraphMath.getTwoLineIntersection(surfaceLine.a, surfaceLine.b, thirdReflectionLine.a, thirdReflectionLine.b);\r\n                if (reflectionASurfacePos) {\r\n                    var width = GraphMath.getPythagoreanLineC(reflectionPos3.x - reflectionASurfacePos.x, reflectionPos3.y - reflectionASurfacePos.y);\r\n                    var maxWidth = this._CONFIG.LightComplex[0].IncidenceLine.width;\r\n                    thirdLightComplex.setReflectionLineWidth(width < maxWidth ? width : maxWidth);\r\n                }\r\n            }\r\n\r\n            //入射角等于90不进行反射处理\r\n            if (Math.round(firstLightComplex.getIncidenceSurfaceAngle()) === 90) {\r\n                this._lightComplexArray.setEnable(1, false);\r\n                this._lightComplexArray.setEnable(2, false);\r\n            }\r\n            //判断是否显示夹角扇面\r\n            this.surfaceIntersect(firstIncidenceLinePos.a, reflectionPos2);\r\n\r\n            //更新链式节点公共线样式\r\n            this._lightComplexArray.changeChainLineCommonFill();\r\n        },\r\n        initExtrasDrawCommand: function () {\r\n            //交由基类处理\r\n            var that = this;\r\n            var length = this._lightComplexArray.getCommandLength();\r\n            this._lightComplexArray.pushDrawCommand(function (deffer) {\r\n                if (that._lightComplexArray.isPedalExcludeDisable()) {\r\n                    that._equalAngleNameHasShowBefore = true;\r\n                    that._equalAngleName.setVisibility(true);\r\n                }\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (!that._lightComplexArray.isPedalExcludeDisable()) {\r\n                    return true;\r\n                }\r\n                return !that._equalAngleName.isVisibilityHidden();\r\n            }, 0);\r\n\r\n\r\n            var pedalIndex = $.extend(true, [], this._config.LightComplex[0].PedalDrawIndex);\r\n            pedalIndex.splice(2, 0, length);\r\n            this._lightComplexArray.setPedalDrawIndex(pedalIndex, 0)\r\n        },\r\n        surfaceIntersect: function (pos1, pos2) {\r\n            var flag = false;\r\n            if (pos1) {\r\n                var surfaceLine = this.getSurfacePos(this._surface);\r\n                var length = GraphMath.getPedalHeight(surfaceLine.a, surfaceLine.b, pos1);\r\n                if (length <= 100) {\r\n                    for (var key in Sector.Type) {\r\n                        if (flag) {\r\n                            break;\r\n                        }\r\n                        flag = this.surfaceEachIntersect(this._lightComplexArray.get(0), pos1, Sector.Type[key], surfaceLine);\r\n                    }\r\n                }\r\n            }\r\n            if (pos2 && !flag && this._lightComplexArray.isEnableAndDraw(1)) {\r\n                var surfaceVerticalLine = this.getSurfacePos(this._surfaceVertical);\r\n                var length = GraphMath.getPedalHeight(surfaceVerticalLine.a, surfaceVerticalLine.b, pos2);\r\n                if (length <= 100) {\r\n                    for (var key in Sector.Type) {\r\n                        if (flag) {\r\n                            break;\r\n                        }\r\n                        flag = this.surfaceEachIntersect(this._lightComplexArray.get(1), pos2, Sector.Type[key], surfaceVerticalLine);\r\n                    }\r\n                }\r\n            }\r\n            this._lightComplexArray.setSectorEnable(!flag);\r\n            return flag;\r\n        },\r\n        surfaceEachIntersect: function (lightComplex, centerPos, sectorType, surfaceLine) {\r\n            var sectorR;\r\n            if (sectorType == Sector.Type.Reflection) {\r\n                sectorR = 75;\r\n            } else if (sectorType == Sector.Type.Incidence) {\r\n                sectorR = 65\r\n            } else {\r\n                sectorR = 55;\r\n            }\r\n            //计算线和圆的交点\r\n            var ps = GraphMath.getLineCircleIntersectionPos(surfaceLine.a, surfaceLine.b, centerPos, sectorR);\r\n            if (!ps) {\r\n                return false;\r\n            }\r\n            var linesPos = lightComplex.getSectorLinesPos(sectorType, centerPos);\r\n            //判断线与圆的交点是否和圆弧两点连接的线有交点\r\n            var sectorLinePos = {a: linesPos[0].b, b: linesPos[1].b};\r\n            var flag = false;\r\n            for (var i = 0; i < ps.length; i++) {\r\n                var psPos = ps[i];\r\n                if (flag) {\r\n                    break;\r\n                }\r\n                flag = GraphMath.getTwoLineIntersection(centerPos, psPos, sectorLinePos.a, sectorLinePos.b);\r\n            }\r\n\r\n            if (flag) {\r\n                return true;\r\n            }\r\n\r\n            //还要判断反射面是否和圆弧线段相交\r\n            for (var i = 0; i < linesPos.length; i++) {\r\n                var linePos = linesPos[i];\r\n                var p = GraphMath.getTwoLineIntersection(surfaceLine.a, surfaceLine.b, linePos.a, linePos.b);\r\n                if (p) {\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n        toCenter: function () {\r\n            this._$$container.setTranslate(this._option.viewPortWidth / 2 - this.getWidth() / 2 + 50, this._option.viewPortHeight / 2 + 200);\r\n        },\r\n        getWidth: function () {\r\n            return this._config.Surface.width;\r\n        },\r\n        drawAll: function () {\r\n            var that = this;\r\n            this._lightComplexArray.drawAll(undefined, function () {\r\n                that.mathLine();\r\n            });\r\n        },\r\n        drawNext: function () {\r\n            var that = this;\r\n            this._lightComplexArray.drawNext(undefined, function () {\r\n                that.mathLine();\r\n            });\r\n        }\r\n    });\r\n\r\n    return Reflector;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/15.\r\n */\r\ndefine('js/reflector/reflector6', ['js/reflector/reflector1'], function (Reflector1) {\r\n\r\n    var LightLine = require('js/view/LightLine');\r\n    var Surface = require('js/view/surface');\r\n\r\n    var Reflector = Reflector1.Extend({\r\n        _CONFIG: {\r\n            LightComplex: [{\r\n                IncidenceLine: {\r\n                    width: 370,//整体长度\r\n                    arrowPos: 140,//箭号所在位置\r\n                    defaultAngle: 120, rotateFixed: false, clickAble: true, rotateFixedAfterDraw: true\r\n                },\r\n                ReflectionLine: {\r\n                    visible: false, rotateFixed: false, clickAble: false,\r\n                    width: 370,\r\n                    arrowPos: 140\r\n                },\r\n                NormalLine: {lineVisible: false, pointNameVisible: false},\r\n                Sector: {sectorInVisible: true, sectorOutVisible: false, incidenceVisible: false, reflectionVisible: false, letterR: 110, angleR: 180},\r\n                IncidencePosX: 520 / 2,//入射点位置\r\n                DrawIndex: [[0, 1, 2, 3], [4, 5, 6], [7, 11], [8, 9]],\r\n                PedalDrawIndex: [[0, 1, 2], [4, 5, 6], [7, 9, 10]],\r\n                Visible: true,\r\n                StaticLine: [{\r\n                    width: 370,//整体长度\r\n                    arrowPos: 170,//箭号所在位置\r\n                    defaultAngle: 60,//默认角度\r\n                    visible: true,//是否显示\r\n                    clickAble: false,//是否允许点击和移动\r\n                    rotateFixed: true,//是否旋转时，固定不动\r\n                    autoAdsorption: true,//是否自动吸附\r\n                    arrowReverse: true,//箭头反转\r\n                    lineType: LightLine.Type.Reverse\r\n                }, {\r\n                    width: 370,//整体长度\r\n                    arrowPos: 170,//箭号所在位置\r\n                    defaultAngle: 120,//默认角度\r\n                    visible: true,//是否显示\r\n                    clickAble: false,//是否允许点击和移动\r\n                    rotateFixed: true,//是否旋转时，固定不动\r\n                    autoAdsorption: true,\r\n                    arrowReverse: false,\r\n                    lineType: LightLine.Type.Reverse\r\n                }]\r\n            }],\r\n            Surface: {\r\n                width: 520,\r\n                defaultAngle: 0,\r\n                rotatePosX: 520 / 2,\r\n                visible: true,\r\n                clickAble: true,\r\n                type: Surface.Type.tl\r\n            }\r\n        },\r\n        _TYPE: 6\r\n    });\r\n\r\n    return Reflector;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/5.\r\n */\r\ndefine('js/reflector/reflectorFactory', ['js/base/base', 'js/reflector/reflector1', 'js/reflector/reflector2', 'js/reflector/reflector3', 'js/reflector/reflector4', 'js/reflector/reflector5', 'js/reflector/reflector6'], function (Base, Reflector1, Reflector2, Reflector3, Reflector4, Reflector5, Reflector6) {\r\n\r\n    var ReflectorFactory = {\r\n        getReflector: function (type, eventBus, $$container, option, data) {\r\n            if (type === 1) {\r\n                return Reflector1.create(eventBus, $$container, option, data);\r\n            } else if (type === 2) {\r\n                return Reflector2.create(eventBus, $$container, option, data);\r\n            } else if (type === 3) {\r\n                return Reflector3.create(eventBus, $$container, option, data);\r\n            } else if (type === 4) {\r\n                return Reflector4.create(eventBus, $$container, option, data);\r\n            } else if (type === 5) {\r\n                return Reflector5.create(eventBus, $$container, option, data);\r\n            } else if (type === 6) {\r\n                return Reflector6.create(eventBus, $$container, option, data);\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    return ReflectorFactory;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/reflector/reflectorMain', ['js/base/Base', 'js/utils/eventBus', 'js/utils/string', 'js/utils/utils', 'js/config/eventKey', 'js/reflector/reflectorFactory', 'js/utils/view'], function (Base, EventBus, String, Utils, EventKey, ReflectorFactory, View) {\r\n\r\n    var DomEvent = require('js/reflector/domEvent');\r\n    var Lang = require('js/config/lang');\r\n    var VERSION = '1.0.0';\r\n\r\n    var _templateHtml = '<div class=\"${cls}\" id=\"${id}\"></div>';\r\n\r\n    var ViewPort = {\r\n        x: 0,\r\n        y: 0,\r\n        width: 1520,\r\n        height: 896\r\n    };\r\n\r\n    var OPTION = {\r\n        create: function (option) {\r\n            var instance = Object.create(this);\r\n            for (var key in option) {\r\n                if (key === 'langData') {\r\n                    instance[key] = $.extend(true, {}, Lang, option.langData);\r\n                } else {\r\n                    instance[key] = option[key];\r\n                }\r\n            }\r\n            return instance;\r\n        },\r\n        viewPortWidth: ViewPort.width,\r\n        viewPortHeight: ViewPort.height,\r\n        reflectorType: [1, 2, 3, 4, 5],\r\n        nameVisible: true,\r\n        surfaceAngleVisible: true,\r\n        normalAngleVisible: true,\r\n        reflector5NameEnable: false,//默认不显示预设五的名称\r\n        lock: false,//是否锁定\r\n        langData: Lang,//默认中文\r\n        showDefaultRotateBtn: false\r\n    };\r\n\r\n\r\n    var ReflectorMain = Base({\r\n        _$$paper: null,\r\n        _$$paperItems: [],\r\n        _reflectors: [],\r\n        _currentIndex: 0,\r\n        _id: null,\r\n        _lock: false,\r\n        _init: false,\r\n        create: function (option) {\r\n            var eventBus = EventBus.create();\r\n            var instance = Object.create(this);\r\n            //创建配置\r\n            instance._option = OPTION.create(option);\r\n            instance._id = Utils.getUuid();\r\n            instance._$$paper = [];\r\n            instance._$$paperItems = [];\r\n            instance._reflectors = [];\r\n            instance.__base(eventBus, []);\r\n            instance.__on('insidechange', function (p) {\r\n                if (instance._init) {\r\n                    instance.__triggerEvent('change', p);\r\n                }\r\n            });\r\n            return instance;\r\n        },\r\n        render: function (obj) {\r\n            this._init = false;\r\n            var type = typeof  obj;\r\n            if (type === 'string') {\r\n                obj = document.getElementById(obj);\r\n            } else if (type === 'object') {\r\n                if (obj instanceof jQuery) {\r\n                    obj = obj[0];\r\n                }\r\n            }\r\n            var $mainHtml = $(String.template(_templateHtml, {cls: 'fm', id: this._id}));\r\n            $(obj).html($mainHtml);\r\n            this._paper = new kity.Paper($mainHtml[0]);\r\n            this._paper.setViewBox(0, 0, this._option.viewPortWidth, this._option.viewPortHeight);\r\n            //绑定事件\r\n            var domEvent = DomEvent.create(this._paper, this.__getEventBus(), this._option);\r\n            domEvent.bindDomEvent();\r\n            this.createReflector();\r\n            this._init = true;\r\n            this.__triggerEvent('insidechange', 'init');\r\n        },\r\n        createReflector: function () {\r\n            var that = this;\r\n\r\n            this._reflectors = [];\r\n            this._$$paperItems = [];\r\n\r\n            var __create = function (index, type, data) {\r\n                var $$item = new kity.Group().setId('item_' + index);\r\n                $$item.setAttr('class', '_lr_item');\r\n                that._$$paperItems.push($$item);\r\n                that._paper.addShape($$item);\r\n                //add reflector\r\n                var reflector = ReflectorFactory.getReflector(type, that.__getEventBus(), $$item, that._option, data);\r\n                View.setVisibility($$item, index === that._currentIndex);\r\n                that._reflectors.push(reflector);\r\n                return reflector;\r\n            };\r\n\r\n            if (this._data && this._data.data && this._data.data.length > 0) {\r\n                var data = this._data.data;\r\n                for (var i = 0; i < data.length; i++) {\r\n                    var reflectorData = data[i];\r\n                    var reflector = __create(i, reflectorData.type, reflectorData);\r\n                    //reflector.renderData(reflectorData);\r\n                }\r\n            } else {\r\n                for (var i = 0; i < this._option.reflectorType.length; i++) {\r\n                    var type = this._option.reflectorType[i];\r\n                    __create(i, type);\r\n                }\r\n            }\r\n        },\r\n        setData: function (data) {\r\n            if (!data.version || !data.data) {\r\n                return;\r\n            }\r\n            this._data = data;\r\n        },\r\n        getData: function () {\r\n            var data = {};\r\n            data.version = VERSION;\r\n            data.data = [];\r\n            data.currentIndex = this._currentIndex;\r\n            this._reflectors.forEach(function (reflector) {\r\n                if (reflector) {\r\n                    data.data.push(reflector.getData());\r\n                }\r\n            });\r\n            data.option = {\r\n                nameVisible: this._option.nameVisible,\r\n                surfaceAngleVisible: this._option.surfaceAngleVisible,\r\n                normalAngleVisible: this._option.normalAngleVisible\r\n            };\r\n            return data;\r\n        },\r\n        /**\r\n         * 目前支持 change、\r\n         * @param type\r\n         * @param callback\r\n         * @param domain\r\n         */\r\n        on: function (type, callback, domain) {\r\n            this.__getEventBus().on(type, callback, domain);\r\n        },\r\n        off: function (type, callback, domain) {\r\n            this.__getEventBus().off(type, callback, domain);\r\n        },\r\n        show: function (index) {\r\n            this.__triggerEvent(EventKey.Blur);\r\n            this._currentIndex = index;\r\n            this._$$paperItems.forEach(function ($$item, i) {\r\n                View.setVisibility($$item, index === i);\r\n            });\r\n            this.__triggerEvent('insidechange', 'showChange');\r\n        },\r\n        getCurrentIndex: function () {\r\n            return this._currentIndex;\r\n        },\r\n        //反射面角度\r\n        setSurfaceAngleVisible: function (visible) {\r\n            this._option.surfaceAngleVisible = visible;\r\n            this.__triggerEvent(EventKey.SurfaceAngleVisible, visible);\r\n        },\r\n        getSurfaceAngleVisible: function () {\r\n            return this._option.surfaceAngleVisible;\r\n        },\r\n        //与发现夹角\r\n        setNormalAngleVisible: function (visible) {\r\n            this._option.normalAngleVisible = visible;\r\n            this.__triggerEvent(EventKey.NormalAngleVisible, visible);\r\n        },\r\n        getNormalAngleVisible: function () {\r\n            return this._option.normalAngleVisible;\r\n        },\r\n        //名称\r\n        setNameVisible: function (visible) {\r\n            this._option.nameVisible = visible;\r\n            this.__triggerEvent(EventKey.NameVisible, visible);\r\n        },\r\n        //名称是否显示\r\n        getNameVisible: function () {\r\n            return this._option.nameVisible;\r\n        },\r\n        getCurrentReflector: function () {\r\n            return this._reflectors[this._currentIndex];\r\n        },\r\n        //一步画\r\n        drawAll: function () {\r\n            this.__triggerEvent(EventKey.Blur);\r\n            this.getCurrentReflector().drawAll();\r\n        },\r\n        //逐步画\r\n        drawNext: function () {\r\n            this.__triggerEvent(EventKey.Blur);\r\n            this.getCurrentReflector().drawNext();\r\n        },\r\n        //是否有下一步\r\n        hasNext: function () {\r\n            return this.getCurrentReflector().hasNext();\r\n        },\r\n        updatePos: function () {\r\n            this._reflectors.forEach(function (reflector) {\r\n                if (reflector) {\r\n                    reflector.updatePos();\r\n                }\r\n            });\r\n        },\r\n        reset: function (option) {\r\n            $.extend(this._option, option);\r\n\r\n            this._$$paperItems[this._currentIndex].clear();\r\n            //var $$item = this._$$paperItems[this._currentIndex] = new kity.Group().setId('item_' + this._currentIndex);\r\n            //$$item.setAttr('class', '_lr_item');\r\n            //this._paper.addShape($$item);\r\n            var reflector = ReflectorFactory.getReflector(this._reflectors[this._currentIndex].getType(), this.__getEventBus(), this._$$paperItems[this._currentIndex], this._option, {});\r\n            this._reflectors[this._currentIndex] = reflector;\r\n            this.__triggerEvent('insidechange', 'reset');\r\n        },\r\n        setLock: function (lock) {\r\n            this._option.lock = lock;\r\n        },\r\n        destroy: function () {\r\n\r\n        }\r\n    });\r\n\r\n\r\n    return ReflectorMain;\r\n\r\n});\n/**\r\n * 动画命令执行队列\r\n * Created by ylf on 2016/8/5.\r\n */\r\n\r\n\r\ndefine('js/utils/drawCommand', ['js/utils/logger'], function (Logger) {\r\n\r\n    var Command = {\r\n        _queue: [],\r\n        _hasDrawQueue: [],\r\n        _drawIndex: [],\r\n        _currentIndex: 0,\r\n        _maxLength: 100,\r\n        _stopCallback: null,\r\n        _stopFlag: false,\r\n        _drawing: false,\r\n        create: function () {\r\n            var instance = Object.create(this);\r\n            instance._queue = [];\r\n            instance._drawIndex = [];\r\n            instance._hasDrawQueue = [];\r\n            return instance;\r\n        },\r\n        push: function (draw, hasDraw) {\r\n            this._queue.push(this.makeAsPromise(draw));\r\n            this._hasDrawQueue.push(hasDraw);\r\n        },\r\n        setCurrentIndex: function (index) {\r\n            this._currentIndex = index;\r\n        },\r\n        drawNext: function (callback, animate, force) {\r\n            var that = this;\r\n            if (this._drawing && force !== true) {\r\n                Logger.debug('draw', '正在绘制中，不能提交新的绘制命令');\r\n                callback && callback(that._currentIndex);\r\n                return;\r\n            }\r\n            if (this.hasNext()) {\r\n                this._drawing = true;\r\n                var hasDraw = this.hasDraw(this._currentIndex);\r\n                if (hasDraw) {\r\n                    this._currentIndex++;\r\n                    this.drawNext(callback, animate, true);\r\n                    this._drawing = false;\r\n                    return;\r\n                }\r\n                var tasks = this.getTask(this._currentIndex);\r\n                this._currentIndex++;\r\n                var doneCallBack = function () {\r\n                    that._drawing = false;\r\n                    that._stopCallback && that._stopCallback();\r\n                    callback && callback(that._currentIndex);\r\n                };\r\n                //TODO:这个地方先写死四个,待优化\r\n                if (tasks.length === 1) {\r\n                    $.when(tasks[0](animate)).done(doneCallBack);\r\n                } else if (tasks.length === 2) {\r\n                    $.when(tasks[0](animate), tasks[1](animate)).done(doneCallBack);\r\n                } else if (tasks.length === 3) {\r\n                    $.when(tasks[0](animate), tasks[1](animate), tasks[2](animate)).done(doneCallBack);\r\n                } else if (tasks.length === 4) {\r\n                    $.when(tasks[0](animate), tasks[1](animate), tasks[2](animate), tasks[3](animate)).done(doneCallBack);\r\n                }\r\n                return true;\r\n            } else {\r\n                Logger.debug('draw', '已经没有更多命令需要绘制');\r\n                callback && callback(that._currentIndex);\r\n                return false;\r\n            }\r\n        },\r\n        getTask: function (index) {\r\n            var that = this;\r\n            var actualIndex = this._drawIndex[index];\r\n            var task = [];\r\n            if (actualIndex instanceof Array) {\r\n                actualIndex.forEach(function (i) {\r\n                    task.push(that._queue[i]);\r\n                })\r\n            } else {\r\n                task.push(that._queue[actualIndex]);\r\n            }\r\n            return task;\r\n        },\r\n        hasNext: function () {\r\n            var hasNext = false;\r\n            for (var i = 0; i < this._drawIndex.length; i++) {\r\n                var hasDraw = this.hasDraw(i);\r\n                if (!hasDraw) {\r\n                    hasNext = true;\r\n                }\r\n            }\r\n            return hasNext;\r\n            //if (this._drawIndex.length > 0) {\r\n            //    return this._currentIndex <= this._drawIndex.length - 1;\r\n            //}\r\n            //return this._currentIndex <= this._queue.length - 1;\r\n        },\r\n        drawAll: function (callback, animate) {\r\n            for (var i = 0; i < this._drawIndex.length; i++) {\r\n                var tasks = this.getTask(i);\r\n                tasks.forEach(function (task) {\r\n                    task(animate);\r\n                })\r\n            }\r\n            callback && callback();\r\n        },\r\n        setDrawIndex: function (drawIndex) {\r\n            if (!this._drawing) {\r\n                this._drawIndex = drawIndex;\r\n                this._currentIndex = 0;\r\n            }\r\n        },\r\n        stop: function (stopCallBack) {\r\n            if (!this._drawing) {\r\n                this._stopFlag = true;\r\n                stopCallBack && stopCallBack();\r\n                return;\r\n            }\r\n            this._stopFlag = true;\r\n            this._stopCallback = stopCallBack;\r\n        },\r\n        hasDraw: function (index) {\r\n            var that = this;\r\n            var actualIndex = this._drawIndex[index];\r\n            var hasDraw = true;\r\n            if (actualIndex instanceof Array) {\r\n                actualIndex.forEach(function (i) {\r\n                    if (hasDraw) {\r\n                        hasDraw = that._hasDrawQueue[i]();\r\n                    }\r\n                })\r\n            } else {\r\n                hasDraw = that._hasDrawQueue[actualIndex]();\r\n            }\r\n            return hasDraw;\r\n        },\r\n        makeAsPromise: function (callBack) {\r\n            return function () {\r\n                var deffer = $.Deferred();\r\n                var arg = Array.prototype.slice.apply(arguments, [0]);\r\n                arg.unshift(deffer);\r\n                callBack.apply(this, arg);\r\n                return deffer.promise();\r\n            }\r\n        },\r\n        getCommandLength: function () {\r\n            return this._queue.length;\r\n        }\r\n    };\r\n\r\n    return Command;\r\n});\n/**\r\n * Created by ylf on 2016/7/22.\r\n * 事件管理对象\r\n */\r\ndefine('js/utils/eventBus', ['js/utils/logger'], function (Logger) {\r\n\r\n    var EventBus = {\r\n        _eventHandler: null,\r\n        create: function () {\r\n            var instance = Object.create(this);\r\n            instance._eventHandler = {};\r\n            return instance;\r\n        },\r\n        trigger: function () {\r\n            //将参数转换为数组\r\n            var arg = Array.prototype.slice.apply(arguments, [0]);\r\n            //取第一个，并从数组中删除，事件key\r\n            var type = arg.shift();\r\n            if (!this._eventHandler || !this._eventHandler[type]) {\r\n                return false;\r\n            }\r\n            var handlers = this._eventHandler[type];\r\n            handlers.forEach(function (handler) {\r\n                handler.cb.apply(handler.domain || this, arg);\r\n                Logger.debug('event-trigger', type, arg.toString());\r\n            });\r\n            return true;\r\n        },\r\n        on: function (type, callback, domain) {\r\n            if (!this._eventHandler[type]) {\r\n                this._eventHandler[type] = [];\r\n            }\r\n            this._eventHandler[type].push({cb: callback, domain: domain});\r\n            return true;\r\n        },\r\n        off: function (type, callback, domain) {\r\n            var handlers = this._eventHandler[type];\r\n            if (handlers && handlers.length > 0) {\r\n                var len = handlers.length;\r\n                var handler;\r\n                for (var i = 0; i < len; i++) {\r\n                    handler = handlers[i];\r\n                    if (handler && callback === handler.cb) {\r\n                        if (domain && domain !== handler.domain) {\r\n                            continue;\r\n                        }\r\n                        handlers.splice(i, 1);\r\n                        i--;\r\n                        len--;\r\n                    }\r\n                }\r\n            }\r\n            if (handlers && handlers.length === 0) {\r\n                delete  this._eventHandler[type];\r\n            }\r\n        }\r\n    };\r\n    return EventBus;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/utils/eventUtils', function () {\r\n\r\n    var EventUtils = {\r\n        isDown: function (type) {\r\n            return type === 'touchstart' || type === 'mousedown';\r\n        },\r\n        isUp: function (type) {\r\n            return /^(touchend|touchcancel|mouseup|mouseleave)$/.test(type);\r\n        },\r\n        isMove: function (type) {\r\n            return type === 'mousemove' || type === 'touchmove';\r\n        },\r\n        isTouch: function (type) {\r\n            return /^(touchend|touchcancel|touchstart|touchmove)$/.test(type);\r\n        },\r\n        getPagePos: function (ev) {\r\n            var ev = ev.originalEvent ? ev.originalEvent : ev;\r\n            var point = {};\r\n            switch (ev.type) {\r\n                case 'touchstart':\r\n                case 'touchmove':\r\n                case 'touchend':\r\n                case 'touchcancel':\r\n                    point.x = ev.changedTouches[0].pageX;\r\n                    point.y = ev.changedTouches[0].pageY;\r\n                    return point;\r\n                default:\r\n                    point.x = ev.pageX;\r\n                    point.y = ev.pageY;\r\n                    return point;\r\n            }\r\n            return point;\r\n        },\r\n        /**\r\n         * 修复pc上移动后还可以触发点击事件的bug\r\n         */\r\n        fixPcClick: function (startPos, endPos, startTime, endTime) {\r\n            var _holdTime = endTime - startTime;\r\n            var dx = Math.abs(endPos.x - startPos.x);\r\n            var dy = Math.abs(endPos.y - startPos.y);\r\n            if (_holdTime > 800 || dx >= 4 || dy >= 4) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    };\r\n    return EventUtils;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n */\r\ndefine('js/utils/graphMath', function () {\r\n\r\n    var GraphMath = {\r\n        /**\r\n         * 获取两条线的交点位置和坐标\r\n         * @param line1 {k:0.5,b:2}\r\n         * @param line2 kb\r\n         * @returns {*}\r\n         */\r\n        getTwoLineIntersection: function (a, b, c, d) {\r\n\r\n            /** 1 解线性方程组, 求线段交点. **/\r\n            // 如果分母为0 则平行或共线, 不相交\r\n            var denominator = (b.y - a.y) * (d.x - c.x) - (a.x - b.x) * (c.y - d.y);\r\n            if (denominator == 0) {\r\n                return false;\r\n            }\r\n\r\n            // 线段所在直线的交点坐标 (x , y)\r\n            var x = ( (b.x - a.x) * (d.x - c.x) * (c.y - a.y)\r\n                + (b.y - a.y) * (d.x - c.x) * a.x\r\n                - (d.y - c.y) * (b.x - a.x) * c.x ) / denominator;\r\n            var y = -( (b.y - a.y) * (d.y - c.y) * (c.x - a.x)\r\n                + (b.x - a.x) * (d.y - c.y) * a.y\r\n                - (d.x - c.x) * (b.y - a.y) * c.y ) / denominator;\r\n\r\n            /** 2 判断交点是否在两条线段上 **/\r\n            if (\r\n                // 交点在线段1上\r\n            Math.round((x - a.x) * (x - b.x)) <= 0 && Math.round((y - a.y) * (y - b.y)) <= 0\r\n                // 且交点也在线段2上\r\n            && Math.round((x - c.x) * (x - d.x)) <= 0 && Math.round((y - c.y) * (y - d.y)) <= 0\r\n            ) {\r\n\r\n                // 返回交点p\r\n                return {\r\n                    x: x,\r\n                    y: y\r\n                }\r\n            }\r\n            //否则不相交\r\n            return false\r\n        },\r\n        /**\r\n         * 获取弧度\r\n         * @param degree 角度\r\n         * @returns {number}\r\n         */\r\n        getRadian: function (degree) {\r\n            return (2 * Math.PI) / 360 * degree;\r\n        },\r\n        /**\r\n         * 获取角度\r\n         * @param degree 弧度\r\n         * @returns {number}\r\n         */\r\n        getDegree: function (radian) {\r\n            return (radian * 360) / (2 * Math.PI);\r\n        },\r\n        /**\r\n         * 获取直接kb值\r\n         * @param degree 与x轴角度\r\n         * @param pos 线上的一点\r\n         */\r\n        getLineKb: function (degree, pos) {\r\n            var kb = {};\r\n            if (degree > 90) {\r\n                kb.k = Math.tan(this.getRadian(180 - degree));\r\n                kb.k = -kb.k;\r\n            } else {\r\n                kb.k = Math.tan(this.getRadian(degree));\r\n            }\r\n            //pos.y = k * pos.x + b;\r\n            kb.b = pos.y - kb.k * pos.x;\r\n            return kb;\r\n        }\r\n        ,\r\n        /**\r\n         * 获取弧长\r\n         * @param degree 角度\r\n         * @param r 半径\r\n         * @returns {number}\r\n         */\r\n        getArc: function (degree, r) {\r\n            return (2 * Math.PI * r * degree) / 360;\r\n        },\r\n        /**\r\n         * 获取差积\r\n         * @param originPos 焦点、原始坐标\r\n         * @param startPos  相对开始坐标\r\n         * @param endPos 结束坐标\r\n         * @returns {number}\r\n         */\r\n        getDifferent: function (originPos, startPos, endPos) {\r\n            var startVector = {\r\n                x: startPos.x - originPos.x,\r\n                y: startPos.y - originPos.y\r\n            };\r\n            var endVector = {\r\n                x: endPos.x - originPos.x,\r\n                y: endPos.y - originPos.y\r\n            };\r\n            return parseFloat(startVector.x * endVector.y) - parseFloat(endVector.x * startVector.y);//叉积\r\n        },\r\n        /**\r\n         * 余弦定理，已知三边，求角度\r\n         * @param a\r\n         * @param b\r\n         * @param c\r\n         * @returns {Number}\r\n         */\r\n        getCosineAngle: function (a, b, c) {\r\n            //余弦定理\r\n            //由余弦定理得a²=b²+c²-2bc*CosA\r\n            //∴CosA=(b²+c²-a²)/(2bc)=7/8\r\n            var cosA = (Math.pow(b, 2) + Math.pow(c, 2) - Math.pow(a, 2)) / (2 * b * c);\r\n            // 得到弧度\r\n            var acosA = Math.acos(cosA);\r\n            // 弧度转角度\r\n            //1弧度=180/π度\r\n            //1度=π/180弧度\r\n            return parseFloat(acosA * (180 / Math.PI));\r\n        },\r\n        getCosineAngleByPos: function (aPos, bPos, cPos) {\r\n            var a, b, c;\r\n            a = parseFloat(Math.sqrt(Math.pow(bPos.x - cPos.x, 2) + Math.pow(bPos.y - cPos.y, 2)));\r\n            b = parseFloat(Math.sqrt(Math.pow(bPos.x - aPos.x, 2) + Math.pow(bPos.y - aPos.y, 2)));\r\n            c = parseFloat(Math.sqrt(Math.pow(cPos.x - aPos.x, 2) + Math.pow(cPos.y - aPos.y, 2)));\r\n            return this.getCosineAngle(a, b, c);\r\n        },\r\n        /**\r\n         * 勾股定理，求C边的值\r\n         * @param a a边长\r\n         * @param b b边长\r\n         * @returns {number}\r\n         */\r\n        getPythagoreanLineC: function (a, b) {\r\n            return Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));\r\n        },\r\n        /**\r\n         * 已知角度和斜边长，求斜边坐标\r\n         * @param a a边长\r\n         * @param b b边长\r\n         * @returns {number}\r\n         */\r\n        getLinePosByAngle: function (angle, width) {\r\n            //TODO:确认一下角度超过90度时候的值是否是对称的\r\n            if (angle > 90) {\r\n                angle = 180 - angle;\r\n            }\r\n            var x = Math.cos(this.getRadian(angle)) * width;\r\n            var y = Math.sin(this.getRadian(angle)) * width;\r\n            return {x: x, y: y};\r\n        },\r\n        /**\r\n         * 获取svg扇形路径信息\r\n         * @param cx 旋转中心点 x坐标\r\n         * @param cy 旋转中心点 y坐标\r\n         * @param r 旋转半径\r\n         * @param startAngle 开始角度\r\n         * @param endAngle 结束角度\r\n         * @returns {string}\r\n         */\r\n        getSvgSectorPoint: function (cx, cy, r, startAngle, endAngle) {\r\n            var rad = Math.PI / 180;\r\n            var x1 = cx + r * Math.cos(-startAngle * rad),        //起始X点\r\n                y1 = cy + r * Math.sin(-startAngle * rad),        //起始Y点\r\n                x2 = cx + r * Math.cos(-endAngle * rad),        //结束X点\r\n                y2 = cy + r * Math.sin(-endAngle * rad);        //结束Y点\r\n            var ar = [];\r\n            ar.push('M');\r\n            ar.push(cx);\r\n            ar.push(cy);\r\n            ar.push(\"L\");\r\n            ar.push(x1);\r\n            ar.push(y1);\r\n            ar.push(\"A\");\r\n            ar.push(r);\r\n            ar.push(r);\r\n            ar.push(0);\r\n            ar.push(+(endAngle - startAngle > 180));\r\n            ar.push(0);\r\n            ar.push(x2);\r\n            ar.push(y2);\r\n            ar.push('z');\r\n            return ar.join(' ');\r\n        }\r\n        ,\r\n        /**\r\n         * 获取两点距离\r\n         * @param pos1 {x:100,y:100}\r\n         * @param pos2\r\n         * @returns {number}\r\n         */\r\n        getTwoPointDistance: function (pos1, pos2) {\r\n            var x = pos2.x - pos1.x,\r\n                y = pos2.y - pos1.y;\r\n            return Math.sqrt((x * x) + (y * y));\r\n        }\r\n        ,\r\n        /**\r\n         * 求点在圆上的坐标\r\n         * @param degree 角度\r\n         * @param r 半径\r\n         * @returns {{x: number, y: number}}\r\n         */\r\n        getSpherePos: function (degree, r) {\r\n\r\n            var x1 = 0 + r * Math.cos(degree * Math.PI / 180);\r\n            var y1 = 0 + r * Math.sin(degree * Math.PI / 180);\r\n\r\n            return {\r\n                x: x1,\r\n                y: y1\r\n            };\r\n        }\r\n        ,\r\n        /**\r\n         * 计算点a到线段bc的最短距离\r\n         * @param posa\r\n         * @param posb\r\n         * @param posc\r\n         */\r\n        getShortestDistanceAndPoint: function (posa, posb, posc) {\r\n            var ab = this.getTwoPointDistance(posa, posb);\r\n            var ac = this.getTwoPointDistance(posa, posc);\r\n            var bc = this.getTwoPointDistance(posb, posc);\r\n            var halfPerimeter = (ab + ac + bc) / 2;//半周长\r\n            //求面积：海伦公式\r\n            var S = Math.sqrt(halfPerimeter * (halfPerimeter - ab) * (halfPerimeter - ac) * (halfPerimeter - bc));\r\n            //另外一个面积公式： 底*高/2\r\n            var height = (2 * S) / bc;\r\n            //判断高是否在三角形内\r\n            var thirdLong = Math.max(ab, ac);\r\n            var hc = Math.sqrt((thirdLong * thirdLong) - (height * height));//计算高垂足点到c的位置\r\n            //计算出来的长度大于底边，在外部\r\n            var shortestDistance = 0;\r\n            var shortestPos = {};\r\n            if (hc > bc) {\r\n                shortestDistance = Math.min(ac, ab);\r\n                if (ac > ab) {\r\n                    shortestDistance = ab;\r\n                    shortestPos = posb;\r\n                } else {\r\n                    shortestDistance = ac;\r\n                    shortestPos = posc;\r\n                }\r\n            } else {\r\n                //返回最短距离\r\n                shortestDistance = height;\r\n                shortestPos = this.getRectVerticalPos(posa, posb, posc, height);//\r\n            }\r\n            return {\r\n                d: shortestDistance,//最短距离\r\n                pos: shortestPos,//高在a边上的坐标\r\n                h: height,//高\r\n                minSide: Math.min(ab, ac)\r\n            }\r\n        }\r\n        ,\r\n        /**\r\n         * 特例（矩形上的）已知直角对应的两点和两侧线长，求直接坐标\r\n         * @param pos1\r\n         * @param pos2\r\n         */\r\n        getRectVerticalPos: function (posa, posb, posc, height) {\r\n            var x = 0, y = 0;\r\n            if (posb.x === posc.x) {\r\n                x = posb.x;\r\n                y = posa.y;\r\n            } else if (posb.y = posc.y) {\r\n                y = posb.y;\r\n                x = posa.x;\r\n            }\r\n            return {\r\n                x: x,\r\n                y: y\r\n            }\r\n        }\r\n        ,\r\n        /**\r\n         * 计算点离矩形最短距离\r\n         * @param posa 点\r\n         * @param rect 矩形 {left:,top,right,bottom}\r\n         * @returns {number}\r\n         */\r\n        getRectShortestDistance: function (posa, rect) {\r\n            //上\r\n            var s = this.getShortestDistanceAndPoint(posa, {x: rect.left, y: rect.top}, {x: rect.right, y: rect.top});\r\n            //右\r\n            var y = this.getShortestDistanceAndPoint(posa, {x: rect.right, y: rect.top}, {x: rect.right, y: rect.bottom});\r\n            //下\r\n            var x = this.getShortestDistanceAndPoint(posa, {x: rect.left, y: rect.bottom}, {x: rect.right, y: rect.bottom});\r\n            //左\r\n            var z = this.getShortestDistanceAndPoint(posa, {x: rect.left, y: rect.top}, {x: rect.left, y: rect.bottom});\r\n\r\n            var target = s;\r\n\r\n            var d = Math.min(s.d, y.d, x.d, z.d);\r\n            if (d === s.d) {\r\n                target = s;\r\n                target.vertical = true;\r\n                target.direction = 'top';\r\n            }\r\n            if (d === y.d) {\r\n                target = y;\r\n                target.vertical = false;\r\n                target.direction = 'right';\r\n            }\r\n            if (d === x.d) {\r\n                target = x;\r\n                target.vertical = true;\r\n                target.direction = 'bottom';\r\n            }\r\n            if (d === z.d) {\r\n                target = z;\r\n                target.vertical = false;\r\n                target.direction = 'left';\r\n            }\r\n            return target;\r\n        }\r\n        ,\r\n        /**\r\n         * 定比点公式，获取线段上的第三点坐标\r\n         * @param posa 点a\r\n         * @param posb 点b\r\n         * @param ca 点c到a的距离\r\n         * @returns {{x: (number|*), y: (number|*)}}\r\n         */\r\n        getLightPos: function (posa, posb, ca) {\r\n            //http://www.zybang.com/question/0f4a343e136e33929290d3d599fc1d7c.html\r\n            var m, n;\r\n            var s = ca;\r\n            var a = posa.x;\r\n            var b = posa.y;\r\n            var c = posb.x;\r\n            var d = posb.y;\r\n\r\n            var M = this.getTwoPointDistance(posa, posb);\r\n            var la = s / (Math.sqrt(Math.pow((a - c), 2) + Math.pow((b - d), 2)) - s);\r\n            m = (a + la * c) / (1 + la);\r\n            n = (b + la * d) / (1 + la);\r\n            return {\r\n                x: m,\r\n                y: n\r\n            }\r\n        }\r\n        ,\r\n        /**\r\n         * 根据三点获取旋转角度\r\n         * @param posa 中心点\r\n         * @param posb 上一个点\r\n         * @param posc 当前点\r\n         * @returns {*}\r\n         */\r\n        getRotateAngle: function (posa, posb, posc) {\r\n            //通过三点计算旋转角度\r\n            var angle = this.getCosineAngleByPos(posa, posb, posc);\r\n            //计算三点的差积，判断旋转方向\r\n            var different = this.getDifferent(posa, posb, posc);\r\n            if (different < 0) {\r\n                angle = -angle;\r\n            }\r\n            return angle;\r\n        },\r\n        /**\r\n         * http://blog.csdn.net/fly542/article/details/6638299\r\n         * 已知三点，求第三点到另外两点组成的垂线长度\r\n         * @param pos1\r\n         * @param pos2\r\n         * @param pos3\r\n         * @returns {number}\r\n         */\r\n        getPedalHeight: function (pos1, pos2, pos3) {\r\n            var A = (pos1.y - pos2.y) / (pos1.x - pos2.x);\r\n            var B = (pos1.y - A * pos1.y);\r\n            /// > 0 = ax +b -y;\r\n            return Math.abs(A * pos3.x + B - pos3.y) / Math.sqrt(A * A + 1);\r\n        },\r\n        /**\r\n         * 获取圆和线段的交点\r\n         * http://blog.csdn.net/luols/article/details/7476512\r\n         * @param ptStart 线起点\r\n         * @param ptEnd 线终点\r\n         * @param ptCenter 原心\r\n         * @param Radius 半径\r\n         * @returns {boolean}\r\n         * @constructor\r\n         */\r\n        getLineCircleIntersectionPos: function (ptStart, ptEnd, ptCenter, Radius) {\r\n            var EPS = 0.00001;\r\n            var ptInter1 = {};\r\n            var ptInter2 = {};\r\n            var fDis = Math.sqrt((ptEnd.x - ptStart.x) * (ptEnd.x - ptStart.x) + (ptEnd.y - ptStart.y) * (ptEnd.y - ptStart.y));\r\n            var d = {};\r\n            d.x = (ptEnd.x - ptStart.x) / fDis;\r\n            d.y = (ptEnd.y - ptStart.y) / fDis;\r\n            var E = {};\r\n            E.x = ptCenter.x - ptStart.x;\r\n            E.y = ptCenter.y - ptStart.y;\r\n            var a = E.x * d.x + E.y * d.y;\r\n            var a2 = a * a;\r\n            var e2 = E.x * E.x + E.y * E.y;\r\n            var Radius2 = Radius * Radius;\r\n            if ((Radius2 - e2 + a2) < 0) {\r\n                return false;\r\n            }\r\n            else {\r\n                var f = Math.sqrt(Radius2 - e2 + a2);\r\n                var t = a - f;\r\n                if (((t - 0.0) > -EPS) && (t - fDis) < EPS) {\r\n                    ptInter1.x = ptStart.x + t * d.x;\r\n                    ptInter1.y = ptStart.y + t * d.y;\r\n                }\r\n                t = a + f;\r\n                if (((t - 0.0) > -EPS) && (t - fDis) < EPS) {\r\n                    ptInter2.x = ptStart.x + t * d.x;\r\n                    ptInter2.y = ptStart.y + t * d.y;\r\n                }\r\n                return [ptInter1, ptInter2];\r\n            }\r\n        }\r\n\r\n    };\r\n    return GraphMath;\r\n})\r\n;\n/**\r\n * Created by ylf on 2015/12/13.\r\n */\r\n\r\ndefine('js/utils/logger', function () {\r\n    'use strict';\r\n\r\n    var methods = [\r\n        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',\r\n        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',\r\n        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',\r\n        'timeline', 'timelineEnd', 'timeStamp', 'trace', 'warn'\r\n    ];\r\n    var length = methods.length;\r\n    var _console = (window.console = window.console || {});\r\n    var method = null;\r\n\r\n    var emptyFuc = function () {\r\n    };\r\n\r\n    while (length--) {\r\n        method = methods[length];\r\n        // Only stub undefined methods.\r\n        if (!_console[method]) {\r\n            _console[method] = emptyFuc;\r\n        }\r\n    }\r\n\r\n    //logger level值(debug:3, info:2, warn:1, error: 0, close: -1)\r\n    var _logger = {\r\n        _level: 0,\r\n        _console: _console,\r\n        setLevel: function (level) {\r\n            switch (level) {\r\n                case 'debug':\r\n                    this._level = 3;\r\n                    break;\r\n                case 'info':\r\n                    this._level = 2;\r\n                    break;\r\n                case 'warn':\r\n                    this._level = 1;\r\n                    break;\r\n                case 'error':\r\n                    this._level = 0;\r\n                    break;\r\n                default:\r\n                    this._level = -1;\r\n            }\r\n        },\r\n        debug: function () {\r\n            if (this._level >= 3) {\r\n                this._console.log.apply(this._console, arguments);\r\n            }\r\n        },\r\n        info: function (msg) {\r\n            if (this._level >= 2) {\r\n                this._console.info.apply(this._console, arguments);\r\n            }\r\n        },\r\n        warn: function (msg) {\r\n            if (this._level >= 1) {\r\n                this._console.warn.apply(this._console, arguments);\r\n            }\r\n        },\r\n        error: function (msg) {\r\n            if (this._level >= 0) {\r\n                this._console.error.apply(this._console, arguments);\r\n            }\r\n        }\r\n    };\r\n\r\n    return _logger;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/4/9.\r\n */\r\ndefine('js/utils/string', function () {\r\n\r\n    var String = {\r\n        _templateRegExp: /\\$\\{(.+?)(?:\\:(.+?))?\\}/g,\r\n        //替换字符串\r\n        template: function (tpl, attrs) {\r\n            return tpl.replace(this._templateRegExp, function ($0, $1, $2) {\r\n                return attrs[$1] || $0;\r\n            });\r\n        },\r\n        /**\r\n         * 获取膜拜对应值\r\n         * @param text  minder_node_121_dasdfs\r\n         * @param tpl  minder_node_${id:number}_${name:string}\r\n         * @return {id:121,name:'dasdfs'}\r\n         */\r\n        getTemplateValue: function (text, tpl) {\r\n            //获取到数据类型\r\n            var tempRegExp = this.templateRegex(tpl);\r\n            var result = tempRegExp.regExp.exec(text);\r\n            if (!result) {\r\n                return null;\r\n            }\r\n\r\n            //获取所有key\r\n            var keys = Object.keys(tempRegExp.attrs);\r\n            var values = null;\r\n\r\n            //从1开始，略过匹配的全局字符串\r\n            for (var i = 1; i < result.length; i++) {\r\n                if (!values) {\r\n                    values = {};\r\n                }\r\n                if (keys.length > i - 1) {\r\n                    var key = keys[i - 1];\r\n                    if (tempRegExp.attrs[key] === 'number') {\r\n                        values[key] = parseInt(result[i]);\r\n                    } else {\r\n                        values[key] = result[i];\r\n                    }\r\n                }\r\n            }\r\n            return values;\r\n        },\r\n        //生成正则表达式\r\n        templateRegex: function (tpl) {\r\n            var attrs = {};\r\n            var regexStr = tpl.replace(this._templateRegExp, function ($0, $1, $2) {\r\n                attrs[$1] = $2;\r\n                if ($2) {\r\n                    if ($2 === 'number') {\r\n                        return '(\\\\d+?)';\r\n                    } else if ($2 === 'string') {\r\n                        return '(.+?)';\r\n                    }\r\n                }\r\n                else {\r\n                    return '(.+?)';\r\n                }\r\n            });\r\n            regexStr = '^' + regexStr + '$';\r\n            return {\r\n                regExp: new RegExp(regexStr),\r\n                attrs: attrs\r\n            };\r\n        }\r\n    };\r\n    return String;\r\n});\n/**\r\n * create by ylf 7/25\r\n * svg 操作相关\r\n */\r\ndefine('js/utils/svg', function () {\r\n\r\n    var transformRegex = {\r\n        translate: /translate\\(\\s*?([\\-0-9.]*)\\s*?([\\-0-9.]*)\\s*?\\)/,\r\n        rotate: /rotate\\(\\s*?([\\-0-9.]*)\\s*?([\\-0-9.]*)?\\s*?([\\-0-9.]*)?\\s*?\\)/\r\n    }\r\n\r\n    var svg = {\r\n        getRotateMatrix: function (angle, x, y) {\r\n            var rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\r\n            rect.setAttribute('transform', 'rotate(' + angle + ' ' + x + ' ' + y + ')');\r\n            var matrix = rect.getCTM();\r\n            return matrix;\r\n        },\r\n        getRotateKityMatrix: function (angle, x, y) {\r\n            var svgMatrix = this.getRotateMatrix(angle, x, y);\r\n            var matrix = new kity.Matrix(svgMatrix.a, svgMatrix.b, svgMatrix.c, svgMatrix.d, svgMatrix.e, svgMatrix.f);\r\n            return matrix;\r\n        },\r\n        rotate: function (node, angle, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            $(node).attr('transform', 'rotate(' + angle + ',' + x + ',' + y + ')');\r\n        },\r\n        setTranslate: function (node, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            $(node).attr('transform', 'translate(' + x + ',' + y + ')');\r\n        },\r\n        getAttrRotate: function (transform) {\r\n            var result = transformRegex.rotate.exec(transform);\r\n            if (result) {\r\n                result.shift();\r\n                result.forEach(function (item, i) {\r\n                    if (typeof item !== typeof undefined) {\r\n                        result[i] = parseFloat(item);\r\n                    } else {\r\n                        result[i] = 0;\r\n                    }\r\n                });\r\n                return result;\r\n            }\r\n            return [];\r\n        },\r\n        getAttrTranslate: function (transform) {\r\n            var result = transformRegex.translate.exec(transform);\r\n            if (result) {\r\n                result.shift();\r\n                result.forEach(function (item, i) {\r\n                    result[i] = parseFloat(item);\r\n                });\r\n                return result;\r\n            }\r\n            return [];\r\n        },\r\n        createJqForeignObject: function (cls) {\r\n            var foreignObject = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');\r\n            var $div = $('<div class=\"' + cls + '\"></div>');\r\n            $(foreignObject).html($div);\r\n            return $(foreignObject);\r\n        }\r\n    };\r\n\r\n    return svg;\r\n\r\n});\ndefine('js/utils/utils', function () {\r\n    var Utils = {\r\n        getFixedFloat: function (floatNum, digitalCount) {\r\n            var num = floatNum.toString();\r\n            var numAry = num.split('.');\r\n            if (numAry.length !== 2) {\r\n                return floatNum;\r\n            }\r\n            if (numAry[0] === '') {\r\n                numAry[0] = '0';\r\n            }\r\n            var len = numAry[1].length;\r\n            if (len === 0 || digitalCount === 0) {\r\n                return parseInt(numAry[0]);\r\n            }\r\n            var result = numAry[0] + '.' + numAry[1].substring(0, (digitalCount >= len ? len : digitalCount));\r\n            return parseFloat(result);\r\n        },\r\n        getValue: function (str, regex, index) {\r\n            var result = '';\r\n            var arr = str.match(regex);\r\n            if (typeof  index === 'number' && arr && arr.length > index) {\r\n                result = arr[index];\r\n            } else if (arr && arr.length === 2) {\r\n                result = arr[1];\r\n            }\r\n            return result;\r\n        },\r\n        getUuid: function () {\r\n            var s = [];\r\n            var hexDigits = \"0123456789abcdef\";\r\n            for (var i = 0; i < 36; i++) {\r\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n            }\r\n            s[14] = \"4\";  // bits 12-15 of the time_hi_and_version field to 0010\r\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01\r\n            s[8] = s[13] = s[18] = s[23] = \"-\";\r\n\r\n            var uuid = s.join(\"\");\r\n            return uuid;\r\n        },\r\n        isMobile: navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i) ? true : false,\r\n        supportTouch: 'ontouchend' in document\r\n    };\r\n\r\n    return Utils;\r\n\r\n});\n/**\r\n * create by ylf 2016/8/5\r\n * view相关 操作相关\r\n */\r\ndefine('js/utils/View', ['js/utils/GraphMath', 'js/utils/svg', 'js/utils/logger'], function (GraphMath, Svg, Logger) {\r\n    var ViewUtils = {\r\n        setVisibility: function ($$view, visible) {\r\n            $$view.setStyle({'visibility': visible ? '' : 'hidden'});\r\n        },\r\n        isVisibilityHidden: function ($$view) {\r\n            var style = $($$view.node).attr('style');\r\n            var hidden = /visibility:[\\s]*?hidden/.test(style || '');\r\n            return hidden;\r\n            //return $($$view.node).css('visibility') === 'hidden';\r\n        },\r\n        /**\r\n         * 让视图始终水平显示\r\n         * @param $$view 当前水平视图\r\n         * @param referenceView 参照视图，基于该视图旋转角度而变化\r\n         * @param r\r\n         * @param paddingX X轴偏移\r\n         * @param paddingY Y轴偏移\r\n         */\r\n        makeAbsViewHorizontal: function ($$view, angle, r, centerX, centerY, marginX, marginY, nagitive) {\r\n            marginX = marginX ? marginX : 0;\r\n            marginY = marginY ? marginY : 0;\r\n\r\n            //计算离原点的位置\r\n            var pos = GraphMath.getSpherePos(angle || 0, r);\r\n            var x, y;\r\n            if (nagitive) {\r\n                x = centerX + pos.x, y = centerY + pos.y;\r\n            } else {\r\n                x = centerX - pos.x, y = centerY - pos.y;\r\n            }\r\n            //定位到指定位置\r\n            $$view.setTranslate(x + ' ' + y);\r\n            //纠正位置，定位到文本节点正中间\r\n            var box = $$view.getRenderBox();\r\n            x = x + (x - box.cx) + marginX;\r\n            y = y + (y - box.cy) + marginY;\r\n            $$view.setTranslate(x + ' ' + y);\r\n        },\r\n        /**\r\n         * 视图已指定距离围绕旋转\r\n         * @param $$view\r\n         * @param $$referenceView\r\n         * @param r 旋转时候的过度快门，越大越快\r\n         * @param distance 围绕半径\r\n         * @param centerX 围绕中心点\r\n         * @param centerY\r\n         * @param marginX 视图偏移量\r\n         * @param marginY\r\n         * @param nagitive 正向还是方向旋转\r\n         */\r\n        makeViewAround: function ($$view, $$referenceView, r, distance, centerX, centerY, marginX, marginY, nagitive) {\r\n            //取一个大的值即可，保证不会和referenceview发生碰撞\r\n            var angle;\r\n            if (typeof $$referenceView === 'object') {\r\n                angle = Svg.getAttrRotate($$referenceView.getAttr('transform'))[0];\r\n            } else {\r\n                angle = $$referenceView;\r\n            }\r\n            var r = r;\r\n            //将点进行平移，并改变象限\r\n            this.makeAbsViewHorizontal($$view, angle, r, centerX, centerY, marginX, marginY, nagitive);\r\n\r\n            //矩形框的位置信息\r\n            var pointBox = $$view.getRenderBox();\r\n            //获取点到矩形的最短距离、坐标\r\n            var shortDistance = GraphMath.getRectShortestDistance({x: centerX, y: centerY}, pointBox);\r\n\r\n\r\n            //求原点离该距离的坐标\r\n            var asbPos = GraphMath.getLightPos({x: centerX, y: centerY}, shortDistance.pos, distance);\r\n            var subx = asbPos.x - shortDistance.pos.x;\r\n            var suby = asbPos.y - shortDistance.pos.y;\r\n            //求直线坐标\r\n            var translate = Svg.getAttrTranslate($$view.getAttr('transform'));\r\n            if (!isNaN(translate[0] + subx)) {\r\n                $$view.setTranslate(translate[0] + subx, translate[1] + suby);\r\n            } else {\r\n                Logger.warn($$view, 'makeViewAround error  isNAN');\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n\r\n    return ViewUtils;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/9/1.\r\n * 箭号\r\n */\r\ndefine('js/view/arrow', ['js/view/BaseView', 'js/config/style', 'js/utils/view'], function (BaseView, Style, View) {\r\n\r\n\r\n    var ArrowStyle = {\r\n        activeFill: kity.Color.parse('#fff'),\r\n        //这边类型和Arrow.Type一致\r\n        bgCls: {\r\n            '0': 'bg_blue',\r\n            '1': 'bg_red',\r\n            '2': 'bg_purple',\r\n            '3': 'bg_yellow',\r\n            '4': 'bg_green'\r\n        }\r\n    };\r\n\r\n\r\n    var Arrow = BaseView({\r\n        _$$path: null,\r\n        _$$activePath: null,\r\n        _type: null,\r\n        _width: 42,\r\n        _contraryDirection: false,//是否反向\r\n        create: function (type, contraryDirection) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._type = type;\r\n            instance._contraryDirection = contraryDirection;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$activePath = new kity.Path('M6.913,46c-0.136,0-0.273-0.011-0.41-0.034c-1.06-0.176-1.889-1.01-2.059-2.071    c-1.172-7.314,4.579-15.533,7.306-18.948C3.348,13.541,4.311,6.795,4.456,6.033C4.632,5.102,5.32,4.352,6.232,4.094    C6.456,4.031,6.685,4,6.912,4C7.605,4,8.279,4.288,8.76,4.816c12.288,13.49,24.683,17.681,24.806,17.722    c0.993,0.327,1.677,1.236,1.716,2.281c0.04,1.044-0.575,2.002-1.54,2.403C14.267,35.3,9.17,44.578,9.12,44.671    C8.682,45.498,7.826,46,6.913,46z');\r\n            this._$$path = new kity.Path('M6.912,43.5c0,0,5.342-10.071,25.873-18.588c0,0-13-4.281-25.873-18.412    c0,0-1.268,6.674,8.038,18.526C14.95,25.026,5.593,35.268,6.912,43.5z');\r\n            this._$$activePath.fill(ArrowStyle.activeFill);\r\n            this._$$path.fill(ArrowStyle.activeFill);\r\n            this._$$path.setAttr('class', ArrowStyle.bgCls[this._type]);\r\n            this._$$clickArea = new kity.Rect().fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            //点击区域大小\r\n            this._$$clickArea.setSize(36, 60);\r\n            this._$$clickArea.setTranslate(0, -5);\r\n            if (this._contraryDirection) {\r\n                //\r\n                this.getView().setRotate(180,16,0);\r\n            }\r\n\r\n            this.addShape(this._$$activePath);\r\n            this.addShape(this._$$path);\r\n            this.addShape(this._$$clickArea);\r\n        },\r\n        getHeight: function () {\r\n            return 42;\r\n            //return this._$$activePath.getHeight();\r\n        },\r\n        getWidth: function () {\r\n            return 32;\r\n        },\r\n        active: function (active) {\r\n            View.setVisibility(this._$$activePath, active);\r\n        },\r\n        isActive: function () {\r\n            return !View.isVisibilityHidden(this._$$activePath);\r\n        },\r\n        changeType: function (type) {\r\n            this._$$path.setAttr('class', ArrowStyle.bgCls[type]);\r\n        },\r\n        restoreType: function () {\r\n            this._$$path.setAttr('class', ArrowStyle.bgCls[this._type]);\r\n        }\r\n\r\n    });\r\n\r\n    Arrow.Type = {\r\n        Blue: '0',\r\n        Red: '1',\r\n        Purple: '2',\r\n        Yellow: '3',\r\n        Green:'4'\r\n    };\r\n\r\n    return Arrow;\r\n})\r\n;\n/**\r\n * Created by ylf on 2016/7/22.\r\n */\r\ndefine('js/view/baseView', ['js/base/base', 'js/utils/utils', 'js/reflector/domevent', 'js/utils/svg', 'js/utils/graphMath', 'js/utils/view'], function (Base, Utils, DomEvent, Svg, GraphMath, View) {\r\n\r\n    var BaseView = {\r\n        __overwrite: ['domEventHandler', 'setVisibility'],\r\n        _uuid: null,\r\n        _$$view: null,\r\n        __base: function (eventbus, eventInfos) {\r\n            Base({}).__base.apply(this, [eventbus, eventInfos]);\r\n            this._uuid = Utils.getUuid();\r\n            this._$$view = new kity.Group();\r\n        },\r\n        bindDomEvent: function (dom, domEvent, identifier, callback, stopPropagation) {\r\n            if (dom instanceof jQuery) {\r\n                dom = dom[0];\r\n            }\r\n            DomEvent.addDomEvent(dom, domEvent, identifier, stopPropagation);\r\n            this.__on(identifier, callback, '');\r\n        },\r\n        domEventHandler: function (uuid, eventType, dom) {\r\n            //各自实现来处理事件\r\n        },\r\n        getUuid: function () {\r\n            return this._uuid;\r\n        },\r\n        getView: function () {\r\n            return this._$$view;\r\n        },\r\n        addShape: function ($$shape) {\r\n            this._$$view.addShape($$shape);\r\n        },\r\n        setTranslate: function (x, y) {\r\n            if (arguments.length === 1 && typeof x === 'string') {\r\n                this._$$view.setTranslate(x);\r\n            } else {\r\n                this._$$view.setTranslate(x + ' ' + y);\r\n            }\r\n        },\r\n        setTranslateX: function (x) {\r\n            var translate = Svg.getAttrTranslate($(this._$$view.node).attr('transform'));\r\n            if (translate.length > 0) {\r\n                this.setTranslate(x, translate[1]);\r\n            }\r\n        },\r\n        setOpacity: function (opacity) {\r\n            this._$$view.setStyle({opacity: opacity});\r\n        },\r\n        translate: function (x, y) {\r\n            this._$$view.translate(x, y);\r\n        },\r\n        setVisible: function (visible) {\r\n            this._$$view.setVisible(visible);\r\n        },\r\n        isVisible: function () {\r\n            return (!this.isVisibilityHidden()) && this.getVisible();\r\n        },\r\n        setVisibility: function (visible) {\r\n            View.setVisibility(this._$$view, visible);\r\n        },\r\n        isVisibilityHidden: function () {\r\n            return View.isVisibilityHidden(this._$$view);// $(this._$$view.node).css('visibility') === 'hidden';\r\n        },\r\n        makeAbsViewHorizontal: function ($$view, angle, r, centerX, centerY, marginX, marginY, nagitive) {\r\n            View.makeAbsViewHorizontal($$view, angle, r, centerX, centerY, marginX, marginY, nagitive);\r\n        },\r\n        makeViewAround: function ($$view, $$referenceView, r, distance, centerX, centerY, marginX, marginY, nagitive) {\r\n            View.makeViewAround($$view, $$referenceView, r, distance, centerX, centerY, marginX, marginY, nagitive);\r\n        }\r\n    };\r\n\r\n\r\n    return function (cls) {\r\n        return Base(BaseView).__include(cls);\r\n    };\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/4.\r\n * 扇面名称和角度\r\n */\r\ndefine('js/view/EqualAngleName', ['js/view/BaseView', 'js/config/style'], function (BaseView, Style) {\r\n\r\n\r\n    var EqualAngleNameStyle = Style.EqualAngleName;\r\n\r\n\r\n    var EqualAngleName = BaseView({\r\n        create: function (lang) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$name = new kity.Text();\r\n            this._$$name.setContent(this._lang['rf_equal_angle_name']).setAttr('class', EqualAngleNameStyle.fontClass);\r\n            this.addShape(this._$$name);\r\n        }\r\n    });\r\n\r\n\r\n    return EqualAngleName;\r\n});\n/**\r\n * Created by ylf on 2016/7/29.\r\n */\r\ndefine('js/view/ForeignView', ['js/base/base', 'js/utils/utils', 'js/utils/svg'], function (Base, Utils, Svg) {\r\n\r\n    var ForeignView = Base({\r\n        _uuid: null,\r\n        _$view: null,\r\n        _$insideView: null,\r\n        _width: 0,\r\n        _height: 0,\r\n        _cls: '',\r\n        create: function (cls, width, height) {\r\n            var instance = Object.create(this);\r\n            instance.__base(null, []);\r\n            instance._cls = cls;\r\n            instance._uuid = Utils.getUuid();\r\n            instance._$view = Svg.createJqForeignObject(cls);\r\n            instance._$insideView = instance._$view.find('div');\r\n            instance.setWidth(width);\r\n            instance.setHeight(height);\r\n\r\n            return instance;\r\n        },\r\n        setDomEvent: function (domEvent) {\r\n            if (domEvent && domEvent.length > 0) {\r\n                this._$view.attr('class', '_lr_event');\r\n                this._$view.data('event-type', domEvent);\r\n                this._$view.data('event-identifier', this._uuid);\r\n            }\r\n        },\r\n        getUuid: function () {\r\n            return this._uuid;\r\n        },\r\n        setWidth: function (width) {\r\n            this._width = width;\r\n            this._$view.css({width: width});\r\n            this._$view.attr(\"width\", width);\r\n            this._$insideView.css({width: width});\r\n            return this;\r\n        },\r\n        setHeight: function (height) {\r\n            this._height = height;\r\n            this._$view.css({height: height});\r\n            this._$view.attr(\"height\", height);\r\n            this._$insideView.css({height: height});\r\n            return this;\r\n        },\r\n        getView: function () {\r\n            return this._$view;\r\n        },\r\n        appendHtml: function (html) {\r\n            this._$insideView.append(html);\r\n        },\r\n        setTranslate: function (x, y) {\r\n            var rotate = Svg.getAttrRotate(this._$view.attr('transform'));\r\n            var translate = [x, y];\r\n            this.applyTransform(translate, rotate);\r\n        },\r\n        setRotate: function (degre, cx, cy) {\r\n            var translate = Svg.getAttrTranslate(this._$view.attr('transform'));\r\n            var rotate = [degre];\r\n            if (typeof cx !== typeof  undefined && typeof cy !== typeof  undefined) {\r\n                rotate.push(cx);\r\n                rotate.push(cy);\r\n            }\r\n            this.applyTransform(translate, rotate);\r\n        },\r\n        applyTransform: function (translate, rotate) {\r\n            var transform = '';\r\n            if (translate.length > 1) {\r\n                transform = 'translate(' + translate[0] + ' ' + translate[1] + ')';\r\n            }\r\n            if (rotate.length === 1) {\r\n                transform += ' rotate(' + rotate[0] + ')';\r\n            } else if (rotate.length === 3) {\r\n                transform += ' rotate(' + rotate[0] + ' ' + rotate[1] + ' ' + rotate[2] + ')';\r\n            }\r\n            this._$view.attr('transform', transform);\r\n        },\r\n        setVisible: function (visible) {\r\n            if (visible) {\r\n                this._$view.show();\r\n            } else {\r\n                this._$view.hide();\r\n            }\r\n        },\r\n        setVisibility: function (visible) {\r\n            this._$view.css({'visibility': visible ? '' : 'hidden'});\r\n        },\r\n        setOpacity: function (opacity) {\r\n            this._$view.css({opacity: opacity});\r\n        },\r\n        setAttr: function (key, val) {\r\n            this._$view.attr(key, val);\r\n        },\r\n        addClass: function (cls) {\r\n            this._$insideView.addClass(cls);\r\n        },\r\n        removeClass: function (cls) {\r\n            this._$insideView.removeClass(cls);\r\n        },\r\n        hasClass: function (cls) {\r\n            return this._$insideView.hasClass(cls);\r\n        }\r\n    });\r\n\r\n\r\n    return ForeignView;\r\n\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/15.\r\n * 垂足符号\r\n */\r\ndefine('js/view/IncidencePoint', ['js/view/BaseView', 'js/config/style', 'js/utils/view'], function (BaseView, Style) {\r\n\r\n    var IncidencePointStyle = Style.IncidencePoint;\r\n\r\n    var IncidencePoint = BaseView({\r\n        _$$line: null,\r\n        create: function (data) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._data = data;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$incidencePoint = new kity.Circle(IncidencePointStyle.width).fill(IncidencePointStyle.fill);\r\n            this._$$incidencePoint = new kity.Circle(IncidencePointStyle.width).fill(IncidencePointStyle.fill);\r\n            this.addShape(this._$$incidencePoint);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            this._$$line.setRotate(angle + ' ' + x + ' ' + y);\r\n        }\r\n    });\r\n\r\n\r\n    return IncidencePoint;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 入射线\r\n */\r\ndefine('js/view/LightLine', ['js/view/BaseView', 'js/config/style', 'js/utils/utils', 'js/utils/graphmath', 'js/utils/svg', 'js/view/ForeignView', 'js/config/eventKey', 'js/utils/view'], function (BaseView, Style, Utils, GraphMath, Svg, ForeignView, EventKey, View) {\r\n\r\n\r\n    var LineStyle = Style.LineStyle;\r\n    var strokeWidth = LineStyle.strokeStyle['stroke-width'];\r\n    var Arrow = require('js/view/arrow');\r\n\r\n    var CONFIG = {\r\n        width: 290,//整体长度\r\n        arrowPos: 145,//箭号所在位置\r\n        visible: true,//是否显示\r\n        clickAble: true,//是否允许点击和移动\r\n        nameEnable: true,//是否需要名称支持\r\n        arrowVisible: true,\r\n        arrowReverse: false\r\n    };\r\n\r\n    var halfY = (LineStyle.rectHeight / 2 );\r\n\r\n    var LightLine = BaseView({\r\n        _$$lineGroup: null,\r\n        _lineGroupUuid: '',\r\n        _$$lintWhite: null,\r\n        _arrow: null,\r\n        _fwBtn: null,\r\n        _config: null,\r\n        _lightType: null,\r\n        _$$name: null,\r\n        _onLightMove: null,\r\n        _lang: null,\r\n        _showRotate: false,\r\n        create: function (eventbus, lightType, config, onLightMove, lang, showRotate) {\r\n            var instance = Object.create(this);\r\n            var eventInfos = [];\r\n            eventInfos.push({key: EventKey.Blur, callback: instance.blur, params: []});\r\n            instance.__base(eventbus, eventInfos);\r\n            instance._lightType = lightType;\r\n            instance._config = $.extend(true, {}, CONFIG, config);\r\n            instance._onLightMove = onLightMove;\r\n            instance._lineGroupUuid = Utils.getUuid();\r\n            instance._lang = lang;\r\n            instance._showRotate = showRotate;\r\n            instance.createView();\r\n            instance.__on(EventKey.BtnMove + instance._fwBtn.getUuid(), instance.domEventHandler, []);\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n\r\n            //添加一个标记，用于获取缩放值\r\n            this._$$offsetPoint = new kity.Circle(10).fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            this.addShape(this._$$offsetPoint);\r\n\r\n            //添加名称\r\n            this._$$name = new kity.Text();\r\n            if (this._lang) {\r\n                var name = this._lightType === LightLine.Type.IncidenceLine ? this._lang['rf_incidence_line_name'] : this._lang['rf_reflection_line_name'];\r\n                this._$$name.setContent(name)\r\n            }\r\n            if (LineStyle[this._lightType]) {\r\n                this._$$name.setAttr('class', LineStyle[this._lightType].fontClass);\r\n            }\r\n\r\n            this.addShape(this._$$name);\r\n\r\n            this._$$lineGroup = new kity.Group();\r\n\r\n\r\n            //添加白边\r\n            this._$$lintWhite = new kity.Rect().setStyle(LineStyle.strokeStyle);\r\n            this._$$lintWhite.setSize(this.getWidth() + strokeWidth, LineStyle.rectHeight + strokeWidth);\r\n            this._$$lintWhite.translate(-strokeWidth / 2, -strokeWidth / 2);\r\n            this._$$lineGroup.addShape(this._$$lintWhite);\r\n\r\n            var arrowType;\r\n            if (this._lightType == LightLine.Type.IncidenceLine) {\r\n                arrowType = Arrow.Type.Blue;\r\n            } else if (this._lightType == LightLine.Type.ReflectionLine) {\r\n                arrowType = Arrow.Type.Red;\r\n            } else if (this._lightType == LightLine.Type.Reverse) {\r\n                arrowType = Arrow.Type.Green;\r\n            }\r\n\r\n            //添加箭头\r\n            this._arrow = Arrow.create(arrowType, this._lightType === LightLine.Type.ReflectionLine || this._config.arrowReverse);\r\n            this._arrow.setVisibility(this._config.arrowVisible);\r\n            this._$$lineGroup.addShape(this._arrow.getView());\r\n\r\n            this.initArrowPos();\r\n\r\n            //增加透明区域，放大点击区域\r\n            this._$$lintClick = new kity.Rect().fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            var clickWidth = LineStyle.arrow.height / 5;\r\n            this._$$lintClick.setSize(this.getWidth() + strokeWidth, clickWidth);\r\n            this._$$lintClick.translate(0, -(clickWidth - LineStyle.rectHeight) / 2);\r\n            this._$$lineGroup.addShape(this._$$lintClick);\r\n\r\n\r\n            //添加白边内实心矩形\r\n            this._$$whiteRect = new kity.Rect();\r\n            this._$$whiteRect.setSize(this.getWidth(), LineStyle.rectHeight);\r\n            this._$$whiteRect.fill(LineStyle[this._lightType].fill);\r\n            this._$$lineGroup.addShape(this._$$whiteRect);\r\n\r\n            //旋转按钮\r\n            this._fwBtn = ForeignView.create('btn_rotate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            this._fwBtn.setTranslate(-LineStyle.btnRotate.width - 10, (LineStyle.rectHeight - LineStyle.btnRotate.height) / 2);\r\n            this._fwBtnInvisible = ForeignView.create('btn_rotate', LineStyle.btnRotate.width, LineStyle.btnRotate.height);\r\n            this._fwBtnInvisible.setTranslate(-LineStyle.btnRotate.width - 10, (LineStyle.rectHeight - LineStyle.btnRotate.height) / 2);\r\n            this._fwBtnInvisible.setVisibility(false);\r\n            $(this._$$lineGroup.node).append(this._fwBtn.getView());\r\n            // rotate(-60 30 30)\r\n            this._fwBtn.setVisibility(this._showRotate || false);\r\n            if (this._showRotate) {\r\n                this._fwBtn.setRotate(-60, 30, 30);\r\n            }\r\n\r\n            $(this._$$lineGroup.node).append(this._fwBtnInvisible.getView());\r\n\r\n\r\n            this.addShape(this._$$lineGroup);\r\n\r\n            //绑定事件\r\n            this.bindDomEvent(this._fwBtn.getView(), ['down', 'beforemove', 'move', 'aftermove'], this._fwBtn.getUuid(), this.domEventHandler, false);\r\n            this.bindDomEvent(this._$$lineGroup.node, ['lrTap'], this._lineGroupUuid, this.domEventHandler, false);\r\n\r\n            this.initView();\r\n        },\r\n        setMoveListener: function (listner) {\r\n            this._moveListener = listner;\r\n        },\r\n        getWidth: function () {\r\n            return this._config.width;\r\n        },\r\n        setWidth: function (width) {\r\n            this._config.width = width;\r\n            this._config.arrowPos = (width - this._arrow.getWidth()) / 2;\r\n            //线没有箭号长时，隐藏入射箭号\r\n            if (this._config.width <= this._arrow.getWidth() + 10) {\r\n                this._arrow.setVisibility(false);\r\n            } else {\r\n                this._arrow.setVisibility(this._config.arrowVisible);\r\n            }\r\n            this._$$lintWhite.setSize(this.getWidth() + strokeWidth, LineStyle.rectHeight + strokeWidth);\r\n            var clickWidth = LineStyle.arrow.height / 3;\r\n            this._$$lintClick.setSize(this.getWidth() + strokeWidth, clickWidth);\r\n            this._$$whiteRect.setSize(this.getWidth(), LineStyle.rectHeight);\r\n\r\n            this.initArrowPos();\r\n            this.setTranslate(-this.getWidth(), -3);\r\n            var rotate = Svg.getAttrRotate(this._$$lineGroup.getAttr('transform'));\r\n            if (rotate && rotate.length > 0) {\r\n                this._$$lineGroup.setRotate((rotate[0] ) + ' ' + this.getWidth() + ' ' + rotate[2]);\r\n            }\r\n            this.initNamePos();\r\n        },\r\n        setArrowPos: function (arrowPos) {\r\n            this._config.arrowPos = arrowPos;\r\n            this.initArrowPos();\r\n        },\r\n        initArrowPos: function () {\r\n            //这里加上两个偏差\r\n            if (this._lightType === LightLine.Type.ReflectionLine || this._config.arrowReverse) {\r\n                this._arrow.setTranslate(this.getArrowPos(), (LineStyle.rectHeight + this._arrow.getHeight()) / 2 + 3.5);\r\n            } else {\r\n                this._arrow.setTranslate(this.getArrowPos(), ( -this._arrow.getHeight() ) / 2);\r\n            }\r\n        },\r\n        getArrowPos: function () {\r\n            return this._config.arrowPos;\r\n        },\r\n        blur: function (uuid) {\r\n            if (uuid !== this._lineGroupUuid) {\r\n                this.setFwBtnVisible(false);\r\n                this._$$lintWhite.setVisible(false);\r\n                this._arrow.active(false);\r\n            }\r\n        },\r\n        setClickAble: function (clickable) {\r\n            this._config.clickAble = clickable;\r\n        },\r\n        domEventHandler: function (eventType, uuid, data) {\r\n            if (!this._config.clickAble) {\r\n                return;\r\n            }\r\n            if (uuid === this._fwBtn.getUuid()) {\r\n                this._onLightMove(this._lightType, data, eventType);\r\n                if (eventType === 'down') {\r\n                    this._$$lintWhite.setVisible(true);\r\n                    this._arrow.active(true);\r\n                } else if (eventType === 'beforemove') {\r\n\r\n                } else if (eventType === 'move') {\r\n\r\n                } else if (eventType === 'aftermove') {\r\n                    this.__triggerEvent('insidechange', this._lightType + '-move');\r\n                }\r\n            } else if (uuid === this._lineGroupUuid) {\r\n                if (eventType === 'lrTap') {\r\n                    if (this._arrow.isActive()) {\r\n                        this.blur();\r\n                        return;\r\n                    }\r\n                    this.setFwBtnVisible(true);\r\n                    this._$$lintWhite.setVisible(true);\r\n                    this._arrow.active(true);\r\n                }\r\n            }\r\n            this.btnStillInBox();\r\n        },\r\n        initView: function () {\r\n            this.setFwBtnVisible(false);\r\n            this._$$lintWhite.setVisible(false);\r\n            this._arrow.active(false);\r\n            if (this._config.nameEnable === false) {\r\n                View.setVisibility(this._$$name, false)\r\n            }\r\n            this.setVisibility(this._config.visible);\r\n\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? halfY : y;\r\n\r\n            this._$$lineGroup.setRotate(angle + ' ' + x + ' ' + y);\r\n            this.initNamePos(x, y);\r\n            this.fwBtnMove();\r\n        },\r\n        rotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? halfY : y;\r\n            var rotate = Svg.getAttrRotate(this._$$lineGroup.getAttr('transform'));\r\n            if (rotate && rotate.length > 0) {\r\n                this._$$lineGroup.setRotate((rotate[0] + angle) + ' ' + x + ' ' + y);\r\n            } else {\r\n                this._$$lineGroup.setRotate(angle + ' ' + x + ' ' + y);\r\n            }\r\n            this.initNamePos(x, y);\r\n            this.fwBtnMove();\r\n        },\r\n        getRotateAngle: function () {\r\n            var rotate = Svg.getAttrRotate(this._$$lineGroup.getAttr('transform'));\r\n            return rotate[0];\r\n        },\r\n        initNamePos: function (x, y) {\r\n            return false;\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? halfY : y;\r\n            this.makeViewAround(this._$$name, this._$$lineGroup, this.getWidth(), this.getWidth() + 15, x, y, 0, 10, false);\r\n        },\r\n        getRotatePos: function () {\r\n            return {x: this.getWidth(), y: halfY};\r\n        },\r\n        setNameVisible: function (visible) {\r\n            if (this._config.nameEnable) {\r\n                View.setVisibility(this._$$name, visible);\r\n            }\r\n        },\r\n        //设置公共线样式\r\n        setCommonFill: function () {\r\n            this._$$whiteRect.fill(LineStyle.commonLineFill);\r\n            this._arrow.changeType(Arrow.Type.Red);\r\n        },\r\n        //从公共线还原\r\n        restoreFill: function () {\r\n            this._$$whiteRect.fill(LineStyle[this._lightType].fill);\r\n            this._arrow.restoreType();\r\n        },\r\n        setNameEnable: function (nameEnable) {\r\n            this._config.nameEnable = nameEnable;\r\n            View.setVisibility(this._$$name, nameEnable);\r\n        },\r\n        getNameEnable: function () {\r\n            return this._config.nameEnable;\r\n        },\r\n        setVisibility: function (visible) {\r\n            BaseView({}).setVisibility.apply(this, [visible]);\r\n            this.__triggerEvent(EventKey.LightLineVisible, this._lightType, visible);\r\n        },\r\n        setLineEnable: function (enable) {\r\n\r\n        },\r\n        makeNameViewAround: function (aroundLineAngle, x, y) {\r\n            x = typeof x === typeof undefined ? this.getWidth() : x;\r\n            y = typeof y === typeof undefined ? halfY : y;\r\n            aroundLineAngle = typeof aroundLineAngle === typeof undefined ? this._$$lineGroup : aroundLineAngle;\r\n            this.makeViewAround(this._$$name, aroundLineAngle, this.getWidth(), this.getWidth() + 10, x, y, 0, 0, false);\r\n        },\r\n        getLightType: function () {\r\n            return this._lightType;\r\n        },\r\n        fwBtnMove: function () {\r\n            //不可点击时，不需要处理旋转按钮\r\n            if (!this._config.clickAble) {\r\n                return\r\n            }\r\n            this.triggerMoveBtn();\r\n\r\n        },\r\n        setFwBtnVisible: function (visible) {\r\n            this.triggerMoveBtn(visible);\r\n        },\r\n        triggerMoveBtn: function (visible) {\r\n            //不可点击时，不需要处理旋转按钮\r\n            if (!this._config.clickAble) {\r\n                return\r\n            }\r\n            if (this._showRotate) {\r\n                return;\r\n            }\r\n            if (this._moveListener)\r\n                this._moveListener(this.getScale(), this._fwBtn.getView()[0].getBoundingClientRect(), this._fwBtn.getUuid());\r\n        },\r\n        fwBtnTranslate: function (x, y) {\r\n            //不可点击时，不需要处理旋转按钮\r\n            if (!this._config.clickAble) {\r\n                return\r\n            }\r\n            this._fwBtn.setTranslate(x, y);\r\n            this.fwBtnMove();\r\n        },\r\n        btnStillInBox: function () {\r\n            if (!this._config.clickAble) {\r\n                return\r\n            }\r\n            var originalRect = this._fwBtnInvisible.getView()[0].getBoundingClientRect();\r\n            var svgElem = this._fwBtn.getView().closest('svg')[0];\r\n            if (!svgElem) {\r\n                return;\r\n            }\r\n            var svgRect = svgElem.getBoundingClientRect();\r\n            var angle = Math.abs(this.getRotateAngle() % 180);\r\n            //统一计算与X轴锐角\r\n            if (angle <= 0) {\r\n                angle = -angle;\r\n            }\r\n            if (angle > 90) {\r\n                angle = 180 - angle;\r\n            }\r\n\r\n            var translate = Svg.getAttrTranslate(this._fwBtnInvisible.getView().attr('transform'));\r\n            if (translate.length <= 0) {\r\n                return;\r\n            }\r\n\r\n            //inside svg\r\n            if (originalRect.bottom <= svgRect.bottom && originalRect.left >= svgRect.left && originalRect.right <= svgRect.right && originalRect.top >= svgRect.top || angle === 90) {\r\n                this.fwBtnTranslate(-LineStyle.btnRotate.width - 10, translate[1]);\r\n            } else {\r\n                var translateX = 0;\r\n                var scale = this.getScale();\r\n                var max = this._config.width + translate[0] + LineStyle.btnRotate.width + 10;\r\n                if (originalRect.left <= svgRect.left) {\r\n                    //超出左侧\r\n                    var subY = svgRect.left - originalRect.left;\r\n                    var x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n\r\n                    translateX = translate[0] - ( -x);\r\n                    if (translateX > max) {\r\n                        translateX = max;\r\n                    }\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                if (originalRect.bottom >= svgRect.bottom) {\r\n                    // 超出下方\r\n                    var subY = originalRect.bottom - svgRect.bottom;\r\n                    var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    if (translateX == 0 || translateX < translate[0] + x) {\r\n                        translateX = translate[0] + x\r\n                    }\r\n                    if (translateX > max) {\r\n                        translateX = max;\r\n                    }\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                //超出上方\r\n                if (originalRect.top <= svgRect.top) {\r\n                    var subY = svgRect.top - originalRect.top;\r\n                    var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    if (translateX == 0 || translateX < translate[0] + x) {\r\n                        translateX = translate[0] + x\r\n                    }\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                //超出右側\r\n                if (originalRect.right >= svgRect.right) {\r\n                    var subY = originalRect.right - svgRect.right;\r\n                    var x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n                    translateX = translate[0] - ( -x);\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n            }\r\n        },\r\n        getScale: function () {\r\n            var scale = (this._$$offsetPoint.node.getBoundingClientRect().width / 20) || 1;\r\n            return scale;\r\n        }\r\n    });\r\n\r\n    //静态方法\r\n    LightLine.Type = {\r\n        IncidenceLine: 'IncidenceLine',\r\n        ReflectionLine: 'ReflectionLine',\r\n        NormalLine: 'NormalLine',\r\n        SurfaceIn: 'SurfaceIn',\r\n        SurfaceOut: 'SurfaceOut',\r\n        Reverse: 'Reverse'\r\n    };\r\n\r\n    return LightLine;\r\n});\n/**\r\n * Created by ylf on 2016/7/26.\r\n */\r\ndefine('js/view/multipleText', ['js/view/BaseView', 'js/utils/view'], function (BaseView, View) {\r\n\r\n\r\n    var MultipleText = BaseView({\r\n        _lineHeight: 18,\r\n        _$$texts: [],\r\n        create: function (lineHeight) {\r\n            var instance = Object.create(this);\r\n            instance._$$texts = [];\r\n            instance._lineHeight = lineHeight;\r\n            instance.__base([]);\r\n            instance.createView();\r\n            //创建节点容器\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n        },\r\n        setContent: function (lines) {\r\n            this.clear();\r\n            var that = this;\r\n            if (typeof lines === 'string') {\r\n                that.appendLine(lines);\r\n            } else {\r\n                lines.forEach(function (line) {\r\n                    that.appendLine(line);\r\n                });\r\n            }\r\n\r\n            this.center();\r\n        },\r\n        center: function () {\r\n            var maxWidth = 0;\r\n\r\n            if (this._$$texts.length > 1) {\r\n                var lastIsAngle = false;\r\n                this._$$texts.forEach(function ($$text) {\r\n                    var width = $$text.getWidth();\r\n                    if (width > maxWidth) {\r\n                        maxWidth = width;\r\n                        var content = $$text.getContent();\r\n                        lastIsAngle = content.substring(content.length - 1, content.length) === '°';\r\n                    }\r\n                });\r\n                this._$$texts.forEach(function ($$text) {\r\n                    var width = $$text.getWidth();\r\n                    if (width < maxWidth) {\r\n                        $$text.setAttr('x', Math.abs((maxWidth - width) / 2));\r\n                    }\r\n                });\r\n\r\n            }\r\n        },\r\n        getRenderBox: function () {\r\n            return this._$$view.getRenderBox();\r\n        },\r\n        getAttr: function (name) {\r\n            return this._$$view.getAttr(name);\r\n        },\r\n        appendLine: function (text) {\r\n            var y = (this._$$texts.length ) * this._lineHeight;\r\n            var $$text = new kity.Text().setContent(text).setAttr('x', 0).setAttr('y', y >= 0 ? y : 0);\r\n            this._$$texts.push($$text);\r\n            this._$$view.addShape($$text);\r\n\r\n        },\r\n        getWidth: function () {\r\n            var width = 0;\r\n            this._$$texts.forEach(function ($$text) {\r\n                if ($$text.getWidth() > width) {\r\n                    width = $$text.getWidth();\r\n                }\r\n            });\r\n            return width;\r\n        },\r\n        getContent: function () {\r\n            //TODO:\r\n        },\r\n        getHeight: function () {\r\n            return this._lineHeight * this._$$texts.length;\r\n        },\r\n        clear: function () {\r\n            this._$$texts.forEach(function ($$text) {\r\n                $$text.remove();\r\n            });\r\n            this._$$texts = [];\r\n        }\r\n    });\r\n\r\n    return MultipleText;\r\n});\n/**\r\n * Created by ylf on 2016/8/4.\r\n * 扇面名称和角度\r\n */\r\ndefine('js/view/NameGroup', ['js/view/BaseView', 'js/config/style', 'js/utils/graphmath', 'js/utils/svg', 'js/view/MultipleText', 'js/view/sector', 'js/utils/view'], function (BaseView, Style, GraphMath, Svg, MultipleText, Sector, View) {\r\n\r\n\r\n    var SectorStyle = Style.Sector;\r\n\r\n    var data = {\r\n        \"type\": {\r\n            name: '',\r\n            angle: 0,\r\n            vertical: true,\r\n            cx: 0,\r\n            cy: 0,\r\n            r: 0,\r\n            letterR: 0,\r\n            angleR:0,\r\n            angleLetter: ''\r\n        }\r\n    };\r\n\r\n    var anglePaddingLeft = 10;\r\n\r\n\r\n    var NameGroup = BaseView({\r\n        _data: '',\r\n        _nameVisible: true,\r\n        _$$incidencePoint: null,\r\n        _lang: null,\r\n        _lightHeight: 48,\r\n        _option: null,\r\n        _reflectorType: 0,\r\n        _nameAutoPos: false,\r\n        _status: null,\r\n        create: function (data, lang, option, reflectorType, nameAutoPos) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._data = data;\r\n            instance._reflectorType = reflectorType;\r\n            instance._lang = lang;\r\n            instance._option = option;\r\n            instance._status = {};\r\n            instance._nameAutoPos = nameAutoPos;\r\n            for (var type in Sector.Type) {\r\n                instance._status[Sector.Type[type]] = false;\r\n            }\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            var that = this;\r\n            for (var key in this._data) {\r\n                var data = this._data[key];\r\n                //名称和度数\r\n                data.mtAngle = MultipleText.create(that._lightHeight);\r\n                data.mtName = MultipleText.create(that._lightHeight);\r\n\r\n                if (key == Sector.Type.SurfaceIn || key == Sector.Type.SurfaceOut) {\r\n                    //与反射面夹角\r\n                    data.name = '';\r\n                    data.mtAngle.getView().setAttr('class', SectorStyle.surfaceFontClass);\r\n                } else if (key == Sector.Type.Incidence) {\r\n                    //入射线与法线夹角\r\n                    data.name = this._lang['rf_incidence_angle'];\r\n                    //角度\r\n                    data.mtAngle.getView().setAttr('class', SectorStyle.incidenceFontClass);\r\n                    //隐藏的角度，用来确认位置\r\n                    data.mtInvisibleAngle = MultipleText.create(that._lightHeight);\r\n                    data.mtInvisibleAngle.getView().setAttr('class', SectorStyle.incidenceFontClass);\r\n                    //名称\r\n                    data.mtName = MultipleText.create(that._lightHeight);\r\n                    data.mtName.getView().setAttr('class', SectorStyle.incidenceFontClass);\r\n                    that.addShape(data.mtInvisibleAngle.getView());\r\n                    View.setVisibility(data.mtInvisibleAngle.getView(), false);\r\n                    data.angleLetter = 'i';\r\n                    data.mtAngleLetter = new kity.Text('i').setAttr('class', SectorStyle.incidenceLetterClass);\r\n                    that.addShape(data.mtAngleLetter);\r\n                } else if (key == Sector.Type.Reflection) {\r\n                    //反射线与法线夹角\r\n                    data.name = this._lang['rf_reflection_angle'];\r\n                    data.mtAngle.getView().setAttr('class', SectorStyle.reflectionFontClass);\r\n                    data.mtInvisibleAngle = MultipleText.create(that._lightHeight);\r\n                    data.mtInvisibleAngle.getView().setAttr('class', SectorStyle.reflectionFontClass);\r\n                    //名称\r\n                    data.mtName = MultipleText.create(that._lightHeight);\r\n                    data.mtName.getView().setAttr('class', SectorStyle.reflectionFontClass);\r\n                    that.addShape(data.mtInvisibleAngle.getView());\r\n                    View.setVisibility(data.mtInvisibleAngle.getView(), false);\r\n                    data.angleLetter = 'r';\r\n                    data.mtAngleLetter = new kity.Text('r').setAttr('class', SectorStyle.reflectionLetterClass);\r\n                    that.addShape(data.mtAngleLetter);\r\n                }\r\n                data.angleStr = '';\r\n                data.angle = 0;\r\n                that.addShape(data.mtAngle.getView());\r\n                that.addShape(data.mtName.getView());\r\n                data.mtName.setVisibility(false);\r\n            }\r\n        },\r\n        getAngle: function (type) {\r\n            return this._data[type].actualAngle;\r\n        },\r\n        setNormalAngle: function (normalAngle) {\r\n            this._normalAngle = normalAngle;\r\n        },\r\n        rotate: function (angle, nagative) {\r\n            var __getIndex = function (index, nagative, sub) {\r\n                return nagative ? sub - index : index;\r\n            };\r\n            this._rotate(Sector.Type.SurfaceIn, angle[__getIndex(0, nagative, 3)], angle[__getIndex(1, nagative, 5)]);\r\n            this._rotate(Sector.Type.Incidence, angle[__getIndex(1, nagative, 3)], angle[__getIndex(2, nagative, 5)]);\r\n            this._rotate(Sector.Type.Reflection, angle[__getIndex(2, nagative, 3)], angle[__getIndex(3, nagative, 5)]);\r\n            this._rotate(Sector.Type.SurfaceOut, angle[__getIndex(3, nagative, 3)], angle[__getIndex(4, nagative, 5)]);\r\n        },\r\n        _rotate: function (type, startAngle, endAngle) {\r\n            var data = this._data[type];\r\n            var angle = Math.abs(Math.round(startAngle - endAngle));\r\n            data.angle = angle;\r\n            data.actualAngle = Math.abs(startAngle - endAngle);\r\n            data.angleStr = angle + '°';\r\n            var sphereAngle = startAngle + (endAngle - startAngle) / 2;\r\n            data.sphereAngle = sphereAngle;\r\n            //不设置隐藏是否，只进行旋转定位\r\n            this.updatePosByType(type);\r\n        },\r\n        isNameVertical: function () {\r\n            var angle = this._normalAngle % 360;\r\n            if (angle > -40 && angle <= 0) {\r\n                return false;\r\n            } else if (angle <= 360 && angle >= 310) {\r\n                return false;\r\n            } else if (angle >= 0 && angle <= 40) {\r\n                return false;\r\n            } else if (angle >= 130 && angle <= 230) {\r\n                return false\r\n            }\r\n            return true;\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this._nameVisible = visible;\r\n            for (var type in this._data) {\r\n                if (this._status[type] === true) {\r\n                    if (this._data[type].mtName) {\r\n                        View.setVisibility(this._data[type].mtName.getView(), visible);\r\n                    }\r\n                    this.updatePosByType(type);\r\n                }\r\n            }\r\n        },\r\n        setNameStatusAndVisible: function (type, visible) {\r\n            if (this._data[type].mtName) {\r\n                if (this._data[type].mtName) {\r\n                    View.setVisibility(this._data[type].mtName.getView(), visible);\r\n                }\r\n                //已经绘制过\r\n                this._status[type] = true;\r\n                this.updatePosByType(type);\r\n            }\r\n        },\r\n        updatePos:function () {\r\n            for (var key in this._data) {\r\n                this.updatePosByType(key);\r\n            }\r\n        },\r\n        updatePosByType: function (type) {\r\n\r\n            var data = this._data[type];\r\n            var nameVisible = !data.mtName.isVisibilityHidden();\r\n            if (data.angle === 0 || data.angle === 90) {\r\n                //角度为0/90时，不显示文本内容\r\n                data.mtName.setContent('');\r\n                data.mtAngle.setContent('');\r\n                if (type == Sector.Type.Incidence || type == Sector.Type.Reflection) {\r\n                    data.mtInvisibleAngle.setContent('');\r\n                    data.mtAngleLetter.setContent('');\r\n                }\r\n            } else {\r\n                var isNameVertical = this.isNameVertical();\r\n                if (nameVisible) {\r\n                    data.mtName.setContent(isNameVertical ? data.name.split('') : data.name);\r\n                } else {\r\n                    data.mtName.setContent('');\r\n                }\r\n                data.mtAngle.setContent(data.angleStr);\r\n                if (data.mtAngleLetter) {\r\n                    data.mtAngleLetter.setContent(data.angleLetter);\r\n                }\r\n                var r = data.angleR + this._lightHeight;\r\n\r\n                //显示名称，且名称水平显示\r\n                if (!isNameVertical && nameVisible && !this.isSurfaceAngle(type)) {\r\n                    r += data.mtAngle.getWidth() / 2 + data.mtName.getWidth() / 2;\r\n                }\r\n                //入射角、反射角\r\n                if (!this.isSurfaceAngle(type)) {\r\n                    if (this._reflectorType === 1 || this._reflectorType === 2 || this._reflectorType === 3) {\r\n                        r += 20;\r\n                    } else {\r\n                        r += 13;\r\n                    }\r\n                }\r\n                if (this.isSurfaceAngle(type) || !nameVisible) {\r\n                    var marginX = 0, marginY = 0;\r\n                    if (this.isSurfaceAngle(type)) {\r\n                        if (this._reflectorType === 4) {\r\n                            r = r - 16;//进行偏移更靠近扇面\r\n                            marginX = 9;\r\n                        } else if (this._reflectorType === 5) {\r\n                            r = r - 10;//进行偏移更靠近扇面\r\n                            marginX = 6;\r\n                        } else {\r\n                            marginX = 3;\r\n                        }\r\n                    } else {\r\n                        if (this._reflectorType === 5) {\r\n                            // if (this._nameAutoPos) {\r\n                            //     var percent = 0;\r\n                            //     if (data.angle > 30 && data.angle <= 49) {\r\n                            //         percent = (data.angle - 30) % 20 / 20;\r\n                            //     } else if (data.angle >= 50) {\r\n                            //         percent = 1;\r\n                            //     }\r\n                            //     r = r - 25 * percent;\r\n                            // } else {\r\n                            //     r = r - 27;\r\n                            // }\r\n\r\n                        }\r\n                    }\r\n\r\n                    //this.makeViewAround(data.mtAngle, data.sphereAngle,1000,  r,data.cx, data.cy, 0, 0, false);\r\n                    this.makeAbsViewHorizontal(data.mtAngle, data.sphereAngle, r, data.cx, data.cy, marginX, marginY, false);\r\n                    if (data.mtAngleLetter) {\r\n                        var letterR;\r\n                        if (!data.letterR) {\r\n                            letterR = 110;\r\n                        } else {\r\n                            letterR = data.letterR;\r\n                        }\r\n                        this.makeAbsViewHorizontal(data.mtAngleLetter, data.sphereAngle, letterR, data.cx, data.cy, marginX, marginY, false);\r\n                    }\r\n                } else if (nameVisible) {\r\n\r\n\r\n\r\n                    //获取到角度的位置，并同步名称位置\r\n                    if (isNameVertical) {\r\n                        data.mtInvisibleAngle.setContent(data.angleStr);\r\n                    } else {\r\n                        data.mtInvisibleAngle.setContent(data.name + data.angleStr);\r\n                    }\r\n                    this.makeAbsViewHorizontal(data.mtInvisibleAngle, data.sphereAngle, r, data.cx, data.cy, 0, 0, false);\r\n                    var translate = Svg.getAttrTranslate(data.mtInvisibleAngle.getAttr('transform'));\r\n                    if (isNameVertical) {\r\n                        //在原点上方\r\n                        if (translate[1] < 0) {\r\n                            data.mtAngle.setTranslate(translate[0], translate[1] - data.mtAngle.getHeight() + this._lightHeight);\r\n                            data.mtName.setTranslate(translate[0] + anglePaddingLeft, translate[1] - data.mtAngle.getHeight() - data.mtName.getHeight() + this._lightHeight);\r\n                        } else {\r\n                            //原点下方\r\n                            data.mtName.setTranslate(translate[0] + anglePaddingLeft, translate[1]);\r\n                            data.mtAngle.setTranslate(translate[0], translate[1] - data.mtAngle.getHeight() + data.mtName.getHeight() + this._lightHeight);\r\n                        }\r\n                    } else {\r\n                        //横向排列，名称在前，角度在后\r\n                        data.mtAngle.setTranslate(translate[0] + data.mtName.getWidth(), translate[1]);\r\n                        data.mtName.setTranslate(translate[0], translate[1]);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        isSurfaceAngle: function (type) {\r\n            return type == Sector.Type.SurfaceIn || type == Sector.Type.SurfaceOut;\r\n        },\r\n        setAngleVisibleByType: function (type, visible) {\r\n            //设置内置状态，说明已经绘制过。\r\n            if (visible) {\r\n                this._status[type] = true;\r\n            }\r\n            var data = this._data[type];\r\n            View.setVisibility(data.mtAngle.getView(), visible);\r\n            if (data.mtAngleLetter) {\r\n                View.setVisibility(data.mtAngleLetter, visible);\r\n            }\r\n            if (this._status[type] === true) {\r\n                View.setVisibility(data.mtName.getView(), this._nameVisible);\r\n            }\r\n            this.updatePosByType(type);\r\n        },\r\n        //加入角度判断\r\n        getAngleIsValidByType: function (type) {\r\n            var data = this._data[type];\r\n            if (data.angle === 0 || data.angle === 90) {\r\n                return false;\r\n            }\r\n            return !View.isVisibilityHidden(data.mtAngle.getView());\r\n        },\r\n        getHasDrawStatus: function () {\r\n            return this._status;\r\n        },\r\n        setHasDrawStatus: function (status, type) {\r\n            this._status = status;\r\n        },\r\n        setHasDrawStatusByType: function (status, type) {\r\n            if (typeof type !== typeof  undefined) {\r\n                this._status[type] = status;\r\n                //同步显示名称\r\n                if (this._status[type] === true) {\r\n                    var data = this._data[type];\r\n                    if (data.mtName) {\r\n                        View.setVisibility(data.mtName.getView(), this._nameVisible);\r\n                        this.updatePosByType(type);\r\n                    }\r\n                }\r\n            } else {\r\n                for (var key in   this._status) {\r\n                    this._status[key] = status;\r\n                    //同步显示名称\r\n                    var data = this._data[key];\r\n                    if (data.mtName) {\r\n                        View.setVisibility(data.mtName.getView(), this._nameVisible);\r\n                        this.updatePosByType(key);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        getHasDrawStatusByType: function (type) {\r\n            return this._status[type];\r\n        },\r\n        getAngleVisibilityByType: function (type) {\r\n            var data = this._data[type];\r\n            return !View.isVisibilityHidden(data.mtAngle.getView());\r\n        }\r\n    });\r\n\r\n\r\n    return NameGroup;\r\n});\n/**\r\n * Created by ylf on 2016/7/28.\r\n * 入射线\r\n */\r\ndefine('js/view/normalLine', ['js/view/BaseView', 'js/config/style', 'js/utils/view', 'js/utils/svg'], function (BaseView, Style, View, Svg) {\r\n\r\n\r\n    var NormalLineStyle = Style.NormalLine;\r\n\r\n    var NormalLine = BaseView({\r\n        _$$line: null,\r\n        _domEvent: null,\r\n        _width: 200,\r\n        _$$name: null,\r\n        _pointVisible: false,\r\n        _lineVisible: false,\r\n        _lang: false,\r\n        create: function (width, lang) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._width = width;\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            //1.法线\r\n            this._$$line = new kity.Path('').setStyle(NormalLineStyle.strokeStyle);\r\n            this._$$line.setAttr('d', 'M0 0 ' + this._width + ' 0');\r\n            this._$$line.setAttr('stroke-dasharray', '15,12');\r\n            this.addShape(this._$$line);\r\n\r\n            //2.名称\r\n            this._$$name = new kity.Text();\r\n            this._$$name.setContent(this._lang['rf_normal_name']).setAttr('class', NormalLineStyle.fontClass);\r\n            this.addShape(this._$$name);\r\n\r\n            //3.入射点名称\r\n            this._$$nameDown = new kity.Text();\r\n            this._$$nameDown.setContent(this._lang['rf_incidence_point']).setAttr('class', NormalLineStyle.fontClass);\r\n            this.addShape(this._$$nameDown);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? this._width : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            this._$$line.setRotate(angle + ' ' + x + ' ' + y);\r\n            this.initNamePos(x, y);\r\n        },\r\n        getRotateAngle: function () {\r\n            var rotate = Svg.getAttrRotate(this._$$line.getAttr('transform'));\r\n            return rotate[0];\r\n        },\r\n        initNamePos: function (centerX, centerY) {\r\n            centerX = typeof centerX === typeof undefined ? this._width : centerX;\r\n            centerY = typeof centerY === typeof undefined ? 0 : centerY;\r\n            var downWidth = this._$$nameDown.getWidth();\r\n            var nameWidth = this._$$name.getWidth();\r\n            this.makeViewAround(this._$$name, this._$$line, this._width, this._width + 25, centerX, centerY, -nameWidth / 2 + 17, 0, false);\r\n            this.makeViewAround(this._$$nameDown, this._$$line, 250, 25, centerX, centerY, -downWidth / 2 + 15, 0, true);\r\n        },\r\n        setNameVisible: function (visible) {\r\n            //this._$$nameDown.setContent(visible === true ? this._lang['rf_incidence_point'] : 'O');\r\n            //this._$$name.setContent(visible === true ? this._lang['rf_normal_name'] : 'N');\r\n            this._$$nameDown.setContent(visible === true ? this._lang['rf_incidence_point'] : '');\r\n            this._$$name.setContent(visible === true ? this._lang['rf_normal_name'] : '');\r\n            this.initNamePos();\r\n        },\r\n        setPointNameVisibility: function (nameVisible, visible) {\r\n            this._pointVisible = visible;\r\n            //this._$$nameDown.setContent(nameVisible === true ? this._lang['rf_incidence_point'] : 'O');\r\n            View.setVisibility(this._$$nameDown, visible);\r\n            View.setVisibility(this._$$name, this._lineVisible);\r\n            View.setVisibility(this._$$line, this._lineVisible);\r\n            this.setVisibility(true);\r\n            this.initNamePos();\r\n        },\r\n        setLineVisibility: function (nameVisible, visible) {\r\n            this._lineVisible = visible;\r\n            //this._$$name.setContent(nameVisible === true ? this._lang['rf_normal_name'] : 'N');\r\n            View.setVisibility(this._$$name, visible);\r\n            View.setVisibility(this._$$nameDown, this._pointVisible);\r\n            View.setVisibility(this._$$line, visible);\r\n            this.setVisibility(true);\r\n            this.initNamePos();\r\n        },\r\n        showAll: function () {\r\n            this.setVisibility(true);\r\n            View.setVisibility(this._$$name, true);\r\n            View.setVisibility(this._$$nameDown, true);\r\n            View.setVisibility(this._$$line, true);\r\n            this.initNamePos();\r\n        },\r\n        getLineVisible: function () {\r\n            return this._lineVisible;\r\n        },\r\n        getPointNameVisible: function () {\r\n            return this._pointVisible;\r\n        }\r\n    });\r\n\r\n    return NormalLine;\r\n});\n/**\r\n * Created by ylf on 2016/8/15.\r\n * 垂足符号\r\n */\r\ndefine('js/view/PedalLine', ['js/view/BaseView', 'js/config/style', 'js/utils/view'], function (BaseView, Style) {\r\n\r\n\r\n    var PedalStyle = Style.Pedal;\r\n\r\n\r\n    var PedalLine = BaseView({\r\n        _$$line: null,\r\n        create: function (data) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._data = data;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            var $$line = this._$$line = new kity.Path().setId('dd').setStyle(PedalStyle.strokeStyle);\r\n            var plusDrawer = $$line.getDrawer();\r\n            //为了和线角度统一，这边垂足符号进行了向左90°旋转\r\n            plusDrawer.moveTo(-PedalStyle.width, 0);\r\n            plusDrawer.lineTo(-PedalStyle.width, -PedalStyle.width);//左\r\n            plusDrawer.lineTo(0, -PedalStyle.width);//右\r\n            this.addShape($$line);\r\n        },\r\n        setRotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? 0 : x;\r\n            y = typeof y === typeof undefined ? 0 : y;\r\n            this._$$line.setRotate(angle + ' ' + x + ' ' + y);\r\n        }\r\n    });\r\n\r\n\r\n    return PedalLine;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 夹角扇面\r\n */\r\ndefine('js/view/sector', ['js/view/BaseView', 'js/config/style', 'js/utils/graphmath', 'js/utils/svg', 'js/view/MultipleText'], function (BaseView, Style, GraphMath, Svg, MultipleText) {\r\n\r\n\r\n    var SectorStyle = Style.Sector;\r\n\r\n    var Sector = BaseView({\r\n        _$$sector: null,\r\n        _$$sectorBorder: null,\r\n        _type: 1,\r\n        _startAngle: 0,\r\n        _endAngle: 0,\r\n        _cx: 0,\r\n        _cy: 0,\r\n        _lang: 0,\r\n        _$$incidencePoint: null,\r\n        create: function (type, cx, cy, r, lang) {\r\n            var instance = Object.create(this);\r\n            instance.__base([]);\r\n            instance._type = type;\r\n            instance._cx = cx;\r\n            instance._cy = cy;\r\n            instance._r = r;\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n            this._$$sector = new kity.Path('');\r\n            this._$$sector.setStyle(SectorStyle.strokeStyle);\r\n            this._$$sectorBorder = new kity.Path('');\r\n            this._$$sectorBorder.setStyle(SectorStyle.strokeStyle);\r\n\r\n            //名称和度数\r\n            if (this._type === Sector.Type.SurfaceIn || this._type === Sector.Type.SurfaceOut) {\r\n                //与反射面夹角\r\n                this._$$sector.fill(SectorStyle.surfaceFill);\r\n            } else if (this._type === Sector.Type.Incidence) {\r\n                //入射线与法线夹角\r\n                this._$$sector.fill(SectorStyle.incidenceFill);\r\n            } else if (this._type === Sector.Type.Reflection) {\r\n                //反射线与法线夹角\r\n                this._$$sector.fill(SectorStyle.reflectionFill);\r\n            }\r\n            this.addShape(this._$$sector);\r\n            this.addShape(this._$$sectorBorder);\r\n        },\r\n        rotate: function (startAngle, endAngle) {\r\n            //装换为扇面内部角度，扇面角度从右侧到左侧0~180\r\n            this._startAngle = startAngle;\r\n            this._endAngle = endAngle;\r\n            var absEndAngle = 180 - startAngle;\r\n            var absStartAngle = 180 - endAngle;\r\n            var str = GraphMath.getSvgSectorPoint(this._cx, this._cy, this._r, absStartAngle, absEndAngle);\r\n\r\n            this._$$sector.setAttr('d', str);\r\n            this._$$sector.setStyle({opacity:0.6});\r\n            this._$$sectorBorder.setAttr('d', str);\r\n        }\r\n\r\n    });\r\n\r\n    Sector.Type = {\r\n        Incidence: 1,\r\n        Reflection: 2,\r\n        SurfaceIn: 3,\r\n        SurfaceOut: 4\r\n    };\r\n\r\n    return Sector;\r\n});\n/**\r\n * Created by ylf on 2016/7/25.\r\n * 平面\r\n */\r\ndefine('js/view/surface', ['js/view/BaseView', 'js/config/style', 'js/utils/utils', 'js/utils/svg', 'js/view/ForeignView', 'js/config/eventKey', 'js/utils/view'], function (BaseView, Style, Utils, Svg, ForeignView, EventKey, View) {\r\n\r\n    var GraphMath = require('js/utils/graphmath');\r\n    var SurfaceStyle = Style.Surface;\r\n\r\n    var CONFIG = {\r\n        width: 520,\r\n        defaultAngle: 0,\r\n        rotatePosX: 5,//旋转位置 ，远点扣除左侧的空白\r\n        rotatePosY: 4,//y旋转位置，计算了样式空白造成的偏移量\r\n        visible: true,\r\n        clickAble: true,\r\n        nameEnable: true,\r\n        nameEventEnable: true,\r\n        type: ''//类型\r\n    };\r\n\r\n    var Surface = BaseView({\r\n        _config: null,\r\n        _$$surface: null,\r\n        _$$name: null,\r\n        _onSurfaceMove: null,\r\n        _lang: null,\r\n        _$$incidencePoint: null,\r\n        create: function (eventbus, config, onSurfaceMove, lang) {\r\n            var instance = Object.create(this);\r\n            instance._config = $.extend(true, {}, CONFIG, config);\r\n            //监听失去焦点\r\n            var eventInfos = [];\r\n            if (instance._config.nameEventEnable) {\r\n                eventInfos.push({key: EventKey.NameVisible, callback: 'nameVisibleHandler', params: []});\r\n            }\r\n            eventInfos.push({key: EventKey.Blur, callback: instance.blur, params: []});\r\n\r\n            instance.__base(eventbus, eventInfos);\r\n\r\n            instance._type = config.type;\r\n            instance._onSurfaceMove = onSurfaceMove;\r\n            instance._lang = lang;\r\n            instance.createView();\r\n            instance.__on(EventKey.BtnMove + instance._fwBtn.getUuid(), instance.domEventHandler, []);\r\n            return instance;\r\n        },\r\n        createView: function () {\r\n\r\n            this._$$surface = new kity.Group();\r\n\r\n            var cls = 'wall_tl';\r\n            if (Surface.Type.tl === this._type) {\r\n                cls = 'wall_tl';\r\n            } else if (Surface.Type.tr === this._type) {\r\n                cls = 'wall_tr';\r\n            } else if (Surface.Type.tl_Large === this._type) {\r\n                cls = 'wall_tl_large';\r\n            }\r\n            //1.反射面\r\n            this._fwSurface = ForeignView.create(cls, this._config.width, SurfaceStyle.height);\r\n            $(this._$$surface.node).append(this._fwSurface.getView());\r\n            this.addShape(this._$$surface);\r\n\r\n            //添加一个标记，用于获取旋转点的offset坐标\r\n            this._$$offsetPoint = new kity.Circle(10).fill(kity.Color.createRGBA(0, 0, 0, 0));\r\n            //View.setVisibility(this._$$offsetPoint, false);\r\n            this._$$offsetPoint.setTranslate(this._config.rotatePosX, this._config.rotatePosY);\r\n            this.addShape(this._$$offsetPoint);\r\n\r\n\r\n            //名称\r\n            this._$$name = new kity.Text();\r\n            this._$$name.setContent(this._lang['rf_reflection_surface']).setAttr('class', SurfaceStyle.fontClass);\r\n            if (!this._config.nameEnable) {\r\n                View.setVisibility(this._$$name, false);\r\n            }\r\n            this.addShape(this._$$name);\r\n\r\n            //旋转按钮\r\n            this._fwBtn = ForeignView.create('btn_rotate', SurfaceStyle.btnRotate.width, SurfaceStyle.btnRotate.height);\r\n            this._fwBtnInvisible = ForeignView.create('btn_rotate', SurfaceStyle.btnRotate.width, SurfaceStyle.btnRotate.height);\r\n            this._fwBtnInvisible.setVisibility(false);\r\n            $(this._$$surface.node).append(this._fwBtn.getView());\r\n            $(this._$$surface.node).append(this._fwBtnInvisible.getView());\r\n            this.intOriginalFwBtnPos();\r\n\r\n            //处理样式中3像素的图片偏移量\r\n            this.setTranslate(0, -3);\r\n\r\n            //绑定事件\r\n            this.bindDomEvent(this._$$surface.node, ['lrTap'], this.getUuid(), this.domEventHandler);\r\n            this.bindDomEvent(this._fwBtn.getView(), ['down', 'beforemove', 'move', 'aftermove'], this._fwBtn.getUuid(), this.domEventHandler);\r\n\r\n            this._fwBtn.setVisibility(false);\r\n\r\n            $(this.getView().node).attr('class', '_lr_surface');\r\n\r\n            this.setVisibility(this._config.visible);\r\n        },\r\n        intOriginalFwBtnPos: function () {\r\n            if (this._type === Surface.Type.tl) {\r\n                this._fwBtn.setTranslate(this._config.width + 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n                this._fwBtnInvisible.setTranslate(this._config.width + 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n            } else {\r\n                this._fwBtn.setTranslate(-SurfaceStyle.btnRotate.width - 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n                this._fwBtnInvisible.setTranslate(-SurfaceStyle.btnRotate.width - 10, (SurfaceStyle.height - SurfaceStyle.btnRotate.height) / 2);\r\n            }\r\n        },\r\n        blur: function (uuid) {\r\n            if (uuid !== this.getUuid()) {\r\n                this.setFwBtnVisible(false);\r\n                this._fwSurface.removeClass('on');\r\n            }\r\n        },\r\n        domEventHandler: function (eventType, uuid, data) {\r\n            if (!this._config.clickAble) {\r\n                return;\r\n            }\r\n            if (uuid === this.getUuid()) {\r\n                if (eventType === 'lrTap') {\r\n                    if (this._fwSurface.hasClass('on')) {\r\n                        this.blur();\r\n                        return;\r\n                    }\r\n                    this.setFwBtnVisible(true);\r\n                    this._fwSurface.addClass('on');\r\n                }\r\n            } else if (uuid === this._fwBtn.getUuid()) {\r\n                this._onSurfaceMove(data, eventType);\r\n                if (eventType === 'down') {\r\n                    this._fwSurface.addClass('on')\r\n                } else if (eventType === 'beforemove') {\r\n\r\n                } else if (eventType === 'aftermove') {\r\n                    this.__triggerEvent('insidechange', 'surface-move');\r\n                }\r\n            }\r\n            this.btnStillInBox();\r\n        },\r\n        getSurfaceXAxisDegree: function (surface) {\r\n            var degree = surface.getRotateAngle() % 180;\r\n            //角度换算\r\n            if (degree <= 0) {\r\n                degree = -degree;\r\n            } else {\r\n                degree = 180 - degree;\r\n            }\r\n            return degree;\r\n        },\r\n        setMoveListener: function (listner) {\r\n            this._moveListener = listner;\r\n        },\r\n        btnStillInBox: function () {\r\n            var originalRect = this._fwBtnInvisible.getView()[0].getBoundingClientRect();\r\n            var svgRect = this._fwBtn.getView().closest('svg')[0].getBoundingClientRect();\r\n            var angle = Math.abs(this.getRotateAngle() % 180);\r\n            //统一计算与X轴锐角\r\n            if (angle <= 0) {\r\n                angle = -angle;\r\n            }\r\n            if (angle > 90) {\r\n                angle = 180 - angle;\r\n            }\r\n\r\n            var translate = Svg.getAttrTranslate(this._fwBtnInvisible.getView().attr('transform'));\r\n            if (translate.length <= 0) {\r\n                return;\r\n            }\r\n            var flag = false;\r\n\r\n            //inside svg\r\n            if (originalRect.bottom <= svgRect.bottom && originalRect.left >= svgRect.left && originalRect.right <= svgRect.right && originalRect.top >= svgRect.top) {\r\n                if (this._type === Surface.Type.tl) {\r\n                    this.fwBtnTranslate(this._config.width + 10, translate[1]);\r\n                } else {\r\n                    this.fwBtnTranslate(-SurfaceStyle.btnRotate.width - 10, translate[1]);\r\n                }\r\n            } else {\r\n                var translateX = 0;\r\n                var scale = this.getScale();\r\n                var isRight = this._type === Surface.Type.tl;\r\n                if (originalRect.left <= svgRect.left) {\r\n                    //超出左侧\r\n                    var subY = svgRect.left - originalRect.left;\r\n                    var x = (subY / Math.cos(GraphMath.getRadian(angle))) / scale;\r\n                    translateX = translate[0] - (isRight ? x : -x);\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                if (originalRect.bottom >= svgRect.bottom) {\r\n                    // 超出下方\r\n                    var subY = originalRect.bottom - svgRect.bottom;\r\n                    var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    if (isRight) {\r\n                        if (translateX == 0 || translateX > translate[0] - x) {\r\n                            translateX = translate[0] - x\r\n                        }\r\n                    } else {\r\n                        if (translateX == 0 || translateX < translate[0] + x) {\r\n                            translateX = translate[0] + x\r\n                        }\r\n                    }\r\n\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n\r\n                //超出上方\r\n                if (originalRect.top <= svgRect.top) {\r\n                    var subY = svgRect.top - originalRect.top;\r\n                    var x = (subY / Math.sin(GraphMath.getRadian(angle))) / scale;\r\n                    if (isRight) {\r\n                        if (translateX == 0 || translateX > translate[0] - x) {\r\n                            translateX = translate[0] - x\r\n                        }\r\n                    } else {\r\n                        if (translateX == 0 || translateX < translate[0] + x) {\r\n                            translateX = translate[0] + x\r\n                        }\r\n                    }\r\n                    this.fwBtnTranslate(translateX, translate[1]);\r\n                }\r\n            }\r\n        },\r\n        rotate: function (angle, x, y) {\r\n            x = typeof x === typeof undefined ? this._config.rotatePosX : x;\r\n            y = typeof y === typeof undefined ? this._config.rotatePosY : y;\r\n            var rotate = Svg.getAttrRotate(this._$$surface.getAttr('transform'));\r\n            if (rotate && rotate.length > 0) {\r\n                this._$$surface.setRotate((rotate[0] + angle) + ' ' + x + ' ' + y);\r\n            } else {\r\n                this._$$surface.setRotate(angle + ' ' + x + ' ' + y);\r\n            }\r\n            this.initNamePos(x, y);\r\n            this.fwBtnMove();\r\n        },\r\n        getRotateOffsetPos: function () {\r\n            var offset = $(this._$$offsetPoint.node).offset();\r\n            return {\r\n                x: offset.left,\r\n                y: offset.top\r\n            };\r\n        },\r\n        getRotateAngle: function () {\r\n            var rotate = Svg.getAttrRotate(this._$$surface.getAttr('transform'));\r\n            return rotate[0] || 0;\r\n        },\r\n        initNamePos: function (x, y) {\r\n            var r = this._config.rotatePosX + 100;\r\n            var distance = this._config.rotatePosX + 20;\r\n            this.makeViewAround(this._$$name, this._$$surface, r, distance, this._config.rotatePosX, y, 0, 0, false);\r\n        },\r\n        setNameVisible: function (visible) {\r\n            if (this._config.nameEnable) {\r\n                View.setVisibility(this._$$name, visible);\r\n            }\r\n        },\r\n        nameVisibleHandler: function (visible) {\r\n            this.setNameVisible(visible);\r\n        },\r\n        setClickAble: function (clickable) {\r\n            this._config.clickAble = clickable;\r\n        },\r\n        getScale: function () {\r\n            var scale = (this._$$offsetPoint.node.getBoundingClientRect().width / 20) || 1;\r\n            return scale;\r\n        },\r\n        get0To360RotateAngle: function () {\r\n            var angle = this.getRotateAngle() % 360;\r\n            if (angle < 0) {\r\n                angle = 360 + angle;\r\n            }\r\n            return angle;\r\n        },\r\n        fwBtnMove: function () {\r\n            if (!this._config.clickAble) {\r\n                return\r\n            }\r\n            if (!this.isVisibilityHidden() && this._moveListener) {\r\n                this._moveListener(this.getScale(), this._fwBtn.getView()[0].getBoundingClientRect(), this._fwBtn.getUuid());\r\n            }\r\n        },\r\n        setFwBtnVisible: function (visible) {\r\n            if (!this._config.clickAble) {\r\n                return\r\n            }\r\n            if (this._moveListener) {\r\n                this._moveListener(this.getScale(), this._fwBtn.getView()[0].getBoundingClientRect(), this._fwBtn.getUuid(), visible);\r\n            }\r\n        },\r\n        fwBtnTranslate: function (x, y) {\r\n            this._fwBtn.setTranslate(x, y);\r\n            this.fwBtnMove();\r\n        }\r\n    });\r\n    Surface.Type = {\r\n        tl: 'tl',\r\n        tr: 'tr',\r\n        tl_Large: 'wall_tl_large'\r\n    }\r\n    return Surface;\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/reflector/lightComplex/config', [], function () {\r\n\r\n    var LightLine = require('js/view/LightLine');\r\n    /**\r\n     * StaticLine{\r\n            width: 370,//整体长度\r\n            arrowPos: 180,//箭号所在位置\r\n            defaultAngle: 60,//默认角度\r\n            visible: true,//是否显示\r\n            clickAble: true,//是否允许点击和移动\r\n            rotateFixed: true,//是否旋转时，固定不动\r\n            highLineZIndex: false,//反射和入射线中是否层级更高\r\n            autoAdsorption: true,//是否自动吸附\r\n            arrowReverse: false,//箭头反转\r\n            lineType: LightLine.Type.Reverse\r\n        }\r\n     */\r\n    var Config = {\r\n        IncidenceLine: {\r\n            width: 370,//整体长度\r\n            arrowPos: 150,//箭号所在位置\r\n            defaultAngle: 50,//默认角度\r\n            visible: true,//是否显示\r\n            clickAble: true,//是否允许点击和移动\r\n            rotateFixed: true,//是否旋转时，固定不动\r\n            PedalWidth: 370,//垂足显示时的长度\r\n            PedalArrowPos: 140,//垂足显示时箭头位置\r\n            rotateFixedAfterDraw: false,//一步完成、或逐步画开始后，不跟随反射面移动而移动\r\n            highLineZIndex: false,//反射和入射线中是否层级更高\r\n            nameEnable: true,//是否需要名称支持\r\n            arrowVisible: true//是否显示箭头\r\n        },\r\n        ReflectionLine: {\r\n            width: 370,\r\n            arrowPos: 240,\r\n            visible: true,\r\n            clickAble: true,\r\n            rotateFixed: false,\r\n            PedalWidth: 280,//垂足显示时的长度\r\n            PedalArrowPos: 155,//垂足显示时箭头位置\r\n            rotateFixedAfterDraw: false,\r\n            nameEnable: true,\r\n            arrowVisible: true\r\n        },\r\n        NormalLine: {\r\n            width: 400,\r\n            lineVisible: false,\r\n            pointNameVisible: false,\r\n            visible: true\r\n        },\r\n        StaticLine: [],\r\n        Sector: {\r\n            sectorInVisible: true,\r\n            sectorOutVisible: true,\r\n            incidenceVisible: true,\r\n            reflectionVisible: true,\r\n            incidenceR: 65,\r\n            reflectionR: 76,\r\n            surfaceR: 55,\r\n            letterR: 76,\r\n            angleR: 76\r\n        },\r\n        IncidencePointVisible: false,\r\n        PedalLineVisible: false,\r\n        IncidencePosX: 0,//入射点位置\r\n        DrawIndex: [0, 1, 2, 3],//绘制动画内容和顺序\r\n        PedalDrawIndex: [[0, 1], [5, 6], [10]],//TODO:反射镜=入射角的还未处理//绘制动画内容和顺序\r\n        Visible: true,\r\n        view90PedalLineVisible: true,//处理垂足时候显示垂足符号\r\n        nameEventEnable: true,//名称显示事件支持\r\n        NameAutoPos: false\r\n    };\r\n\r\n\r\n    return Config;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/reflector/lightComplex/draw', ['js/view/sector', 'js/utils/utils', 'js/utils/view'], function (Sector, Utils, View) {\r\n\r\n    var LightComplexDraw = {\r\n        _hasDrawBegin: false,\r\n        _hasDrawNext: true,\r\n        setDrawBegin: function (hasDrawBegin) {\r\n            this._hasDrawBegin = hasDrawBegin;\r\n            //固定预设线，不可跟随旋转\r\n            if (this._configData.IncidenceLine.rotateFixedAfterDraw) {\r\n                this._configData.IncidenceLine.rotateFixed = true;\r\n            }\r\n            if (this._configData.ReflectionLine.rotateFixedAfterDraw) {\r\n                this._configData.ReflectionLine.rotateFixed = true;\r\n            }\r\n\r\n        },\r\n        getDrawBegin: function () {\r\n            return this._hasDrawBegin;\r\n        },\r\n        drawAll: function (cb) {\r\n            //隐藏状态下不能绘制\r\n            if (this.isVisibilityHidden()) {\r\n                return;\r\n            }\r\n            //设置所有扇面都绘制过\r\n            this.setSectorInsideDrawStatus(true);\r\n            this.setDrawBegin(true);\r\n            var that = this;\r\n            this._drawCommand.stop(function () {\r\n                that._drawCommand.drawAll(null, false);\r\n                //自动吸附90°\r\n                that.adsorptionPedal();\r\n                that.__triggerEvent('insidechange', 'drawAll');\r\n                cb && cb();\r\n            });\r\n        },\r\n        drawNext: function (cb) {\r\n            //隐藏状态下不能绘制\r\n            if (this.isVisibilityHidden()) {\r\n                return;\r\n            }\r\n            this.setDrawBegin(true);\r\n            var that = this;\r\n            if(!this._drawCommand.hasNext()){\r\n                cb && cb();\r\n            }else{\r\n                this._drawCommand.drawNext(function () {\r\n                    //绘制完后隐藏相应视图\r\n                    //that._hasDrawNext = that._drawCommand.hasNext();\r\n                    //自动吸附90°\r\n                    that.adsorptionPedal();\r\n                    that.__triggerEvent('insidechange', 'drawNext');\r\n                    cb && cb();\r\n                }, true);\r\n            }\r\n\r\n        },\r\n        hasNext: function () {\r\n            //隐藏状态下不能绘制\r\n            if (this.isVisibilityHidden()) {\r\n                return false;\r\n            }\r\n            //return this._hasDrawNext;\r\n            return this._drawCommand.hasNext();\r\n        },\r\n        hasNextWidthOutVisibilityStatus: function () {\r\n            //return this._hasDrawNext;\r\n            return this._drawCommand.hasNext();\r\n        },\r\n        initDrawCommand: function () {\r\n            var that = this;\r\n            that._hsdrawIncidencePoint = false;\r\n            //0.入射点闪烁显示\r\n            this._drawCommand.push(function (deffer, animate) {\r\n\r\n                that._hsdrawIncidencePoint = true;\r\n                if (animate) {\r\n                    View.setVisibility(that._$$incidencePoint, true);\r\n                    $(that._$$incidencePoint.node).fadeIn(300).fadeOut(300).fadeIn(300, function () {\r\n                        View.setVisibility(that._$$incidencePoint, false);\r\n                        deffer.resolve();\r\n                    });\r\n                } else {\r\n                    deffer.resolve();\r\n                }\r\n            }, function () {\r\n                return that._hsdrawIncidencePoint;\r\n                //return !View.isVisibilityHidden(that._$$incidencePoint);\r\n            });\r\n\r\n            //1.入射点名称\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                that._normalLine.setPointNameVisibility(that._option.nameVisible, true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return that._normalLine.getPointNameVisible();\r\n            });\r\n\r\n            //2.入射于反射面扇面\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                if (that._option.surfaceAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.SurfaceIn, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.SurfaceIn);\r\n                deffer.resolve();\r\n            }, function () {\r\n                //扇面不可用\r\n                if (!that.getSectorEnable()) {\r\n                    return true;\r\n                }\r\n                if (that._option.surfaceAngleVisible === true && !that.isPedal()) {\r\n                    return !that._surfaceInSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n            //3.入射光线\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                that._incidenceLine.setVisibility(true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._incidenceLine.isVisibilityHidden();\r\n            });\r\n\r\n            //4.入射角\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                //扇面显示时才显示角度\r\n                if (that._option.normalAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.Incidence, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.Incidence);\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (!that.getSectorEnable()) {\r\n                    return true;\r\n                }\r\n                if (that._option.normalAngleVisible === true && !that.isPedal()) {\r\n                    return !that._incidenceSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n            //5.法线\r\n            this._drawCommand.push(function (deffer) {\r\n                that._normalLine.setLineVisibility(that._option.nameVisible, true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return that._normalLine.getLineVisible();\r\n            });\r\n\r\n            //6.垂足符号\r\n            this._drawCommand.push(function (deffer) {\r\n                that._pedalLine.setVisibility(true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._pedalLine.isVisibilityHidden();\r\n            });\r\n\r\n\r\n            //7.反射角\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                //扇面显示时才显示角度\r\n                if (that._option.normalAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.Reflection, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.Reflection);\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (!that.getSectorEnable()) {\r\n                    return true;\r\n                }\r\n                if (that._option.normalAngleVisible === true && !that.isPedal()) {\r\n                    return !that._reflectionSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n\r\n            //8.反射线\r\n            this._drawCommand.push(function (deffer) {\r\n                that._reflectionLine.setVisibility(true);\r\n                deffer.resolve();\r\n            }, function () {\r\n                return !that._reflectionLine.isVisibilityHidden()\r\n            });\r\n\r\n            //9.反射线与反射面扇面\r\n            this._drawCommand.push(function (deffer) {\r\n                if (that._option.surfaceAngleVisible === true) {\r\n                    that.setSectorVisibilityByType(Sector.Type.SurfaceOut, true);\r\n                }\r\n                that.setSectorInsideDrawStatus(true, Sector.Type.SurfaceOut);\r\n                deffer.resolve();\r\n            }, function () {\r\n                if (!that.getSectorEnable()) {\r\n                    return true;\r\n                }\r\n                if (that._option.surfaceAngleVisible === true && !that.isPedal()) {\r\n                    return !that._surfaceOutSector.isVisibilityHidden();\r\n                }\r\n                return true;\r\n            });\r\n\r\n\r\n            //10.显示垂足的入射光线、反射光线\r\n            this._drawCommand.push(function (deffer) {\r\n                that._incidenceLine.setVisibility(true);\r\n                that._reflectionLine.setVisibility(true);\r\n                that._incidenceLine.setWidth(that._configData.IncidenceLine.PedalWidth);\r\n                that._incidenceLine.setArrowPos(that._configData.IncidenceLine.PedalArrowPos);\r\n                that._reflectionLine.setWidth(that._configData.ReflectionLine.PedalWidth);\r\n                that.resetLinePos();\r\n                that._reflectionLine.setArrowPos(that._configData.ReflectionLine.PedalArrowPos);\r\n                deffer.resolve();\r\n\r\n            }, function () {\r\n                return !that._reflectionLine.isVisibilityHidden() && !that._incidenceLine.isVisibilityHidden() && (that._reflectionLine.getWidth() === that._configData.ReflectionLine.PedalWidth);\r\n            });\r\n            //11.入射角、反射镜闪烁隐藏\r\n            this._drawCommand.push(function (deffer, animate) {\r\n                //that._draw11 = true;\r\n                //扇面显示时才显示角度\r\n                if (that._option.normalAngleVisible === false && animate) {\r\n                    that.sectorAnimateDisappear(function () {\r\n                        deffer.resolve();\r\n                    });\r\n                } else {\r\n                    deffer.resolve();\r\n                }\r\n            }, function () {\r\n                return that.getSectorHasDraw(Sector.Type.Incidence) && that.getSectorHasDraw(Sector.Type.Reflection);\r\n            });\r\n\r\n            //初始化绘制状态\r\n            this.initDrawStatus();\r\n        },\r\n        getCommandLength: function () {\r\n            return this._drawCommand.getCommandLength();\r\n        },\r\n        pushDrawCommand: function (command, hasDrawFuns) {\r\n            this._drawCommand.push(command, hasDrawFuns);\r\n        },\r\n        setDrawIndex: function (drawIndex) {\r\n            this._configData.DrawIndex = drawIndex;\r\n            if (!this.isPedal()) {\r\n                this._drawCommand.setDrawIndex(drawIndex);\r\n            }\r\n        },\r\n        setPedalDrawIndex: function (pedalDrawIndex) {\r\n            this._configData.PedalDrawIndex = pedalDrawIndex;\r\n            if (this.isPedal()) {\r\n                this._drawCommand.setDrawIndex(pedalDrawIndex);\r\n            }\r\n        },\r\n        //显示预设4的垂足入射、反射线\r\n        setIncidenceShortPedalView: function (width) {\r\n            this._incidenceLine.setVisibility(true);\r\n            this._reflectionLine.setVisibility(true);\r\n\r\n            this._incidenceLine.setWidth(width || this._configData.IncidenceLine.PedalWidth);\r\n            if (width === this._configData.IncidenceLine.PedalWidth) {\r\n                this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos);\r\n            }\r\n            this._reflectionLine.setWidth(this._configData.ReflectionLine.PedalWidth);\r\n            this._reflectionLine.setArrowPos(this._configData.ReflectionLine.PedalArrowPos);\r\n            this.resetLinePos();\r\n        },\r\n        isDrawIncidenceShortPedalView: function (width) {\r\n            return !this._reflectionLine.isVisibilityHidden() && !this._incidenceLine.isVisibilityHidden() && (this._incidenceLine.getWidth() === (width || this._configData.IncidenceLine.PedalWidth));\r\n        },\r\n        getHasDrawIncidencePoint: function () {\r\n            return this._hsdrawIncidencePoint;\r\n        },\r\n        initDrawStatus: function () {\r\n            var draw = this._configData.Draw;\r\n            if (draw) {\r\n                this._hsdrawIncidencePoint = draw.incidencePoint;\r\n            }\r\n        }\r\n    };\r\n\r\n    return LightComplexDraw;\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/reflector/lightComplex/event', ['js/view/sector'], function (Sector) {\r\n\r\n    var LightComplexEvent = {\r\n        surfaceAngleVisibleHandler: function (visible) {\r\n            this.setSectorVisibilityByOutSideLogic(Sector.Type.SurfaceIn, visible);\r\n            this.setSectorVisibilityByOutSideLogic(Sector.Type.SurfaceOut, visible);\r\n        },\r\n        normalAngleVisibleHandler: function (visible) {\r\n            this.setSectorVisibilityByOutSideLogic(Sector.Type.Incidence, visible);\r\n            this.setSectorVisibilityByOutSideLogic(Sector.Type.Reflection, visible);\r\n        },\r\n        setNameVisible: function (visible) {\r\n            this._incidenceLine.setNameVisible(visible);\r\n            this._reflectionLine.setNameVisible(visible);\r\n            this.getNameGroup().setNameVisible(visible);\r\n            this._normalLine.setNameVisible(visible);\r\n        },\r\n        nameVisibleHandler: function (visible) {\r\n            this.setNameVisible(visible);\r\n        }\r\n\r\n    };\r\n\r\n    return LightComplexEvent;\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/reflector/lightComplex/main', ['js/reflector/baseReflector', 'js/utils/utils', 'js/utils/graphMath', 'js/config/style', 'js/config/eventKey', 'js/utils/view'], function (BaseReflector, Utils, GraphMath, Style, EventKey, View) {\r\n\r\n    //view\r\n    var BaseView = require('js/view/BaseView');\r\n    var Sector = require('js/view/sector');\r\n    var LightLine = require('js/view/LightLine');\r\n    var NormalLine = require('js/view/NormalLine');\r\n    var NameGroup = require('js/view/NameGroup');\r\n    var PedalLine = require('js/view/PedalLine');\r\n    var DrawCommand = require('js/utils/DrawCommand');\r\n    var Config = require('js/reflector/lightComplex/config');\r\n\r\n    var Btns = require('js/reflector/btns');\r\n    var MinAngle = 5;\r\n    var IncidencePointStyle = Style.IncidencePoint;\r\n\r\n    var LightComplex = BaseView({\r\n            _data: null,\r\n            _configData: null,\r\n            _onLightMove: null,\r\n            _option: null,\r\n            _reflectorType: 0,\r\n            _staticLines: [],//静态线\r\n            _linePedalChangeLock: false,\r\n            _lineMoveListener: null,\r\n            _hasDrawNext: true,//是否还有下一步\r\n            create: function (eventBus, configData, onLightMove, option, reflectorType) {\r\n                var instance = Object.create(this);\r\n                instance._uuid = Utils.getUuid();\r\n                instance._reflectorType = reflectorType;\r\n                instance._configData = $.extend(true, {}, Config, configData);\r\n                instance._configData.DrawIndex = $.extend(true, [], configData.DrawIndex || Config.DrawIndex);\r\n                instance._configData.PedalDrawIndex = $.extend(true, [], configData.PedalDrawIndex || Config.PedalDrawIndex);\r\n                //事件绑定\r\n                var eventsInfo = [];\r\n                instance._staticLines = [];\r\n                eventsInfo.push({key: EventKey.SurfaceAngleVisible, callback: 'surfaceAngleVisibleHandler', params: []});\r\n                eventsInfo.push({key: EventKey.NormalAngleVisible, callback: 'normalAngleVisibleHandler', params: []});\r\n                if (instance._configData.nameEventEnable) {\r\n                    eventsInfo.push({key: EventKey.NameVisible, callback: 'nameVisibleHandler', params: []});\r\n                }\r\n                eventsInfo.push({key: EventKey.ZIndexChange, callback: 'zIndexChangeHandler', params: []});\r\n                instance.__base(eventBus, eventsInfo);\r\n                instance.__proxyAll(['onLightMove']);//绑定this指针\r\n                instance._option = option;\r\n                instance._onLightMove = onLightMove;\r\n                instance._drawCommand = DrawCommand.create();\r\n                instance._drawCommand.setDrawIndex(instance._configData.DrawIndex);\r\n                instance.initBtns();\r\n                instance.createView();\r\n                instance.initVisibleState();\r\n                instance.initDrawCommand();\r\n                instance.initDomEvent();\r\n                return instance;\r\n            },\r\n            createView: function () {\r\n                var that = this;\r\n                var configData = this._configData;\r\n                var appendPosX = 0;//内部偏移坐标\r\n                //夹角扇面和名称\r\n                this.createSector(appendPosX);\r\n                //静态线\r\n                for (var i = 0; i < configData.StaticLine.length; i++) {\r\n                    var line = LightLine.create(this.__getEventBus(), configData.StaticLine[i].lineType, configData.StaticLine[i]);\r\n                    this.addShape(line.getView());\r\n                    this._staticLines.push(line);\r\n                }\r\n\r\n\r\n                //反射、入射线\r\n                this._reflectionLine = LightLine.create(this.__getEventBus(), LightLine.Type.ReflectionLine, configData.ReflectionLine, this.onLightMove, this._option.langData);\r\n                this._incidenceLine = LightLine.create(this.__getEventBus(), LightLine.Type.IncidenceLine, configData.IncidenceLine, this.onLightMove, this._option.langData, this._option.showDefaultRotateBtn);\r\n                if (configData.IncidenceLine.clickAble) {\r\n                    this._incidenceLine.setMoveListener(function (scale, clientRect, uuid, visible) {\r\n                        that.btns.moveBtnEventHandler(scale, clientRect, uuid, visible);\r\n                        // that._reflectionLine.fwBtnMove();\r\n                        // that._staticLines.forEach(function (line, i) {\r\n                        //     line.fwBtnMove();\r\n                        // });\r\n                        if (that._lineMoveListener) {\r\n                            that._lineMoveListener();\r\n                        }\r\n                    })\r\n                }\r\n                if (configData.ReflectionLine.clickAble) {\r\n                    this._reflectionLine.setMoveListener(function (scale, clientRect, uuid, visible) {\r\n                        that.btns.moveBtnEventHandler(scale, clientRect, uuid, visible);\r\n                        // that._incidenceLine.fwBtnMove();\r\n                        // that._staticLines.forEach(function (line, i) {\r\n                        //     line.fwBtnMove();\r\n                        // });\r\n                        if (that._lineMoveListener) {\r\n                            that._lineMoveListener();\r\n                        }\r\n                    })\r\n                }\r\n                //法线\r\n                this._normalLine = NormalLine.create(configData.NormalLine.width, this._option.langData);\r\n                //垂足符号\r\n                this._pedalLine = PedalLine.create();\r\n\r\n                this.appendSector();\r\n\r\n                this.addShape(this._normalLine.getView());\r\n                if (configData.IncidenceLine.highLineZIndex) {\r\n                    this.addShape(this._reflectionLine.getView());\r\n                    this.addShape(this._incidenceLine.getView());\r\n                } else {\r\n                    this.addShape(this._incidenceLine.getView());\r\n                    this.addShape(this._reflectionLine.getView());\r\n                }\r\n\r\n                this.addShape(this._pedalLine.getView());\r\n\r\n                var translateX = -(Math.abs(appendPosX - configData.IncidenceLine.width));\r\n                var reflectionTranslateX = -(Math.abs(appendPosX - configData.ReflectionLine.width));\r\n                var translateY = -3;//向上偏移一个像素，防止底部突出\r\n                var normalTranslateX = -(Math.abs(appendPosX - configData.NormalLine.width));\r\n\r\n                this._incidenceLine.setTranslate(translateX, translateY);\r\n                this._incidenceLine.setRotate(configData.IncidenceLine.defaultAngle);\r\n\r\n                this._reflectionLine.setTranslate(reflectionTranslateX, translateY);\r\n                this._reflectionLine.setRotate(180 - configData.IncidenceLine.defaultAngle);\r\n                this._normalLine.setTranslate(normalTranslateX, 1);//向下偏移1像素，反正水平面垂直时无法和光线重合\r\n\r\n                this._staticLines.forEach(function (line, i) {\r\n                    var lineConfig = configData.StaticLine[i];\r\n                    var translateX = -(Math.abs(appendPosX - lineConfig.width));\r\n                    line.setTranslate(translateX, translateY);\r\n                    line.setRotate(lineConfig.defaultAngle);\r\n                });\r\n\r\n                //定位到入射点\r\n                this.setTranslate(this._configData.IncidencePosX, 0);\r\n\r\n                //入射点\r\n                this._$$incidencePoint = new kity.Circle(IncidencePointStyle.width).fill(IncidencePointStyle.fill);\r\n                this._$$incidencePoint.setTranslate(this._configData.IncidencePosX, 0);\r\n\r\n\r\n            },\r\n            setLineMoveListener: function (lineMoveListener) {\r\n                this._lineMoveListener = lineMoveListener\r\n            },\r\n            btnStillInBox: function () {\r\n                this._reflectionLine.btnStillInBox();\r\n                this._incidenceLine.btnStillInBox();\r\n                this._staticLines.forEach(function (line, i) {\r\n                    line.btnStillInBox();\r\n                });\r\n            },\r\n            initBtns: function () {\r\n                var count = this._configData.IncidenceLine.clickAble ? 1 : 0;\r\n                if (this._configData.ReflectionLine.clickAble) {\r\n                    count++;\r\n                }\r\n                this.btns = Btns.create(this.__getEventBus(), this._$$container, count);\r\n            }\r\n            ,\r\n            initVisibleState: function () {\r\n\r\n                var configData = this._configData;\r\n                this.initSectorVisibleState();\r\n                this.surfaceAngleVisibleHandler(this._option.surfaceAngleVisible);\r\n                this.normalAngleVisibleHandler(this._option.normalAngleVisible);\r\n                this.nameVisibleHandler(this._option.nameVisible);\r\n\r\n                this._normalLine.setVisibility(configData.NormalLine.visible);\r\n                this._pedalLine.setVisibility(configData.PedalLineVisible);\r\n\r\n                View.setVisibility(this._$$incidencePoint, configData.IncidencePointVisible);\r\n\r\n                this._normalLine.setPointNameVisibility(this._option.nameVisible, configData.NormalLine.pointNameVisible);\r\n                this._normalLine.setLineVisibility(this._option.nameVisible, configData.NormalLine.lineVisible);\r\n            }\r\n            ,\r\n            gtIndexAppendToView: function ($$container) {\r\n                $$container.addShape(this._$$incidencePoint);\r\n                this.gtIndexSectorAppendToView($$container);\r\n                this.btns.appendToView($$container);\r\n            }\r\n            ,\r\n            bringBtnToTop: function () {\r\n                this.btns.getView().bringTop();\r\n            }\r\n            ,\r\n            resetAngle: function (surfaceAngle, init) {\r\n                var that = this;\r\n                var subAngle = typeof this._surfaceAngle == typeof undefined ? surfaceAngle : (surfaceAngle - this._surfaceAngle);\r\n                this._surfaceAngle = surfaceAngle;\r\n                var incidenceAngle = this._incidenceLine.getRotateAngle();\r\n                //反射线相对固定\r\n                if (init) {//第一次初始化，忽略固定角度，否则无法完成初始化工作\r\n                    incidenceAngle = incidenceAngle + subAngle;\r\n                } else if (this._configData.ReflectionLine.rotateFixed) {\r\n                    var reflectionAngle = this._reflectionLine.getRotateAngle();\r\n                    // 算出相对180的夹角+ 整体旋转角度+反射线的旋转角度\r\n                    incidenceAngle = 180 - reflectionAngle + 2 * surfaceAngle;\r\n                } else if (this._configData.IncidenceLine.rotateFixed) {\r\n                    incidenceAngle = this._incidenceLine.getRotateAngle();\r\n                } else {\r\n                    incidenceAngle = incidenceAngle + subAngle;\r\n                }\r\n                var incidenceAngleAbs = incidenceAngle - surfaceAngle;\r\n                var startAngle = surfaceAngle;\r\n                var halfAngle = 90 + surfaceAngle;\r\n                var holdAngle = 180 + surfaceAngle;\r\n\r\n                this._staticLines.forEach(function (line, i) {\r\n                    var config = that._configData.StaticLine[i];\r\n                    line.setRotate(holdAngle - config.defaultAngle);\r\n                });\r\n\r\n                //围绕线底部，中心轴旋转\r\n                if (!this._configData.ReflectionLine.rotateFixed || init) {\r\n                    this._reflectionLine.setRotate(holdAngle - (incidenceAngle - surfaceAngle));\r\n                } else {\r\n                    //为了初始化内部视图位置\r\n                    this._reflectionLine.setRotate(this._reflectionLine.getRotateAngle());\r\n                }\r\n                this._incidenceLine.setRotate(incidenceAngle);\r\n                this._normalLine.setRotate(halfAngle);\r\n                this._pedalLine.setRotate(halfAngle);\r\n\r\n                var angle = [];\r\n                var negative = false;\r\n                //超过角度\r\n                if (incidenceAngle > halfAngle) {\r\n                    angle = [startAngle, holdAngle - incidenceAngleAbs, halfAngle, incidenceAngle, holdAngle];\r\n                    negative = true;\r\n                } else {\r\n                    angle = [startAngle, incidenceAngle, halfAngle, holdAngle - incidenceAngleAbs, holdAngle];\r\n                }\r\n\r\n                //重置扇面角度相关\r\n                this.resetSectorAngle(this._normalLine.getRotateAngle(), negative, angle);\r\n\r\n                //设置动画内容\r\n                this._drawCommand.setDrawIndex(this.isPedal() ? this._configData.PedalDrawIndex : this._configData.DrawIndex);\r\n\r\n                this.setIncidence0180View();\r\n                this.resetLinePos();\r\n            }\r\n            ,\r\n            getMoveRotateAngle: function (data) {\r\n                var currentPos = data.currentPos;\r\n                var lastPos = data.lastPos;\r\n                var originalPos;\r\n                var offset = $(this._$$incidencePoint.node).offset();\r\n                originalPos = {\r\n                    x: offset.left,\r\n                    y: offset.top\r\n                };\r\n                return GraphMath.getRotateAngle(originalPos, lastPos, currentPos);\r\n            }\r\n            ,\r\n            onLightMove: function (lightType, data, eventType) {\r\n                if (eventType === 'beforemove') {\r\n                    //this._isPedal = this.isPedal();\r\n                } else if (eventType === 'aftermove') {\r\n                    //让角度自动吸附90°\r\n                    this.adsorptionPedal();\r\n                    this.adsorptionStatic();\r\n                } else if (eventType === 'move') {\r\n                    var angle = this.getMoveRotateAngle(data);\r\n                    //反射线角度是相反的\r\n                    if (lightType === LightLine.Type.ReflectionLine) {\r\n                        angle = -angle;\r\n                    }\r\n                    if (this.lineRotateAble(angle)) {\r\n                        if (this._configData.IncidenceLine.rotateFixed) {\r\n                            this._incidenceLine.rotate(angle);\r\n                        } else if (this._configData.ReflectionLine.rotateFixed) {\r\n                            this._reflectionLine.rotate(-angle);\r\n                        } else {\r\n                            this._incidenceLine.rotate(angle);\r\n                        }\r\n\r\n                        this.resetAngle(this._surfaceAngle);\r\n                        this._onLightMove(this.getUuid(), angle);\r\n                    }\r\n                }\r\n            },\r\n            //90°时自动吸附\r\n            adsorptionStatic: function () {\r\n                if (this._staticLines.length === 0) {\r\n                    return;\r\n                }\r\n\r\n                var config,\r\n                    that = this,\r\n                    autoAngle,\r\n                    subReflectionAngle,\r\n                    subIncidenceAngle;\r\n                var angle = Math.round(this.getSectorAngle(Sector.Type.SurfaceIn));\r\n                var incidenceAngle = that._incidenceLine.getRotateAngle();\r\n                var reflectionAngle = that._reflectionLine.getRotateAngle();\r\n\r\n                this._staticLines.forEach(function (line, i) {\r\n                    config = that._configData.StaticLine[i];\r\n                    if (config.autoAdsorption) {\r\n                        if (angle === config.defaultAngle) {\r\n                            autoAngle = line.getRotateAngle();\r\n                            subIncidenceAngle = Math.abs(incidenceAngle - autoAngle);\r\n                            subReflectionAngle = Math.abs(reflectionAngle - autoAngle);\r\n                            if (subIncidenceAngle < subReflectionAngle) {\r\n                                that._incidenceLine.setRotate(autoAngle);\r\n                                that._reflectionLine.setRotate(reflectionAngle + incidenceAngle - autoAngle);\r\n                            } else {\r\n                                that._reflectionLine.setRotate(autoAngle);\r\n                                that._incidenceLine.setRotate(incidenceAngle + reflectionAngle - autoAngle);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n            setIncidence0180View: function () {\r\n                var angle = Math.round(this.getSectorAngle(Sector.Type.Incidence));\r\n                if (angle === 0 || angle === 90) {\r\n                    this.setSectorVisibility(false);\r\n                    //90度时显示垂足符号\r\n                    if (this._configData.view90PedalLineVisible) {\r\n                        if (angle === 0) {\r\n                            this._pedalLine.setVisibility(true);\r\n                        } else {\r\n                            //法线和垂足符号是一起显示的\r\n                            this._pedalLine.setVisibility(this._normalLine.getLineVisible());\r\n                        }\r\n                    }\r\n                    if (!this._incidenceLine.isVisibilityHidden() && !this._reflectionLine.isVisibilityHidden() && !this._linePedalChangeLock) {\r\n                        this._incidenceLine.setWidth(this._configData.IncidenceLine.PedalWidth);\r\n                        this._incidenceLine.setArrowPos(this._configData.IncidenceLine.PedalArrowPos);\r\n                        this._reflectionLine.setWidth(this._configData.ReflectionLine.PedalWidth);\r\n                        this._reflectionLine.setArrowPos(this._configData.ReflectionLine.PedalArrowPos);\r\n                    }\r\n                } else {\r\n                    //和名称同步\r\n                    this.syncSectorVisibilityByName();\r\n                    if (this._configData.view90PedalLineVisible) {\r\n                        this._pedalLine.setVisibility(this._normalLine.getLineVisible());\r\n                    }\r\n                    if (!this._incidenceLine.isVisibilityHidden() && !this._reflectionLine.isVisibilityHidden() && !this._linePedalChangeLock) {\r\n                        this._incidenceLine.setWidth(this._configData.IncidenceLine.width);\r\n                        this._incidenceLine.setArrowPos(this._configData.IncidenceLine.arrowPos);\r\n                        this._reflectionLine.setWidth(this._configData.ReflectionLine.width);\r\n                        this._reflectionLine.setArrowPos(this._configData.ReflectionLine.arrowPos);\r\n                    }\r\n                }\r\n            },\r\n            setIncidencePos: function (x, y) {\r\n                //定位到入射点\r\n                this._configData.IncidencePosX = x;\r\n                this.setTranslate(this._configData.IncidencePosX, 0);\r\n                this._$$incidencePoint.setTranslate(this._configData.IncidencePosX, 0);\r\n                this.getNameGroup().setTranslate(this._configData.IncidencePosX, 0);\r\n            },\r\n            getIncidencePosX: function () {\r\n                return this._configData.IncidencePosX;\r\n            },\r\n            //内部线条是否可移动\r\n            lineRotateAble: function (angle) {\r\n                if (this._incidenceLine.getRotateAngle() > this._normalLine.getRotateAngle()) {\r\n                    angle = -angle;\r\n                }\r\n                var surfaceInSectorAngle = this.getSectorAngle(Sector.Type.SurfaceIn);\r\n                if (surfaceInSectorAngle + angle < MinAngle) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            },\r\n            //整个光组件是否可移动\r\n            complexRotateAble: function (angle) {\r\n                if (!this._configData.IncidenceLine.rotateFixed && !this._configData.ReflectionLine.rotateFixed) {\r\n                    return true;\r\n                }\r\n                //根据相对固定的光线来进行判断\r\n                if (this._incidenceLine.getRotateAngle() > this._normalLine.getRotateAngle()) {\r\n                    if (this._configData.IncidenceLine.rotateFixed) {\r\n                        angle = angle;\r\n                    } else if (this._configData.ReflectionLine.rotateFixed) {\r\n                        angle = -angle;\r\n                    }\r\n                } else {\r\n                    if (this._configData.IncidenceLine.rotateFixed) {\r\n                        angle = -angle;\r\n                    } else if (this._configData.ReflectionLine.rotateFixed) {\r\n                        angle = angle;\r\n                    }\r\n                }\r\n                var surfaceInSectorAngle = this.getSectorAngle(Sector.Type.SurfaceIn);\r\n                if (surfaceInSectorAngle + angle < MinAngle) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            },\r\n            /**\r\n             * 旋转到指定角度和位置\r\n             * @param surfaceAngle\r\n             * @param surfaceRotateX 旋转点\r\n             * @param marginX 便宜量\r\n             */\r\n            around: function (surfaceAngle, surfaceRotateX, marginX) {\r\n                marginX = marginX || 0;\r\n                //这边可通过画图来求解坐标关系，最终求的是离圆心的坐标位置\r\n\r\n                //计算围绕旋转的半径\r\n                var r = Math.abs(surfaceRotateX - this._configData.IncidencePosX);\r\n\r\n                //求出该圆点所在坐标\r\n                var pos = GraphMath.getSpherePos(surfaceAngle || 0, r);\r\n                //计算离坐标原点的距离\r\n                var x, y;\r\n                if (surfaceRotateX > this._configData.IncidencePosX) {\r\n                    //点在旋转中小左侧\r\n                    x = surfaceRotateX + (-pos.x);//因为角度变成了负数，计算的时目标位置与x轴对称的值\r\n                    y = pos.y;\r\n                } else {\r\n                    //点在旋转中小右侧\r\n                    x = pos.x + surfaceRotateX;\r\n                    y = -pos.y;\r\n                }\r\n\r\n                //设置偏移量，svgtranslate,y坐标和坐标系相反\r\n                this.setTranslate(x + marginX, -y);\r\n                this._$$incidencePoint.setTranslate(x + marginX, -y);\r\n                this.getNameGroup().setTranslate(x + marginX, -y);\r\n\r\n                //更新旋转图标位置\r\n                this._incidenceLine.fwBtnMove();\r\n                this._reflectionLine.fwBtnMove();\r\n                // this.getNameGroup().updatePos()\r\n            },\r\n            updatePos: function () {\r\n                this._incidenceLine.fwBtnMove();\r\n                this._reflectionLine.fwBtnMove();\r\n                this.getNameGroup().updatePos()\r\n            },\r\n            getData: function () {\r\n                var that = this;\r\n                var defaultAngle = that.getSectorAngle(Sector.Type.SurfaceIn);\r\n                if (this._normalLine.getRotateAngle() < this._incidenceLine.getRotateAngle()) {\r\n                    defaultAngle = 180 - defaultAngle;\r\n                }\r\n                var data = {\r\n                    IncidenceLine: {\r\n                        defaultAngle: defaultAngle,//默认角度\r\n                        visible: !that._incidenceLine.isVisibilityHidden(),//是否显示\r\n                        rotateFixed: that._configData.IncidenceLine.rotateFixed,\r\n                        nameEnable: that._incidenceLine.getNameEnable()\r\n                    },\r\n                    ReflectionLine: {\r\n                        visible: !that._reflectionLine.isVisibilityHidden(),\r\n                        rotateFixed: that._configData.ReflectionLine.rotateFixed,\r\n                        nameEnable: that._reflectionLine.getNameEnable()\r\n                    },\r\n                    NormalLine: {\r\n                        pointNameVisible: that._normalLine.getPointNameVisible(),\r\n                        lineVisible: that._normalLine.getLineVisible()\r\n                    },\r\n                    Sector: {\r\n                        sectorInVisible: that.getSectorOutSideVisibilityByType(Sector.Type.SurfaceIn),\r\n                        sectorOutVisible: that.getSectorOutSideVisibilityByType(Sector.Type.SurfaceOut),\r\n                        incidenceVisible: that.getSectorOutSideVisibilityByType(Sector.Type.Incidence),\r\n                        reflectionVisible: that.getSectorOutSideVisibilityByType(Sector.Type.Reflection),\r\n                        hasDraw: that.getSectorHasDraw()\r\n                    },\r\n                    Draw: {\r\n                        //hasNext: that.hasNextWidthOutVisibilityStatus(),\r\n                        incidencePoint: that.getHasDrawIncidencePoint()\r\n                        //sectorAnimateDisappear: that.getHasDrawSectorAnimateDisappear()\r\n                    },\r\n                    PedalLineVisible: !that._pedalLine.isVisibilityHidden(),\r\n                    IncidencePosX: that._configData.IncidencePosX,//入射点位置\r\n                    Visible: !that.isVisibilityHidden()\r\n                };\r\n                return data;\r\n            }\r\n            ,\r\n            //90°时自动吸附\r\n            adsorptionPedal: function () {\r\n                if (this.isPedal()) {\r\n                    var normalLineAngle = this._normalLine.getRotateAngle();\r\n                    //垂足\r\n                    this._incidenceLine.setRotate(normalLineAngle);\r\n                    this._reflectionLine.setRotate(normalLineAngle);\r\n                    this.resetAngle(normalLineAngle - 90);\r\n                }\r\n            }\r\n            ,\r\n            //是否垂足\r\n            isPedal: function () {\r\n                //var normalLineAngle = this._normalLine.getRotateAngle();\r\n                //var incidenceAngle = this._incidenceLine.getRotateAngle();\r\n                return Math.round(this.getSectorAngle(Sector.Type.Incidence)) === 0;\r\n                //return Math.round(normalLineAngle) === Math.round(incidenceAngle);\r\n            }\r\n            ,\r\n            initDomEvent: function () {\r\n                this.bindDomEvent(this.getView().node, ['lrTap'], this.getUuid(), this.domEventHandler);\r\n            }\r\n            ,\r\n            setViewTapListener: function (callback) {\r\n                this._onViewClickListener = callback;\r\n            }\r\n            ,\r\n            domEventHandler: function (uuid) {\r\n                this._onViewClickListener && this._onViewClickListener(uuid);\r\n            }\r\n            ,\r\n            changeTransparent: function (show) {\r\n                return;\r\n                var opacity = show ? 1 : 0.4;\r\n                this._normalLine.setOpacity(opacity);\r\n                this._pedalLine.setOpacity(opacity);\r\n                this.setSectorOpacity(opacity);\r\n\r\n                if (show) {\r\n                    var $$item = $(this.getView().node).closest('._lr_item');\r\n                    var $surface = $$item.children('._lr_surface');\r\n                    $surface.last().after(this.getNameGroup().getView().node);\r\n                    //添加到反射面最近的一层\r\n                    $surface.first().before(this.getView().node);\r\n                    //名称放到最后\r\n                    $$item.children().last().after(this.getNameGroup().getView().node);\r\n                } else {\r\n                    var $first = $(this.getView().node).closest('._lr_item').children().first();\r\n                    $first.before(this.getNameGroup().getView().node);\r\n                }\r\n            }\r\n            ,\r\n            setVisibility: function (visible) {\r\n                View.setVisibility(this.getView(), visible);\r\n                this.getNameGroup().setVisibility(visible);\r\n            }\r\n            ,\r\n            //锁定移动垂直时，长度状态变化\r\n            setLinePedalChangeLock: function (lock) {\r\n                this._linePedalChangeLock = lock;\r\n            }\r\n            ,\r\n            getTwoLineVisible: function () {\r\n                return !this._incidenceLine.isVisibilityHidden() && !this._reflectionLine.isVisibilityHidden();\r\n            }\r\n        })\r\n        ;\r\n\r\n    //include part api\r\n    var draw = require('js/reflector/lightComplex/draw');\r\n    var event = require('js/reflector/lightComplex/event');\r\n    var proxyApi = require('js/reflector/lightComplex/proxyApi');\r\n    var sector = require('js/reflector/lightComplex/sector');\r\n    var namePos = require('js/reflector/lightComplex/namePos');\r\n    LightComplex.__include(draw);\r\n    LightComplex.__include(event);\r\n    LightComplex.__include(proxyApi);\r\n    LightComplex.__include(sector);\r\n    LightComplex.__include(namePos);\r\n\r\n    return LightComplex;\r\n\r\n});\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/reflector/lightComplex/namePos', ['js/view/sector', 'js/utils/utils', 'js/utils/view', 'js/utils/graphmath', 'js/utils/svg', 'js/view/lightLine'], function (Sector, Utils, View, GraphMath, Svg, LightLine) {\r\n\r\n\r\n    var NamePos = {\r\n        _lastMinLine: null,\r\n        resetLinePos: function () {\r\n            this.initLineNamePos(this._incidenceLine);\r\n            this.initLineNamePos(this._reflectionLine);\r\n        },\r\n        initLineNamePos: function (line) {\r\n            //保留5位小数点，防止垂直时角度旋转过程中造成一点误差。使得反射角和法线角度不一致\r\n            var normalAngle = parseFloat(this._normalLine.getRotateAngle().toFixed(5));\r\n            var lineAngle = parseFloat(line.getRotateAngle().toFixed(5));\r\n            var width = line.getWidth();\r\n            var sectorAngle = this.getSectorAngle(Sector.Type.Incidence);\r\n            var normalAbsAngle = Math.abs((normalAngle % 180));\r\n            var linePercent =0;\r\n            //这个地方先写死，适配220~410\r\n            if (width <= 290) {\r\n                linePercent = (290 - width) / 50;\r\n            } else {\r\n                linePercent = (290 - width) / 85;\r\n            }\r\n\r\n            var anglePercent = 1;\r\n            if (normalAbsAngle > 90) {\r\n                anglePercent = 1 - (normalAbsAngle - 90) / 90;\r\n            } else {\r\n                anglePercent = normalAbsAngle / 90;\r\n            }\r\n\r\n            //超过8°开始不进行移动\r\n            var subAngle = 15 + 7 * anglePercent + linePercent * 4;\r\n            if (sectorAngle <= subAngle) {\r\n                if (lineAngle > normalAngle) {\r\n                    lineAngle = normalAngle + subAngle;\r\n                } else if (normalAngle === lineAngle) {\r\n                    //this._lastMinLine ===\r\n                    if (line.getLightType() == LightLine.Type.IncidenceLine) {\r\n                        lineAngle = normalAngle - subAngle;\r\n                    } else {\r\n                        lineAngle = normalAngle + subAngle;\r\n                    }\r\n                }\r\n                else {\r\n                    //this._lastMinLine = line.getLightType();\r\n                    lineAngle = normalAngle - subAngle;\r\n                }\r\n            }\r\n            if (lineAngle) {\r\n                line.makeNameViewAround(lineAngle);\r\n            }\r\n            //console.log('namePos', normalAbsAngle, subAngle);\r\n        }\r\n    };\r\n\r\n    return NamePos;\r\n});\r\n\n/**\r\n * Created by ylf on 2016/8/22.\r\n */\r\ndefine('js/reflector/lightComplex/proxyApi', ['js/view/sector', 'js/utils/utils', 'js/utils/view', 'js/view/LightLine'], function (Sector, Utils, View, LightLine) {\r\n\r\n    //将选择角度装换为0~360度\r\n    var get0T360Angle = function (angle) {\r\n        angle = angle % 360;\r\n        if (angle < 0) {\r\n            return 360 + angle;\r\n        }\r\n        return angle;\r\n    };\r\n\r\n    /**\r\n     * 获取线针对圆的旋转角度，圆从右侧开始为0°\r\n     * @param lineRotateAngle\r\n     * @returns {number}\r\n     */\r\n    var getSphereAngle = function (lineRotateAngle) {\r\n        var sphereAngle = (180 - lineRotateAngle % 360) % 360;\r\n        if (sphereAngle < 0) {\r\n            sphereAngle = 360 + sphereAngle;\r\n        }\r\n        return sphereAngle;\r\n    };\r\n\r\n\r\n    var LightComplexProxyApi = {\r\n        setIncidenceXAxisAngle: function (angle) {\r\n            this._incidenceLine.setRotate(angle);\r\n        },\r\n        getIncidenceRotateAngle: function () {\r\n            return this._incidenceLine.getRotateAngle();\r\n        },\r\n        getReflectionRotateAngle: function () {\r\n            return this._reflectionLine.getRotateAngle();\r\n        },\r\n        setIncidenceLineWidth: function (width) {\r\n            this._incidenceLine.setWidth(width);\r\n        },\r\n        setReflectionLineWidth: function (width) {\r\n            this._reflectionLine.setWidth(width);\r\n        },\r\n        setIncidenceLineArrowPos: function (arrowPos) {\r\n            this._incidenceLine.setArrowPos(arrowPos);\r\n        },\r\n        setReflectionLineArrowPos: function (arrowPos) {\r\n            this._reflectionLine.setArrowPos(arrowPos);\r\n        },\r\n        setIncidenceLineCommonFill: function (common) {\r\n            if (common) {\r\n                this._incidenceLine.setCommonFill();\r\n            } else {\r\n                this._incidenceLine.restoreFill();\r\n            }\r\n        },\r\n        setReflectionLineCommonFill: function (common) {\r\n            if (common) {\r\n                this._reflectionLine.setCommonFill();\r\n            } else {\r\n                this._reflectionLine.restoreFill();\r\n            }\r\n        },\r\n        setIncidenceLineVisible: function (visible) {\r\n            this._incidenceLine.setVisibility(visible);\r\n        },\r\n        setReflectionLineVisible: function (visible) {\r\n            this._reflectionLine.setVisibility(visible);\r\n        },\r\n        getIncidenceLineVisible: function () {\r\n            return !this._incidenceLine.isVisibilityHidden();\r\n        },\r\n        getReflectionLineVisible: function () {\r\n            return !this._reflectionLine.isVisibilityHidden();\r\n        },\r\n        getIncidenceSurfaceAngle: function () {\r\n            return this.getSectorAngle(Sector.Type.Incidence);\r\n        },\r\n        setIncidenceNameEnable: function (nameEnable) {\r\n            this._incidenceLine.setNameEnable(nameEnable);\r\n        },\r\n        setIncidenceNameVisible: function (visible) {\r\n            this._incidenceLine.setNameVisible(visible);\r\n            //更新名称位置\r\n            this.resetLinePos();\r\n        },\r\n\r\n        getNormalLineRotateAngle: function () {\r\n            return this._normalLine.getRotateAngle();\r\n        },\r\n        //获取与X轴的斜率夹角\r\n        getIncidenceLineXAngle: function () {\r\n            return (360 - this._incidenceLine.getRotateAngle() % 360) % 180;\r\n        },\r\n        //获取与X轴的斜率夹角\r\n        getReflectionLineXAngle: function () {\r\n            return (360 - this._reflectionLine.getRotateAngle() % 360) % 180;\r\n        },\r\n        getNormalLineXAngle: function () {\r\n            return (360 - this._normalLine.getRotateAngle() % 360) % 180;\r\n        },\r\n        getSectorInLineXAngle: function () {\r\n            var rotate = 0;\r\n            var lineRotate = this._incidenceLine.getRotateAngle();\r\n            var normalRotate = this._normalLine.getRotateAngle();\r\n            if (lineRotate > normalRotate) {\r\n                rotate = lineRotate + this.getSectorAngle(Sector.Type.SurfaceIn);\r\n            } else {\r\n                rotate = lineRotate - this.getSectorAngle(Sector.Type.SurfaceIn);\r\n            }\r\n            return (360 - rotate % 360) % 180;\r\n        },\r\n        getSectorOutLineXAngle: function () {\r\n            var rotate = 0;\r\n            var lineRotate = this._reflectionLine.getRotateAngle();\r\n            var normalRotate = this._normalLine.getRotateAngle();\r\n            if (lineRotate > normalRotate) {\r\n                rotate = lineRotate + this.getSectorAngle(Sector.Type.SurfaceOut);\r\n            } else {\r\n                rotate = lineRotate - this.getSectorAngle(Sector.Type.SurfaceOut);\r\n            }\r\n            return (360 - rotate % 360) % 180;\r\n        },\r\n        //获取相对圆的角度\r\n        getIncidenceLineSphereAngle: function () {\r\n            return getSphereAngle(this._incidenceLine.getRotateAngle());\r\n        },\r\n        //获取与X轴的斜率夹角\r\n        getReflectionLineSphereAngle: function () {\r\n            return getSphereAngle(this._reflectionLine.getRotateAngle());\r\n        },\r\n        getNormalLineSphereAngle: function () {\r\n            return getSphereAngle(this._normalLine.getRotateAngle());\r\n        },\r\n        getLineXAngle: function (lineType) {\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                return this.getIncidenceLineXAngle();\r\n            } else if (lineType === LightLine.Type.ReflectionLine) {\r\n                return this.getReflectionLineXAngle();\r\n            }\r\n        },\r\n        getLine0To360RotateAngle: function (lineType) {\r\n            var line;\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                line = this._incidenceLine;\r\n            } else if (lineType === LightLine.Type.ReflectionLine) {\r\n                line = this._reflectionLine;\r\n            }\r\n            return get0T360Angle(line.getRotateAngle());\r\n        },\r\n        //获取线旋转的象限位置\r\n        getLineQuad: function (lineType) {\r\n            var line, angle;\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                line = this._incidenceLine;\r\n            } else if (lineType === LightLine.Type.ReflectionLine) {\r\n                line = this._reflectionLine;\r\n            } else if (lineType === LightLine.Type.NormalLine) {\r\n                line = this._normalLine;\r\n            } else if (lineType === LightLine.Type.SurfaceIn) {\r\n                var normalRotate = this.getNormalLineRotateAngle();\r\n                var incidenceRotate = this.getIncidenceRotateAngle();\r\n                if (incidenceRotate < normalRotate) {\r\n                    angle = get0T360Angle(incidenceRotate) - this.getSectorAngle(Sector.Type.SurfaceIn);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                } else {\r\n                    angle = get0T360Angle(incidenceRotate) + this.getSectorAngle(Sector.Type.SurfaceIn);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                }\r\n            } else if (lineType === LightLine.Type.SurfaceOut) {\r\n                var normalRotate = this.getNormalLineRotateAngle();\r\n                var reflectionRotate = this.getReflectionRotateAngle();\r\n                if (reflectionRotate < normalRotate) {\r\n                    angle = get0T360Angle(reflectionRotate) - this.getSectorAngle(Sector.Type.SurfaceOut);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                } else {\r\n                    angle = get0T360Angle(reflectionRotate) + this.getSectorAngle(Sector.Type.SurfaceOut);\r\n                    if (angle < 0) {\r\n                        angle = 360 + angle;\r\n                    }\r\n                }\r\n            }\r\n            //线的旋转角度都是从左侧0度开始旋转，和象限值不服，需要装换\r\n            if (line) {\r\n                angle = get0T360Angle(line.getRotateAngle());\r\n            }\r\n\r\n            if (angle >= 0 && angle <= 90) {\r\n                return 2;\r\n            } else if (angle >= 90 && angle <= 180) {\r\n                return 1;\r\n            } else if (angle >= 180 && angle <= 270) {\r\n                return 4\r\n            } else if (angle >= 270 && angle <= 360) {\r\n                return 3;\r\n            }\r\n            return 0;\r\n        },\r\n        setLineVisibility: function (lineType, visible) {\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                this._incidenceLine.setVisibility(visible);\r\n            } else if (lineType === LightLine.Type.ReflectionLine) {\r\n                this._reflectionLine.setVisibility(visible);\r\n            }\r\n        },\r\n        setLineEnable: function (lineType, enable) {\r\n            if (lineType === LightLine.Type.IncidenceLine) {\r\n                this._incidenceLine.setLineEnable(enable);\r\n            } else if (lineType === LightLine.Type.ReflectionLine) {\r\n                this._reflectionLine.setLineEnable(enable);\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    return LightComplexProxyApi;\r\n});\n/**\r\n * Created by ylf on 2016/8/24.\r\n */\r\ndefine('js/reflector/lightComplex/sector', ['js/view/sector', 'js/utils/utils', 'js/utils/view', 'js/view/NameGroup', 'js/view/LightLine'], function (Sector, Utils, View, NameGroup, LightLine) {\r\n\r\n    var GraphMath = require('js/utils/graphMath');\r\n\r\n    var LightComplexSector = {\r\n        _sector: null,\r\n        _sectorEnable: true,\r\n        _currentVisibleStatus: null,\r\n        _sectorHasDraw: null,\r\n        createSector: function (appendPosX) {\r\n            var configData = this._configData;\r\n            this._sector = {};\r\n            this._currentVisibleStatus = {};\r\n            //夹角扇面\r\n            this._sector[Sector.Type.Incidence] = this._incidenceSector = Sector.create(Sector.Type.Incidence, appendPosX, 0, configData.Sector.incidenceR, this._option.langData);\r\n            this._sector[Sector.Type.Reflection] = this._reflectionSector = Sector.create(Sector.Type.Reflection, appendPosX, 0, configData.Sector.reflectionR, this._option.langData);\r\n            this._sector[Sector.Type.SurfaceIn] = this._surfaceInSector = Sector.create(Sector.Type.SurfaceIn, appendPosX, 0, configData.Sector.surfaceR, this._option.langData);\r\n            this._sector[Sector.Type.SurfaceOut] = this._surfaceOutSector = Sector.create(Sector.Type.SurfaceOut, appendPosX, 0, configData.Sector.surfaceR, this._option.langData);\r\n\r\n\r\n            var sectorNameData = {};\r\n            sectorNameData[Sector.Type.Incidence] = {cx: appendPosX, cy: 0, r: configData.Sector.reflectionR, letterR: configData.Sector.letterR, angleR: configData.Sector.angleR};\r\n            sectorNameData[Sector.Type.Reflection] = {cx: appendPosX, cy: 0, r: configData.Sector.reflectionR, letterR: configData.Sector.letterR, angleR: configData.Sector.angleR};\r\n            sectorNameData[Sector.Type.SurfaceIn] = {cx: appendPosX, cy: 0, r: configData.Sector.surfaceR, angleR: configData.Sector.surfaceR};\r\n            sectorNameData[Sector.Type.SurfaceOut] = {cx: appendPosX, cy: 0, r: configData.Sector.surfaceR, angleR: configData.Sector.surfaceR};\r\n            this._nameGroup = NameGroup.create(sectorNameData, this._option.langData, this._option, this._reflectorType, this._configData.NameAutoPos);\r\n            this._nameGroup.setTranslate(this._configData.IncidencePosX, 0);\r\n        },\r\n        sectorEach: function (callback) {\r\n            for (var key in this._sector) {\r\n                callback.apply(this._sector[key], [key]);\r\n            }\r\n        },\r\n        appendSector: function () {\r\n            var that = this;\r\n            this.sectorEach(function (type) {\r\n                that.addShape(this.getView());\r\n            })\r\n        },\r\n        gtIndexSectorAppendToView: function ($$container) {\r\n            $$container.addShape(this._nameGroup.getView());\r\n        },\r\n        setAngleVisibleByType: function (type, visible) {\r\n            this._currentVisibleStatus[type] = visible;\r\n\r\n            //不可用则不能更改状态\r\n            if (!this._sectorEnable) {\r\n                if (visible === true) {\r\n                    this._nameGroup.setHasDrawStatusByType(type, visible);\r\n                }\r\n                return;\r\n            }\r\n            this._nameGroup.setAngleVisibleByType(type, visible);\r\n        },\r\n        resetSectorAngle: function (normalAngle, negative, angle) {\r\n            var __getIndex = function (index, nagative, sub) {\r\n                return nagative ? sub - index : index;\r\n            };\r\n            this._surfaceInSector.rotate(angle[__getIndex(0, negative, 3)], angle[__getIndex(1, negative, 5)]);\r\n            this._incidenceSector.rotate(angle[__getIndex(1, negative, 3)], angle[__getIndex(2, negative, 5)]);\r\n            this._reflectionSector.rotate(angle[__getIndex(2, negative, 3)], angle[__getIndex(3, negative, 5)]);\r\n            this._surfaceOutSector.rotate(angle[__getIndex(3, negative, 3)], angle[__getIndex(4, negative, 5)]);\r\n            this._nameGroup.setNormalAngle(normalAngle);\r\n            this._nameGroup.rotate(angle, negative);\r\n        },\r\n        initSectorVisibleState: function () {\r\n            var configData = this._configData;\r\n            this.setAngleVisibleByType(Sector.Type.SurfaceIn, configData.Sector.sectorInVisible);\r\n            this.setAngleVisibleByType(Sector.Type.SurfaceOut, configData.Sector.sectorOutVisible);\r\n            this.setAngleVisibleByType(Sector.Type.Incidence, configData.Sector.incidenceVisible);\r\n            this.setAngleVisibleByType(Sector.Type.Reflection, configData.Sector.reflectionVisible);\r\n\r\n            if (this._configData.Sector.hasDraw) {\r\n                this._nameGroup.setHasDrawStatus(this._configData.Sector.hasDraw)\r\n            }\r\n            this.syncSectorVisibilityByName();\r\n        },\r\n        getSectorHasDraw: function (type) {\r\n            if (typeof type !== typeof  undefined) {\r\n                return this._nameGroup.getHasDrawStatusByType(type);\r\n            }\r\n            return this._nameGroup.getHasDrawStatus();\r\n        },\r\n        //设置是否由程序内部逻辑导致的绘制\r\n        setSectorInsideDrawStatus: function (status, type) {\r\n            this._nameGroup.setHasDrawStatusByType(status, type);\r\n        },\r\n        setSectorVisibilityByType: function (type, visible) {\r\n            this.setAngleVisibleByType(type, visible);\r\n            this._sector[type].setVisibility(this._nameGroup.getAngleIsValidByType(type));\r\n        },\r\n        //被外部接口改变显示，这个时候不记录状态\r\n        setSectorVisibilityByOutSideLogic: function (type, visible) {\r\n            if (this._nameGroup.getHasDrawStatusByType(type)) {\r\n                this.setAngleVisibleByType(type, visible);\r\n            }\r\n            this._sector[type].setVisibility(this._nameGroup.getAngleIsValidByType(type));\r\n        },\r\n        //直接隐藏扇面，不记录状态\r\n        setSectorVisibility: function (visible) {\r\n            this.sectorEach(function () {\r\n                this.setVisibility(visible);\r\n            })\r\n        },\r\n        syncSectorVisibilityByName: function () {\r\n            var that = this;\r\n            this.sectorEach(function (type) {\r\n                this.setVisibility(that._nameGroup.getAngleIsValidByType(type))\r\n            });\r\n        },\r\n        sectorAnimateDisappear: function (callback) {\r\n            var that = this;\r\n            that.setAngleVisibleByType(Sector.Type.Incidence, true);\r\n            that.setAngleVisibleByType(Sector.Type.Reflection, true);\r\n            that.syncSectorVisibilityByName();\r\n            that.setAngleVisibleByType(Sector.Type.Incidence, false);\r\n            that.setAngleVisibleByType(Sector.Type.Reflection, false);\r\n            that.setSectorInsideDrawStatus(true, Sector.Type.Incidence);\r\n            that.setSectorInsideDrawStatus(true, Sector.Type.Reflection);\r\n            $(that._reflectionSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300, function () {\r\n                that.syncSectorVisibilityByName();\r\n                $(that._reflectionSector.getView().node).css('display', '');\r\n                callback && callback();\r\n            });\r\n            $(that._incidenceSector.getView().node).fadeIn(300).fadeOut(300).fadeIn(300, function () {\r\n                that.syncSectorVisibilityByName();\r\n                $(that._incidenceSector.getView().node).css('display', '');\r\n                callback && callback();\r\n            });\r\n        },\r\n        getSectorOutSideVisibilityByType: function (type) {\r\n            return this._nameGroup.getAngleVisibilityByType(type);\r\n        },\r\n        getNameGroup: function () {\r\n            return this._nameGroup;\r\n        },\r\n        getSectorAngle: function (type) {\r\n            return this._nameGroup.getAngle(type);\r\n        },\r\n        //获取扇面线段坐标\r\n        getSectorLinesPos: function (sectorType, centerPos) {\r\n            var that = this;\r\n            var startXAngle, endXAngle;\r\n            var startLineType, endLineType;\r\n            if (sectorType == Sector.Type.Incidence) {\r\n                startXAngle = this.getIncidenceLineXAngle();\r\n                endXAngle = this.getNormalLineXAngle();\r\n                startLineType = LightLine.Type.IncidenceLine;\r\n                endLineType = LightLine.Type.NormalLine;\r\n            } else if (sectorType == Sector.Type.Reflection) {\r\n                startXAngle = this.getNormalLineXAngle();\r\n                endXAngle = this.getReflectionLineXAngle();\r\n                startLineType = LightLine.Type.NormalLine;\r\n                endLineType = LightLine.Type.ReflectionLine;\r\n            } else if (sectorType == Sector.Type.SurfaceIn) {\r\n                startXAngle = this.getIncidenceLineXAngle();\r\n                endXAngle = this.getSectorInLineXAngle();\r\n                startLineType = LightLine.Type.IncidenceLine;\r\n                endLineType = LightLine.Type.SurfaceIn;\r\n            } else if (sectorType == Sector.Type.SurfaceOut) {\r\n                startXAngle = this.getReflectionLineXAngle();\r\n                endXAngle = this.getSectorOutLineXAngle();\r\n                startLineType = LightLine.Type.ReflectionLine;\r\n                endLineType = LightLine.Type.SurfaceOut;\r\n            }\r\n\r\n\r\n            var _getPos = function (xAngle, lineType) {\r\n                //统一装换为锐角\r\n                if (xAngle > 90) {\r\n                    xAngle = 180 - xAngle;\r\n                }\r\n                var quad = that.getLineQuad(lineType);\r\n\r\n                var sectorR = that._configData.Sector.surfaceR;\r\n                if (sectorType == Sector.Type.Incidence) {\r\n                    sectorR = that._configData.Sector.incidenceR;\r\n                } else if (sectorType == Sector.Type.Reflection) {\r\n                    sectorR = that._configData.Sector.reflectionR;\r\n                }\r\n\r\n                var pos = {\r\n                    y: Math.sin(GraphMath.getRadian(xAngle)) * sectorR,\r\n                    x: Math.cos(GraphMath.getRadian(xAngle)) * sectorR\r\n                };\r\n\r\n                var posB = {};\r\n                if (quad === 1) {\r\n                    posB.x = centerPos.x + pos.x;\r\n                    posB.y = centerPos.y + pos.y;\r\n                } else if (quad === 2) {\r\n                    posB.x = centerPos.x - pos.x;\r\n                    posB.y = centerPos.y + pos.y;\r\n                } else if (quad === 3) {\r\n                    posB.x = centerPos.x - pos.x;\r\n                    posB.y = centerPos.y - pos.y;\r\n                } else {\r\n                    posB.x = centerPos.x + pos.x;\r\n                    posB.y = centerPos.y - pos.y;\r\n                }\r\n                return {\r\n                    a: centerPos,\r\n                    b: posB\r\n                }\r\n            };\r\n\r\n            var line = [_getPos(startXAngle, startLineType), _getPos(endXAngle, endLineType)];\r\n            return line;\r\n        },\r\n        setSectorEnable: function (enable) {\r\n            var that = this;\r\n            this._sectorEnable = enable;\r\n            if (enable) {\r\n                //还原显示\r\n                this.sectorEach(function (type) {\r\n                    that._nameGroup.setAngleVisibleByType(type, that._currentVisibleStatus[type]);\r\n                });\r\n                //进行同步\r\n                this.syncSectorVisibilityByName();\r\n            } else {\r\n                this.sectorEach(function (type) {\r\n                    this.setVisibility(false);\r\n                    that._nameGroup.setAngleVisibleByType(type, false);\r\n                })\r\n            }\r\n        },\r\n        getSectorEnable: function () {\r\n            return this._sectorEnable;\r\n        },\r\n        setSectorOpacity: function (opacity) {\r\n            this.getNameGroup().setOpacity(opacity);\r\n            this.sectorEach(function () {\r\n                this.setOpacity(opacity);\r\n            });\r\n        }\r\n    };\r\n\r\n    return LightComplexSector;\r\n});\ndefine('js/main', ['js/reflector/reflectorMain', 'js/utils/logger'], function (ReflectorMain, Logger) {\r\n\r\n    window.LightReflector = {\r\n        create: function (option) {\r\n            return ReflectorMain.create(option);\r\n        },\r\n        setLogLevel: function (level) {\r\n            Logger.setLevel(level);\r\n        }\r\n    }\r\n\r\n\r\n});\r\n//主入口初始化\r\nrequire('js/main');\r\n})(window,document,jQuery)"],"sourceRoot":"/source/"}