var DigitalInput;!function(t){var e=function(){function t(){this.element=document.createElement("span"),this.element.innerHTML="&#8203",this.isShow=!0,this.isStart=!1,this.showCursorStyle()}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.setCursor=function(t,e){e?e.parentElement.insertBefore(this.element,e):t.appendChild(this.element),this.isStart||this.starCursor()},t.prototype.starCursor=function(){var t=this;this.isStart=!0,this.interval=setInterval(function(){t.isShow?t.dismissCursorStyle():t.showCursorStyle(),t.isShow=!t.isShow},500)},t.prototype.clearCursor=function(){clearInterval(this.interval),this.isStart=!1,this.element&&this.element.parentElement&&this.element.parentElement.removeChild(this.element)},t.prototype.showCursorStyle=function(){this.element.setAttribute("class","has_cursor not_select")},t.prototype.dismissCursorStyle=function(){this.element.setAttribute("class","no_cursor not_select")},t}();t.Cursor=e;var n=function(){function e(t,e,n,i){void 0===n&&(n="editable_span editable_has_after"),void 0===i&&(i="editable_span_done editable_no_after"),this.isClickInner=!1,this.isEditable=!1,this.element=document.createElement("span"),this.className=n,this.classNameDone=i,this.changeStyle(!0),this.textList=[],this.cursorIndex=-1,this.editor=t,this.charView=e,this.setOnClick()}return e.prototype.setOnClick=function(){var e=this;DigitalKey.EventUtil.bindClickEvent(this.element,function(n){if(!e.editor.disabled){if(DigitalKey.LogUtils.log("editableSpan"),t.InputManager.getInstance().openKeyBoard(e.editor.element.getAttribute("digital_id")),!e.isClickInner){var i=t.ViewUtils.getOffsetLeft(e.element),r=e.element.offsetWidth;n.clientX+document.body.scrollLeft<i+r/2?e.setCursor(0):e.setCursor(e.textList.length)}e.isClickInner=!1,e.charView.setCurrentEditableArea(e),e.charView.changeStyle(!0),e.editor.isEditInChild=!0,e.editor.cursorIndex=e.editor.textList.indexOf(e.charView),t.ViewUtils.stopEvent(n)}})},e.prototype.setCursor=function(e){return void 0===e&&(e=this.cursorIndex),!!this.disabled||(this.cursorIndex!=e||this.element!=t.Cursor.getInstance().element.parentElement?(0==this.textList.length||e>=this.textList.length||e<0?(t.Cursor.getInstance().setCursor(this.element),this.cursorIndex=this.textList.length,this.editor.onCursorCallBack&&this.editor.onCursorCallBack(!1)):(t.Cursor.getInstance().setCursor(this.element,this.textList[e].element),this.cursorIndex=e,this.editor.onCursorCallBack&&this.editor.onCursorCallBack(!1)),this.editor.adjustView(43),!1):void 0)},e.prototype.foward=function(t){void 0===t&&(t=1);var e=this.cursorIndex+t;e>this.textList.length&&(e=this.textList.length),this.setCursor(e)},e.prototype.back=function(t){void 0===t&&(t=1);var e=this.cursorIndex-t;e<0&&(e=0),this.setCursor(e)},e.prototype.addText=function(e,n){var i=this.cursorIndex+n;if((i<0||i>this.textList.length)&&(i=this.cursorIndex),i==this.cursorIndex){var r=t.Cursor.getInstance().element.parentElement;r.lastChild==t.Cursor.getInstance().element?r.appendChild(e.element):r.insertBefore(e.element,t.Cursor.getInstance().element.nextSibling),r=null}else{var r=this.textList[i].element.parentElement;i==this.textList.length?r.appendChild(e.element):r.insertBefore(e.element,this.textList[i].element),r=null}this.textList.splice(i,0,e)},e.prototype.deleteText=function(t){if(0!=this.textList.length){var e=this.cursorIndex+t;if((e<0||e>this.textList.length)&&(e=this.cursorIndex),0!=e){var n=this.textList.splice(e-1,1).pop();n.element.parentElement.removeChild(n.element),n.element.style.display="none",n=null}}},e.prototype.removeCursor=function(){},e.prototype.parseToString=function(){var e=[];if(this.textList)for(var n=0;n<this.textList.length;n++)e.push(this.textList[n].parseToString());for(var i=e.length-1;i>-1;i--)"^{2}"==e[i]&&(i=t.squareUtil.handleSquare(e,i));for(var r="",a=0,s=e.length;a<s;a++)r+=e[a];return r},e.prototype.setText=function(t){for(var e=0,n=t.length;e<n;e++)this.textList.push(t[e]),this.element.appendChild(t[e].element)},e.prototype.changeStyle=function(t){this.isEditable!=t&&(this.isEditable=t,t?this.element.setAttribute("class",this.className):this.textList.length>0&&this.element.setAttribute("class",this.classNameDone))},e.prototype.deleteAll=function(){},e.prototype.adjustView=function(t){},e.prototype.getPreChar=function(){if(0==this.cursorIndex)return"";var t=this.cursorIndex-1;return this.textList[t].parseToString()},e.prototype.replaceCursorPreChar=function(e){if(0==this.cursorIndex)return!1;var n=this.cursorIndex,i=this.textList.splice(n-1,1,e).pop(),r=i.element.parentElement;return r.removeChild(i.element),i.element.style.display="none",i=null,r.insertBefore(e.element,t.Cursor.getInstance().element),!0},e}();t.EditableSpan=n;var i=function(){function e(t,e,n,i){this.isComplexView=!0,this.element=t,this.keyBoardId=e,this.key=n,this.editableSpans=[],this.editIndex=0,this.setStyle(),this.setOnClick(i),this.init(i),this.isRepetend=!1}return e.prototype.setStyle=function(){this.element.setAttribute("class","fractions_container")},e.prototype.setOnClick=function(e){var n=this;DigitalKey.EventUtil.bindClickEvent(this.element,function(i){DigitalKey.LogUtils.log("分数内");var r=t.ViewUtils.getOffsetLeft(n.element),a=n.element.offsetWidth,s=i.clientX+document.body.scrollLeft,l=-1;l=s<r+a/2?e.textList.indexOf(n):e.textList.indexOf(n)+1,e.isClickInner=!0,e.setCursor(l)})},e.prototype.deleteText=function(t){return this.getCurrentEditableArea().deleteText(t),!1},e.prototype.addText=function(t,e){return"—"!=t.key.getTag()&&this.getCurrentEditableArea().addText(t,e),!1},e.prototype.parseToString=function(){return this.editableSpans[0].parseToString()+"\\frac {"+this.editableSpans[1].parseToString()+"} {"+this.editableSpans[2].parseToString()+"}"},e.prototype.foward=function(t){this.changeStyle(!0),this.getCurrentEditableArea().foward(t)},e.prototype.back=function(t){void 0===t&&(t=1),this.changeStyle(!0),this.getCurrentEditableArea().back(t)},e.prototype.getCurrentEditableArea=function(){return this.editableSpans[this.editIndex]},e.prototype.setCurrentEditableArea=function(t){var e=this.editableSpans.indexOf(t);e!=-1&&(this.editIndex=e)},e.prototype.setCursor=function(t){return this.changeStyle(!0),this.getCurrentEditableArea().setCursor(this.getCurrentEditableArea().cursorIndex+t),!1},e.prototype.init=function(e){this.editableSpans[0]=new t.EditableSpan(e,this,"editable_span_inter editable_has_after","editable_span_inter_done editable_no_after"),this.element.appendChild(this.editableSpans[0].element),this.editableSpans[1]=new t.EditableSpan(e,this),this.editableSpans[2]=new t.EditableSpan(e,this);var n=document.createElement("span");n.setAttribute("class","fractions_inner_container");var i=document.createElement("span");i.setAttribute("class","fraction_molecule_container"),i.appendChild(this.editableSpans[1].element),n.appendChild(i);var r=document.createElement("span");r.setAttribute("class","fraction_denominator_container"),r.appendChild(this.editableSpans[2].element),n.appendChild(r),this.element.appendChild(n)},e.prototype.changeStyle=function(t){this.editableSpans[0].changeStyle(t),this.editableSpans[1].changeStyle(t),this.editableSpans[2].changeStyle(t),t||0==this.editableSpans[0].textList.length&&this.editableSpans[0].element.setAttribute("class","editable_hidden")},e.prototype.getPreChar=function(t){return this.getCurrentEditableArea().getPreChar(t)},e.prototype.replaceCursorPreChar=function(t){return this.getCurrentEditableArea().replaceCursorPreChar(t)},e}();t.FractionsCharView=i;var r=function(){function e(t,e,n,i,r){void 0===r&&(r=!1),this.isComplexView=!1,this.element=t,this.keyBoardId=e,this.key=n,this.isRepetend=r,this.setStyle(),this.setOnClick(i)}return e.prototype.setStyle=function(){this.element.setAttribute("keyboard-cur_digital_id",this.keyBoardId.toString()),this.element.setAttribute("class","general_char_view"),this.element.innerHTML=this.key.getValue()},e.prototype.setOnClick=function(e){var n=this;DigitalKey.EventUtil.bindClickEvent(this.element,function(i){DigitalKey.LogUtils.log("普通数字");var r=t.ViewUtils.getOffsetLeft(n.element),a=n.element.offsetWidth,s=i.clientX+document.body.scrollLeft,l=-1;l=s<r+a/2?e.textList.indexOf(n):e.textList.indexOf(n)+1,e.isClickInner=!0,e.setCursor(l)})},e.prototype.deleteText=function(t){return!0},e.prototype.addText=function(t,e){return!0},e.prototype.parseToString=function(){return this.key.getLatex()},e.prototype.foward=function(t){},e.prototype.back=function(t){void 0===t&&(t=1)},e.prototype.setCursor=function(t){return!0},e.prototype.getCurrentEditableArea=function(){return null},e.prototype.changeStyle=function(t){},e.prototype.setCurrentEditableArea=function(t){},e}();t.GeneralCharView=r;var a=function(){function e(){this.digital_id=1e3,this.isClickInner=!1,this.inputMap=[],this.ids=[],this.isOpenKeyBoard=!1,DigitalKey.KeyFactory.init(),DigitalKey.EventUtil.initEventName(),DigitalKey.DigitalKeyBoard.getInstance(),window.addEventListener(DigitalKey.EventUtil.vEventHandler.mouseDown,this.autoCloseKeyBoard)}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.register=function(e,n,i){void 0===i&&(i=!1);var r=this.digital_id+"";e.setAttribute("digital_id",r),this.inputMap[r]=new t.InputText(e,r,n,i),this.ids.push(r),this.digital_id++},e.prototype.registerForId=function(e,n,i){void 0===i&&(i=!1);var r=document.getElementById(e),a=this.digital_id.toString();r.setAttribute("digital_id",a),this.inputMap[a]=new t.InputText(r,a,n,i),this.ids.push(a),this.digital_id++},e.prototype.unRegister=function(t){var e=t.getAttribute("digital_id");this.inputMap[e].destory(),delete this.inputMap[e];for(var n=0;n<this.ids.length;n++)if(this.ids[n]==e){this.ids.splice(n,1);break}e===this.cur_digital_id&&this.closeKeyBoard(!0)},e.prototype.unRegisterAll=function(){for(var t=this.ids.length,e=0;e<t;e++)this.inputMap[this.ids[e]].destory();this.inputMap.length=0,this.ids.length=0,this.digital_id=1e3,this.closeKeyBoard(!0)},e.prototype.unRegister4Id=function(t){var e=document.getElementById(t);this.unRegister(e)},e.prototype.changeInputText=function(t){$("input").blur(),$("textarea").blur();var e=this.inputMap[t];if(DigitalKey.DigitalKeyBoard.getInstance().setOnClick(e),this.cur_digital_id!=t){var n=this.inputMap[this.cur_digital_id];n&&(n.onBlur(),n.cursorIndex=-1)}this.cur_digital_id=t;var i=this.inputMap[this.cur_digital_id];i&&i.onFocus()},e.prototype.openKeyBoard=function(t){if(this.inputMap[t].disabled)this.isOpenKeyBoard&&this.closeKeyBoard(!0);else if(!this.isOpen(t)){DigitalKey.KeyManager.removeKeyDownListener(),DigitalKey.KeyManager.addKeyDownListener();var e=document.getElementsByTagName("body")[0];e.appendChild(DigitalKey.DigitalKeyBoard.getInstance().keyContainer),this.isOpenKeyBoard=!0,this.changeInputText(t),this.adjustView(t)}},e.prototype.isStopEvent=function(){return this.isClickInner},e.prototype.stopEvent=function(t){this.isClickInner=t},e.prototype.autoCloseKeyBoard=function(){DigitalKey.LogUtils.log("window"),t.InputManager.getInstance().isStopEvent()||(t.InputManager.getInstance().isOpenKeyBoard?t.InputManager.getInstance().closeKeyBoard(!0):t.InputManager.getInstance().clearAllFocus()),t.InputManager.getInstance().stopEvent(!1)},e.prototype.removeAdjustView=function(){this.blandDiv&&this.blandDiv.parentElement&&(this.blandDiv.parentElement.removeChild(this.blandDiv),this.blandDiv.style.display="none",this.blandDiv=null)},e.prototype.findParent=function(t){var e=document.getElementsByTagName("body")[0];return t.parentElement?t.parentElement==e?e:"scroll"==c.getDefaultStyle(t.parentElement,"overflow")||"auto"==c.getDefaultStyle(t.parentElement,"overflow")||"scroll"==c.getDefaultStyle(t.parentElement,"overflow-y")||"auto"==c.getDefaultStyle(t.parentElement,"overflow-y")||t.parentElement.scrollHeight>t.parentElement.offsetHeight?t.parentElement:this.findParent(t.parentElement):null},e.prototype.adjustView=function(e){var n=t.ViewUtils.offsetFuns(DigitalKey.DigitalKeyBoard.getInstance().keyContainer),i=n.top,r=DigitalKey.DigitalKeyBoard.getInstance().keyContainer.offsetHeight,a=t.ViewUtils.offsetFuns(this.inputMap[e].element),s=a.top,l=this.inputMap[e].element.offsetHeight,o=document.body.clientHeight,u=s+l-i;if(u>0){this.blandDiv&&this.blandDiv.parentElement&&this.blandDiv.parentElement.removeChild(this.blandDiv);var c=this.findParent(this.inputMap[e].element);c&&(u=s-(o-l-r)+l,this.blandDiv=document.createElement("div"),this.blandDiv.setAttribute("class","offset_blank_panel"),c.offsetHeight+u>o?(this.blandDiv.style.height=u+"px",c.appendChild(this.blandDiv)):(this.blandDiv.style.height=r+"px",c.appendChild(this.blandDiv)),this.inputMap[e].element.scrollIntoView())}},e.prototype.isOpen=function(t){return DigitalKey.DigitalKeyBoard.getInstance().inputText==this.inputMap[t]&&this.isOpenKeyBoard},e.prototype.clearAllFocus=function(){DigitalKey.KeyManager.removeKeyDownListener();var e=this.inputMap[this.cur_digital_id];e&&(e.onBlur(),e.cursorIndex=-1),t.Cursor.getInstance().clearCursor()},e.prototype.closeKeyBoard=function(t){if(this.isOpenKeyBoard){t&&this.clearAllFocus(),DigitalKey.KeyManager.removeKeyDownListener();document.getElementsByTagName("body")[0].removeChild(DigitalKey.DigitalKeyBoard.getInstance().keyContainer),this.isOpenKeyBoard=!1,this.removeAdjustView()}},e.prototype.getText=function(t){return void 0===t&&(t=this.cur_digital_id),null!=t&&""!=t&&this.ids.indexOf(t)!=-1?this.inputMap[t].parseToString():""},e.prototype.getText4Dom=function(t){var e=t.getAttribute("digital_id");return null!=e&&""!=e&&this.ids.indexOf(e)!=-1?this.inputMap[e].parseToString():""},e.prototype.getText4Id=function(t){var e=document.getElementById(t),n=e.getAttribute("digital_id");return null!=n&&""!=n&&this.ids.indexOf(n)!=-1?this.inputMap[n].parseToString():""},e.prototype.setText=function(e,n){void 0===n&&(n=this.cur_digital_id),this.inputMap[n].setText(t.Parser.getInstance().parseLatex(e,this.inputMap[n]))},e.prototype.setText4Id=function(e,n){var i=document.getElementById(n),r=i.getAttribute("digital_id");this.inputMap[r].setText(t.Parser.getInstance().parseLatex(e,this.inputMap[r]))},e.prototype.setText4DOM=function(e,n){var i=n.getAttribute("digital_id");this.inputMap[i].setText(t.Parser.getInstance().parseLatex(e,this.inputMap[i]))},e.prototype.appendText=function(e,n,i){void 0===n&&(n=this.cur_digital_id),this.inputMap[n].appendText(t.Parser.getInstance().parseLatex(e,this.inputMap[n]),i)},e.prototype.appendText4Id=function(e,n,i){var r=document.getElementById(n),a=r.getAttribute("digital_id");this.inputMap[a].appendText(t.Parser.getInstance().parseLatex(e,this.inputMap[a]),i)},e.prototype.appendText4DOM=function(e,n,i){var r=n.getAttribute("digital_id");this.inputMap[r].appendText(t.Parser.getInstance().parseLatex(e,this.inputMap[r]),i)},e.prototype.setDisabled4DOM=function(t,e){var n=t.getAttribute("digital_id");this.inputMap[n].setDisabled(e)},e.prototype.getDisabled4DOM=function(t){var e=t.getAttribute("digital_id");return this.inputMap[e].getDisabled()},e.prototype.setDisabled4Id=function(t,e){var n=document.getElementById(t),i=n.getAttribute("digital_id");this.inputMap[i].setDisabled(e)},e.prototype.getDisabled4Id=function(t){var e=document.getElementById(t),n=e.getAttribute("digital_id");return this.inputMap[n].getDisabled()},e.prototype.setFocusCallback4DOM=function(t,e,n){var i=t.getAttribute("digital_id");this.inputMap[i].setFocusCallback(e,n)},e.prototype.setFocusCallback4Id=function(t,e,n){var i=document.getElementById(t),r=i.getAttribute("digital_id");this.inputMap[r].setFocusCallback(e,n)},e.prototype.setCursorCallback=function(t,e){var n=t.getAttribute("digital_id");this.inputMap[n].setCursorCallback(e)},e.prototype.setCursorCallback4Id=function(t,e){var n=document.getElementById(t),i=n.getAttribute("digital_id");this.inputMap[i].setCursorCallback(e)},e.prototype.isCursorLast=function(t){var e=t.getAttribute("digital_id");return this.inputMap[e].isCursorLast()},e.prototype.isCursorLast4Id=function(t){var e=document.getElementById(t),n=e.getAttribute("digital_id");return this.inputMap[n].isCursorLast()},e.prototype.clearText=function(t,e){var n=t.getAttribute("digital_id");this.inputMap[n].deleteAll(e)},e.prototype.clearText4Id=function(t,e){var n=document.getElementById(t),i=n.getAttribute("digital_id");this.inputMap[i].deleteAll(e)},e.prototype.deleteText=function(t){var e=t.getAttribute("digital_id");this.cur_digital_id===e?this.inputMap[e].deleteAndBack(!1):this.inputMap[e].deleteAndBack(!0)},e.prototype.deleteText4Id=function(t){var e=document.getElementById(t),n=e.getAttribute("digital_id");this.cur_digital_id===n?this.inputMap[n].deleteAndBack(!1):this.inputMap[n].deleteAndBack(!0)},e.prototype.setText4All=function(t,e){void 0===e&&(e=this.ids);for(var n=0,i=e.length,r=t.length;n<i&&n<r;n++)this.setText(t[n],e[n])},e.prototype.getCursorPosAndPreChar=function(t){var e=t.getAttribute("digital_id");return this.inputMap[e].getCursorPosAndPreChar()},e.prototype.replaceCursorPreChar=function(e,n){var i=e.getAttribute("digital_id");this.inputMap[i].replaceCursorPreChar(t.Parser.getInstance().parseLatex(n,this.inputMap[i]))},e.prototype.getCursorPosAndPreChar4Id=function(t){var e=document.getElementById(t),n=e.getAttribute("digital_id");return this.inputMap[n].getCursorPosAndPreChar()},e.prototype.replaceCursorPreChar4Id=function(e,n){var i=document.getElementById(e),r=i.getAttribute("digital_id");this.inputMap[r].replaceCursorPreChar(t.Parser.getInstance().parseLatex(n,this.inputMap[r]))},e.prototype.getCursorIndex=function(t){var e=t.getAttribute("digital_id");return this.inputMap[e].getCursorIndex()},e.prototype.getCursorIndex4Id=function(t){var e=document.getElementById(t),n=e.getAttribute("digital_id");return this.inputMap[n].getCursorIndex()},e}();t.InputManager=a;var s=function(){function e(){this.initKeyMap()}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.parseLatex=function(e,n){e=o.removePackage(e);var i=[];e=e.toString(),e=e.replace(/\s/gi,"");for(var r=0,a=DigitalKey.KeyFactory.keys.length;r<a;r++)if(""!=DigitalKey.KeyFactory.keys[r].getLatex()){if("\\dot"==DigitalKey.KeyFactory.keys[r].getLatex())continue;var s=DigitalKey.KeyFactory.keys[r].getLatex().replace(/\s/gi,"");s.length>1&&(s=s.replace("\\","\\\\").replace("(","\\(").replace(")","\\)").replace("[","\\[").replace("]","\\]").replace("{","\\{").replace("}","\\}").replace("^","\\^"),e=e.replace(new RegExp(s,"g"),DigitalKey.KeyFactory.keys[r].getTag()))}var s="\\dot";s=s.replace("\\","\\\\").replace("(","\\(").replace(")","\\)").replace("[","\\[").replace("]","\\]").replace("{","\\{").replace("}","\\}").replace("^","\\^"),e=e.replace(new RegExp(s,"g"),"•");for(var l=[],u=[],c=[],d=/^[0-9]+.?[0-9]*$/,r=0,a=e.length;r<a;r++)if("—"==e[r]){for(var p=[],h=r-1;h>-1&&d.test(e[h]);h--)p.push(new t.GeneralCharView(document.createElement("span"),t.InputText.textId++,this.keyMap[e[h]],n));var g=[];if("{"==e[r+1]){r+=2;var f=[];for(f.push("{");r<a&&0!=f.length;r++)"{"==e[r]?f.push("{"):"}"==e[r]?f.pop():g.push(new t.GeneralCharView(document.createElement("span"),t.InputText.textId++,this.keyMap[e[r]],n))}var v=[];if("{"==e[r])for(f.length=0,f.push("{"),r++;r<a&&0!=f.length;r++)"{"==e[r]?f.push("{"):"}"==e[r]?f.pop():v.push(new t.GeneralCharView(document.createElement("span"),t.InputText.textId++,this.keyMap[e[r]],n));var y=new t.FractionsCharView(document.createElement("span"),t.InputText.textId++,this.keyMap["—"],n);y.editableSpans[0].setText(p.reverse()),y.editableSpans[1].setText(g),y.editableSpans[2].setText(v),y.changeStyle(!1),c.push(y),l.push(h+1),u.push(--r)}for(var m=0,r=0,a=e.length;r<a;r++)if(m<l.length&&l[m]==r)i.push(c[m]),r=u[m],m++;else if("•"==e[r]){if("{"==e[r+1])for(r+=2;r<e.length&&"}"!=e[r];){var C=new t.GeneralCharView(document.createElement("span"),t.InputText.textId++,this.keyMap[e[r]],n,!0);i.push(C),t.RepetedentUtils.addRepetedView(C),r++}}else this.keyMap[e[r]]&&i.push(new t.GeneralCharView(document.createElement("span"),t.InputText.textId++,this.keyMap[e[r]],n));return i},e.prototype.initKeyMap=function(){this.keyMap=[];for(var t=0,e=DigitalKey.KeyFactory.keys.length;t<e;t++)this.keyMap[DigitalKey.KeyFactory.keys[t].getTag()]=DigitalKey.KeyFactory.keys[t]},e}();t.Parser=s;var l=function(){function e(t,e,n,i){void 0===i&&(i=!1),this.cursorIndex=-1,this.isClickInner=!1,this.element=t,this.digital_id=e,this.onTextChange=n,this.disabled=i,this.init(),this.setOnClick(),this.isEditInChild=!1}return e.prototype.onFocus=function(){this.onfocus&&this.onfocus()},e.prototype.onBlur=function(){this.changeChildStyle(!1),this.onblur&&this.onblur()},e.prototype.destory=function(){this.onTextChange&&(this.onTextChange=null),this.onfocus&&(this.onfocus=null),this.onfocus&&(this.onfocus=null),this.onCursorCallBack&&(this.onCursorCallBack=null),this.contentElement&&(this.contentElement.parentElement&&this.contentElement.parentElement.removeChild(this.contentElement),this.contentElement=null),this.textList&&(this.textList.length=0,this.textList=null),this.element&&(this.mouseDownEventListener&&this.element.removeEventListener(DigitalKey.EventUtil.vEventHandler.mouseDown,this.mouseDownEventListener),this.element=null),this.disabled=!0},e.prototype.setFocusCallback=function(t,e){this.onfocus=t,this.onblur=e},e.prototype.setCursorCallback=function(t){this.onCursorCallBack=t},e.prototype.isCursorLast=function(){return this.cursorIndex==this.textList.length||this.cursorIndex==-1},e.prototype.setDisabled=function(t){this.disabled=t},e.prototype.getDisabled=function(){return this.disabled},e.prototype.setOnClick=function(){var e=this,n=this;DigitalKey.EventUtil.bindClickEvent(this.element,function(i){n.disabled||(DigitalKey.LogUtils.log("InputText"),t.InputManager.getInstance().openKeyBoard(e.digital_id),n.isClickInner||n.setCursor(e.textList.length),n.isClickInner=!1)}),this.mouseDownEventListener=function(e){t.InputManager.getInstance().stopEvent(!0)},this.element.removeEventListener(DigitalKey.EventUtil.vEventHandler.mouseDown,this.mouseDownEventListener),this.element.addEventListener(DigitalKey.EventUtil.vEventHandler.mouseDown,this.mouseDownEventListener)},e.prototype.init=function(){var t=this.element.getAttribute("class");this.element.setAttribute("class",t+" input_cursor"),this.contentElement=document.createElement("span"),this.contentElement.setAttribute("class","main_container"),this.element.appendChild(this.contentElement),this.textList=[]},e.prototype.adjustView=function(e){void 0===e&&(e=0);var n=t.ViewUtils.offsetFuns(t.Cursor.getInstance().element).left,i=t.ViewUtils.offsetFuns(this.element).left,r=this.element.offsetWidth;n-i-r>0||0!=e?this.element.scrollLeft=t.Cursor.getInstance().element.offsetLeft-r+10*t.Cursor.getInstance().element.offsetWidth+e:n<=i&&(this.element.scrollLeft=t.Cursor.getInstance().element.offsetLeft-8*t.Cursor.getInstance().element.offsetWidth-e)},e.prototype.setCursor=function(e){if(this.disabled)return!0;if(this.cursorIndex!=e||this.contentElement!=t.Cursor.getInstance().element.parentElement)return this.isEditInChild=!1,0==this.textList.length||e>=this.textList.length||e<0?(t.Cursor.getInstance().setCursor(this.contentElement),this.cursorIndex=this.textList.length,this.onCursorCallBack&&this.onCursorCallBack(!0)):(t.Cursor.getInstance().setCursor(this.contentElement,this.textList[e].element),this.cursorIndex=e,this.onCursorCallBack&&this.onCursorCallBack(!1)),this.adjustView(),this.changeChildStyle(!1),!1},e.prototype.changeChildStyle=function(t){for(var e=0;e<this.textList.length;e++)this.textList[e].changeStyle(t)},e.prototype.foward=function(t){if(void 0===t&&(t=1),this.isEditInChild)this.textList[this.cursorIndex].foward(t);else{var e=this.cursorIndex+t;e>this.textList.length&&(e=this.textList.length),this.setCursor(e)}},e.prototype.back=function(t){if(void 0===t&&(t=1),this.isEditInChild)this.textList[this.cursorIndex].back(t);else{var e=this.cursorIndex-t;e<0&&(e=0),this.setCursor(e)}},e.prototype.addText=function(e,n){if(this.isEditInChild)e.setOnClick(this.textList[this.cursorIndex].getCurrentEditableArea()),this.textList[this.cursorIndex].addText(e,n);else{var i=this.cursorIndex+n;if((i<0||i>this.textList.length)&&(i=this.cursorIndex),i==this.cursorIndex){var r=t.Cursor.getInstance().element.parentElement;if(!r)return;r.lastChild==t.Cursor.getInstance().element?r.appendChild(e.element):r.insertBefore(e.element,t.Cursor.getInstance().element.nextSibling),r=null}else{var r=this.textList[i].element.parentElement;if(!r)return;i==this.textList.length?r.appendChild(e.element):r.insertBefore(e.element,this.textList[i].element),r=null}this.textList.splice(i,0,e)}this.onTextChange(this.parseToString())},e.prototype.deleteAll=function(e){0!=this.textList.length&&(this.delNextElement(this.contentElement.firstChild,this.contentElement),this.textList.length=0,e&&(this.setCursor(0),t.InputManager.getInstance().changeInputText(this.element.getAttribute("digital_id"))),this.onTextChange(this.parseToString()))},e.prototype.delNextElement=function(t,e){if(t){var n=t.nextSibling;e&&e.removeChild(t),this.delNextElement(n,e)}},e.prototype.deleteAndBack=function(e){this.deleteText(0),this.back(),e&&(t.InputManager.getInstance().changeInputText(this.element.getAttribute("digital_id")),this.setCursor(this.textList.length),this.isClickInner=!1)},e.prototype.deleteText=function(t){if(this.isEditInChild)this.textList[this.cursorIndex].deleteText(t);else{if(0==this.textList.length)return;var e=this.cursorIndex+t;if((e<0||e>this.textList.length)&&(e=this.cursorIndex),0==e)return;var n=this.textList.splice(e-1,1).pop();n.element.parentElement.removeChild(n.element),n.element.style.display="none",n=null}this.onTextChange(this.parseToString())},e.prototype.removeCursor=function(){this.contentElement.removeChild(t.Cursor.getInstance().element),t.Cursor.getInstance().clearCursor()},e.prototype.parseToString=function(){for(var e=[],n="",i=0,r=this.textList.length;i<r;i++){var a=this.textList[i],s=a.parseToString();a.isRepetend?n+=s:(""!=n&&e.push("\\dot {"+n+"}"),e.push(s),n="")}""!=n&&e.push("\\dot {"+n+"}"),n=null;for(var l=e.length-1;l>-1;l--)"^{2}"==e[l]&&(l=t.squareUtil.handleSquare(e,l));for(var u="",c=0,r=e.length;c<r;c++)u+=e[c];return u=o.handlePackage(u)},e.prototype.setText=function(t){this.delNextElement(this.contentElement.firstChild,this.contentElement),this.textList.length=0;for(var e=0,n=t.length;e<n;e++)this.textList.push(t[e]),this.contentElement.appendChild(t[e].element);this.onTextChange(this.parseToString())},e.prototype.appendText=function(e,n){if(this.cursorIndex<0||this.cursorIndex>this.textList.length){for(var i=0,r=e.length;i<r;i++)this.textList.push(e[i]),this.contentElement.appendChild(e[i].element);n&&(t.InputManager.getInstance().changeInputText(this.element.getAttribute("digital_id")),this.setCursor(this.textList.length),this.isClickInner=!1),this.onTextChange(this.parseToString())}else{for(var i=0,r=e.length;i<r;i++)this.addText(e[i],0),this.foward();this.onTextChange(this.parseToString())}},e.prototype.getCursorPosAndPreChar=function(){if(this.cursorIndex==-1)return{top:0,left:0,preChar:""};var e=$(t.Cursor.getInstance().element).position();return e||(e={top:0,left:0}),e.preChar=this.getPreChar(),e.height=t.Cursor.getInstance().element.offsetHeight||0,e},e.prototype.getPreChar=function(){if(0==this.cursorIndex)return"";if(this.isEditInChild)return this.textList[this.cursorIndex].getPreChar();var t=this.cursorIndex-1;return this.textList[t].isComplexView?"":this.textList[t].parseToString()},e.prototype.replaceCursorPreChar=function(e){if(!e||e.lenght<1)return void LogUtils.error("解析字符有误"+e);var n=e[0];if(0!=this.cursorIndex&&this.cursorIndex!=-1)if(this.isEditInChild)this.textList[this.cursorIndex].replaceCursorPreChar(n)&&this.onTextChange(this.parseToString());else{var i=this.cursorIndex,r=this.textList.splice(i-1,1,n).pop(),a=r.element.parentElement;a.removeChild(r.element),r.element.style.display="none",r=null,a.insertBefore(n.element,t.Cursor.getInstance().element),this.onTextChange(this.parseToString())}},e.prototype.getCursorIndex=function(){return this.cursorIndex},e.textId=1e3,e}();t.InputText=l;var o=function(){function t(){}return t.isNumber=function(t){return/^-?[0-9]+\.?[0-9]*$/.test(t)},t.handlePackage=function(e){return e&&e.length>0?t.isNumber(e)?e:"\\("+e+"\\)":e},t.removePackage=function(t){var e=t.length;return"\\("==t.substring(0,2)&&"\\)"==t.substring(e-2,e)?t.substring(2,e-2):t},t}();t.HandleTextType=o;var u=function(){function t(){}return t.addRepetedView=function(t){t.element.innerHTML="";var e=document.createElement("span");e.innerHTML=".",e.setAttribute("class","repetend_visible"),e.setAttribute("repeted","circle");var n=document.createElement("span");n.innerHTML=t.key.getValue(),n.setAttribute("repeted","value"),t.element.appendChild(e),t.element.appendChild(n)},t.removeRepetedView=function(t){for(var e=t.element.children;e.length>0;)t.element.removeChild(e[0]);e=null,t.element.innerHTML=t.key.getValue()},t}();t.RepetedentUtils=u;var c=function(){function t(){}return t.getDefaultStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,"")[e]},t.stopEvent=function(t){t?t.stopPropagation():window.event.cancelable=!0},t.getOffsetLeft=function(t){for(var e=t.offsetLeft,n=t.offsetParent;null!=n;)e+=n.offsetLeft,n=n.offsetParent;return e},t.offsetFuns=function(t){var e,n,i={top:0,left:0},r=t&&t.ownerDocument;if(r)return e=r.documentElement,void 0!==t.getBoundingClientRect&&(i=t.getBoundingClientRect()),n=r==r.window?r:9===r.nodeType&&(r.defaultView||r.parentWindow),{top:i.top+(n.pageYOffset||e.scrollTop)-(e.clientTop||0),left:i.left+(n.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}},t}();t.ViewUtils=c;var d=function(){function t(){}return t.handleSquare=function(t,e){var n=[];if(t.splice(e--,0,"}"),"} \\right )"==t[e]){for(n.push(t[e--]);0!=n.length&&e>-1;)"} \\right )"==t[e]?n.push(t[e--]):"\\left ( {"==t[e]?n.pop():"^{2}"==t[e]&&(e=this.handleSquare(t,e)),e--;return t.splice(e+1,0,"{"),e}if("} \\right ]"==t[e]){for(n.push(t[e--]);0!=n.length&&e>-1;)"} \\right ]"==t[e]?n.push(t[e--]):"\\left [ {"==t[e]?n.pop():"^{2}"==t[e]&&(e=this.handleSquare(t,e)),e--;return t.splice(e+1,0,"{"),e}if("\\pi "==t[e])return t.splice(e--,0,"{"),e;for(var i=/^[0-9]+.?[0-9]*$/;e>-1;)if(t[e].indexOf("\\dot")!=-1)e--;else if(t[e].indexOf("\\frac")!=-1)e--;else if(i.test(t[e]))e--;else{if("^{2}"!=t[e])break;e=this.handleSquare(t,e)}return t.splice(e+1,0,"{"),e},t}();t.squareUtil=d}(DigitalInput||(DigitalInput={}));var DigitalKey;!function(t){var e=function(){function e(){this.init()}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.init=function(){this.keyList=[],this.hasBindClick=!1;for(var e=t.KeyFactory.keys,n=0,i=e.length;n<i;n++)this.keyList.push(new a(e[n]));this.keyContainer=document.createElement("div"),this.keyContainer.setAttribute("class","exam_wood com_keyboard com_keyboard_number not_select");var r=document.createElement("div");r.setAttribute("class","keyboard");var s=document.createElement("div");s.setAttribute("class","boardtop");var l=document.createElement("div");l.setAttribute("class","pre_key_press_img"),s.appendChild(l);var o=document.createElement("a");o.setAttribute("class","btn_open"),o.href="###",s.appendChild(o),t.EventUtil.bindClickEvent(o,function(t){DigitalInput.InputManager.getInstance().closeKeyBoard(!0)}),r.appendChild(s);for(var n=0;n<4;n++){var u=document.createElement("ul");u.setAttribute("class","keyrow");for(var c=0;c<11;c++)u.appendChild(this.keyList[11*n+c].getElement());r.appendChild(u)}this.keyContainer.appendChild(r)},e.prototype.setOnClick=function(e){var n=this;if(this.inputText=e,!this.hasBindClick){var i;this.keyContainer.addEventListener(t.EventUtil.vEventHandler.mouseDown,function(e){
var r=t.EventUtil.getEventTarget(e),a=r.getAttribute("key_id");if(/^[0-9]+.?[0-9]*$/.test(a)&&-1<a&&a<n.keyList.length){var s=n.keyList[a];if(s){var l=s.getOnLongClickCallBack();l&&(t.LogUtils.log("keyContainaer  mousedown on "+r.tagName+" "+a),i=setTimeout(function(){l(n.inputText,s.getKey(),e)},1500))}}DigitalInput.InputManager.getInstance().stopEvent(!0)}),this.keyContainer.addEventListener(t.EventUtil.vEventHandler.mouseUp,function(e){var r=t.EventUtil.getEventTarget(e),a=r.getAttribute("key_id");if(/^[0-9]+.?[0-9]*$/.test(a)&&-1<a&&a<n.keyList.length){var s=n.keyList[a];s&&s.getOnLongClickCallBack()&&(t.LogUtils.log("keyContainaer  mouseup on "+r.tagName+" "+a),clearTimeout(i))}}),t.EventUtil.bindClickEvent(this.keyContainer,function(e){var i=t.EventUtil.getEventTarget(e),r=i.getAttribute("key_id");if(t.LogUtils.log("keyContainaer  mouseclick on "+i.tagName+" "+r),/^[0-9]+.?[0-9]*$/.test(r)&&-1<r&&r<n.keyList.length){var a=n.keyList[r];a.getOnClickCallBack()(n.inputText,a.getKey(),e)}}),this.hasBindClick=!0}},e}();t.DigitalKeyBoard=e;var n=function(){function t(t,e,n,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=""),void 0===i&&(i=""),this.tag=t,this.name=e,this.value=n,this.latex=i}return t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.getOnClickFunction=function(){return this.onClick},t.prototype.setOnClickFunction=function(t){this.onClick=t},t.prototype.setOnLongClickFunction=function(t){this.onLongClick=t},t.prototype.getOnLongClickFunction=function(){return this.onLongClick},t.prototype.getTag=function(){return this.tag},t.prototype.setTag=function(t){this.tag=t},t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t.prototype.getValue=function(){return this.value},t.prototype.setValue=function(t){this.value=t},t.prototype.getLatex=function(){return this.latex},t.prototype.setLatex=function(t){this.latex=t},t.prototype.getKeyStyle=function(){return this.keyStyle},t.prototype.setKeyStyle=function(t){this.keyStyle=t},t.prototype.isHasTip=function(){return this.hasTip},t.prototype.setHasTip=function(t){this.hasTip=t},t}();t.Key=n;var i=function(){function e(){}return e.init=function(){this.keys=[];for(var e=0;e<r.keyJson.length;e++){var n=new t.Key;n.setId(e+""),n.setTag(r.keyJson[e].tag),n.setName(r.keyJson[e].name),n.setValue(r.keyJson[e].value),n.setLatex(r.keyJson[e].latex),void 0===r.keyJson[e].keyStyle?n.setKeyStyle(null):n.setKeyStyle(r.keyJson[e].keyStyle),void 0===r.keyJson[e].hasTip?n.setHasTip(!0):n.setHasTip(r.keyJson[e].hasTip),void 0!==r.keyJson[e].callback&&n.setOnClickFunction(t.EventCallBacks.getCallBack(r.keyJson[e].callback)),void 0!==r.keyJson[e].longClickBack&&n.setOnLongClickFunction(t.EventCallBacks.getCallBack(r.keyJson[e].longClickBack)),this.keys.push(n),n=null}},e}();t.KeyFactory=i;var r=function(){function t(){}return t.keyJson=[{tag:"0",name:"0",value:"0",latex:"0"},{tag:"1",name:"1",value:"1",latex:"1"},{tag:"2",name:"2",value:"2",latex:"2"},{tag:"3",name:"3",value:"3",latex:"3"},{tag:"4",name:"4",value:"4",latex:"4"},{tag:"5",name:"5",value:"5",latex:"5"},{tag:"6",name:"6",value:"6",latex:"6"},{tag:"7",name:"7",value:"7",latex:"7"},{tag:"8",name:"8",value:"8",latex:"8"},{tag:"9",name:"9",value:"9",latex:"9"},{tag:"backspace",name:"",value:"",latex:"",keyStyle:"icon_del",hasTip:!1,callback:"backCallBack",longClickBack:"backLongClickCallBack"},{tag:"≈",name:"&asymp;",value:"&asymp;",latex:"\\approx "},{tag:"(",name:"(",value:"(",latex:"("},{tag:")",name:")",value:")",latex:")"},{tag:"<",name:"&lt;",value:"&lt;",latex:"<"},{tag:">",name:"&gt;",value:"&gt;",latex:">"},{tag:"+",name:"+",value:"+",latex:"+"},{tag:"-",name:"-",value:"-",latex:"-"},{tag:"×",name:"&times;",value:"&times;",latex:"\\times "},{tag:"÷",name:"&divide;",value:"&divide;",latex:"\\div "},{tag:"=",name:"=",value:"=",latex:"="},{tag:"up arrow",name:"&uarr;",value:"",latex:"",callback:"upCallBack"},{tag:"π",name:"&pi;",value:"&pi;",latex:"\\pi "},{tag:"[",name:"【",value:"[",latex:"["},{tag:"]",name:"】",value:"]",latex:"]"},{tag:"≤",name:"&le;",value:"&le;",latex:"\\leq "},{tag:"≥",name:"&ge;",value:"&ge;",latex:"\\geq "},{tag:"²",name:"&sup2;",value:"&sup2;",latex:"^{2}"},{tag:"•",name:"&bull;",value:"&bull;",latex:"\\dot",keyStyle:"font_super",callback:"repetendCallBack"},{tag:"sign",name:"+/-",value:"",latex:"",keyStyle:"font_small",callback:"signCallBack"},{tag:"—",name:"&mdash;",value:"&mdash;",latex:"\\frac",callback:"fractionsCallBack"},{tag:"…",name:"&hellip;",value:"...",latex:"\\dots "},{tag:"down arrow",name:"&darr;",value:"",latex:"",callback:"downCallBack"},{tag:"∠",name:"&ang;",value:"&ang;",latex:"\\angle "},{tag:"°",name:"&deg;",value:"&deg;",latex:"°"},{tag:"℃",name:"&deg;C",value:"℃",latex:"℃"},{tag:"%",name:"%",value:"%",latex:"\\%"},{tag:" ",name:"Space",value:"&nbsp;",latex:"\\, ",keyStyle:"font_small"},{tag:".",name:".",value:".",latex:"."},{tag:",",name:",",value:",",latex:","},{tag:":",name:":",value:":",latex:":"},{tag:"left arrow",name:"&larr;",value:"",latex:"",callback:"leftCallBack"},{tag:"right arrow",name:"&rarr;",value:"",latex:"",callback:"rightCallBack"},{tag:"Enter",name:"Enter",value:"",latex:"",keyStyle:"font_small",callback:"enterCallBack"}],t}(),a=function(){function t(t){this.key=t,this.init()}return t.prototype.getElement=function(){return this.keyElement},t.prototype.getKey=function(){return this.key},t.prototype.init=function(){this.keyElement=document.createElement("li");var t=document.createElement("span");if(t.setAttribute("class","txt"),t.setAttribute("key_id",this.key.getId()),this.key.getKeyStyle()){var e=document.createElement("em");e.setAttribute("class",this.key.getKeyStyle()),e.setAttribute("key_id",this.key.getId()),e.innerHTML=this.key.getName(),t.appendChild(e),e=null}else t.innerHTML=this.key.getName();var n=document.createElement("a");n.href="###",n.setAttribute("class","key key_normal"),n.appendChild(t),n.setAttribute("key_id",this.key.getId()),this.keyElement.appendChild(n)},t.prototype.getOnClickCallBack=function(){var t=this,e=this.key.getOnClickFunction();return e||function(e,n,i){e.addText(new DigitalInput.GeneralCharView(document.createElement("span"),DigitalInput.InputText.textId++,t.key,e),0),e.foward()}},t.prototype.getOnLongClickCallBack=function(){return this.key.getOnLongClickFunction()},t}();t.KeyView=a;var s=function(){function e(){}return e.getCallBack=function(t){return this[t]&&"function"==typeof this[t]?this[t]:this.getError},e.getError=function(){throw"error to get callback, check the callback name!"},e.backCallBack=function(e,n,i){return t.LogUtils.log("backCallBack"),e.deleteText(0),e.back(),!0},e.backLongClickCallBack=function(e,n,i){t.LogUtils.log("backLongClickCallBack"),e.deleteAll()},e.upCallBack=function(e,n,i){if(t.LogUtils.log("upCallBack"),!(e.cursorIndex<0)){var r;if(e.isEditInChild)r=e.textList[e.cursorIndex],r.editIndex--,r.editIndex<0?(r.editIndex=0,e.isEditInChild=!1,e.back(0)):e.back(-r.editableSpans[r.editIndex].textList.length);else{if(e.cursorIndex<1)return;r=e.textList[e.cursorIndex-1],r.isComplexView?(r.editIndex=r.editableSpans.length-1,e.isEditInChild=!0,e.cursorIndex=e.textList.indexOf(r),e.back(-r.editableSpans[r.editIndex].textList.length)):e.back()}return r=null,!0}},e.downCallBack=function(e,n,i){if(t.LogUtils.log("downCallBack"),!(e.cursorIndex>=e.textList.length)){var r=e.textList[e.cursorIndex];return e.isEditInChild?(r.editIndex++,r.editIndex>=r.editableSpans.length?(r.editIndex=0,e.isEditInChild=!1,e.foward()):e.foward(r.editableSpans[r.editIndex].textList.length)):(r.isComplexView&&(e.isEditInChild=!0,e.cursorIndex=e.textList.indexOf(r),r.editIndex=0,e.foward(r.editableSpans[r.editIndex].textList.length)),e.foward()),r=null,!0}},e.leftCallBack=function(e,n,i){if(t.LogUtils.log("leftCallBack"),!(e.cursorIndex<1))return e.back(),!0},e.rightCallBack=function(e,n,i){if(t.LogUtils.log("rightCallBack"),!(e.cursorIndex>=e.textList.length))return e.foward(),!0},e.enterCallBack=function(e,n,i){if(t.LogUtils.log("enterCallBack"),e.isEditInChild)e.isEditInChild=!1,e.foward();else{var r=DigitalInput.InputManager.getInstance().cur_digital_id,a=DigitalInput.InputManager.getInstance().ids.indexOf(r);if(a+1<DigitalInput.InputManager.getInstance().ids.length){var s=DigitalInput.InputManager.getInstance().ids[a+1];DigitalInput.InputManager.getInstance().openKeyBoard(s);var l=DigitalInput.InputManager.getInstance().inputMap[s];l.isClickInner||l.disabled||l.setCursor(l.textList.length),l.isClickInner=!1}else DigitalInput.InputManager.getInstance().closeKeyBoard(!0)}return!0},e.fractionsCallBack=function(e,n,i){if(t.LogUtils.log("fractionsCallBack"),!e.isEditInChild){var r=new DigitalInput.FractionsCharView(document.createElement("span"),DigitalInput.InputText.textId++,n,e);return e.addText(r,0),e.isEditInChild=!0,e.foward(),!0}},e.signCallBack=function(e,n,i){t.LogUtils.log("signCallBack");var r,a=!1,s=/^[0-9]+.?[0-9]*$/,l=!1;if(r=e.isEditInChild?e.textList[e.cursorIndex].getCurrentEditableArea():e){for(var o=r.cursorIndex-1,u=r.textList.length;o>-1&&o<u;o--){var c=r.textList[o].key.getTag();if(!r.textList[o].isComplexView&&!s.test(c)){if("."==c&&!l){l=!0;continue}if("²"==c)continue;if("-"==c){r.deleteText(o+1-r.cursorIndex),r.back(),a=!0;break}r.addText(new DigitalInput.GeneralCharView(document.createElement("span"),DigitalInput.InputText.textId++,new t.Key("-","-","-","-"),r),o+1-r.cursorIndex),r.foward(),a=!0;break}}0==a&&(r.addText(new DigitalInput.GeneralCharView(document.createElement("span"),DigitalInput.InputText.textId++,new t.Key("-","-","-","-"),r),-r.cursorIndex),r.foward())}return!0},e.repetendCallBack=function(e,n,i){t.LogUtils.log("repetendCallBack");var r=/^[0-9]+.?[0-9]*$/;if(!e.isEditInChild){if(e.cursorIndex-1>-1){var a=e.textList[e.cursorIndex-1],s=a.key.getTag();r.test(s)&&(a.isRepetend?(DigitalInput.RepetedentUtils.removeRepetedView(a),a.isRepetend=!1):(DigitalInput.RepetedentUtils.addRepetedView(a),a.isRepetend=!0),e.onTextChange(e.parseToString()))}return!0}},e}();t.EventCallBacks=s;var l=function(){function t(){}return t.getEventTarget=function(t){return t=t||window.event,t.target||t.srcElement},t.initEventName=function(){null==t.vEventHandler&&(t.vEventHandler={},"ontouchend"in document&&navigator.userAgent.match(/(iPhone|iPod|Android|ios|iPad)/i)?(t.vEventHandler.mouseDown="touchstart",t.vEventHandler.mouseUp="touchend",t.vEventHandler.mouseCancel="touchcancel",t.vEventHandler.getEventX=function(t){return t.changedTouches[0].clientX},t.vEventHandler.getEventY=function(t){return t.changedTouches[0].clientY}):(t.vEventHandler.mouseDown="mousedown",t.vEventHandler.mouseUp="mouseup",t.vEventHandler.mouseCancel="mouseleave",t.vEventHandler.getEventX=function(t){return t.clientX},t.vEventHandler.getEventY=function(t){return t.clientY}))},t.bindClickEvent=function(e,n){var i=e;if("ontouchend"in document&&navigator.userAgent.match(/(iPhone|iPod|Android|ios|iPad)/i)){var r=t.vEventHandler.mouseDown,a=t.vEventHandler.mouseUp,s=t.vEventHandler.mouseCancel,l=0,o=0,u=0,c=function(e){if(0!==e.which||1!==e.which){var r=(new Date).getTime(),p=t.vEventHandler.getEventX(e),h=t.vEventHandler.getEventY(e),g=r-l,f=Math.abs(p-o),v=Math.abs(h-u);g<=350&&f<20&&v<20&&n(e)}i.removeEventListener(a,c),i.removeEventListener(s,d)},d=function(t){i.removeEventListener(a,c),i.removeEventListener(s,d)},p=function(e){0===e.which&&1===e.which||(l=(new Date).getTime(),o=t.vEventHandler.getEventX(e),u=t.vEventHandler.getEventY(e)),i.addEventListener(a,c),i.addEventListener(s,d)};i.removeEventListener(a,c),i.removeEventListener(s,d),i.removeEventListener(r,p),i.addEventListener(r,p)}else i.addEventListener("click",function(t){n(t)})},t.vEventHandler=null,t}();t.EventUtil=l;var o=function(){function t(){}return t.log=function(e){t.DEBUG&&console.log(e)},t.error=function(t){console.error(t)},t.DEBUG=!1,t}();t.LogUtils=o;var u=function(){function t(){}return t.addKeyDownListener=function(){document.addEventListener("keydown",t.keyDownListener)},t.removeKeyDownListener=function(){document.removeEventListener("keydown",t.keyDownListener)},t.createInput=function(t,n){t.addText(new DigitalInput.GeneralCharView(document.createElement("span"),DigitalInput.InputText.textId++,e.getInstance().keyList[n].getKey(),t),0),t.foward()},t.keyDownListener=function(n){n=n||event;var i=n.keyCode||n.which||n.charCode,r=e.getInstance().inputText;if(DigitalInput.ViewUtils.stopEvent(n),n.shiftKey){if(53==i)return void t.createInput(r,36);if(56==i)return void t.createInput(r,18);if(57==i)return void t.createInput(r,12);if(48==i)return void t.createInput(r,13);if(187==i)return void t.createInput(r,16);if(188==i)return void t.createInput(r,14);if(190==i)return void t.createInput(r,15);if(186==i)return void t.createInput(r,40)}return 13==i?void s.getCallBack("enterCallBack")(r,null,null):37==i?void s.getCallBack("leftCallBack")(r,null,null):38==i?void s.getCallBack("upCallBack")(r,null,null):39==i?void s.getCallBack("rightCallBack")(r,null,null):40==i?void s.getCallBack("downCallBack")(r,null,null):32==i?void t.createInput(r,37):219==i?void t.createInput(r,23):221==i?void t.createInput(r,24):188==i?void t.createInput(r,39):190==i||110==i?void t.createInput(r,38):111==i?void t.createInput(r,19):106==i?void t.createInput(r,18):187==i?void t.createInput(r,20):107==i?void t.createInput(r,16):189==i||109==i?void t.createInput(r,17):8==i?(r.deleteText(0),void r.back()):48<=i&&i<=57?void t.createInput(r,i-48):96<=i&&i<=105?void t.createInput(r,i-96):void 0},t}();t.KeyManager=u}(DigitalKey||(DigitalKey={}));