!function(e,t){var i=function(){"use strict";var i="undefined";typeof String.prototype.trim===i&&(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}),typeof Array.prototype.forEach===i&&(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++){var i=this[t];e.apply(this,[i,t,this])}});var n=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?(t="on"+t,e.attachEvent(t,i)):e["on"+t]=i},s=function(e,t,i,n){e.removeEventListener?e.removeEventListener(t,i,n):e.detachEvent&&(t="on"+t,e.detachEvent(t,i))},a=function(e,i){var n=e.style[i];return n?n:e.currentStyle?e.currentStyle[i]:t.defaultView.getComputedStyle(e,"")[i]},o=function(e,n){if(typeof e!==i&&null!=e)return"string"==typeof n&&(e=n+" "+e),typeof n!==i&&null!==e&&n!==t.body||(n=t),this._selector="object"==typeof e?e:e.trim(),this._dom=[],this.length=0,"object"==typeof e?(this._dom[0]=e,this.length=1):"#"===this._selector.substring(0,1)&&this._selector.indexOf(" ")<=-1?(this._dom[0]=t.getElementById(this._selector.substring(1,this._selector.length)),this._dom[0]&&(this.length=1)):(this._dom=n.querySelectorAll(this._selector),this.length=this._dom.length),this};o.prototype={each:function(e){if(this.length>0)for(var t=0;t<this.length;t++){var i=this._dom[t];!function(){e.apply(i,[t])}(t)}},get:function(e){return this._dom[e]},show:function(){this.each(function(){this.style.display="block"})},hide:function(){this.each(function(){this.style.display="none"})},isShow:function(){return"block"===this.css("display")},toggle:function(){this.each(function(){"block"===a(this,"display")?this.style.display="none":this.style.display="block"})},css:function(e,t){return typeof t===i?a(this._dom[0],e):void this.each(function(){this.style[e]=t})},find:function(e){return r(e,this._dom[0])},bind:function(e,t){this.on(e,"",t)},addClass:function(e){return e=e.trim(),this.each(function(){for(var t=this.getAttribute("class"),i=null!=t?t.split(" "):"",n=e,s=0;s<i.length;s++){var a=i[s].trim();a!==e&&""!==a&&(n+=" "+a)}this.setAttribute("class",n)}),this},hasClass:function(e){e=e.trim();var t=!1;return this.each(function(){for(var i=this.getAttribute("class"),n=null!=i?i.split(" "):"",s=0;s<n.length;s++)if(n[s].trim()===e){t=!0;break}}),t},removeClass:function(e){e=e.trim(),this.each(function(){for(var t=this.getAttribute("class"),i=null!=t?t.split(" "):"",n="",s=0;s<i.length;s++){var a=i[s].trim();a!==e&&""!==a&&(n+=" "+a)}this.setAttribute("class",n)})},toggleClass:function(e){this.each(function(){for(var t=this.getAttribute("class").split(" "),i="",n=!1,s=0;s<t.length;s++){var a=t[s].trim();""!==a&&(a!==e?i+=" "+a:n=!0)}n||(i+=" "+e),this.setAttribute("class",i)})},attr:function(e,t){return"undefined"!=typeof t?(this.each(function(){"undefined"!=typeof t&&this.setAttribute(e,t)}),this):this._dom[0].getAttribute(e)},removeAttr:function(e){this.each(function(){if(e instanceof Array)for(var t=0;t<e.length;t++)this.removeAttribute(e[t]);else this.removeAttribute(e)})},text:function(e){if("undefined"==typeof e)throw new Error("only support set text");this.each(function(){this.innerText=e})},width:function(){if(arguments.length>0)throw new Error("only support get");var e=this._dom[0].offsetWidth;return e||(e=parseInt(this.css("width"))),e},height:function(){if(arguments.length>0)throw new Error("only support get");var e=this._dom[0].offsetHeight;return e||(e=parseInt(this.css("height"))),e},offset:function(){var e,t,i={top:0,left:0},n=this._dom[0],s=n&&n.ownerDocument;if(s)return e=s.documentElement,"undefined"!=typeof n.getBoundingClientRect&&(i=n.getBoundingClientRect()),t=s==s.window?s:9===s.nodeType&&(s.defaultView||s.parentWindow),{top:i.top+(t.pageYOffset||e.scrollTop)-(e.clientTop||0),left:i.left+(t.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}},on:function(e,t,s){var a=this;"function"==typeof t&&(s=t,t=""),e.split(" ").forEach(function(e){if(""!==e.trim()){var o=e.split(".")[0];if("click"===e.split(".")[0]&&r.support.touch||"qpTap"===o)return void r.event.qpTap(typeof t!==i&&""!==t?a.find(t):a,s);"still-click"===o&&(o="click"),typeof t!==i&&""!==t?a.find(t).each(function(){n(this,o,s)}):a.each(function(){n(this,o,s)})}})},off:function(e,t,n){var a=this;"function"==typeof t&&(n=t,t=""),e.split(" ").forEach(function(e){""!==e.trim()&&(typeof t!==i&&""!==t?a.find(t).each(function(){s(this,e.split(".")[0],n,!1)}):a.each(function(){s(this,e.split(".")[0],n,!1)}))})},before:function(e){if("string"==typeof e){var i=r(t.createElement("div"));i.html(e),this._dom[0].parentNode.appendChild(i.get(0));for(var n=i.get(0).children,s=n.length,a=0;n.length>0&&("object"==typeof n[0]&&this.before(n[0]),a++,!(a>=s)););i.remove()}else this._dom[0].parentNode.insertBefore(e,this._dom[0])},appendChild:function(e){this.each(function(){this.appendChild(e)})},html:function(e){return typeof e===i?this._dom[0].innerHTML:void(this._dom[0].innerHTML=e)},remove:function(){this._dom[0].parentNode&&this._dom[0].parentNode.removeChild(this._dom[0])},closest:function(e){if(e=e.trim(),"."!==e.substring(0,1)||e.indexOf(" ")>-1)throw new Error("only support simple class selector ");var t;for(t=this._dom[0];t&&"undefined"!=typeof t&&"body"!==t.nodeName.toLocaleLowerCase();t=t.parentNode)if(t.nodeType<11&&1===t.nodeType&&new r(t).hasClass(e.substring(1,e.length)))return r(t)},contains:function(e){var t=this._dom[0];return t.contains?t!==e&&t.contains(e):!!(16&t.compareDocumentPosition(e))},data:function(e,t){var i=this.attr("data-id");return"undefined"!=typeof i&&null!==i||"undefined"==typeof t||(i=r.utils.getRandomId("media"),this.attr("data-id",i)),"undefined"==typeof t?"undefined"==typeof r.cache[i+e]?"":r.cache[i+e]:void(null===t?delete r.cache[i+e]:r.cache[i+e]=t)}};var r=function(e,t){return new o(e,t)};r.noop=function(){},r.fn=function(e,t){o.prototype[e]=t},r.utils={},r.support={},r.event={},r.support.isMobile=function(){return!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i)}(),r.support.isiOS=!!navigator.userAgent.match(/iPhone|iPad|iPod/i),r.support.touch=function(){return typeof navigator!==i&&!!("ontouchend"in t&&r.support.isMobile)}(),r.event.checkHover=function(){var t=function(t){return t||e.event},i=function(e,t){return e.contains?e!==t&&e.contains(t):!!(16&e.compareDocumentPosition(t))};return function(e,n){return"mouseover"===t(e).type||"mousemove"===t(e).type?!i(n,t(e).relatedTarget||t(e).fromElement)&&(t(e).relatedTarget||t(e).fromElement)!==n:!i(n,t(e).relatedTarget||t(e).toElement)&&(t(e).relatedTarget||t(e).toElement)!==n}}(),r.event.isWhitePad=function(e){return!(!e.sourceCapabilities||!e.sourceCapabilities.firesTouchEvents)},r.event.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.returnValue=!1},r.event.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},r.utils.getRandomId=function(e){return e+(10*Math.random()+(new Date).getMilliseconds()).toString().replace(".","")},r.utils.resize=function(e,t,i,n,s,a){var o=e,r=t,l=1;return e<s&&(l=(s/e).toFixed(3),r=parseInt(l*t),o=s),r<a&&(l=(a/t).toFixed(3),o=parseInt(l*e),r=a),i>0&&o>i&&(l=(i/e).toFixed(3),r=parseInt(l*t),o=i),n>0&&r>n&&(l=(n/t).toFixed(3),o=parseInt(l*e),r=n),{w:o,h:r,scale:l}},r.utils.getRequest=function(){var e=location.search,t={};e=e.substr(1,e.length);for(var i=e.split("&"),n=0;n<i.length;n++){var s=i[n],a=s.split("="),o=a[0];if(o){var r=decodeURIComponent(a[1]);t[o]=r}}var l=function(e){return t[e]||""};return l.get=function(){return t},l}(),r.utils.getBasePath=function(e){var t=e.lastIndexOf("#");t==-1&&(t=e.length);var i=e.indexOf("?");i==-1&&(i=e.length);var n=e.lastIndexOf("/",Math.min(i,t));return n>=0?e.substring(0,n+1):""},r.extend=function(){var e,t,i,n,s,a,o=arguments[0]||{},r=1,l=arguments.length,d=!1;for("boolean"==typeof o&&(d=o,o=arguments[1]||{},r=2),"object"==typeof o||jQuery.isFunction(o)||(o={}),l===r&&(o=this,--r);r<l;r++)if(null!=(s=arguments[r]))for(n in s)e=o[n],i=s[n],o!==i&&(d&&i&&(jQuery.isPlainObject(i)||(t=jQuery.isArray(i)))?(t?(t=!1,a=e&&jQuery.isArray(e)?e:[]):a=e&&jQuery.isPlainObject(e)?e:{},o[n]=jQuery.extend(d,a,i)):void 0!==i&&(o[n]=i));return o},r.cache={},r.browser={};var l=function(e){var t=e.toLowerCase(),i=/(webkit)[ \/]([\w.]+)/,n=/(opera)(?:.*version)?[ \/]([\w.]+)/,s=/(msie) ([\w.]+)/,a=/(mozilla)(?:.*? rv:([\w.]+))?/,o=i.exec(t)||n.exec(t)||s.exec(t)||t.indexOf("compatible")<0&&a.exec(t)||[];return{browser:o[1]||"",version:o[2]||"0"}};if(typeof navigator!==i){var d=l(navigator.userAgent);d.browser&&(r.browser[d.browser]=!0,r.browser.version=d.version),r.browser.crosswalk=/(crosswalk)/.test(navigator.userAgent.toLowerCase())}return r.Native={},r.Controller={},r.View={},r.Model={},"object"==typeof module&&module&&"object"==typeof module.exports&&(module.exports=r),r}();i.logger=function(t){"use strict";for(var i=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],n=i.length,s=e.console=e.console||{},a=null;n--;)a=i[n],s[a]||(s[a]=t.noop);var o={_level:0,_console:s,setLevel:function(e){switch(e){case"debug":this._level=3;break;case"info":this._level=2;break;case"warn":this._level=1;break;case"error":this._level=0;break;default:this._level=-1}},debug:function(){this._level>=3&&this._console.log.apply(this._console,arguments)},info:function(e){this._level>=2&&this._console.info.apply(this._console,arguments)},warn:function(e){this._level>=1&&this._console.warn.apply(this._console,arguments)},error:function(e){this._level>=0&&this._console.error.apply(this._console,arguments)}};return o}(i),i.event.qpTap=function(){var e={};return i.support.touch?(e.mouseDown="touchstart",e.mouseUp="touchend",e.mouseCancel="touchcancel",e.getEventX=function(e){return e.changedTouches[0].clientX},e.getEventY=function(e){return e.changedTouches[0].clientY}):(e.mouseDown="mousedown",e.mouseUp="mouseup",e.mouseCancel="mouseleave",e.getEventX=function(e){return e.clientX},e.getEventY=function(e){return e.clientY}),function(t,n){var s=t,a=e.mouseDown,o=e.mouseUp,r=e.mouseCancel,l=0,d=0,h=0,u=function(t){0===t.which&&1===t.which||(l=(new Date).getTime(),d=e.getEventX(t),h=e.getEventY(t));var a=function(t){if(0!==t.which||1!==t.which){var c=(new Date).getTime(),p=e.getEventX(t),m=e.getEventY(t),g=c-l,v=Math.abs(p-d),f=Math.abs(m-h);i.logger.debug("tap-holdtime",g),g<=350&&v<5&&f<5&&n(t)}s.off(o,"",a),s.off(r,"",u)};s.on(o,"",a);var u=function(e){s.off(o,"",a),s.off(r,"",u)};s.on(r,"",u)};s.on(a,"",u)}}(),function(e,t){"user strict";t.Class={},"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),t.Class.Create=function(){return Object.create(t.Class.ClassUtils)},t.Class.ClassUtils={include:function(e){for(var t in e)this[t]=e[t]},extend:function(e){var t=Object.hasOwnProperty,i=Object.create(this);for(var n in e)(t.call(e,n)||"undefined"==typeof i[n])&&(i[n]=e[n]);return i},proxy:function(e){var t=this;return function(){return e.apply(t,arguments)}},proxyAll:function(e){for(var t=0;t<e.length;t++)this[e[t]]=this.proxy(this[e[t]])}}}(e,i);var n={trigger:function(){var e=Array.prototype.slice.apply(arguments,[0]),t=e.shift();return!(!this._eventHandler||!this._eventHandler[t])&&(this._eventHandler[t].apply(this,e),!0)},bind:function(e,t){if(!this._keys||this._keys.indexOf(e)<=-1)throw new Error("js/events :can not bind undeclared key ："+e);return this._eventHandler||(this._eventHandler={}),this._eventHandler[e]=t,!0},unBind:function(e){delete this._eventHandler[e]},canBindKey:function(e){this._keys=e}};i.Native.InteractAppApi=function(e){var t="undefined"!=typeof AndroidInterface,i="undefined"!=typeof Bridge&&Bridge&&Bridge.callNative,n=t&&i;e.Native.isInteractApp=n;var s="STUDENT",a="TEACHER",o=!1,r=!1,l=!1,d=null,h=function(t,i){try{return Bridge.callNative("com.nd.pad.icr.ui.IcrJsBridge",t,i||{})}catch(n){e.logger.error("mediaplayer call native error",n)}},u=function(){if(n&&!d){var e=h("getCurrentUserInfo",{});e&&(d=e,o=e.userType===s,r=e.userType===a,l=e.isProjector)}},c=function(t){if(n)if(u(),r&&!l){var i=h("setNativeModuleVisibility",{items:[{moduleId:"toolBar",visible:t},{moduleId:"exit",visible:t},{moduleId:"exam",visible:t},{moduleId:"roster",visible:t}]});e.logger.debug(i)}else if(o){var i=h("setPresenterVisibility",{instanceId:"studentDraft",visible:t});e.logger.debug(i)}},p=function(t){if(n&&(u(),o)){var i=h("setPresenterVisibility",{instanceId:"studentDraft",visible:t});e.logger.debug(i)}};return{setNativeModuleVisibility:c,setViewerModuleVisibility:p}}(i),i.lang=function(){var e={media_img_still_loading:"画像読み込み中",media_img_tip:"クリックして画像を見る",media_video_fullscreen:"全画面",media_video_exit_fullscreen:"全画面解除",media_video_not_support_fullscreen:"全画面再生できない"},t={media_img_still_loading:"图片还在加载中",media_img_tip:"点击查看图片",media_video_fullscreen:"全屏",media_video_exit_fullscreen:"退出全屏",media_video_not_support_fullscreen:"不支持全屏播放"},i={media_img_still_loading:"Still loading image",media_img_tip:"Click to view",media_video_fullscreen:"Full screen",media_video_exit_fullscreen:"Exit",media_video_not_support_fullscreen:"Full screen playback not supported"},n={media_img_still_loading:"圖片還在加載中",media_img_tip:"點擊查看圖片",media_video_fullscreen:"全屏",media_video_exit_fullscreen:"退出全屏",media_video_not_support_fullscreen:"不支持全屏播放"},s={zh:t,zh_cn:t,zh_hk:n,hk:n,en:i,en_us:i,ja:e,ja_jp:e};return{getLangText:function(e,t,i){e=e.toLowerCase();var n=s[e]?s[e]:s.zh,a=n[t]||"";return a}}}(),i.Controller.MediaPlayer=function(e,i){var s=i.Class.Create();return s.include(n),s.include({create:function(e,t,n){var s=Object.create(this);s.timeFormat="0:00",s.$container=e,s.mouseMoveCount=0,s.options=t,s._mediaModel=i.Model.MediaModel.create(e.find(n));var a=["playPause","_progress","_progressMouseup","_volumeToggle","_volumeProgress","_volumeProgressMouseup","_volumeMutedToggle","_volumeShow","_volumeHide"];return s.proxyAll(a),s.canBindKey(["playTrigger","ended","pause","unBind","volumeToggle"]),s},getMediaModel:function(){return this._mediaModel},__Q:function(e){return this.$container.find(e)},baseInit:function(){var e=this.getMediaModel().getQMedia();this.getMediaModel().setPreLoad(this.options.mediaPreload?"auto":"none"),e.removeAttr("controls"),this._iePreloadNone()&&(e.attr("data-src",e.attr("src")),e.removeAttr("src")),this._findElement(),this._eventModel=i.Model.MediaEvent.create(this._mediaModel,this.options),this._mediaEventHandler(),this._toolBarEvent(!0),i.support.isiOS&&(this._$volumeIconContainer.hide(),this.__Q(".qp-time-base").css("right","12px"))},_toolBarEvent:function(e){var n=this;e=e?"on":"off",n._$play[e]("click",n.playPause),n._updateVolumeEntryView(n.getMediaModel().getVolume(),!1),n._$mediaBox[e]("click",function(e){i.event.stopPropagation(e)}),n._$progress[e]("touchstart mousedown",n._progress),n._$progress[e]("touchend touchcancel mouseup",n._progressMouseup),n._$volumeControl[e]("mousedown touchstart",n._volumeProgress),n._$volumeControl[e]("mouseup touchend touchcancel",n._volumeProgressMouseup),n._$volumeIconContainer[e]("mouseout mouseleave",n._volumeHide),i.support.touch?n._$volumeIcon[e]("click",n._volumeToggle):("ontouchend"in t?n._$volumeIcon[e]("click",n._volumeToggle):n._$volumeIcon[e]("click",n._volumeMutedToggle),n._$volumeIconContainer[e]("mouseover",n._volumeShow))},_iePreloadNone:function(){return!(this.options.mediaPreload||!i.browser.msie)},iePreloadResetSrc:function(){if(this._iePreloadNone()&&!this._resetSrc){this._resetSrc=!0;var e=this.getMediaModel().getQMedia();e.attr("src",e.attr("data-src"))}},_findElement:function(){var e=this,t={_$loading:'[data-oper="loading"]',_$play:'.qp-media-toolbar [data-oper="play"]',_$playInBody:'.qp-media-box>[data-oper="play"]',_$endTime:'[data-oper="endTime"]',_$currentTime:'[data-oper="curentTime"]',_$downedBar:'[data-oper="downed-bar"]',_$playedBar:'[data-oper="played-bar"]',_$progress:'[data-oper="progress"]',_$volumeIconContainer:'[data-oper="volume-icon-container"]',_$volumeIcon:'[data-oper="volume-icon"]',_$volumeControl:'[data-oper="volume-control"]',_$volumeBarContainer:'[data-oper="volume-bar-container"]',_$volumeBarR:'[data-oper="volume-bar-r"]',_$volumeBarS:'[data-oper="volume-bar-s"]',_$toolbar:'[data-oper="toolbar"]',_$mediaBox:'[data-oper="media-box"]',_$mediaDisable:'[data-oper="media-disable"]'};for(var i in t)e[i]=e.__Q(t[i])},clear:function(){try{this._mediaModel.load(),this._eventModel.mediaEventListener(!1),this.trigger("unBind")}catch(e){i.logger.debug("clear",e)}},unBind:function(){try{this._eventModel.mediaEventListener(!1),this.trigger("unBind")}catch(e){i.logger.debug("unbind",e)}},destroy:function(){this.unBind()},reset:function(){this.pause()},setLock:function(e){this.options.lock=e,e?this._$mediaDisable.show():this._$mediaDisable.hide()},isLock:function(){return this.options.lock},changeVolume:function(e,t){this._mediaModel.setVolume(e),t?(this._$volumeControl.show(),this.trigger("volumeToggle",!0)):(this._$volumeControl.hide(),this.trigger("volumeToggle",!1))},hideVolumeControl:function(){this._$volumeControl.isShow()&&(this._$volumeControl.hide(),this.trigger("volumeToggle",!1),this._eventModel.volumeChangeEvent(!1))},isPlaying:function(){return this._mediaModel.isPlaying()},playPause:function(e){this.trigger("playTrigger"),this.iePreloadResetSrc();var t=this._mediaModel.getMedia();t.paused?(this._$play.addClass("qp-btn-stop"),this._$playInBody.addClass("qp-btn-stop"),t.play()):(this._$play.removeClass("qp-btn-stop"),this._$playInBody.removeClass("qp-btn-stop"),t.pause())},pause:function(){var e=this._mediaModel.getMedia();this.options.renderUI&&(this._$play.removeClass("qp-btn-stop"),this._$playInBody.removeClass("qp-btn-stop")),e&&!e.paused&&e.pause()},play:function(e){this.trigger("playTrigger",e),this.iePreloadResetSrc();var t=this._mediaModel.getMedia();this.options.renderUI&&(this._$play.addClass("qp-btn-stop"),this._$playInBody.addClass("qp-btn-stop")),t&&t.paused&&t.play()},_mediaEventHandler:function(){var e=this;if(e.options.renderUI){var t={playing:function(){e.trigger("playTrigger"),e.iePreloadResetSrc(),e._$play.addClass("qp-btn-stop"),e._$playInBody.addClass("qp-btn-stop")},pause:function(){e.trigger("pause"),e._$play.removeClass("qp-btn-stop"),e._$playInBody.removeClass("qp-btn-stop")},ended:function(){e.trigger("ended"),e._$play.removeClass("qp-btn-stop"),e._$playInBody.removeClass("qp-btn-stop"),e._$loading.hide(),e._$currentTime.text(e.timeFormat),e._$playedBar.css("width","0%"),e._$downedBar.css("width","0%")},timeupdate:function(){return!(e._mediaModel.getReadyState()<3)&&(e._$loading.hide(),e._updateEndTime(),e._updateVideoData(),void e._updateCurrentTime())},volumechange:function(){e._updateVolumeEntryView(e._mediaModel.getVolume(),!0)},progress:function(){for(var t=e._mediaModel.getCurrentTime(),i=e._mediaModel.getDuration(),n=e._mediaModel.getBuffered(),s=0,a=0;a<n.length;a++){var o=n.end(a);o>t&&(s?s>o&&(s=o):s=o)}s||(s=t);var r=s/i*100;r>100&&(r=0),e._$downedBar.css("width",r+"%"),e._updateEndTime()},waiting:function(){e._$loading.show()},error:function(e){},loadedmetadata:function(){e._updateEndTime()},play:function(){e._mediaModel.getCurrentTime()<=0&&e._$loading.show()},durationchange:function(){var t=e._mediaModel.getDuration();t<1&&t>0&&e._$currentTime.text(e.timeFormat),e._updateEndTime()}};for(var i in t)this._eventModel.bind(i,t[i])}},_updateEndTime:function(){var e=this._mediaModel.getDuration();e>0&&(!this.durationInit||this.durationInitDuration!==e)&&(e>=3600||e<1?this._$toolbar.addClass("qp-progress-long"):this._$toolbar.removeClass("qp-progress-long"),this._$endTime.text(this._formatTime(e)),this.durationInit=!0,this.durationInitDuration=e)},_progress:function(e){var t=this._$progress,n=this._mediaModel.getMedia();if(t.length>0){var s=this;e&&s._coordinate(e)&&s._seekTo(s._coordinate(e).pageX,t,n,!0);var a=function(e){e&&i.event.preventDefault(e),s._seekTo(s._coordinate(e).pageX,t,n)};t.on("mousemove  touchmove","",a);var o=function(e){i.event.preventDefault(e),i.event.stopPropagation(e),t.off("mousemove touchmove","",a),t.off("mouseup mouseleave touchend touchcancel","",o)};t.on("mouseup mouseleave touchend touchcancel","",o)}},_progressMouseup:function(e){var t=this._$progress,i=this._mediaModel.getMedia(),n=this;n._seekTo(n._coordinate(e).pageX,t,i,!0)},_updateVolumeEntryView:function(e,t){var i=this,n=this._mediaModel.getMuted();i._$volumeBarR.css("bottom",parseInt(n?0:100*e)+"%"),i._$volumeBarS.css("height",(0===parseInt(n?0:100*e)?.5:parseInt(n?0:100*e))+"%"),0===e||n?i._$volumeIcon.addClass("qp-btn-volume-no"):i._$volumeIcon.removeClass("qp-btn-volume-no")},_volumeToggle:function(e){var t=this;if(this._volumeClick=!0,setTimeout(function(){t._volumeClick=!1},100),e.srcElement){var n=i(e.srcElement).closest(".qp_video-progress-box");if(n&&n.get(0)===this._$volumeControl.get(0))return}this._$volumeControl.toggle();var s=this._$volumeControl.isShow();this.trigger("volumeToggle",s),this._eventModel.volumeChangeEvent(s)},_volumeMutedToggle:function(e){this._mediaModel.setMuted(!this._mediaModel.getMuted()),this._updateVolumeEntryView(this._mediaModel.getVolume())},_volumeShow:function(e){if(i.event.checkHover(e,this._$volumeIconContainer.get(0))){if(e&&"mouseover"===e.type&&e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents)return;this._$volumeControl.show(),this.trigger("volumeToggle",!0),this._eventModel.volumeChangeEvent(!0)}},_volumeHide:function(e){i.event.checkHover(e,this._$volumeIconContainer.get(0))&&(this._$volumeControl.hide(),this.trigger("volumeToggle",!1),this._eventModel.volumeChangeEvent(!1))},_volumeProgress:function(e){if(!this._volumeClick){var t=this._$volumeControl,n=this._mediaModel.getMedia();if(t.length>0){var s=this;s.volumeUp=!1,this._mediaModel.setMuted(!1),s._coordinate(e)&&s._volumeSeekTo(s._coordinate(e).pageY,n,!0);var a=function(e){i.event.preventDefault(e),s._coordinate(e)&&s._volumeSeekTo(s._coordinate(e).pageY,n)};t.on("mousemove  touchmove","",a);var o=function(e){i.event.preventDefault(e),s.volumeUp=!0,t.off("mousemove touchmove","",a),t.off("mouseup mouseleave touchend touchcancel","",o)};t.on("mouseup mouseleave touchend touchcancel","",o)}}},_volumeProgressMouseup:function(e){if(!this._volumeClick){var t=this._mediaModel.getMedia();this.volumeUp=!0,this._eventModel.volumeChangeEvent(!0,!0);var i=this;i._coordinate(e)&&i._volumeSeekTo(i._coordinate(e).pageY,t)}},_updateCurrentTime:function(){var e=this._mediaModel.getCurrentTime();this._$currentTime.html(this._formatTime(e))},_updateVideoData:function(){var e=this._mediaModel.getCurrentTime(),t=this._mediaModel.getDuration(),i=this._$playedBar;if(.01===e)i.css("width","0%");else{var n=100*e/t;i.css("width",n+"%")}},_seekTo:function(e,t,i,n){var s=this._mediaModel.getDuration();if(s>0){var a=this._$playedBar,o=Math.max(0,Math.min(1,(e-t.offset().left/this.getScale())/t.width())),r=o*s;this.mouseMoveCount++,(this.mouseMoveCount%10===0||n)&&r>=0&&this._mediaModel.setCurrentTime(r);var l=Math.round(o*t.width());a.css("width",l+"px"),this._updateCurrentTime()}},_volumeSeekTo:function(e){var t=this._$volumeBarContainer,i=Math.max(0,Math.min(1,(e-t.offset().top/this.getScale())/t.height()));this._mediaModel.setVolume(1-i)},_coordinate:function(e){var t={},i=this.getScale();switch(e.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return t.pageX=(e.changedTouches[0].pageX||e.touches[0].pageX)/i,t.pageY=(e.changedTouches[0].pageY||e.touches[0].pageY)/i,t;default:return t.pageX=e.pageX/i,t.pageY=e.pageY/i,t}},_formatTime:function(e){var t=Math.floor(e/3600),i=Math.floor(e/60)%60,n=Math.floor(e-60*i-60*t*60);60===n&&(n=0,i+=1),n<10&&(n="0"+n);var s=this._mediaModel.getDuration();return s>0&&s<1?e>0?"0:01":"0:00":t>0?t+":"+i+":"+n:i+":"+n},getScale:function(){return this.scaleX=this.$container.get(0).getBoundingClientRect().width/this.$container.get(0).offsetWidth||1,this.scaleX},mediaPlay:function(e){this.play()},mediaPause:function(e){this.pause()},mediaSkip:function(e){this._mediaModel.setCurrentTime(0===e?.01:e)},mediaVolumeChange:function(e,t){this.changeVolume(e,t)}}),s}(e,i),function(e,t){function i(e){return e=e||{},this.each(function(){var i=t(this),n=i.data("my.mediaplayer"),a=t.extend({},i.data()||{},"object"==typeof e&&e);n||(n=s.create(i,a),i.data("my.mediaplayer",n))})}var n={onEnd:!1,onPause:!1,lang:"zh",onPlay:!1,onSeek:!1,onVolumeChange:!1,onTimeUpdate:!1,onlyRender:!1,renderUI:!0,audio:{width:0,height:0}},s=t.Controller.MediaPlayer.extend({create:function(e,i){var s=t.Controller.MediaPlayer.create.apply(this,[e,t.extend({},n,i),"audio"]);if(s.options=t.extend({},n,i),s.options.renderUI){var a=["_playTriggerHandler","_endedHandler"];s.proxyAll(a),s._init(),s.options.onlyRender===!1&&s.start(),s.bind("playTrigger",s._playTriggerHandler),s.bind("ended",s._endedHandler)}return s},_resizeMap:{"qp-media-box-mini":function(e,t){return e<=200||t<=60},"qp-media-box-min-height":function(e,t){return t<=180&&t>125},"qp-media-box-min-height-audio-s":function(e,t){return t<=125&&t>60},"qp-media-box-max-hd":function(e,t){return e>360&&t>270}},_playTriggerHandler:function(){},_endedHandler:function(){},start:function(){var e=this;e.started||(e.started=!0,this.baseInit(),this._controlEvent(!0))},_init:function(){var e=this.getMediaModel().getQMedia();try{if(e.before(t.View.audioHtml),this.__Q('[data-oper="loading"] ').before(e.get(0)),this._$qpVideoWrap=this.__Q(".qp-video-videowrap"),this._$qpMediaIcon=this.__Q(".qp-media-icons-right"),this.options.autoAdaptSize){var i=this.options.audio.width,n=this.options.audio.height;i&&n&&this.resizeMedia(i,n)}}catch(s){throw new Error("createHtml unknow error:"+s.message)}},resizeMedia:function(e,t){this._$mediaBox||(this._$mediaBox=this.__Q(".qp-media-box"));var i=e,n=t,s=!1;for(var a in this._resizeMap)this._resizeMap[a](e,t)?(s?this._$mediaBox.removeClass(a):this._$mediaBox.addClass(a),s||"qp-media-box-mini"===a&&(this._$mediaBox.addClass(a),s=!0,i=0,n=0),"qp-media-box-min-height-audio-s"===a&&(n=40)):this._$mediaBox.removeClass(a);this._$mediaBox.css("width",i+"px"),this._$mediaBox.css("height",n+"px")},_controlEvent:function(e){var t=this;e=e?"on":"off",t._$playInBody[e]("click",t.playPause)}});t.fn("audioplayer",i)}(e,i),function(e,t){var i={renderUI:!0,lang:"zh",img:{renderImmediately:!1,src:"",width:0,height:0},onlyRender:!1},n=t.Class.Create();n.include({create:function(e,n){var s=Object.create(this);s.$container=e;var a={src:n.img.src?n.img.src:e.find("img").attr("src"),width:0,height:0};s.imgData=a,s.options=t.extend({},i,n),s.options.autoAdaptSize&&s.options.img.width&&s.options.img.height&&(s.options.img.width<s._minRenderWidth&&(s.options.img.width=s._minRenderWidth),s.options.img.height<s._minRenderHeight&&(s.options.img.height=s._minRenderHeight)),s.viewer=null;var o=["_createViewer"];return s.proxyAll(o),s._init(),s},__Q:function(e){return this.$container.find(e)},_defaultRenderHeight:180,_defaultRenderWidth:260,_minRenderHeight:100,_minRenderWidth:130,_loadImg:function(e){var t=this,i=new Image;i.src=t.imgData.src,i.complete?(t.imgData.width=i.width,t.imgData.height=i.height,e&&e()):i.onload=function(){t.imgData.width=i.width,t.imgData.height=i.height,e&&e(),i.onload=null}},_init:function(){var e=this;if(e.options.renderUI)e.options.img.renderImmediately?(e._createHtml(),e._loadImg(),e._controlEvent()):e._loadImg(function(){var t=!1;e.options.autoAdaptSize&&e.options.img.width&&e.options.img.height&&(e.imgData.width>e.options.img.width||e.imgData.height>e.options.img.height)?t=!0:(e.imgData.width>e._defaultRenderWidth||e.imgData.height>e._defaultRenderHeight)&&(t=!0),t&&(e._createHtml(),e._controlEvent())});else{e._loadImg();var t=this.__Q("img");t.on("qpTap",function(t){e.imgData.width&&e._createViewer()})}},start:function(){this.options.onlyRender=!1},_createHtml:function(){var e=this.__Q("img");e.removeAttr(["width","height","style"]);try{e.before(t.View.imageHtml),this.__Q(".qp-media-pics-bg").get(0).appendChild(e.get(0)),this.__Q(".qp-media-toolbar").text(t.lang.getLangText(this.options.lang,"media_img_tip")),this.__Q(".qp-meida-tip-message").text(t.lang.getLangText(this.options.lang,"media_img_still_loading")),this.options.autoAdaptSize&&this.options.img.width&&this.options.img.height&&this.resizeMedia(this.options.img.width,this.options.img.height)}catch(i){throw new Error("createHtml unknow error:"+i.message)}},_controlEvent:function(){var e=this;this._$tipMessage=this.__Q(".qp-meida-tip-message"),e.__Q(".qp-media-box").on("click",function(i){if(i&&t.event.stopPropagation(i),!e.options.onlyRender&&!e.options.lock)return e.imgData.width?void e._createViewer():(clearTimeout(e._msgTimeoutId),e._$tipMessage.show(),void(e._msgTimeoutId=setTimeout(function(){e._$tipMessage.hide()},3e3)))})},resizeMedia:function(e,t){e<this._minRenderWidth&&(e=this._minRenderWidth),t<this._minRenderHeight&&(t=this._minRenderHeight),this._$mediaBox||(this._$mediaBox=this.__Q(".qp-media-box")),this._$picsBg||(this._$picsBg=this.__Q(".qp-media-pics-bg")),this._$image||(this._$image=this.__Q(".qp-media-pics-bg img")),this._$mediaBox.css("width",e+"px"),this._$mediaBox.css("height",t+"px"),this._$picsBg.css("width",e+"px"),this._$picsBg.css("height",t+"px"),this._$image.css("maxWidth",e+"px"),this._$image.css("maxHeight",t+"px")},_createViewer:function(){var e=this;if(!e.viewer){var i=e.options.onFullScreenChange||e.options.eventHandler.fullScreenChange;e.viewer=t.Controller.ImageViewer.create(e.$container,e.imgData.width,e.imgData.height,e.imgData.src,i)}e.viewer.show()},destroy:function(){this.viewer&&this.viewer.hide()},reset:function(){this.viewer&&this.viewer.hide()},setLock:function(e){this.options.lock=e}})}(e,i),function(e,i){function n(e){return e=e||{},this.each(function(){var t=i(this),n=t.data("my.mediaplayer"),s=i.extend({},t.data()||{},"object"==typeof e&&e);n||(n=a.create(t,s),t.data("my.mediaplayer",n))})}var s={onEnd:!1,onPause:!1,onPlay:!1,onSeek:!1,onVolumeChange:!1,onTimeUpdate:!1,onlyRender:!1,autoAdaptSize:!1,renderUI:!0,lang:"zh",video:{render:!0,width:0,height:0,supportFullscreen:!0,showPlayBtnInVideo:!1,showFullscreenBtn:!1}},a=i.Controller.MediaPlayer.extend({create:function(e,t){var n=i.Controller.MediaPlayer.create.apply(this,[e,i.extend({},s,t),"video"]);if(n.options=i.extend({},s,t),n.options.renderUI){var a=["_mediaBoxToggle","_volumeToggleEventHandler","_pauseEventHandler","_unBind","_toFullScreen","_touchControlToggle","_playTriggerHandler","_endedHandler","_fullScreenChangeHandler","_playInVideoHanlder","_fullScreenClickHandler","_pcControlToggle"];n.proxyAll(a),n._init(),n.options.onlyRender===!1&&n.start(),n.bind("playTrigger",n._playTriggerHandler),n.bind("ended",n._endedHandler),n.bind("unBind",n._unBind),n.bind("pause",n._pauseEventHandler),n.bind("volumeToggle",n._volumeToggleEventHandler)}return n},_pauseEventHandler:function(){clearTimeout(this._timeOutId),this._$mediaBox.removeClass("qp-media-playing"),this._supportFullScreen()||(this._$playInBody.hide(),this._$qpIconsVideo.hide()),this.$container.removeClass("qp-media-auto-hide")},_autoHide:function(e){var t=this;clearTimeout(t._timeOutId),t._timeOutId=setTimeout(function(){(t.isPlaying()||e)&&t.$container.addClass("qp-media-auto-hide")},i.support.touch?5500:2e3)},_volumeToggleEventHandler:function(e){e?this._$goFullscreen.addClass("qp-bar-cover-index"):this._$goFullscreen.removeClass("qp-bar-cover-index")},_unBind:function(){this._exitFull(),this.pause(),this._fullScreenCallBack(!1)},_resizeMap:{"qp-media-box-min-width":function(e,t,i){return!!i&&(e<=160&&e>120)},"qp-media-box-min-width-s":function(e,t,i){return!!i&&e<=120},"qp-media-box-min-height":function(e,t,i){return!!i&&(t<=180&&t>125)},"qp-media-box-min-height-s":function(e,t,i){return!!i&&t<=125},"qp-media-box-max-hd":function(e,t,i){return e>360&&t>270},"qp-media-box-not-surpot-full-min":function(e,t,i){if(!i&&e<240&&e>=200)return!0;
},"qp-media-box-not-surpot-full-min-s":function(e,t,i){if(!i&&e<200)return!0},"qp-media-box-max-fullscreen":function(){return!1}},_playTriggerHandler:function(){this._autoHide(),this._$mediaBox.addClass("qp-media-playing"),this._supportFullScreen()||(this._$playInBody.hide(),this._$qpIconsVideo.hide())},_endedHandler:function(){clearTimeout(this._timeOutId),this._$mediaBox.removeClass("qp-media-playing"),this.$container.removeClass("qp-media-auto-hide"),this._supportFullScreen()||(this._$playInBody.hide(),this._$qpIconsVideo.hide(),this.options.video.showPlayBtnInVideo&&this._$playInBody.show(),this.options.video.showFullscreenBtn||this._$qpIconsVideo.show())},_init:function(){this._fullScreen=!1,this._createVideo(),this._$goFullscreen=this.__Q('[data-oper="go-fullscreen"]'),this._$exitFullscreen=this.__Q('[data-oper="exit-fullscreen"]'),this._$fullScreenMessage=this.__Q(".qp-meida-tip-message"),this._$qpIconsVideo=this.__Q(".qp-icons-video"),this._$qpVideoWrap=this.__Q(".qp-video-videowrap"),this._$toolbarCover=this.__Q(".qp-media-toolbar-cover"),this._supportFullScreen()||this.options.video.showPlayBtnInVideo||this.__Q('.qp-media-box>[data-oper="play"]').hide(),i.browser.crosswalk&&this._$qpVideoWrap.css("zIndex","-1")},start:function(){var e=this;e.started||(e.started=!0,this.baseInit(),this._controlEvent(!0),this._fullScreenCallBack(!0))},_createVideo:function(){var e=this.getMediaModel().getQMedia();try{if(e.before(i.View.videoHtml),this.__Q(".qp-btn-exit-fullscreen").text(i.lang.getLangText(this.options.lang,"media_video_exit_fullscreen")),this.__Q(".qp-btn-to-fullscreen").text(i.lang.getLangText(this.options.lang,"media_video_fullscreen")),this.__Q(".qp-meida-tip-message").text(i.lang.getLangText(this.options.lang,"media_video_not_support_fullscreen")),this.__Q('[data-oper="loading"] ').before(e.get(0)),e.css("width","100%"),e.css("height","100%"),this._supportFullScreen()||this.__Q(".qp-media-box").addClass("qp-media-not-support-full"),this.options.video.showFullscreenBtn&&this._fullScreenEnabled()&&this.__Q(".qp-media-box").addClass("qp-media-show-fullscreen-btn"),this.options.autoAdaptSize){var t=this.options.video.width,n=this.options.video.height;t||n||(t=this.getMediaModel().getWidth(),n=this.getMediaModel().getHeight()),this.resizeMedia(t,n)}}catch(s){throw new Error("createVideo unknow error:"+s.message)}},resizeMedia:function(e,t){this._$mediaBox||(this._$mediaBox=this.__Q(".qp-media-box")),this._$mediaBox.css("width",e+"px"),this._$mediaBox.css("height",t+"px");for(var i in this._resizeMap)this._resizeMap[i](e,t,this._supportFullScreen())?this._$mediaBox.addClass(i):this._$mediaBox.removeClass(i)},_pcControlToggle:function(e){var t=this;if(t._lastX!==e.pageX||t._lastY!==e.pageY){if(t._lastX=e.pageX,t._lastY=e.pageY,clearTimeout(t._timeOutId),t._supportFullScreen()&&!t._isFullScreen())return!1;var n="show";switch(e.type){case"mousemove":n="show";break;case"mouseout":case"mouseleave":i.event.checkHover(e,t._$mediaBox.get(0))&&(n=t.isPlaying()?"hide":"show")}"show"===n?t.$container.removeClass("qp-media-auto-hide"):t.$container.addClass("qp-media-auto-hide");var s=!0;"mousemove"!==e.type&&"mouseover"!==e.type||((t._$toolbar.contains(e.srcElement)||e.srcElement===t._$toolbar.get(0))&&(s=!1),e.srcElement===t._$goFullscreen.get(0)&&(s=!1)),s&&t._autoHide()}},_touchControlToggle:function(e){if(!(e&&e.srcElement&&e.srcElement.className.indexOf("qp-media-toolbar-cover")<=-1)){clearTimeout(this._timeOutId);var t=this;if(t._supportFullScreen()&&!t._isFullScreen())return!1;var i=t.isPlaying();i?t.$container.toggleClass("qp-media-auto-hide"):this.play(),this._autoHide()}},_mediaBoxToggle:function(e){var t=this;e&&i.event.stopPropagation(e);var n=!0;(t._$toolbar.contains(e.srcElement)||e.srcElement===t._$toolbar.get(0))&&(n=!1),n?t._autoHide():clearTimeout(t._timeOutId)},_controlEvent:function(e){var t=this;e=e?"on":"off",t._$exitFullscreen[e]("click",t._toFullScreen),t._$goFullscreen[e]("click",t._toFullScreen),t._$playInBody[e]("click",t._playInVideoHanlder),i.support.touch?(t._$toolbarCover[e]("click",t._touchControlToggle),t._$mediaBox[e]("click",t._mediaBoxToggle)):(t._$mediaBox[e]("mousemove mouseover mouseout",t._pcControlToggle),t._$toolbarCover[e]("click",t._fullScreenClickHandler))},_fullScreenClickHandler:function(e){e&&e.srcElement&&e.srcElement.className.indexOf("qp-media-toolbar-cover")<=-1||(this._supportFullScreen()&&this._isFullScreen()||!this._supportFullScreen())&&this.playPause(e)},_playInVideoHanlder:function(e){this._supportFullScreen()&&!this._isFullScreen()?this._toFullScreen():this.playPause(e)},_exitFull:function(){t.exitFullscreen?t.exitFullscreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen&&t.mozCancelFullScreen();var e=t.getElementsByTagName("video");if(e&&e.length>0)for(var i=0;i<e.length;i++){var n=e[i];n.webkitExitFullscreen&&n.webkitExitFullscreen()}},_toFullScreen:function(e){e&&i.event.preventDefault(e);var t=this;if(!t._fullScreenEnabled())return clearTimeout(t._fullMsgTimeoutId),t._$fullScreenMessage.show(),void(t._fullMsgTimeoutId=setTimeout(function(){t._$fullScreenMessage.hide()},3e3));var n=t._$mediaBox.get(0);if(this._isFullScreen())this.pause(),this._exitFull();else{var s=n.requestFullscreen||n.webkitRequestFullscreen||n.mozRequestFullScreen||n.msRequestFullscreen;"undefined"!=typeof s&&s?s.call(n):i.logger.error("Fullscreen API is not supported"),this.play(),this.$container.addClass("qp-media-auto-hide"),this._$mediaBox.addClass("qp-media-playing"),clearTimeout(t._fullTimeOutId),t._fullTimeOutId=setTimeout(function(){t._fullScreen||t._fullScreenChangeEnable||(t._fullScreenChangeEnable=!1,t._unSurportFullApi())},i.support.isMobile?1e3:250)}},_fullScreenCallBack:function(e){var n=this._$mediaBox.get(0);e=e?"on":"off",i.browser.webkit?i(t)[e]("webkitfullscreenchange",this._fullScreenChangeHandler):i.browser.mozilla?i(t)[e]("mozfullscreenchange",this._fullScreenChangeHandler):i.browser.msie&&(n.requestFullscreen?i(t)[e]("fullscreenchange",this._fullScreenChangeHandler):n.msRequestFullscreen&&i(t)[e]("MSFullscreenChange",this._fullScreenChangeHandler))},_unSurportFullApi:function(){this.__Q(".qp-media-box").addClass("qp-media-not-support-full")},_fullScreenChangeHandler:function(e){if(i.browser.msie){if(e.target.activeElement!==this._$mediaBox.get(0))return}else if(e.srcElement!==this._$mediaBox.get(0))return;this._isFullScreen()?(this._fullScreen=!0,this._fullScreenChangeEnable=!0,this._$mediaBox.attr("original-style",this._$mediaBox.attr("style")),this._$mediaBox.attr("style",""),this._$mediaBox.attr("original-class",this._$mediaBox.attr("class")),this._$mediaBox.attr("class",""),this._$mediaBox.addClass("qp-media-box"),this._$mediaBox.addClass("qp-media-box-max-fullscreen"),this.$container.addClass("qp-media-fullscreen"),this.$container.addClass("qp-media-fullscreen-bar-show"),i.Native.InteractAppApi.setNativeModuleVisibility(!1),this.options.onFullScreenChange?this.options.onFullScreenChange(!0):this.options.eventHandler.fullScreenChange&&this.options.eventHandler.fullScreenChange(!0)):(this._fullScreen=!1,this.pause(),this.$container.removeClass("qp-media-fullscreen"),this._$mediaBox.attr("original-style")&&this._$mediaBox.attr("style",this._$mediaBox.attr("original-style")),this._$mediaBox.attr("original-class")&&this._$mediaBox.attr("class",this._$mediaBox.attr("original-class")),this.$container.removeClass("qp-media-fullscreen-bar-show"),this.$container.removeClass("qp-media-auto-hide"),this._$mediaBox.removeClass("qp-media-playing"),i.Native.InteractAppApi.setNativeModuleVisibility(!0),this.hideVolumeControl(),this._$loading.hide(),this.options.onFullScreenChange?this.options.onFullScreenChange(!1):this.options.eventHandler.fullScreenChange&&this.options.eventHandler.fullScreenChange(!1))},_isFullScreen:function(){return t.webkitIsFullScreen},_fullScreenEnabled:function(){return!(location.search.toLowerCase().indexOf("sys=pptshell")>=0&&!i.support.isMobile)&&(this._fullScreenChangeEnable!==!1&&(t.webkitFullscreenEnabled||t.msFullscreenEnabled||t.mozFullScreenEnabled))},_supportFullScreen:function(){return this.options.video.supportFullscreen&&this._fullScreenEnabled()},reset:function(){this._exitFull(),this.pause()}});i.fn("videoplayer",n)}(e,i),i.Controller.ImageViewer=function(){var n=i.Class.Create();return n.include({create:function(e,t,i,n,s){var a=Object.create(this);return a._imgData={width:t,height:i,src:n},a.$container=e,a.proxyAll(["hide","stopImgPropagation"]),a.fullScreenChange=s,a},stopImgPropagation:function(e){i.event.preventDefault(e),i.event.stopPropagation(e)},show:function(){var n=this,s=i(".qp-media-viewer-temp");s.length>0&&s.remove(),i(t.body).addClass("qp-media-viewer-over-hidden");var a=i(t.body),o=t.createElement("div");i(o).attr("class","qp-media-viewer-temp"),a.appendChild(o);var s=i(".qp-media-viewer-temp");s.html(i.View.viewerHtml);var r=i(".qp_media_window_mask"),l=i(".qp-media-viewer-img"),d=i(".qp-media-viewer-close"),h=i(".qp-media-viewer-img img"),u=i(".qp-media-viewer-center");n._maxHeight=.8*e.innerHeight,n._maxWidth=.8*e.innerWidth;var c=i.utils.resize(n._imgData.width,n._imgData.height,n._maxWidth,n._maxHeight);l.css("marginLeft","-"+c.w/2+"px"),l.css("marginTop","-"+c.h/2+"px"),l.css("width",c.w+"px"),l.css("height",c.h+"px"),h.attr("src",n._imgData.src),h.attr("width",c.w),h.attr("height",c.h),r.show(),u.show(),d.on("click",n.hide),r.on("click",n.hide),h.on("click",n.hide),i.Native.InteractAppApi.setViewerModuleVisibility(!1),n.fullScreenChange&&n.fullScreenChange(!0)},hide:function(e){e&&(i.event.preventDefault(e),i.event.stopPropagation(e));var n=i(".qp-media-viewer-temp");n.length>0&&n.remove(),i(t.body).removeClass("qp-media-viewer-over-hidden"),i.Native.InteractAppApi.setViewerModuleVisibility(!0),this.fullScreenChange&&this.fullScreenChange(!1)}}),n}(),i.Model.MediaEvent=function(e,t){var i=t.Class.Create();return i.include(n),i.include({eventMethod:["playing","pause","ended","timeupdate","seeked","volumechange","progress","waiting","error","loadstart","loadeddata","loadedmetadata","stalled","suspend","play","durationchange"],create:function(e,t){var i=Object.create(this);return i._mediaModel=e,i.options=t,i.proxyAll(i.eventMethod),i.canBindKey(["playing","pause","ended","timeupdate","volumechange","progress","waiting","error","loadedmetadata","play","durationchange"]),i.mediaEventListener(!0),i},mediaEventListener:function(e){var t=this,i=t._mediaModel.getQMedia(),n=t.eventMethod;t.emptied=!0;for(var s=0;s<n.length;s++)i[e?"on":"off"](n[s],"",t[n[s]])},playing:function(){var e=this;e.trigger("playing"),e.emptied=!1;var t={mediaId:e._mediaModel.getId(),index:e.options.index,mediaType:e._mediaModel.getMediaType()};e.options._onPlay&&e.options._onPlay(t),e.options.onPlay?e.options.onPlay(t):e.options.eventHandler&&e.options.eventHandler.play(t)},pause:function(){var e=this;e.trigger("pause");var t={mediaId:e._mediaModel.getId(),index:e.options.index,mediaType:e._mediaModel.getMediaType(),ended:!!e._ended};e.options.onPause?e.options.onPause(t):e.options.eventHandler&&e.options.eventHandler.pause(t),e._ended=!1},emptied:function(){this.emptied=!0},ended:function(){var e=this;e._mediaModel.load(),e._mediaModel.resetPoster(),e.trigger("ended");var t={mediaId:e._mediaModel.getId(),index:e.options.index,mediaType:e._mediaModel.getMediaType()};e.options._onEnd&&e.options._onEnd(t),e.options.onEnd?e.options.onEnd(t):e.options.eventHandler&&e.options.eventHandler.ended(t);var i={mediaId:e._mediaModel.getId(),index:e.options.index,mediaType:e._mediaModel.getMediaType(),currentTime:0};e.options.onTimeUpdate?e.options.onTimeUpdate(i):e.options.eventHandler&&e.options.eventHandler.timeupdate(i),e.playing=!1},timeupdate:function(){var e=this;e.trigger("timeupdate");var t=e._mediaModel.getCurrentTime(),i={mediaId:e._mediaModel.getId(),index:e.options.index,mediaType:e._mediaModel.getMediaType(),currentTime:t};e.options.onTimeUpdate?e.options.onTimeUpdate(i):e.options.eventHandler&&e.options.eventHandler.timeupdate(i);var n=e._mediaModel.getDuration();n>0&&n<=t&&t>0&&(e._ended=!0)},seeked:function(){var e=this,t={mediaId:e._mediaModel.getId(),index:e.options.index,mediaType:e._mediaModel.getMediaType(),seeked:e._mediaModel.getCurrentTime(),ended:!1};e.options.onSeek?e.options.onSeek(t):e.options.eventHandler&&e.options.eventHandler.seeked(t)},volumechange:function(){var e=this;e.trigger("volumechange"),e.volumeChangeEvent(!0)},progress:function(){this.trigger("progress")},waiting:function(){this.trigger("waiting")},error:function(){var e=this._mediaModel.getError()?this._mediaModel.getError().code:"";t.logger.debug("media error code ："+e),this.trigger("error",e)},loadstart:function(){t.logger.debug("loadstart")},loadeddata:function(){t.logger.debug("loadeddata")},loadedmetadata:function(){t.logger.debug("loadedmetadata"),this.trigger("loadedmetadata")},stalled:function(){t.logger.debug("stalled")},suspend:function(){t.logger.debug("suspend")},play:function(){t.logger.debug("play");var e=this;e.trigger("play"),e.options.mutuallyExclusive&&e.options.eventHandler.mutuallyExclusivePlay({mediaId:e._mediaModel.getId(),dataId:e.options.dataId,index:e.options.index,mediaType:e._mediaModel.getMediaType()})},durationchange:function(){this.trigger("durationchange")},volumeChangeEvent:function(e,t){var i=this._mediaModel.getMuted(),n=i?0:this._mediaModel.getVolume();if("undefined"!=typeof this.lastVolumeDisplay&&e===this.lastVolumeDisplay&&"undefined"!=typeof this.lastVolume&&!t){if(n===this.lastVolume||0!==n&&Math.abs(this.lastVolume-n)<.01)return;if("undefined"!=typeof this.volumeUp&&!this.volumeUp&&Math.abs(this.lastVolume-n)<.25)return}this.volumeUp=!1,this.lastVolumeDisplay=e,this.lastVolume=i?0:this._mediaModel.getVolume();var s={mediaId:this._mediaModel.getId(),index:this.options.index,mediaType:this._mediaModel.getMediaType(),volume:i?0:this._mediaModel.getVolume(),display:e};this.options.onVolumeChange?this.options.onVolumeChange(s):this.options.eventHandler&&this.options.eventHandler.volumeChange(s)}}),i}(e,i),i.Model.MediaModel=function(e,t){var i=t.Class.Create();return i.include({create:function(e){var t=Object.create(this);return t.media=e.get(0),t.$media=e,t.poster=e.attr("poster"),t.id=e.attr("id"),t.mediaType=t.media.tagName.toLowerCase(),t},load:function(){this.media.load()},setPreLoad:function(e){this.$media.attr("preload",e)},getWidth:function(){var e=this.$media.attr("width"),t=this.$media.css("width");return parseInt(t.indexOf("%")>0?e:e||e)||0},getHeight:function(){var e=this.$media.attr("height"),t=this.$media.css("height");return parseInt(t.indexOf("%")>0?e:e||e)||0},getMediaType:function(){return this.mediaType},getMedia:function(){return this.media},getQMedia:function(){return this.$media},getId:function(){return this.id},getPoster:function(){return this.poster},isPlaying:function(){return!this.media.paused},resetPoster:function(){this.poster&&this.$media.attr("poster",this.poster)},getDuration:function(){return isNaN(this.media.duration)?0:this.media.duration<0?0:this.media.duration},getCurrentTime:function(){return this.media.currentTime},setCurrentTime:function(e){this.media.currentTime=e},getVolume:function(){return this.media.volume},setVolume:function(e){this.media.volume=e},getBuffered:function(){return this.media.buffered},getMuted:function(){return this.media.muted},setMuted:function(e){this.media.muted=e},getReadyState:function(){return this.media.readyState},getError:function(){return this.media.error}}),i}(e,i),i.View.audioHtml=function(e,t){var i=[];return i.push('<div data-oper="media-box" class="qp-media-box qp-media-box-audio">'),i.push("    <!-- 播放中下面的qp-btn-icon-play添加类名qp-btn-stop -->"),i.push('    <span data-oper="play" class="qp-btn-icon-play"></span>'),i.push('    <span class="qp-media-icons-right qp-icons-sound"></span>'),i.push('    <!--<div class="qp-media-audio-bg">音频背景</div>-->'),i.push("    <!--放置loading地方-->"),i.push('    <div class="qp-video-videowrap qp-media-audio-bg">'),i.push('        <div data-oper="loading" class="qp-video-loading">loading..</div>'),i.push("    </div>"),i.push("    <!--/放置loading地方-->"),i.push(""),i.push("    <!--媒体时常超过一小时的qp-media-toolbar添加类名qp-progress-long-->"),i.push('    <div data-oper="toolbar" class="qp-media-toolbar">'),i.push("        <!--全屏的视频才显示的播放按钮 暂停添加类名qp-btn-stop-->"),i.push('        <span data-oper="play" class="qp-btn-icon-play"></span>'),i.push("        <!--进度条-->"),i.push('        <div data-oper="progress" class="qp-media-progress-outer">'),i.push('            <div class="qp-media-progress">'),i.push('                <div data-oper="downed-bar" class="qp-media-downed" style="width: 0%;"></div>'),i.push('                <div data-oper="played-bar" class="qp-media-played" style="width: 0%;"></div>'),i.push("            </div>"),i.push("        </div>"),i.push("        <!--/进度条-->"),i.push("        <!--媒体时间-->                                                                                                           "),i.push('        <span class="qp-time-base">'),i.push('             <em data-oper="curentTime" class="qp-curent-time">0:00</em>/<em data-oper="endTime" class="qp-end-time">0:00</em>'),i.push("        </span>"),i.push("        <!--/媒体时间-->"),i.push("        <!--音量-->"),i.push('        <div data-oper="volume-icon-container" class="qp-media-volume">'),i.push("            <!--静音添加类名qp-btn-volume-no-->"),i.push('            <span data-oper="volume-icon" class="qp-btn-volume"></span>'),i.push(""),i.push('            <div data-oper="volume-control" class="qp-media-progress-box" style="display:none">'),i.push('                <div data-oper="volume-bar-container" class="qp-media-progress">'),i.push('                    <div data-oper="volume-bar-s" class="qp-media-progress-s" style="height: 0%;"></div>'),i.push('                    <div data-oper="volume-bar-r" class="qp-media-progress-r" style="bottom: 0%;"></div>'),i.push("                </div>"),i.push("            </div>"),i.push("        </div>"),i.push(""),i.push("    </div>"),i.push('    <div class="qp-media-disable" data-oper="media-disable">'),i.push(""),i.push("    </div>"),i.push("</div>                                                                                                                            "),i.push(""),i.push(""),i.join("")}(e,i),i.View.imageHtml=function(e,t){var i=[];return i.push('<div class="qp-media-box qp-media-box-img ">'),i.push('    <span class="qp-media-icons-right qp-icons-pic"></span>'),i.push('    <div class="qp-meida-tip-message" style="display: none">'),i.push("        图片还在加载中"),i.push("    </div>"),i.push('    <div class="qp-media-pics-bg"></div>'),i.push('    <div class="qp-media-toolbar">'),i.push("        点击查看图片"),i.push("    </div>"),i.push(""),i.push("</div>"),i.join("")}(e,i),i.View.videoHtml=function(e,t){var i=[];return i.push('<div data-oper="media-box" class="qp-media-box qp-media-box-video">'),i.push("    <!-- 播放中下面的qp-btn-icon-play添加类名qp-btn-stop -->"),i.push('    <span data-oper="play" class="qp-btn-icon-play "></span>'),i.push('    <span data-oper="exit-fullscreen" class="qp-btn-exit-fullscreen">退出全屏</span>'),i.push('    <span data-oper="go-fullscreen" class="qp-btn-to-fullscreen">全屏</span>'),i.push('    <span class="qp-media-icons-right qp-icons-video"></span>'),i.push(""),i.push("    <!--放置视频的地方-->"),i.push('    <div class="qp-video-videowrap">'),i.push('        <div data-oper="loading" class="qp-video-loading">loading..</div>'),i.push("    </div>"),i.push("    <!--/放置视频的地方-->"),i.push('    <div class="qp-meida-tip-message" style="display: none">'),i.push("        不支持全屏播放"),i.push("    </div>"),i.push(""),i.push("    <!--媒体时常超过一小时的qp-media-toolbar添加类名qp-progress-long-->"),i.push('    <div data-oper="toolbar-cover" class="qp-media-toolbar-cover">'),i.push('        <div data-oper="toolbar" class="qp-media-toolbar">'),i.push("            <!--全屏的视频才显示的播放按钮 暂停添加类名qp-btn-stop-->"),i.push('            <span data-oper="play" class="qp-btn-icon-play"></span>'),i.push("            <!--进度条-->"),i.push('            <div data-oper="progress" class="qp-media-progress-outer">'),i.push('                <div class="qp-media-progress">'),i.push('                    <div data-oper="downed-bar" class="qp-media-downed" style="width: 0%;"></div>'),i.push('                    <div data-oper="played-bar" class="qp-media-played" style="width: 0%;"></div>'),i.push("                </div>"),i.push("            </div>"),i.push("            <!--/进度条-->"),i.push("            <!--媒体时间-->"),i.push('        <span class="qp-time-base">'),i.push('             <em data-oper="curentTime" class="qp-curent-time">0:00</em>/<em data-oper="endTime" class="qp-end-time">0:00</em>'),i.push("        </span>"),i.push("            <!--/媒体时间-->"),i.push("            <!--音量-->"),i.push('            <div data-oper="volume-icon-container" class="qp-media-volume">'),i.push("                <!--静音添加类名qp-btn-volume-no-->"),i.push('                <span data-oper="volume-icon" class="qp-btn-volume "></span>'),i.push(""),i.push('                <div data-oper="volume-control" class="qp-media-progress-box" style="display:none">'),i.push('                    <div data-oper="volume-bar-container" class="qp-media-progress">'),i.push('                        <div data-oper="volume-bar-s" class="qp-media-progress-s" style="height: 0%;"></div>'),i.push('                        <div data-oper="volume-bar-r" class="qp-media-progress-r" style="bottom: 0%;"></div>'),i.push("                    </div>"),i.push("                </div>"),i.push("            </div>"),i.push(""),i.push("        </div>"),i.push("    </div>"),i.push('    <div class="qp-media-disable" data-oper="media-disable">'),i.push(""),i.push("    </div>"),i.push("</div>"),i.push(""),i.push(""),i.join("")}(e,i),i.View.viewerHtml=function(e,t){var i=[];return i.push('<div class="qp_media_window_mask" style="display: none"></div>'),i.push('<div class="qp-media-viewer-center" style="display: none">'),i.push('    <div class="qp-media-viewer-img">'),i.push('        <div class="qp-media-viewer-close"></div>'),i.push("        <img />"),i.push("    </div>"),i.push("</div>"),i.join("")}(e,i);var s=function(){"use strict";function n(e){return z.call(e).slice(8,-1).toLowerCase()}function s(e){return"string"==typeof e}function a(e){return"number"==typeof e&&!isNaN(e)}function o(e){return"object"===("undefined"==typeof e?"undefined":A(e))&&null!==e}function r(e){return"function"===n(e)}function l(e){return Array.isArray?Array.isArray(e):"array"===n(e)}function d(e){return s(e)&&(e=e.trim?e.trim():e.replace(F,"1")),e}function h(e,t){if(e&&r(t)){var i=void 0;if(l(e)||a(e.length)){var n=e.length;for(i=0;i<n&&t.call(e,e[i],i,e)!==!1;i++);}else o(e)&&Object.keys(e).forEach(function(i){t.call(e,e[i],i,e)})}return e}function u(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];if(o(e)&&i.length>0){if(Object.assign)return Object.assign.apply(Object,[e].concat(i));i.forEach(function(t){o(t)&&Object.keys(t).forEach(function(i){e[i]=t[i]})})}return e}function c(e,t){for(var i=arguments.length,n=Array(i>2?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];return function(){for(var i=arguments.length,s=Array(i),a=0;a<i;a++)s[a]=arguments[a];return e.apply(t,n.concat(s))}}function p(e,t){var i=e.style;h(t,function(e,t){R.test(t)&&a(e)&&(e+="px"),i[t]=e})}function m(e,t){return e.classList?e.classList.contains(t):e.className.indexOf(t)>-1}function g(e,t){if(t){if(a(e.length))return void h(e,function(e){g(e,t)});if(e.classList)return void e.classList.add(t);var i=d(e.className);i?i.indexOf(t)<0&&(e.className=i+" "+t):e.className=t}}function v(e,t){if(t)return a(e.length)?void h(e,function(e){v(e,t)}):e.classList?void e.classList.remove(t):void(e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,"")))}function f(e,t,i){var n=d(t).split(W);return n.length>1?void h(n,function(t){f(e,t,i)}):void(e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i))}function y(e,t,i,n){var s=d(t).split(W),a=i;return s.length>1?void h(s,function(t){y(e,t,i)}):(n&&(i=function(){for(var n=arguments.length,s=Array(n),o=0;o<n;o++)s[o]=arguments[o];return f(e,t,i),a.apply(e,s)}),void(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)))}function w(i){var n=i||e.event;if(n.target||(n.target=n.srcElement||t),!a(n.pageX)&&a(n.clientX)){var s=i.target.ownerDocument||t,o=s.documentElement,r=s.body;n.pageX=n.clientX+((o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0)),n.pageY=n.clientY+((o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0))}return n}function b(i){var n=t.documentElement,s=i.getBoundingClientRect();return{left:s.left+((e.scrollX||n&&n.scrollLeft||0)-(n&&n.clientLeft||0)),top:s.top+((e.scrollY||n&&n.scrollTop||0)-(n&&n.clientTop||0))}}function I(e,t){return e.getElementsByClassName?e.getElementsByClassName(t):e.querySelectorAll("."+t)}function x(e){if("string"===n(e)){var i=t&&t.createElement("div");return i.innerHTML=e,i.firstChild}return e}function E(e,t){if(e.compareDocumentPosition)return e===t||!!(16&e.compareDocumentPosition(t));if(e.contains&&1===t.nodeType)return e.contains(t)&&e!==t;for(;t=t.parentNode;)if(t===e)return!0;return!1}function M(e){if(e=e.originalEvent?e.originalEvent:e,e.type&&S(e.type)){var t=[],i=null,n=void 0;n=e.touches.length>0?e.touches:e.changedTouches;for(var s=0,a=n.length;s<a;s++)i=n[s],t.push({x:i.pageX,y:i.pageY});return t}return[{x:e.pageX,y:e.pageY}]}function T(){return e.navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i)}function $(e){return e+(10*Math.random()+1*new Date).toString().replace(".","")}function S(e){return/^(touchend|touchcancel|touchstart|touchmove)$/.test(e)}for(var C=["assets","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],H={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",DEBUG_VALUE:3,INFO_VALUE:2,WARN_VALUE:1,ERROR_VALUE:0,UNKNOWN:-1},k=e.console||{},P=C.length;P--;){var D=C[P];k[D]||(k[D]=function(){})}var B={$level:0,setLevel:function(e){switch(e){case H.DEBUG:this.$level=H.DEBUG_VALUE;break;case H.INFO:this.$level=H.INFO_VALUE;break;case H.WARN:this.$level=H.WARN_VALUE;break;case H.ERROR:this.$level=H.ERROR_VALUEl;break;default:this.$level=H.UNKNOWN}},debug:function(){this.$level>=H.DEBUG_VALUE&&k.log.apply(k,arguments)},info:function(){this.$level>=H.INFO_VALUE&&k.log.apply(k,arguments)},warn:function(){this.$level>=H.WARN_VALUE&&k.log.apply(k,arguments)},error:function(){this.$level>=H.ERROR_VALUE&&k.log.apply(k,arguments)}},q={src:"",modal:!0,lock:!1,env:"",minWidth:50,minHeight:50,maxWidth:256,maxHeight:176,lang:"zh",inline:!1,defaultSrc:"",style:"",eventAll:!0},L={view:'<div class="ndui-insert-pictures" style="width: 256px; height: 176px"> <div class="insert-pictures__wrap"><span class="insert-pictures__zoom"></span><span class="insert-pictures__loading"></span><div></div>',view2:'<span class="ndui-insert-pictures" style="width: 256px; height: 176px"> <span class="insert-pictures__wrap"><span class="insert-pictures__zoom"></span><span class="insert-pictures__loading"></span></span></span>',popwindow:'<div class="ndui-pop-insert-pictures"><div class="pop-insert-pictures__head"><span class="head__oper head__close"></span><span class="head__oper head__full"></span> </div><div class="pop-insert-pictures__body"> <img src="" alt="" ><span class="pic__oper oper--left" style="display:none"></span><span class="pic__oper oper--right" style="display:none"></span></div><span class="insert-pictures__loading"></span></div>',mask:'<div class="ndui-pop-insert-pictures-mask"></div>',mobilefull:'<div class="ndui-pop-insert-pictures-pad"><div class="pop-insert-pictures__body"><img src="" alt=""> </div><span class="insert-pictures__loading"></span></div>'},A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},V=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),W=/\s+/,R=/^(width|height|left|top|marginLeft|marginTop)$/,F=/^\s+(.*)\s+$/,O=Object.prototype,z=O.toString,G={IMAGE_MIN_WIDTH:50,IMAGE_MIN_HEIGHT:50,IMAGE_MAX_WIDTH:256,IMAGE_MAX_HEIGHT:176,SPECIAL_WIDTH:20,SPECIAL_HEIGHT:80,VIEWER_MIN_WIDTH:400,VIEWER_MIN_HEIGHT:300,TOP_VIEWER:null,IMAGE_INSTANCES:{},clear:function(e){var t=this.IMAGE_INSTANCES[e];t&&t.destroy(),this.IMAGE_INSTANCES[e]=null,delete this.IMAGE_INSTANCES[e]},getKeyId:function(e){return e.split("|")[1]}},U={src:"",currentIndex:0,modal:!0,lock:!1,width:400,height:300,maxRatio:10,swip:!1,lang:"zh",defaultSrc:""},j={};j.getDistance=function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},j.getFingers=function(e){return e.touches?e.touches.length:1},j.calScale=function(e,t,i){if(e.length>=2&&t.length>=2){var n=this.getDistance(e[1],e[0]),s=this.getDistance(t[1],t[0]),a=(s-n)*i;return(s-a)/n}return 1},j.getPosOfEvent=function(e){if(this.isTouch(e.type)){var t=[],i=null,n=void 0;n=e.touches.length>0?e.touches:e.changedTouches;for(var s=0,a=n.length;s<a;s++)i=n[s],t.push({x:i.pageX,y:i.pageY});return t}return[{x:e.pageX,y:e.pageY}]},j.isDown=function(e){return"touchstart"===e||"mousedown"===e},j.isUp=function(e){return/^(touchend|touchcancel|mouseup|mouseleave|mouseout)$/.test(e)},j.isMove=function(e){return"mousemove"===e||"touchmove"===e},j.isTouch=function(e){return/^(touchend|touchcancel|touchstart|touchmove)$/.test(e)},j.isTouchEnd=function(e){return"touchend"===e.type||"touchcancel"===e.type},j.isTouchMove=function(e){return"touchmove"===e.type},j.proxy=function(e,t){return function(){var i=Array.prototype.slice.call(arguments,0);e.apply(t,i)}},j.isMobile=e.navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),j.hasTouch="ontouchend"in e,j.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},j.getUuid=function(){for(var e,t=[],i="0123456789abcdef",n=0;n<36;n++)t[n]=i.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=i.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",e=t.join("")};var Q={evtElem:t.body,tap:!0,doubleTap:!0,drag:!0,pinch:!0,hold:!0,tapMaxDistance:50,tapTime:600,holdTime:1e3,doubleTapMaxInterval:300,doubleTapMaxDistance:16,pinchIntensity:.8,eventPrefix:""},X={PINCH_START:"pinchstart",PINCH:"pinch",PINCH_END:"pinchend",DRAG_START:"dragstart",DRAG:"drag",DRAG_END:"dragend",HOLD:"hold",TAP:"tap",DOUBLE_TAP:"dbltap",FOCUS:"focus",BLUR:"blur"},Y={trigger:function(e,i,n){var s=void 0,a={bubbles:!0,cancelable:!0,detail:n||{}};"undefined"!=typeof CustomEvent?(s=new CustomEvent(i,a),e.dispatchEvent(s)):(s=t.createEvent("CustomEvent"),s.initCustomEvent(i,!0,!0,n),e.dispatchEvent(s))},bind:function(e,t,i){var n=function(e){e.originalEvent=e;for(var t in e.detail)e.detail.hasOwnProperty(t)&&"type"!==t&&(e[t]=e.detail[t]);var n=i.call(e.target,e);"undefined"==typeof n||n||(e.stopPropagation(),e.preventDefault())};i.proxy=n;var s=t.match(/\S+/g);s.forEach(function(t){e.addEventListener(t,i.proxy,!1)})},unbind:function(e,t,i){var n=t.match(/\S+/g);n.forEach(function(t){e.removeEventListener(t,i.proxy,!1)})},on:function(){var e=Array.prototype.slice.apply(arguments,[0]),i="string"==typeof e[0]?t.querySelectorAll(e[0]):e[0],n=e[1],s=e[2];this.bind(i,n,s)}};Y.off=Y.unbind;var K=function(){function e(t){N(this,e),this.uuid=j.getUuid(),this._config=j.extend(Object.create(Q),t),this._downStart=!1,
this._pinchStart=!1,this._dragStart=!1,this._tap=!1,this._startTime=0,this._startPos=null,this._movePos=null,this._endPos=null,this._lastTarget=null,this._dragElem=null,this._holdTimer=0,this.bindEvent()}return V(e,[{key:"getConfig",value:function(){return this._config}},{key:"reset",value:function(){this._downStart=!1,this._pinchStart=!1,this._dragStart=!1,this._tap=!1,this._startTime=0,this._startPos=null,this._movePos=null,this._endPos=null,this._dragElem=null,clearTimeout(this._holdTimer),this._holdTimer=0}},{key:"bindEvent",value:function(){var e=this,t=["mouseup","mousedown","mousemove","mouseleave"],i=["touchstart","touchmove","touchend","touchcancel"],n=t,s=e._config;j.isMobile?n=i:j.hasTouch&&(n=i.concat(t)),e.handler=j.proxy(e.handler,this),n.forEach(function(t){s.evtElem.addEventListener(t,e.handler,!1)})}},{key:"downHandler",value:function(e,t){this._downStart=!0,(!this._startPos||this._startPos.length<2)&&(this._startPos=j.getPosOfEvent(e)),this._startTime=(new Date).getTime(),this.focus(e),this.hold(e),this._lastTarget=t}},{key:"moveHandler",value:function(e){this._movePos=j.getPosOfEvent(e),j.getFingers(e)>=2?this.pinch(e):this.drag(e)}},{key:"upHandler",value:function(e){B.debug("upHandler"),this._endPos=j.getPosOfEvent(e),this._pinchStart?(B.debug("deal with upHandler"),this.pinch(e)):this._dragStart?(B.debug("deal with drag"),this.drag(e)):this._tap&&(B.debug("deal with tap"),this.tap(e)),this.reset()}},{key:"handler",value:function(e){var t=e.type,i=e.target;if(j.isDown(t))this.downHandler(e,i);else if(j.isMove(t)){if(!this._downStart||!this._startPos)return;this.moveHandler(e)}else if(j.isUp(t)){if(!this._downStart)return;i==this._lastTarget&&(this._tap=!0,B.debug("_tap is true")),this.upHandler(e)}}},{key:"tap",value:function(e){var t=(new Date).getTime(),i=e.target,n=this._config,s=t-this._startTime,a=j.getDistance(this._startPos[0],this._endPos[0]);B.debug("tap judge"),s<n.holdTime&&a<=n.tapMaxDistance&&s<=n.tapTime?(B.debug(" tap start"),this._startTime-this.__lastTapTime<=n.doubleTapMaxInterval&&this.__lastTapPos&&j.getDistance(this.__lastTapPos,this._endPos[0])<=n.doubleTapMaxDistance&&this.__lastTapElem==i?(B.debug("double tap start"),this.trigger(i,e,X.DOUBLE_TAP),this.__lastTapTime=0,this.__lastTapPos=null,this.__lastTapElem=null):(B.debug("tap trigger "),this.trigger(i,e,X.TAP),this.__lastTapTime=t,this.__lastTapPos=this._endPos[0],this.__lastTapElem=i)):B.debug("tap hold long time")}},{key:"drag",value:function(e){if(this._startPos){var t=e.target;if(this._dragStart)j.isMove(e.type)?this.trigger(this._dragElem,e,X.DRAG):j.isUp(e.type)&&this.trigger(this._dragElem,e,X.DRAG_END);else{var i=j.getDistance(this._startPos[0],this._movePos[0]);i>1&&(this._dragElem=t,this.trigger(t,e,X.DRAG_START),this.trigger(t,e,X.DRAG),this._dragStart=!0)}}}},{key:"hold",value:function(e){var t=this;clearTimeout(this._holdTimer),this._holdTimer=setTimeout(function(){if(t._startPos){var i=j.getDistance(t._startPos[0],t._movePos?t._movePos[0]:t._startPos[0]);t._config.tapMaxDistance<i||t.trigger(e.target,e,X.HOLD,{type:X.HOLD,originEvent:e,fingersCount:j.getFingers(e),position:t._startPos[0]})}},this._config.holdTime)}},{key:"pinch",value:function(e){if(this._downStart&&(!(j.getFingers(e)<2)||j.isTouchEnd(e))){var t=this._config,i=j.calScale(this._startPos,this._movePos,t.pinchIntensity),n=j.getFingers(e),s={originEvent:e,scale:i,fingersCount:n};this._pinchStart?j.isTouchMove(e)?this.trigger(e.target,e,X.PINCH,s):j.isTouchEnd(e)&&this.trigger(e.target,e,X.PINCH_END,s):(this._pinchStart=!0,this.trigger(e.target,e,X.PINCH_START,s))}}},{key:"focus",value:function(e){var t=e.target,i=this._lastTarget;i!==t&&i?(this.trigger(i,e,X.BLUR),this.trigger(t,e,X.FOCUS)):i||this.trigger(t,e,X.FOCUS)}},{key:"trigger",value:function(e,t,i,n){n=n||{originalEvent:t};var s=this._config.eventPrefix;s&&(i=s+i),Y.trigger(e,i,n,this._config.eventPrefix)}}]),e}(),Z=function(){function e(t){N(this,e),this.core=new K(t)}return V(e,null,[{key:"on",value:function(){var e=Array.prototype.slice.apply(arguments,[0]);Y.on.apply(Y,e)}},{key:"off",value:function(){var e=Array.prototype.slice.apply(arguments,[0]);Y.off.apply(Y,e)}}]),e}(),J=void 0,ee=void 0,te={eventList:{},down:!1,key:"",init:function(){return ee=this,J||(J=new Z({evtElem:t.body})),J},bind:function(){ee=this,Z.on(t.body,"tap dragstart drag dragend pinchstart pinch pinchend",ee.handler)},unbind:function(){ee=this,Z.off(t.body,"tap dragstart drag dragend pinchstart pinch pinchend",ee.handler)},registerEvent:function(e,t){if(null!=e&&null!=t){t=t.split(" ");for(var i=0,n=t.length;i<n;i++){var s=t[i];ee.eventList[s]&&ee.eventList[s].indexOf(e)<0?ee.eventList[s].push(e):null!=ee.eventList[s]&&0!=ee.eventList[s].length||(ee.eventList[s]=[e])}}},unregisterEvent:function(e,t){if(null!=e&&null!=t){t=t.split(" ");for(var i=0,n=t.length;i<n;i++){var s=t[i],a=ee.eventList[s].indexOf(e);a>-1&&ee.eventList[s].splice(a,1)}}},handler:function(e){e=w(e);for(var t=e.target,i=ee.eventList[e.type]||[],n=0,s=i.length;n<s;n++){var a=i[n];a.container&&E(a.container,t)&&a.$handle(e)}}},ie=function(){function n(t){N(this,n),this.options=u({},U,t),te.registerEvent(this,"tap dragstart drag dragend pinchstart pinch pinchend"),this.$createHtml(),this.$render(),this.fullScreenChange=this.options.onFullScreenChange||this.options.eventHandler&&this.options.eventHandler.fullScreenChange;var i=this;this.$orientationChange=c(i.$orientationChange,i),e.addEventListener("onorientationchange"in e?"orientationchange":"resize",this.$orientationChange,!1)}return V(n,[{key:"$render",value:function(){this.viewerData={width:0,height:0,src:""},this.viewerData.src=this.options.src,this.fullWidth=t.documentElement.clientWidth,this.fullHeight=t.documentElement.clientHeight,this.cacheLastStatus={},this.$init(),this.close()}},{key:"$init",value:function(){var e=this,t=this;t.$loadImage(function(i,n){t.viewerData.width=i,t.viewerData.height=n,e.$resize(),g(t.loading,"hide-dom")}),this.viewerImg.src=this.viewerData.src}},{key:"$resize",value:function(){var e=this,i=e.viewerData.width,n=e.viewerData.height,s=void 0,a=void 0;this.fullWidth=t.documentElement.clientWidth,this.fullHeight=t.documentElement.clientHeight,i/n>this.fullWidth/this.fullHeight&&i>this.fullWidth?(s=this.fullWidth,a=n*s/i):n>this.fullHeight?(a=this.fullHeight,s=i*a/n):(a=n,s=i),e.viewerImg.style.width=s+"px",e.viewerData.width=s,e.viewerData.height=a;var o=void 0,r=void 0;r=(this.fullHeight-a)/2,o=(this.fullWidth-s)/2,e.viewerImg.style.top=r+"px",e.viewerImg.style.left=o+"px"}},{key:"$createHtml",value:function(){var e=L.mobilefull,i=L.mask;e=x(e),this.viewerImg=e.querySelector("img"),this.loading=e.querySelector(".insert-pictures__loading"),this.container=e,i=x(i),this.mask=i,t.body.appendChild(i),t.body.appendChild(e)}},{key:"$loadImage",value:function(e){var t=this,i=new Image;i.src=t.viewerData.src,i.complete?e&&e(i.width,i.height):(i.onload=function(){e&&e(i.width,i.height),i.onload=null},i.onerror=function(){t.viewerData.src=t.options.defaultSrc,t.viewerImg.src=t.options.defaultSrc,i.src=t.options.defaultSrc,i.onerror=null})}},{key:"$initOffset",value:function(e,t,i,n){e&&e.x,e&&e.y;this.viewerImg.style.width=n+"px";var s=this.viewerImg.clientWidth,a=this.viewerImg.clientHeight,o=this.viewerImg.offsetLeft,r=this.viewerImg.offsetTop;if(B.debug("mobile full",t,i,this.fullHeight,this.fullWidth),e&&s>this.fullWidth&&a>this.fullHeight){B.debug("mobile viewer finger center scale");var l=e.x-(e.x-o)*s/t,d=e.y-(e.y-r)*a/i;l=l>0?0:l<this.fullWidth-s?this.fullWidth-s:l,d=d>0?0:d<this.fullHeight-a?this.fullHeight-a:d,this.viewerImg.style.left=l+"px",this.viewerImg.style.top=d+"px"}else B.debug("mobile viewer center scale"),this.viewerImg.style.left=(this.fullWidth-s)/2+"px",this.viewerImg.style.top=(this.fullHeight-a)/2+"px"}},{key:"$handle",value:function(t){var i=this;t=w(t);var n=t.target,s=this;t?t.stopPropagation():e.event.cancelBubble=!0,t.preventDefault();var a=t.originalEvent;a&&(a.stopPropagation?a.stopPropagation():a.cancelBubble&&(a.cancelBubble=!0)),a.preventDefault&&a.preventDefault();var o=M(t),r=o[0].x,l=o[0].y;switch(t.type){case"tap":B.debug("mobile tap");var d=setTimeout(function(){s.close(),clearTimeout(d)},10);break;case"dragstart":if(B.debug("mobile dragstart"),n==this.viewerImg){if(this.viewerImg.clientWidth<=this.fullWidth&&this.viewerImg.clientHeight<=this.fullHeight)return;this.isDrag=!0,this.wheeling=!1,this.cacheLastStatus=this.cacheLastStatus||{},this.cacheLastStatus.x=r,this.cacheLastStatus.y=l,this.cacheLastStatus.width=this.viewerImg.clientWidth,this.cacheLastStatus.height=this.viewerImg.clientHeight}break;case"drag":if(this.isDrag){if(this.wheeling)return;this.wheeling=!0;var h=setTimeout(function(){i.wheeling=!1,clearTimeout(h)},60),u=this.cacheLastStatus.width,c=this.cacheLastStatus.height;if(u>this.fullWidth){var p=r-this.cacheLastStatus.x+this.viewerImg.offsetLeft;p<=0&&p>=this.fullWidth-u&&(this.viewerImg.style.left=p+"px"),this.$moveFlag=!0}if(c>this.fullHeight){var m=l-this.cacheLastStatus.y+this.viewerImg.offsetTop;m<=0&&m>=this.fullHeight-c&&(this.viewerImg.style.top=m+"px"),this.$moveFlag=!0}this.$moveFlag&&(this.cacheLastStatus.x=r,this.cacheLastStatus.y=l)}break;case"dragend":this.isDrag=!1,B.debug("mobile dragend");break;case"pinchstart":n==this.viewerImg&&(this.isPinch=!0,this.wheeling=!1,this.cacheLastStatus=this.cacheLastStatus||{},this.cacheLastStatus.width=this.viewerImg.clientWidth,this.cacheLastStatus.height=this.viewerImg.clientHeight),B.debug("mobile pinchstart");break;case"pinch":if(this.isPinch){if(this.wheeling)return;this.wheeling=!0;var g=setTimeout(function(){i.wheeling=!1,clearTimeout(g)},60),v=t.scale||1;v=parseInt(100*v)/100;var f=void 0,_=void 0,y=void 0,I=void 0;y=this.cacheLastStatus.width,I=this.cacheLastStatus.height,v=v>1?1.5*v:1*v/1.5,f=parseInt(y*v*100)/100,_=parseInt(I*v*100)/100;var x=t.originEvent&&t.originEvent.changedTouches,E=null;if(x&&x.length>1){b(this.viewerImg);E={x:(x[0].clientX+x[1].clientX)/2,y:(x[0].clientY+x[1].clientY)/2};var T=!1,$=void 0;f>=this.viewerData.width&&_>=this.viewerData.height&&f<=20*this.viewerData.width&&_<20*this.viewerData.height?($=f,T=!0):f<this.viewerData.width&&_<this.viewerData.height&&y>=this.viewerData.width&&I>=this.viewerData.height&&y<=20*this.viewerData.width&&I<20*this.viewerData.height?($=this.viewerData.width,T=!0):f>y&&_>I&&f>20*this.viewerData.width&&_>20*this.viewerData.height&&($=20*this.viewerData.width,T=!0),T&&this.$initOffset(E,y,I,$)}}break;case"pinchend":this.isPinch=!1,B.debug("mobile pinchend")}return!1}},{key:"updateSrc",value:function(){var e=arguments;if(0!=e.length&&1==e.length){var t=e[0];s(t)&&(this.viewerData.src=this.options.src=t,this.$init())}}},{key:"open",value:function(){p(t.body,{overflow:"hidden"}),this.container&&(this.container.style.display=""),this.mask&&v(this.mask,"hide-dom"),i&&i.Native.InteractAppApi.setViewerModuleVisibility(!1),this.fullScreenChange&&this.fullScreenChange(!0)}},{key:"close",value:function(){p(t.body,{overflow:""}),this.container.style.display="none",this.mask&&g(this.mask,"hide-dom"),i&&i.Native.InteractAppApi.setViewerModuleVisibility(!0),this.fullScreenChange&&this.fullScreenChange(!1)}},{key:"$orientationChange",value:function(t){t.preventDefault(),t.stopPropagation(),B.debug("监听到屏幕方向改变"),180!=e.orientation&&0!=e.orientation||(this.setVertical(),B.debug("设置为竖屏幕")),90!=e.orientation&&e.orientation!=-90||(this.setCross(),B.debug("设置为横屏幕")),"resize"==t.type&&this.$resize()}},{key:"setCross",value:function(){this.container&&g(this.container,"show__cross"),this.$resize()}},{key:"setVertical",value:function(){this.container&&v(this.container,"show__cross"),this.$resize()}},{key:"destroy",value:function(){B.debug("销毁mobileviewer");te.unregisterEvent(this,"tap dragstart drag dragend pinchstart pinch pinchend"),e.removeEventListener("onorientationchange"in e?"orientationchange":"resize",this.$orientationChange,!1),this.mask.ontouchstart=null,this.container&&this.container.parentNode.removeChild(this.container),this.mask&&this.mask.parentNode.removeChild(this.mask),this.mask=null,this.viewerImg=null,this.loading=null,this.container=null,this.viewerData=null,G.TOP_VIEWER&&G.TOP_VIEWER==this&&(G.TOP_VIEWER=null)}}]),n}(),ne={preview:"预览",max:"最大化",min:"向下还原",close:"关闭"},se={preview:"preview",max:"max",min:"min",close:"close"},ae={zh:ne,zh_cn:ne,en:se,en_us:se},oe=function(){function i(e){N(this,i),this.options=u({},U,e),te.registerEvent(this,"tap dragstart drag dragend pinchstart pinch pinchend"),this.$createHtml(),this.$render()}return V(i,[{key:"$render",value:function(){if(this.viewerData={src:"",width:0,height:0,containerWidth:0,containerHeight:0},this.bound=8,this.padding=2,this.viewerData.src=this.options.src,this.currentIndex=this.options.currentIndex,this.viewerData.width=this.options.width,this.viewerData.height=this.options.height,this.isModal=this.options.modal,o(this.options.lang)?this.langObject=this.options.lang:this.langObject=ae[this.options.lang.toLowerCase()]||ae.zh,this.$initFullSize(),this.options.src&&"array"==n(this.options.src))this.imgLength=this.options.src.length,this.currentIndex=this.currentIndex>this.imgLength-1?this.imgLength-1:this.currentIndex,this.viewerData.src=this.options.src[this.currentIndex];else{if("string"!=n(this.options.src))return void B.error("缺少src参数");this.options.src=[this.options.src],this.currentIndex=0,this.viewerData.src=this.options.src[this.currentIndex],this.imgLength=this.options.src.length}this.isModal&&this.$createMask(),this.close(),this.$init()}},{key:"$createMask",value:function(){var e=L.mask;e=x(e),g(e,"mask--transparent");var i=I(t.body,"ndui-pop-insert-pictures-mask");null==i||i.length<1?(t.body.appendChild(e),this.mask=e):this.mask=i[0]}},{key:"$createHtml",value:function(){var e=this,i=L.popwindow;i=x(i),this.viewerImg=i.querySelector("img"),this.viewerClose=i.querySelector(".head__oper.head__close"),this.viewerFull=i.querySelector(".head__oper.head__full"),this.viewerHead=i.querySelector(".pop-insert-pictures__head"),this.viewerBody=i.querySelector(".pop-insert-pictures__body"),this.swipLeft=i.querySelector(".pic__oper.oper--left"),this.swipRight=i.querySelector(".pic__oper.oper--right"),this.loading=i.querySelector(".insert-pictures__loading"),this.container=i,t.body.appendChild(i),e.$handleMousemove=c(e.$handleMousemove,e),e.$handleWheel=c(e.$handleWheel,e),y(this.container,"mousedown mousemove touchstart touchend",e.$handleMousemove),y(this.container,"mousewheel",e.$handleWheel),y(this.viewerClose,"mouseover mouseleave touchstart touchend",e.$handleMousemove),y(this.viewerFull," mouseover mouseleave touchstart touchend",e.$handleMousemove)}},{key:"$init",value:function(e){var t=this;this.$loadImage(function(i,n){t.viewerData.width=i,t.viewerData.height=n;var s=void 0,a=void 0,o=void 0,r=t.fullBodyHeight-2*t.viewerPaddingHeight,l=t.fullBodyWidth-2*t.viewerPaddingWidth;if(e){var d=t.fullBodyHeight-2*t.viewerPaddingHeight;s=e,o=n/i*s,a=o>d?d:o<G.VIEWER_MIN_HEIGHT?G.VIEWER_MIN_HEIGHT:o}else t.viewerData.width<G.VIEWER_MIN_WIDTH||t.viewerData.height<G.VIEWER_MIN_HEIGHT?(s=i<G.VIEWER_MIN_WIDTH?G.VIEWER_MIN_WIDTH:i>l?l:i,a=n<G.VIEWER_MIN_HEIGHT?G.VIEWER_MIN_HEIGHT:n>r?r:n):i>l||n>r?i/n>l/r?(i>l?s=l:i<G.IMAGE_MIN_WIDTH&&(s=G.IMAGE_MIN_WIDTH),a=n/i*s,a=a<G.IMAGE_MIN_HEIGHT?G.IMAGE_MIN_HEIGHT:a):(n>r?a=r:a<G.IMAGE_MAX_HEIGHT&&(a=G.IMAGE_MIN_HEIGHT),s=i/n*a,s=s<G.IMAGE_MIN_WIDTH?G.IMAGE_MIN_WIDTH:s):(s=i,a=n);t.viewerData.containerWidth=s,t.viewerData.containerHeight=a,t.fulled?t.$resize(t.fullBodyWidth,t.fullBodyHeight):e?t.$resize(null,null,!0):t.$resize(),t.loading.setAttribute("class","hide-dom")}),this.viewerClose.setAttribute("title",this.langObject.close),this.viewerFull.setAttribute("title",this.langObject.max),this.viewerImg.src=this.viewerData.src,this.$initSwip(),e||(this.fulled=!1,this.$initFullStatus()),this.$initSwipVisible()}},{key:"$initSwipVisible",value:function(){this.options.src.length>1?(this.swipLeft.style.display="",this.swipRight.style.display="",this.swipLeft.style.display="",this.swipRight.style.display=""):(this.swipLeft.style.display="none",this.swipRight.style.display="none",this.swipLeft.style.display="none",this.swipRight.style.display="none")}},{key:"$initFullSize",value:function(){this.fullWidth=t.documentElement.clientWidth,this.fullHeight=t.documentElement.clientHeight,this.fullBodyWidth=this.fullWidth-2*this.padding,this.fullBodyHeight=this.fullHeight-2*this.padding-this.viewerHead.clientHeight,this.viewerPaddingWidth=.1*this.fullBodyWidth,this.viewerPaddingHeight=.1*this.fullBodyHeight}},{key:"$resize",value:function(e,t,i){this.$initFullSize();var n=void 0,s=void 0,a=void 0,o=void 0,r=void 0,l=void 0,d=this.viewerData.width,h=this.viewerData.height;n=null==e?this.viewerData.containerWidth:e,s=null==t?this.viewerData.containerHeight:t,d>n?(r=n,l=h/d*n,d=r,h=l):h>s&&(l=s,r=d/h*s,d=r,h=l),a=n/2-d/2,o=s/2-h/2,this.viewerImg.removeAttribute("style"),this.viewerImg.style.width=d+"px",this.viewerImg.style.left=a+"px",this.viewerImg.style.top=o+"px";var u=this.viewerBody.clientHeight;if(this.viewerBody.style.width=n+"px",this.viewerBody.style.height=s+"px",a=this.fullBodyWidth/2-n/2,o=this.fullBodyHeight/2-s/2,i&&u){var c=this.container.offsetTop-(s-u)/2;this.container.style.top=c+"px"}else this.container.style.left=a+"px",this.container.style.top=o+"px"}},{key:"$imageCenter",value:function(e,t){var i=void 0,n=void 0,s=void 0,a=void 0;i=e,n=t,s=i/2-this.viewerImg.clientWidth/2,a=n/2-this.viewerImg.clientHeight/2,this.viewerImg.style.left=s+"px",this.viewerImg.style.top=a+"px",this.viewerBody.style.width=i+"px",this.viewerBody.style.height=n+"px"}},{key:"$loadImage",value:function(e){var t=this,i=new Image;i.src=t.viewerData.src,i.complete?e&&e(i.width,i.height):(i.onload=function(){e&&e(i.width,i.height),i.onload=null},i.onerror=function(){t.viewerData.src=t.options.defaultSrc,t.viewerImg.src=t.options.defaultSrc,i.src=t.options.defaultSrc,i.onerror=null})}},{key:"$handleTap",value:function(t){if(!this.options.lock){t?t.stopPropagation():e.event.cancelBubble=!0,t=w(t);var i=void 0,n=void 0,s=M(t);switch(i=s[0].x,n=s[0].y,G.TOP_VIEWER&&(G.TOP_VIEWER.container.style.zIndex=1e5),this.container.style.zIndex=100001,G.TOP_VIEWER=this,t.target){case this.viewerClose:this.close();break;case this.viewerFull:this.full();break;case this.swipLeft:this.prev();break;case this.swipRight:this.next()}}}},{key:"$handle",value:function(e){if(!this.options.lock){e=w(e);var t=(e.originalEvent?e.originalEvent:e,M(e));switch(this.$px=t[0].x,this.$py=t[0].y,e.type){case"tap":this.$handleTap(e);break;case"dragstart":if(e.preventDefault(),G.TOP_VIEWER&&(G.TOP_VIEWER.container.style.zIndex=1e5),this.container.style.zIndex=100001,G.TOP_VIEWER=this,e.target==this.viewerClose||e.target==this.viewerFull)return;this.isDown=!0,this.cacheLastStatus=this.cacheLastStatus||{},this.cacheLastStatus.px=this.$px,this.cacheLastStatus.py=this.$py;break;case"drag":if(e.preventDefault(),!this.isDown)return;if(this.isBorder&&!m(this.viewerFull,"head__small")){B.debug(this.container.style.cursor);var i=void 0,n=void 0;switch(this.isBorder){case"n-resize":i=this.viewerBody.clientHeight-(this.$py-this.cacheLastStatus.py),i>=G.VIEWER_MIN_HEIGHT&&i<=this.fullBodyHeight&&(this.viewerBody.style.height=i+"px",this.container.style.top=this.container.offsetTop+(this.$py-this.cacheLastStatus.py)+"px");break;case"s-resize":i=this.viewerBody.clientHeight+this.$py-this.cacheLastStatus.py,i>=G.VIEWER_MIN_HEIGHT&&i<=this.fullBodyHeight&&(this.viewerBody.style.height=i+"px");break;case"w-resize":n=this.viewerBody.clientWidth-(this.$px-this.cacheLastStatus.px),n>=G.VIEWER_MIN_WIDTH&&n<=this.fullBodyWidth&&(this.viewerBody.style.width=n+"px",this.container.style.left=this.container.offsetLeft+this.$px-this.cacheLastStatus.px+"px");break;case"e-resize":n=this.viewerBody.clientWidth+this.$px-this.cacheLastStatus.px,n>=G.VIEWER_MIN_WIDTH&&n<=this.fullBodyWidth&&(this.viewerBody.style.width=n+"px");break;case"nw-resize":i=this.viewerBody.clientHeight-(this.$py-this.cacheLastStatus.py),i>=G.VIEWER_MIN_HEIGHT&&i<=this.fullBodyHeight&&(this.viewerBody.style.height=i+"px",this.container.style.top=this.container.offsetTop+(this.$py-this.cacheLastStatus.py)+"px"),n=this.viewerBody.clientWidth-(this.$px-this.cacheLastStatus.px),n>=G.VIEWER_MIN_WIDTH&&n<=this.fullBodyWidth&&(this.viewerBody.style.width=n+"px",this.container.style.left=this.container.offsetLeft+this.$px-this.cacheLastStatus.px+"px");break;case"ne-resize":i=this.viewerBody.clientHeight-(this.$py-this.cacheLastStatus.py),i>=G.VIEWER_MIN_HEIGHT&&i<=this.fullBodyHeight&&(this.viewerBody.style.height=i+"px",this.container.style.top=this.container.offsetTop+(this.$py-this.cacheLastStatus.py)+"px"),n=this.viewerBody.clientWidth+this.$px-this.cacheLastStatus.px,n>=G.VIEWER_MIN_WIDTH&&n<=this.fullBodyWidth&&(this.viewerBody.style.width=n+"px");break;case"sw-resize":n=this.viewerBody.clientWidth-(this.$px-this.cacheLastStatus.px),n>=G.VIEWER_MIN_WIDTH&&n<=this.fullBodyWidth&&(this.viewerBody.style.width=n+"px",this.container.style.left=this.container.offsetLeft+this.$px-this.cacheLastStatus.px+"px"),i=this.viewerBody.clientHeight+this.$py-this.cacheLastStatus.py,i>=G.VIEWER_MIN_HEIGHT&&i<=this.fullBodyHeight&&(this.viewerBody.style.height=i+"px");break;case"se-resize":i=this.viewerBody.clientHeight+this.$py-this.cacheLastStatus.py,i>=G.VIEWER_MIN_HEIGHT&&(this.viewerBody.style.height=i+"px"),n=this.viewerBody.clientWidth+this.$px-this.cacheLastStatus.px,n>=G.VIEWER_MIN_WIDTH&&(this.viewerBody.style.width=n+"px")}this.$imageCenter(this.viewerBody.clientWidth,this.viewerBody.clientHeight),this.cacheLastStatus.px=this.$px,this.cacheLastStatus.py=this.$py}if(this.isBorder)return;if(e.target==this.viewerImg){var s=void 0,a=void 0,o=void 0,r=void 0,l=!1;if(s=this.viewerImg.clientWidth,a=this.viewerImg.clientHeight,o=this.viewerBody.clientWidth,r=this.viewerBody.clientHeight,s>o){var d=this.$px-this.cacheLastStatus.px+this.viewerImg.offsetLeft;d<=0&&d>=o-s&&(this.viewerImg.style.left=d+"px"),l=!0}if(a>r){var h=this.$py-this.cacheLastStatus.py+this.viewerImg.offsetTop;h<=0&&h>=r-a&&(this.viewerImg.style.top=h+"px"),l=!0}if(l)return this.cacheLastStatus.px=this.$px,void(this.cacheLastStatus.py=this.$py)}if(m(this.viewerFull,"head__small"))return;var u=this.fullBodyWidth/2,c=this.fullBodyHeight/2,p=this.$px-this.cacheLastStatus.px+this.container.offsetLeft,g=this.$py-this.cacheLastStatus.py+this.container.offsetTop,v=p+this.container.clientWidth/2,f=g+this.container.clientHeight/2;v>=0&&v<=this.fullBodyWidth?this.container.style.left=p+"px":Math.abs(this.$px-u)<Math.abs(this.cacheLastStatus.px-u)&&(this.container.style.left=p+"px"),f>=0&&f<=this.fullHeight?this.container.style.top=g+"px":Math.abs(this.$py-c)<Math.abs(this.cacheLastStatus.py-c)&&(this.container.style.top=g+"px"),this.cacheLastStatus.px=this.$px,this.cacheLastStatus.py=this.$py;break;case"dragend":e.preventDefault(),this.isDown=!1,this.isBorder=""}}}},{key:"$handleWheel",value:function(t){var i=this;t?t.stopPropagation():e.event.cancelBubble=!0,t=w(t),t.preventDefault();var n=t.target,s=void 0,a=void 0,o=M(t);if(s=o[0].x,a=o[0].y,n==this.viewerImg||n==this.viewerBody){if(B.debug("wheel"),this.wheeling)return;this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50);var r=1,l=1,d=1;t.deltaY?l=t.deltaY>0?1:-1:t.wheelDelta?l=-t.wheelDelta/120:t.detail&&(l=t.detail>0?1:-1),d=-l*r,d=Number(d),d=d<0?1/(1-d):1+d;var h=b(this.viewerImg),u=h.left,c=h.top;h=b(this.viewerImg.parentNode);var p=h.left,m=h.top,g=this.viewerImg.clientWidth,v=this.viewerImg.clientHeight,f=this.viewerBody.clientWidth,_=this.viewerBody.clientHeight,y=this.viewerData.height,I=this.viewerData.width;g*=d,g>10*I?(g=10*I,d=g/this.viewerImg.clientWidth):y<G.IMAGE_MIN_HEIGHT||I<G.IMAGE_MIN_WIDTH?g<I&&(g=I,d=g/this.viewerImg.clientWidth):g<G.IMAGE_MIN_WIDTH&&(g=G.IMAGE_MIN_WIDTH,d=g/this.viewerImg.clientWidth),this.viewerImg.style.width=g+"px",v=this.viewerImg.clientHeight,u=(u-s)*d+s,c=(c-a)*d+a,_>=v||f>=g?(u=f/2-g/2,c=_/2-v/2,this.viewerImg.style.left=u+"px",this.viewerImg.style.top=c+"px"):(u-=p,c-=m,u=u>0?0:u,u=u<f-g?f-g:u,c=c>0?0:c,c=c<_-v?_-v:c,this.viewerImg.style.left=u+"px",this.viewerImg.style.top=c+"px")}}},{key:"$handleMousemove",value:function(e){e=w(e),e.preventDefault();var t=(e.originalEvent?e.originalEvent:e,M(e));this.$px=t[0].x,this.$py=t[0].y;var i=this.fulled,n=!1,s=e.target;switch(s!=this.viewerClose&&s!=this.viewerFull||(n=!0),e.type){case"touchstart":n&&g(s,"head__oper--hover");case"mousedown":if(i||n)return;B.debug(this.$px,this.$py),this.isBorder=this.$borderCheck({x:this.$px,y:this.$py});break;case"mousemove":if(i||n)return;this.$borderCheck({x:this.$px,y:this.$py},function(){B.debug("done")});break;case"mouseover":n&&g(s,"head__oper--hover");break;case"mouseleave":case"touchend":n&&v(s,"head__oper--hover")}}},{key:"$borderCheck",value:function(e,t){var i=e.x,n=e.y,s=this.container;s.style.cursor="";for(var a=s.offsetLeft,o=s.offsetTop,r=s.clientWidth,l=s.clientHeight,d={x:a,y:o},h={x:a+r,y:o},u={x:a,y:o+l},c={x:a+r,y:o+l},p=[d,h,u,c],m=["nw-resize","ne-resize","sw-resize","se-resize"],g=!0,v=0;v<p.length;v++)if(Math.abs(i-p[v].x)<this.bound&&Math.abs(n-p[v].y)<this.bound){s.style.cursor=m[v],g=!1,t&&t(i,n);break}return g&&(i>d.x+this.bound&&i<c.x-this.bound&&n>d.y&&n<d.y+this.bound?(s.style.cursor="n-resize",t&&t(i,n),g=!1):i>d.x+this.bound&&i<c.x-this.bound&&n>c.y-this.bound&&n<c.y?(s.style.cursor="s-resize",t&&t(i,n),g=!1):i>d.x&&i<d.x+this.bound&&n>d.y+this.bound&&n<c.y-this.bound?(s.style.cursor="w-resize",t&&t(i,n),g=!1):i>c.x-this.bound&&i<c.x&&n>d.y+this.bound&&n<c.y-this.bound&&(s.style.cursor="e-resize",t&&t(i,n),g=!1)),s.style.cursor}},{key:"$initFullStatus",value:function(){this.fulled?(this.viewerFull&&v(this.viewerFull,"head__full"),this.viewerFull&&g(this.viewerFull,"head__small")):(this.viewerFull&&v(this.viewerFull,"head__small"),this.viewerFull&&g(this.viewerFull,"head__full"))}},{key:"$initSwip",value:function(){0==this.currentIndex?g(this.swipLeft,"oper--disabled"):v(this.swipLeft,"oper--disabled"),this.currentIndex==this.imgLength-1?g(this.swipRight,"oper--disabled"):v(this.swipRight,"oper--disabled")}},{key:"open",value:function(){this.container&&(this.fulled=!1,this.$initFullStatus(),this.container.style.display="",this.options.modal&&this.mask&&v(this.mask,"hide-dom"),this.$resize())}},{key:"close",value:function(){this.container.style.display="none",this.options.modal&&g(this.mask,"hide-dom")}},{key:"full",value:function(){this.fulled?(this.fulled=!1,this.viewerFull.setAttribute("title",this.langObject.max),this.container.style.left=this.cacheLastStatus.full.containerLeft+"px",this.container.style.top=this.cacheLastStatus.full.containerTop+"px",this.viewerBody.style.width=this.cacheLastStatus.full.bodyWidth+"px",this.viewerBody.style.height=this.cacheLastStatus.full.bodyHeight+"px",this.viewerImg.style.width=this.cacheLastStatus.full.imgWidth+"px",this.viewerImg.style.left=this.cacheLastStatus.full.imgLeft+"px",this.viewerImg.style.top=this.cacheLastStatus.full.imgTop+"px"):(this.fulled=!0,this.cacheLastStatus=this.cacheLastStatus||{},this.cacheLastStatus.full={containerLeft:this.container.offsetLeft,containerTop:this.container.offsetTop,bodyWidth:this.viewerBody.clientWidth,bodyHeight:this.viewerBody.clientHeight,imgWidth:this.viewerImg.clientWidth,imgLeft:this.viewerImg.offsetLeft,imgTop:this.viewerImg.offsetTop},this.viewerFull.setAttribute("title",this.langObject.min),this.$resize(this.fullBodyWidth,this.fullBodyHeight)),this.$initFullStatus()}},{key:"prev",value:function(){this.currentIndex--,this.currentIndex>=0?(this.viewerData.src=this.options.src[this.currentIndex],this.$init(this.viewerBody.clientWidth)):(this.currentIndex=0,g(this.swipLeft,"oper--disabled"))}},{key:"next",value:function(){this.currentIndex++,this.currentIndex<this.imgLength?(this.viewerData.src=this.options.src[this.currentIndex],this.$init(this.viewerBody.clientWidth)):(g(this.swipRight,"oper--disabled"),this.currentIndex=this.imgLength-1)}},{key:"updateSrc",value:function(){var e=arguments;if(0!=e.length)if(1==e.length){var t=e[0];s(t)?(this.options.src[0]=t,this.viewerData.src=t,this.$init()):a(t)&&t>=0&&t<this.imgLength?(this.viewerData.src=this.options.src[t],this.currentIndex=t,this.$init()):l(t)&&t.length>0&&(this.options.src=t,this.viewerData.src=this.options.src[0],this.currentIndex=0,this.imgLength=t.length,this.$init())}else if(e.length>=2){var i=e[0],n=e[1];a(i)&&l(n)&&i>=0&&i<n.length&&(this.options.src=n,this.viewerData.src=this.options.src[i],this.imgLength=n.length,this.currentIndex=i,this.$init())}}},{key:"setLock",value:function(e){this.options.lock=e}},{key:"destroy",value:function(){var e=this;te.unregisterEvent(this,"tap dragstart drag dragend pinchstart pinch pinchend"),this.container&&f(this.container,"mousedown mousemove",e.$handleMousemove),this.viewerClose&&f(this.viewerClose,"mouseover mouseleave",e.$handleMousemove),this.viewerFull&&f(this.viewerFull," mouseover mouseleave",e.$handleMousemove),this.container&&this.container.parentNode.removeChild(this.container),this.mask&&this.mask.parentNode&&this.mask.parentNode.removeChild(this.mask),this.mask=null,this.container=null,this.viewerImg=null,this.viewerClose=null,this.viewerFull=null,this.viewerHead=null,this.viewerBody=null,this.swipLeft=null,this.swipRight=null,this.loading=null,this.options=null,this.$handle=null,this.$handleMousemove=null,G.TOP_VIEWER&&G.TOP_VIEWER==this&&(G.TOP_VIEWER=null),this.viewerData=null}}]),i}(),re={MOBILE:"mobile",PC:"pc"},le={createViewer:function(e){var t=e.env;switch(t){case re.MOBILE:return new ie(e);case re.PC:return new oe(e)}return _.VIEWER}},de=function(){function t(e,i){if(N(this,t),!e&&!i)throw new Error("至少需要一个参数");if(!i&&e)i=e,e=null;else if(i&&e){var s=e.nodeName&&"IMGimg".match(e.nodeName);if(!(s&&s.length>0))throw new Error("图片参数有误")}this.container=e,this.options=u({},q,i),T()?this.env="mobile":this.env="pc",this.env=this.options.env||this.env,this.options.env=this.env;var a="";this.options.src&&"string"==n(this.options.src)?a=this.options.src:this.container&&(a=this.container&&this.container.getAttribute("src"),this.options.src=a),!this.options.src&&B.debug("没有图片地址"),this.imgData={src:a,width:0,height:0},this.viewer=null}return V(t,[{key:"render",value:function(){var e=this.container&&this.container.nodeName&&"IMGimg".match(this.container.nodeName);e&&e.length>0&&(this.container.removeAttribute("style"),this.container.removeAttribute("class"),this.container.removeAttribute("width"),this.container.removeAttribute("height"),this.container.style.display="none"),this.$init()}},{key:"$init",value:function(){var e=this,t=this;t.$createHtml(),this.$loadImage(function(){return t.imgData.width<G.IMAGE_MIN_WIDTH&&t.imgData.height<G.IMAGE_MIN_HEIGHT?(t.container&&(t.container.style.display=""),p(t.container,{border:"0"}),p(t.container,{width:t.imgData.width,height:t.imgData.height}),e.img.removeAttribute("style"),g(t.scale,"hide-dom"),g(t.loading,"hide-dom"),void t.$removeLister()):(t.$renderHtml(),g(e.loading,"hide-dom"),void B.debug("loaded img"))})}},{key:"$loadImage",value:function(e){var t=this,i=new Image;i.src=t.imgData.src,i.complete?(t.imgData.width=i.width,t.imgData.height=i.height,e&&e()):(i.onload=function(){t.imgData.width=i.width,t.imgData.height=i.height,e&&e(),i.onload=null},i.onerror=function(){t.img.src=t.options.defaultSrc,t.options.defaultSrc&&(i.src=t.options.defaultSrc),t.imgData.src=t.options.defaultSrc,i.onerror=null})}},{key:"$createHtml",value:function(){var e=void 0,t=void 0;if(e=this.options.inline?L.view2:L.view,e=x(e),t=e.firstElementChild,"mobile"==this.env&&g(e.querySelector(".insert-pictures__zoom"),"hide-dom"),this.container)this.img=this.container;else{var i=x("<img/>");i.src=this.imgData.src,this.img=i}this.container=e,this.img&&this.img.parentElement&&this.img.parentElement.insertBefore(this.container,this.img),
t&&t.insertBefore(this.img,t.firstElementChild),this.loading=this.container.querySelector(".insert-pictures__loading"),this.scale=this.container.querySelector(".insert-pictures__zoom");var n=this;n.$handle=c(n.$handle,n),"pc"!=this.env||this.options.eventAll?this.container&&y(this.container,"click",n.$handle):this.scale&&y(this.scale,"click",n.$handle),this.options.style&&p(this.container,this.options.style)}},{key:"$renderHtml",value:function(){this.$resize()}},{key:"$resize",value:function(){var e=void 0,t=void 0,i=void 0,n=void 0;i=this.imgData.width,n=this.imgData.height,i<G.IMAGE_MIN_HEIGHT?(e=G.IMAGE_MIN_WIDTH,t=n<=G.IMAGE_MAX_HEIGHT?n:G.IMAGE_MAX_HEIGHT):n<G.IMAGE_MIN_WIDTH?(t=G.IMAGE_MIN_HEIGHT,e=i<=G.IMAGE_MAX_WIDTH?i:G.IMAGE_MAX_WIDTH):i>G.IMAGE_MAX_WIDTH||n>G.IMAGE_MAX_HEIGHT?(e=G.IMAGE_MAX_WIDTH,t=G.IMAGE_MAX_HEIGHT):(e=i,t=n),this.container.style.width=e+"px",this.container.style.height=t+"px",this.img.removeAttribute("style")}},{key:"$handle",value:function(t){if(t?t.stopPropagation():e.event.cancelBubble=!0,B.debug("click"),!this.options.lock){if(null==this.viewer){var i=u({},this.options,this.imgData);this.viewer=le.createViewer(i),this.viewer.container.style.zIndex=100001}else"mobile"==this.env&&this.viewer.updateSrc(this.imgData.src);this.viewer.open(),G.TOP_VIEWER&&G.TOP_VIEWER.container&&(G.TOP_VIEWER.container.style.zIndex=1e5),this.viewer.container&&(this.viewer.container.style.zIndex=100001),G.TOP_VIEWER=this.viewer}}},{key:"setLock",value:function(e){this.options.lock=e,this.options.lock?this.container&&p(this.container,{"pointer-events":"none"}):this.container&&p(this.container,{"pointer-events":""})}},{key:"getView",value:function(){return this.container}},{key:"reset",value:function(){this.off()}},{key:"on",value:function(){this.viewer&&this.viewer.open()}},{key:"off",value:function(){this.viewer&&this.viewer.close()}},{key:"$removeLister",value:function(){"pc"!=this.env||this.options.eventAll?this.container&&f(this.container,"click",this.$handle):this.scale&&f(this.scale,"click",this.$handle)}},{key:"destroy",value:function(){B.debug("销毁imageveiewer"),this.$removeLister(),this.viewer&&this.viewer.destroy(),this.container=null,this.viewer=null,this.loading=null,this.scale=null,this.options=null,this.imgData=null}}]),t}(),he={setLoggerLevel:function(e){B.setLevel(e)},render:function(e,i){e=e.length>0?e[0]:e;for(var n in G.IMAGE_INSTANCES)t.querySelector('[data-id="'+G.getKeyId(n)+'"]')||G.clear(n);if(G.TOP_VIEWER=null,G.VIEWER=null,i=i||{},te.init(),te.unbind(),te.bind(),e){var s="img"==e.nodeName.toLowerCase()?[e]:e.getElementsByTagName("img");h(s,function(e,t){if(!(e.parentNode&&m(e.parentNode,"ndui-insert-pictures")||e.parentNode&&m(e.parentNode,"pop-insert-pictures__body"))){var n=$("media"),s="image",a=i.containerId||"";s=s+"-"+a+"-"+t;var o=s+"|"+n,r=u({},i,{dataId:n,mediaId:s,key:o}),l=new de(e,r);l.render(),G.IMAGE_INSTANCES[o]=l}})}else B.debug("no container");return G.IMAGE_INSTANCES},destroy:function(){te.unbind();for(var e=G.IMAGE_INSTANCES,t=0,i=e.length;t<i;t++)e.destroy();G.IMAGE_INSTANCES={},G.TOP_VIEWER=null,G.VIEWER=null},reset:function(){for(var e=G.IMAGE_INSTANCES,t=0,i=e.length;t<i;t++)e.off()},setLock:function(e,t){var i=G.IMAGE_INSTANCES;for(var n in i)i[n].setLock(e)},getMedia:function(){return G.IMAGE_INSTANCES},mediaOnFullScreenChange:function(){},Image:{create:function(e,t){return te.init(),te.unbind(),te.bind(),new de(e,t)}},Viewer:{create:function(e){var t="";t=T()?"mobile":"pc",e.env=e.env||t,te.init(),te.unbind(),te.bind();var i=le.createViewer(e);return G.TOP_VIEWER&&G.TOP_VIEWER.container&&(G.TOP_VIEWER.container.style.zIndex=1e5),i.container&&(i.container.style.zIndex=100001),G.TOP_VIEWER=i,i}}};return he}();!function(e,t,i){function n(e){return e=e||{},this.each(function(){var n=t(this),s=n.data("my.mediaplayer"),a=t.extend({},"object"==typeof e&&e);s||(s=i.Image.create(n.get(0),a),n.data("my.mediaplayer",s))})}t.fn("imgplayer",n)}(e,i,s),function(e,i,n){var a=function(){},o=function(t){var i=e.NDMediaPlayer,n=t.mediaType+"-"+t.index+"|"+t.dataId;for(var s in i._$medias)n!==s&&i._$medias[s]&&i._$medias[s].data("my.mediaplayer").pause&&i._$medias[s].data("my.mediaplayer").pause()},r={onlyRender:!1,lock:!1,autoAdaptSize:!1,lang:"zh",mutuallyExclusive:!0,containerId:"",returnInstances:!1,mediaPreload:!0,index:null,style:"",_onEnd:null,_onPlay:null,img:{render:!1,renderUI:!0,renderImmediately:!1,width:0,height:0,src:""},video:{render:!0,width:0,height:0,renderUI:!0,supportFullscreen:!0,showPlayBtnInVideo:!1,showPlayBtnInVideo:!1,showFullscreenBtn:!1},audio:{render:!0,width:0,height:0,renderUI:!0},onPlay:null,onPause:null,onEnd:null,onSeek:null,onVolumeChange:null,onTimeUpdate:null,onFullScreenChange:null},l=["audio","video","img"],d=function(e,t){e=e||{};var n=i.extend({},r.img,e.img||{}),s=i.extend({},r.video,e.video||{}),a=i.extend({},r.audio,e.audio||{}),e=i.extend({},r,e||{},t);return e.img=n,e.video=s,e.audio=a,e.mediaMargin&&(e.style+=";margin:"+e.mediaMargin),e},h=function(e,n,s){var a=i(t.createElement("div"));return a.attr("style",s.style),a.addClass("qp_media"),a.attr("id","qp-media"),e.before(a.get(0)),a.appendChild(e.get(0)),s.renderUI=s[n].renderUI,a.attr("data-id",s.dataId),a[n+"player"](s),a.attr("data-media",s.mediaId),{dom:a,instance:a.data("my.mediaplayer")}};e.NDMediaPlayer={_$medias:{},_eventHandler:{play:a,mutuallyExclusivePlay:o,pause:a,ended:a,timeupdate:a,seeked:a,volumeChange:a,fullScreenChange:a},_getMedia:function(e,t){var i=this,n=e+"-"+t;for(var s in this._$medias)if(i._getKeyMedia(s)===n){var a=this._$medias[s];return a}return null},_getKey:function(e){return e.attr("data-media")+"|"+e.attr("data-id")},_getKeyId:function(e){return e.split("|")[1]},_getKeyMedia:function(e){return e.split("|")[0]},_getKeyType:function(e){return e.split("-")[0]},renderToTarget:function(e,i,n){var s=t.createElement("div");s.appendChild(e),NDMediaPlayer.render(s,n),i.appendChild(s.childNodes[0])},renderMediaEle:function(e,n){var s=t.createElement("div"),a=i(s);i(e).before(s),a.appendChild(e),NDMediaPlayer.render(s,n),a.before(s.childNodes[0]),a.remove()},_clear:function(e){var t=this;if(t._$medias[e]){var i=t._$medias[e].data("my.mediaplayer");i&&i.destroy(),t._$medias[e].data("my.mediaplayer",null),delete t._$medias[e]}},setLoggerLevel:function(e){i.logger.setLevel(e),s.setLoggerLevel(e)},destroy:function(e){var n=this;for(var s in n._eventHandler)"mutuallyExclusivePlay"!==s&&(n._eventHandler[s]=a);if(arguments.length>0){var o=typeof e,r=null;if("string"===o?r=i("#"+e):"object"===o&&(r=i("undefined"!=typeof jQuery&&e instanceof jQuery?e[0]:e)),0===r.length)return;for(var l=r.find(".qp_media"),d=0;d<l.length;d++){var h=n._getKey(i(l.get(d)));n._clear(h)}}else for(var u in n._$medias)t.querySelector('[data-id="'+n._getKeyId(u)+'"]')||n._clear(u)},reset:function(){for(var e in this._$medias)if(this._$medias[e]){var t=this._$medias[e].data("my.mediaplayer");t&&t.reset&&t.reset()}},setLock:function(e,t){if(t){var n=typeof t,s=null;if("string"===n?s=i("#"+t):"object"===n&&(s=i("undefined"!=typeof jQuery&&t instanceof jQuery?t[0]:t)),0===s.length)return;for(var a=s.find(".qp_media"),o=0;o<a.length;o++){var r=this._getKey(i(a.get(o)));if(this._$medias[r]){var l=this._$medias[r].data("my.mediaplayer");l&&l.setLock&&l.setLock(e)}}}else for(var d in this._$medias)if(this._$medias[d]){var l=this._$medias[d].data("my.mediaplayer");l&&l.setLock&&l.setLock(e)}},render:function(e,n){var s=this;for(var a in s._$medias){var o=s._$medias[a].data("my.mediaplayer");o&&o.getView&&o.getView()?o.getView().parentNode||s._clear(a):t.querySelector('[data-id="'+s._getKeyId(a)+'"]')||s._clear(a)}var n=d(n,{eventHandler:s._eventHandler}),r={},u={},c=e.length>0?e[0]:e,p=/^img|video|audio$/i;if(c.nodeName&&p.test(c.nodeName))u[c.nodeName.toLocaleLowerCase()]=[i(c)];else for(var m=0,g=l.length;m<g;m++)u[l[m]]=i(c).find(l[m]);for(var v in u)u.hasOwnProperty(v)&&u[v].each(function(e){if(n[v].render){var t="img"===v,a=i(this),o=a.closest(".qp_media");if(!(o&&o.length>0&&o.get(0))){var l={};"undefined"==typeof n.index||null==n.index?l=i.extend({},n,{index:n.containerId+"-"+e}):(l=i.extend({},n),l.index=l.containerId+"-"+l.index),l.dataId=i.utils.getRandomId("media"),l.mediaId=v+"-"+l.index;var d=null,u=l.mediaId+"|"+l.dataId;if(t){var c=i.extend({},n.img,{lang:n.lang,eventHandler:n.eventHandler,onFullScreenChange:n.onFullScreenChange});a[v+"player"](c),d=a.data("my.mediaplayer"),d&&d.render();var p=i(d.getView());p.addClass("qp_media"),p.attr("data-id",l.dataId),p.attr("data-media",v+"-"+l.index),s._$medias[u]=a}else{var m=h(a,v,l);d=m.instance,s._$medias[u]=m.dom}d&&d.setLock(n.lock),n.returnInstances&&(r[u]=d)}}});if(n.returnInstances)return r},mediaOnStart:function(e){"function"==typeof e&&(this._eventHandler.play=e)},mediaOnPause:function(e){"function"==typeof e&&(this._eventHandler.pause=e)},mediaOnEnded:function(e){"function"==typeof e&&(this._eventHandler.ended=e)},mediaOnTimeupdate:function(e){"function"==typeof e&&(this._eventHandler.timeupdate=e)},mediaOnSeeked:function(e){"function"==typeof e&&(this._eventHandler.seeked=e)},mediaOnVolumeChange:function(e){"function"==typeof e&&(this._eventHandler.volumeChange=e)},getMedia:function(e){if(e){var t=this._$medias[e];return t}return this._$medias},mediaPlay:function(e,t){var i=this._getMedia(e,t);i&&i.get(0)&&i.data("my.mediaplayer").play()},mediaPause:function(e,t){var i=this._getMedia(e,t);i&&i.get(0)&&i.data("my.mediaplayer").pause()},mediaSkip:function(e,t,i){var n=this._getMedia(e,t).find(e);n&&n.get(0)&&(n.get(0).currentTime=0==i?.01:i)},mediaVolumeChange:function(e,t,i,n){var s=this._getMedia(e,t);s&&s.get(0)&&s.data("my.mediaplayer").changeVolume(i,n)},mediaPauseAll:function(e){var t=this;if("undefined"!=typeof e){var n=typeof e,s=null;if("string"===n?s=i("#"+e):"object"===n&&(s=i("undefined"!=typeof jQuery&&e instanceof jQuery?e[0]:e)),0===s.length)return;for(var a=s.find(".qp_media"),o=0;o<a.length;o++){var r=t._getKey(i(a.get(o)));if(t._$medias[r]){var l=t._$medias[r].data("my.mediaplayer");l&&l.pause&&l.pause()}}}else for(var d in t._$medias){var h=t._$medias[d];h&&h.get(0)&&h.data("my.mediaplayer")&&h.data("my.mediaplayer").pause&&h.data("my.mediaplayer").pause()}},mediaOnFullScreenChange:function(e){"function"==typeof e&&(this._eventHandler.fullScreenChange=e)},Image:{create:function(e,t){return n.Image.create(e,t)}},ImageViewer:{create:function(e){return n.Viewer.create(e)}}}}(e,i,s),function(e,i){e.NDMediaPlayer.PPTMediaRender={videoZIndex:2,mutuallyExclusive:!1,renderVideoImg:function(e){var t="",i=e.previousElementSibling;return i&&(i.style.display="none",t=i.getAttribute("src")),e.parentNode&&e.parentNode.parentNode&&(e.parentNode.parentNode.setAttribute("onclick",""),e.parentNode.parentNode.setAttribute("onmouseout",""),e.parentNode.parentNode.setAttribute("onmouseover","")),t},mediaRenderComplete:function(){i(t).bind("click",function(t){var n=i(t.target).closest(".qp-media-box");if(!n||0===n.length){var s=e.NDMediaPlayer.getMedia();for(var a in s)s[a].data("my.mediaplayer")&&s[a].data("my.mediaplayer").hideVolumeControl()}}),e.parent&&e.parent.PPTMediaPlayer&&e.parent.PPTMediaPlayer.renderMediaComplete&&e.parent.PPTMediaPlayer.renderMediaComplete(e.NDMediaPlayer)},renderVideo:function(t,i,n,s){t.setAttribute("poster",s),e.NDMediaPlayer.renderToTarget(t,i,{onlyRender:!1,autoAdaptSize:!0,mutuallyExclusive:NDMediaPlayer.PPTMediaRender.mutuallyExclusive,mediaMargin:"0px",audio:{render:!1},video:{showPlayBtnInVideo:!1,supportFullscreen:!1},index:n,_onPlay:function(){if(NDMediaPlayer.PPTMediaRender.mutuallyExclusive){var t=e.NDMediaPlayer.getMedia();for(var i in t)"audio"===e.NDMediaPlayer._getKeyType(i)&&t[i].hide()}}})},renderAudio:function(n,s,a){e.NDMediaPlayer.renderToTarget(n,s,{onlyRender:!1,autoAdaptSize:!0,mutuallyExclusive:NDMediaPlayer.PPTMediaRender.mutuallyExclusive,index:a,style:"display:none;z-index:"+NDMediaPlayer.PPTMediaRender.videoZIndex,mediaMargin:"0px",video:{render:!1},audio:{width:220,height:80},_onEnd:function(t){var n=e.NDMediaPlayer._getMedia(t.mediaType,t.index);n&&(n.hide(),n.get(0).parentNode&&i(n.get(0).parentNode).css("zIndex",""))},_onPlay:function(e){if(NDMediaPlayer.PPTMediaRender.mutuallyExclusive){var t=NDMediaPlayer.getMedia();for(var n in t)NDMediaPlayer._getKeyMedia(n)!==e.mediaType+"-"+e.index&&"audio"===NDMediaPlayer._getKeyType(n)&&(t[n].hide(),t[n].parentNode&&i(t[n].parentNode).css("zIndex",""))}}});var o=i(s).find("img");o&&o.length>0&&o.get(0).parentNode&&!function(n){var s=i(n.get(0).parentNode);s.attr("onclick",""),s.attr("onmouseout",""),s.attr("onmouseover",""),s.addClass(s.attr("id"));var a="on",o="";if(n.get(0).nextElementSibling&&(o=NDMediaPlayer._getKey(i(n.get(0).nextElementSibling))),o){var r=e.NDMediaPlayer.getMedia(o),l=r.data("my.mediaplayer"),d=i("#contentHolder"),h=r.find(".qp-media-box"),u=!1,c=function(){if(!u){u=!0;var e=s.offset(),t=d.offset(),n=l.getScale(),a=h.width(),o=h.height(),c=s.width(),p=s.height(),m=e.left-(n*a/2-n*c/2)-t.left,g=e.left+n*a/2+n*c/2-(t.left+d.width()),v=e.top+p*n+l.getScale()*o-(t.top+d.height());m<0?r.css("left",-parseInt(a/2-c/2+m/n)+"px"):g>0?r.css("left",-parseInt(a/2-c/2+g/n)+"px"):r.css("left",-parseInt(a/2-c/2)+"px"),v>0?r.css("bottom",p/(i.support.touch?1:1.5)+"px"):r.css("top",p/(i.support.touch?1:1.5)+"px")}};n[a]("click","",function(){if(l.isPlaying())l.pause(),r.hide(),s.css("zIndex","");else if(l.play(),r.show(),s.css("zIndex",NDMediaPlayer.PPTMediaRender.videoZIndex++),c(),NDMediaPlayer.PPTMediaRender.mutuallyExclusive){var t=e.NDMediaPlayer.getMedia();for(var i in t)i!==o&&"audio"===NDMediaPlayer._getKeyType(i)&&(t[i].hide(),s.css("zIndex",""),t[i].data("my.mediaplayer").pause())}}),i.support.touch||n[a]("mouseover","",function(e){i.event.checkHover(e,this)&&(r.show(),s.css("zIndex",NDMediaPlayer.PPTMediaRender.videoZIndex++),r.css("zIndex",NDMediaPlayer.PPTMediaRender.videoZIndex++),c())}),s[a]("mouseout","",function(e){i.event.checkHover(e,this)&&(l.isPlaying()||(r.hide(),s.css("zIndex","")))}),i(t).bind("click",function(e){var t=i(e.target).closest("."+s.attr("id"));t&&0!==t.length||l.isPlaying()||(r.hide(),s.css("zIndex",""))})}}(o)}}}(e,i)}(window,document);
//# sourceMappingURL=media.min.js.map
